using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Threading;
using CompDevLib.Interpreter;
using Config;
using Config.ConfigCells;
using Config.ConfigCells.Character;
using GameData.ArchiveData;
using GameData.Combat.Math;
using GameData.Common;
using GameData.Dependencies;
using GameData.DLC;
using GameData.DomainEvents;
using GameData.Domains.Adventure;
using GameData.Domains.Building;
using GameData.Domains.Character.Ai;
using GameData.Domains.Character.Ai.GeneralAction;
using GameData.Domains.Character.Ai.GeneralAction.BehaviorAction;
using GameData.Domains.Character.Ai.GeneralAction.HealthDemand;
using GameData.Domains.Character.Ai.GeneralAction.LifeSkillRandom;
using GameData.Domains.Character.Ai.GeneralAction.SocialStatusRandom;
using GameData.Domains.Character.Ai.GeneralAction.StudyDemand;
using GameData.Domains.Character.Ai.GeneralAction.TeachRandom;
using GameData.Domains.Character.Ai.GeneralAction.WealthDemand;
using GameData.Domains.Character.Ai.PrioritizedAction;
using GameData.Domains.Character.AvatarSystem;
using GameData.Domains.Character.AvatarSystem.AvatarRes;
using GameData.Domains.Character.Creation;
using GameData.Domains.Character.Display;
using GameData.Domains.Character.Filters;
using GameData.Domains.Character.ParallelModifications;
using GameData.Domains.Character.Relation;
using GameData.Domains.Character.TemporaryModification;
using GameData.Domains.Combat;
using GameData.Domains.CombatSkill;
using GameData.Domains.Extra;
using GameData.Domains.Global.Inscription;
using GameData.Domains.Information;
using GameData.Domains.Information.Collection;
using GameData.Domains.Item;
using GameData.Domains.Item.Display;
using GameData.Domains.Item.Filters;
using GameData.Domains.LifeRecord;
using GameData.Domains.Map;
using GameData.Domains.Merchant;
using GameData.Domains.Organization;
using GameData.Domains.SpecialEffect;
using GameData.Domains.Taiwu;
using GameData.Domains.Taiwu.Profession;
using GameData.Domains.Taiwu.Profession.SkillsData;
using GameData.Domains.Taiwu.VillagerRole;
using GameData.Domains.TaiwuEvent;
using GameData.Domains.TaiwuEvent.DisplayEvent;
using GameData.Domains.TaiwuEvent.EventHelper;
using GameData.Domains.TaiwuEvent.MonthlyEventActions;
using GameData.Domains.World.MonthlyEvent;
using GameData.Domains.World.Notification;
using GameData.Serializer;
using GameData.Utilities;
using Redzen.Random;

namespace GameData.Domains.Character
{
	// Token: 0x02000805 RID: 2053
	[SerializableGameData(NotForDisplayModule = true)]
	public class Character : BaseGameDataObject, ISerializableGameData, IValueSelector
	{
		// Token: 0x06006BE4 RID: 27620 RVA: 0x003C7EAC File Offset: 0x003C60AC
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			66
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			25
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		private short CalcPhysiologicalAge()
		{
			short age = this._currAge;
			return (short)DomainManager.SpecialEffect.ModifyData(this._id, -1, 25, (int)age, -1, -1, -1);
		}

		// Token: 0x06006BE5 RID: 27621 RVA: 0x003C7EE0 File Offset: 0x003C60E0
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			8
		}, Scope = InfluenceScope.Self)]
		private uint CalcDarkAshProtector()
		{
			ECharacterFeatureDarkAshProtector value = (this._organizationInfo.OrgTemplateId == 16) ? ECharacterFeatureDarkAshProtector.IsTaiwu : ECharacterFeatureDarkAshProtector.None;
			foreach (short featureId in this._featureIds)
			{
				value |= CharacterFeature.Instance[featureId].DarkAshProtector;
			}
			return (uint)value;
		}

		// Token: 0x06006BE6 RID: 27622 RVA: 0x003C7F5C File Offset: 0x003C615C
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			8,
			41,
			17
		}, Scope = InfluenceScope.Self)]
		[SingleValueDependency(1, new ushort[]
		{
			27
		})]
		private sbyte CalcFame()
		{
			CharacterItem template = Character.Instance[this._templateId];
			bool flag = this._creatingType != 1;
			sbyte result;
			if (flag)
			{
				result = template.PresetFame;
			}
			else
			{
				int value = 0;
				bool isTaiwu = this.IsTaiwu();
				foreach (short featureId in this._featureIds)
				{
					value += GameData.Domains.Character.SharedMethods.GetSectFeatureFameBonus(featureId, isTaiwu, this._organizationInfo);
				}
				int currDate = DomainManager.World.GetCurrDate();
				int i = 0;
				int recordsCount = this._fameActionRecords.Count;
				while (i < recordsCount)
				{
					FameActionRecord record = this._fameActionRecords[i];
					bool flag2 = record.EndDate <= currDate;
					if (!flag2)
					{
						value += (int)record.Value;
					}
					i++;
				}
				result = (sbyte)Math.Clamp(value, -100, 100);
			}
			return result;
		}

		// Token: 0x06006BE7 RID: 27623 RVA: 0x003C806C File Offset: 0x003C626C
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			7,
			56
		}, Scope = InfluenceScope.Self)]
		[SingleValueDependency(4, new ushort[]
		{
			27,
			26
		})]
		private short CalcMorality()
		{
			short fixedMorality = this.GetFixedMorality();
			return (fixedMorality != short.MaxValue) ? fixedMorality : Math.Clamp(this._baseMorality, -500, 500);
		}

		// Token: 0x06006BE8 RID: 27624 RVA: 0x003C80A8 File Offset: 0x003C62A8
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			66,
			76,
			39,
			61
		}, Scope = InfluenceScope.Self)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			13,
			150,
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[ObjectCollectionDependency(6, 3, new ushort[]
		{
			4
		}, Scope = InfluenceScope.CharWhoEquippedTheItem, Condition = InfluenceCondition.ItemIsEquipped)]
		private short CalcAttraction()
		{
			bool flag = this.GetAgeGroup() != 2;
			short result;
			if (flag)
			{
				result = GlobalConfig.Instance.ImmaturityAttraction;
			}
			else
			{
				int value = this.CalcAvatarAttraction();
				value *= this.CalcPropertyModify(ECharacterPropertyReferencedType.Attraction, EDataSumType.All);
				bool flag2 = !this.IsCreatedWithFixedTemplate();
				if (flag2)
				{
					ItemKey key = this._equipment[4];
					bool flag3 = !key.IsValid() || DomainManager.Item.GetBaseItem(key).IsDurabilityRunningOut();
					if (flag3)
					{
						value /= 2;
					}
				}
				result = (short)Math.Clamp(value, 0, 900);
			}
			return result;
		}

		// Token: 0x06006BE9 RID: 27625 RVA: 0x003C8140 File Offset: 0x003C6340
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			18,
			76
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			1,
			2,
			3,
			4,
			5,
			6,
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(9, new ushort[]
		{
			16
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			150
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			246
		}, Scope = InfluenceScope.TaiwuChar)]
		private unsafe MainAttributes CalcMaxMainAttributes()
		{
			MainAttributes value = this._baseMainAttributes;
			short physiologicalAge = this.GetPhysiologicalAge();
			short clampedAge = Character.GetClampedAgeOfAgeEffect(physiologicalAge);
			MainAttributes ageInfluence = AgeEffect.Instance[(int)clampedAge].MainAttributes;
			for (int i = 0; i < 6; i++)
			{
				ECharacterPropertyReferencedType propertyType = ECharacterPropertyReferencedType.Strength + i;
				ushort fieldId = (ushort)(1 + i);
				CValueModify modify = this.CalcPropertyModify(propertyType, EDataSumType.All);
				modify += DomainManager.SpecialEffect.GetModify(this._id, fieldId, -1, -1, -1, EDataSumType.All);
				*value[i] = (short)Math.Clamp((int)(*(ref value.Items.FixedElementField + (IntPtr)i * 2)) * modify * (int)(*ageInfluence[i]), (int)GlobalConfig.Instance.MinValueOfMaxMainAttributes, (int)GlobalConfig.Instance.MaxValueOfMaxMainAttributes);
			}
			return value;
		}

		// Token: 0x06006BEA RID: 27626 RVA: 0x003C8224 File Offset: 0x003C6424
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			80,
			112,
			115,
			28
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			32,
			33,
			34,
			35,
			36,
			37,
			236,
			277,
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			245
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			46,
			47,
			246,
			123
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(8, new ushort[]
		{
			19
		}, Scope = InfluenceScope.AllCharsInCombat)]
		private unsafe HitOrAvoidInts CalcHitValues()
		{
			HitOrAvoidInts value = this.Template.BaseHitValues;
			BoolArray8 canAdd = default(BoolArray8);
			BoolArray8 canReduce = default(BoolArray8);
			Span<int> span = new Span<int>(stackalloc byte[(UIntPtr)16], 4);
			Span<int> addEffectBonus = span;
			span = new Span<int>(stackalloc byte[(UIntPtr)16], 4);
			Span<int> reduceEffectBonus = span;
			for (int hitType = 0; hitType < 4; hitType++)
			{
				canAdd[hitType] = DomainManager.SpecialEffect.ModifyData(this._id, -1, 36, true, hitType, 0, -1);
				canReduce[hitType] = DomainManager.SpecialEffect.ModifyData(this._id, -1, 36, true, hitType, 1, -1);
				*addEffectBonus[hitType] = DomainManager.SpecialEffect.GetModifyValue(this._id, 37, EDataModifyType.Add, hitType, 0, -1, EDataSumType.All);
				*reduceEffectBonus[hitType] = DomainManager.SpecialEffect.GetModifyValue(this._id, 37, EDataModifyType.Add, hitType, 1, -1, EDataSumType.All);
			}
			for (int i = 0; i < 4; i++)
			{
				ECharacterPropertyReferencedType propertyType = ECharacterPropertyReferencedType.HitRateStrength + i;
				EDataSumType sumType = DataSumTypeHelper.CalcSumType(canAdd[i], canReduce[i]);
				CValueModify modify = this.CalcPropertyModify(propertyType, sumType);
				ushort fieldId = (ushort)(32 + i);
				bool flag = canAdd[i];
				if (flag)
				{
					modify += DomainManager.SpecialEffect.GetModify(this._id, fieldId, -1, -1, -1, EDataSumType.OnlyAdd) * *addEffectBonus[i];
				}
				bool flag2 = canReduce[i];
				if (flag2)
				{
					modify += DomainManager.SpecialEffect.GetModify(this._id, fieldId, -1, -1, -1, EDataSumType.OnlyReduce) * *reduceEffectBonus[i];
				}
				ref HitOrAvoidInts ptr = ref value;
				int index = i;
				ptr[index] *= modify;
			}
			span = new Span<int>(stackalloc byte[(UIntPtr)16], 4);
			Span<int> tempValueAdd = span;
			tempValueAdd.Fill(0);
			for (sbyte hitType2 = 0; hitType2 < 4; hitType2 += 1)
			{
				int addValue = DomainManager.SpecialEffect.GetModifyValue(this._id, 277, EDataModifyType.Add, (int)hitType2, *(ref value.Items.FixedElementField + (IntPtr)hitType2 * 4), -1, EDataSumType.All);
				for (sbyte type = 0; type < 4; type += 1)
				{
					bool flag3 = type != hitType2;
					if (flag3)
					{
						*tempValueAdd[(int)type] += addValue;
					}
				}
			}
			for (sbyte hitType3 = 0; hitType3 < 4; hitType3 += 1)
			{
				bool flag4 = canAdd[(int)hitType3];
				if (flag4)
				{
					*(ref value.Items.FixedElementField + (IntPtr)hitType3 * 4) += *tempValueAdd[(int)hitType3];
				}
			}
			for (sbyte hitType4 = 0; hitType4 < 4; hitType4 += 1)
			{
				*(ref value.Items.FixedElementField + (IntPtr)hitType4 * 4) = DomainManager.SpecialEffect.ModifyData(this._id, -1, (ushort)(32 + hitType4), *(ref value.Items.FixedElementField + (IntPtr)hitType4 * 4), -1, -1, -1);
			}
			bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
			if (canAffectedByCombatDifficulty)
			{
				byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
				short factor = CombatDifficulty.Instance[combatDifficulty].HitValues;
				for (int j = 0; j < 4; j++)
				{
					*(ref value.Items.FixedElementField + (IntPtr)j * 4) = *(ref value.Items.FixedElementField + (IntPtr)j * 4) * (int)factor / 100;
				}
			}
			for (int k = 0; k < 4; k++)
			{
				bool flag5 = *(ref value.Items.FixedElementField + (IntPtr)k * 4) < (int)GlobalConfig.Instance.MinValueOfAttackAndDefenseAttributes;
				if (flag5)
				{
					*(ref value.Items.FixedElementField + (IntPtr)k * 4) = (int)GlobalConfig.Instance.MinValueOfAttackAndDefenseAttributes;
				}
			}
			return value;
		}

		// Token: 0x06006BEB RID: 27627 RVA: 0x003C8610 File Offset: 0x003C6810
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			80,
			112,
			115,
			28
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			44,
			45,
			238,
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			245
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			46,
			47,
			246
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(8, new ushort[]
		{
			19
		}, Scope = InfluenceScope.AllCharsInCombat)]
		private OuterAndInnerInts CalcPenetrations()
		{
			CharacterItem template = Character.Instance[this._templateId];
			OuterAndInnerInts value = template.BasePenetrations;
			CValueModify modifyOuter = this.CalcPropertyModify(ECharacterPropertyReferencedType.PenetrateOfOuter, EDataSumType.All);
			modifyOuter += DomainManager.SpecialEffect.GetModify(this._id, 44, -1, -1, -1, EDataSumType.All);
			value.Outer *= modifyOuter;
			CValueModify modifyInner = this.CalcPropertyModify(ECharacterPropertyReferencedType.PenetrateOfInner, EDataSumType.All);
			modifyInner += DomainManager.SpecialEffect.GetModify(this._id, 45, -1, -1, -1, EDataSumType.All);
			value.Inner *= modifyInner;
			value.Outer = DomainManager.SpecialEffect.ModifyData(this._id, -1, 44, value.Outer, -1, -1, -1);
			value.Inner = DomainManager.SpecialEffect.ModifyData(this._id, -1, 45, value.Inner, -1, -1, -1);
			bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
			if (canAffectedByCombatDifficulty)
			{
				byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
				short factor = CombatDifficulty.Instance[combatDifficulty].Penetrations;
				value.Outer = value.Outer * (int)factor / 100;
				value.Inner = value.Inner * (int)factor / 100;
			}
			bool flag = value.Outer < (int)GlobalConfig.Instance.MinValueOfAttackAndDefenseAttributes;
			if (flag)
			{
				value.Outer = (int)GlobalConfig.Instance.MinValueOfAttackAndDefenseAttributes;
			}
			bool flag2 = value.Inner < (int)GlobalConfig.Instance.MinValueOfAttackAndDefenseAttributes;
			if (flag2)
			{
				value.Inner = (int)GlobalConfig.Instance.MinValueOfAttackAndDefenseAttributes;
			}
			return value;
		}

		// Token: 0x06006BEC RID: 27628 RVA: 0x003C8798 File Offset: 0x003C6998
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			80,
			112,
			115,
			28
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			38,
			39,
			40,
			41,
			42,
			43,
			237,
			278,
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			245
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			46,
			47,
			246,
			123
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(8, new ushort[]
		{
			19
		}, Scope = InfluenceScope.AllCharsInCombat)]
		private unsafe HitOrAvoidInts CalcAvoidValues()
		{
			HitOrAvoidInts value = this.Template.BaseAvoidValues;
			BoolArray8 canAdd = default(BoolArray8);
			BoolArray8 canReduce = default(BoolArray8);
			Span<int> span = new Span<int>(stackalloc byte[(UIntPtr)16], 4);
			Span<int> addEffectBonus = span;
			span = new Span<int>(stackalloc byte[(UIntPtr)16], 4);
			Span<int> reduceEffectBonus = span;
			for (int hitType = 0; hitType < 4; hitType++)
			{
				canAdd[hitType] = DomainManager.SpecialEffect.ModifyData(this._id, -1, 42, true, hitType, 0, -1);
				canReduce[hitType] = DomainManager.SpecialEffect.ModifyData(this._id, -1, 42, true, hitType, 1, -1);
				*addEffectBonus[hitType] = DomainManager.SpecialEffect.GetModifyValue(this._id, 43, EDataModifyType.Add, hitType, 0, -1, EDataSumType.All);
				*reduceEffectBonus[hitType] = DomainManager.SpecialEffect.GetModifyValue(this._id, 43, EDataModifyType.Add, hitType, 1, -1, EDataSumType.All);
			}
			for (int i = 0; i < 4; i++)
			{
				ECharacterPropertyReferencedType propertyType = ECharacterPropertyReferencedType.AvoidRateStrength + i;
				EDataSumType sumType = DataSumTypeHelper.CalcSumType(canAdd[i], canReduce[i]);
				CValueModify modify = this.CalcPropertyModify(propertyType, sumType);
				ushort fieldId = (ushort)(38 + i);
				bool flag = canAdd[i];
				if (flag)
				{
					modify += DomainManager.SpecialEffect.GetModify(this._id, fieldId, -1, -1, -1, EDataSumType.OnlyAdd) * *addEffectBonus[i];
				}
				bool flag2 = canReduce[i];
				if (flag2)
				{
					modify += DomainManager.SpecialEffect.GetModify(this._id, fieldId, -1, -1, -1, EDataSumType.OnlyReduce) * *reduceEffectBonus[i];
				}
				ref HitOrAvoidInts ptr = ref value;
				int index = i;
				ptr[index] *= modify;
			}
			span = new Span<int>(stackalloc byte[(UIntPtr)16], 4);
			Span<int> tempValueAdd = span;
			tempValueAdd.Fill(0);
			for (sbyte hitType2 = 0; hitType2 < 4; hitType2 += 1)
			{
				int addValue = DomainManager.SpecialEffect.GetModifyValue(this._id, 278, EDataModifyType.Add, (int)hitType2, *(ref value.Items.FixedElementField + (IntPtr)hitType2 * 4), -1, EDataSumType.All);
				for (sbyte type = 0; type < 4; type += 1)
				{
					bool flag3 = type != hitType2;
					if (flag3)
					{
						*tempValueAdd[(int)type] += addValue;
					}
				}
			}
			for (sbyte hitType3 = 0; hitType3 < 4; hitType3 += 1)
			{
				bool flag4 = canAdd[(int)hitType3];
				if (flag4)
				{
					*(ref value.Items.FixedElementField + (IntPtr)hitType3 * 4) += *tempValueAdd[(int)hitType3];
				}
			}
			for (sbyte hitType4 = 0; hitType4 < 4; hitType4 += 1)
			{
				*(ref value.Items.FixedElementField + (IntPtr)hitType4 * 4) = DomainManager.SpecialEffect.ModifyData(this._id, -1, (ushort)(38 + hitType4), *(ref value.Items.FixedElementField + (IntPtr)hitType4 * 4), -1, -1, -1);
			}
			bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
			if (canAffectedByCombatDifficulty)
			{
				byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
				short factor = CombatDifficulty.Instance[combatDifficulty].AvoidValues;
				for (int j = 0; j < 4; j++)
				{
					*(ref value.Items.FixedElementField + (IntPtr)j * 4) = *(ref value.Items.FixedElementField + (IntPtr)j * 4) * (int)factor / 100;
				}
			}
			for (int k = 0; k < 4; k++)
			{
				bool flag5 = *(ref value.Items.FixedElementField + (IntPtr)k * 4) < (int)GlobalConfig.Instance.MinValueOfAttackAndDefenseAttributes;
				if (flag5)
				{
					*(ref value.Items.FixedElementField + (IntPtr)k * 4) = (int)GlobalConfig.Instance.MinValueOfAttackAndDefenseAttributes;
				}
			}
			return value;
		}

		// Token: 0x06006BED RID: 27629 RVA: 0x003C8B84 File Offset: 0x003C6D84
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			80,
			112,
			115,
			28
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			46,
			47,
			239,
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			245
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			46,
			47,
			246
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(8, new ushort[]
		{
			19
		}, Scope = InfluenceScope.AllCharsInCombat)]
		[ObjectCollectionDependency(8, 10, new ushort[]
		{
			46
		}, Scope = InfluenceScope.CharOfTheCombatChar)]
		private unsafe OuterAndInnerInts CalcPenetrationResists()
		{
			OuterAndInnerInts value = this.Template.BasePenetrationResists;
			CValueModify modifyOuter = this.CalcPropertyModify(ECharacterPropertyReferencedType.PenetrateResistOfOuter, EDataSumType.All);
			modifyOuter += DomainManager.SpecialEffect.GetModify(this._id, 46, -1, -1, -1, EDataSumType.All);
			value.Outer *= modifyOuter;
			CValueModify modifyInner = this.CalcPropertyModify(ECharacterPropertyReferencedType.PenetrateResistOfInner, EDataSumType.All);
			modifyInner += DomainManager.SpecialEffect.GetModify(this._id, 47, -1, -1, -1, EDataSumType.All);
			value.Inner *= modifyInner;
			bool flag = DomainManager.Combat.IsCharInCombat(this._id, true);
			if (flag)
			{
				CombatCharacter combatChar = DomainManager.Combat.GetElement_CombatCharacterDict(this._id);
				PoisonInts poisons = *combatChar.GetPoison();
				CValuePercentBonus outerBonus = 0;
				CValuePercentBonus innerBonus = 0;
				sbyte rottenLevel = PoisonsAndLevels.CalcPoisonedLevel(*poisons[4]);
				bool flag2 = rottenLevel > 0;
				if (flag2)
				{
					outerBonus = (int)((short)(-(short)rottenLevel) * Poison.Instance[4].ReduceOuterResist);
				}
				sbyte illusoryLevel = PoisonsAndLevels.CalcPoisonedLevel(*poisons[5]);
				bool flag3 = illusoryLevel > 0;
				if (flag3)
				{
					innerBonus = (int)((short)(-(short)illusoryLevel) * Poison.Instance[5].ReduceInnerResist);
				}
				value.Outer *= outerBonus;
				value.Inner *= innerBonus;
			}
			value.Outer = DomainManager.SpecialEffect.ModifyData(this._id, -1, 46, value.Outer, -1, -1, -1);
			value.Inner = DomainManager.SpecialEffect.ModifyData(this._id, -1, 47, value.Inner, -1, -1, -1);
			bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
			if (canAffectedByCombatDifficulty)
			{
				byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
				short factor = CombatDifficulty.Instance[combatDifficulty].PenetrationResists;
				value.Outer = value.Outer * (int)factor / 100;
				value.Inner = value.Inner * (int)factor / 100;
			}
			bool flag4 = value.Outer < (int)GlobalConfig.Instance.MinValueOfAttackAndDefenseAttributes;
			if (flag4)
			{
				value.Outer = (int)GlobalConfig.Instance.MinValueOfAttackAndDefenseAttributes;
			}
			bool flag5 = value.Inner < (int)GlobalConfig.Instance.MinValueOfAttackAndDefenseAttributes;
			if (flag5)
			{
				value.Inner = (int)GlobalConfig.Instance.MinValueOfAttackAndDefenseAttributes;
			}
			return value;
		}

		// Token: 0x06006BEE RID: 27630 RVA: 0x003C8DD8 File Offset: 0x003C6FD8
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			112,
			115
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			7,
			8,
			17,
			18,
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueDependency(19, new ushort[]
		{
			46
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			47
		}, Scope = InfluenceScope.TaiwuChar)]
		private OuterAndInnerShorts CalcRecoveryOfStanceAndBreath()
		{
			short fixValue;
			bool flag = this.TryGetFixedSubAttributeValue(out fixValue);
			OuterAndInnerShorts result;
			if (flag)
			{
				result = new OuterAndInnerShorts(fixValue, fixValue);
			}
			else
			{
				OuterAndInnerInts value = this.Template.BaseRecoveryOfStanceAndBreath;
				CValueModify modifyOuter = this.CalcPropertyModify(ECharacterPropertyReferencedType.RecoveryOfStance, EDataSumType.All);
				modifyOuter = (modifyOuter + DomainManager.SpecialEffect.GetModify(this._id, 7, -1, -1, -1, EDataSumType.All)).MaxA(value.Outer, (int)GlobalConfig.Instance.MinAValueOfMinorAttributes);
				value.Outer *= modifyOuter;
				CValueModify modifyInner = this.CalcPropertyModify(ECharacterPropertyReferencedType.RecoveryOfBreath, EDataSumType.All);
				modifyInner = (modifyInner + DomainManager.SpecialEffect.GetModify(this._id, 8, -1, -1, -1, EDataSumType.All)).MaxA(value.Inner, (int)GlobalConfig.Instance.MinAValueOfMinorAttributes);
				value.Inner *= modifyInner;
				value.Outer = (int)((short)DomainManager.SpecialEffect.ModifyData(this._id, -1, 7, value.Outer, -1, -1, -1));
				value.Inner = (int)((short)DomainManager.SpecialEffect.ModifyData(this._id, -1, 8, value.Inner, -1, -1, -1));
				bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
				if (canAffectedByCombatDifficulty)
				{
					byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
					OuterAndInnerShorts factor = CombatDifficulty.Instance[combatDifficulty].RecoveryOfStanceAndBreath;
					value.Outer = (int)((short)(value.Outer * (int)factor.Outer / 100));
					value.Inner = (int)((short)(value.Inner * (int)factor.Inner / 100));
				}
				value.Outer = Math.Clamp(value.Outer, 0, 1000);
				value.Inner = Math.Clamp(value.Inner, 0, 1000);
				result = (OuterAndInnerShorts)value;
			}
			return result;
		}

		// Token: 0x06006BEF RID: 27631 RVA: 0x003C8F90 File Offset: 0x003C7190
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			112,
			115,
			107,
			106
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(8, 10, new ushort[]
		{
			62
		}, Scope = InfluenceScope.CharOfTheCombatChar)]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			9,
			55,
			17,
			18,
			279,
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueDependency(19, new ushort[]
		{
			46
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			47
		}, Scope = InfluenceScope.TaiwuChar)]
		private short CalcMoveSpeed()
		{
			short fixValue;
			bool flag = this.TryGetFixedSubAttributeValue(out fixValue);
			short result;
			if (flag)
			{
				result = fixValue;
			}
			else
			{
				int value = (int)this.Template.BaseMoveSpeed;
				bool canAdd = DomainManager.SpecialEffect.ModifyData(this._id, -1, 55, true, 0, -1, -1);
				bool canReduce = DomainManager.SpecialEffect.ModifyData(this._id, -1, 55, true, 1, -1, -1);
				EDataSumType sumType = DataSumTypeHelper.CalcSumType(canAdd, canReduce);
				CValueModify modify = this.CalcPropertyModify(ECharacterPropertyReferencedType.MoveSpeed, sumType);
				modify += DomainManager.SpecialEffect.GetModify(this._id, 9, -1, -1, -1, sumType);
				bool flag2 = DomainManager.Combat.IsCharInCombat(this._id, true) && canAdd;
				if (flag2)
				{
					CombatCharacter combatChar = DomainManager.Combat.GetElement_CombatCharacterDict(this._id);
					short agileSkillId = combatChar.GetAffectingMoveSkillId();
					bool flag3 = agileSkillId >= 0;
					if (flag3)
					{
						GameData.Domains.CombatSkill.CombatSkill skill = DomainManager.CombatSkill.GetElement_CombatSkills(new CombatSkillKey(this._id, agileSkillId));
						modify = modify.ChangeA((int)CombatSkillDomain.CalcCastAddMoveSpeed(skill, (int)skill.GetPower())).ChangeB((int)CombatSkillDomain.CalcCastAddPercentMoveSpeed(skill, (int)skill.GetPower()));
					}
				}
				modify = modify.MaxA(value, (int)GlobalConfig.Instance.MinAValueOfMinorAttributes);
				value *= modify;
				value = this.CalcOverloadBonus(value, GlobalConfig.Instance.EquipLoadSpeedPercent);
				value = DomainManager.SpecialEffect.ModifyData(this._id, -1, 9, value, -1, -1, -1);
				bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
				if (canAffectedByCombatDifficulty)
				{
					byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
					short factor = CombatDifficulty.Instance[combatDifficulty].MoveSpeed;
					value = value * (int)factor / 100;
				}
				result = (short)Math.Clamp(value, 0, 1000);
			}
			return result;
		}

		// Token: 0x06006BF0 RID: 27632 RVA: 0x003C914C File Offset: 0x003C734C
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			112,
			115,
			107,
			106
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			10,
			17,
			18,
			293,
			279
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueDependency(19, new ushort[]
		{
			46
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			47
		}, Scope = InfluenceScope.TaiwuChar)]
		private short CalcRecoveryOfFlaw()
		{
			short fixValue;
			bool flag = this.TryGetFixedSubAttributeValue(out fixValue);
			short result;
			if (flag)
			{
				result = fixValue;
			}
			else
			{
				int value = (int)this.Template.BaseRecoveryOfFlaw;
				CValueModify modify = this.CalcPropertyModify(ECharacterPropertyReferencedType.RecoveryOfFlaw, EDataSumType.All);
				modify = (modify + DomainManager.SpecialEffect.GetModify(this._id, 10, -1, -1, -1, EDataSumType.All)).MaxA(value, (int)GlobalConfig.Instance.MinAValueOfMinorAttributes);
				value *= modify;
				value = this.CalcOverloadBonus(value, GlobalConfig.Instance.EquipHealSpeedPercent);
				value = DomainManager.SpecialEffect.ModifyData(this._id, -1, 10, value, -1, -1, -1);
				bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
				if (canAffectedByCombatDifficulty)
				{
					byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
					short factor = CombatDifficulty.Instance[combatDifficulty].RecoveryOfFlaw;
					value = value * (int)factor / 100;
				}
				result = (short)Math.Clamp(value, 0, 1000);
			}
			return result;
		}

		// Token: 0x06006BF1 RID: 27633 RVA: 0x003C9230 File Offset: 0x003C7430
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			112,
			115,
			107,
			106
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			11,
			279,
			17,
			18,
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueDependency(19, new ushort[]
		{
			46
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			47
		}, Scope = InfluenceScope.TaiwuChar)]
		private short CalcCastSpeed()
		{
			short fixValue;
			bool flag = this.TryGetFixedSubAttributeValue(out fixValue);
			short result;
			if (flag)
			{
				result = fixValue;
			}
			else
			{
				int value = (int)this.Template.BaseCastSpeed;
				CValueModify modify = this.CalcPropertyModify(ECharacterPropertyReferencedType.CastSpeed, EDataSumType.All);
				modify = (modify + DomainManager.SpecialEffect.GetModify(this._id, 11, -1, -1, -1, EDataSumType.All)).MaxA(value, (int)GlobalConfig.Instance.MinAValueOfMinorAttributes);
				value *= modify;
				value = this.CalcOverloadBonus(value, GlobalConfig.Instance.EquipLoadSpeedPercent);
				value = DomainManager.SpecialEffect.ModifyData(this._id, -1, 11, value, -1, -1, -1);
				bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
				if (canAffectedByCombatDifficulty)
				{
					byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
					short factor = CombatDifficulty.Instance[combatDifficulty].CastSpeed;
					value = value * (int)factor / 100;
				}
				result = (short)Math.Clamp(value, 0, 1000);
			}
			return result;
		}

		// Token: 0x06006BF2 RID: 27634 RVA: 0x003C9314 File Offset: 0x003C7514
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			112,
			115,
			107,
			106
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			12,
			17,
			18,
			293,
			279
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueDependency(19, new ushort[]
		{
			46
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			47
		}, Scope = InfluenceScope.TaiwuChar)]
		private short CalcRecoveryOfBlockedAcupoint()
		{
			short fixValue;
			bool flag = this.TryGetFixedSubAttributeValue(out fixValue);
			short result;
			if (flag)
			{
				result = fixValue;
			}
			else
			{
				int value = (int)this.Template.BaseRecoveryOfBlockedAcupoint;
				CValueModify modify = this.CalcPropertyModify(ECharacterPropertyReferencedType.RecoveryOfBlockedAcupoint, EDataSumType.All);
				modify = (modify + DomainManager.SpecialEffect.GetModify(this._id, 12, -1, -1, -1, EDataSumType.All)).MaxA(value, (int)GlobalConfig.Instance.MinAValueOfMinorAttributes);
				value *= modify;
				value = this.CalcOverloadBonus(value, GlobalConfig.Instance.EquipHealSpeedPercent);
				value = DomainManager.SpecialEffect.ModifyData(this._id, -1, 12, value, -1, -1, -1);
				bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
				if (canAffectedByCombatDifficulty)
				{
					byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
					short factor = CombatDifficulty.Instance[combatDifficulty].RecoveryOfBlockedAcupoint;
					value = value * (int)factor / 100;
				}
				result = (short)Math.Clamp(value, 0, 1000);
			}
			return result;
		}

		// Token: 0x06006BF3 RID: 27635 RVA: 0x003C93F8 File Offset: 0x003C75F8
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			112,
			115,
			107,
			106
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			13,
			17,
			18,
			293,
			279
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueDependency(19, new ushort[]
		{
			46
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			47
		}, Scope = InfluenceScope.TaiwuChar)]
		private short CalcWeaponSwitchSpeed()
		{
			short fixValue;
			bool flag = this.TryGetFixedSubAttributeValue(out fixValue);
			short result;
			if (flag)
			{
				result = fixValue;
			}
			else
			{
				int value = (int)this.Template.BaseWeaponSwitchSpeed;
				CValueModify modify = this.CalcPropertyModify(ECharacterPropertyReferencedType.WeaponSwitchSpeed, EDataSumType.All);
				modify = (modify + DomainManager.SpecialEffect.GetModify(this._id, 13, -1, -1, -1, EDataSumType.All)).MaxA(value, (int)GlobalConfig.Instance.MinAValueOfMinorAttributes);
				value *= modify;
				value = this.CalcOverloadBonus(value, GlobalConfig.Instance.EquipHealSpeedPercent);
				value = DomainManager.SpecialEffect.ModifyData(this._id, -1, 13, value, -1, -1, -1);
				bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
				if (canAffectedByCombatDifficulty)
				{
					byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
					short factor = CombatDifficulty.Instance[combatDifficulty].WeaponSwitchSpeed;
					value = value * (int)factor / 100;
				}
				result = (short)Math.Clamp(value, 0, 1000);
			}
			return result;
		}

		// Token: 0x06006BF4 RID: 27636 RVA: 0x003C94DC File Offset: 0x003C76DC
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			112,
			115,
			107,
			106
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			14,
			279,
			17,
			18,
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueDependency(19, new ushort[]
		{
			46
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			47
		}, Scope = InfluenceScope.TaiwuChar)]
		private short CalcAttackSpeed()
		{
			short fixValue;
			bool flag = this.TryGetFixedSubAttributeValue(out fixValue);
			short result;
			if (flag)
			{
				result = fixValue;
			}
			else
			{
				int value = (int)this.Template.BaseAttackSpeed;
				CValueModify modify = this.CalcPropertyModify(ECharacterPropertyReferencedType.AttackSpeed, EDataSumType.All);
				modify = (modify + DomainManager.SpecialEffect.GetModify(this._id, 14, -1, -1, -1, EDataSumType.All)).MaxA(value, (int)GlobalConfig.Instance.MinAValueOfMinorAttributes);
				value *= modify;
				value = this.CalcOverloadBonus(value, GlobalConfig.Instance.EquipLoadSpeedPercent);
				value = DomainManager.SpecialEffect.ModifyData(this._id, -1, 14, value, -1, -1, -1);
				bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
				if (canAffectedByCombatDifficulty)
				{
					byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
					short factor = CombatDifficulty.Instance[combatDifficulty].AttackSpeed;
					value = value * (int)factor / 100;
				}
				result = (short)Math.Clamp(value, 0, 1000);
			}
			return result;
		}

		// Token: 0x06006BF5 RID: 27637 RVA: 0x003C95C0 File Offset: 0x003C77C0
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			112,
			115
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			15,
			17,
			18,
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			245
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			46,
			47,
			246
		}, Scope = InfluenceScope.TaiwuChar)]
		private short CalcInnerRatio()
		{
			short fixValue;
			bool flag = this.TryGetFixedSubAttributeValue(out fixValue);
			short result;
			if (flag)
			{
				result = fixValue;
			}
			else
			{
				int value = (int)this.Template.BaseInnerRatio;
				CValueModify modify = this.CalcPropertyModify(ECharacterPropertyReferencedType.InnerRatio, EDataSumType.All);
				modify = (modify + DomainManager.SpecialEffect.GetModify(this._id, 15, -1, -1, -1, EDataSumType.All)).MaxA(value, (int)GlobalConfig.Instance.MinAValueOfMinorAttributes);
				value *= modify;
				value = DomainManager.SpecialEffect.ModifyData(this._id, -1, 15, value, -1, -1, -1);
				bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
				if (canAffectedByCombatDifficulty)
				{
					byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
					short factor = CombatDifficulty.Instance[combatDifficulty].InnerRatio;
					value = value * (int)factor / 100;
				}
				result = (short)Math.Clamp(value, 0, 1000);
			}
			return result;
		}

		// Token: 0x06006BF6 RID: 27638 RVA: 0x003C9690 File Offset: 0x003C7890
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			112,
			115,
			56,
			68
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(1, new ushort[]
		{
			15
		})]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			16,
			17,
			18,
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			245
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueDependency(19, new ushort[]
		{
			46,
			47,
			246
		}, Scope = InfluenceScope.TaiwuChar)]
		private short CalcRecoveryOfQiDisorder()
		{
			short fixValue;
			bool flag = this.TryGetFixedSubAttributeValue(out fixValue);
			short result;
			if (flag)
			{
				result = fixValue;
			}
			else
			{
				int value = (int)this.Template.BaseRecoveryOfQiDisorder;
				CValueModify modify = this.CalcPropertyModify(ECharacterPropertyReferencedType.RecoveryOfQiDisorder, EDataSumType.All);
				modify = (modify + DomainManager.SpecialEffect.GetModify(this._id, 16, -1, -1, -1, EDataSumType.All)).MaxA(value, (int)GlobalConfig.Instance.MinAValueOfMinorAttributes);
				value *= modify;
				bool flag2 = this.IsActiveExternalRelationState(32) && DomainManager.Organization.GetPrisonerSect(this._id) == 4;
				if (flag2)
				{
					value /= 2;
				}
				value = DomainManager.SpecialEffect.ModifyData(this._id, -1, 16, value, -1, -1, -1);
				bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
				if (canAffectedByCombatDifficulty)
				{
					byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
					short factor = CombatDifficulty.Instance[combatDifficulty].RecoveryOfQiDisorder;
					value = value * (int)factor / 100;
				}
				result = (short)Math.Clamp(value, 0, 1000);
			}
			return result;
		}

		// Token: 0x06006BF7 RID: 27639 RVA: 0x003C978C File Offset: 0x003C798C
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			61,
			112,
			115,
			21
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			3,
			5,
			1,
			10
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(5, new ushort[]
		{
			20
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(5, 16, 9, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			150
		}, Scope = InfluenceScope.TaiwuChar)]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			19,
			20,
			21,
			22,
			23,
			24,
			245
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		private unsafe PoisonInts CalcPoisonResists()
		{
			CharacterItem template = Character.Instance[this._templateId];
			PoisonInts value = template.BasePoisonResists;
			CValueModify allModify = DomainManager.SpecialEffect.GetModify(this._id, 245, -1, -1, -1, EDataSumType.All);
			sbyte disorderLevelOfQi = DisorderLevelOfQi.GetDisorderLevelOfQi(this._disorderOfQi);
			allModify = allModify.ChangeC(QiDisorderEffect.Instance[disorderLevelOfQi].PoisonResistChange);
			for (int i = 0; i < 6; i++)
			{
				ECharacterPropertyReferencedType propertyType = ECharacterPropertyReferencedType.ResistOfHotPoison + i;
				ushort fieldId = (ushort)(19 + i);
				CValueModify modify = this.CalcPropertyModify(propertyType, EDataSumType.All);
				modify += DomainManager.SpecialEffect.GetModify(this._id, fieldId, -1, -1, -1, EDataSumType.All);
				modify = (modify + allModify).ReverseByValue(*value[i]);
				*value[i] *= modify;
			}
			return value;
		}

		// Token: 0x06006BF8 RID: 27640 RVA: 0x003C9878 File Offset: 0x003C7A78
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			20
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			53
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			245,
			150
		}, Scope = InfluenceScope.TaiwuChar)]
		private short CalcMaxHealth()
		{
			int value = (int)this._baseMaxHealth * this.CalcPropertyModify(ECharacterPropertyReferencedType.MaxHealth, EDataSumType.All);
			value += DomainManager.SpecialEffect.GetModifyValue(this._id, 53, EDataModifyType.Add, -1, -1, -1, EDataSumType.All);
			bool flag = this.IsTaiwu();
			if (flag)
			{
				value += (int)ProfessionSkillHandle.TravelingTaoistMonkSkill_GetMaxHealthBonus();
			}
			return (short)Math.Clamp(value, 0, 32767);
		}

		// Token: 0x06006BF9 RID: 27641 RVA: 0x003C98D8 File Offset: 0x003C7AD8
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			76,
			44,
			94,
			59,
			61
		}, Scope = InfluenceScope.Self)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			121
		}, Scope = InfluenceScope.TaiwuChar)]
		private short CalcFertility()
		{
			int value = 100;
			value *= this.CalcPropertyModify(ECharacterPropertyReferencedType.Fertility, EDataSumType.All);
			short physiologicalAge = this.GetPhysiologicalAge();
			short clampedAge = Character.GetClampedAgeOfAgeEffect(physiologicalAge);
			AgeEffectItem ageEffectCfg = AgeEffect.Instance[(int)clampedAge];
			value += (int)((this._gender == 1) ? ageEffectCfg.FertilityMale : ageEffectCfg.FertilityFemale);
			value -= this.GetMixedPoisonTypeRelatedMarkCount(25) * 30;
			return (short)Math.Clamp(value, 0, 32767);
		}

		// Token: 0x06006BFA RID: 27642 RVA: 0x003C9950 File Offset: 0x003C7B50
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			30,
			31,
			63,
			4
		}, Scope = InfluenceScope.Self)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(9, new ushort[]
		{
			18
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			150
		}, Scope = InfluenceScope.TaiwuChar)]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		private unsafe LifeSkillShorts CalcLifeSkillQualifications()
		{
			LifeSkillShorts value = this._baseLifeSkillQualifications;
			short clampedAge = Character.GetClampedAgeOfAgeEffect(this._actualAge);
			for (int i = 0; i < 16; i++)
			{
				ECharacterPropertyReferencedType propertyType = ECharacterPropertyReferencedType.QualificationMusic + i;
				CValueModify modify = this.CalcPropertyModify(propertyType, EDataSumType.All);
				int tempValue = (int)(*value[i]) * modify;
				bool flag = clampedAge < 16;
				if (flag)
				{
					tempValue = tempValue * (int)clampedAge / 16;
				}
				*value[i] = (short)Math.Clamp(tempValue, 0, 32767);
			}
			return value;
		}

		// Token: 0x06006BFB RID: 27643 RVA: 0x003C99DC File Offset: 0x003C7BDC
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			29,
			97,
			56,
			8
		}, Scope = InfluenceScope.Self)]
		private LifeSkillShorts CalcLifeSkillAttainments()
		{
			LifeSkillShorts value = default(LifeSkillShorts);
			value.Initialize();
			this.GetLifeSkillBaseAttainment(ref value);
			this.GetLifeSkillAttainmentAddOns(ref value);
			return value;
		}

		// Token: 0x06006BFC RID: 27644 RVA: 0x003C9A14 File Offset: 0x003C7C14
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			32,
			33,
			63,
			4
		}, Scope = InfluenceScope.Self)]
		[SingleValueDependency(5, new ushort[]
		{
			0
		})]
		[SingleValueDependency(9, new ushort[]
		{
			17
		}, Scope = InfluenceScope.TaiwuChar)]
		[ElementListDependency(11, 0, 14)]
		[SingleValueDependency(19, new ushort[]
		{
			46,
			47
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			150
		}, Scope = InfluenceScope.TaiwuChar)]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			293
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		private unsafe CombatSkillShorts CalcCombatSkillQualifications()
		{
			CombatSkillShorts value = this._baseCombatSkillQualifications;
			short clampedAge = Character.GetClampedAgeOfAgeEffect(this._actualAge);
			for (int i = 0; i < 14; i++)
			{
				ECharacterPropertyReferencedType propertyType = ECharacterPropertyReferencedType.QualificationNeigong + i;
				CValueModify modify = this.CalcPropertyModify(propertyType, EDataSumType.All);
				int tempValue = (int)(*value[i]) * modify;
				bool flag = clampedAge < 16;
				if (flag)
				{
					tempValue = tempValue * (int)clampedAge / 16;
				}
				*value[i] = (short)Math.Clamp(tempValue, 0, 32767);
			}
			return value;
		}

		// Token: 0x06006BFD RID: 27645 RVA: 0x003C9AA0 File Offset: 0x003C7CA0
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			62,
			99,
			8
		}, Scope = InfluenceScope.Self)]
		private unsafe CombatSkillShorts CalcCombatSkillAttainments()
		{
			CombatSkillShorts value = default(CombatSkillShorts);
			value.Initialize();
			CombatSkillShorts bonuses = default(CombatSkillShorts);
			bonuses.Initialize();
			for (int skillType = 0; skillType < 14; skillType++)
			{
				for (int grade = 0; grade < 9; grade++)
				{
					int offset = 9 * skillType + grade;
					short skillTemplateId = this._combatSkillAttainmentPanels[offset];
					bool flag = skillTemplateId < 0;
					if (!flag)
					{
						CombatSkillItem skillConfig = Config.CombatSkill.Instance[skillTemplateId];
						ref short ptr = ref value.Items.FixedElementField + (IntPtr)skillType * 2;
						ptr += (short)GlobalConfig.Instance.AddAttainmentPerGrade[(int)skillConfig.Grade];
					}
				}
			}
			ref CombatSkillShorts qualifications = ref this.GetCombatSkillQualifications();
			for (int i = 0; i < 14; i++)
			{
				*(ref value.Items.FixedElementField + (IntPtr)i * 2) = *(ref qualifications.Items.FixedElementField + (IntPtr)i * 2) * (100 + *(ref value.Items.FixedElementField + (IntPtr)i * 2)) / 100 + *(ref value.Items.FixedElementField + (IntPtr)i * 2);
			}
			for (int j = 0; j < 14; j++)
			{
				int currValue = (int)(*(ref value.Items.FixedElementField + (IntPtr)j * 2) + *(ref bonuses.Items.FixedElementField + (IntPtr)j * 2));
				*(ref value.Items.FixedElementField + (IntPtr)j * 2) = (short)((currValue >= 0) ? currValue : 0);
			}
			return value;
		}

		// Token: 0x06006BFE RID: 27646 RVA: 0x003C9C30 File Offset: 0x003C7E30
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17,
			57,
			59,
			56,
			8
		}, Scope = InfluenceScope.Self)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			224
		}, Scope = InfluenceScope.AllCharsInTaiwuVillage)]
		[SingleValueCollectionDependency(9, new ushort[]
		{
			8
		}, Scope = InfluenceScope.AllCharsInTaiwuVillage)]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			303
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		private unsafe Personalities CalcPersonalities()
		{
			Personalities value = default(Personalities);
			CValueModify allModify = DomainManager.SpecialEffect.GetModify(this._id, 303, -1, -1, -1, EDataSumType.All);
			for (int i = 0; i < 7; i++)
			{
				ECharacterPropertyReferencedType propertyType = ECharacterPropertyReferencedType.PersonalityCalm + i;
				CValueModify modify = this.CalcPropertyModify(propertyType, EDataSumType.All) + allModify;
				int personality = 10 * modify;
				*value[i] = (sbyte)Math.Clamp(personality, 0, 100);
			}
			return value;
		}

		// Token: 0x06006BFF RID: 27647 RVA: 0x003C9CB0 File Offset: 0x003C7EB0
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17
		}, Scope = InfluenceScope.Self)]
		private sbyte CalcHobbyChangingPeriod()
		{
			int value = (int)GlobalConfig.Instance.BaseHobbyChangingPeriod;
			value *= this.CalcPropertyModify(ECharacterPropertyReferencedType.HobbyChangingPeriod, EDataSumType.All);
			return (sbyte)((value >= 1) ? value : 1);
		}

		// Token: 0x06006C00 RID: 27648 RVA: 0x003C9CE8 File Offset: 0x003C7EE8
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			17
		}, Scope = InfluenceScope.Self)]
		private OuterAndInnerShorts CalcFavorabilityChangingFactor()
		{
			OuterAndInnerShorts value = new OuterAndInnerShorts(100, 100);
			int i = 0;
			int count = this._featureIds.Count;
			while (i < count)
			{
				short featureId = this._featureIds[i];
				CharacterFeatureItem config = CharacterFeature.Instance[featureId];
				value.Outer = value.Outer * config.FavorabilityIncrementFactor / 100;
				value.Inner = value.Inner * config.FavorabilityDecrementFactor / 100;
				i++;
			}
			return value;
		}

		// Token: 0x06006C01 RID: 27649 RVA: 0x003C9D74 File Offset: 0x003C7F74
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			57
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(6, 4, new ushort[]
		{
			4
		}, Scope = InfluenceScope.CharWhoEquippedTheItem, Condition = InfluenceCondition.ItemIsEquipped)]
		private int CalcMaxInventoryLoad()
		{
			int value = 3000;
			ItemKey itemKey = this._equipment[11];
			bool flag = itemKey.IsValid();
			if (flag)
			{
				GameData.Domains.Item.Carrier equipment = DomainManager.Item.GetElement_Carriers(itemKey.Id);
				bool flag2 = equipment.GetMaxDurability() == 0 || equipment.GetCurrDurability() > 0;
				if (flag2)
				{
					value += (int)equipment.GetMaxInventoryLoadBonus();
				}
			}
			for (sbyte i = 8; i <= 10; i += 1)
			{
				ItemKey itemKey2 = this._equipment[(int)i];
				bool flag3 = itemKey2.IsValid();
				if (flag3)
				{
					EquipmentBase equipment2 = DomainManager.Item.GetBaseEquipment(itemKey2);
					bool flag4 = equipment2.GetMaxDurability() == 0 || equipment2.GetCurrDurability() > 0;
					if (flag4)
					{
						AccessoryItem config = Config.Accessory.Instance[itemKey2.TemplateId];
						value += (int)config.MaxInventoryLoadBonus;
					}
				}
			}
			return value;
		}

		// Token: 0x06006C02 RID: 27650 RVA: 0x003C9E68 File Offset: 0x003C8068
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			58,
			57
		}, Scope = InfluenceScope.Self)]
		private int CalcCurrInventoryLoad()
		{
			int value = 0;
			foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
			{
				ItemKey itemKey3;
				int num;
				keyValuePair.Deconstruct(out itemKey3, out num);
				ItemKey itemKey = itemKey3;
				int amount = num;
				ItemBase item = DomainManager.Item.GetBaseItem(itemKey);
				value += item.GetWeight() * amount;
			}
			for (int i = 0; i < 11; i++)
			{
				ItemKey itemKey2 = this._equipment[i];
				bool flag = itemKey2.IsValid();
				if (flag)
				{
					ItemBase item2 = DomainManager.Item.GetBaseItem(itemKey2);
					value += item2.GetWeight();
				}
			}
			return value;
		}

		// Token: 0x06006C03 RID: 27651 RVA: 0x003C9F44 File Offset: 0x003C8144
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			80
		}, Scope = InfluenceScope.Self)]
		private int CalcMaxEquipmentLoad()
		{
			short maxStrength = this.GetMaxMainAttributes().Items.FixedElementField;
			int extraLoad = Character.Instance[this._templateId].ExtraEquipmentLoad;
			return GlobalConfig.Instance.EquipmentLoadBaseValue + (int)maxStrength * GlobalConfig.Instance.StrengthToEquipmentLoadFactor + extraLoad;
		}

		// Token: 0x06006C04 RID: 27652 RVA: 0x003C9F9C File Offset: 0x003C819C
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			57
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			311
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		private int CalcCurrEquipmentLoad()
		{
			int value = 0;
			for (sbyte i = 0; i <= 10; i += 1)
			{
				ItemKey itemKey = this._equipment[(int)i];
				bool flag = itemKey.IsValid();
				if (flag)
				{
					int weight = DomainManager.Item.GetBaseItem(itemKey).GetWeight();
					value += DomainManager.SpecialEffect.ModifyValue(this._id, 311, weight, itemKey.Id, (int)itemKey.ItemType, -1, 0, 0, 0, 0);
				}
			}
			return value;
		}

		// Token: 0x06006C05 RID: 27653 RVA: 0x003CA024 File Offset: 0x003C8224
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			58
		}, Scope = InfluenceScope.Self)]
		private int CalcInventoryTotalValue()
		{
			int totalValue = 0;
			foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
			{
				ItemKey itemKey2;
				int num;
				keyValuePair.Deconstruct(out itemKey2, out num);
				ItemKey itemKey = itemKey2;
				int itemAmount = num;
				bool flag = itemKey.ItemType == 10;
				if (!flag)
				{
					totalValue += DomainManager.Item.GetValue(itemKey) * itemAmount;
				}
			}
			return totalValue;
		}

		// Token: 0x06006C06 RID: 27654 RVA: 0x003CA0B8 File Offset: 0x003C82B8
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			27,
			60,
			48
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			8,
			7
		}, Scope = InfluenceScope.CombatSkillOwner)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			150
		}, Scope = InfluenceScope.TaiwuChar)]
		[SingleValueCollectionDependency(19, new ushort[]
		{
			254
		}, Scope = InfluenceScope.TaiwuAndGearMates)]
		private unsafe int CalcMaxNeili()
		{
			int value = this.GetPureMaxNeili();
			for (int type = 0; type < 4; type++)
			{
				value -= CombatHelper.CalcNeiliCostFromZero(*(ref this._baseNeiliAllocation.Items.FixedElementField + (IntPtr)type * 2));
			}
			return value;
		}

		// Token: 0x06006C07 RID: 27655 RVA: 0x003CA100 File Offset: 0x003C8300
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			48,
			49,
			1
		}, Scope = InfluenceScope.Self)]
		private unsafe NeiliAllocation CalcNeiliAllocation()
		{
			NeiliAllocation value = this._baseNeiliAllocation;
			for (int i = 0; i < 4; i++)
			{
				int currAllocation = (int)(*(ref value.Items.FixedElementField + (IntPtr)i * 2) + *(ref this._extraNeiliAllocation.Items.FixedElementField + (IntPtr)i * 2));
				*(ref value.Items.FixedElementField + (IntPtr)i * 2) = (short)((currAllocation >= 0) ? currAllocation : 0);
			}
			return value;
		}

		// Token: 0x06006C08 RID: 27656 RVA: 0x003CA174 File Offset: 0x003C8374
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			50
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(8, 10, new ushort[]
		{
			120
		}, Scope = InfluenceScope.CharOfTheCombatChar)]
		[SingleValueDependency(8, new ushort[]
		{
			19
		}, Scope = InfluenceScope.AllCharsInCombat)]
		[ObjectCollectionDependency(17, 2, new ushort[]
		{
			26
		}, Scope = InfluenceScope.CharacterAffectedByTheSpecialEffects)]
		private unsafe NeiliProportionOfFiveElements CalcNeiliProportionOfFiveElements()
		{
			NeiliProportionOfFiveElements proportions = this._baseNeiliProportionOfFiveElements;
			proportions = DomainManager.SpecialEffect.ModifyData(this._id, -1, 26, proportions, -1, -1, -1);
			bool flag = DomainManager.Combat.IsCharInCombat(this._id, true);
			if (flag)
			{
				CombatCharacter combatChar = DomainManager.Combat.GetElement_CombatCharacterDict(this._id);
				NeiliProportionOfFiveElements delta = combatChar.GetProportionDelta();
				Tester.Assert(delta.Sum() == 0, "delta.Sum() == 0");
				for (int i = 0; i < 5; i++)
				{
					ref sbyte ptr = ref proportions[i];
					ptr += *delta[i];
				}
			}
			Tester.Assert(proportions.SumCheck() == 100, "");
			return proportions;
		}

		// Token: 0x06006C09 RID: 27657 RVA: 0x003CA230 File Offset: 0x003C8430
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			111
		}, Scope = InfluenceScope.Self)]
		private sbyte CalcNeiliType()
		{
			return this.GetNeiliProportionOfFiveElements().GetNeiliType(this._birthMonth);
		}

		// Token: 0x06006C0A RID: 27658 RVA: 0x003CA254 File Offset: 0x003C8454
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			110
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(8, 10, new ushort[]
		{
			3
		}, Scope = InfluenceScope.CharOfTheCombatChar)]
		[SingleValueDependency(8, new ushort[]
		{
			19
		}, Scope = InfluenceScope.AllCharsInCombat)]
		private unsafe NeiliAllocation CalcAllocatedNeiliEffects()
		{
			NeiliAllocation value = default(NeiliAllocation);
			NeiliAllocation neiliAllocation = this.GetNeiliAllocation();
			NeiliAllocation neiliAllocationInCombat = DomainManager.Combat.IsCharInCombat(this._id, true) ? DomainManager.Combat.GetElement_CombatCharacterDict(this._id).GetNeiliAllocation() : neiliAllocation;
			for (sbyte i = 0; i < 4; i += 1)
			{
				*(ref value.Items.FixedElementField + (IntPtr)i * 2) = (short)((int)(*(ref neiliAllocationInCombat.Items.FixedElementField + (IntPtr)i * 2)) * GlobalConfig.Instance.AllocatedNeiliEffectPercent / 100);
			}
			return value;
		}

		// Token: 0x06006C0B RID: 27659 RVA: 0x003CA2EC File Offset: 0x003C84EC
		[SingleValueDependency(11, new ushort[]
		{
			0
		})]
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			61,
			110,
			28,
			80,
			81,
			82,
			83,
			84,
			85,
			86,
			87,
			88,
			89,
			90,
			91,
			92,
			93,
			97,
			98,
			99,
			100,
			57,
			26,
			44,
			94
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			14
		}, Scope = InfluenceScope.CombatSkillOwner)]
		private unsafe int CalcCombatPower()
		{
			int value = 0;
			value += (int)this._consummateLevel * 1000;
			MainAttributes maxMainAttributes = this.GetMaxMainAttributes();
			int bonus = 0;
			for (int i = 0; i < 6; i++)
			{
				bonus += (int)(*(ref maxMainAttributes.Items.FixedElementField + (IntPtr)i * 2));
			}
			value += bonus * 3;
			int bonus2 = 0;
			HitOrAvoidInts hitValues = this.GetHitValues();
			for (int j = 0; j < 4; j++)
			{
				bonus2 += *(ref hitValues.Items.FixedElementField + (IntPtr)j * 4);
			}
			OuterAndInnerInts penetrations = this.GetPenetrations();
			bonus2 += penetrations.Outer + penetrations.Inner;
			value += bonus2;
			int bonus3 = 0;
			HitOrAvoidInts avoidValues = this.GetAvoidValues();
			for (int k = 0; k < 4; k++)
			{
				bonus3 += *(ref avoidValues.Items.FixedElementField + (IntPtr)k * 4);
			}
			OuterAndInnerInts penetrationResists = this.GetPenetrationResists();
			bonus3 += penetrationResists.Outer + penetrationResists.Inner;
			value += bonus3;
			OuterAndInnerShorts recoveryOfStanceAndBreath = this.GetRecoveryOfStanceAndBreath();
			value += (int)((recoveryOfStanceAndBreath.Outer + recoveryOfStanceAndBreath.Inner + this.GetMoveSpeed() + this.GetRecoveryOfFlaw() + this.GetCastSpeed() + this.GetRecoveryOfBlockedAcupoint() + this.GetWeaponSwitchSpeed() + this.GetAttackSpeed() + this.GetInnerRatio() + this.GetRecoveryOfQiDisorder() - 1000) * 5);
			int bonus4 = 0;
			int bonus5 = 0;
			int bonus6 = 0;
			for (int l = 0; l < 16; l++)
			{
				short val = *(ref this._lifeSkillAttainments.Items.FixedElementField + (IntPtr)l * 2);
				bool flag = (int)val > bonus4;
				if (flag)
				{
					bonus6 = bonus5;
					bonus5 = bonus4;
					bonus4 = (int)val;
				}
				else
				{
					bool flag2 = (int)val > bonus5;
					if (flag2)
					{
						bonus6 = bonus5;
						bonus5 = (int)val;
					}
					else
					{
						bool flag3 = (int)val > bonus6;
						if (flag3)
						{
							bonus6 = (int)val;
						}
					}
				}
			}
			value += (bonus4 + bonus5 + bonus6) * 20;
			int bonus7 = 0;
			int bonus8 = 0;
			int bonus9 = 0;
			for (int m = 0; m < 14; m++)
			{
				short val2 = *(ref this._combatSkillAttainments.Items.FixedElementField + (IntPtr)m * 2);
				bool flag4 = (int)val2 > bonus7;
				if (flag4)
				{
					bonus9 = bonus8;
					bonus8 = bonus7;
					bonus7 = (int)val2;
				}
				else
				{
					bool flag5 = (int)val2 > bonus8;
					if (flag5)
					{
						bonus9 = bonus8;
						bonus8 = (int)val2;
					}
					else
					{
						bool flag6 = (int)val2 > bonus9;
						if (flag6)
						{
							bonus9 = (int)val2;
						}
					}
				}
			}
			value += (bonus7 + bonus8 + bonus9) * 40;
			value += this.GetEquipmentCombatPowerValue();
			int defeatMarksCount = CombatDomain.GetDefeatMarksCountOutOfCombat(this);
			byte defeatMarksMaxCount = GlobalConfig.NeedDefeatMarkCount[2];
			int defeatRate = defeatMarksCount * 100 / (int)defeatMarksMaxCount;
			bool flag7 = DomainManager.LegendaryBook.GetCharOwnedBookTypes(this._id) != null;
			if (flag7)
			{
				defeatRate /= 2;
			}
			value -= value * defeatRate / 100;
			return (value >= 0) ? value : 0;
		}

		// Token: 0x06006C0C RID: 27660 RVA: 0x003CA5D8 File Offset: 0x003C87D8
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			61,
			92
		}, Scope = InfluenceScope.Self)]
		[ObjectCollectionDependency(7, 0, new ushort[]
		{
			15
		}, Scope = InfluenceScope.CombatSkillOwner)]
		private unsafe sbyte CalcAttackTendencyOfInnerAndOuter()
		{
			int value = 0;
			int attackSkillsCount = 0;
			ArraySegmentList<short> attackSkills = this.GetCombatSkillEquipment().Attack;
			int i = 0;
			int count = attackSkills.Count;
			while (i < count)
			{
				short skillTemplateId = *attackSkills[i];
				bool flag = skillTemplateId < 0;
				if (!flag)
				{
					CombatSkillKey key = new CombatSkillKey(this._id, skillTemplateId);
					GameData.Domains.CombatSkill.CombatSkill combatSkill = DomainManager.CombatSkill.GetElement_CombatSkills(key);
					value += (int)combatSkill.GetCurrInnerRatio();
					attackSkillsCount++;
				}
				i++;
			}
			bool flag2 = attackSkillsCount > 0;
			if (flag2)
			{
				value /= attackSkillsCount;
			}
			return (sbyte)value;
		}

		// Token: 0x06006C0D RID: 27661 RVA: 0x003CA670 File Offset: 0x003C8870
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			62
		}, Scope = InfluenceScope.Self)]
		private sbyte CalcMaxConsummateLevel()
		{
			int maxConsummateLevel = -1;
			short[] combatSkillAttainmentPanels = this.GetCombatSkillAttainmentPanels();
			for (sbyte skillType = 0; skillType < 14; skillType += 1)
			{
				int totalCount = 0;
				int lowPoint = 0;
				int middlePoint = 0;
				int highPoint = 0;
				for (sbyte grade = 0; grade <= 8; grade += 1)
				{
					int offset = (int)(9 * skillType + grade);
					short skillTemplateId = combatSkillAttainmentPanels[offset];
					bool flag = skillTemplateId < 0;
					if (!flag)
					{
						bool flag2 = grade != 0;
						if (flag2)
						{
							totalCount++;
						}
						int point = GlobalConfig.Instance.ConsummateLevelPoints[(int)grade];
						switch (Grade.GetGroup(grade))
						{
						case 0:
							lowPoint = Math.Max(point, lowPoint);
							break;
						case 1:
							middlePoint = Math.Max(point, middlePoint);
							break;
						case 2:
							highPoint = Math.Max(point, highPoint);
							break;
						}
					}
				}
				totalCount += (lowPoint + middlePoint + highPoint) / 10;
				bool flag3 = maxConsummateLevel < totalCount;
				if (flag3)
				{
					maxConsummateLevel = totalCount;
				}
			}
			return (sbyte)Math.Clamp(maxConsummateLevel, 0, (int)GlobalConfig.Instance.MaxConsummateLevel);
		}

		// Token: 0x06006C0E RID: 27662 RVA: 0x003CA788 File Offset: 0x003C8988
		[ObjectCollectionDependency(4, 0, new ushort[]
		{
			61
		}, Scope = InfluenceScope.Self)]
		private void CalcCombatSkillEquipment(CombatSkillEquipment value)
		{
			CombatSkillPlan combatSkillPlan;
			bool flag = DomainManager.Extra.TryGetCharacterEquippedCombatSkills(this._id, out combatSkillPlan);
			if (flag)
			{
				value.Set(combatSkillPlan);
			}
			else
			{
				value.Set(this._equippedCombatSkills);
			}
		}

		// Token: 0x06006C0F RID: 27663 RVA: 0x003CA7C4 File Offset: 0x003C89C4
		private static short GetClampedAgeOfAgeEffect(short age)
		{
			bool flag = age < 0;
			short result;
			if (flag)
			{
				result = 20;
			}
			else
			{
				bool flag2 = age > 100;
				if (flag2)
				{
					result = 100;
				}
				else
				{
					result = age;
				}
			}
			return result;
		}

		// Token: 0x06006C10 RID: 27664 RVA: 0x003CA7F4 File Offset: 0x003C89F4
		public AvatarRelatedData GenerateAvatarRelatedData()
		{
			return new AvatarRelatedData
			{
				AvatarData = new AvatarData(this.GetAvatar()),
				DisplayAge = this.GetPhysiologicalAge(),
				ClothingDisplayId = this.GetClothingDisplayId(),
				HasNewGoods = DomainManager.Character.MerchantHasNewGoods(this.GetId())
			};
		}

		// Token: 0x06006C11 RID: 27665 RVA: 0x003CA84C File Offset: 0x003C8A4C
		public bool IsAbleToGrowAvatarElement(sbyte growableElementType, short physiologicalAge)
		{
			if (!true)
			{
			}
			bool result;
			switch (growableElementType)
			{
			case 0:
				result = this.IsAbleToGrowHair();
				break;
			case 1:
				result = this.IsAbleToGrowBeard1(physiologicalAge);
				break;
			case 2:
				result = this.IsAbleToGrowBeard2(physiologicalAge);
				break;
			case 3:
				result = Character.IsAbleToGrowWrinkle1(physiologicalAge);
				break;
			case 4:
				result = Character.IsAbleToGrowWrinkle2(physiologicalAge);
				break;
			case 5:
				result = Character.IsAbleToGrowWrinkle3(physiologicalAge);
				break;
			case 6:
				result = Character.IsAbleToGrowEyebrow();
				break;
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(39, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported AvatarGrowableElementType: ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(growableElementType);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
			if (!true)
			{
			}
			return result;
		}

		// Token: 0x06006C12 RID: 27666 RVA: 0x003CA8F8 File Offset: 0x003C8AF8
		public bool IsAbleToGrowHair()
		{
			return !this.IsMonkType(2);
		}

		// Token: 0x06006C13 RID: 27667 RVA: 0x003CA914 File Offset: 0x003C8B14
		[return: TupleElementNames(new string[]
		{
			"beard1",
			"beard2"
		})]
		public ValueTuple<bool, bool> IsAbleToGrowBeards(short physiologicalAge)
		{
			bool flag = this._gender != 1 || this._transgender || this._featureIds.Contains(168);
			ValueTuple<bool, bool> result;
			if (flag)
			{
				result = new ValueTuple<bool, bool>(false, false);
			}
			else
			{
				result = new ValueTuple<bool, bool>((int)physiologicalAge >= GlobalConfig.Instance.AgeShowBeard1, (int)physiologicalAge >= GlobalConfig.Instance.AgeShowBeard2);
			}
			return result;
		}

		// Token: 0x06006C14 RID: 27668 RVA: 0x003CA980 File Offset: 0x003C8B80
		public bool IsAbleToGrowBeard1(short physiologicalAge)
		{
			return this._gender == 1 && (int)physiologicalAge >= GlobalConfig.Instance.AgeShowBeard1 && !this._transgender && !this._featureIds.Contains(168);
		}

		// Token: 0x06006C15 RID: 27669 RVA: 0x003CA9C8 File Offset: 0x003C8BC8
		public bool IsAbleToGrowBeard2(short physiologicalAge)
		{
			return this._gender == 1 && (int)physiologicalAge >= GlobalConfig.Instance.AgeShowBeard2 && !this._transgender && !this._featureIds.Contains(168);
		}

		// Token: 0x06006C16 RID: 27670 RVA: 0x003CAA10 File Offset: 0x003C8C10
		public void SetAvatar(DataContext context, AvatarData customAvatarData)
		{
			for (sbyte i = 0; i < 7; i += 1)
			{
				customAvatarData.SetGrowableElementShowingAbility(i, this.IsAbleToGrowAvatarElement(i, this.GetPhysiologicalAge()));
			}
			for (sbyte j = 0; j < 7; j += 1)
			{
				bool flag = !customAvatarData.GetGrowableElementShowingState(j) && this.IsAbleToGrowAvatarElement(j, this.GetPhysiologicalAge());
				if (flag)
				{
					DomainManager.Character.InitializeAvatarElementGrowthProgress(context, this._id, j);
				}
			}
			this.SetAvatar(customAvatarData, context);
		}

		// Token: 0x06006C17 RID: 27671 RVA: 0x003CAA94 File Offset: 0x003C8C94
		public static bool IsAbleToGrowWrinkle1(short physiologicalAge)
		{
			return (int)physiologicalAge >= GlobalConfig.Instance.AgeShowWrinkle1;
		}

		// Token: 0x06006C18 RID: 27672 RVA: 0x003CAAB8 File Offset: 0x003C8CB8
		public static bool IsAbleToGrowWrinkle2(short physiologicalAge)
		{
			return (int)physiologicalAge >= GlobalConfig.Instance.AgeShowWrinkle2;
		}

		// Token: 0x06006C19 RID: 27673 RVA: 0x003CAADC File Offset: 0x003C8CDC
		public static bool IsAbleToGrowWrinkle3(short physiologicalAge)
		{
			return (int)physiologicalAge >= GlobalConfig.Instance.AgeShowWrinkle3;
		}

		// Token: 0x06006C1A RID: 27674 RVA: 0x003CAB00 File Offset: 0x003C8D00
		public static bool IsAbleToGrowEyebrow()
		{
			return true;
		}

		// Token: 0x17000474 RID: 1140
		// (get) Token: 0x06006C1B RID: 27675 RVA: 0x003CAB14 File Offset: 0x003C8D14
		public bool CanNotSpeak
		{
			get
			{
				bool flag = DomainManager.Character.GetSkeletonSourceGraveId(this._id) >= 0 || !Character.Instance[this._templateId].CanSpeak;
				bool flag2 = flag;
				if (!flag2)
				{
					short templateId = this._equipment[4].TemplateId;
					bool flag3 = templateId - 69 <= 2;
					flag2 = flag3;
				}
				return flag2;
			}
		}

		// Token: 0x17000475 RID: 1141
		// (get) Token: 0x06006C1C RID: 27676 RVA: 0x003CAB79 File Offset: 0x003C8D79
		public bool CanAffectedByCombatDifficulty
		{
			get
			{
				return !this.IsTaiwu() && this._leaderId != DomainManager.Taiwu.GetTaiwuCharId() && !DomainManager.Combat.GetTaiwuSpecialGroupCharIds().Contains(this._id);
			}
		}

		// Token: 0x06006C1D RID: 27677 RVA: 0x003CABB0 File Offset: 0x003C8DB0
		public sbyte GetInnateFiveElementsType()
		{
			return GameData.Domains.Character.SharedMethods.GetInnateFiveElementsType(this._birthMonth);
		}

		// Token: 0x06006C1E RID: 27678 RVA: 0x003CABD0 File Offset: 0x003C8DD0
		public void SpecifyCurrNeili(DataContext context, int value)
		{
			bool flag = value < 0;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(29, 2);
				defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
				defaultInterpolatedStringHandler.AppendLiteral("'s current neili not enough: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(value);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			int maxNeili = this.GetMaxNeili();
			bool flag2 = value > maxNeili;
			if (flag2)
			{
				value = maxNeili;
			}
			this.SetCurrNeili(value, context);
		}

		// Token: 0x06006C1F RID: 27679 RVA: 0x003CAC38 File Offset: 0x003C8E38
		public void ChangeCurrNeili(DataContext context, int delta)
		{
			int value = this._currNeili + delta;
			bool flag = value < 0;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(31, 3);
				defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
				defaultInterpolatedStringHandler.AppendLiteral("'s current neili not enough: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(this._currNeili);
				defaultInterpolatedStringHandler.AppendLiteral(", ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(delta);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			int maxNeili = this.GetMaxNeili();
			bool flag2 = value > maxNeili;
			if (flag2)
			{
				value = maxNeili;
			}
			this.SetCurrNeili(value, context);
		}

		// Token: 0x06006C20 RID: 27680 RVA: 0x003CACC4 File Offset: 0x003C8EC4
		public void ChangeCurrNeiliWithoutChecking(DataContext context, int delta)
		{
			int maxNeili = this.GetMaxNeili();
			int value = Math.Clamp(this._currNeili + delta, 0, maxNeili);
			this.SetCurrNeili(value, context);
		}

		// Token: 0x06006C21 RID: 27681 RVA: 0x003CACF4 File Offset: 0x003C8EF4
		public int GetCurrNeiliRecovery(int maxNeili)
		{
			short attainment = this.GetCombatSkillAttainment(0);
			bool flag = this.IsActiveExternalRelationState(32) && DomainManager.Organization.GetPrisonerSect(this._id) == 3;
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				result = (int)attainment + this._extraNeili / 4;
			}
			return result;
		}

		// Token: 0x06006C22 RID: 27682 RVA: 0x003CAD40 File Offset: 0x003C8F40
		public unsafe int GetPureCurrNeili()
		{
			int value = this._currNeili;
			for (int type = 0; type < 4; type++)
			{
				value += CombatHelper.CalcNeiliCostFromZero(*(ref this._baseNeiliAllocation.Items.FixedElementField + (IntPtr)type * 2));
			}
			int pureMaxNeili = this.GetPureMaxNeili();
			bool flag = value > pureMaxNeili;
			int result;
			if (flag)
			{
				result = pureMaxNeili;
			}
			else
			{
				result = value;
			}
			return result;
		}

		// Token: 0x06006C23 RID: 27683 RVA: 0x003CADA0 File Offset: 0x003C8FA0
		public void ChangeExtraNeili(DataContext context, int delta)
		{
			this._extraNeili += delta;
			bool flag = this._extraNeili < 0;
			if (flag)
			{
				this._extraNeili = 0;
			}
			this.SetExtraNeili(this._extraNeili, context);
		}

		// Token: 0x06006C24 RID: 27684 RVA: 0x003CADDE File Offset: 0x003C8FDE
		public void TransferNeiliProportionOfFiveElements(DataContext context, sbyte destType, sbyte transferType, int amount)
		{
			this._baseNeiliProportionOfFiveElements.Transfer(destType, transferType, amount);
			this.SetBaseNeiliProportionOfFiveElements(this._baseNeiliProportionOfFiveElements, context);
		}

		// Token: 0x06006C25 RID: 27685 RVA: 0x003CAE00 File Offset: 0x003C9000
		public unsafe bool AllocateNeili(DataContext context, byte neiliAllocationType)
		{
			bool flag = !CombatHelper.CanAllocateNeiliConsideringFeature(neiliAllocationType, this._baseNeiliAllocation, this._currNeili, this._consummateLevel, this.GetFeatureIds());
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				short currAllocation = *(ref this._baseNeiliAllocation.Items.FixedElementField + (IntPtr)neiliAllocationType * 2);
				*(ref this._baseNeiliAllocation.Items.FixedElementField + (IntPtr)neiliAllocationType * 2) = currAllocation + 1;
				this.SetBaseNeiliAllocation(this._baseNeiliAllocation, context);
				int cost = CombatHelper.CalcNeiliCost(currAllocation);
				this.ChangeCurrNeili(context, -cost);
				Tester.Assert(this._currNeili <= this.GetMaxNeili(), "");
				result = true;
			}
			return result;
		}

		// Token: 0x06006C26 RID: 27686 RVA: 0x003CAEA8 File Offset: 0x003C90A8
		public unsafe bool DeallocateNeili(DataContext context, byte neiliAllocationType)
		{
			short currAllocation = *(ref this._baseNeiliAllocation.Items.FixedElementField + (IntPtr)neiliAllocationType * 2);
			bool flag = currAllocation <= 0;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				short targetAllocation = currAllocation - 1;
				*(ref this._baseNeiliAllocation.Items.FixedElementField + (IntPtr)neiliAllocationType * 2) = targetAllocation;
				this.SetBaseNeiliAllocation(this._baseNeiliAllocation, context);
				int returned = CombatHelper.CalcNeiliCost(targetAllocation);
				this.ChangeCurrNeili(context, returned);
				Tester.Assert(this._currNeili <= this.GetMaxNeili(), "");
				result = true;
			}
			return result;
		}

		// Token: 0x06006C27 RID: 27687 RVA: 0x003CAF3C File Offset: 0x003C913C
		public void SpecifyBaseNeiliAllocation(DataContext context, NeiliAllocation allocations)
		{
			int oriPureCurrNeili = this.GetPureCurrNeili();
			int currRequiredNeili = CombatHelper.CalcRequiredNeili(allocations);
			int currNeili = oriPureCurrNeili - currRequiredNeili;
			this.SetBaseNeiliAllocation(allocations, context);
			this.SpecifyCurrNeili(context, currNeili);
		}

		// Token: 0x06006C28 RID: 27688 RVA: 0x003CAF70 File Offset: 0x003C9170
		public void ResetBaseNeiliAllocation(DataContext context)
		{
			int pureCurrNeili = this.GetPureCurrNeili();
			this._baseNeiliAllocation.Initialize();
			this.SetBaseNeiliAllocation(this._baseNeiliAllocation, context);
			this.SpecifyCurrNeili(context, pureCurrNeili);
		}

		// Token: 0x06006C29 RID: 27689 RVA: 0x003CAFA8 File Offset: 0x003C91A8
		public unsafe void ChangeExtraNeiliAllocation(DataContext context, NeiliAllocation delta)
		{
			for (int i = 0; i < 4; i++)
			{
				ref short ptr = ref this._extraNeiliAllocation.Items.FixedElementField + (IntPtr)i * 2;
				ptr += *(ref delta.Items.FixedElementField + (IntPtr)i * 2);
			}
			this.SetExtraNeiliAllocation(this._extraNeiliAllocation, context);
		}

		// Token: 0x06006C2A RID: 27690 RVA: 0x003CB000 File Offset: 0x003C9200
		public void ChangeExtraNeiliAllocation(DataContext context, byte neiliAllocationType, short delta)
		{
			ref short ptr = ref this._extraNeiliAllocation.Items.FixedElementField + (IntPtr)neiliAllocationType * 2;
			ptr += delta;
			this.SetExtraNeiliAllocation(this._extraNeiliAllocation, context);
		}

		// Token: 0x06006C2B RID: 27691 RVA: 0x003CB02C File Offset: 0x003C922C
		public void ChangePoisoned(DataContext context, sbyte poisonType, sbyte poisonLevel, int delta)
		{
			bool flag = this.OfflineChangePoisoned(poisonType, poisonLevel, delta);
			if (flag)
			{
				this.SetPoisoned(ref this._poisoned, context);
			}
		}

		// Token: 0x06006C2C RID: 27692 RVA: 0x003CB058 File Offset: 0x003C9258
		public unsafe bool CalcChangedPoisoned(ref PoisonInts targetPoisoned, sbyte poisonType, sbyte poisonLevel, int delta)
		{
			bool flag = this.HasPoisonImmunity(poisonType);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				ref PoisonInts poisonResists = ref this.GetPoisonResists();
				int poisonResist = *poisonResists[(int)poisonType];
				int poisoned = *targetPoisoned[(int)poisonType];
				bool flag2 = delta > 0;
				if (flag2)
				{
					if (!true)
					{
					}
					int num;
					switch (poisonType)
					{
					case 0:
						num = this.GetMixedPoisonTypeRelatedMarkCount(20);
						break;
					case 1:
						num = this.GetMixedPoisonTypeRelatedMarkCount(30);
						break;
					case 2:
						num = this.GetMixedPoisonTypeRelatedMarkCount(34);
						break;
					case 3:
						num = this.GetMixedPoisonTypeRelatedMarkCount(18);
						break;
					default:
						num = 0;
						break;
					}
					if (!true)
					{
					}
					int relatedMarkCount = num;
					bool flag3 = relatedMarkCount > 0;
					if (flag3)
					{
						delta += relatedMarkCount * 10 + 10;
					}
					foreach (SolarTermItem solarTerm in this.GetInvokedSolarTerm())
					{
						bool flag4 = solarTerm.PoisonBuffType == poisonType;
						if (flag4)
						{
							delta *= this.GetSolarTermBonus((int)GlobalConfig.Instance.SolarTermAddPoisonEffect);
						}
					}
					delta = PoisonsAndLevels.CalcPoisonDelta(delta, poisonLevel, poisoned, poisonResist);
				}
				else
				{
					bool flag5 = poisonLevel < PoisonsAndLevels.CalcPoisonedLevel(poisoned);
					if (flag5)
					{
						return false;
					}
				}
				*targetPoisoned[(int)poisonType] = Math.Clamp(poisoned + delta, 0, 25000);
				result = true;
			}
			return result;
		}

		// Token: 0x06006C2D RID: 27693 RVA: 0x003CB1C0 File Offset: 0x003C93C0
		private bool OfflineChangePoisoned(sbyte poisonType, sbyte poisonLevel, int delta)
		{
			return this.CalcChangedPoisoned(ref this._poisoned, poisonType, poisonLevel, delta);
		}

		// Token: 0x06006C2E RID: 27694 RVA: 0x003CB1E1 File Offset: 0x003C93E1
		public void ChangePoisoned(DataContext context, ref PoisonsAndLevels delta)
		{
			this.OfflineChangePoisoned(ref delta);
			this.SetPoisoned(ref this._poisoned, context);
		}

		// Token: 0x06006C2F RID: 27695 RVA: 0x003CB1FC File Offset: 0x003C93FC
		private unsafe void OfflineChangePoisoned(ref PoisonsAndLevels delta)
		{
			CharacterItem characterCfg = Character.Instance[this._templateId];
			byte poisonImmunities = DomainManager.Extra.GetPoisonImmunities(this._id);
			ref PoisonInts poisonResists = ref this.GetPoisonResists();
			for (sbyte poisonType = 0; poisonType < 6; poisonType += 1)
			{
				bool flag = GameData.Domains.Character.SharedMethods.HasPoisonImmunity(poisonType, characterCfg, ref poisonResists, poisonImmunities);
				if (!flag)
				{
					int poisonDelta = (int)(*(ref delta.Values.FixedElementField + (IntPtr)poisonType * 2));
					sbyte poisonLevel = *(ref delta.Levels.FixedElementField + poisonType);
					int currPoisoned = *(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType * 4);
					int currResist = *(ref poisonResists.Items.FixedElementField + (IntPtr)poisonType * 4);
					bool flag2 = poisonDelta < 0;
					if (!flag2)
					{
						foreach (SolarTermItem solarTerm in this.GetInvokedSolarTerm())
						{
							bool flag3 = solarTerm.PoisonBuffType == poisonType;
							if (flag3)
							{
								poisonDelta *= this.GetSolarTermBonus((int)GlobalConfig.Instance.SolarTermAddPoisonEffect);
							}
						}
						poisonDelta = PoisonsAndLevels.CalcPoisonDelta(poisonDelta, poisonLevel, currPoisoned, currResist);
						*(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType * 4) = Math.Clamp(currPoisoned + poisonDelta, 0, 25000);
					}
				}
			}
		}

		// Token: 0x06006C30 RID: 27696 RVA: 0x003CB360 File Offset: 0x003C9560
		public unsafe void DirectlyChangePoisoned(DataContext context, ref PoisonInts delta)
		{
			for (sbyte poisonType = 0; poisonType < 6; poisonType += 1)
			{
				bool flag = this.HasPoisonImmunity(poisonType);
				if (!flag)
				{
					int currMaxValue = 25000;
					*(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType * 4) = Math.Clamp(*(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType * 4) + *(ref delta.Items.FixedElementField + (IntPtr)poisonType * 4), 0, currMaxValue);
				}
			}
			this.SetPoisoned(ref this._poisoned, context);
		}

		// Token: 0x06006C31 RID: 27697 RVA: 0x003CB3E8 File Offset: 0x003C95E8
		public void TransferDisorderOfQi(DataContext context, Character target, int delta)
		{
			this._disorderOfQi = (short)Math.Clamp((int)this._disorderOfQi - delta, (int)DisorderLevelOfQi.MinValue, (int)DisorderLevelOfQi.MaxValue);
			target._disorderOfQi = (short)Math.Clamp((int)target._disorderOfQi + delta, (int)DisorderLevelOfQi.MinValue, (int)DisorderLevelOfQi.MaxValue);
			this.SetDisorderOfQi(this._disorderOfQi, context);
			target.SetDisorderOfQi(target._disorderOfQi, context);
		}

		// Token: 0x06006C32 RID: 27698 RVA: 0x003CB450 File Offset: 0x003C9650
		public void ChangeDisorderOfQi(DataContext context, int baseDelta)
		{
			int delta = this.CalcDisorderOfQiDelta(baseDelta);
			short newDisorderOfQi = this.CalcChangedDisorderOfQiWithoutEffect(this._disorderOfQi, delta);
			this.SetDisorderOfQi(newDisorderOfQi, context);
		}

		// Token: 0x06006C33 RID: 27699 RVA: 0x003CB480 File Offset: 0x003C9680
		public short CalcChangedDisorderOfQiWithoutEffect(short disorderOfQi, int delta)
		{
			return (short)Math.Clamp((int)disorderOfQi + delta, (int)DisorderLevelOfQi.MinValue, (int)DisorderLevelOfQi.MaxValue);
		}

		// Token: 0x06006C34 RID: 27700 RVA: 0x003CB4A8 File Offset: 0x003C96A8
		public int CalcDisorderOfQiDelta(int baseDelta)
		{
			int delta = baseDelta;
			CValuePercentBonus percent = 0;
			bool flag = baseDelta < 0;
			if (flag)
			{
				foreach (short featureId in this._featureIds)
				{
					percent += (int)CharacterFeature.Instance[featureId].QiDisorderBuffPercent;
				}
				foreach (SolarTermItem solarTerm in this.GetInvokedSolarTerm())
				{
					bool qiDisorderRecoveringBuff = solarTerm.QiDisorderRecoveringBuff;
					if (qiDisorderRecoveringBuff)
					{
						percent += this.GetSolarTermBonus((int)GlobalConfig.Instance.SolarTermAddRecoverQiDisorder);
					}
				}
			}
			else
			{
				foreach (short featureId2 in this._featureIds)
				{
					bool flag2 = this.IgnoreFeature(featureId2);
					if (!flag2)
					{
						percent += (int)CharacterFeature.Instance[featureId2].QiDisorderDebuffPercent;
					}
				}
				foreach (SolarTermItem solarTerm2 in this.GetInvokedSolarTerm())
				{
					bool qiDisorderRecoveringBuff2 = solarTerm2.QiDisorderRecoveringBuff;
					if (qiDisorderRecoveringBuff2)
					{
						percent -= this.GetSolarTermBonus((int)GlobalConfig.Instance.SolarTermAddRecoverQiDisorder);
					}
				}
			}
			delta *= percent.StaySymbol();
			bool flag3 = delta < 0;
			if (flag3)
			{
				delta += delta / 2 * (int)this.GetRecoveryOfQiDisorder() / 1000;
			}
			else
			{
				delta -= delta / 2 * (int)this.GetRecoveryOfQiDisorder() / 1000;
			}
			return delta;
		}

		// Token: 0x06006C35 RID: 27701 RVA: 0x003CB6AC File Offset: 0x003C98AC
		public void ChangeDisorderOfQiRandomRecovery(DataContext context, int delta)
		{
			delta = (int)CFormula.RandomCalcDisorderOfQiDelta(context.Random, delta);
			this.ChangeDisorderOfQi(context, delta);
		}

		// Token: 0x06006C36 RID: 27702 RVA: 0x003CB6C8 File Offset: 0x003C98C8
		public void ChangeInjury(DataContext context, sbyte bodyPartType, bool isInnerInjury, sbyte delta)
		{
			CharacterItem config = Character.Instance[this._templateId];
			bool immunity = isInnerInjury ? config.InnerInjuryImmunity : config.OuterInjuryImmunity;
			bool flag = immunity;
			if (!flag)
			{
				this._injuries.Change(bodyPartType, isInnerInjury, (int)delta);
				this.SetInjuries(this._injuries, context);
			}
		}

		// Token: 0x06006C37 RID: 27703 RVA: 0x003CB720 File Offset: 0x003C9920
		public void ChangeInjuries(DataContext context, Injuries delta)
		{
			CharacterItem config = Character.Instance[this._templateId];
			this._injuries.Change(delta, config.OuterInjuryImmunity, config.InnerInjuryImmunity);
			this.SetInjuries(this._injuries, context);
		}

		// Token: 0x06006C38 RID: 27704 RVA: 0x003CB768 File Offset: 0x003C9968
		public void ChangeConsummateLevel(DataContext context, int delta)
		{
			sbyte value = (sbyte)Math.Clamp((int)this._consummateLevel + delta, 0, (int)GlobalConfig.Instance.MaxConsummateLevel);
			this.SetConsummateLevel(value, context);
		}

		// Token: 0x06006C39 RID: 27705 RVA: 0x003CB79C File Offset: 0x003C999C
		public unsafe sbyte GetCombatSkillSlotCountWithGeneric(sbyte equipType)
		{
			bool flag = this._id == DomainManager.Taiwu.GetTaiwuCharId();
			sbyte result;
			if (flag)
			{
				byte[] genericGridAllocation = DomainManager.Taiwu.GetGenericGridAllocation();
				byte addCount = genericGridAllocation.GetOrDefault((int)(equipType - 1));
				result = this.GetCombatSkillSlotCount(equipType) + (sbyte)addCount;
			}
			else
			{
				Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)5], 5);
				Span<sbyte> slotCounts = span;
				this.GetCombatSkillSlotCountsWithGeneric(slotCounts);
				result = *slotCounts[(int)equipType];
			}
			return result;
		}

		// Token: 0x06006C3A RID: 27706 RVA: 0x003CB80C File Offset: 0x003C9A0C
		public int GetCombatSkillSlotCountsWithGeneric(Span<sbyte> slotCounts)
		{
			sbyte genericCount = this.GetCombatSkillSlotCounts(slotCounts);
			return this.ApplyGenericCombatSkillSlotAllocations(slotCounts, (int)genericCount);
		}

		// Token: 0x06006C3B RID: 27707 RVA: 0x003CB830 File Offset: 0x003C9A30
		public unsafe int ApplyGenericCombatSkillSlotAllocations(Span<sbyte> slotCounts, int genericCount)
		{
			bool flag = this.IsTaiwu();
			if (flag)
			{
				byte[] genericGridAllocation = DomainManager.Taiwu.GetGenericGridAllocation();
				for (sbyte equipType = 1; equipType < 5; equipType += 1)
				{
					sbyte addCount = (sbyte)genericGridAllocation[(int)(equipType - 1)];
					ref sbyte ptr = ref slotCounts[(int)equipType];
					ptr += addCount;
					int totalCost = CombatSkillHelper.GetGenericAllocationTotalCost(equipType, (int)addCount);
					genericCount -= totalCost;
				}
			}
			else
			{
				bool flag2 = this._leaderId == DomainManager.Taiwu.GetTaiwuCharId();
				if (flag2)
				{
					CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(this._id);
					bool flag3 = configuration == null;
					if (flag3)
					{
						return genericCount;
					}
					byte[] genericGridAllocation2 = configuration.CurrentEquipPlan.GenericGridAllocation;
					for (sbyte equipType2 = 1; equipType2 < 5; equipType2 += 1)
					{
						sbyte addCount2 = (sbyte)genericGridAllocation2[(int)(equipType2 - 1)];
						ref sbyte ptr2 = ref slotCounts[(int)equipType2];
						ptr2 += addCount2;
						int totalCost2 = CombatSkillHelper.GetGenericAllocationTotalCost(equipType2, (int)addCount2);
						genericCount -= totalCost2;
					}
				}
				else
				{
					for (sbyte equipType3 = 1; equipType3 < 5; equipType3 += 1)
					{
						sbyte required = (sbyte)this.GetCombatSkillTypeRequireGrid(equipType3);
						bool flag4 = required <= *slotCounts[(int)equipType3];
						if (!flag4)
						{
							sbyte needAllocate = required - *slotCounts[(int)equipType3];
							int totalCost3 = CombatSkillHelper.GetGenericAllocationTotalCost(equipType3, (int)needAllocate);
							bool flag5 = (int)needAllocate <= totalCost3;
							if (flag5)
							{
								*slotCounts[(int)equipType3] = required;
								genericCount -= totalCost3;
							}
						}
					}
				}
			}
			return genericCount;
		}

		// Token: 0x06006C3C RID: 27708 RVA: 0x003CB9AC File Offset: 0x003C9BAC
		public sbyte GetCombatSkillSlotCounts(Span<sbyte> slotCounts)
		{
			CombatSkillEquipment skillEquipment = this.GetCombatSkillEquipment();
			return this.GetCombatSkillSlotCounts(slotCounts, skillEquipment.Neigong);
		}

		// Token: 0x06006C3D RID: 27709 RVA: 0x003CB9D4 File Offset: 0x003C9BD4
		public unsafe sbyte GetCombatSkillSlotCounts(Span<sbyte> slotCounts, ArraySegmentList<short> neigongList)
		{
			for (sbyte i = 0; i < 5; i += 1)
			{
				*slotCounts[(int)i] = this.GetCombatSkillSlotCount(i, neigongList);
			}
			return this.GetCombatSkillBasicSlotCount(5, neigongList);
		}

		// Token: 0x06006C3E RID: 27710 RVA: 0x003CBA10 File Offset: 0x003C9C10
		public unsafe void GetCombatSkillExtraSlotCounts(Span<sbyte> slotCounts)
		{
			for (sbyte i = 0; i < 5; i += 1)
			{
				*slotCounts[(int)i] = this.GetCombatSkillExtraSlotCount(i);
			}
		}

		// Token: 0x06006C3F RID: 27711 RVA: 0x003CBA40 File Offset: 0x003C9C40
		private sbyte GetCombatSkillSlotCount(sbyte equipType)
		{
			CombatSkillEquipment skillEquipment = this.GetCombatSkillEquipment();
			return this.GetCombatSkillSlotCount(equipType, skillEquipment.Neigong);
		}

		// Token: 0x06006C40 RID: 27712 RVA: 0x003CBA68 File Offset: 0x003C9C68
		private sbyte GetCombatSkillSlotCount(sbyte equipType, ArraySegmentList<short> neigongList)
		{
			bool flag = equipType == 0;
			sbyte result;
			if (flag)
			{
				result = this.GetCombatSkillSlotCountNeigong();
			}
			else
			{
				int slotCount = (int)this.GetCombatSkillBasicSlotCount(equipType, neigongList);
				slotCount += (int)this.GetCombatSkillExtraSlotCount(equipType);
				result = (sbyte)Math.Clamp(slotCount, 0, 99);
			}
			return result;
		}

		// Token: 0x06006C41 RID: 27713 RVA: 0x003CBAA8 File Offset: 0x003C9CA8
		public sbyte GetCombatSkillSlotCountNeigong()
		{
			int slotCount = (int)GlobalConfig.Instance.CombatSkillInitialEquipSlotCounts[0];
			slotCount += (int)this.GetCombatSkillExtraSlotCount(0);
			return (sbyte)Math.Clamp(slotCount, 0, 99);
		}

		// Token: 0x06006C42 RID: 27714 RVA: 0x003CBADB File Offset: 0x003C9CDB
		private sbyte GetCombatSkillGenericSlotCount()
		{
			return this.GetCombatSkillBasicSlotCount(5);
		}

		// Token: 0x06006C43 RID: 27715 RVA: 0x003CBAE4 File Offset: 0x003C9CE4
		private sbyte GetCombatSkillBasicSlotCount(sbyte equipType)
		{
			CombatSkillEquipment skillEquipment = this.GetCombatSkillEquipment();
			return this.GetCombatSkillBasicSlotCount(equipType, skillEquipment.Neigong);
		}

		// Token: 0x06006C44 RID: 27716 RVA: 0x003CBB0C File Offset: 0x003C9D0C
		public sbyte GetCombatSkillBasicSlotCount(sbyte equipType, ArraySegmentList<short> neigongList)
		{
			bool flag = equipType == 0;
			sbyte result;
			if (flag)
			{
				result = GlobalConfig.Instance.CombatSkillInitialEquipSlotCounts[0];
			}
			else
			{
				bool isGeneric = equipType == 5;
				int slotCount = (int)GlobalConfig.Instance.CombatSkillInitialEquipSlotCounts[(int)equipType];
				sbyte mixedPoisonType = MixedPoisonType.FromCombatSkillEquipType(equipType);
				bool flag2 = mixedPoisonType != -1;
				if (flag2)
				{
					slotCount -= Math.Max(0, this.GetRealMixedPoisonTypeRelatedMarkCount(mixedPoisonType) - 2);
				}
				sbyte remainNeigongGrid = this.GetCombatSkillSlotCountNeigong();
				foreach (short ptr in neigongList)
				{
					short skillTemplateId = ptr;
					bool flag3 = skillTemplateId < 0;
					if (!flag3)
					{
						sbyte gridCost = this.GetCombatSkillGridCost(skillTemplateId);
						bool flag4 = gridCost > remainNeigongGrid;
						if (!flag4)
						{
							bool flag5 = !this.GetCombatSkillCanAffectBasic(skillTemplateId);
							if (!flag5)
							{
								remainNeigongGrid -= gridCost;
								GameData.Domains.CombatSkill.CombatSkill skill = DomainManager.CombatSkill.GetElement_CombatSkills(new ValueTuple<int, short>(this._id, skillTemplateId));
								slotCount += (int)(isGeneric ? skill.GetGenericGridCount(false) : skill.GetSpecificGridCount(equipType, false));
							}
						}
					}
				}
				sbyte maxSlotCount = isGeneric ? sbyte.MaxValue : CombatSkillHelper.MaxSlotCounts[(int)equipType];
				result = (sbyte)Math.Clamp(slotCount, 0, (int)maxSlotCount);
			}
			return result;
		}

		// Token: 0x06006C45 RID: 27717 RVA: 0x003CBC34 File Offset: 0x003C9E34
		private sbyte GetCombatSkillExtraSlotCount(sbyte equipType)
		{
			int extraSlotCount = 0;
			foreach (short featureId in this._featureIds)
			{
				extraSlotCount += (int)CharacterFeature.Instance[featureId].CombatSkillSlotBonuses[(int)equipType];
			}
			sbyte[] templateCounts = this.Template.ExtraCombatSkillGrids;
			sbyte[] orgMemberCounts = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo).ExtraCombatSkillGrids;
			bool canAffectedByCombatDifficulty = this.CanAffectedByCombatDifficulty;
			if (canAffectedByCombatDifficulty)
			{
				byte combatDifficulty = DomainManager.World.GetCombatDifficulty();
				CValuePercent difficultyFactor = (int)CombatDifficulty.Instance[combatDifficulty].ExtraCombatSkillGrids;
				extraSlotCount += (int)templateCounts[(int)equipType] + (int)orgMemberCounts[(int)equipType] * difficultyFactor;
			}
			else
			{
				extraSlotCount += (int)(templateCounts[(int)equipType] + orgMemberCounts[(int)equipType]);
			}
			return (sbyte)Math.Clamp(extraSlotCount, 0, 127);
		}

		// Token: 0x06006C46 RID: 27718 RVA: 0x003CBD18 File Offset: 0x003C9F18
		public void ResetCombatStatus(DataContext context)
		{
			this.ClearEatingItems(context);
			this._injuries.Initialize();
			this.SetInjuries(this._injuries, context);
			this._poisoned.Initialize();
			this.SetPoisoned(ref this._poisoned, context);
			this.SetDisorderOfQi(0, context);
			this.SetHealth(this.GetLeftMaxHealth(false), context);
		}

		// Token: 0x06006C47 RID: 27719 RVA: 0x003CBD7C File Offset: 0x003C9F7C
		public int CalcNeiliAllocationStepCount(ECharacterPropertyReferencedType type)
		{
			NeiliAllocation allocations = this.GetNeiliAllocation();
			NeiliAllocation allocationEffects = this.GetAllocatedNeiliEffects();
			return type.CalcNeiliAllocationStepCount(allocations, allocationEffects);
		}

		// Token: 0x06006C48 RID: 27720 RVA: 0x003CBDA4 File Offset: 0x003C9FA4
		public int CalcNeiliAllocationBonus(ECharacterPropertyReferencedType type)
		{
			sbyte neiliType = this.GetNeiliType();
			NeiliTypeItem neiliTypeCfg = NeiliType.Instance[neiliType];
			int valuePerStep = neiliTypeCfg.GetMapping(type);
			bool flag = valuePerStep == 0;
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				int stepCount = this.CalcNeiliAllocationStepCount(type);
				int value = valuePerStep * stepCount;
				CombatSkillEquipment skillEquipment = this.GetCombatSkillEquipment();
				foreach (short skillId in skillEquipment)
				{
					GameData.Domains.CombatSkill.CombatSkill skill;
					bool flag2 = skillId >= 0 && DomainManager.CombatSkill.TryGetElement_CombatSkills(new ValueTuple<int, short>(this._id, skillId), out skill);
					if (flag2)
					{
						value += skill.CalcNeiliAllocationBonus(type, stepCount);
					}
				}
				result = value;
			}
			return result;
		}

		// Token: 0x06006C49 RID: 27721 RVA: 0x003CBE74 File Offset: 0x003CA074
		public short GetRandomFavorability(IRandomSource random)
		{
			CharacterItem config = Character.Instance[this._templateId];
			int index = RandomUtils.GetRandomIndex(config.RandomEnemyFavorability, random);
			ValueTuple<short, short> range = Character.RandomFavorabilityRanges[index];
			return (short)random.Next((int)range.Item1, (int)(range.Item2 + 1));
		}

		// Token: 0x06006C4A RID: 27722 RVA: 0x003CBEC8 File Offset: 0x003CA0C8
		public sbyte CalcWeaponInnerRatio(short weaponTemplateId, sbyte expectRatio)
		{
			WeaponItem weaponConfig = Config.Weapon.Instance[weaponTemplateId];
			int baseRatio = (int)weaponConfig.DefaultInnerRatio;
			int changeRange = (int)((short)weaponConfig.InnerRatioAdjustRange * this.GetInnerRatio() / 100);
			int minRatio = Math.Max(baseRatio - changeRange, 0);
			int maxRatio = Math.Min(baseRatio + changeRange, 100);
			return (sbyte)Math.Clamp((int)expectRatio, minRatio, maxRatio);
		}

		// Token: 0x06006C4B RID: 27723 RVA: 0x003CBF20 File Offset: 0x003CA120
		private int GetPureMaxNeili()
		{
			int value = (int)((this._templateId == 836) ? 0 : GlobalConfig.Instance.CharacterInitialNeili);
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> combatSkills = DomainManager.CombatSkill.GetCharCombatSkills(this._id);
			foreach (KeyValuePair<short, GameData.Domains.CombatSkill.CombatSkill> keyValuePair in combatSkills)
			{
				short num;
				GameData.Domains.CombatSkill.CombatSkill combatSkill;
				keyValuePair.Deconstruct(out num, out combatSkill);
				short skillTemplateId = num;
				GameData.Domains.CombatSkill.CombatSkill skill = combatSkill;
				Tester.Assert(this._learnedCombatSkills.Contains(skillTemplateId), "");
				bool flag = !skill.GetRevoked();
				if (flag)
				{
					value += (int)skill.GetObtainedNeili();
				}
			}
			value += this._extraNeili;
			bool flag2 = this._id == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag2)
			{
				CharacterPropertyBonus permanentBonus = DomainManager.Extra.GetTaiwuPropertyPermanentBonus(ECharacterPropertyReferencedType.MaxNeili);
				value *= permanentBonus;
			}
			bool flag3 = this._id == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag3)
			{
				value -= DomainManager.Extra.GetAllGearMateNeili();
			}
			else
			{
				GearMate gearMate;
				bool flag4 = DomainManager.Extra.TryGetElement_SectZhujianGearMates(this._id, out gearMate);
				if (flag4)
				{
					value += gearMate.Neili;
				}
			}
			return value;
		}

		// Token: 0x06006C4C RID: 27724 RVA: 0x003CC06C File Offset: 0x003CA26C
		private bool TryGetFixedSubAttributeValue(out short fixedSubAttributeValue)
		{
			bool fixMaxValue = DomainManager.SpecialEffect.ModifyData(this._id, -1, 17, false, -1, -1, -1);
			bool fixMinValue = DomainManager.SpecialEffect.ModifyData(this._id, -1, 18, false, -1, -1, -1);
			bool hasFixed = fixMaxValue != fixMinValue;
			bool flag = hasFixed;
			if (flag)
			{
				fixedSubAttributeValue = (fixMaxValue ? 1000 : 0);
			}
			else
			{
				fixedSubAttributeValue = -1;
			}
			return hasFixed;
		}

		// Token: 0x06006C4D RID: 27725 RVA: 0x003CC0D0 File Offset: 0x003CA2D0
		private int CalcOverloadBonus(int value, IReadOnlyList<int> configBonus)
		{
			bool ignoreOverload = DomainManager.SpecialEffect.ModifyData(this._id, -1, 279, false, -1, -1, -1);
			bool flag = ignoreOverload;
			int result;
			if (flag)
			{
				result = value;
			}
			else
			{
				int curLoad = this.GetCurrEquipmentLoad();
				int maxLoad = this.GetMaxEquipmentLoad();
				bool flag2 = curLoad <= maxLoad || maxLoad <= 0;
				if (flag2)
				{
					result = value;
				}
				else
				{
					int index = Math.Min((curLoad - 1) / maxLoad - 1, configBonus.Count - 1);
					CValuePercent percent = configBonus[index];
					result = value * percent;
				}
			}
			return result;
		}

		// Token: 0x06006C4E RID: 27726 RVA: 0x003CC160 File Offset: 0x003CA360
		private int CalcTreasuryGuardBonus(int value)
		{
			return value * GlobalConfig.Instance.TreasuryGuardPropertyPercent;
		}

		// Token: 0x06006C4F RID: 27727 RVA: 0x003CC188 File Offset: 0x003CA388
		private bool IsFeatureMakeRelated()
		{
			for (int i = 0; i < this._featureIds.Count; i++)
			{
				bool makeConsummateLevelRelated = CharacterFeature.Instance[this._featureIds[i]].MakeConsummateLevelRelated;
				if (makeConsummateLevelRelated)
				{
					return true;
				}
			}
			return false;
		}

		// Token: 0x06006C50 RID: 27728 RVA: 0x003CC1D8 File Offset: 0x003CA3D8
		private int CalcMainAttributeRelatedConsummateLevel(ushort affectedDataFieldId, sbyte mainAttributeType, int hitOrInnerType, int divisor)
		{
			bool relatedConsummateLevel = DomainManager.SpecialEffect.ModifyData(this._id, -1, affectedDataFieldId, false, (int)mainAttributeType, hitOrInnerType, -1);
			short mainAttributeValue = this.GetMaxMainAttribute(mainAttributeType);
			int addValue = (int)(100 + mainAttributeValue / 2);
			int consummateLevelAddValue = (int)mainAttributeValue / divisor * (int)this._consummateLevel;
			bool flag = relatedConsummateLevel;
			if (flag)
			{
				addValue += consummateLevelAddValue;
			}
			bool flag2 = this.IsFeatureMakeRelated();
			if (flag2)
			{
				addValue += consummateLevelAddValue;
			}
			return addValue;
		}

		// Token: 0x17000476 RID: 1142
		// (get) Token: 0x06006C51 RID: 27729 RVA: 0x003CC23A File Offset: 0x003CA43A
		public bool IsGearMate
		{
			get
			{
				return this.GetTemplateId() == 836;
			}
		}

		// Token: 0x06006C52 RID: 27730 RVA: 0x003CC24C File Offset: 0x003CA44C
		public void AddEquippedCombatSkill(DataContext context, short skillTemplateId)
		{
			bool flag = skillTemplateId >= 0;
			if (flag)
			{
				CombatSkillItem skillCfg = Config.CombatSkill.Instance[skillTemplateId];
				sbyte equipType = skillCfg.EquipType;
				GameData.Domains.CombatSkill.CombatSkill skill = DomainManager.CombatSkill.GetElement_CombatSkills(new CombatSkillKey(this._id, skillTemplateId));
				bool revoked = skill.GetRevoked();
				if (revoked)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 2);
					defaultInterpolatedStringHandler.AppendLiteral("Combat skill ");
					defaultInterpolatedStringHandler.AppendFormatted(skillCfg.Name);
					defaultInterpolatedStringHandler.AppendLiteral(" of character ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
					defaultInterpolatedStringHandler.AppendLiteral(" is revoked");
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				sbyte skillRequiredSlotCount = this.GetCombatSkillGridCost(skillTemplateId);
				int availableSlotCount = (int)this.GetCombatSkillSlotCountWithGeneric(equipType) - this.GetCombatSkillTypeRequireGrid(equipType);
				bool flag2 = availableSlotCount < (int)skillRequiredSlotCount;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(55, 3);
					defaultInterpolatedStringHandler.AppendLiteral("Combat skill ");
					defaultInterpolatedStringHandler.AppendFormatted(skillCfg.Name);
					defaultInterpolatedStringHandler.AppendLiteral(" exceed slot count: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(availableSlotCount);
					defaultInterpolatedStringHandler.AppendLiteral(" available, ");
					defaultInterpolatedStringHandler.AppendFormatted<sbyte>(skillRequiredSlotCount);
					defaultInterpolatedStringHandler.AppendLiteral(" required.");
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
			CombatSkillEquipment combatSkillEquipment = this.GetCombatSkillEquipment();
			combatSkillEquipment.OfflineAddSkill(skillTemplateId);
			this.ApplyCombatSkillEquipmentModification(context, combatSkillEquipment);
		}

		// Token: 0x06006C53 RID: 27731 RVA: 0x003CC3A4 File Offset: 0x003CA5A4
		public void RemoveEquippedCombatSkill(DataContext context, short skillTemplateId)
		{
			CombatSkillEquipment combatSkillEquipment = this.GetCombatSkillEquipment();
			bool flag = combatSkillEquipment.OfflineRemoveSkill(skillTemplateId);
			if (flag)
			{
				this.ApplyCombatSkillEquipmentModification(context, combatSkillEquipment);
			}
		}

		// Token: 0x06006C54 RID: 27732 RVA: 0x003CC3D0 File Offset: 0x003CA5D0
		public void ClearCombatSkillEquipment(DataContext context)
		{
			CombatSkillHelper.InitializeEquippedSkills(this._equippedCombatSkills);
			this.SetEquippedCombatSkills(this._equippedCombatSkills, context);
			DomainManager.Extra.RemoveCharacterEquippedCombatSkills(context, this._id);
			DomainManager.SpecialEffect.UpdateEquippedSkillEffect(context, this);
			bool flag = this.IsTaiwu();
			if (flag)
			{
				byte[] genericGridAllocation = DomainManager.Taiwu.GetGenericGridAllocation();
				Array.Fill<byte>(genericGridAllocation, 0);
				DomainManager.Taiwu.SetGenericGridAllocation(context, genericGridAllocation);
			}
			else
			{
				bool flag2 = this._leaderId == DomainManager.Taiwu.GetTaiwuCharId();
				if (flag2)
				{
					CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(this._id);
					bool flag3 = configuration == null;
					if (!flag3)
					{
						Array.Fill<byte>(configuration.CurrentEquipPlan.GenericGridAllocation, 0);
						DomainManager.Extra.SetCharacterCombatSkillConfiguration(context, this._id, configuration);
					}
				}
			}
		}

		// Token: 0x06006C55 RID: 27733 RVA: 0x003CC4A0 File Offset: 0x003CA6A0
		public unsafe bool ClearExceededCombatSkills(DataContext context, sbyte equipType)
		{
			Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)5], 5);
			Span<sbyte> gridCounts = span;
			this.GetCombatSkillSlotCountsWithGeneric(gridCounts);
			return this.ClearExceededCombatSkills(context, equipType, (int)(*gridCounts[(int)equipType]));
		}

		// Token: 0x06006C56 RID: 27734 RVA: 0x003CC4D8 File Offset: 0x003CA6D8
		public bool ClearExceededCombatSkills(DataContext context, sbyte equipType, int slotCount)
		{
			int requiredGrid = this.GetCombatSkillTypeRequireGrid(equipType);
			CombatSkillEquipment skillEquipment = this.GetCombatSkillEquipment();
			bool isChanged = false;
			while (requiredGrid > slotCount)
			{
				short removedSkillId = skillEquipment.OfflineRemoveLastSkill(equipType);
				bool flag = removedSkillId < 0;
				if (flag)
				{
					break;
				}
				requiredGrid -= (int)this.GetCombatSkillGridCost(removedSkillId);
				isChanged = true;
			}
			bool flag2 = isChanged;
			if (flag2)
			{
				this.ApplyCombatSkillEquipmentModification(context, skillEquipment);
			}
			return isChanged;
		}

		// Token: 0x06006C57 RID: 27735 RVA: 0x003CC53C File Offset: 0x003CA73C
		public void UpdateAllocatedGenericGrids(DataContext context)
		{
			int totalGenericGrid = (int)this.GetCombatSkillGenericSlotCount();
			CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(this._id);
			bool isTaiwu = this.IsTaiwu();
			byte[] genericGridAllocation = isTaiwu ? DomainManager.Taiwu.GetGenericGridAllocation() : ((configuration != null) ? configuration.CurrentEquipPlan.GenericGridAllocation : null);
			bool flag = genericGridAllocation == null;
			if (!flag)
			{
				bool isChanged = false;
				for (int i = 0; i < genericGridAllocation.Length; i++)
				{
					sbyte equipType = (sbyte)(i + 1);
					byte allocatedGridCount = genericGridAllocation[i];
					sbyte maxSlotCount = CombatSkillHelper.MaxSlotCounts[(int)equipType];
					byte allocatableGenericGridCount = (byte)(maxSlotCount - this.GetCombatSkillBasicSlotCount(equipType));
					bool flag2 = allocatedGridCount > allocatableGenericGridCount;
					if (flag2)
					{
						allocatedGridCount = allocatableGenericGridCount;
						genericGridAllocation[i] = allocatedGridCount;
						isChanged = true;
					}
					int allocationCost = CombatSkillHelper.GetGenericAllocationTotalCost(equipType, (int)allocatedGridCount);
					bool flag3 = totalGenericGrid >= allocationCost;
					if (flag3)
					{
						totalGenericGrid -= allocationCost;
					}
					else
					{
						do
						{
							allocatedGridCount -= 1;
							allocationCost = CombatSkillHelper.GetGenericAllocationTotalCost(equipType, (int)allocatedGridCount);
						}
						while (totalGenericGrid < allocationCost && allocatedGridCount > 0);
						genericGridAllocation[i] = allocatedGridCount;
						totalGenericGrid -= allocationCost;
						isChanged = true;
					}
				}
				bool flag4 = !isChanged;
				if (!flag4)
				{
					bool flag5 = isTaiwu;
					if (flag5)
					{
						DomainManager.Taiwu.SetGenericGridAllocation(context, genericGridAllocation);
					}
					else
					{
						DomainManager.Extra.SetCharacterCombatSkillConfiguration(context, this._id, configuration);
					}
				}
			}
		}

		// Token: 0x06006C58 RID: 27736 RVA: 0x003CC68C File Offset: 0x003CA88C
		public void ApplyCombatSkillEquipmentModification(DataContext context, CombatSkillEquipment combatSkillEquipment)
		{
			this.SetEquippedCombatSkills(this._equippedCombatSkills, context);
			CombatSkillPlan source = combatSkillEquipment.GetSourceObject<CombatSkillPlan>();
			bool flag = source != null;
			if (flag)
			{
				DomainManager.Extra.SetCharacterEquippedCombatSkills(context, this._id, source);
			}
			else
			{
				DomainManager.Extra.RemoveCharacterEquippedCombatSkills(context, this._id);
			}
			this.UpdateAllocatedGenericGrids(context);
			DomainManager.SpecialEffect.UpdateEquippedSkillEffect(context, this);
		}

		// Token: 0x06006C59 RID: 27737 RVA: 0x003CC6F4 File Offset: 0x003CA8F4
		public bool IsCombatSkillEquipped(short skillTemplateId)
		{
			CombatSkillEquipment combatSkillEquipment = this.GetCombatSkillEquipment();
			return combatSkillEquipment.IsCombatSkillEquipped(skillTemplateId);
		}

		// Token: 0x06006C5A RID: 27738 RVA: 0x003CC714 File Offset: 0x003CA914
		internal void CopyCombatSkillEquipmentFrom(DataContext context, Character other)
		{
			this.SetEquippedCombatSkills(other._equippedCombatSkills.ToArray<short>(), context);
			CombatSkillPlan otherCombatSkillPlan;
			bool flag = DomainManager.Extra.TryGetCharacterEquippedCombatSkills(other._id, out otherCombatSkillPlan);
			if (flag)
			{
				CombatSkillPlan selfCombatSkillPlan;
				bool flag2 = DomainManager.Extra.TryGetCharacterEquippedCombatSkills(this._id, out selfCombatSkillPlan);
				if (flag2)
				{
					selfCombatSkillPlan.Assign(otherCombatSkillPlan);
				}
				else
				{
					selfCombatSkillPlan = new CombatSkillPlan(otherCombatSkillPlan);
				}
				DomainManager.Extra.SetCharacterEquippedCombatSkills(context, this._id, selfCombatSkillPlan);
			}
			else
			{
				DomainManager.Extra.RemoveCharacterEquippedCombatSkills(context, this._id);
			}
			DomainManager.SpecialEffect.UpdateEquippedSkillEffect(context, this);
		}

		// Token: 0x06006C5B RID: 27739 RVA: 0x003CC7A8 File Offset: 0x003CA9A8
		public sbyte GetCombatSkillGridCost(short skillTemplateId)
		{
			sbyte gridCost = Config.CombatSkill.Instance[skillTemplateId].GridCost;
			bool flag = this._id == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				gridCost = (sbyte)DomainManager.SpecialEffect.ModifyData(this._id, skillTemplateId, 211, (int)gridCost, -1, -1, -1);
			}
			bool flag2 = DomainManager.Extra.IsCombatSkillMasteredByCharacter(this._id, skillTemplateId);
			if (flag2)
			{
				gridCost -= 1;
			}
			return Math.Max(gridCost, 1);
		}

		// Token: 0x06006C5C RID: 27740 RVA: 0x003CC820 File Offset: 0x003CAA20
		public unsafe int GetCombatSkillTypeRequireGrid(sbyte combatSkillEquipType)
		{
			int require = 0;
			ArraySegmentList<short> skillIds = *this.GetCombatSkillEquipment()[combatSkillEquipType];
			foreach (short ptr in skillIds)
			{
				short skillId = ptr;
				bool flag = skillId >= 0;
				if (flag)
				{
					require += (int)this.GetCombatSkillGridCost(skillId);
				}
			}
			return require;
		}

		// Token: 0x06006C5D RID: 27741 RVA: 0x003CC880 File Offset: 0x003CAA80
		public unsafe bool GetCombatSkillCanAffect(short skillTemplateId)
		{
			bool flag = skillTemplateId < 0;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = this._leaderId != DomainManager.Taiwu.GetTaiwuCharId();
				if (flag2)
				{
					result = true;
				}
				else
				{
					sbyte equipType = Config.CombatSkill.Instance[skillTemplateId].EquipType;
					CombatSkillEquipment skillEquipment = this.GetCombatSkillEquipment();
					int equipIndex = (*skillEquipment[equipType]).IndexOf(skillTemplateId);
					bool flag3 = equipIndex < 0;
					if (flag3)
					{
						result = true;
					}
					else
					{
						bool flag4 = !this.GetCombatSkillCanAffectBasic(skillTemplateId);
						if (flag4)
						{
							result = false;
						}
						else
						{
							sbyte slotCount = this.GetCombatSkillSlotCountWithGeneric(equipType);
							int require = 0;
							ArraySegmentList<short> skillIds = *skillEquipment[equipType];
							for (int i = 0; i < skillIds.Count; i++)
							{
								short skillId = *skillIds[i];
								require += (int)this.GetCombatSkillGridCost(skillId);
								bool flag5 = skillId == skillTemplateId;
								if (flag5)
								{
									return require <= (int)slotCount;
								}
							}
							result = false;
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006C5E RID: 27742 RVA: 0x003CC984 File Offset: 0x003CAB84
		private bool GetCombatSkillCanAffectBasic(short skillTemplateId)
		{
			return !this.IsTaiwu() || DomainManager.Extra.GetConflictCombatSkill(skillTemplateId) == null;
		}

		// Token: 0x06006C5F RID: 27743 RVA: 0x003CC9B0 File Offset: 0x003CABB0
		public GameData.Domains.CombatSkill.CombatSkill LearnNewCombatSkill(DataContext context, short combatSkillTemplateId, ushort readingState)
		{
			GameData.Domains.CombatSkill.CombatSkill skill = DomainManager.CombatSkill.CreateCombatSkill(this._id, combatSkillTemplateId, readingState);
			this._learnedCombatSkills.Add(combatSkillTemplateId);
			this.SetLearnedCombatSkills(this._learnedCombatSkills, context);
			bool flag = this._id == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				DomainManager.Taiwu.RegisterCombatSkill(context, skill);
				DomainManager.Taiwu.AddLegacyPoint(context, 20, 100);
			}
			return skill;
		}

		// Token: 0x06006C60 RID: 27744 RVA: 0x003CCA28 File Offset: 0x003CAC28
		public void GetLearnedCombatSkillsFromSect(List<short> result, sbyte orgTemplateId, sbyte minGrade = 0, sbyte maxGrade = 8)
		{
			result.Clear();
			foreach (short skillTemplateId in this._learnedCombatSkills)
			{
				CombatSkillItem skillCfg = Config.CombatSkill.Instance[skillTemplateId];
				bool flag = skillCfg.SectId != orgTemplateId;
				if (!flag)
				{
					bool flag2 = skillCfg.Grade < minGrade || skillCfg.Grade > maxGrade;
					if (!flag2)
					{
						result.Add(skillTemplateId);
					}
				}
			}
		}

		// Token: 0x06006C61 RID: 27745 RVA: 0x003CCAC4 File Offset: 0x003CACC4
		public sbyte GetLearnedCombatSkillMaxGradeByType(sbyte combatSkillType)
		{
			sbyte grade = 0;
			int i = 0;
			int count = this._learnedCombatSkills.Count;
			while (i < count)
			{
				short templateId = this._learnedCombatSkills[i];
				CombatSkillItem skillItem = Config.CombatSkill.Instance[templateId];
				bool flag = skillItem.Type != combatSkillType;
				if (!flag)
				{
					bool flag2 = skillItem.Grade > grade;
					if (flag2)
					{
						grade = skillItem.Grade;
					}
				}
				i++;
			}
			return grade;
		}

		// Token: 0x06006C62 RID: 27746 RVA: 0x003CCB44 File Offset: 0x003CAD44
		public int GetLearnedCombatSkillTotalValue(sbyte lifeSkillType)
		{
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> combatSkills = DomainManager.CombatSkill.GetCharCombatSkills(this._id);
			int totalValue = 0;
			foreach (KeyValuePair<short, GameData.Domains.CombatSkill.CombatSkill> keyValuePair in combatSkills)
			{
				short num;
				GameData.Domains.CombatSkill.CombatSkill combatSkill2;
				keyValuePair.Deconstruct(out num, out combatSkill2);
				GameData.Domains.CombatSkill.CombatSkill combatSkill = combatSkill2;
				bool flag = combatSkill.Template.Type != lifeSkillType;
				if (!flag)
				{
					int baseValue = ItemTemplateHelper.GetBaseValue(10, combatSkill.Template.BookId);
					int value = baseValue * combatSkill.GetReadNormalPagesCount() / 5;
					totalValue += value;
				}
			}
			return totalValue;
		}

		// Token: 0x06006C63 RID: 27747 RVA: 0x003CCC00 File Offset: 0x003CAE00
		public unsafe short GetCombatSkillAttainment(sbyte combatSkillType)
		{
			ref CombatSkillShorts attainments = ref this.GetCombatSkillAttainments();
			return *(ref attainments.Items.FixedElementField + (IntPtr)combatSkillType * 2);
		}

		// Token: 0x06006C64 RID: 27748 RVA: 0x003CCC2C File Offset: 0x003CAE2C
		public unsafe short GetCombatSkillQualification(sbyte combatSkillType)
		{
			ref CombatSkillShorts qualifications = ref this.GetCombatSkillQualifications();
			return *(ref qualifications.Items.FixedElementField + (IntPtr)combatSkillType * 2);
		}

		// Token: 0x06006C65 RID: 27749 RVA: 0x003CCC58 File Offset: 0x003CAE58
		public int GetSkillBreakoutStepsMaxPower(short combatSkillTemplateId)
		{
			bool flag = this.IsTaiwu();
			int result;
			if (flag)
			{
				GameData.Domains.CombatSkill.CombatSkill combatSkill;
				result = (DomainManager.CombatSkill.TryGetElement_CombatSkills(new ValueTuple<int, short>(this._id, combatSkillTemplateId), out combatSkill) ? combatSkill.GetPlateAddMaxPower() : 0);
			}
			else
			{
				bool isGearMate = this.IsGearMate;
				if (isGearMate)
				{
					GearMate gearMate = DomainManager.Extra.GetGearMateById(this._id);
					CombatSkillKey gearMateSkillKey = new CombatSkillKey(this._id, combatSkillTemplateId);
					GameData.Domains.CombatSkill.CombatSkill gearMateSkill;
					bool flag2 = !DomainManager.CombatSkill.TryGetElement_CombatSkills(gearMateSkillKey, out gearMateSkill);
					if (flag2)
					{
						return 0;
					}
					bool broken = CombatSkillStateHelper.IsBrokenOut(gearMateSkill.GetActivationState());
					bool flag3 = !broken;
					if (flag3)
					{
						return 0;
					}
					int maxPower;
					bool flag4 = gearMate.SkillBreakMaxPowerDict.TryGetValue(combatSkillTemplateId, out maxPower);
					if (flag4)
					{
						return maxPower;
					}
				}
				CombatSkillItem skillCfg = Config.CombatSkill.Instance[combatSkillTemplateId];
				int percentage = this.GetSkillBreakoutStepsPercentage(combatSkillTemplateId);
				result = (int)skillCfg.SkillBreakPlate.TotalMaxPower * percentage / 100;
			}
			return result;
		}

		// Token: 0x06006C66 RID: 27750 RVA: 0x003CCD4C File Offset: 0x003CAF4C
		public int GetSkillBreakoutStepsPercentage(short combatSkillTemplateId)
		{
			sbyte stepsCount = this.GetSkillBreakoutAvailableStepsCount(combatSkillTemplateId);
			return (int)(stepsCount * 100 / GlobalConfig.Instance.BreakoutBaseAvailableStepsCount);
		}

		// Token: 0x06006C67 RID: 27751 RVA: 0x003CCD78 File Offset: 0x003CAF78
		public sbyte GetSkillBreakoutAvailableStepsCount(short combatSkillTemplateId)
		{
			bool flag = this._creatingType != 1;
			sbyte result;
			if (flag)
			{
				result = GlobalConfig.Instance.BreakoutSpecialNpcStepsCount;
			}
			else
			{
				CombatSkillItem combatSkillConfig = Config.CombatSkill.Instance[combatSkillTemplateId];
				SkillGradeDataItem skillGradeConfig = SkillGradeData.Instance[combatSkillConfig.Grade];
				bool isTaiwu = this.IsTaiwu();
				short requiredQualification = skillGradeConfig.PracticeQualificationRequirement;
				short qualification = this.GetCombatSkillQualification(combatSkillConfig.Type);
				bool flag2 = isTaiwu;
				if (flag2)
				{
					qualification = DomainManager.Taiwu.GetQualificationWithSectApprovalBonus(combatSkillConfig.SectId, qualification, requiredQualification);
				}
				int availableStepsCount = (qualification >= requiredQualification) ? ((int)GlobalConfig.Instance.BreakoutBaseAvailableStepsCount) : ((qualification >= requiredQualification / 2) ? Math.Min((int)(15 * qualification / Math.Max(1, requiredQualification)), 15) : Math.Min((int)(10 * qualification / Math.Max(1, requiredQualification)), 10));
				Location location = this.GetValidLocation();
				bool flag3 = this._creatingType == 1;
				if (flag3)
				{
					availableStepsCount += DomainManager.Building.GetBuildingBlockEffect(location, EBuildingScaleEffect.BreakOutSteps, -1);
				}
				int consummateLevel = (int)(this.IsLoseConsummateBonusByFeature() ? 0 : this.GetConsummateLevel());
				availableStepsCount += ConsummateLevel.Instance[consummateLevel].AddBreakStepCount;
				bool flag4 = !isTaiwu;
				if (flag4)
				{
					availableStepsCount += (int)(this.GetInteractionGrade() - 3);
				}
				else
				{
					bool flag5 = location.IsValid();
					if (flag5)
					{
						AreaAdventureData adventuresInArea = DomainManager.Adventure.GetAdventuresInArea(location.AreaId);
						AdventureSiteData site;
						bool flag6 = adventuresInArea.AdventureSites.TryGetValue(location.BlockId, out site) && site.SiteState >= 2 && site.TemplateId == 42;
						if (flag6)
						{
							availableStepsCount += 3;
						}
					}
					bool flag7 = combatSkillConfig.SectId != 0;
					if (flag7)
					{
						short settlementId = DomainManager.Organization.GetSettlementIdByOrgTemplateId(combatSkillConfig.SectId);
						Sect sect = DomainManager.Organization.GetElement_Sects(settlementId);
						short approvingRate = sect.CalcApprovingRate();
						bool flag8 = approvingRate >= 700;
						if (flag8)
						{
							availableStepsCount += 3;
						}
					}
				}
				result = (sbyte)Math.Clamp(availableStepsCount, (int)GlobalConfig.Instance.BreakoutMinAvailableStepsCount, (int)GlobalConfig.Instance.BreakoutMaxAvailableStepsCount);
			}
			return result;
		}

		// Token: 0x06006C68 RID: 27752 RVA: 0x003CCF88 File Offset: 0x003CB188
		public unsafe int GetPropertyValue(ECharacterPropertyReferencedType type)
		{
			if (type >= ECharacterPropertyReferencedType.AttainmentMusic)
			{
				if (type >= ECharacterPropertyReferencedType.AttainmentNeigong)
				{
					if (type <= ECharacterPropertyReferencedType.AttainmentCombatMusic)
					{
						ref CombatSkillShorts attainments = ref this.GetCombatSkillAttainments();
						int index = 0 + type - ECharacterPropertyReferencedType.AttainmentNeigong;
						return (int)(*(ref attainments.Items.FixedElementField + (IntPtr)index * 2));
					}
				}
				else if (type <= ECharacterPropertyReferencedType.AttainmentEclectic)
				{
					ref LifeSkillShorts attainments2 = ref this.GetLifeSkillAttainments();
					int index2 = 0 + type - ECharacterPropertyReferencedType.AttainmentMusic;
					return (int)(*(ref attainments2.Items.FixedElementField + (IntPtr)index2 * 2));
				}
			}
			else if (type >= ECharacterPropertyReferencedType.Strength)
			{
				if (type <= ECharacterPropertyReferencedType.Intelligence)
				{
					MainAttributes mainAttributes = this.GetMaxMainAttributes();
					int index3 = 0 + type - ECharacterPropertyReferencedType.Strength;
					return (int)(*(ref mainAttributes.Items.FixedElementField + (IntPtr)index3 * 2));
				}
			}
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(44, 1);
			defaultInterpolatedStringHandler.AppendLiteral("Cannot get value of character property type ");
			defaultInterpolatedStringHandler.AppendFormatted<ECharacterPropertyReferencedType>(type);
			throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x06006C69 RID: 27753 RVA: 0x003CD064 File Offset: 0x003CB264
		public unsafe void ModifyBasePropertyValue(DataContext context, ECharacterPropertyReferencedType type, int delta)
		{
			if (type >= ECharacterPropertyReferencedType.QualificationMusic)
			{
				if (type >= ECharacterPropertyReferencedType.QualificationNeigong)
				{
					if (type <= ECharacterPropertyReferencedType.QualificationCombatMusic)
					{
						int index = 0 + type - ECharacterPropertyReferencedType.QualificationNeigong;
						int value = (int)(*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)index * 2)) + delta;
						bool flag = value < 0;
						if (flag)
						{
							value = 0;
						}
						*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)index * 2) = (short)value;
						this.SetBaseCombatSkillQualifications(ref this._baseCombatSkillQualifications, context);
						return;
					}
				}
				else if (type <= ECharacterPropertyReferencedType.QualificationEclectic)
				{
					int index2 = 0 + type - ECharacterPropertyReferencedType.QualificationMusic;
					int value2 = (int)(*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)index2 * 2)) + delta;
					bool flag2 = value2 < 0;
					if (flag2)
					{
						value2 = 0;
					}
					*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)index2 * 2) = (short)value2;
					this.SetBaseLifeSkillQualifications(ref this._baseLifeSkillQualifications, context);
					return;
				}
			}
			else if (type >= ECharacterPropertyReferencedType.Strength)
			{
				if (type <= ECharacterPropertyReferencedType.Intelligence)
				{
					int index3 = 0 + type - ECharacterPropertyReferencedType.Strength;
					int value3 = (int)(*(ref this._baseMainAttributes.Items.FixedElementField + (IntPtr)index3 * 2)) + delta;
					bool flag3 = value3 < 0;
					if (flag3)
					{
						value3 = 0;
					}
					*(ref this._baseMainAttributes.Items.FixedElementField + (IntPtr)index3 * 2) = (short)value3;
					this.SetBaseMainAttributes(this._baseMainAttributes, context);
					return;
				}
			}
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(44, 1);
			defaultInterpolatedStringHandler.AppendLiteral("Cannot get value of character property type ");
			defaultInterpolatedStringHandler.AppendFormatted<ECharacterPropertyReferencedType>(type);
			throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x17000477 RID: 1143
		// (get) Token: 0x06006C6A RID: 27754 RVA: 0x003CD1E6 File Offset: 0x003CB3E6
		public CharacterItem Template
		{
			get
			{
				return Character.Instance[this._templateId];
			}
		}

		// Token: 0x17000478 RID: 1144
		// (get) Token: 0x06006C6B RID: 27755 RVA: 0x003CD1F8 File Offset: 0x003CB3F8
		public bool IsFavorabilityGainFixed
		{
			get
			{
				bool result;
				if (this._creatingType == 1)
				{
					short templateId = this._templateId;
					result = (templateId <= 466 && templateId >= 463);
				}
				else
				{
					result = true;
				}
				return result;
			}
		}

		// Token: 0x06006C6C RID: 27756 RVA: 0x003CD230 File Offset: 0x003CB430
		public static bool IsCharacterIdValid(int charId)
		{
			return charId >= 0;
		}

		// Token: 0x06006C6D RID: 27757 RVA: 0x003CD24C File Offset: 0x003CB44C
		public static bool IsOppositeGender(Character characterA, Character characterB)
		{
			return characterA._transgender || characterB.CheckGenderMeetsRequirement(Gender.Flip(characterA._gender));
		}

		// Token: 0x06006C6E RID: 27758 RVA: 0x003CD27C File Offset: 0x003CB47C
		public int GetAdjustedResourceSatisfyingThreshold(sbyte resourceType)
		{
			OrganizationMemberItem memberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
			return memberCfg.GetAdjustedResourceSatisfyingThreshold(resourceType);
		}

		// Token: 0x06006C6F RID: 27759 RVA: 0x003CD2A4 File Offset: 0x003CB4A4
		public int GetAdjustedResourceSatisfyingAmount(sbyte resourceType)
		{
			OrganizationMemberItem memberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
			return memberCfg.GetAdjustedResourceSatisfyingAmount(resourceType);
		}

		// Token: 0x06006C70 RID: 27760 RVA: 0x003CD2CC File Offset: 0x003CB4CC
		public bool IdentifyCanCraftItem(sbyte itemType, short itemTemplateId)
		{
			OrganizationMemberItem memberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
			return memberCfg.CanCraftItem(itemType, itemTemplateId);
		}

		// Token: 0x06006C71 RID: 27761 RVA: 0x003CD2F4 File Offset: 0x003CB4F4
		public int GetExpPerMonth()
		{
			OrganizationMemberItem memberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
			int expPerMonth = (int)memberCfg.ExpPerMonth;
			bool flag = this._organizationInfo.SettlementId >= 0 && OrganizationDomain.IsSect(this._organizationInfo.OrgTemplateId);
			if (flag)
			{
				Settlement settlement = DomainManager.Organization.GetSettlement(this._organizationInfo.SettlementId);
				expPerMonth = expPerMonth * settlement.GetMemberSelfImproveSpeedFactor() / 100;
			}
			return expPerMonth;
		}

		// Token: 0x06006C72 RID: 27762 RVA: 0x003CD368 File Offset: 0x003CB568
		public int GetContributionPerMonth()
		{
			OrganizationMemberItem memberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
			int contributionPerMonth = memberCfg.ContributionPerMonth;
			bool flag = this._organizationInfo.SettlementId >= 0 && OrganizationDomain.IsSect(this._organizationInfo.OrgTemplateId);
			if (flag)
			{
				Settlement settlement = DomainManager.Organization.GetSettlement(this._organizationInfo.SettlementId);
				contributionPerMonth = contributionPerMonth * settlement.GetMemberSelfImproveSpeedFactor() / 100;
			}
			return contributionPerMonth;
		}

		// Token: 0x06006C73 RID: 27763 RVA: 0x003CD3DC File Offset: 0x003CB5DC
		public bool OrgAndMonkTypeAllowMarriage()
		{
			return this._monkType == 0 && OrganizationDomain.GetOrgMemberConfig(this._organizationInfo).ChildGrade >= 0;
		}

		// Token: 0x06006C74 RID: 27764 RVA: 0x003CD410 File Offset: 0x003CB610
		public sbyte GetLegendaryBookOwnerState()
		{
			bool flag = DomainManager.Extra.IsLegendaryBookConsumed(this._id);
			sbyte result;
			if (flag)
			{
				result = 3;
			}
			else
			{
				bool flag2 = DomainManager.LegendaryBook.GetCharOwnedBookTypes(this._id) == null;
				if (flag2)
				{
					result = -1;
				}
				else
				{
					bool flag3 = this._featureIds.Contains(204);
					if (flag3)
					{
						result = 1;
					}
					else
					{
						bool flag4 = this._featureIds.Contains(205);
						if (flag4)
						{
							result = 2;
						}
						else
						{
							result = 0;
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006C75 RID: 27765 RVA: 0x003CD488 File Offset: 0x003CB688
		public bool IsCreatedWithFixedTemplate()
		{
			return CreatingType.IsFixedPresetType(this._creatingType);
		}

		// Token: 0x06006C76 RID: 27766 RVA: 0x003CD4A8 File Offset: 0x003CB6A8
		public int GetSrcCharId()
		{
			return this._srcCharId;
		}

		// Token: 0x06006C77 RID: 27767 RVA: 0x003CD4C0 File Offset: 0x003CB6C0
		public sbyte GetAgeGroup()
		{
			return AgeGroup.GetAgeGroup(this._currAge);
		}

		// Token: 0x06006C78 RID: 27768 RVA: 0x003CD4E0 File Offset: 0x003CB6E0
		public EMarriageAgeGroup GetMarriageAgeGroup()
		{
			return MarriageAgeGroupHelper.GetMarriageAgeGroup((int)this._currAge);
		}

		// Token: 0x06006C79 RID: 27769 RVA: 0x003CD500 File Offset: 0x003CB700
		public bool CheckGenderMeetsRequirement(sbyte requiredGender)
		{
			return this._gender == requiredGender || this._transgender;
		}

		// Token: 0x06006C7A RID: 27770 RVA: 0x003CD524 File Offset: 0x003CB724
		public bool CheckSexualOrientationMeetsRequirement(sbyte sexualOrientation)
		{
			return sexualOrientation == -1 || (sexualOrientation == 1 && this._bisexual) || (sexualOrientation == 0 && !this._bisexual);
		}

		// Token: 0x06006C7B RID: 27771 RVA: 0x003CD558 File Offset: 0x003CB758
		public sbyte GetDisplayingGender()
		{
			return this._transgender ? Gender.Flip(this._gender) : this._gender;
		}

		// Token: 0x06006C7C RID: 27772 RVA: 0x003CD588 File Offset: 0x003CB788
		public sbyte GetInteractionGrade()
		{
			bool flag = DomainManager.Taiwu.GetTaiwuCharId() == this._id;
			sbyte result;
			if (flag)
			{
				result = MathUtils.Clamp(DomainManager.World.GetXiangshuLevel(), 0, 8);
			}
			else
			{
				result = this._organizationInfo.Grade;
			}
			return result;
		}

		// Token: 0x06006C7D RID: 27773 RVA: 0x003CD5D0 File Offset: 0x003CB7D0
		public bool IsInTaiwuGroup()
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			return this._id == taiwuCharId || this._leaderId == taiwuCharId;
		}

		// Token: 0x06006C7E RID: 27774 RVA: 0x003CD604 File Offset: 0x003CB804
		public bool IsTaiwu()
		{
			return this._id == DomainManager.Taiwu.GetTaiwuCharId();
		}

		// Token: 0x06006C7F RID: 27775 RVA: 0x003CD628 File Offset: 0x003CB828
		public bool IsInteractableAsIntelligentCharacter()
		{
			return CharacterMatcher.DefValue.CanInteractAsIntelligentCharacter.Match(this);
		}

		// Token: 0x06006C80 RID: 27776 RVA: 0x003CD638 File Offset: 0x003CB838
		public bool IsTreasuryGuard()
		{
			return this.GetGroupFeature(536) >= 0;
		}

		// Token: 0x06006C81 RID: 27777 RVA: 0x003CD65C File Offset: 0x003CB85C
		public void TryRetireTreasuryGuard(DataContext context)
		{
			bool flag = !this.IsTreasuryGuard();
			if (!flag)
			{
				bool flag2 = this._organizationInfo.OrgTemplateId < 0;
				if (!flag2)
				{
					bool flag3 = !OrganizationDomain.IsSect(this._organizationInfo.OrgTemplateId);
					if (!flag3)
					{
						Sect sect;
						bool flag4 = !DomainManager.Organization.TryGetElement_Sects(this._organizationInfo.SettlementId, out sect);
						if (!flag4)
						{
							SettlementLayeredTreasuries treasuries = sect.Treasuries;
							sbyte b;
							bool isModified = treasuries.TryRemoveGuard(this._id, out b);
							bool flag5 = isModified;
							if (flag5)
							{
								this.RemoveFeatureGroup(context, 536);
								sect.ForceUpdateTreasuryGuards(context);
							}
						}
					}
				}
			}
		}

		// Token: 0x06006C82 RID: 27778 RVA: 0x003CD704 File Offset: 0x003CB904
		public bool NeedToAvoidCombat(CombatType combatType)
		{
			int defeatMarkCount = CombatDomain.GetDefeatMarksCountOutOfCombat(this);
			return defeatMarkCount >= (int)AiHelper.CombatRelatedConstants.AvoidCombatDefeatMarkCount[(int)combatType];
		}

		// Token: 0x06006C83 RID: 27779 RVA: 0x003CD72C File Offset: 0x003CB92C
		public bool ReachFallenInCombat(CombatType combatType)
		{
			int defeatMarkCount = CombatDomain.GetDefeatMarksCountOutOfCombat(this);
			return defeatMarkCount >= (int)GlobalConfig.NeedDefeatMarkCount[(int)combatType];
		}

		// Token: 0x06006C84 RID: 27780 RVA: 0x003CD754 File Offset: 0x003CB954
		public unsafe int GetPoisonResist(sbyte poisonType)
		{
			ref PoisonInts poisonResists = ref this.GetPoisonResists();
			return *(ref poisonResists.Items.FixedElementField + (IntPtr)poisonType * 4);
		}

		// Token: 0x06006C85 RID: 27781 RVA: 0x003CD780 File Offset: 0x003CB980
		public bool HasPoisonImmunity(sbyte poisonType)
		{
			return Character.Instance[this._templateId].PoisonImmunities[(int)poisonType] || this.GetPoisonResist(poisonType) >= 1000 || DomainManager.Extra.HasPoisonImmunity(this._id, poisonType);
		}

		// Token: 0x06006C86 RID: 27782 RVA: 0x003CD7D0 File Offset: 0x003CB9D0
		public bool HasInnatePoisonImmunity(sbyte poisonType)
		{
			return Character.Instance[this._templateId].PoisonImmunities[(int)poisonType] || DomainManager.Extra.HasPoisonImmunity(this._id, poisonType);
		}

		// Token: 0x06006C87 RID: 27783 RVA: 0x003CD810 File Offset: 0x003CBA10
		public bool HasAcquiredPoisonImmunity(sbyte poisonType)
		{
			return this.GetPoisonResist(poisonType) >= 1000;
		}

		// Token: 0x06006C88 RID: 27784 RVA: 0x003CD834 File Offset: 0x003CBA34
		public unsafe int GetPoisonMarkCount()
		{
			int count = 0;
			CharacterItem characterCfg = Character.Instance[this._templateId];
			byte poisonImmunities = DomainManager.Extra.GetPoisonImmunities(this._id);
			ref PoisonInts poisonResists = ref this.GetPoisonResists();
			for (sbyte poisonType = 0; poisonType < 6; poisonType += 1)
			{
				bool flag = GameData.Domains.Character.SharedMethods.HasPoisonImmunity(poisonType, characterCfg, ref poisonResists, poisonImmunities);
				if (!flag)
				{
					count += (int)PoisonsAndLevels.CalcPoisonedLevel(*(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType * 4));
				}
			}
			return count;
		}

		// Token: 0x06006C89 RID: 27785 RVA: 0x003CD8C0 File Offset: 0x003CBAC0
		public sbyte GetRandomInjuredBodyPartToHeal(IRandomSource random, bool isInnerInjury, sbyte maxVal)
		{
			List<sbyte> bodyPartRandomPool = ObjectPool<List<sbyte>>.Instance.Get();
			bodyPartRandomPool.Clear();
			for (sbyte bodyPart = 0; bodyPart < 7; bodyPart += 1)
			{
				ValueTuple<sbyte, sbyte> valueTuple = this._injuries.Get(bodyPart);
				sbyte outer = valueTuple.Item1;
				sbyte inner = valueTuple.Item2;
				if (isInnerInjury)
				{
					bool flag = inner > 0 && inner <= maxVal;
					if (flag)
					{
						bodyPartRandomPool.Add(bodyPart);
					}
				}
				else
				{
					bool flag2 = outer > 0 && outer <= maxVal;
					if (flag2)
					{
						bodyPartRandomPool.Add(bodyPart);
					}
				}
			}
			int selectedBodyPart = (int)((bodyPartRandomPool.Count > 0) ? bodyPartRandomPool.GetRandom(random) : -1);
			ObjectPool<List<sbyte>>.Instance.Return(bodyPartRandomPool);
			return (sbyte)selectedBodyPart;
		}

		// Token: 0x06006C8A RID: 27786 RVA: 0x003CD980 File Offset: 0x003CBB80
		public unsafe sbyte GetRandomPoisonTypeToDetox(IRandomSource random, int maxLevel)
		{
			List<sbyte> poisonTypeRandomPool = ObjectPool<List<sbyte>>.Instance.Get();
			poisonTypeRandomPool.Clear();
			for (sbyte poisonType = 0; poisonType < 6; poisonType += 1)
			{
				int poisoned = *(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType * 4);
				sbyte level = PoisonsAndLevels.CalcPoisonedLevel(poisoned);
				bool flag = *(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType * 4) > 0 && (int)level <= maxLevel;
				if (flag)
				{
					poisonTypeRandomPool.Add(poisonType);
				}
			}
			int selectedPoisonType = (int)((poisonTypeRandomPool.Count > 0) ? poisonTypeRandomPool.GetRandom(random) : -1);
			ObjectPool<List<sbyte>>.Instance.Return(poisonTypeRandomPool);
			return (sbyte)selectedPoisonType;
		}

		// Token: 0x06006C8B RID: 27787 RVA: 0x003CDA30 File Offset: 0x003CBC30
		public unsafe void TakeRandomDamage(DataContext context, int damage)
		{
			IRandomSource random = context.Random;
			Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)14], 14);
			SpanList<sbyte> injuryPartRandomPool = span;
			injuryPartRandomPool.Clear();
			for (sbyte part = 0; part < 14; part += 1)
			{
				bool flag = *(ref this._injuries.Items.FixedElementField + part) < 6;
				if (flag)
				{
					injuryPartRandomPool.Add(part);
				}
			}
			for (int i = 0; i < damage; i++)
			{
				bool flag2 = injuryPartRandomPool.Count == 0;
				if (flag2)
				{
					break;
				}
				int index = random.Next(injuryPartRandomPool.Count);
				sbyte part2 = *injuryPartRandomPool[index];
				ref sbyte ptr = ref this._injuries.Items.FixedElementField + part2;
				ptr += 1;
				bool flag3 = *(ref this._injuries.Items.FixedElementField + part2) >= 6;
				if (flag3)
				{
					injuryPartRandomPool.RemoveAt(index);
				}
			}
			this.SetInjuries(this._injuries, context);
		}

		// Token: 0x06006C8C RID: 27788 RVA: 0x003CDB38 File Offset: 0x003CBD38
		public unsafe void TakeRandomDamage(DataContext context, int damage, bool isInnerInjury)
		{
			IRandomSource random = context.Random;
			Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)7], 7);
			SpanList<sbyte> injuryPartRandomPool = span;
			injuryPartRandomPool.Clear();
			for (sbyte part = 0; part < 7; part += 1)
			{
				bool flag = this._injuries.Get(part, isInnerInjury) < 6;
				if (flag)
				{
					injuryPartRandomPool.Add(part);
				}
			}
			for (int i = 0; i < damage; i++)
			{
				bool flag2 = injuryPartRandomPool.Count == 0;
				if (flag2)
				{
					break;
				}
				int index = random.Next(injuryPartRandomPool.Count);
				sbyte part2 = *injuryPartRandomPool[index];
				this._injuries.Change(part2, isInnerInjury, 1);
				bool flag3 = this._injuries.Get(part2, isInnerInjury) >= 6;
				if (flag3)
				{
					injuryPartRandomPool.RemoveAt(index);
				}
			}
			this.SetInjuries(this._injuries, context);
		}

		// Token: 0x06006C8D RID: 27789 RVA: 0x003CDC24 File Offset: 0x003CBE24
		public int GetBirthDate()
		{
			return CharacterDomain.CalcBirthDate(this._actualAge, this._birthMonth);
		}

		// Token: 0x06006C8E RID: 27790 RVA: 0x003CDC48 File Offset: 0x003CBE48
		public short GetLeftMaxHealth(bool obsoleteArg = false)
		{
			bool flag = this._srcCharId >= 0;
			short result;
			if (flag)
			{
				result = this.GetMaxHealth();
			}
			else
			{
				int livedMonths = (!this.IsCompletelyInfected()) ? CharacterDomain.GetLivedMonths(this._currAge, this._birthMonth) : ((int)(this._currAge * 12));
				result = (short)Math.Clamp(0, (int)this.GetMaxHealth() - livedMonths, 32767);
			}
			return result;
		}

		// Token: 0x06006C8F RID: 27791 RVA: 0x003CDCAC File Offset: 0x003CBEAC
		public EHealthType GetHealthType()
		{
			return HealthTypeHelper.CalcType(this._featureIds, this._health, this.GetLeftMaxHealth(false));
		}

		// Token: 0x06006C90 RID: 27792 RVA: 0x003CDCD8 File Offset: 0x003CBED8
		public void MakeLove(DataContext context, Character targetChar, bool isRape)
		{
			Character father = (this._gender == 1) ? this : targetChar;
			Character mother = (this._gender == 0) ? this : targetChar;
			bool isPregnant = this.OfflineMakeLove(context.Random, father, mother, isRape);
			father.SetFeatureIds(father._featureIds, context);
			mother.SetFeatureIds(mother._featureIds, context);
			PeriAdvanceMonthFixedActionModification.MakeLoveState state = isRape ? PeriAdvanceMonthFixedActionModification.MakeLoveState.RapeSucceed : (DomainManager.Character.HasRelation(father.GetId(), mother.GetId(), 1024) ? PeriAdvanceMonthFixedActionModification.MakeLoveState.Legal : PeriAdvanceMonthFixedActionModification.MakeLoveState.Illegal);
			Events.RaiseMakeLove(context, father, mother, (sbyte)state);
			bool flag = isPregnant;
			if (flag)
			{
				DomainManager.Character.CreatePregnantState(context, mother, father, isRape);
			}
		}

		// Token: 0x06006C91 RID: 27793 RVA: 0x003CDD78 File Offset: 0x003CBF78
		public short CalcChangedHealth(short health, int delta)
		{
			short leftMaxHealth = this.GetLeftMaxHealth(false);
			delta = this.CalcHealthDelta(delta);
			return (leftMaxHealth >= 0) ? ((short)Math.Clamp((int)health + delta, 0, (int)leftMaxHealth)) : 0;
		}

		// Token: 0x06006C92 RID: 27794 RVA: 0x003CDDAD File Offset: 0x003CBFAD
		public void ChangeHealth(DataContext context, int delta)
		{
			this._health = this.CalcChangedHealth(this._health, delta);
			this.SetHealth(this._health, context);
		}

		// Token: 0x06006C93 RID: 27795 RVA: 0x003CDDD4 File Offset: 0x003CBFD4
		public void ChangeBaseMaxHealth(DataContext context, int delta, bool autoAdjustHealth = true)
		{
			short leftMaxHealthBefore = this.GetLeftMaxHealth(false);
			short value = (short)Math.Clamp((int)this._baseMaxHealth + delta, 0, 32767);
			this.SetBaseMaxHealth(value, context);
			if (autoAdjustHealth)
			{
				short leftMaxHealthAfter = this.GetLeftMaxHealth(false);
				bool flag = leftMaxHealthAfter != leftMaxHealthBefore;
				if (flag)
				{
					this.ChangeHealth(context, (int)(leftMaxHealthAfter - leftMaxHealthBefore));
				}
			}
		}

		// Token: 0x06006C94 RID: 27796 RVA: 0x003CDE30 File Offset: 0x003CC030
		public void ChangeCurrAge(DataContext context, int delta)
		{
			sbyte prevAgeGroup = this.GetAgeGroup();
			short oldAge = this._currAge;
			short newAge = (short)Math.Clamp((int)this._currAge + delta, 0, 2730);
			this.SetCurrAge(newAge, context);
			Events.RaiseCharacterAgeChanged(context, this, (int)oldAge, (int)newAge);
			sbyte currAgeGroup = this.GetAgeGroup();
			bool flag = prevAgeGroup != currAgeGroup;
			if (flag)
			{
				this.ReAdjustClothingByAge(context);
			}
		}

		// Token: 0x06006C95 RID: 27797 RVA: 0x003CDE90 File Offset: 0x003CC090
		public void ReAdjustClothingByAge(DataContext context)
		{
			sbyte ageGroup = this.GetAgeGroup();
			short currClothingTemplateId = this._equipment[4].TemplateId;
			bool flag = currClothingTemplateId >= 0;
			if (flag)
			{
				ClothingItem clothingCfg = Config.Clothing.Instance[currClothingTemplateId];
				bool flag2 = clothingCfg.AgeGroup == ageGroup;
				if (flag2)
				{
					return;
				}
				bool detachable = clothingCfg.Detachable;
				if (detachable)
				{
					this.ChangeEquipment(context, 4, -1, ItemKey.Invalid);
				}
			}
			if (!true)
			{
			}
			short num;
			if (ageGroup != 0)
			{
				if (ageGroup != 1)
				{
					num = OrganizationDomain.GetRandomOrgMemberClothing(context.Random, OrganizationDomain.GetOrgMemberConfig(this._organizationInfo));
				}
				else
				{
					num = 65;
				}
			}
			else
			{
				num = 64;
			}
			if (!true)
			{
			}
			short newClothingTemplateId = num;
			this.ForceReplaceClothing(context, newClothingTemplateId);
		}

		// Token: 0x06006C96 RID: 27798 RVA: 0x003CDF44 File Offset: 0x003CC144
		public int CalcHealthDeltaAfterSpecialEffect(DataContext context, int delta)
		{
			int percent = 100 + DomainManager.SpecialEffect.GetModifyValue(this._id, 54, EDataModifyType.AddPercent, -1, -1, -1, EDataSumType.All);
			delta = delta * percent / 100;
			return delta;
		}

		// Token: 0x06006C97 RID: 27799 RVA: 0x003CDF7C File Offset: 0x003CC17C
		public int CalcHealthDelta(int delta)
		{
			bool flag = delta > 0;
			if (flag)
			{
				int percent = 100;
				foreach (SolarTermItem solarTerm in this.GetInvokedSolarTerm())
				{
					bool healthBuff = solarTerm.HealthBuff;
					if (healthBuff)
					{
						percent += this.GetSolarTermValue((int)GlobalConfig.Instance.SolarTermAddHealth);
					}
				}
				delta = delta * percent / 100;
			}
			else
			{
				bool flag2 = delta < 0;
				if (flag2)
				{
					int percent2 = 100 + DomainManager.SpecialEffect.GetModifyValue(this._id, 54, EDataModifyType.AddPercent, -1, -1, -1, EDataSumType.All);
					percent2 -= DomainManager.Building.GetBuildingBlockEffect(this._location, EBuildingScaleEffect.HealthDecreaseReduction, -1);
					bool flag3 = percent2 < 0;
					if (flag3)
					{
						percent2 = 0;
					}
					delta = delta * percent2 / 100;
				}
			}
			return delta;
		}

		// Token: 0x06006C98 RID: 27800 RVA: 0x003CE058 File Offset: 0x003CC258
		public void AdjustLifespan(DataContext context)
		{
			int factor = DomainManager.World.GetCharacterLifeSpanFactor();
			int extraLifespanThreshold = 36 * factor / 100;
			for (int owedLifespan = CharacterDomain.GetLivedMonths(this._actualAge, this._birthMonth) + extraLifespanThreshold - (int)this.GetMaxHealth(); owedLifespan > 0; owedLifespan = CharacterDomain.GetLivedMonths(this._actualAge, this._birthMonth) + extraLifespanThreshold - (int)this.GetMaxHealth())
			{
				int bonus = 84 * factor / 100;
				int baseMaxHealth = (int)this._baseMaxHealth + owedLifespan + context.Random.Next(bonus);
				bool flag = baseMaxHealth > 32767;
				if (flag)
				{
					this.SetBaseMaxHealth(short.MaxValue, context);
					break;
				}
				this.SetBaseMaxHealth((short)baseMaxHealth, context);
			}
			short leftMaxHealth = this.GetLeftMaxHealth(false);
			bool flag2 = leftMaxHealth < 0;
			if (flag2)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(59, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(this._id);
				defaultInterpolatedStringHandler.AppendLiteral(": left max health must equal or greater than zero");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			this._health = Math.Clamp(this._health, 0, leftMaxHealth);
			this.SetHealth(this._health, context);
		}

		// Token: 0x06006C99 RID: 27801 RVA: 0x003CE17C File Offset: 0x003CC37C
		public void GetTitles(List<short> titleIds)
		{
			switch (this.GetXiangshuType())
			{
			case 1:
				titleIds.Add(0);
				break;
			case 2:
				titleIds.Add(1);
				break;
			case 3:
				titleIds.Add(2);
				break;
			}
			List<sbyte> bookTypes = DomainManager.LegendaryBook.GetCharOwnedBookTypes(this._id);
			bool flag = bookTypes != null;
			if (flag)
			{
				int i = 0;
				int count = bookTypes.Count;
				while (i < count)
				{
					sbyte bookType = bookTypes[i];
					short titleId = (short)(3 + bookType);
					titleIds.Add(titleId);
					i++;
				}
			}
			DomainManager.Extra.FillCharacterExtraTitles(this._id, titleIds);
		}

		// Token: 0x06006C9A RID: 27802 RVA: 0x003CE230 File Offset: 0x003CC430
		public bool HasTitle(short templateId)
		{
			if (templateId >= 3)
			{
				if (templateId <= 16)
				{
					List<sbyte> bookTypes = DomainManager.LegendaryBook.GetCharOwnedBookTypes(this._id);
					return bookTypes != null && bookTypes.Contains((sbyte)(templateId - 3));
				}
			}
			else
			{
				switch (templateId)
				{
				case 0:
					return this.GetXiangshuType() == 1;
				case 1:
					return this.GetXiangshuType() == 2;
				case 2:
					return this.GetXiangshuType() == 3;
				}
			}
			return DomainManager.Extra.GetExtraTitleExpireDate(this._id, templateId) >= 0;
		}

		// Token: 0x06006C9B RID: 27803 RVA: 0x003CE2C4 File Offset: 0x003CC4C4
		public unsafe void ChangeBaseMainAttributes(DataContext context, MainAttributes delta)
		{
			for (int i = 0; i < 6; i++)
			{
				int value = (int)(*(ref this._baseMainAttributes.Items.FixedElementField + (IntPtr)i * 2) + *(ref delta.Items.FixedElementField + (IntPtr)i * 2));
				bool flag = value < 0;
				if (flag)
				{
					value = 0;
				}
				*(ref this._baseMainAttributes.Items.FixedElementField + (IntPtr)i * 2) = (short)value;
			}
			this.SetBaseMainAttributes(this._baseMainAttributes, context);
		}

		// Token: 0x06006C9C RID: 27804 RVA: 0x003CE340 File Offset: 0x003CC540
		public unsafe void ChangeBaseMainAttribute(DataContext context, sbyte mainAttributeType, short delta)
		{
			Tester.Assert(mainAttributeType >= 0 && mainAttributeType < 6, "");
			*this._baseMainAttributes[(int)mainAttributeType] = (short)Math.Clamp((int)(*this._baseMainAttributes[(int)mainAttributeType] + delta), 0, (int)GlobalConfig.Instance.MaxValueOfMaxMainAttributes);
			this.SetBaseMainAttributes(this._baseMainAttributes, context);
		}

		// Token: 0x06006C9D RID: 27805 RVA: 0x003CE3A0 File Offset: 0x003CC5A0
		public unsafe sbyte GetPersonality(sbyte personalityType)
		{
			return *(ref this.GetPersonalities().Items.FixedElementField + personalityType);
		}

		// Token: 0x06006C9E RID: 27806 RVA: 0x003CE3C8 File Offset: 0x003CC5C8
		public unsafe short GetMaxMainAttribute(sbyte mainAttributeType)
		{
			return *(ref this.GetMaxMainAttributes().Items.FixedElementField + (IntPtr)mainAttributeType * 2);
		}

		// Token: 0x06006C9F RID: 27807 RVA: 0x003CE3F4 File Offset: 0x003CC5F4
		public unsafe short GetCurrMainAttribute(sbyte mainAttributeType)
		{
			return *(ref this.GetCurrMainAttributes().Items.FixedElementField + (IntPtr)mainAttributeType * 2);
		}

		// Token: 0x06006CA0 RID: 27808 RVA: 0x003CE420 File Offset: 0x003CC620
		public unsafe void ChangeCurrMainAttribute(DataContext context, sbyte mainAttributeType, int delta)
		{
			MainAttributes maxMainAttributes = this.GetMaxMainAttributes();
			*this._currMainAttributes[(int)mainAttributeType] = (short)Math.Clamp((int)(*this._currMainAttributes[(int)mainAttributeType]) + delta, 0, (int)(*maxMainAttributes[(int)mainAttributeType]));
			this.SetCurrMainAttributes(this._currMainAttributes, context);
		}

		// Token: 0x06006CA1 RID: 27809 RVA: 0x003CE470 File Offset: 0x003CC670
		public unsafe void ChangeCurrMainAttributes(DataContext context, MainAttributes delta)
		{
			MainAttributes maxMainAttributes = this.GetMaxMainAttributes();
			for (sbyte i = 0; i < 6; i += 1)
			{
				*(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)i * 2) = (short)Math.Clamp((int)(*(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)i * 2) + *(ref delta.Items.FixedElementField + (IntPtr)i * 2)), 0, (int)(*(ref maxMainAttributes.Items.FixedElementField + (IntPtr)i * 2)));
			}
			this.SetCurrMainAttributes(this._currMainAttributes, context);
		}

		// Token: 0x06006CA2 RID: 27810 RVA: 0x003CE4FC File Offset: 0x003CC6FC
		public unsafe void ChangeBaseLifeSkillQualifications(DataContext context, ref LifeSkillShorts delta)
		{
			for (int i = 0; i < 16; i++)
			{
				int value = (int)(*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)i * 2) + *(ref delta.Items.FixedElementField + (IntPtr)i * 2));
				bool flag = value < 0;
				if (flag)
				{
					value = 0;
				}
				*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)i * 2) = (short)value;
			}
			this.SetBaseLifeSkillQualifications(ref this._baseLifeSkillQualifications, context);
		}

		// Token: 0x06006CA3 RID: 27811 RVA: 0x003CE578 File Offset: 0x003CC778
		public unsafe void ChangeBaseLifeSkillQualification(DataContext context, sbyte skillType, int delta)
		{
			Tester.Assert(skillType >= 0 && skillType < 16, "");
			*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)skillType * 2) = (short)Math.Clamp((int)(*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)skillType * 2)) + delta, 0, 32767);
			this.SetBaseLifeSkillQualifications(ref this._baseLifeSkillQualifications, context);
		}

		// Token: 0x06006CA4 RID: 27812 RVA: 0x003CE5E8 File Offset: 0x003CC7E8
		public unsafe void ChangeBaseCombatSkillQualifications(DataContext context, ref CombatSkillShorts delta)
		{
			for (int i = 0; i < 14; i++)
			{
				int value = (int)(*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)i * 2) + *(ref delta.Items.FixedElementField + (IntPtr)i * 2));
				bool flag = value < 0;
				if (flag)
				{
					value = 0;
				}
				*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)i * 2) = (short)value;
			}
			this.SetBaseCombatSkillQualifications(ref this._baseCombatSkillQualifications, context);
		}

		// Token: 0x06006CA5 RID: 27813 RVA: 0x003CE664 File Offset: 0x003CC864
		public unsafe void ChangeBaseCombatSkillQualification(DataContext context, sbyte skillType, int delta)
		{
			Tester.Assert(skillType >= 0 && skillType < 14, "");
			*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)skillType * 2) = (short)Math.Clamp((int)(*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)skillType * 2)) + delta, 0, 32767);
			this.SetBaseCombatSkillQualifications(ref this._baseCombatSkillQualifications, context);
		}

		// Token: 0x06006CA6 RID: 27814 RVA: 0x003CE6D4 File Offset: 0x003CC8D4
		public sbyte GetLifeSkillQualificationAgeAdjust()
		{
			short clampedAge = Character.GetClampedAgeOfAgeEffect(this._actualAge);
			AgeEffectItem ageEffectCfg = AgeEffect.Instance[(int)clampedAge];
			sbyte lifeSkillQualificationGrowthType = this._lifeSkillQualificationGrowthType;
			if (!true)
			{
			}
			sbyte result;
			switch (lifeSkillQualificationGrowthType)
			{
			case 0:
				result = ageEffectCfg.SkillQualificationAverage;
				break;
			case 1:
				result = ageEffectCfg.SkillQualificationPrecocious;
				break;
			case 2:
				result = ageEffectCfg.SkillQualificationLateBlooming;
				break;
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(23, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported GrowthType ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(this._lifeSkillQualificationGrowthType);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
			if (!true)
			{
			}
			return result;
		}

		// Token: 0x06006CA7 RID: 27815 RVA: 0x003CE774 File Offset: 0x003CC974
		public sbyte GetCombatSkillQualificationAgeAdjust()
		{
			short clampedAge = Character.GetClampedAgeOfAgeEffect(this._actualAge);
			AgeEffectItem ageEffectCfg = AgeEffect.Instance[(int)clampedAge];
			sbyte combatSkillQualificationGrowthType = this._combatSkillQualificationGrowthType;
			if (!true)
			{
			}
			sbyte result;
			switch (combatSkillQualificationGrowthType)
			{
			case 0:
				result = ageEffectCfg.SkillQualificationAverage;
				break;
			case 1:
				result = ageEffectCfg.SkillQualificationPrecocious;
				break;
			case 2:
				result = ageEffectCfg.SkillQualificationLateBlooming;
				break;
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(23, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported GrowthType ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(this._lifeSkillQualificationGrowthType);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
			if (!true)
			{
			}
			return result;
		}

		// Token: 0x06006CA8 RID: 27816 RVA: 0x003CE814 File Offset: 0x003CCA14
		public sbyte GetBodyType()
		{
			return this._avatar.GetBodyType();
		}

		// Token: 0x06006CA9 RID: 27817 RVA: 0x003CE831 File Offset: 0x003CCA31
		public void SetBodyType(DataContext context, sbyte bodyType)
		{
			this._avatar.ChangeBodyType(bodyType);
			this.SetAvatar(this._avatar, context);
		}

		// Token: 0x06006CAA RID: 27818 RVA: 0x003CE850 File Offset: 0x003CCA50
		public sbyte GetHappinessType()
		{
			return HappinessType.GetHappinessType(this._happiness);
		}

		// Token: 0x06006CAB RID: 27819 RVA: 0x003CE86D File Offset: 0x003CCA6D
		public void ChangeHappiness(DataContext context, int delta)
		{
			this._happiness = (sbyte)Math.Clamp((int)this._happiness + delta, -119, 119);
			this.SetHappiness(this._happiness, context);
		}

		// Token: 0x06006CAC RID: 27820 RVA: 0x003CE898 File Offset: 0x003CCA98
		public sbyte GetBehaviorType()
		{
			return BehaviorType.GetBehaviorType(this.GetMorality());
		}

		// Token: 0x06006CAD RID: 27821 RVA: 0x003CE8B8 File Offset: 0x003CCAB8
		public short GetFixedMorality()
		{
			sbyte ownerState = this.GetLegendaryBookOwnerState();
			bool flag = ownerState == 1 || this._featureIds.Contains(217);
			short result;
			if (flag)
			{
				result = -250;
			}
			else
			{
				bool flag2 = ownerState >= 2 || this._featureIds.Contains(218);
				if (flag2)
				{
					result = -438;
				}
				else
				{
					Location forceRebelLocation = DomainManager.Character.GetForceRebelLocation();
					bool flag3 = forceRebelLocation.IsValid() && forceRebelLocation.AreaId == this._location.AreaId;
					if (flag3)
					{
						byte areaData = DomainManager.Map.GetAreaSize(this._location.AreaId);
						ByteCoordinate forceRebelCoordinate = ByteCoordinate.IndexToCoordinate(forceRebelLocation.BlockId, areaData);
						ByteCoordinate selfCoordinate = ByteCoordinate.IndexToCoordinate(this._location.BlockId, areaData);
						bool flag4 = forceRebelCoordinate.GetManhattanDistance(selfCoordinate) <= 3;
						if (flag4)
						{
							return -250;
						}
					}
					Location forceKindLocation = DomainManager.Character.GetForceKindLocation();
					bool flag5 = forceKindLocation.IsValid() && forceKindLocation.AreaId == this._location.AreaId;
					if (flag5)
					{
						byte areaData2 = DomainManager.Map.GetAreaSize(this._location.AreaId);
						ByteCoordinate forceKindCoordinate = ByteCoordinate.IndexToCoordinate(forceKindLocation.BlockId, areaData2);
						ByteCoordinate selfCoordinate2 = ByteCoordinate.IndexToCoordinate(this._location.BlockId, areaData2);
						bool flag6 = forceKindCoordinate.GetManhattanDistance(selfCoordinate2) <= 3;
						if (flag6)
						{
							return 250;
						}
					}
					for (int i = 0; i < this._featureIds.Count; i++)
					{
						short featureId = this._featureIds[i];
						short num = featureId;
						short num2 = num;
						if (num2 == 484)
						{
							return 250;
						}
						if (num2 == 485)
						{
							return -250;
						}
					}
					result = short.MaxValue;
				}
			}
			return result;
		}

		// Token: 0x06006CAE RID: 27822 RVA: 0x003CEAA2 File Offset: 0x003CCCA2
		public void ChangeBaseMorality(DataContext context, int delta)
		{
			this._baseMorality = (short)Math.Clamp((int)this._baseMorality + delta, -500, 500);
			this.SetBaseMorality(this._baseMorality, context);
		}

		// Token: 0x06006CAF RID: 27823 RVA: 0x003CEAD1 File Offset: 0x003CCCD1
		public void ChangeHobby(DataContext context)
		{
			this.OfflineChangeHobby(context.Random);
			this.CommitChangingHobby(context);
		}

		// Token: 0x06006CB0 RID: 27824 RVA: 0x003CEAEC File Offset: 0x003CCCEC
		public void ChangeLovingItem(DataContext context)
		{
			short lovingItemSubType = Character.GenerateRandomHobby(context.Random).Item1;
			sbyte favorabilityType = FavorabilityType.GetFavorabilityType(DomainManager.Character.GetFavorability(this._id, DomainManager.Taiwu.GetTaiwuCharId()));
			bool needResetRevealedHobbies = false;
			bool flag = favorabilityType < 3;
			if (flag)
			{
				this.SetLovingItemRevealed(false, context);
			}
			else
			{
				bool flag2 = DomainManager.Extra.IsCharacterLovingItemRevealed(this._id);
				if (flag2)
				{
					needResetRevealedHobbies = true;
				}
			}
			this._lovingItemSubType = ((lovingItemSubType == this._hatingItemSubType) ? -1 : lovingItemSubType);
			this.SetLovingItemSubType(this._lovingItemSubType, context);
			bool flag3 = needResetRevealedHobbies;
			if (flag3)
			{
				DomainManager.Extra.SetCharacterRevealedHobbies(context, this._id, true);
			}
		}

		// Token: 0x06006CB1 RID: 27825 RVA: 0x003CEB94 File Offset: 0x003CCD94
		public void ChangeHatingItem(DataContext context)
		{
			short hatingItemSubType = Character.GenerateRandomHobby(context.Random).Item2;
			sbyte favorabilityType = FavorabilityType.GetFavorabilityType(DomainManager.Character.GetFavorability(this._id, DomainManager.Taiwu.GetTaiwuCharId()));
			bool needResetRevealedHobbies = false;
			bool flag = favorabilityType < 3;
			if (flag)
			{
				this.SetHatingItemRevealed(false, context);
			}
			else
			{
				bool flag2 = DomainManager.Extra.IsCharacterHatingItemRevealed(this._id);
				if (flag2)
				{
					needResetRevealedHobbies = true;
				}
			}
			this._hatingItemSubType = ((hatingItemSubType == this._lovingItemSubType) ? -1 : hatingItemSubType);
			this.SetHatingItemSubType(this._hatingItemSubType, context);
			bool flag3 = needResetRevealedHobbies;
			if (flag3)
			{
				DomainManager.Extra.SetCharacterRevealedHobbies(context, this._id, false);
			}
		}

		// Token: 0x06006CB2 RID: 27826 RVA: 0x003CEC3B File Offset: 0x003CCE3B
		public void UpdateHobbyExpirationDate(DataContext context)
		{
			this.OfflineUpdateHobbyExpirationDate();
			this.SetHobbyExpirationDate(this._hobbyExpirationDate, context);
		}

		// Token: 0x06006CB3 RID: 27827 RVA: 0x003CEC53 File Offset: 0x003CCE53
		public int GetCharacterWorth()
		{
			throw new NotImplementedException();
		}

		// Token: 0x06006CB4 RID: 27828 RVA: 0x003CEC5C File Offset: 0x003CCE5C
		public bool CanBeXiangshuInfected()
		{
			sbyte grade = (this._id != DomainManager.Taiwu.GetTaiwuCharId()) ? this._organizationInfo.Grade : 0;
			sbyte threshold = DomainManager.World.GetMaxGradeOfXiangshuInfection();
			return grade <= threshold;
		}

		// Token: 0x06006CB5 RID: 27829 RVA: 0x003CECA4 File Offset: 0x003CCEA4
		public bool CanHaveProfession()
		{
			return this.GetAgeGroup() == 2;
		}

		// Token: 0x06006CB6 RID: 27830 RVA: 0x003CECBF File Offset: 0x003CCEBF
		public void ChangeXiangshuInfection(DataContext context, int delta)
		{
			this._xiangshuInfection = (byte)Math.Clamp((int)this._xiangshuInfection + delta, 0, 200);
			this.SetXiangshuInfection(this._xiangshuInfection, context);
		}

		// Token: 0x06006CB7 RID: 27831 RVA: 0x003CECEC File Offset: 0x003CCEEC
		public void UpdateXiangshuInfectionState(DataContext context)
		{
			short featureId = XiangshuInfectionTypeHelper.GetInfectionFeatureIdThatShouldBe(this._xiangshuInfection);
			bool flag = this._featureIds.Contains(featureId);
			if (!flag)
			{
				bool flag2 = featureId == 218;
				if (flag2)
				{
					bool flag3 = this._id == DomainManager.Taiwu.GetTaiwuCharId();
					if (flag3)
					{
						return;
					}
					bool flag4 = this.IsActiveExternalRelationState(4);
					if (flag4)
					{
						return;
					}
					bool flag5 = this._featureIds.Contains(415);
					if (flag5)
					{
						return;
					}
				}
				this.AddFeature(context, featureId, true);
				bool flag6 = this._creatingType == 1;
				if (flag6)
				{
					Events.RaiseXiangshuInfectionFeatureChanged(context, this, featureId);
				}
			}
		}

		// Token: 0x06006CB8 RID: 27832 RVA: 0x003CED87 File Offset: 0x003CCF87
		public void ChangeExp(DataContext context, int delta)
		{
			this._exp = Math.Clamp(this._exp + delta, 0, 999999999);
			this.SetExp(this._exp, context);
		}

		// Token: 0x06006CB9 RID: 27833 RVA: 0x003CEDB4 File Offset: 0x003CCFB4
		public unsafe int GetResource(sbyte resourceType)
		{
			return *(ref this._resources.Items.FixedElementField + (IntPtr)resourceType * 4);
		}

		// Token: 0x06006CBA RID: 27834 RVA: 0x003CEDDC File Offset: 0x003CCFDC
		public unsafe void SpecifyResource(DataContext context, sbyte resourceType, int value)
		{
			bool flag = value < 0;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(41, 3);
				defaultInterpolatedStringHandler.AppendFormatted<int>(this._id);
				defaultInterpolatedStringHandler.AppendLiteral("'s resource amount cannot be negative: ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(resourceType);
				defaultInterpolatedStringHandler.AppendLiteral(", ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(value);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			*(ref this._resources.Items.FixedElementField + (IntPtr)resourceType * 4) = value;
			this.SetResources(ref this._resources, context);
		}

		// Token: 0x06006CBB RID: 27835 RVA: 0x003CEE68 File Offset: 0x003CD068
		public unsafe void SpecifyResources(DataContext context, ref ResourceInts values)
		{
			for (int i = 0; i < 8; i++)
			{
				int value = *(ref values.Items.FixedElementField + (IntPtr)i * 4);
				bool flag = value < 0;
				if (flag)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(41, 3);
					defaultInterpolatedStringHandler.AppendFormatted<int>(this._id);
					defaultInterpolatedStringHandler.AppendLiteral("'s resource amount cannot be negative: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(i);
					defaultInterpolatedStringHandler.AppendLiteral(", ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(value);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				*(ref this._resources.Items.FixedElementField + (IntPtr)i * 4) = value;
			}
			this.SetResources(ref this._resources, context);
		}

		// Token: 0x06006CBC RID: 27836 RVA: 0x003CEF20 File Offset: 0x003CD120
		public unsafe void ChangeResource(DataContext context, sbyte resourceType, int delta)
		{
			int value = *(ref this._resources.Items.FixedElementField + (IntPtr)resourceType * 4) + delta;
			bool flag = value < 0;
			if (flag)
			{
				string tag = "Character";
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(51, 5);
				defaultInterpolatedStringHandler.AppendFormatted<int>(this._id);
				defaultInterpolatedStringHandler.AppendLiteral("'s resource amount cannot be negative: ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(resourceType);
				defaultInterpolatedStringHandler.AppendLiteral(", ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(value);
				defaultInterpolatedStringHandler.AppendLiteral(" (delta ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(delta);
				defaultInterpolatedStringHandler.AppendLiteral(")\n");
				defaultInterpolatedStringHandler.AppendFormatted(Environment.StackTrace);
				AdaptableLog.TagWarning(tag, defaultInterpolatedStringHandler.ToStringAndClear(), false);
				value = 0;
			}
			else
			{
				bool flag2 = value > 999999999;
				if (flag2)
				{
					value = 999999999;
				}
			}
			*(ref this._resources.Items.FixedElementField + (IntPtr)resourceType * 4) = value;
			this.SetResources(ref this._resources, context);
		}

		// Token: 0x06006CBD RID: 27837 RVA: 0x003CF018 File Offset: 0x003CD218
		public unsafe void ChangeResources(DataContext context, ref ResourceInts delta)
		{
			for (int i = 0; i < 8; i++)
			{
				int value = *(ref this._resources.Items.FixedElementField + (IntPtr)i * 4) + *(ref delta.Items.FixedElementField + (IntPtr)i * 4);
				bool flag = value < 0;
				if (flag)
				{
					string tag = "Character";
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(51, 5);
					defaultInterpolatedStringHandler.AppendFormatted<int>(this._id);
					defaultInterpolatedStringHandler.AppendLiteral("'s resource amount cannot be negative: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(i);
					defaultInterpolatedStringHandler.AppendLiteral(", ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(value);
					defaultInterpolatedStringHandler.AppendLiteral(" (delta ");
					defaultInterpolatedStringHandler.AppendFormatted<ResourceInts>(delta);
					defaultInterpolatedStringHandler.AppendLiteral(")\n");
					defaultInterpolatedStringHandler.AppendFormatted(Environment.StackTrace);
					AdaptableLog.TagWarning(tag, defaultInterpolatedStringHandler.ToStringAndClear(), false);
					value = 0;
				}
				else
				{
					bool flag2 = value > 999999999;
					if (flag2)
					{
						value = 999999999;
					}
				}
				*(ref this._resources.Items.FixedElementField + (IntPtr)i * 4) = value;
			}
			this.SetResources(ref this._resources, context);
		}

		// Token: 0x06006CBE RID: 27838 RVA: 0x003CF144 File Offset: 0x003CD344
		public bool CheckResources(DataContext context, ref ResourceInts resource)
		{
			return this._resources.CheckIsMeet(ref resource);
		}

		// Token: 0x06006CBF RID: 27839 RVA: 0x003CF164 File Offset: 0x003CD364
		public bool CheckResources(DataContext context, sbyte type, int value)
		{
			return this._resources.CheckIsMeet(type, value);
		}

		// Token: 0x06006CC0 RID: 27840 RVA: 0x003CF184 File Offset: 0x003CD384
		public unsafe void ChangeResourceWithoutChecking(DataContext context, sbyte resourceType, int delta)
		{
			int value = *(ref this._resources.Items.FixedElementField + (IntPtr)resourceType * 4) + delta;
			bool flag = value < 0;
			if (flag)
			{
				value = 0;
			}
			*(ref this._resources.Items.FixedElementField + (IntPtr)resourceType * 4) = value;
			this.SetResources(ref this._resources, context);
		}

		// Token: 0x06006CC1 RID: 27841 RVA: 0x003CF1DC File Offset: 0x003CD3DC
		public unsafe void ChangeResourcesWithoutChecking(DataContext context, ref ResourceInts delta)
		{
			for (int i = 0; i < 8; i++)
			{
				int value = *(ref this._resources.Items.FixedElementField + (IntPtr)i * 4) + *(ref delta.Items.FixedElementField + (IntPtr)i * 4);
				bool flag = value < 0;
				if (flag)
				{
					value = 0;
				}
				*(ref this._resources.Items.FixedElementField + (IntPtr)i * 4) = value;
			}
			this.SetResources(ref this._resources, context);
		}

		// Token: 0x06006CC2 RID: 27842 RVA: 0x003CF254 File Offset: 0x003CD454
		public Location GetValidLocation()
		{
			bool flag = this._location.IsValid();
			Location result;
			if (flag)
			{
				result = this._location;
			}
			else
			{
				bool flag2 = this._kidnapperId >= 0;
				if (flag2)
				{
					Character kidnapper;
					bool flag3 = DomainManager.Character.TryGetElement_Objects(this._kidnapperId, out kidnapper);
					if (flag3)
					{
						Location kidnapperLocation = kidnapper.GetLocation();
						bool flag4 = kidnapperLocation.IsValid();
						if (flag4)
						{
							result = kidnapperLocation;
						}
						else
						{
							bool flag5 = kidnapper._kidnapperId >= 0;
							if (flag5)
							{
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(37, 3);
								defaultInterpolatedStringHandler.AppendLiteral("Nested kidnapping detected: ");
								defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
								defaultInterpolatedStringHandler.AppendLiteral(" => ");
								defaultInterpolatedStringHandler.AppendFormatted<int>(this._kidnapperId);
								defaultInterpolatedStringHandler.AppendLiteral(" => ");
								defaultInterpolatedStringHandler.AppendFormatted<int>(kidnapper._kidnapperId);
								defaultInterpolatedStringHandler.AppendLiteral(".");
								throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
							}
							result = kidnapper.GetValidLocation();
						}
					}
					else
					{
						Grave kidnapperGrave = DomainManager.Character.GetElement_Graves(this._kidnapperId);
						result = kidnapperGrave.GetLocation();
					}
				}
				else
				{
					bool flag6 = this.IsActiveExternalRelationState(32);
					if (flag6)
					{
						sbyte orgTemplateId = DomainManager.Organization.GetPrisonerSect(this._id);
						Settlement settlement = DomainManager.Organization.GetSettlementByOrgTemplateId(orgTemplateId);
						result = settlement.GetLocation();
					}
					else
					{
						CrossAreaMoveInfo crossAreaMoveInfos;
						bool flag7 = DomainManager.Character.TryGetElement_CrossAreaMoveInfos((this._leaderId >= 0) ? this._leaderId : this._id, out crossAreaMoveInfos);
						if (flag7)
						{
							Location location = DomainManager.Map.CrossAreaTravelInfoToLocation(crossAreaMoveInfos);
							bool flag8 = location.IsValid();
							if (!flag8)
							{
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(53, 1);
								defaultInterpolatedStringHandler.AppendLiteral("Character ");
								defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
								defaultInterpolatedStringHandler.AppendLiteral(" is traveling outside of the planned route.");
								throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
							}
							result = location;
						}
						else
						{
							bool flag9 = DomainManager.Taiwu.GetTaiwuCharId() == this._id || DomainManager.Taiwu.IsInGroup(this._id);
							if (flag9)
							{
								result = DomainManager.Map.GetTravelCurrLocation();
							}
							else
							{
								bool flag10 = DomainManager.Extra.GetKidnappedTravelData().HunterCharId == this._id;
								if (!flag10)
								{
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(54, 1);
									defaultInterpolatedStringHandler.AppendLiteral("Character ");
									defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
									defaultInterpolatedStringHandler.AppendLiteral(" is in invalid location for unknown reasons.");
									throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
								}
								result = DomainManager.Map.GetTravelCurrLocation();
							}
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006CC3 RID: 27843 RVA: 0x003CF4D8 File Offset: 0x003CD6D8
		public bool IsMoralityLocked()
		{
			sbyte ownerState = this.GetLegendaryBookOwnerState();
			bool flag = ownerState == 1 || this._featureIds.Contains(217);
			bool result;
			if (flag)
			{
				result = true;
			}
			else
			{
				bool flag2 = ownerState >= 2 || this._featureIds.Contains(218);
				if (flag2)
				{
					result = true;
				}
				else
				{
					Location forceRebelLocation = DomainManager.Character.GetForceRebelLocation();
					bool flag3 = this.IsNearbyLocation(forceRebelLocation, 3);
					if (flag3)
					{
						result = true;
					}
					else
					{
						Location forceKindLocation = DomainManager.Character.GetForceKindLocation();
						bool flag4 = this.IsNearbyLocation(forceKindLocation, 3);
						result = flag4;
					}
				}
			}
			return result;
		}

		// Token: 0x06006CC4 RID: 27844 RVA: 0x003CF574 File Offset: 0x003CD774
		public bool IsNearbyLocation(Location location, int steps)
		{
			bool flag = !location.IsValid();
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = location.AreaId != this._location.AreaId;
				if (flag2)
				{
					result = false;
				}
				else
				{
					byte areaData = DomainManager.Map.GetAreaSize(this._location.AreaId);
					ByteCoordinate targetCoordinate = ByteCoordinate.IndexToCoordinate(location.BlockId, areaData);
					ByteCoordinate selfCoordinate = ByteCoordinate.IndexToCoordinate(this._location.BlockId, areaData);
					result = (targetCoordinate.GetManhattanDistance(selfCoordinate) <= steps);
				}
			}
			return result;
		}

		// Token: 0x06006CC5 RID: 27845 RVA: 0x003CF600 File Offset: 0x003CD800
		public bool IsForbiddenToDrinkingWines()
		{
			return Organization.Instance[this._organizationInfo.OrgTemplateId].NoDrinking || this.IsMonkType(2);
		}

		// Token: 0x06006CC6 RID: 27846 RVA: 0x003CF638 File Offset: 0x003CD838
		public bool IsForbiddenToEatMeat()
		{
			return Organization.Instance[this._organizationInfo.OrgTemplateId].NoMeatEating || this._monkType > 0;
		}

		// Token: 0x06006CC7 RID: 27847 RVA: 0x003CF674 File Offset: 0x003CD874
		public bool IsMonkType(byte monkType)
		{
			return (this._monkType & monkType) > 0;
		}

		// Token: 0x06006CC8 RID: 27848 RVA: 0x003CF691 File Offset: 0x003CD891
		public void BecomeMonkType(DataContext context, byte monkType)
		{
			Tester.Assert((monkType & 128) == 0, "");
			this._monkType |= monkType;
			this.SetMonkType(this._monkType, context);
		}

		// Token: 0x06006CC9 RID: 27849 RVA: 0x003CF6C8 File Offset: 0x003CD8C8
		public void RemoveMonkType(DataContext context, byte monkType)
		{
			Tester.Assert((monkType & 128) == 0, "");
			Tester.Assert((this._monkType & 128) == 0, "");
			this._monkType &= ~monkType;
			this.SetMonkType(this._monkType, context);
		}

		// Token: 0x06006CCA RID: 27850 RVA: 0x003CF724 File Offset: 0x003CD924
		public bool IsActiveExternalRelationState(byte type)
		{
			return (this._externalRelationState & type) > 0;
		}

		// Token: 0x06006CCB RID: 27851 RVA: 0x003CF744 File Offset: 0x003CD944
		public bool IsActiveExternalRelationState(ulong extraType)
		{
			return (this._externalRelationState & 128) > 0;
		}

		// Token: 0x06006CCC RID: 27852 RVA: 0x003CF765 File Offset: 0x003CD965
		public void ActiveExternalRelationState(DataContext context, byte type)
		{
			this._externalRelationState |= type;
			this.SetExternalRelationState(this._externalRelationState, context);
		}

		// Token: 0x06006CCD RID: 27853 RVA: 0x003CF788 File Offset: 0x003CD988
		public short GetKidnappingEnemyNestAdventure()
		{
			bool flag = !this.IsActiveExternalRelationState(4);
			short result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				AdventureSiteData adventureSite = DomainManager.Adventure.GetAdventureSite(this._location.AreaId, this._location.BlockId);
				bool flag2 = adventureSite == null;
				if (flag2)
				{
					result = -1;
				}
				else
				{
					bool flag3 = !adventureSite.MonthlyActionKey.IsValid();
					if (flag3)
					{
						result = -1;
					}
					else
					{
						EnemyNestMonthlyAction enemyNestMonthlyAction = DomainManager.TaiwuEvent.GetMonthlyAction(adventureSite.MonthlyActionKey) as EnemyNestMonthlyAction;
						bool flag4 = enemyNestMonthlyAction == null;
						if (flag4)
						{
							result = -1;
						}
						else
						{
							ConfigMonthlyAction configAction = enemyNestMonthlyAction.GetConfigAction(this._location.AreaId, this._location.BlockId);
							bool flag5 = configAction == null || configAction.MajorCharacterSets == null;
							if (flag5)
							{
								result = -1;
							}
							else
							{
								foreach (CharacterSet majorCharSet in configAction.MajorCharacterSets)
								{
									bool flag6 = majorCharSet.Contains(this._id);
									if (flag6)
									{
										return configAction.ConfigData.AdventureId;
									}
								}
								result = -1;
							}
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006CCE RID: 27854 RVA: 0x003CF8CC File Offset: 0x003CDACC
		public void DeactivateExternalRelationState(DataContext context, byte type)
		{
			this._externalRelationState &= ~type;
			this.SetExternalRelationState(this._externalRelationState, context);
		}

		// Token: 0x06006CCF RID: 27855 RVA: 0x003CF8F0 File Offset: 0x003CDAF0
		public bool IsInvincibleInNpcCombat()
		{
			short featureId = this.GetGroupFeature(484);
			return featureId >= 0;
		}

		// Token: 0x06006CD0 RID: 27856 RVA: 0x003CF918 File Offset: 0x003CDB18
		public sbyte GetBelongMapState()
		{
			bool flag = this._organizationInfo.SettlementId < 0;
			sbyte result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				Settlement settlement = DomainManager.Organization.GetSettlement(this._organizationInfo.SettlementId);
				bool flag2 = settlement == null;
				if (flag2)
				{
					result = -1;
				}
				else
				{
					Location location = settlement.GetLocation();
					bool flag3 = location.AreaId < 0;
					if (flag3)
					{
						result = -1;
					}
					else
					{
						result = DomainManager.Map.GetStateIdByAreaId(location.AreaId);
					}
				}
			}
			return result;
		}

		// Token: 0x06006CD1 RID: 27857 RVA: 0x003CF990 File Offset: 0x003CDB90
		public override string ToString()
		{
			ValueTuple<string, string> name = CharacterDomain.GetRealName(this);
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(3, 4);
			defaultInterpolatedStringHandler.AppendFormatted<OrganizationInfo>(this._organizationInfo);
			defaultInterpolatedStringHandler.AppendLiteral("-");
			defaultInterpolatedStringHandler.AppendFormatted(name.Item1);
			defaultInterpolatedStringHandler.AppendFormatted(name.Item2);
			defaultInterpolatedStringHandler.AppendLiteral("(");
			defaultInterpolatedStringHandler.AppendFormatted<int>(this._id);
			defaultInterpolatedStringHandler.AppendLiteral(")");
			return defaultInterpolatedStringHandler.ToStringAndClear();
		}

		// Token: 0x06006CD2 RID: 27858 RVA: 0x003CFA18 File Offset: 0x003CDC18
		public bool IsOnCityTown()
		{
			Location location = this.GetLocation();
			bool flag = location.AreaId >= 0 && location.BlockId >= 0;
			bool result;
			if (flag)
			{
				MapBlockData block = DomainManager.Map.GetBlock(location);
				result = block.IsCityTown();
			}
			else
			{
				result = false;
			}
			return result;
		}

		// Token: 0x06006CD3 RID: 27859 RVA: 0x003CFA64 File Offset: 0x003CDC64
		public short GetIdealClothingTemplateId()
		{
			bool flag = this._organizationInfo.OrgTemplateId == 16;
			if (flag)
			{
				VillagerRoleBase villagerRole = DomainManager.Extra.GetVillagerRole(this._id);
				bool flag2 = villagerRole != null;
				if (flag2)
				{
					return villagerRole.RoleConfig.Clothing;
				}
			}
			return OrganizationDomain.GetOrgMemberConfig(this._organizationInfo).Clothing.TemplateId;
		}

		// Token: 0x06006CD4 RID: 27860 RVA: 0x003CFAC8 File Offset: 0x003CDCC8
		public static short GetSectRandomEnemyTemplateIdByGrade(sbyte orgTemplateId, sbyte grade)
		{
			OrganizationItem orgConfig = Organization.Instance[orgTemplateId];
			return orgConfig.RandomEnemyTemplateIds[(int)grade];
		}

		// Token: 0x06006CD5 RID: 27861 RVA: 0x003CFAF0 File Offset: 0x003CDCF0
		public int GetExtraNameTextTemplateId()
		{
			short templateId = this._templateId;
			bool flag = templateId >= 673 && templateId <= 677;
			if (flag)
			{
				SectStoryHeavenlyTreeExtendable tree;
				bool flag2 = DomainManager.Extra.TryGetHeavenlyTreeById(this._id, out tree);
				if (flag2)
				{
					return GameData.Domains.Extra.SharedMethods.GetTreeExtraNameTextTemplateId((int)tree.TemplateId);
				}
			}
			return -1;
		}

		// Token: 0x06006CD6 RID: 27862 RVA: 0x003CFB50 File Offset: 0x003CDD50
		public int GetMaxProfessionSeniority(int professionId)
		{
			bool flag = this.IsTaiwu();
			int result;
			if (flag)
			{
				result = 3000000;
			}
			else
			{
				short bestAttainment = this.GetProfessionBestAttainment(professionId);
				int skillIndex = Character.GetAttainmentCanUnlockProfessionSkill(bestAttainment);
				int skillId = GameData.Domains.Taiwu.Profession.SharedMethods.GetSkillId(professionId, skillIndex);
				result = GameData.Domains.Taiwu.Profession.SharedMethods.GetSkillUnlockSeniority(skillId);
			}
			return result;
		}

		// Token: 0x06006CD7 RID: 27863 RVA: 0x003CFB94 File Offset: 0x003CDD94
		public short GetProfessionBestAttainment(int professionId)
		{
			short bestAttainment = 0;
			ProfessionItem config = Profession.Instance[professionId];
			bool flag = config.BonusLifeSkills != null;
			if (flag)
			{
				foreach (sbyte lifeSkillType in config.BonusLifeSkills)
				{
					short attainment = this.GetLifeSkillAttainment(lifeSkillType);
					bool flag2 = attainment > bestAttainment;
					if (flag2)
					{
						bestAttainment = attainment;
					}
				}
			}
			bool flag3 = config.BonusCombatSkills != null;
			if (flag3)
			{
				foreach (sbyte combatSkillType in config.BonusCombatSkills)
				{
					short attainment2 = this.GetCombatSkillAttainment(combatSkillType);
					bool flag4 = attainment2 > bestAttainment;
					if (flag4)
					{
						bestAttainment = attainment2;
					}
				}
			}
			return bestAttainment;
		}

		// Token: 0x06006CD8 RID: 27864 RVA: 0x003CFC90 File Offset: 0x003CDE90
		private static int GetAttainmentCanUnlockProfessionSkill(short attainment)
		{
			int[] thresholds = ProfessionRelatedConstants.MaxSeniorityAttainmentThresholds;
			for (int i = thresholds.Length - 1; i >= 0; i--)
			{
				int threshold = thresholds[i];
				bool flag = (int)attainment >= threshold;
				if (flag)
				{
					return i;
				}
			}
			return 0;
		}

		// Token: 0x06006CD9 RID: 27865 RVA: 0x003CFCDC File Offset: 0x003CDEDC
		private CValueModify CalcPropertyModify(ECharacterPropertyReferencedType propertyType, EDataSumType valueSumType = EDataSumType.All)
		{
			CValueModify result = CValueModify.Zero.ChangeA(this.CalcMainAttributeAddValue(propertyType));
			result = (result + this.GetPropertyBonusOfFeatures(propertyType)).ChangeA(this.CalcTreasureGuardAddValue(propertyType)).ChangeA(valueSumType.Sum(this.CalcNeiliAllocationBonus(propertyType)));
			bool flag = this.IsTaiwu();
			if (flag)
			{
				result = result.ChangeA(this.CalcProfessionAddValue(propertyType));
			}
			bool flag2 = this.IsTaiwu();
			if (flag2)
			{
				result += DomainManager.Extra.GetTaiwuPropertyPermanentBonus(propertyType);
			}
			result = result.ChangeA(this.CalcPreexistenceAddValue(propertyType)).ChangeA(this.CalcAgeEffectAddValue(propertyType)).ChangeA(this.GetPropertyBonusOfEquipments(propertyType));
			result += this._eatingItems.GetCharacterPropertyBonus(propertyType, this.IsTaiwu());
			bool flag3 = this.IsTaiwu();
			if (flag3)
			{
				result += DomainManager.Extra.CalcLegendaryBookAddPropertyValue(propertyType);
			}
			result = result.ChangeA(this.CalcChickenAddValue(propertyType));
			bool flag4 = this.IsTaiwu();
			if (flag4)
			{
				result = result.ChangeA(this.CalcSamsaraPlatformAddValue(propertyType));
			}
			bool flag5 = this.IsTaiwu();
			if (flag5)
			{
				result = result.ChangeA(this.CalcSectXuannvUnlockedMusicAddValue(propertyType));
			}
			return result.ChangeA(this.GetPropertyBonusOfCombatSkillEquippingAndBreakout(propertyType));
		}

		// Token: 0x06006CDA RID: 27866 RVA: 0x003CFE28 File Offset: 0x003CE028
		private int CalcMainAttributeAddValue(ECharacterPropertyReferencedType propertyType)
		{
			sbyte mainAttributeType = propertyType.GetMainAttributeType();
			bool flag = mainAttributeType == 6;
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				ushort fieldId = propertyType.GetMainAttributeConsummateFieldId();
				int divisor = propertyType.GetMainAttributeConsummateDivisor();
				sbyte hitType;
				bool flag2 = propertyType.TryParseHitType(out hitType);
				int hitOrInnerType;
				if (flag2)
				{
					hitOrInnerType = (int)hitType;
				}
				else
				{
					sbyte avoidType;
					bool flag3 = propertyType.TryParseAvoidType(out avoidType);
					if (flag3)
					{
						hitOrInnerType = (int)avoidType;
					}
					else
					{
						bool penetrateIsInner;
						bool flag4 = propertyType.TryParsePenetrateIsInner(out penetrateIsInner);
						if (flag4)
						{
							hitOrInnerType = (penetrateIsInner ? 1 : 0);
						}
						else
						{
							bool penetrateResistIsInner;
							bool flag5 = propertyType.TryParsePenetrateResistIsInner(out penetrateResistIsInner);
							if (!flag5)
							{
								return 0;
							}
							hitOrInnerType = (penetrateResistIsInner ? 1 : 0);
						}
					}
				}
				result = this.CalcMainAttributeRelatedConsummateLevel(fieldId, mainAttributeType, hitOrInnerType, divisor);
			}
			return result;
		}

		// Token: 0x06006CDB RID: 27867 RVA: 0x003CFEC8 File Offset: 0x003CE0C8
		private int CalcTreasureGuardAddValue(ECharacterPropertyReferencedType propertyType)
		{
			EventArgBox argBox = DomainManager.TaiwuEvent.GetGlobalEventArgumentBox();
			bool isGuardCombat = false;
			argBox.Get("IsGuardCombat", ref isGuardCombat);
			bool flag = !isGuardCombat || !this.IsTreasuryGuard() || !Character.HitAvoidAttackDefendPropertyTypes.Contains(propertyType);
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				int value = 0;
				foreach (CombatCharacter teammate in DomainManager.Combat.GetTeammateCharacters(this._id))
				{
					int teammateAddValue = 0;
					sbyte hitType;
					bool flag2 = propertyType.TryParseHitType(out hitType);
					if (flag2)
					{
						teammateAddValue = teammate.GetCharacter().GetHitValues()[(int)hitType];
					}
					else
					{
						sbyte avoidType;
						bool flag3 = propertyType.TryParseAvoidType(out avoidType);
						if (flag3)
						{
							teammateAddValue = teammate.GetCharacter().GetAvoidValues()[(int)avoidType];
						}
						else
						{
							bool penetrateIsInner;
							bool flag4 = propertyType.TryParsePenetrateIsInner(out penetrateIsInner);
							if (flag4)
							{
								teammateAddValue = teammate.GetCharacter().GetPenetrations().Get(penetrateIsInner);
							}
							else
							{
								bool penetrateResistIsInner;
								bool flag5 = propertyType.TryParsePenetrateResistIsInner(out penetrateResistIsInner);
								if (flag5)
								{
									teammateAddValue = teammate.GetCharacter().GetPenetrationResists().Get(penetrateResistIsInner);
								}
							}
						}
					}
					value += this.CalcTreasuryGuardBonus(teammateAddValue);
				}
				result = value;
			}
			return result;
		}

		// Token: 0x06006CDC RID: 27868 RVA: 0x003D0028 File Offset: 0x003CE228
		private int CalcProfessionAddValue(ECharacterPropertyReferencedType propertyType)
		{
			sbyte mainAttributeType;
			bool flag = !propertyType.TryParseMainAttributeType(out mainAttributeType);
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				int professionId = ProfessionRelatedConstants.MainAttributeRecoverProfessionIds[(int)mainAttributeType];
				bool flag2 = !DomainManager.Extra.IsProfessionalSkillUnlocked(professionId, 0);
				if (flag2)
				{
					result = 0;
				}
				else
				{
					ProfessionData professionData = DomainManager.Extra.GetProfessionData(professionId);
					result = professionData.GetSeniorityMainAttributeAdditional();
				}
			}
			return result;
		}

		// Token: 0x06006CDD RID: 27869 RVA: 0x003D0088 File Offset: 0x003CE288
		private unsafe int CalcPreexistenceAddValue(ECharacterPropertyReferencedType propertyType)
		{
			bool flag = this._preexistenceCharIds.Count <= 0;
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				int value = 0;
				int i = 0;
				int count = this._preexistenceCharIds.Count;
				while (i < count)
				{
					int preCharId = *(ref this._preexistenceCharIds.CharIds.FixedElementField + (IntPtr)i * 4);
					DeadCharacter preChar = DomainManager.Character.TryGetDeadCharacter(preCharId);
					bool flag2 = preChar == null;
					if (!flag2)
					{
						sbyte mainAttributeType;
						bool flag3 = propertyType.TryParseMainAttributeType(out mainAttributeType);
						if (flag3)
						{
							value += (int)(*preChar.BaseMainAttributes[(int)mainAttributeType]);
						}
						else
						{
							sbyte lifeSkillType;
							bool flag4 = propertyType.TryParseLifeSkillQualificationType(out lifeSkillType);
							if (flag4)
							{
								value += (int)(*preChar.BaseLifeSkillQualifications[(int)lifeSkillType]);
							}
							else
							{
								sbyte combatSkillType;
								bool flag5 = propertyType.TryParseCombatSkillQualificationType(out combatSkillType);
								if (flag5)
								{
									value += (int)(*preChar.BaseCombatSkillQualifications[(int)combatSkillType]);
								}
							}
						}
					}
					i++;
				}
				result = value / 10;
			}
			return result;
		}

		// Token: 0x06006CDE RID: 27870 RVA: 0x003D017C File Offset: 0x003CE37C
		private int CalcAgeEffectAddValue(ECharacterPropertyReferencedType propertyType)
		{
			sbyte expectSkillType;
			bool flag = propertyType.TryParseLifeSkillQualificationType(out expectSkillType);
			bool isLifeSkill;
			if (flag)
			{
				isLifeSkill = true;
			}
			else
			{
				bool flag2 = propertyType.TryParseCombatSkillQualificationType(out expectSkillType);
				if (!flag2)
				{
					return 0;
				}
				isLifeSkill = false;
			}
			short clampedAge = Character.GetClampedAgeOfAgeEffect(this._actualAge);
			AgeEffectItem ageEffectCfg = AgeEffect.Instance[(int)clampedAge];
			sbyte growthType = isLifeSkill ? this._lifeSkillQualificationGrowthType : this._combatSkillQualificationGrowthType;
			if (!true)
			{
			}
			sbyte b;
			switch (growthType)
			{
			case 0:
				b = ageEffectCfg.SkillQualificationAverage;
				break;
			case 1:
				b = ageEffectCfg.SkillQualificationPrecocious;
				break;
			case 2:
				b = ageEffectCfg.SkillQualificationLateBlooming;
				break;
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(23, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported GrowthType ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(growthType);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
			if (!true)
			{
			}
			sbyte value = b;
			sbyte expectSkillGroup = isLifeSkill ? 0 : 1;
			int i = 0;
			int count = this._skillQualificationBonuses.Count;
			while (i < count)
			{
				SkillQualificationBonus bonus = this._skillQualificationBonuses[i];
				ValueTuple<sbyte, sbyte> skillGroupAndType = bonus.GetSkillGroupAndType();
				sbyte skillGroup = skillGroupAndType.Item1;
				sbyte skillType = skillGroupAndType.Item2;
				bool flag3 = skillGroup == expectSkillGroup && skillType == expectSkillType;
				if (flag3)
				{
					value += bonus.Bonus;
				}
				i++;
			}
			return (int)value;
		}

		// Token: 0x06006CDF RID: 27871 RVA: 0x003D02CC File Offset: 0x003CE4CC
		private int CalcChickenAddValue(ECharacterPropertyReferencedType propertyType)
		{
			sbyte personalityType;
			bool flag = !propertyType.TryParsePersonalityType(out personalityType);
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				int value = 0;
				short orgMemberTemplateId = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo).TemplateId;
				foreach (GameData.Domains.Building.Chicken chicken in DomainManager.Building.GetFulongChickens(orgMemberTemplateId))
				{
					ChickenItem config = Config.Chicken.Instance[chicken.TemplateId];
					bool flag2 = config.PersonalityType == personalityType;
					if (flag2)
					{
						value += config.PersonalityValue;
					}
				}
				result = value;
			}
			return result;
		}

		// Token: 0x06006CE0 RID: 27872 RVA: 0x003D0380 File Offset: 0x003CE580
		private unsafe int CalcSamsaraPlatformAddValue(ECharacterPropertyReferencedType propertyType)
		{
			sbyte mainAttributeType;
			bool flag = propertyType.TryParseMainAttributeType(out mainAttributeType);
			int result;
			if (flag)
			{
				result = (int)(*DomainManager.Building.GetSamsaraPlatformAddMainAttributes()[(int)mainAttributeType]);
			}
			else
			{
				sbyte lifeSkillType;
				bool flag2 = propertyType.TryParseLifeSkillQualificationType(out lifeSkillType);
				if (flag2)
				{
					result = (int)(*DomainManager.Building.GetSamsaraPlatformAddLifeSkillQualifications()[(int)lifeSkillType]);
				}
				else
				{
					sbyte combatSkillType;
					bool flag3 = propertyType.TryParseCombatSkillQualificationType(out combatSkillType);
					if (flag3)
					{
						result = (int)(*DomainManager.Building.GetSamsaraPlatformAddCombatSkillQualifications()[(int)combatSkillType]);
					}
					else
					{
						result = 0;
					}
				}
			}
			return result;
		}

		// Token: 0x06006CE1 RID: 27873 RVA: 0x003D0400 File Offset: 0x003CE600
		private int CalcSectXuannvUnlockedMusicAddValue(ECharacterPropertyReferencedType propertyType)
		{
			bool flag = propertyType == ECharacterPropertyReferencedType.HitRateMind || propertyType == ECharacterPropertyReferencedType.AvoidRateMind;
			bool flag2 = !flag;
			int result;
			if (flag2)
			{
				result = 0;
			}
			else
			{
				int value = 0;
				bool isHit = propertyType == ECharacterPropertyReferencedType.HitRateMind;
				foreach (short musicId in DomainManager.Extra.GetSectXuannvUnlockedMusicList())
				{
					MusicItem musicCfg = Music.Instance[musicId];
					value += (isHit ? ((int)musicCfg.HitRateMind) : musicCfg.AvoidRateMind);
				}
				result = value;
			}
			return result;
		}

		// Token: 0x06006CE2 RID: 27874 RVA: 0x003D04AC File Offset: 0x003CE6AC
		private int CalcAvatarAttraction()
		{
			bool flag = !this.IsCreatedWithFixedTemplate();
			int result;
			if (flag)
			{
				result = (int)this._avatar.GetCharm(this.GetPhysiologicalAge(), this.GetClothingDisplayIdForCharm());
			}
			else
			{
				ProfessionData professionData = DomainManager.Extra.GetProfessionData(1);
				HunterSkillsData skillsData = professionData.GetSkillsData<HunterSkillsData>();
				ItemKey itemKey;
				short attraction;
				bool flag2 = skillsData.AnimalCharIdToItemKey != null && skillsData.AnimalCharIdToItemKey.TryGetValue(this._id, out itemKey) && skillsData.AnimalCharIdToAttraction != null && skillsData.AnimalCharIdToAttraction.TryGetValue(itemKey, out attraction);
				if (flag2)
				{
					result = (int)attraction;
				}
				else
				{
					result = (int)this.Template.BaseAttraction;
				}
			}
			return result;
		}

		// Token: 0x06006CE3 RID: 27875 RVA: 0x003D054C File Offset: 0x003CE74C
		private int GetReversedFeatureBonus(ECharacterPropertyReferencedType propertyType, int originBonus, short featureId)
		{
			bool flag = !Character.BonusPropertyTypes.Contains(propertyType);
			int result;
			if (flag)
			{
				result = originBonus;
			}
			else
			{
				CharacterFeatureItem config = CharacterFeature.Instance[featureId];
				int reverseStatus = DomainManager.SpecialEffect.GetModifyValue(this._id, 293, EDataModifyType.Add, -1, -1, -1, EDataSumType.All);
				bool flag2 = (originBonus < 0 && reverseStatus > 0 && config.IsBad()) || (originBonus > 0 && reverseStatus < 0 && config.IsGood());
				if (flag2)
				{
					result = -originBonus;
				}
				else
				{
					result = originBonus;
				}
			}
			return result;
		}

		// Token: 0x06006CE4 RID: 27876 RVA: 0x003D05CC File Offset: 0x003CE7CC
		private CValueModify GetPropertyBonusOfFeatures(ECharacterPropertyReferencedType propertyType)
		{
			int add = 0;
			int addPercent = 0;
			bool standardIsAdd = CharacterPropertyReferenced.Instance[(int)propertyType].FeatureStandardIsAdd;
			foreach (short featureId in this._featureIds)
			{
				bool flag = this.IgnoreFeature(featureId) && propertyType >= ECharacterPropertyReferencedType.PersonalityCalm && propertyType <= ECharacterPropertyReferencedType.PersonalityPerceptive;
				if (!flag)
				{
					CharacterFeatureItem config = CharacterFeature.Instance[featureId];
					int value = config.GetCharacterPropertyBonusInt(propertyType);
					value = this.GetReversedFeatureBonus(propertyType, value, featureId);
					bool flag2 = standardIsAdd;
					if (flag2)
					{
						add += value;
					}
					else
					{
						addPercent += value;
					}
					int num = addPercent;
					if (!true)
					{
					}
					int num2;
					if (propertyType != ECharacterPropertyReferencedType.Attraction)
					{
						if (propertyType != ECharacterPropertyReferencedType.MaxHealth)
						{
							num2 = 0;
						}
						else
						{
							num2 = (int)config.MaxHealthPercentBonus;
						}
					}
					else
					{
						num2 = (int)config.AttractionPercentBonus;
					}
					if (!true)
					{
					}
					addPercent = num + num2;
				}
			}
			return new CValueModify(add, addPercent, default(CValuePercentBonus), default(CValuePercentBonus));
		}

		// Token: 0x06006CE5 RID: 27877 RVA: 0x003D06F8 File Offset: 0x003CE8F8
		private int GetPropertyBonusOfEquipments(ECharacterPropertyReferencedType propertyType)
		{
			int bonus = 0;
			for (int i = 0; i < 12; i++)
			{
				ItemKey itemKey = this._equipment[i];
				bool flag = itemKey.IsValid();
				if (flag)
				{
					int value = DomainManager.Item.GetCharacterPropertyBonus(itemKey, propertyType);
					bonus += DomainManager.SpecialEffect.ModifyValue(this._id, 310, value, (int)itemKey.ItemType, itemKey.Id, (int)propertyType, 0, 0, 0, 0);
				}
			}
			return bonus;
		}

		// Token: 0x06006CE6 RID: 27878 RVA: 0x003D0778 File Offset: 0x003CE978
		private int GetPropertyBonusOfCombatSkillEquippingAndBreakout(ECharacterPropertyReferencedType propertyType)
		{
			int bonus = 0;
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> charCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(this._id);
			CombatSkillEquipment skillEquipment = this.GetCombatSkillEquipment();
			foreach (short skillTemplateId in skillEquipment)
			{
				bool flag = skillTemplateId < 0;
				if (!flag)
				{
					bool flag2 = !this.GetCombatSkillCanAffect(skillTemplateId);
					if (!flag2)
					{
						bool flag3 = !charCombatSkills.ContainsKey(skillTemplateId);
						if (flag3)
						{
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(72, 3);
							defaultInterpolatedStringHandler.AppendLiteral("character ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
							defaultInterpolatedStringHandler.AppendLiteral(" has never learned combat skill ");
							defaultInterpolatedStringHandler.AppendFormatted<short>(skillTemplateId);
							defaultInterpolatedStringHandler.AppendLiteral("(");
							defaultInterpolatedStringHandler.AppendFormatted(Config.CombatSkill.Instance[skillTemplateId].Name);
							defaultInterpolatedStringHandler.AppendLiteral(") but is trying to access it.");
							AdaptableLog.Warning(defaultInterpolatedStringHandler.ToStringAndClear(), false);
						}
						else
						{
							bonus += charCombatSkills[skillTemplateId].GetCharPropertyBonus(propertyType);
						}
					}
				}
			}
			return bonus;
		}

		// Token: 0x06006CE7 RID: 27879 RVA: 0x003D08AC File Offset: 0x003CEAAC
		private void OfflineUpdateHobbyExpirationDate()
		{
			int expYear = (int)(DomainManager.World.GetCurrYear() + (short)this.GetHobbyChangingPeriod());
			int expDate = expYear * 12 + (int)this._birthMonth;
			this._hobbyExpirationDate = expDate;
		}

		// Token: 0x06006CE8 RID: 27880 RVA: 0x003D08E0 File Offset: 0x003CEAE0
		private void OfflineChangeHobby(IRandomSource random)
		{
			ValueTuple<short, short> valueTuple = Character.GenerateRandomHobby(random);
			this._lovingItemSubType = valueTuple.Item1;
			this._hatingItemSubType = valueTuple.Item2;
			sbyte favorabilityType = FavorabilityType.GetFavorabilityType(DomainManager.Character.GetFavorability(this._id, DomainManager.Taiwu.GetTaiwuCharId()));
			bool flag = favorabilityType < 3;
			if (flag)
			{
				this._lovingItemRevealed = false;
				this._hatingItemRevealed = false;
			}
			else
			{
				this._lovingItemRevealed = true;
				this._hatingItemRevealed = true;
			}
			this.OfflineUpdateHobbyExpirationDate();
		}

		// Token: 0x06006CE9 RID: 27881 RVA: 0x003D0960 File Offset: 0x003CEB60
		private void CommitChangingHobby(DataContext context)
		{
			this.SetLovingItemSubType(this._lovingItemSubType, context);
			this.SetHatingItemSubType(this._hatingItemSubType, context);
			this.SetLovingItemRevealed(this._lovingItemRevealed, context);
			this.SetHatingItemRevealed(this._hatingItemRevealed, context);
			this.SetHobbyExpirationDate(this._hobbyExpirationDate, context);
			this.ChangeMerchantType(context, this.GetOrganizationInfo());
		}

		// Token: 0x06006CEA RID: 27882 RVA: 0x003D09C4 File Offset: 0x003CEBC4
		private bool IgnoreFeature(short featureId)
		{
			bool flag = featureId == 483 && this.IsTaiwu();
			if (flag)
			{
				sbyte stateTemplateId = DomainManager.Map.GetStateTemplateIdByAreaId(this.GetValidLocation().AreaId);
				bool flag2 = stateTemplateId != 11;
				if (flag2)
				{
					return true;
				}
			}
			return false;
		}

		// Token: 0x06006CEB RID: 27883 RVA: 0x003D0A14 File Offset: 0x003CEC14
		public bool IsMerchant(OrganizationInfo organizationInfo)
		{
			OrganizationItem organizationConfig = Organization.Instance[organizationInfo.OrgTemplateId];
			OrganizationMemberItem organizationMemberConfig = OrganizationDomain.GetOrgMemberConfig(organizationInfo);
			List<sbyte> identityInteractConfig = organizationMemberConfig.IdentityInteractConfig;
			return organizationConfig.IsCivilian && organizationInfo.Grade == 4 && identityInteractConfig != null && identityInteractConfig.Contains(4);
		}

		// Token: 0x06006CEC RID: 27884 RVA: 0x003D0A70 File Offset: 0x003CEC70
		public void ChangeMerchantType(DataContext context, OrganizationInfo organizationInfo)
		{
			bool flag = organizationInfo.OrgTemplateId == 16;
			if (flag)
			{
				VillagerRoleBase villagerRole = DomainManager.Extra.GetVillagerRole(this._id);
				VillagerRoleMerchant merchant = villagerRole as VillagerRoleMerchant;
				bool flag2 = merchant == null;
				if (!flag2)
				{
					sbyte type = merchant.CurrentMerchantType;
					bool flag3 = type == 7;
					if (flag3)
					{
						type = merchant.SelfDecideMerchantType;
					}
					this.AddOrSetMerchantType(type, context);
				}
			}
			else
			{
				bool flag4 = this.IsMerchant(organizationInfo);
				if (flag4)
				{
					sbyte type2 = (sbyte)context.Random.Next(7);
					this.AddOrSetMerchantType(type2, context);
				}
				else
				{
					this.RemoveMerchantType(context);
				}
			}
		}

		// Token: 0x06006CED RID: 27885 RVA: 0x003D0B0C File Offset: 0x003CED0C
		public void AddOrSetMerchantType(sbyte type, DataContext context)
		{
			sbyte b;
			bool flag = DomainManager.Extra.TryGetMerchantCharToType(this._id, out b);
			if (flag)
			{
				DomainManager.Extra.SetMerchantCharToType(this._id, type, context);
			}
			else
			{
				DomainManager.Extra.AddMerchantCharToType(this._id, type, context);
			}
		}

		// Token: 0x06006CEE RID: 27886 RVA: 0x003D0B58 File Offset: 0x003CED58
		public void RemoveMerchantType(DataContext context)
		{
			sbyte b;
			bool flag = DomainManager.Extra.TryGetMerchantCharToType(this._id, out b);
			if (flag)
			{
				DomainManager.Extra.RemoveMerchantCharToType(this._id, context);
			}
		}

		// Token: 0x06006CEF RID: 27887 RVA: 0x003D0B8E File Offset: 0x003CED8E
		[Obsolete("This method is obsolete, and will be removed in future. Use ChangeCurrMainAttribute instead.")]
		public void ChangeCurrMainAttributeWithoutSpecialEffect(DataContext context, sbyte mainAttributeType, int delta)
		{
			this.ChangeCurrMainAttribute(context, mainAttributeType, delta);
		}

		// Token: 0x06006CF0 RID: 27888 RVA: 0x003D0B9B File Offset: 0x003CED9B
		[Obsolete("This method is obsolete, and will be removed in future. Use ChangeCurrMainAttributes instead.")]
		public void ChangeCurrMainAttributesWithoutSpecialEffect(DataContext context, MainAttributes delta)
		{
			this.ChangeCurrMainAttributes(context, delta);
		}

		// Token: 0x06006CF1 RID: 27889 RVA: 0x003D0BA8 File Offset: 0x003CEDA8
		public void OfflineInheritCrossArchiveCharacter(Character crossArchiveChar)
		{
			this._templateId = crossArchiveChar._templateId;
			this._creatingType = crossArchiveChar._creatingType;
			this._genome = crossArchiveChar._genome;
			this._gender = crossArchiveChar._gender;
			this._transgender = crossArchiveChar._transgender;
			this._bisexual = crossArchiveChar._bisexual;
			this._actualAge = crossArchiveChar._actualAge;
			this._currAge = crossArchiveChar._currAge;
			this._birthMonth = crossArchiveChar._birthMonth;
			this._avatar = crossArchiveChar._avatar;
			this._fullName = crossArchiveChar._fullName;
			this._monasticTitle = crossArchiveChar._monasticTitle;
			this._monkType = crossArchiveChar._monkType;
			this._baseMaxHealth = crossArchiveChar._baseMaxHealth;
			this._health = crossArchiveChar._health;
			this._baseMorality = crossArchiveChar._baseMorality;
			this._happiness = crossArchiveChar._happiness;
			this._baseMainAttributes = crossArchiveChar._baseMainAttributes;
			this._currMainAttributes = crossArchiveChar._currMainAttributes;
			this._featureIds = new List<short>(crossArchiveChar._featureIds);
			this._featureIds.RemoveAll((short featureId) => !CharacterFeature.Instance[featureId].CanCrossArchive);
			this._potentialFeatureIds = crossArchiveChar._potentialFeatureIds;
			this._extraNeili = crossArchiveChar._extraNeili;
			this._baseCombatSkillQualifications = crossArchiveChar._baseCombatSkillQualifications;
			this._baseLifeSkillQualifications = crossArchiveChar._baseLifeSkillQualifications;
			this._combatSkillQualificationGrowthType = crossArchiveChar._combatSkillQualificationGrowthType;
			this._lifeSkillQualificationGrowthType = crossArchiveChar._lifeSkillQualificationGrowthType;
			this._skillQualificationBonuses = new List<SkillQualificationBonus>(crossArchiveChar._skillQualificationBonuses);
			this._mainAttributeInterest = crossArchiveChar._mainAttributeInterest;
			this._combatSkillTypeInterest = crossArchiveChar._combatSkillTypeInterest;
			this._lifeSkillTypeInterest = crossArchiveChar._lifeSkillTypeInterest;
			this._idealSect = crossArchiveChar._idealSect;
			this._lovingItemSubType = crossArchiveChar._lovingItemSubType;
			this._hatingItemSubType = crossArchiveChar._hatingItemSubType;
			this._lovingItemRevealed = crossArchiveChar._lovingItemRevealed;
			this._hatingItemRevealed = crossArchiveChar._hatingItemRevealed;
			this._hobbyExpirationDate = crossArchiveChar._hobbyExpirationDate;
			this._baseNeiliProportionOfFiveElements = crossArchiveChar._baseNeiliProportionOfFiveElements;
			this._preexistenceCharIds = crossArchiveChar._preexistenceCharIds;
			this._injuries.Initialize();
			this._poisoned.Initialize();
			this._disorderOfQi = 0;
		}

		// Token: 0x17000479 RID: 1145
		// (get) Token: 0x06006CF2 RID: 27890 RVA: 0x003D0DD4 File Offset: 0x003CEFD4
		public int DarkAshDuration
		{
			get
			{
				int date = DomainManager.Extra.GetTemporaryFeatureExpireDate(this._id, 758);
				return (date != -1) ? (date - DomainManager.World.GetCurrDate()) : -1;
			}
		}

		// Token: 0x1700047A RID: 1146
		// (get) Token: 0x06006CF3 RID: 27891 RVA: 0x003D0E0A File Offset: 0x003CF00A
		public int SaveFromInfectedGainFaith
		{
			get
			{
				return (int)GlobalConfig.FuyuFaithCountBySaveInfected[Math.Clamp((int)this._consummateLevel, 0, GlobalConfig.FuyuFaithCountBySaveInfected.Length - 1)];
			}
		}

		// Token: 0x06006CF4 RID: 27892 RVA: 0x003D0E28 File Offset: 0x003CF028
		public void AddDarkAsh(DataContext context, LifeRecordCollection lifeRecordCollection = null, int baseTime = -2147483648)
		{
			bool flag = baseTime == int.MinValue;
			if (flag)
			{
				int factor = DomainManager.World.GetCharacterLifeSpanFactor();
				baseTime = (GlobalConfig.Instance.DarkAshDurationBase * factor + context.Random.Next(factor * GlobalConfig.Instance.DarkAshDurationRangeMax - (factor - 100))) / 100;
			}
			int currDate = DomainManager.World.GetCurrDate();
			int consummateLevelExpiredDate = currDate + (int)this._consummateLevel;
			int darkAshExpiredDate = consummateLevelExpiredDate + baseTime;
			this.AddFeature(context, 758, false);
			DomainManager.Extra.RegisterCharacterTemporaryFeature(context, this._id, 758, darkAshExpiredDate);
			DarkAshCounterData data;
			bool flag2 = DomainManager.Extra.TryGetDarkAshCounterData(this._id, out data);
			if (flag2)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(70, 2);
				defaultInterpolatedStringHandler.AppendLiteral("DarkAsh counter May duplicate for char ");
				defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
				defaultInterpolatedStringHandler.AppendLiteral(", please check the call stack:\n");
				defaultInterpolatedStringHandler.AppendFormatted<StackTrace>(new StackTrace());
				AdaptableLog.Warning(defaultInterpolatedStringHandler.ToStringAndClear(), false);
				DomainManager.Extra.SetDarkAshCounterData(context, this._id, new DarkAshCounterData(currDate, (int)this._consummateLevel, 0));
			}
			else
			{
				DomainManager.Extra.AddDarkAshCounterData(context, this._id, new DarkAshCounterData(currDate, (int)this._consummateLevel, 0));
			}
			if (lifeRecordCollection != null)
			{
				lifeRecordCollection.AddGetInfected(this._id, currDate, this._location);
			}
		}

		// Token: 0x06006CF5 RID: 27893 RVA: 0x003D0F7C File Offset: 0x003CF17C
		public void DirectlyChangeDarkAshDuration(DataContext context, int currDate, int baseTime, int consummateTime, int faithTime)
		{
			DomainManager.Extra.RegisterCharacterTemporaryFeature(context, this._id, 758, currDate + baseTime + consummateTime + faithTime);
			DarkAshCounterData data;
			bool flag = DomainManager.Extra.TryGetDarkAshCounterData(this._id, out data);
			if (flag)
			{
				DomainManager.Extra.SetDarkAshCounterData(context, this._id, new DarkAshCounterData(currDate, consummateTime, faithTime));
			}
			else
			{
				DomainManager.Extra.AddDarkAshCounterData(context, this._id, new DarkAshCounterData(currDate, consummateTime, faithTime));
			}
		}

		// Token: 0x06006CF6 RID: 27894 RVA: 0x003D1000 File Offset: 0x003CF200
		public void SavedFromInfected(DataContext context, bool batchMode = false)
		{
			int faithCount = this.SaveFromInfectedGainFaith;
			DomainManager.Extra.AddFuyuFaith(context, faithCount);
			bool flag = !batchMode && faithCount > 0;
			if (flag)
			{
				DomainManager.World.GetInstantNotificationCollection().AddGainFuyuFaith1(this._id, faithCount);
			}
		}

		// Token: 0x06006CF7 RID: 27895 RVA: 0x003D1047 File Offset: 0x003CF247
		public void RemoveDarkAsh(DataContext context)
		{
			this.RemoveFeature(context, 758);
			DomainManager.Extra.UnregisterCharacterTemporaryFeature(context, this._id, 758);
			DomainManager.Extra.RemoveDarkAshCounterData(context, this._id);
		}

		// Token: 0x06006CF8 RID: 27896 RVA: 0x003D1080 File Offset: 0x003CF280
		public DarkAshCounter GetDarkAshCounter()
		{
			DarkAshCounterData data;
			return DomainManager.Extra.TryGetDarkAshCounterData(this._id, out data) ? new DarkAshCounter(this.DarkAshDuration + DomainManager.World.GetCurrDate(), DomainManager.World.GetCurrDate(), data) : new DarkAshCounter(this.DarkAshDuration + DomainManager.World.GetCurrDate(), DomainManager.World.GetCurrDate());
		}

		// Token: 0x06006CF9 RID: 27897 RVA: 0x003D10E4 File Offset: 0x003CF2E4
		public bool ShouldNotifyDarkAshInfected(out int duration)
		{
			int num = duration = this.DarkAshDuration;
			return num <= 6 && num > 0;
		}

		// Token: 0x06006CFA RID: 27898 RVA: 0x003D1108 File Offset: 0x003CF308
		public void ExtendDarkAshWithFuyuFaith(DataContext context, int delta, LifeRecordCollection lifeRecordCollection = null)
		{
			int currDate = DomainManager.World.GetCurrDate();
			ExtraDomain extra = DomainManager.Extra;
			int id = this._id;
			short featureTemplateId = 758;
			int date = DomainManager.Extra.GetTemporaryFeatureExpireDate(this._id, 758);
			extra.RegisterCharacterTemporaryFeature(context, id, featureTemplateId, (date != -1) ? (date + delta) : (currDate + delta));
			DarkAshCounterData data;
			bool flag = DomainManager.Extra.TryGetDarkAshCounterData(this._id, out data);
			if (flag)
			{
				DomainManager.Extra.SetDarkAshCounterData(context, this._id, data.OfflineApplyFaithChangeToExtraData(currDate, delta));
			}
			else
			{
				DomainManager.Extra.AddDarkAshCounterData(context, this._id, new DarkAshCounterData(currDate, 0, delta));
			}
			DomainManager.Extra.AddFuyuFaith(context, -delta);
			if (lifeRecordCollection != null)
			{
				lifeRecordCollection.AddExtendDarkAshTime(this._id, currDate, this._location);
			}
		}

		// Token: 0x06006CFB RID: 27899 RVA: 0x003D11D0 File Offset: 0x003CF3D0
		public unsafe sbyte GetCurrMaxEatingSlotsCount()
		{
			short maxVitality = *(ref this.GetMaxMainAttributes().Items.FixedElementField + (IntPtr)3 * 2);
			return EatingItems.CalcMaxEatingSlotsCount((int)maxVitality);
		}

		// Token: 0x06006CFC RID: 27900 RVA: 0x003D1204 File Offset: 0x003CF404
		public unsafe void AddEatingItem(DataContext context, ItemKey itemKey, IReadOnlyList<sbyte> targetBodyParts = null)
		{
			Tester.Assert(itemKey.IsValid(), "");
			bool flag = itemKey.ItemType == 8;
			if (flag)
			{
				MedicineItem config = Config.Medicine.Instance[itemKey.TemplateId];
				bool instantAffect = config.InstantAffect;
				if (instantAffect)
				{
					this.ApplyEatingItemInstantEffects(context, itemKey.ItemType, itemKey.TemplateId, targetBodyParts);
					bool flag2 = config.Duration == 0;
					if (flag2)
					{
						this.TryApplyAttachedPoison(context, itemKey);
					}
				}
				bool flag3 = config.Duration > 0;
				if (flag3)
				{
					this.AddEatingItemWithoutInstantEffects(context, itemKey);
				}
				sbyte mainAttrType = config.RequiredMainAttributeType;
				bool flag4 = mainAttrType >= 0;
				if (flag4)
				{
					sbyte mainAttrValue = config.RequiredMainAttributeValue;
					short currMainAttribute = *this.GetCurrMainAttributes()[(int)mainAttrType];
					bool flag5 = currMainAttribute < (short)mainAttrValue;
					if (flag5)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(10, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Character ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(this._id);
						string tag = defaultInterpolatedStringHandler.ToStringAndClear();
						defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(61, 4);
						defaultInterpolatedStringHandler.AppendLiteral("Current main attribute ");
						defaultInterpolatedStringHandler.AppendFormatted<sbyte>(mainAttrType);
						defaultInterpolatedStringHandler.AppendLiteral(" (");
						defaultInterpolatedStringHandler.AppendFormatted<short>(currMainAttribute);
						defaultInterpolatedStringHandler.AppendLiteral("/");
						defaultInterpolatedStringHandler.AppendFormatted<sbyte>(mainAttrValue);
						defaultInterpolatedStringHandler.AppendLiteral(") is not enough to apply medicine ");
						defaultInterpolatedStringHandler.AppendFormatted(config.Name);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						AdaptableLog.TagWarning(tag, defaultInterpolatedStringHandler.ToStringAndClear(), false);
						return;
					}
					ref short ptr = ref this._currMainAttributes[(int)mainAttrType];
					ptr -= (short)mainAttrValue;
					this.SetCurrMainAttributes(this._currMainAttributes, context);
				}
			}
			else
			{
				this.ApplyEatingItemInstantEffects(context, itemKey.ItemType, itemKey.TemplateId, targetBodyParts);
				this.AddEatingItemWithoutInstantEffects(context, itemKey);
			}
			bool flag6 = this._id == DomainManager.Taiwu.GetTaiwuCharId() && itemKey.ItemType == 9;
			if (flag6)
			{
				ItemBase item = DomainManager.Item.GetBaseItem(itemKey);
				int price = item.GetValue();
				bool flag7 = ItemTemplateHelper.GetItemSubType(itemKey.ItemType, itemKey.TemplateId) == 900;
				if (flag7)
				{
					ProfessionFormulaItem formula = ProfessionFormula.Instance[99];
					int addSeniority = formula.Calculate(price);
					DomainManager.Extra.ChangeProfessionSeniority(context, 16, addSeniority, true, false);
				}
				else
				{
					ProfessionFormulaItem formula2 = ProfessionFormula.Instance[48];
					int addSeniority2 = formula2.Calculate(price);
					DomainManager.Extra.ChangeProfessionSeniority(context, 7, addSeniority2, true, false);
				}
			}
			bool flag8 = this.IsTaiwu() && itemKey.ItemType != 9;
			if (flag8)
			{
				int value = DomainManager.Item.GetValue(itemKey);
				int addSeniority3 = ProfessionFormulaImpl.Calculate(62, value);
				DomainManager.Extra.ChangeProfessionSeniority(context, 9, addSeniority3, true, false);
			}
		}

		// Token: 0x06006CFD RID: 27901 RVA: 0x003D14D8 File Offset: 0x003CF6D8
		public void ApplyEatingItemInstantEffects(DataContext context, sbyte itemType, short templateId, IReadOnlyList<sbyte> targetBodyParts = null)
		{
			switch (itemType)
			{
			case 5:
			{
				MaterialItem config = Config.Material.Instance[templateId];
				short value = config.BaseMaxHealthDelta;
				bool flag = value != 0;
				if (flag)
				{
					this.ChangeBaseMaxHealth(context, (int)value, true);
				}
				bool flag2 = config.PrimaryEffectType >= EMedicineEffectType.RecoverOuterInjury;
				if (flag2)
				{
					MedicineEatingInstantEffect eatingEffect = new MedicineEatingInstantEffect(config, true);
					this.ApplyMedicineInstantEffect(context, ref eatingEffect);
				}
				bool flag3 = config.SecondaryEffectType >= EMedicineEffectType.RecoverOuterInjury;
				if (flag3)
				{
					MedicineEatingInstantEffect eatingEffect2 = new MedicineEatingInstantEffect(config, false);
					this.ApplyMedicineInstantEffect(context, ref eatingEffect2);
				}
				return;
			}
			case 7:
			{
				FoodItem config2 = Config.Food.Instance[templateId];
				this.ApplyFoodInstantEffect(context, config2);
				return;
			}
			case 8:
			{
				MedicineItem config3 = Config.Medicine.Instance[templateId];
				bool flag4 = config3.EffectType != EMedicineEffectType.Invalid;
				if (flag4)
				{
					MedicineEatingInstantEffect eatingEffect3 = new MedicineEatingInstantEffect(config3, targetBodyParts);
					this.ApplyMedicineInstantEffect(context, ref eatingEffect3);
				}
				this.ApplySpecialMedicineEffect(context, templateId);
				return;
			}
			case 9:
			{
				TeaWineItem config4 = Config.TeaWine.Instance[templateId];
				this.ApplyTeaWineInstantEffect(context, config4);
				return;
			}
			case 12:
			{
				short value2 = Config.Misc.Instance[templateId].Neili;
				this.ChangeCurrNeili(context, (int)value2);
				return;
			}
			}
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(19, 1);
			defaultInterpolatedStringHandler.AppendLiteral("Invalid item type: ");
			defaultInterpolatedStringHandler.AppendFormatted<sbyte>(itemType);
			throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x06006CFE RID: 27902 RVA: 0x003D1664 File Offset: 0x003CF864
		public void AddEatingItemWithoutInstantEffects(DataContext context, ItemKey itemKey)
		{
			DomainManager.Item.SetPoisonsIdentified(context, itemKey, true);
			DomainManager.Item.SetOwner(itemKey, ItemOwnerType.CharacterEatingItem, this._id);
			bool itemOccupyAvailableEatingSlot = Character.OccupyAvailableEatingSlot(itemKey);
			sbyte currMaxEatingSlotsCount = this.GetCurrMaxEatingSlotsCount();
			int index = (int)(itemOccupyAvailableEatingSlot ? this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotsCount) : -1);
			bool flag = index < 0 && itemOccupyAvailableEatingSlot;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(this._id);
				defaultInterpolatedStringHandler.AppendLiteral(": EatingItems slots are full");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			short itemSubType = ItemTemplateHelper.GetItemSubType(itemKey.ItemType, itemKey.TemplateId);
			short duration = ItemTemplateHelper.GetEatableItemDuration(itemKey.ItemType, itemKey.TemplateId);
			bool flag2 = index >= 0;
			if (flag2)
			{
				this._eatingItems.Set(index, itemKey, duration);
				bool isImmune = this._id == DomainManager.Taiwu.GetTaiwuCharId() && ((itemSubType == 900 && DomainManager.Extra.IsProfessionalSkillUnlocked(16, 1)) || (itemSubType == 901 && DomainManager.Extra.IsProfessionalSkillUnlocked(7, 1)));
				bool flag3 = !isImmune;
				if (flag3)
				{
					short attachedPoisonDuration = this.TryApplyAttachedPoison(context, itemKey);
					ref this._eatingItems.ChangeDuration(context, index, attachedPoisonDuration);
				}
				this.SetEatingItems(ref this._eatingItems, context);
			}
			else
			{
				bool flag4 = itemKey.ItemType == 12;
				if (flag4)
				{
					this.TryApplyAttachedPoison(context, itemKey);
					DomainManager.Item.RemoveItem(context, itemKey);
				}
				else
				{
					bool flag5 = itemKey.ItemType == 8 && Config.Medicine.Instance[itemKey.TemplateId].WugGrowthType == 5;
					if (flag5)
					{
						this.AddWug(context, itemKey);
					}
				}
			}
			Events.RaiseEatingItem(context, this, itemKey);
			if (!true)
			{
			}
			bool flag6;
			if (itemSubType != 701)
			{
				flag6 = (itemSubType == 901 && this.IsForbiddenToDrinkingWines());
			}
			else
			{
				flag6 = this.IsForbiddenToEatMeat();
			}
			if (!true)
			{
			}
			bool eatForbiddenItem = flag6;
			bool flag7 = eatForbiddenItem;
			if (flag7)
			{
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				int currDate = DomainManager.World.GetCurrDate();
				Location location = this.GetLocation();
				lifeRecordCollection.AddMonkBreakRule(this._id, currDate, location, itemKey.ItemType, itemKey.TemplateId);
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddMonkBreakRule(this._id, (ulong)itemKey);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
			}
		}

		// Token: 0x06006CFF RID: 27903 RVA: 0x003D18E0 File Offset: 0x003CFAE0
		public void ApplyTopicalMedicine(DataContext context, ItemKey itemKey)
		{
			Tester.Assert(itemKey.IsValid(), "");
			bool flag = itemKey.ItemType != 8;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(19, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Invalid item type: ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(itemKey.ItemType);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			MedicineItem config = Config.Medicine.Instance[itemKey.TemplateId];
			bool flag2 = config.EffectType != EMedicineEffectType.RecoverOuterInjury && config.EffectType != EMedicineEffectType.RecoverInnerInjury;
			if (flag2)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(20, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Invalid EffectType: ");
				defaultInterpolatedStringHandler.AppendFormatted<EMedicineEffectType>(config.EffectType);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			this.OfflineApplyTopicalMedicineInternal(context.Random, config);
			this.SetCurrMainAttributes(this._currMainAttributes, context);
			this.SetInjuries(this._injuries, context);
			this.TryApplyAttachedPoison(context, itemKey);
		}

		// Token: 0x06006D00 RID: 27904 RVA: 0x003D19D4 File Offset: 0x003CFBD4
		public void ApplySpecialMedicineEffect(DataContext context, short templateId)
		{
			switch (templateId)
			{
			case 78:
				this._injuries.Initialize();
				this.SetInjuries(this._injuries, context);
				break;
			case 79:
			{
				this.SetXiangshuInfection(0, context);
				short featureId = XiangshuInfectionTypeHelper.GetInfectionFeatureIdThatShouldBe(this._xiangshuInfection);
				bool flag = this._featureIds.Contains(featureId);
				if (!flag)
				{
					this.AddFeature(context, featureId, true);
					Events.RaiseXiangshuInfectionFeatureChanged(context, this, featureId);
				}
				break;
			}
			case 80:
				break;
			case 81:
			{
				this.SetXiangshuInfection(100, context);
				short featureId2 = XiangshuInfectionTypeHelper.GetInfectionFeatureIdThatShouldBe(this._xiangshuInfection);
				bool flag2 = this._featureIds.Contains(featureId2);
				if (!flag2)
				{
					this.AddFeature(context, featureId2, true);
					Events.RaiseXiangshuInfectionFeatureChanged(context, this, featureId2);
				}
				break;
			}
			default:
				if (templateId != 346)
				{
					if (templateId == 387)
					{
						this.AddFeature(context, 337, false);
					}
				}
				else
				{
					bool flag3 = (int)this._currAge < GlobalConfig.Instance.AgeBaby;
					if (!flag3)
					{
						bool needChildCloth = this.GetAgeGroup() != 1;
						short oldAge = this._currAge;
						this.SetCurrAge((short)GlobalConfig.Instance.AgeBaby, context);
						Events.RaiseCharacterAgeChanged(context, this, (int)oldAge, (int)this._currAge);
						bool flag4 = needChildCloth;
						if (flag4)
						{
							ItemKey itemKey = DomainManager.Item.CreateClothing(context, 65, this._gender);
							this.AddInventoryItem(context, itemKey, 1, false);
							this.ChangeEquipment(context, -1, 4, itemKey);
						}
					}
				}
				break;
			}
		}

		// Token: 0x06006D01 RID: 27905 RVA: 0x003D1B6C File Offset: 0x003CFD6C
		public void AddWug(DataContext context, short medicineTemplateId)
		{
			ItemKey wugItemKey = new ItemKey(8, 0, medicineTemplateId, -1);
			this.AddWug(context, wugItemKey);
		}

		// Token: 0x06006D02 RID: 27906 RVA: 0x003D1B90 File Offset: 0x003CFD90
		public void AddWug(DataContext context, ItemKey wugItemKey)
		{
			Tester.Assert(wugItemKey.ItemType == 8, "");
			MedicineItem config = Config.Medicine.Instance[wugItemKey.TemplateId];
			Tester.Assert(config.ItemSubType == 802, "");
			int index = this._eatingItems.IndexOfWug(config);
			bool modified = (index >= 0) ? this.OfflineReplaceWug(context, index, wugItemKey) : this.OfflineAddNewWug(context, wugItemKey);
			bool flag = modified;
			if (flag)
			{
				this.SetEatingItems(ref this._eatingItems, context);
			}
		}

		// Token: 0x06006D03 RID: 27907 RVA: 0x003D1C14 File Offset: 0x003CFE14
		public void RemoveWug(DataContext context, short medicineTemplateId)
		{
			MedicineItem config = Config.Medicine.Instance[medicineTemplateId];
			int index = this._eatingItems.IndexOfWug(config);
			bool flag = index < 0;
			if (!flag)
			{
				ItemKey wugItemKey = this._eatingItems.Get(index);
				this._eatingItems.Clear(index);
				this._eatingItems.SortWugs();
				this.SetEatingItems(ref this._eatingItems, context);
				bool flag2 = wugItemKey.IsValid();
				if (flag2)
				{
					DomainManager.Item.RemoveItem(context, wugItemKey);
				}
				Events.RaiseRemoveWug(context, this._id, config.TemplateId);
			}
		}

		// Token: 0x06006D04 RID: 27908 RVA: 0x003D1CA8 File Offset: 0x003CFEA8
		public void OnDeathTransferWugKings(DataContext context, Location charLocation)
		{
			List<ItemKey> wugKings = ObjectPool<List<ItemKey>>.Instance.Get();
			this.OnDeathTransferWugKings(context, wugKings);
			InstantNotificationCollection instantNotification = DomainManager.World.GetInstantNotificationCollection();
			MonthlyNotificationCollection monthlyNotification = DomainManager.World.GetMonthlyNotificationCollection();
			foreach (ItemKey wugKing in wugKings)
			{
				this._inventory.OfflineAdd(wugKing, 1);
				bool flag = DomainManager.World.GetAdvancingMonthState() != 0;
				if (flag)
				{
					monthlyNotification.AddWugKingParasitiferDead(wugKing.ItemType, wugKing.TemplateId, charLocation, this._id);
				}
				else
				{
					instantNotification.AddWugKingParasitiferDead(wugKing.ItemType, wugKing.TemplateId, charLocation, this._id);
				}
			}
		}

		// Token: 0x06006D05 RID: 27909 RVA: 0x003D1D7C File Offset: 0x003CFF7C
		public void OnDeathTransferWugKings(DataContext context, List<ItemKey> wugKings)
		{
			for (int i = 0; i < 9; i++)
			{
				ItemKey itemKey = this._eatingItems.Get(i);
				bool flag = !EatingItems.IsWugKing(itemKey);
				if (!flag)
				{
					this._eatingItems.Clear(i);
					wugKings.Add(itemKey);
					Events.RaiseRemoveWug(context, this._id, itemKey.TemplateId);
				}
			}
		}

		// Token: 0x06006D06 RID: 27910 RVA: 0x003D1DE4 File Offset: 0x003CFFE4
		public unsafe void ClearEatingItems(DataContext context)
		{
			Character taiwu = DomainManager.Taiwu.GetTaiwu();
			Location location = taiwu.GetValidLocation();
			MapBlockData blockData = DomainManager.Map.GetBlock(location);
			InstantNotificationCollection instantNotification = DomainManager.World.GetInstantNotificationCollection();
			for (int i = 8; i >= 0; i--)
			{
				ItemKey itemKey = (ItemKey)(*(ref this._eatingItems.ItemKeys.FixedElementField + (IntPtr)i * 8));
				bool flag = EatingItems.IsWug(itemKey);
				if (flag)
				{
					Events.RaiseRemoveWug(context, this._id, itemKey.TemplateId);
				}
				bool flag2 = EatingItems.IsWugKing(itemKey) && this.Template.AllowDropWugKing;
				if (flag2)
				{
					DomainManager.Map.AddBlockItem(context, blockData, itemKey, 1);
					bool isPuppetCombat = DomainManager.Combat.GetIsPuppetCombat();
					if (isPuppetCombat)
					{
						instantNotification.AddWugKingEscape2(itemKey.ItemType, itemKey.TemplateId, location);
					}
					else
					{
						instantNotification.AddWugKingEscape1(itemKey.ItemType, itemKey.TemplateId, this._templateId, location);
					}
				}
				else
				{
					bool flag3 = itemKey.IsValid();
					if (flag3)
					{
						DomainManager.Item.RemoveItem(context, itemKey);
					}
				}
				this._eatingItems.Clear(i);
			}
			this.SetEatingItems(ref this._eatingItems, context);
		}

		// Token: 0x06006D07 RID: 27911 RVA: 0x003D1F28 File Offset: 0x003D0128
		public unsafe short TryApplyAttachedPoison(DataContext context, ItemKey itemKey)
		{
			FullPoisonEffects poisonEffect;
			bool flag = !ModificationStateHelper.IsActive(itemKey.ModificationState, 1) || !DomainManager.Item.PoisonEffects.TryGetValue(itemKey.Id, out poisonEffect);
			short result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				DomainManager.Item.SetPoisonsIdentified(context, itemKey, true);
				PoisonsAndLevels poisons = poisonEffect.GetAllPoisonsAndLevels();
				for (sbyte type = 0; type < 6; type += 1)
				{
					*(ref poisons.Values.FixedElementField + (IntPtr)type * 2) = *(ref poisons.Values.FixedElementField + (IntPtr)type * 2) * 10 * (short)(*(ref poisons.Levels.FixedElementField + type));
				}
				this.ChangePoisoned(context, ref poisons);
				short medicineTemplateId = poisonEffect.GetMedicineTemplateId();
				this.ApplyMixedPoisonInstantEffects(context);
				result = Config.Medicine.Instance[medicineTemplateId].Duration;
			}
			return result;
		}

		// Token: 0x06006D08 RID: 27912 RVA: 0x003D2004 File Offset: 0x003D0204
		private void ApplyMixedPoisonInstantEffects(DataContext context)
		{
			for (sbyte mixedPoisonType = 15; mixedPoisonType <= 34; mixedPoisonType += 1)
			{
				this.ApplyMixedPoisonInstantEffect(context, mixedPoisonType);
			}
		}

		// Token: 0x06006D09 RID: 27913 RVA: 0x003D2034 File Offset: 0x003D0234
		private void ApplyMixedPoisonInstantEffect(DataContext context, sbyte mixedPoisonType)
		{
			int markCount = this.GetMixedPoisonTypeRelatedMarkCount(mixedPoisonType);
			bool flag = markCount == 0;
			if (!flag)
			{
				short effectTemplateId = MixedPoisonType.ToMixPoisonEffectTemplateId(mixedPoisonType);
				MixPoisonEffectItem mixPoisonEffectCfg = MixPoisonEffect.Instance[(int)effectTemplateId];
				bool flag2 = !mixPoisonEffectCfg.InstantEffect;
				if (!flag2)
				{
					bool flag3 = this._creatingType == 1;
					if (flag3)
					{
						LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
						lifeRecordCollection.AddMixedPoisonEffectRecord(this, mixPoisonEffectCfg);
					}
					sbyte combatSkillEquipType = MixedPoisonType.ToCombatSkillEquipType(mixedPoisonType);
					bool flag4 = combatSkillEquipType != -1 && this.IsTaiwu();
					if (flag4)
					{
						DomainManager.Taiwu.ClearExceedCombatSkills(context);
					}
				}
			}
		}

		// Token: 0x06006D0A RID: 27914 RVA: 0x003D20C8 File Offset: 0x003D02C8
		private void MakeExistingInjuriesWorse(DataContext context, bool isInnerInjury, sbyte delta)
		{
			Injuries injuries = this.GetInjuries();
			for (sbyte bodyPart = 0; bodyPart < 7; bodyPart += 1)
			{
				sbyte partInjury = injuries.Get(bodyPart, isInnerInjury);
				bool flag = partInjury > 0;
				if (flag)
				{
					injuries.Change(bodyPart, isInnerInjury, (int)delta);
				}
			}
			this.SetInjuries(injuries, context);
		}

		// Token: 0x06006D0B RID: 27915 RVA: 0x003D2118 File Offset: 0x003D0318
		public unsafe int GetMixedPoisonTypeRelatedMarkCount(sbyte mixedPoisonType)
		{
			sbyte[] poisonTypes = MixedPoisonType.ToPoisonTypes[(int)mixedPoisonType];
			PoisonInts poisoned = this._poisoned;
			int totalCount = 0;
			foreach (sbyte poisonType in poisonTypes)
			{
				sbyte markCount = PoisonsAndLevels.CalcPoisonedLevel(*(ref poisoned.Items.FixedElementField + (IntPtr)poisonType * 4));
				bool flag = markCount == 0 || this.HasPoisonImmunity(poisonType);
				if (flag)
				{
					return 0;
				}
				totalCount += (int)markCount;
			}
			return totalCount;
		}

		// Token: 0x06006D0C RID: 27916 RVA: 0x003D2194 File Offset: 0x003D0394
		public unsafe int GetRealMixedPoisonTypeRelatedMarkCount(sbyte mixedPoisonType)
		{
			sbyte[] poisonTypes = MixedPoisonType.ToPoisonTypes[(int)mixedPoisonType];
			PoisonInts poisoned = this._poisoned;
			int totalCount = 0;
			foreach (sbyte poisonType in poisonTypes)
			{
				sbyte markCount = PoisonsAndLevels.CalcPoisonedLevel(*poisoned[(int)poisonType]);
				bool flag = markCount == 0 || this.GetPoisonImmunities()[(int)poisonType] || DomainManager.Extra.HasPoisonImmunity(this._id, poisonType);
				if (flag)
				{
					return 0;
				}
				totalCount += (int)markCount;
			}
			return totalCount;
		}

		// Token: 0x06006D0D RID: 27917 RVA: 0x003D221C File Offset: 0x003D041C
		private void ApplyMedicineInstantEffect(DataContext context, ref MedicineEatingInstantEffect effect)
		{
			switch (effect.EffectType)
			{
			case EMedicineEffectType.RecoverOuterInjury:
			{
				IReadOnlyList<sbyte> targetBodyParts = effect.TargetBodyParts;
				bool flag = targetBodyParts != null && targetBodyParts.Count > 0;
				if (flag)
				{
					this.CalcMedicineEffect_RecoverInjury(ref this._injuries, effect.TargetBodyParts, false, ref effect);
				}
				else
				{
					this.CalcMedicineEffect_RecoverInjury(ref this._injuries, context.Random, false, ref effect);
				}
				this.SetInjuries(this._injuries, context);
				break;
			}
			case EMedicineEffectType.RecoverInnerInjury:
			{
				IReadOnlyList<sbyte> targetBodyParts = effect.TargetBodyParts;
				bool flag2 = targetBodyParts != null && targetBodyParts.Count > 0;
				if (flag2)
				{
					this.CalcMedicineEffect_RecoverInjury(ref this._injuries, effect.TargetBodyParts, true, ref effect);
				}
				else
				{
					this.CalcMedicineEffect_RecoverInjury(ref this._injuries, context.Random, true, ref effect);
				}
				this.SetInjuries(this._injuries, context);
				break;
			}
			case EMedicineEffectType.RecoverHealth:
				this.CalcMedicineEffect_RecoverHealth(ref this._health, ref effect);
				this.SetHealth(this._health, context);
				break;
			case EMedicineEffectType.ChangeDisorderOfQi:
				this.CalcMedicineEffect_RecoverDisorderOfQi(ref this._disorderOfQi, ref effect);
				this.SetDisorderOfQi(this._disorderOfQi, context);
				break;
			case EMedicineEffectType.DetoxPoison:
				this.CalcMedicineEffect_DetoxPoison(ref this._poisoned, ref effect);
				this.SetPoisoned(ref this._poisoned, context);
				break;
			case EMedicineEffectType.DetoxWug:
			{
				sbyte wugType = effect.DetoxWugType;
				this.ApplyMedicineInstantEffect_DetoxWug(context, wugType, effect.Grade);
				break;
			}
			case EMedicineEffectType.ApplyPoison:
			{
				this.CalcMedicineEffect_ApplyPoison(ref this._poisoned, ref effect);
				this.SetPoisoned(ref this._poisoned, context);
				this.ApplyMixedPoisonInstantEffects(context);
				sbyte detoxWugType = effect.DetoxWugType;
				this.ApplyMedicineInstantEffect_DetoxWug(context, detoxWugType, effect.Grade);
				break;
			}
			}
		}

		// Token: 0x06006D0E RID: 27918 RVA: 0x003D23CC File Offset: 0x003D05CC
		public void CalcMedicineEffect_RecoverHealth(ref short health, ref MedicineEatingInstantEffect effect)
		{
			int delta = this.CalcMedicineEffectDelta((int)this.GetLeftMaxHealth(false), effect.EffectValue, effect.EffectIsPercentage);
			health = this.CalcChangedHealth(health, delta);
		}

		// Token: 0x06006D0F RID: 27919 RVA: 0x003D2400 File Offset: 0x003D0600
		public int CalcMedicineHealInjuryTimes(int effectValue)
		{
			CValuePercent effect = this.GetSpecialEffectModifiedMedicineEffectValue(100);
			return Math.Max(effectValue * effect, 1);
		}

		// Token: 0x06006D10 RID: 27920 RVA: 0x003D2430 File Offset: 0x003D0630
		public int GetSpecialEffectModifiedMedicineEffectValue(int effectValue)
		{
			return DomainManager.SpecialEffect.ModifyValue(this._id, 261, effectValue, -1, -1, -1, 0, 0, 0, 0);
		}

		// Token: 0x06006D11 RID: 27921 RVA: 0x003D245F File Offset: 0x003D065F
		public int CalcMedicineEffectDelta(int fullRangeValue, short effectValue, bool isPercentage)
		{
			return this.GetSpecialEffectModifiedMedicineEffectValue(EMedicineEffectSubTypeExtension.EffectValue(fullRangeValue, effectValue, isPercentage));
		}

		// Token: 0x06006D12 RID: 27922 RVA: 0x003D246F File Offset: 0x003D066F
		public int CalcMedicineEffectDelta_RecoverDisorderOfQi(short effectValue, bool isPercentage)
		{
			return -this.CalcMedicineEffectDelta((int)DisorderLevelOfQi.MaxValue, effectValue, isPercentage);
		}

		// Token: 0x06006D13 RID: 27923 RVA: 0x003D2480 File Offset: 0x003D0680
		public void CalcMedicineEffect_RecoverDisorderOfQi(ref short disorderOfQi, ref MedicineEatingInstantEffect effect)
		{
			int delta = this.CalcMedicineEffectDelta_RecoverDisorderOfQi(effect.EffectValue, effect.EffectIsPercentage);
			disorderOfQi = this.CalcChangedDisorderOfQiWithoutEffect(disorderOfQi, delta);
		}

		// Token: 0x06006D14 RID: 27924 RVA: 0x003D24AC File Offset: 0x003D06AC
		public unsafe void CalcMedicineEffect_DetoxPoison(ref PoisonInts poison, ref MedicineEatingInstantEffect effect)
		{
			sbyte poisonType = effect.PoisonType;
			sbyte poisonLevel = (sbyte)effect.EffectThresholdValue;
			bool flag = poisonLevel < PoisonsAndLevels.CalcPoisonedLevel(*(ref poison.Items.FixedElementField + (IntPtr)poisonType * 4));
			if (!flag)
			{
				int delta = -this.CalcMedicineEffectDelta(*(ref poison.Items.FixedElementField + (IntPtr)poisonType * 4), effect.EffectValue, effect.EffectIsPercentage);
				this.CalcChangedPoisoned(ref poison, poisonType, poisonLevel, delta);
			}
		}

		// Token: 0x06006D15 RID: 27925 RVA: 0x003D2518 File Offset: 0x003D0718
		public void CalcMedicineEffect_ApplyPoison(ref PoisonInts poison, ref MedicineEatingInstantEffect effect)
		{
			sbyte poisonType = effect.PoisonType;
			sbyte poisonLevel = (sbyte)effect.EffectThresholdValue;
			short delta = PoisonsAndLevels.CalcApplyItemPoisonAmount(effect.EffectValue, poisonLevel);
			this.CalcChangedPoisoned(ref poison, poisonType, poisonLevel, (int)delta);
		}

		// Token: 0x06006D16 RID: 27926 RVA: 0x003D2550 File Offset: 0x003D0750
		private void ApplyTeaWineInstantEffect(DataContext context, TeaWineItem config)
		{
			bool flag = this._id == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				short qiDelta = config.DirectChangeOfQiDisorder;
				bool flag2 = config.ItemSubType == 900;
				if (flag2)
				{
					bool flag3 = DomainManager.Extra.IsProfessionalSkillUnlockedAndEquipped(54);
					if (flag3)
					{
						int currGained = ProfessionSkillHandle.TeaTasterSkill_GetActionPointGained();
						int canGain = GlobalConfig.Instance.ProfessionSkillRecoverActionPointLimit - currGained;
						int actionPointDelta = config.ActionPointRecover;
						int delta = Math.Min(actionPointDelta, canGain);
						ProfessionSkillHandle.TeaTasterSkill_SetActionPointGained(context, currGained + delta);
						DomainManager.Extra.ChangeActionPoint(context, delta);
						bool flag4 = delta > 0;
						if (flag4)
						{
							DomainManager.World.GetInstantNotificationCollection().AddDrinkTeaRecharge(this._id, delta / 10);
						}
					}
					this.ChangeDisorderOfQiRandomRecovery(context, (int)qiDelta);
				}
				else
				{
					bool flag5 = !DomainManager.Extra.IsProfessionalSkillUnlocked(7, 1);
					if (flag5)
					{
						this.ChangeDisorderOfQiRandomRecovery(context, (int)qiDelta);
					}
				}
			}
			else
			{
				this.ChangeDisorderOfQiRandomRecovery(context, (int)config.DirectChangeOfQiDisorder);
			}
		}

		// Token: 0x06006D17 RID: 27927 RVA: 0x003D264C File Offset: 0x003D084C
		private void ApplyFoodInstantEffect(DataContext context, FoodItem config)
		{
			this.ChangeCurrMainAttributes(context, config.MainAttributesRegen);
		}

		// Token: 0x06006D18 RID: 27928 RVA: 0x003D2660 File Offset: 0x003D0860
		public void CalcMedicineEffect_RecoverInjury(ref Injuries injuries, IRandomSource random, bool inner, ref MedicineEatingInstantEffect config)
		{
			List<sbyte> targets = ObjectPool<List<sbyte>>.Instance.Get();
			List<sbyte> pool = ObjectPool<List<sbyte>>.Instance.Get();
			int remainRecoveryTimes = this.CalcMedicineHealInjuryTimes((int)config.InjuryRecoveryTimes);
			while (remainRecoveryTimes > 0)
			{
				pool.Clear();
				int maxValue = 0;
				for (sbyte part = 0; part < 7; part += 1)
				{
					sbyte value = injuries.Get(part, inner);
					bool flag = (short)value > config.EffectThresholdValue || value <= 0;
					if (!flag)
					{
						bool flag2 = targets.Contains(part);
						if (!flag2)
						{
							bool flag3 = (int)value > maxValue;
							if (flag3)
							{
								maxValue = (int)value;
								pool.Clear();
							}
							bool flag4 = (int)value == maxValue;
							if (flag4)
							{
								pool.Add(part);
							}
						}
					}
				}
				bool flag5 = pool.Count == 0;
				if (flag5)
				{
					break;
				}
				int recoveryTimes = Math.Min(remainRecoveryTimes, pool.Count);
				remainRecoveryTimes -= recoveryTimes;
				foreach (sbyte part2 in RandomUtils.GetRandomUnrepeated<sbyte>(random, recoveryTimes, pool, null))
				{
					targets.Add(part2);
				}
			}
			this.CalcMedicineEffect_RecoverInjury(ref injuries, targets, inner, ref config);
			ObjectPool<List<sbyte>>.Instance.Return(targets);
			ObjectPool<List<sbyte>>.Instance.Return(pool);
		}

		// Token: 0x06006D19 RID: 27929 RVA: 0x003D27C4 File Offset: 0x003D09C4
		public void CalcMedicineEffect_RecoverInjury(ref Injuries injuries, IReadOnlyList<sbyte> bodyParts, bool inner, ref MedicineEatingInstantEffect config)
		{
			foreach (sbyte part in bodyParts)
			{
				injuries.Change(part, inner, (int)(-(int)config.EffectValue));
			}
		}

		// Token: 0x06006D1A RID: 27930 RVA: 0x003D281C File Offset: 0x003D0A1C
		private void ApplyMedicineInstantEffect_DetoxWug(DataContext context, sbyte wugType, sbyte medicineGrade)
		{
			int index = this._eatingItems.IndexOfWug(wugType, false);
			bool flag = index < 0;
			if (!flag)
			{
				short deltaDuration = GameData.Domains.Item.Medicine.GetDeltaWugDuration(medicineGrade);
				short wugTemplateId = this._eatingItems.Get(index).TemplateId;
				ref this._eatingItems.ChangeDuration(context, index, deltaDuration);
				this.SetEatingItems(ref this._eatingItems, context);
				bool flag2 = this._eatingItems.Get(index) == ItemKey.Invalid;
				if (flag2)
				{
					Events.RaiseRemoveWug(context, this._id, wugTemplateId);
				}
			}
		}

		// Token: 0x06006D1B RID: 27931 RVA: 0x003D28A4 File Offset: 0x003D0AA4
		private unsafe void OfflineApplyTopicalMedicineInternal(IRandomSource random, MedicineItem config)
		{
			MedicineEatingInstantEffect effect = new MedicineEatingInstantEffect(config, null);
			bool isInner = effect.EffectType == EMedicineEffectType.RecoverInnerInjury;
			this.CalcMedicineEffect_RecoverInjury(ref this._injuries, random, isInner, ref effect);
			sbyte mainAttrType = config.RequiredMainAttributeType;
			bool flag = mainAttrType < 0;
			if (!flag)
			{
				sbyte mainAttrValue = config.RequiredMainAttributeValue;
				short currMainAttribute = *(ref this.GetCurrMainAttributes().Items.FixedElementField + (IntPtr)mainAttrType * 2);
				bool flag2 = currMainAttribute < (short)mainAttrValue;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(10, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Character ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(this._id);
					string tag = defaultInterpolatedStringHandler.ToStringAndClear();
					defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(69, 4);
					defaultInterpolatedStringHandler.AppendLiteral("Current main attribute ");
					defaultInterpolatedStringHandler.AppendFormatted<sbyte>(mainAttrType);
					defaultInterpolatedStringHandler.AppendLiteral(" (");
					defaultInterpolatedStringHandler.AppendFormatted<short>(currMainAttribute);
					defaultInterpolatedStringHandler.AppendLiteral("/");
					defaultInterpolatedStringHandler.AppendFormatted<sbyte>(mainAttrValue);
					defaultInterpolatedStringHandler.AppendLiteral(") is not enough to apply topical medicine ");
					defaultInterpolatedStringHandler.AppendFormatted(config.Name);
					defaultInterpolatedStringHandler.AppendLiteral(".");
					AdaptableLog.TagWarning(tag, defaultInterpolatedStringHandler.ToStringAndClear(), false);
				}
				else
				{
					ref short ptr = ref this._currMainAttributes.Items.FixedElementField + (IntPtr)mainAttrType * 2;
					ptr -= (short)mainAttrValue;
				}
			}
		}

		// Token: 0x06006D1C RID: 27932 RVA: 0x003D29EC File Offset: 0x003D0BEC
		private bool OfflineReplaceWug(DataContext context, int index, ItemKey wugItemKey)
		{
			ItemKey oriItemKey = this._eatingItems.Get(index);
			bool flag = !EatingItems.IsWug(oriItemKey) || !EatingItems.IsWug(wugItemKey);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(26, 2);
				defaultInterpolatedStringHandler.AppendLiteral("cannot replace ");
				defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(oriItemKey);
				defaultInterpolatedStringHandler.AppendLiteral(" to ");
				defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(wugItemKey);
				defaultInterpolatedStringHandler.AppendLiteral(" as wug");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			MedicineItem oriConfig = Config.Medicine.Instance[oriItemKey.TemplateId];
			MedicineItem curConfig = Config.Medicine.Instance[wugItemKey.TemplateId];
			this._eatingItems.Clear(index);
			this._eatingItems.Set(index, wugItemKey, curConfig.Duration);
			Events.RaiseRemoveWug(context, this._id, oriConfig.TemplateId);
			Events.RaiseAddWug(context, this._id, curConfig.TemplateId, oriConfig.TemplateId);
			bool flag2 = oriItemKey.IsValid();
			if (flag2)
			{
				DomainManager.Item.RemoveItem(context, oriItemKey);
			}
			return true;
		}

		// Token: 0x06006D1D RID: 27933 RVA: 0x003D2B00 File Offset: 0x003D0D00
		private unsafe bool OfflineAddNewWug(DataContext context, ItemKey wugItemKey)
		{
			sbyte index = this._eatingItems.GetSlotForNewWug();
			bool flag = index < 0;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(55, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(this._id);
				defaultInterpolatedStringHandler.AppendLiteral(": There is no potential available eating slot");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			MedicineItem config = Config.Medicine.Instance[wugItemKey.TemplateId];
			bool flag2 = ((ItemKey)(*(ref this._eatingItems.ItemKeys.FixedElementField + (IntPtr)index * 8))).IsValid();
			if (flag2)
			{
				this._eatingItems.Clear((int)index);
			}
			this._eatingItems.Set((int)index, wugItemKey, config.Duration);
			Events.RaiseAddWug(context, this._id, wugItemKey.TemplateId, -1);
			return true;
		}

		// Token: 0x06006D1E RID: 27934 RVA: 0x003D2BD8 File Offset: 0x003D0DD8
		private static bool OccupyAvailableEatingSlot(ItemKey itemKey)
		{
			bool flag = itemKey.ItemType == 12;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = ItemTemplateHelper.GetItemSubType(itemKey.ItemType, itemKey.TemplateId) == 802;
				result = !flag2;
			}
			return result;
		}

		// Token: 0x06006D1F RID: 27935 RVA: 0x003D2C20 File Offset: 0x003D0E20
		public sbyte GetFameType()
		{
			sbyte fameType = FameType.GetFameType(this.GetFame());
			bool flag = fameType != 3;
			sbyte result;
			if (flag)
			{
				result = fameType;
			}
			else
			{
				result = (this.IsBothGoodAndBad() ? -2 : 3);
			}
			return result;
		}

		// Token: 0x06006D20 RID: 27936 RVA: 0x003D2C5C File Offset: 0x003D0E5C
		public void RecordFameAction(DataContext context, short fameActionId, int targetCharId = -1, short fameMultiplier = 1, bool jumpAccordingToTargetFame = true)
		{
			FameActionItem template = FameAction.Instance[fameActionId];
			bool flag = targetCharId >= 0 && template.HasJump && jumpAccordingToTargetFame;
			if (flag)
			{
				sbyte targetFameType = 3;
				Character targetChar;
				bool flag2 = DomainManager.Character.TryGetElement_Objects(targetCharId, out targetChar);
				if (flag2)
				{
					targetFameType = targetChar.GetFameType();
				}
				else
				{
					DeadCharacter deadChar = DomainManager.Character.TryGetDeadCharacter(targetCharId);
					bool flag3 = deadChar != null;
					if (flag3)
					{
						targetFameType = deadChar.FameType;
					}
				}
				this.RecordFameAction(context, fameActionId, targetFameType, fameMultiplier);
			}
			else
			{
				this.RecordFameActionInternal(context, fameActionId, fameMultiplier);
			}
		}

		// Token: 0x06006D21 RID: 27937 RVA: 0x003D2CE8 File Offset: 0x003D0EE8
		public void RecordFameAction(DataContext context, short fameActionId, sbyte targetFameType, short fameMultiplier = 1)
		{
			FameActionItem template = FameAction.Instance[fameActionId];
			bool flag = targetFameType >= 0 && template.HasJump;
			if (flag)
			{
				bool flag2 = targetFameType == 3 || targetFameType == -2;
				if (flag2)
				{
					fameActionId = template.NormalJumpId;
				}
				else
				{
					bool flag3 = targetFameType < 3;
					if (flag3)
					{
						fameActionId = template.BadJumpId;
					}
					else
					{
						fameActionId = template.GoodJumpId;
					}
				}
				bool flag4 = fameActionId < 0;
				if (flag4)
				{
					return;
				}
			}
			this.RecordFameActionInternal(context, fameActionId, fameMultiplier);
		}

		// Token: 0x06006D22 RID: 27938 RVA: 0x003D2D64 File Offset: 0x003D0F64
		private bool IsBothGoodAndBad()
		{
			CharacterItem template = Character.Instance[this._templateId];
			bool flag = this._creatingType != 1;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				int absValue = 0;
				bool isTaiwu = this.IsTaiwu();
				using (List<short>.Enumerator enumerator = this._featureIds.GetEnumerator())
				{
					while (enumerator.MoveNext())
					{
						short featureId = enumerator.Current;
						OrganizationItem orgConfig = Organization.Instance.FirstOrDefault((OrganizationItem o) => o.MemberFeature == featureId);
						bool flag2 = orgConfig == null;
						if (!flag2)
						{
							CharacterFeatureItem featureConfig = CharacterFeature.Instance[featureId];
							bool flag3 = isTaiwu;
							if (flag3)
							{
								absValue += (int)Math.Abs(featureConfig.TaiwuFameBonu);
							}
							else
							{
								bool flag4 = orgConfig.TemplateId == this._organizationInfo.OrgTemplateId;
								if (flag4)
								{
									absValue += (int)Math.Abs(featureConfig.SectFameBonus[(int)this._organizationInfo.Grade]);
								}
								else
								{
									absValue += (int)Math.Abs(featureConfig.NotSectFameBonu);
								}
							}
						}
					}
				}
				int currDate = DomainManager.World.GetCurrDate();
				int i = 0;
				int recordsCount = this._fameActionRecords.Count;
				while (i < recordsCount)
				{
					FameActionRecord record = this._fameActionRecords[i];
					bool flag5 = record.EndDate < currDate;
					if (!flag5)
					{
						absValue += (int)Math.Abs(record.Value);
					}
					i++;
				}
				result = (absValue >= 50);
			}
			return result;
		}

		// Token: 0x06006D23 RID: 27939 RVA: 0x003D2F04 File Offset: 0x003D1104
		private void RecordFameActionInternal(DataContext context, short fameActionId, short fameMultiplier)
		{
			FameActionItem template = FameAction.Instance[fameActionId];
			int currDate = DomainManager.World.GetCurrDate();
			int index = -1;
			int i = 0;
			int recordsCount = this._fameActionRecords.Count;
			while (i < recordsCount)
			{
				FameActionRecord record = this._fameActionRecords[i];
				bool flag = record.EndDate <= currDate;
				if (flag)
				{
					CollectionUtils.SwapAndRemove<FameActionRecord>(this._fameActionRecords, i);
					i--;
					recordsCount--;
				}
				else
				{
					bool flag2 = record.Id == fameActionId;
					if (flag2)
					{
						index = i;
					}
				}
				i++;
			}
			bool flag3 = index >= 0;
			if (flag3)
			{
				FameActionRecord record2 = this._fameActionRecords[index];
				int value = (int)(record2.Value + (short)template.Fame * fameMultiplier);
				int limit = (int)((short)template.Fame * template.MaxStackCount);
				value = ((template.Fame > 0) ? ((value > limit) ? limit : value) : ((value < limit) ? limit : value));
				record2.Value = (short)value;
				bool flag4 = template.RepeatType == 0;
				if (flag4)
				{
					record2.EndDate = currDate + (int)template.Duration;
				}
				else
				{
					record2.EndDate += (int)template.Duration;
				}
				this._fameActionRecords[index] = record2;
			}
			else
			{
				short value2 = (short)template.Fame * Math.Min(fameMultiplier, template.MaxStackCount);
				FameActionRecord record3 = new FameActionRecord(fameActionId, value2, currDate + (int)template.Duration);
				this._fameActionRecords.Add(record3);
			}
			this.SetFameActionRecords(this._fameActionRecords, context);
		}

		// Token: 0x06006D24 RID: 27940 RVA: 0x003D3094 File Offset: 0x003D1294
		public bool AddFeature(DataContext context, short featureId, bool removeMutexFeature = false)
		{
			bool success = this.OfflineAddFeature(featureId, removeMutexFeature, false);
			bool flag = success;
			if (flag)
			{
				this.SetFeatureIds(this._featureIds, context);
				Events.RaiseCharacterFeatureAdded(context, this, featureId);
			}
			return success;
		}

		// Token: 0x06006D25 RID: 27941 RVA: 0x003D30D0 File Offset: 0x003D12D0
		public void RevertFeatures(DataContext context, List<ShortListModification> modifications)
		{
			for (int i = modifications.Count - 1; i >= 0; i--)
			{
				ShortListModification mod = modifications[i];
				bool flag = mod.ModificationType == 0;
				if (flag)
				{
					bool flag2 = (int)mod.Index < this._featureIds.Count && this._featureIds[(int)mod.Index] == mod.Element;
					if (flag2)
					{
						this._featureIds.RemoveAt((int)mod.Index);
					}
					else
					{
						this._featureIds.Remove(mod.Element);
					}
				}
				else
				{
					bool flag3 = (int)mod.Index <= this._featureIds.Count;
					if (flag3)
					{
						this._featureIds.Insert((int)mod.Index, mod.Element);
					}
					else
					{
						this._featureIds.Add(mod.Element);
					}
				}
			}
			this.CheckForMutexFeatures();
			this.SetFeatureIds(this._featureIds, context);
		}

		// Token: 0x06006D26 RID: 27942 RVA: 0x003D31D4 File Offset: 0x003D13D4
		public void RemoveFeature(DataContext context, short featureId)
		{
			bool succeed = this._featureIds.Remove(featureId);
			bool flag = !succeed;
			if (!flag)
			{
				this.SetFeatureIds(this._featureIds, context);
				Events.RaiseCharacterFeatureRemoved(context, this, featureId);
			}
		}

		// Token: 0x06006D27 RID: 27943 RVA: 0x003D3210 File Offset: 0x003D1410
		public void ClearGeneticFeatures(DataContext context)
		{
			for (int i = this._featureIds.Count - 1; i >= 0; i--)
			{
				short featureId = this._featureIds[i];
				CharacterFeatureItem featureCfg = CharacterFeature.Instance[featureId];
				bool flag = featureCfg.GeneticProb == 0;
				if (!flag)
				{
					this._featureIds.RemoveAt(i);
					DomainManager.SpecialEffect.RemoveFeatureEffect(context, this._id, featureId);
				}
			}
			this.SetFeatureIds(this._featureIds, context);
		}

		// Token: 0x06006D28 RID: 27944 RVA: 0x003D3298 File Offset: 0x003D1498
		public bool RemoveFeatureGroup(DataContext context, short featureGroupId)
		{
			CharacterFeature config = CharacterFeature.Instance;
			int i = 0;
			int count = this._featureIds.Count;
			while (i < count)
			{
				short currFeatureId = this._featureIds[i];
				CharacterFeatureItem currFeatureConfig = config[currFeatureId];
				bool flag = currFeatureConfig.MutexGroupId != featureGroupId;
				if (!flag)
				{
					this._featureIds.RemoveAt(i);
					this.SetFeatureIds(this._featureIds, context);
					return true;
				}
				i++;
			}
			return false;
		}

		// Token: 0x06006D29 RID: 27945 RVA: 0x003D3320 File Offset: 0x003D1520
		public short GetGroupFeature(short featureGroupId)
		{
			CharacterFeature config = CharacterFeature.Instance;
			int i = 0;
			int count = this._featureIds.Count;
			while (i < count)
			{
				short currFeatureId = this._featureIds[i];
				short currGroupId = config[currFeatureId].MutexGroupId;
				bool flag = currGroupId != featureGroupId;
				if (!flag)
				{
					return currFeatureId;
				}
				i++;
			}
			return -1;
		}

		// Token: 0x06006D2A RID: 27946 RVA: 0x003D338C File Offset: 0x003D158C
		public void CalcGroupFeatures(Dictionary<short, short> groupToFeatures)
		{
			groupToFeatures.Clear();
			int i = 0;
			int count = this._featureIds.Count;
			while (i < count)
			{
				short currFeatureId = this._featureIds[i];
				short currGroupId = CharacterFeature.Instance[currFeatureId].MutexGroupId;
				bool flag = currGroupId < 0;
				if (!flag)
				{
					groupToFeatures.Add(currGroupId, currFeatureId);
				}
				i++;
			}
		}

		// Token: 0x06006D2B RID: 27947 RVA: 0x003D33F4 File Offset: 0x003D15F4
		public bool ChangeFeatureByWugKing(IRandomSource random)
		{
			Dictionary<short, short> groupToFeatures = ObjectPool<Dictionary<short, short>>.Instance.Get();
			List<short> nonexistentLowestBadFeatures = ObjectPool<List<short>>.Instance.Get();
			List<short> notHighestBadFeatures = ObjectPool<List<short>>.Instance.Get();
			List<short> notLowestGoodFeatures = ObjectPool<List<short>>.Instance.Get();
			List<short> lowestGoodFeatures = ObjectPool<List<short>>.Instance.Get();
			this.CalcGroupFeatures(groupToFeatures);
			nonexistentLowestBadFeatures.Clear();
			notHighestBadFeatures.Clear();
			notLowestGoodFeatures.Clear();
			lowestGoodFeatures.Clear();
			foreach (CharacterFeatureItem featureConfig in ((IEnumerable<CharacterFeatureItem>)CharacterFeature.Instance))
			{
				bool flag = !featureConfig.IsNormal() || featureConfig.IsNeutral();
				if (!flag)
				{
					short templateId;
					bool flag2 = groupToFeatures.TryGetValue(featureConfig.MutexGroupId, out templateId);
					if (flag2)
					{
						bool flag3 = templateId != featureConfig.TemplateId;
						if (!flag3)
						{
							bool flag4 = featureConfig.IsGood();
							if (flag4)
							{
								(featureConfig.IsLowest() ? lowestGoodFeatures : notLowestGoodFeatures).Add(featureConfig.TemplateId);
							}
							else
							{
								bool flag5 = featureConfig.IsBad() && !featureConfig.IsHighest();
								if (flag5)
								{
									notHighestBadFeatures.Add(featureConfig.TemplateId);
								}
							}
						}
					}
					else
					{
						bool flag6 = featureConfig.IsBad() && featureConfig.IsLowest();
						if (flag6)
						{
							nonexistentLowestBadFeatures.Add(featureConfig.TemplateId);
						}
					}
				}
			}
			bool featureChanged = true;
			bool flag7 = nonexistentLowestBadFeatures.Count > 0;
			if (flag7)
			{
				this._featureIds.Add(nonexistentLowestBadFeatures.GetRandom(random));
			}
			else
			{
				bool flag8 = notHighestBadFeatures.Count > 0;
				if (flag8)
				{
					short featureId = notHighestBadFeatures.GetRandom(random);
					this._featureIds.Remove(featureId);
					this._featureIds.Add(CharacterFeature.Instance[featureId].Upgrade().TemplateId);
				}
				else
				{
					bool flag9 = notLowestGoodFeatures.Count > 0;
					if (flag9)
					{
						short featureId2 = notLowestGoodFeatures.GetRandom(random);
						this._featureIds.Remove(featureId2);
						this._featureIds.Add(CharacterFeature.Instance[featureId2].Degrade().TemplateId);
					}
					else
					{
						bool flag10 = lowestGoodFeatures.Count > 0;
						if (flag10)
						{
							this._featureIds.Remove(lowestGoodFeatures.GetRandom(random));
						}
						else
						{
							featureChanged = false;
						}
					}
				}
			}
			ObjectPool<Dictionary<short, short>>.Instance.Return(groupToFeatures);
			ObjectPool<List<short>>.Instance.Return(nonexistentLowestBadFeatures);
			ObjectPool<List<short>>.Instance.Return(notHighestBadFeatures);
			ObjectPool<List<short>>.Instance.Return(notLowestGoodFeatures);
			ObjectPool<List<short>>.Instance.Return(lowestGoodFeatures);
			bool flag11 = featureChanged;
			if (flag11)
			{
				this._featureIds.Sort(CharacterFeatureHelper.FeatureComparer);
			}
			return featureChanged;
		}

		// Token: 0x06006D2C RID: 27948 RVA: 0x003D36B8 File Offset: 0x003D18B8
		public int GetFeatureMedalValue(sbyte medalType)
		{
			return GameData.Domains.Character.SharedMethods.CalcFeatureMedalValue(this._featureIds, medalType);
		}

		// Token: 0x06006D2D RID: 27949 RVA: 0x003D36C8 File Offset: 0x003D18C8
		public bool IsCompletelyInfected()
		{
			return this._organizationInfo.OrgTemplateId == 20;
		}

		// Token: 0x06006D2E RID: 27950 RVA: 0x003D36EC File Offset: 0x003D18EC
		public bool HasVirginity()
		{
			return this._featureIds.Contains(195);
		}

		// Token: 0x06006D2F RID: 27951 RVA: 0x003D370E File Offset: 0x003D190E
		public void LoseVirginity(DataContext context)
		{
			this.AddFeature(context, 196, true);
		}

		// Token: 0x06006D30 RID: 27952 RVA: 0x003D3720 File Offset: 0x003D1920
		public void GetInscribableFeatureIds(List<short> featureIds)
		{
			int i = 0;
			int count = this._featureIds.Count;
			while (i < count)
			{
				short featureId = this._featureIds[i];
				CharacterFeatureItem featureCfg = CharacterFeature.Instance[featureId];
				bool inscribable = featureCfg.Inscribable;
				if (inscribable)
				{
					featureIds.Add(featureId);
				}
				i++;
			}
		}

		// Token: 0x06006D31 RID: 27953 RVA: 0x003D377C File Offset: 0x003D197C
		public List<short> GetChickenFeatures()
		{
			return (from f in this._featureIds
			where CharacterFeature.Instance[f].IsChickenFeature
			select f).ToList<short>();
		}

		// Token: 0x06006D32 RID: 27954 RVA: 0x003D37C0 File Offset: 0x003D19C0
		private bool OfflineAddFeature(short featureId, bool removeMutexFeature, bool removeLowerOnly = false)
		{
			CharacterFeatureItem featureConfig = CharacterFeature.Instance[featureId];
			bool flag = featureConfig.Gender != -1 && featureConfig.Gender != this._gender;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				short groupId = featureConfig.MutexGroupId;
				bool replaced = false;
				int i = 0;
				int featuresCount = this._featureIds.Count;
				while (i < featuresCount)
				{
					short currFeatureId = this._featureIds[i];
					CharacterFeatureItem currFeature = CharacterFeature.Instance[currFeatureId];
					bool flag2 = currFeature.MutexGroupId != groupId;
					if (flag2)
					{
						i++;
					}
					else
					{
						bool flag3 = !removeMutexFeature;
						if (flag3)
						{
							return false;
						}
						bool flag4 = removeLowerOnly && currFeature.Level >= featureConfig.Level;
						if (flag4)
						{
							return false;
						}
						this._featureIds[i] = featureId;
						replaced = true;
						break;
					}
				}
				bool flag5 = !replaced;
				if (flag5)
				{
					int index = this._featureIds.BinarySearch(featureId, CharacterFeatureHelper.FeatureComparer);
					bool flag6 = index < 0;
					if (flag6)
					{
						index = ~index;
					}
					bool flag7 = index >= this._featureIds.Count;
					if (flag7)
					{
						this._featureIds.Add(featureId);
					}
					else
					{
						this._featureIds.Insert(index, featureId);
					}
				}
				result = true;
			}
			return result;
		}

		// Token: 0x06006D33 RID: 27955 RVA: 0x003D3920 File Offset: 0x003D1B20
		private void CheckForMutexFeatures()
		{
			CharacterFeature featureConfig = CharacterFeature.Instance;
			int featuresCount = this._featureIds.Count;
			HashSet<short> groupIds = new HashSet<short>(featuresCount);
			for (int i = 0; i < featuresCount; i++)
			{
				short featureId = this._featureIds[i];
				short groupId = featureConfig[featureId].MutexGroupId;
				bool flag = !groupIds.Add(groupId);
				if (flag)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(37, 2);
					defaultInterpolatedStringHandler.AppendLiteral("Character ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(this._id);
					defaultInterpolatedStringHandler.AppendLiteral(": contains mutex features: ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(groupId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
		}

		// Token: 0x06006D34 RID: 27956 RVA: 0x003D39D8 File Offset: 0x003D1BD8
		public bool IsLoseConsummateBonusByFeature()
		{
			return this._featureIds.Any((short f) => CharacterFeature.Instance[f].LoseConsummateBonus);
		}

		// Token: 0x06006D35 RID: 27957 RVA: 0x003D3A14 File Offset: 0x003D1C14
		public bool NeedHealAction(EHealActionType type)
		{
			if (!true)
			{
			}
			bool result;
			switch (type)
			{
			case EHealActionType.Healing:
				result = this._injuries.HasAnyInjury();
				break;
			case EHealActionType.Detox:
				result = this._poisoned.IsNonZero();
				break;
			case EHealActionType.Breathing:
				result = (this._disorderOfQi > 0);
				break;
			case EHealActionType.Recover:
				result = (this._health < this.GetLeftMaxHealth(false));
				break;
			default:
				throw new ArgumentOutOfRangeException("type", type, null);
			}
			if (!true)
			{
			}
			return result;
		}

		// Token: 0x06006D36 RID: 27958 RVA: 0x003D3A90 File Offset: 0x003D1C90
		public int CalcHealCostHerb(EHealActionType type, bool isExpensiveHeal = false)
		{
			if (!true)
			{
			}
			int num;
			switch (type)
			{
			case EHealActionType.Healing:
				num = CombatDomain.GetHealInjuryCostHerb(this._injuries);
				break;
			case EHealActionType.Detox:
				num = CombatDomain.GetHealPoisonCostHerb(this._poisoned);
				break;
			case EHealActionType.Breathing:
				num = CombatDomain.GetHealQiDisorderCostHerb(this._disorderOfQi);
				break;
			case EHealActionType.Recover:
				num = CombatDomain.GetHealHealthCostHerb(this.GetHealthType());
				break;
			default:
				throw new ArgumentOutOfRangeException("type", type, null);
			}
			if (!true)
			{
			}
			int baseCost = num;
			return isExpensiveHeal ? (2 * baseCost) : baseCost;
		}

		// Token: 0x06006D37 RID: 27959 RVA: 0x003D3B18 File Offset: 0x003D1D18
		public int CalcHealCostMoney(EHealActionType type, sbyte doctorBehaviorType, bool isExpensiveHeal = false)
		{
			if (!true)
			{
			}
			int num;
			switch (type)
			{
			case EHealActionType.Healing:
				num = CombatDomain.GetHealInjuryCostMoney(this._injuries, doctorBehaviorType);
				break;
			case EHealActionType.Detox:
				num = CombatDomain.GetHealPoisonCostMoney(this._poisoned, doctorBehaviorType);
				break;
			case EHealActionType.Breathing:
				num = CombatDomain.GetHealQiDisorderCostMoney(this._disorderOfQi, doctorBehaviorType);
				break;
			case EHealActionType.Recover:
				num = CombatDomain.GetHealHealthCostMoney(this.GetHealthType(), doctorBehaviorType);
				break;
			default:
				throw new ArgumentOutOfRangeException("type", type, null);
			}
			if (!true)
			{
			}
			int baseCost = num;
			return isExpensiveHeal ? (2 * baseCost) : baseCost;
		}

		// Token: 0x06006D38 RID: 27960 RVA: 0x003D3BA4 File Offset: 0x003D1DA4
		public int CalcHealCostSpiritualDebt(EHealActionType type)
		{
			if (!true)
			{
			}
			int result;
			switch (type)
			{
			case EHealActionType.Healing:
				result = CombatDomain.GetHealInjuryCostSpiritualDebt(this._injuries);
				break;
			case EHealActionType.Detox:
				result = CombatDomain.GetHealPoisonCostSpiritualDebt(this._poisoned);
				break;
			case EHealActionType.Breathing:
				result = CombatDomain.GetHealQiDisorderCostSpiritualDebt(this._disorderOfQi);
				break;
			case EHealActionType.Recover:
				result = CombatDomain.GetHealHealthCostSpiritualDebt(this.GetHealthType());
				break;
			default:
				throw new ArgumentOutOfRangeException("type", type, null);
			}
			if (!true)
			{
			}
			return result;
		}

		// Token: 0x06006D39 RID: 27961 RVA: 0x003D3C1C File Offset: 0x003D1E1C
		public unsafe int CalcHealAttainment(EHealActionType type)
		{
			LifeSkillShorts attainments = *this.GetLifeSkillAttainments();
			if (!true)
			{
			}
			short result;
			switch (type)
			{
			case EHealActionType.Healing:
				result = *attainments[8];
				break;
			case EHealActionType.Detox:
				result = *attainments[9];
				break;
			case EHealActionType.Breathing:
				result = Math.Max(*attainments[8], *attainments[9]);
				break;
			case EHealActionType.Recover:
				result = Math.Max(*attainments[8], *attainments[9]);
				break;
			default:
				throw new ArgumentOutOfRangeException("type", type, null);
			}
			if (!true)
			{
			}
			return (int)result;
		}

		// Token: 0x06006D3A RID: 27962 RVA: 0x003D3CBC File Offset: 0x003D1EBC
		public int CalcHealEffect(EHealActionType type, Character patient, out int maxRequireAttainment, bool isExpensiveHeal = false)
		{
			maxRequireAttainment = 0;
			int patientId = patient.GetId();
			int result3;
			switch (type)
			{
			case EHealActionType.Healing:
			{
				int allHealMarkCount;
				int num;
				DomainManager.Combat.HealInjury(patientId, this, out allHealMarkCount, out num, out maxRequireAttainment, true, true, false, null, null, isExpensiveHeal);
				result3 = allHealMarkCount;
				break;
			}
			case EHealActionType.Detox:
			{
				int num;
				int healPoisonValue;
				DomainManager.Combat.HealPoison(patientId, this, out num, out healPoisonValue, out maxRequireAttainment, true, true, false, isExpensiveHeal);
				result3 = healPoisonValue;
				break;
			}
			case EHealActionType.Breathing:
			{
				short disorderOfQi = patient.GetDisorderOfQi();
				short result = DomainManager.Combat.HealQiDisorder(patientId, this, isExpensiveHeal);
				result3 = (int)(disorderOfQi - result);
				break;
			}
			case EHealActionType.Recover:
			{
				short health = patient.GetHealth();
				short result2 = DomainManager.Combat.HealHealth(patientId, this, isExpensiveHeal);
				result3 = (int)(result2 - health);
				break;
			}
			default:
				throw new ArgumentOutOfRangeException("type", type, null);
			}
			return result3;
		}

		// Token: 0x06006D3B RID: 27963 RVA: 0x003D3D88 File Offset: 0x003D1F88
		public unsafe bool DoHealAction(DataContext context, EHealActionType type, Character patient, bool canGetProfessionSeniority = false, bool isExpensiveHeal = false)
		{
			int patientId = patient.GetId();
			bool result5;
			switch (type)
			{
			case EHealActionType.Healing:
			{
				Injuries injuries = patient.GetInjuries();
				Injuries result = DomainManager.Combat.HealInjury(patientId, this, isExpensiveHeal);
				patient.SetInjuries(result, context);
				Injuries marks = injuries.Subtract(result);
				if (canGetProfessionSeniority)
				{
					ProfessionFormulaItem formula = ProfessionFormula.Instance[85];
					int total = 0;
					for (sbyte i = 0; i < 7; i += 1)
					{
						sbyte count = marks.Get(i, true);
						bool flag = count > 0;
						if (flag)
						{
							total += formula.Calculate((int)(count - 1));
						}
						count = marks.Get(i, false);
						bool flag2 = count > 0;
						if (flag2)
						{
							total += formula.Calculate((int)(count - 1));
						}
						bool flag3 = total > 0;
						if (flag3)
						{
							DomainManager.Extra.ChangeProfessionSeniority(context, 13, total, true, false);
						}
					}
				}
				result5 = (marks.GetSum() != 0);
				break;
			}
			case EHealActionType.Detox:
			{
				PoisonInts poisons = *patient.GetPoisoned();
				PoisonInts result2 = DomainManager.Combat.HealPoison(patientId, this, isExpensiveHeal);
				patient.SetPoisoned(ref result2, context);
				if (canGetProfessionSeniority)
				{
					ProfessionFormulaItem formula2 = ProfessionFormula.Instance[86];
					for (sbyte poisonType = 0; poisonType < 6; poisonType += 1)
					{
						int poisonDelta = *poisons[(int)poisonType] - *result2[(int)poisonType];
						sbyte poisonLevel = PoisonsAndLevels.CalcPoisonedLevel(poisonDelta);
						bool flag4 = poisonLevel > 0;
						if (flag4)
						{
							DomainManager.Extra.ChangeProfessionSeniority(context, 13, formula2.Calculate((int)(poisonLevel - 1)), true, false);
						}
					}
				}
				result5 = poisons.Subtract(ref result2).IsNonZero();
				break;
			}
			case EHealActionType.Breathing:
			{
				short disorderOfQi = patient.GetDisorderOfQi();
				short result3 = DomainManager.Combat.HealQiDisorder(patientId, this, isExpensiveHeal);
				patient.SetDisorderOfQi(result3, context);
				int delta = (int)(disorderOfQi - result3);
				if (canGetProfessionSeniority)
				{
					ProfessionFormulaItem formula3 = ProfessionFormula.Instance[87];
					int addSeniority = formula3.Calculate(delta);
					DomainManager.Extra.ChangeProfessionSeniority(context, 13, addSeniority, true, false);
				}
				result5 = (delta > 0);
				break;
			}
			case EHealActionType.Recover:
			{
				short health = patient.GetHealth();
				short result4 = DomainManager.Combat.HealHealth(patientId, this, isExpensiveHeal);
				patient.SetHealth(result4, context);
				int delta2 = (int)(result4 - health);
				if (canGetProfessionSeniority)
				{
					ProfessionFormulaItem formula4 = ProfessionFormula.Instance[88];
					int addSeniority2 = formula4.Calculate(delta2);
					DomainManager.Extra.ChangeProfessionSeniority(context, 13, addSeniority2, true, false);
				}
				result5 = (delta2 > 0);
				break;
			}
			default:
				throw new ArgumentOutOfRangeException("type", type, null);
			}
			return result5;
		}

		// Token: 0x06006D3C RID: 27964 RVA: 0x003D4038 File Offset: 0x003D2238
		public short GetClothingDisplayId()
		{
			bool flag = DomainManager.Extra.IsLegendaryBookConsumed(this._id);
			short result;
			if (flag)
			{
				result = 10003;
			}
			else
			{
				ItemKey clothingKey = this._equipment[4];
				bool flag2 = clothingKey.IsValid() && !DomainManager.Item.GetBaseItem(clothingKey).IsDurabilityRunningOut();
				if (flag2)
				{
					result = DomainManager.Extra.GetActualClothingDisplayId(clothingKey);
				}
				else
				{
					result = ((DomainManager.Character.GetSkeletonSourceGraveId(this._id) >= 0) ? 20003 : 0);
				}
			}
			return result;
		}

		// Token: 0x06006D3D RID: 27965 RVA: 0x003D40C0 File Offset: 0x003D22C0
		private short GetClothingDisplayIdForCharm()
		{
			bool flag = DomainManager.Extra.IsLegendaryBookConsumed(this._id);
			short result;
			if (flag)
			{
				result = 10003;
			}
			else
			{
				ItemKey clothingKey = this._equipment[4];
				bool flag2 = clothingKey.IsValid() && !DomainManager.Item.GetBaseItem(clothingKey).IsDurabilityRunningOut();
				if (flag2)
				{
					result = Config.Clothing.Instance[clothingKey.TemplateId].DisplayId;
				}
				else
				{
					result = ((DomainManager.Character.GetSkeletonSourceGraveId(this._id) >= 0) ? 20003 : 0);
				}
			}
			return result;
		}

		// Token: 0x06006D3E RID: 27966 RVA: 0x003D4154 File Offset: 0x003D2354
		public void ChangeEquipment(DataContext context, sbyte srcSlot, sbyte destSlot, ItemKey srcItemKey)
		{
			bool flag = srcSlot >= 0;
			if (flag)
			{
				srcItemKey = this._equipment[(int)srcSlot];
				this._equipment[(int)srcSlot] = ItemKey.Invalid;
			}
			else
			{
				this._inventory.OfflineRemove(srcItemKey, 1);
			}
			EquipmentBase srcItem = DomainManager.Item.GetBaseEquipment(srcItemKey);
			srcItem.ResetOwner();
			bool flag2 = destSlot >= 0;
			ItemKey destItemKey;
			if (flag2)
			{
				destItemKey = this._equipment[(int)destSlot];
				this._equipment[(int)destSlot] = srcItemKey;
				srcItem.SetEquippedCharId(this._id, context);
				srcItem.SetOwner(ItemOwnerType.CharacterEquipment, this._id);
			}
			else
			{
				destItemKey = ItemKey.Invalid;
				this._inventory.OfflineAdd(srcItemKey, 1);
				srcItem.SetEquippedCharId(-1, context);
				srcItem.SetOwner(ItemOwnerType.CharacterInventory, this._id);
			}
			bool flag3 = destItemKey.IsValid();
			if (flag3)
			{
				EquipmentBase destItem = DomainManager.Item.GetBaseEquipment(destItemKey);
				bool flag4 = srcSlot >= 0;
				if (flag4)
				{
					this._equipment[(int)srcSlot] = destItemKey;
					destItem.SetOwner(ItemOwnerType.CharacterEquipment, this._id);
				}
				else
				{
					this._inventory.OfflineAdd(destItemKey, 1);
					destItem.SetEquippedCharId(-1, context);
					destItem.SetOwner(ItemOwnerType.CharacterInventory, this._id);
				}
			}
			this.SetEquipment(this._equipment, context);
			this.SetInventory(this._inventory, context);
			bool flag5 = this._id == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag5)
			{
				DomainManager.Taiwu.UpdateTaiwuWeaponInnerRatios(context, srcSlot, destSlot, srcItemKey);
			}
		}

		// Token: 0x06006D3F RID: 27967 RVA: 0x003D42E0 File Offset: 0x003D24E0
		public void ChangeEquipment(DataContext context, ItemKey[] equipment)
		{
			for (int i = 0; i < 12; i++)
			{
				ItemKey oriItemKey = this._equipment[i];
				bool flag = oriItemKey.IsValid();
				if (flag)
				{
					EquipmentBase oriItem = DomainManager.Item.GetBaseEquipment(oriItemKey);
					oriItem.RemoveOwner(ItemOwnerType.CharacterEquipment, this._id);
					oriItem.SetOwner(ItemOwnerType.CharacterInventory, this._id);
					oriItem.SetEquippedCharId(-1, context);
					this._inventory.OfflineAdd(oriItemKey, 1);
				}
			}
			for (int j = 0; j < 12; j++)
			{
				ItemKey currItemKey = equipment[j];
				bool flag2 = currItemKey.IsValid();
				if (flag2)
				{
					EquipmentBase currItem = DomainManager.Item.GetBaseEquipment(currItemKey);
					currItem.RemoveOwner(ItemOwnerType.CharacterInventory, this._id);
					currItem.SetOwner(ItemOwnerType.CharacterEquipment, this._id);
					currItem.SetEquippedCharId(this._id, context);
					this._inventory.OfflineRemove(currItemKey, 1);
				}
			}
			for (int k = 0; k < 12; k++)
			{
				this._equipment[k] = equipment[k];
			}
			this.SetEquipment(this._equipment, context);
			this.SetInventory(this._inventory, context);
		}

		// Token: 0x06006D40 RID: 27968 RVA: 0x003D4420 File Offset: 0x003D2620
		public int GetEquipmentCombatPowerValue()
		{
			return this._equipment.Zip(GlobalConfig.EquipmentSlotCombatPower, (ItemKey key, int value) => ItemTemplateHelper.GetBaseCombatPowerValue(key.ItemType, key.TemplateId) * value / 100).Sum();
		}

		// Token: 0x06006D41 RID: 27969 RVA: 0x003D4458 File Offset: 0x003D2658
		public void ForceReplaceClothing(DataContext context, short newClothingTemplateId)
		{
			ItemKey oldClothingKey = this._equipment[4];
			bool flag = oldClothingKey.IsValid();
			if (flag)
			{
				DomainManager.Item.RemoveItem(context, oldClothingKey);
			}
			bool flag2 = newClothingTemplateId >= 0;
			if (flag2)
			{
				this._equipment[4] = DomainManager.Item.CreateClothing(context, newClothingTemplateId, this._gender);
				EquipmentBase baseEquipment = DomainManager.Item.GetBaseEquipment(this._equipment[4]);
				baseEquipment.SetEquippedCharId(this._id, context);
				baseEquipment.SetOwner(ItemOwnerType.CharacterEquipment, this._id);
			}
			else
			{
				this._equipment[4] = ItemKey.Invalid;
			}
			this.SetEquipment(this._equipment, context);
		}

		// Token: 0x06006D42 RID: 27970 RVA: 0x003D450C File Offset: 0x003D270C
		public void CreateInventoryItem(DataContext context, sbyte itemType, short templateId, int amount)
		{
			this.OfflineCreateInventoryItem(context, itemType, templateId, amount);
			this.SetInventory(this._inventory, context);
			bool flag = itemType == 12 && Config.Misc.Instance[templateId].ItemSubType == 1202;
			if (flag)
			{
				int bookCombatSkillType = (int)(templateId - 211);
				DomainManager.LegendaryBook.RegisterOwner(context, this, (sbyte)bookCombatSkillType);
			}
		}

		// Token: 0x06006D43 RID: 27971 RVA: 0x003D4570 File Offset: 0x003D2770
		public void AddInventoryItem(DataContext context, ItemKey itemKey, int amount, bool offLine = false)
		{
			this._inventory.OfflineAdd(itemKey, amount);
			bool flag = !offLine;
			if (flag)
			{
				this.SetInventory(this._inventory, context);
			}
			bool flag2 = itemKey.ItemType == 12 && Config.Misc.Instance[itemKey.TemplateId].ItemSubType == 1202;
			if (flag2)
			{
				int bookCombatSkillType = (int)(itemKey.TemplateId - 211);
				DomainManager.LegendaryBook.RegisterOwner(context, this, (sbyte)bookCombatSkillType);
				ItemBase item = DomainManager.Item.GetBaseItem(itemKey);
				bool flag3 = item.Owner.OwnerType == ItemOwnerType.System;
				if (flag3)
				{
					item.RemoveOwner(ItemOwnerType.System, 11);
				}
			}
			DomainManager.Item.SetOwner(itemKey, ItemOwnerType.CharacterInventory, this._id);
			bool flag4 = this._id == DomainManager.Taiwu.GetTaiwuCharId() && ItemType.IsEquipmentItemType(itemKey.ItemType);
			if (flag4)
			{
				EquipmentBase baseEquipment = DomainManager.Item.GetBaseEquipment(itemKey);
				baseEquipment.SetModificationState(baseEquipment.GetModificationState(), context);
				bool flag5 = itemKey.ItemType == 3;
				if (flag5)
				{
					DomainManager.Extra.RecordOwnedClothing(context, itemKey.TemplateId);
				}
			}
		}

		// Token: 0x06006D44 RID: 27972 RVA: 0x003D4694 File Offset: 0x003D2894
		public void AddInventoryItemList(DataContext context, List<ItemKey> keyList)
		{
			Tester.Assert(keyList != null, "");
			Tester.Assert(keyList.Count > 0, "");
			foreach (ItemKey key in keyList)
			{
				this.AddInventoryItem(context, key, 1, true);
			}
			this.SetInventory(this._inventory, context);
		}

		// Token: 0x06006D45 RID: 27973 RVA: 0x003D471C File Offset: 0x003D291C
		public void RemoveMultiInventoryItem(DataContext context, sbyte itemType, short templateId, int count)
		{
			bool flag = count <= 0;
			if (!flag)
			{
				List<ItemKey> removedItem = ObjectPool<List<ItemKey>>.Instance.Get();
				while (count > 0)
				{
					ItemKey itemKey = this._inventory.GetInventoryItemKey(itemType, templateId);
					int removeCount = Math.Min(count, this._inventory.Items[itemKey]);
					count -= removeCount;
					this._inventory.OfflineRemove(itemKey, removeCount);
					bool flag2 = !this._inventory.Items.ContainsKey(itemKey);
					if (flag2)
					{
						removedItem.Add(itemKey);
					}
					Events.RaiseItemRemovedFromInventory(context, this, itemKey, removeCount);
				}
				this.SetInventory(this._inventory, context);
				foreach (ItemKey itemKey2 in removedItem)
				{
					bool flag3 = this._id == DomainManager.Taiwu.GetTaiwuCharId();
					if (flag3)
					{
						DomainManager.Character.ClearItemUsingState(context, itemKey2, this._id, ItemDisplayData.ItemUsingType.Invalid);
					}
					DomainManager.Item.RemoveItem(context, itemKey2);
				}
				ObjectPool<List<ItemKey>>.Instance.Return(removedItem);
			}
		}

		// Token: 0x06006D46 RID: 27974 RVA: 0x003D4854 File Offset: 0x003D2A54
		public void RemoveInventoryItem(DataContext context, ItemKey itemKey, int amount, bool deleteItem, bool offLine = false)
		{
			bool flag = amount <= 0;
			if (!flag)
			{
				bool flag2 = this._id == DomainManager.Taiwu.GetTaiwuCharId();
				if (flag2)
				{
					DomainManager.Character.ClearItemUsingState(context, itemKey, this._id, ItemDisplayData.ItemUsingType.Invalid);
				}
				this._inventory.OfflineRemove(itemKey, amount);
				Events.RaiseItemRemovedFromInventory(context, this, itemKey, amount);
				bool flag3 = !offLine;
				if (flag3)
				{
					this.SetInventory(this._inventory, context);
				}
				if (deleteItem)
				{
					DomainManager.Item.RemoveItem(context, itemKey);
				}
			}
		}

		// Token: 0x06006D47 RID: 27975 RVA: 0x003D48DC File Offset: 0x003D2ADC
		public void RemoveInventoryItemList(DataContext context, List<ItemKey> keyList, bool deleteItem)
		{
			Tester.Assert(keyList != null, "");
			Tester.Assert(keyList.Count > 0, "");
			foreach (ItemKey key in keyList)
			{
				this.RemoveInventoryItem(context, key, 1, deleteItem, true);
			}
			this.SetInventory(this._inventory, context);
		}

		// Token: 0x06006D48 RID: 27976 RVA: 0x003D4964 File Offset: 0x003D2B64
		public bool TryDetectAttachedPoisons(ItemKey itemKey)
		{
			bool flag = !ModificationStateHelper.IsActive(itemKey.ModificationState, 1);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				PoisonsAndLevels attachedPoisons = DomainManager.Item.GetAttachedPoisons(itemKey);
				short toxicologyAttainment = this.GetLifeSkillAttainment(9);
				for (sbyte poisonType = 0; poisonType < 6; poisonType += 1)
				{
					sbyte grade = attachedPoisons.GetGrade(poisonType);
					bool flag2 = grade < 0;
					if (!flag2)
					{
						short attainment = GlobalConfig.Instance.PoisonAttainments[(int)grade];
						bool flag3 = toxicologyAttainment >= attainment;
						if (flag3)
						{
							return true;
						}
					}
				}
				result = false;
			}
			return result;
		}

		// Token: 0x06006D49 RID: 27977 RVA: 0x003D49F8 File Offset: 0x003D2BF8
		[return: TupleElementNames(new string[]
		{
			null,
			"KeyChanged"
		})]
		public ValueTuple<ItemKey, bool> AttachPoisonsToInventoryItem(DataContext context, ItemKey targetItemKey, ItemKey[] poisonsToAdd)
		{
			bool keyChanged = false;
			ItemBase targetBaseItem = DomainManager.Item.GetBaseItem(targetItemKey);
			foreach (ItemKey poisonKey in poisonsToAdd)
			{
				bool flag = !poisonKey.IsValid() || !this._inventory.Items.ContainsKey(poisonKey);
				if (!flag)
				{
					ValueTuple<ItemBase, bool> valueTuple = DomainManager.Item.SetAttachedPoisons(context, targetBaseItem, poisonKey.TemplateId, true, null);
					ItemBase item = valueTuple.Item1;
					bool currKeyChanged = valueTuple.Item2;
					this.RemoveInventoryItem(context, poisonKey, 1, true, false);
					bool flag2 = currKeyChanged;
					if (flag2)
					{
						keyChanged = true;
						targetBaseItem = item;
					}
				}
			}
			bool flag3 = keyChanged;
			if (flag3)
			{
				ItemKey newKey = targetBaseItem.GetItemKey();
				this._inventory.OfflineRemove(targetItemKey, 1);
				this._inventory.OfflineAdd(newKey, 1);
				DomainManager.Item.SetOwner(newKey, ItemOwnerType.CharacterInventory, this._id);
				this.SetInventory(this._inventory, context);
				bool flag4 = newKey.Id != targetItemKey.Id;
				if (flag4)
				{
					DomainManager.Item.RemoveItem(context, targetItemKey);
				}
			}
			return new ValueTuple<ItemKey, bool>(targetBaseItem.GetItemKey(), keyChanged);
		}

		// Token: 0x06006D4A RID: 27978 RVA: 0x003D4B20 File Offset: 0x003D2D20
		private ItemKey SelectInventoryPoisonToAdd(sbyte requiredType)
		{
			short toxicologyAttainment = this.GetLifeSkillAttainment(9);
			int minDeviation = 16129;
			ItemKey selectedPoison = ItemKey.Invalid;
			foreach (ItemKey itemKey in this._inventory.Items.Keys)
			{
				bool flag = itemKey.ItemType != 8;
				if (!flag)
				{
					MedicineItem medicineCfg = Config.Medicine.Instance[itemKey.TemplateId];
					bool flag2 = medicineCfg.EffectType != EMedicineEffectType.ApplyPoison;
					if (!flag2)
					{
						sbyte poisonType = medicineCfg.PoisonType;
						short attainmentRequired = GlobalConfig.Instance.PoisonAttainments[(int)medicineCfg.Grade];
						bool flag3 = poisonType != requiredType || toxicologyAttainment < attainmentRequired;
						if (!flag3)
						{
							int diff = (int)(medicineCfg.Grade - this._organizationInfo.Grade);
							int currDeviation = diff * diff;
							bool flag4 = currDeviation > minDeviation;
							if (!flag4)
							{
								minDeviation = currDeviation;
								selectedPoison = itemKey;
							}
						}
					}
				}
			}
			return selectedPoison;
		}

		// Token: 0x06006D4B RID: 27979 RVA: 0x003D4C40 File Offset: 0x003D2E40
		private unsafe ItemKey[] SelectInventoryPoisonsToAdd(IRandomSource random, ItemKey itemToAttachPoisonOn)
		{
			bool flag = this._id == DomainManager.Taiwu.GetTaiwuCharId();
			ItemKey[] result;
			if (flag)
			{
				result = null;
			}
			else
			{
				Span<ItemKey> span = new Span<ItemKey>(stackalloc byte[checked(unchecked((UIntPtr)6) * (UIntPtr)sizeof(ItemKey))], 6);
				SpanList<ItemKey> selectedPoisons = span;
				short toxicologyAttainment = this.GetLifeSkillAttainment(9);
				this._inventory.SelectPoisonsToAdd(random, toxicologyAttainment, this._organizationInfo.Grade, itemToAttachPoisonOn, ref selectedPoisons);
				result = selectedPoisons.ToArray();
			}
			return result;
		}

		// Token: 0x06006D4C RID: 27980 RVA: 0x003D4CB4 File Offset: 0x003D2EB4
		public void FindItems(Predicate<ItemBase> predicate, [TupleElementNames(new string[]
		{
			"itemKey",
			"amount"
		})] List<ValueTuple<ItemKey, int>> items, bool searchInventory, bool searchEquipment)
		{
			if (searchInventory)
			{
				foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
				{
					ItemKey itemKey3;
					int num;
					keyValuePair.Deconstruct(out itemKey3, out num);
					ItemKey itemKey = itemKey3;
					int amount = num;
					ItemBase item = DomainManager.Item.GetBaseItem(itemKey);
					bool flag = predicate(item);
					if (flag)
					{
						items.Add(new ValueTuple<ItemKey, int>(itemKey, amount));
					}
				}
			}
			if (searchEquipment)
			{
				for (int i = 0; i < 12; i++)
				{
					ItemKey itemKey2 = this._equipment[i];
					bool flag2 = !itemKey2.IsValid();
					if (!flag2)
					{
						ItemBase item2 = DomainManager.Item.GetBaseItem(itemKey2);
						bool flag3 = predicate(item2);
						if (flag3)
						{
							items.Add(new ValueTuple<ItemKey, int>(itemKey2, 1));
						}
					}
				}
			}
		}

		// Token: 0x06006D4D RID: 27981 RVA: 0x003D4DBC File Offset: 0x003D2FBC
		public void FindItems(List<Predicate<ItemBase>> predicates, [TupleElementNames(new string[]
		{
			"itemKey",
			"amount"
		})] List<ValueTuple<ItemKey, int>> items, bool searchInventory, bool searchEquipment)
		{
			if (searchInventory)
			{
				foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
				{
					ItemKey itemKey3;
					int num;
					keyValuePair.Deconstruct(out itemKey3, out num);
					ItemKey itemKey = itemKey3;
					int amount = num;
					ItemBase item = DomainManager.Item.GetBaseItem(itemKey);
					bool flag = ItemMatchers.MatchAll(item, predicates);
					if (flag)
					{
						items.Add(new ValueTuple<ItemKey, int>(itemKey, amount));
					}
				}
			}
			if (searchEquipment)
			{
				for (int i = 0; i < 12; i++)
				{
					ItemKey itemKey2 = this._equipment[i];
					bool flag2 = !itemKey2.IsValid();
					if (!flag2)
					{
						ItemBase item2 = DomainManager.Item.GetBaseItem(itemKey2);
						bool flag3 = ItemMatchers.MatchAll(item2, predicates);
						if (flag3)
						{
							items.Add(new ValueTuple<ItemKey, int>(itemKey2, 1));
						}
					}
				}
			}
		}

		// Token: 0x06006D4E RID: 27982 RVA: 0x003D4EC4 File Offset: 0x003D30C4
		public bool HasReadableBook()
		{
			foreach (KeyValuePair<ItemKey, int> keyValuePair in this.GetInventory().Items)
			{
				ItemKey itemKey2;
				int num;
				keyValuePair.Deconstruct(out itemKey2, out num);
				ItemKey itemKey = itemKey2;
				bool flag = itemKey.ItemType != 10;
				if (!flag)
				{
					bool flag2 = this.BookIsReadable(itemKey);
					if (flag2)
					{
						return true;
					}
				}
			}
			return false;
		}

		// Token: 0x06006D4F RID: 27983 RVA: 0x003D4F58 File Offset: 0x003D3158
		public void GetReadableBookList(List<ItemKey> list)
		{
			list.Clear();
			foreach (KeyValuePair<ItemKey, int> keyValuePair in this.GetInventory().Items)
			{
				ItemKey itemKey2;
				int num;
				keyValuePair.Deconstruct(out itemKey2, out num);
				ItemKey itemKey = itemKey2;
				bool flag = itemKey.ItemType != 10;
				if (!flag)
				{
					bool flag2 = this.BookIsReadable(itemKey);
					if (flag2)
					{
						list.Add(itemKey);
					}
				}
			}
		}

		// Token: 0x06006D50 RID: 27984 RVA: 0x003D4FF0 File Offset: 0x003D31F0
		public bool BookIsReadable(ItemKey itemKey)
		{
			GameData.Domains.Item.SkillBook book;
			bool flag = !DomainManager.Item.TryGetElement_SkillBooks(itemKey.Id, out book);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = this.TryDetectAttachedPoisons(itemKey);
				if (flag2)
				{
					result = false;
				}
				else
				{
					bool flag3 = book.IsCombatSkillBook();
					byte readingPage;
					if (flag3)
					{
						readingPage = this.GetCombatSkillBookCurrReadingInfo(book).Item2;
						bool flag4 = readingPage == 6;
						if (flag4)
						{
							return false;
						}
					}
					else
					{
						readingPage = this.GetLifeSkillBookCurrReadingInfo(book).Item2;
						bool flag5 = readingPage == 5;
						if (flag5)
						{
							return false;
						}
					}
					bool flag6 = SkillBookStateHelper.GetPageIncompleteState(book.GetPageIncompleteState(), readingPage) == 2;
					result = !flag6;
				}
			}
			return result;
		}

		// Token: 0x06006D51 RID: 27985 RVA: 0x003D5094 File Offset: 0x003D3294
		public bool IsBookRead(ItemKey itemKey)
		{
			GameData.Domains.Item.SkillBook book;
			bool flag = !DomainManager.Item.TryGetElement_SkillBooks(itemKey.Id, out book);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = book.IsCombatSkillBook();
				if (flag2)
				{
					byte readingPage = this.GetCombatSkillBookCurrReadingInfo(book).Item2;
					bool flag3 = readingPage == 6;
					if (flag3)
					{
						return true;
					}
				}
				else
				{
					byte readingPage = this.GetLifeSkillBookCurrReadingInfo(book).Item2;
					bool flag4 = readingPage == 5;
					if (flag4)
					{
						return true;
					}
				}
				result = false;
			}
			return result;
		}

		// Token: 0x06006D52 RID: 27986 RVA: 0x003D510C File Offset: 0x003D330C
		public void VillagerReturnNotReadableBooks(DataContext context)
		{
			short settlementId = DomainManager.Taiwu.GetTaiwuVillageSettlementId();
			bool flag = this._organizationInfo.SettlementId != settlementId;
			if (!flag)
			{
				IReadOnlyDictionary<ItemKey, int> taiwuGiftItems = DomainManager.Taiwu.IsInGroup(this._id) ? DomainManager.Extra.GetTaiwuGiftItems(this._id) : Inventory.Empty;
				List<ItemKey> bookList = ObjectPool<List<ItemKey>>.Instance.Get();
				foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
				{
					ItemKey itemKey3;
					int num;
					keyValuePair.Deconstruct(out itemKey3, out num);
					ItemKey itemKey = itemKey3;
					bool flag2 = itemKey.ItemType != 10;
					if (!flag2)
					{
						bool flag3 = taiwuGiftItems.ContainsKey(itemKey);
						if (!flag3)
						{
							bool flag4 = !this.BookIsReadable(itemKey);
							if (flag4)
							{
								bookList.Add(itemKey);
							}
						}
					}
				}
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				int currDate = DomainManager.World.GetCurrDate();
				using (List<ItemKey>.Enumerator enumerator2 = bookList.GetEnumerator())
				{
					if (enumerator2.MoveNext())
					{
						ItemKey itemKey2 = enumerator2.Current;
						this.RemoveInventoryItem(context, itemKey2, 1, false, false);
						bool flag5 = this.IsBookRead(itemKey2);
						if (flag5)
						{
							DomainManager.Taiwu.VillagerStoreItemInTreasury(context, this, itemKey2, 1, false);
							lifeRecordCollection.AddTaiwuVillagerFinishedReading(this._id, currDate, itemKey2.ItemType, itemKey2.TemplateId);
						}
						else
						{
							DomainManager.Taiwu.VillagerStoreItemInTreasury(context, this, itemKey2, 1, true);
						}
					}
				}
				ObjectPool<List<ItemKey>>.Instance.Return(bookList);
			}
		}

		// Token: 0x06006D53 RID: 27987 RVA: 0x003D52D4 File Offset: 0x003D34D4
		public void ReturnVillagerRoleClothing(DataContext context, bool forceReturn = true)
		{
			short idealClothingTemplateId = this.GetIdealClothingTemplateId();
			bool needEquipClothing = false;
			if (forceReturn)
			{
				ItemKey equipment = this.GetEquipment()[4];
				bool flag = equipment.IsValid();
				if (flag)
				{
					bool isRoleClothing = VillagerRole.Instance.Any((VillagerRoleItem r) => r.Clothing == equipment.TemplateId);
					bool isIdeal = idealClothingTemplateId == equipment.TemplateId;
					bool flag2 = isRoleClothing && !isIdeal;
					if (flag2)
					{
						this.ChangeEquipment(context, 4, -1, equipment);
						needEquipClothing = true;
					}
				}
			}
			else
			{
				EventHelper.SelectAndEquipClothing(this._id);
			}
			IReadOnlyDictionary<ItemKey, int> taiwuGiftItems = DomainManager.Taiwu.IsInGroup(this._id) ? DomainManager.Extra.GetTaiwuGiftItems(this._id) : Inventory.Empty;
			List<ItemKey> clothingList = ObjectPool<List<ItemKey>>.Instance.Get();
			foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
			{
				ItemKey itemKey2;
				int num;
				keyValuePair.Deconstruct(out itemKey2, out num);
				ItemKey itemKey = itemKey2;
				bool flag3 = itemKey.ItemType != 3;
				if (!flag3)
				{
					bool flag4 = taiwuGiftItems.ContainsKey(itemKey);
					if (!flag4)
					{
						bool isRoleClothing2 = VillagerRole.Instance.Any((VillagerRoleItem r) => r.Clothing == itemKey.TemplateId);
						bool isIdeal2 = idealClothingTemplateId == itemKey.TemplateId;
						bool flag5 = isRoleClothing2 && !isIdeal2;
						if (flag5)
						{
							clothingList.Add(itemKey);
						}
					}
				}
			}
			foreach (ItemKey itemKey3 in clothingList)
			{
				this.RemoveInventoryItem(context, itemKey3, 1, false, false);
				DomainManager.Taiwu.VillagerStoreItemInTreasury(context, this, itemKey3, 1, true);
			}
			bool flag6 = needEquipClothing;
			if (flag6)
			{
				EventHelper.SelectAndEquipClothing(this._id);
			}
			ObjectPool<List<ItemKey>>.Instance.Return(clothingList);
		}

		// Token: 0x06006D54 RID: 27988 RVA: 0x003D5524 File Offset: 0x003D3724
		public unsafe ResourceInts GetResourcesAboveSatisfyingThreshold()
		{
			OrganizationMemberItem memberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
			ResourceInts resources;
			for (sbyte type = 0; type < 8; type += 1)
			{
				int threshold = memberCfg.GetAdjustedResourceSatisfyingAmount(type);
				*(ref resources.Items.FixedElementField + (IntPtr)type * 4) = Math.Max(*(ref this._resources.Items.FixedElementField + (IntPtr)type * 4) - threshold, 0);
			}
			return resources;
		}

		// Token: 0x06006D55 RID: 27989 RVA: 0x003D5594 File Offset: 0x003D3794
		public ItemKey GetMaxGradeItemToLose(IRandomSource random)
		{
			List<ItemKey> itemRandomPool = ObjectPool<List<ItemKey>>.Instance.Get();
			itemRandomPool.Clear();
			sbyte maxGrade = -1;
			bool isAdult = this.GetAgeGroup() != 2;
			for (int i = 0; i < this._equipment.Length; i++)
			{
				ItemKey itemKey = this._equipment[i];
				bool flag = !itemKey.IsValid();
				if (!flag)
				{
					bool flag2 = !isAdult && i == 4;
					if (!flag2)
					{
						maxGrade = Character.<GetMaxGradeItemToLose>g__AddItemToLose|505_0(itemKey, maxGrade, itemRandomPool);
					}
				}
			}
			foreach (ItemKey itemKey2 in this._inventory.Items.Keys)
			{
				bool flag3 = !ItemDomain.CanItemBeLost(itemKey2);
				if (!flag3)
				{
					maxGrade = Character.<GetMaxGradeItemToLose>g__AddItemToLose|505_0(itemKey2, maxGrade, itemRandomPool);
				}
			}
			ItemKey itemToLose = (itemRandomPool.Count > 0) ? itemRandomPool.GetRandom(random) : ItemKey.Invalid;
			ObjectPool<List<ItemKey>>.Instance.Return(itemRandomPool);
			return itemToLose;
		}

		// Token: 0x06006D56 RID: 27990 RVA: 0x003D56B8 File Offset: 0x003D38B8
		public void GetItemsToLose(List<ItemKey> result, sbyte minGrade = 0, sbyte maxGrade = 8)
		{
			result.Clear();
			bool isAdult = this.GetAgeGroup() == 2;
			for (int i = 0; i < this._equipment.Length; i++)
			{
				ItemKey itemKey = this._equipment[i];
				bool flag = !itemKey.IsValid();
				if (!flag)
				{
					bool flag2 = !isAdult && i == 4;
					if (!flag2)
					{
						sbyte grade = ItemTemplateHelper.GetGrade(itemKey.ItemType, itemKey.TemplateId);
						bool flag3 = grade < minGrade || grade > maxGrade;
						if (!flag3)
						{
							result.Add(itemKey);
						}
					}
				}
			}
			foreach (ItemKey itemKey2 in this._inventory.Items.Keys)
			{
				bool flag4 = !ItemDomain.CanItemBeLost(itemKey2);
				if (!flag4)
				{
					sbyte grade2 = ItemTemplateHelper.GetGrade(itemKey2.ItemType, itemKey2.TemplateId);
					bool flag5 = grade2 < minGrade || grade2 > maxGrade;
					if (!flag5)
					{
						result.Add(itemKey2);
					}
				}
			}
		}

		// Token: 0x06006D57 RID: 27991 RVA: 0x003D57E4 File Offset: 0x003D39E4
		private void OfflineCreateInventoryOnCharacterCreation(DataContext context, sbyte itemType, short templateId, int amount)
		{
			bool flag = amount <= 1 || ItemTemplateHelper.IsStackable(itemType, templateId);
			if (flag)
			{
				ItemKey itemKey = DomainManager.Item.CreateItem(context, itemType, templateId);
				this._inventory.OfflineAdd(itemKey, amount);
			}
			else
			{
				for (int i = 0; i < amount; i++)
				{
					ItemKey itemKey2 = DomainManager.Item.CreateItem(context, itemType, templateId);
					this._inventory.Items.Add(itemKey2, 1);
				}
			}
		}

		// Token: 0x06006D58 RID: 27992 RVA: 0x003D5860 File Offset: 0x003D3A60
		private void OfflineCreateInventoryItem(DataContext context, sbyte itemType, short templateId, int amount)
		{
			bool flag = amount <= 1 || ItemTemplateHelper.IsStackable(itemType, templateId);
			if (flag)
			{
				ItemKey itemKey = DomainManager.Item.CreateItem(context, itemType, templateId);
				DomainManager.Item.SetOwner(itemKey, ItemOwnerType.CharacterInventory, this._id);
				this._inventory.OfflineAdd(itemKey, amount);
			}
			else
			{
				for (int i = 0; i < amount; i++)
				{
					ItemKey itemKey2 = DomainManager.Item.CreateItem(context, itemType, templateId);
					DomainManager.Item.SetOwner(itemKey2, ItemOwnerType.CharacterInventory, this._id);
					this._inventory.Items.Add(itemKey2, 1);
				}
			}
		}

		// Token: 0x06006D59 RID: 27993 RVA: 0x003D5900 File Offset: 0x003D3B00
		public ItemKey GetInventoryRope(DataContext context, sbyte grade)
		{
			bool flag = context.Random.CheckPercentProb(50);
			if (flag)
			{
				foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
				{
					ItemKey itemKey2;
					int num;
					keyValuePair.Deconstruct(out itemKey2, out num);
					ItemKey itemKey = itemKey2;
					bool flag2 = itemKey.ItemType == 12 && ItemTemplateHelper.GetItemSubType(itemKey.ItemType, itemKey.TemplateId) == 1206 && ItemTemplateHelper.GetGrade(itemKey.ItemType, itemKey.TemplateId) >= grade;
					if (flag2)
					{
						return itemKey;
					}
				}
			}
			sbyte actualGrade = ItemDomain.GenerateRandomItemGrade(context.Random, grade);
			ItemKey rope = DomainManager.Item.CreateMisc(context, (short)(73 + actualGrade));
			this.AddInventoryItem(context, rope, 1, false);
			return rope;
		}

		// Token: 0x06006D5A RID: 27994 RVA: 0x003D59FC File Offset: 0x003D3BFC
		public int GetKidnapMaxSlotCount()
		{
			ItemKey carrierKey = this._equipment[11];
			bool flag = !carrierKey.IsValid();
			int result;
			if (flag)
			{
				result = (int)GlobalConfig.Instance.KidnapSlotBaseMaxCount;
			}
			else
			{
				result = (int)(GlobalConfig.Instance.KidnapSlotBaseMaxCount + DomainManager.Item.GetElement_Carriers(carrierKey.Id).GetMaxKidnapSlotCountBonus());
			}
			return result;
		}

		// Token: 0x06006D5B RID: 27995 RVA: 0x003D5A58 File Offset: 0x003D3C58
		public LifeSkillItem LearnNewLifeSkill(DataContext context, short lifeSkillTemplateId, byte readingState)
		{
			LifeSkillItem skill = new LifeSkillItem(lifeSkillTemplateId);
			skill.ReadingState = readingState;
			this._learnedLifeSkills.Add(skill);
			this.SetLearnedLifeSkills(this._learnedLifeSkills, context);
			bool flag = skill.IsAllPagesRead();
			if (flag)
			{
				DomainManager.Information.GainLifeSkillInformationToCharacter(context, this._id, LifeSkill.Instance[lifeSkillTemplateId].Type);
			}
			bool flag2 = this._id == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag2)
			{
				DomainManager.Taiwu.RegisterLifeSkill(context, skill);
				DomainManager.Taiwu.AddLegacyPoint(context, 14, 100);
			}
			return skill;
		}

		// Token: 0x06006D5C RID: 27996 RVA: 0x003D5AF8 File Offset: 0x003D3CF8
		public void UpdateLifeSkillReadingState(DataContext context, int learnedSkillIndex, byte readingState)
		{
			LifeSkillItem skill = this._learnedLifeSkills[learnedSkillIndex];
			bool isAllReadBefore = skill.IsAllPagesRead();
			skill.ReadingState = readingState;
			this._learnedLifeSkills[learnedSkillIndex] = skill;
			this.SetLearnedLifeSkills(this._learnedLifeSkills, context);
			sbyte lifeSkillType = LifeSkill.Instance[skill.SkillTemplateId].Type;
			bool flag = !isAllReadBefore && skill.IsAllPagesRead();
			if (flag)
			{
				DomainManager.Information.GainLifeSkillInformationToCharacter(context, this._id, lifeSkillType);
			}
		}

		// Token: 0x06006D5D RID: 27997 RVA: 0x003D5B7C File Offset: 0x003D3D7C
		public void ReadLifeSkillPage(DataContext context, int learnedSkillIndex, byte pageId)
		{
			LifeSkillItem skill = this._learnedLifeSkills[learnedSkillIndex];
			bool isAllReadBefore = skill.IsAllPagesRead();
			skill.SetPageRead(pageId);
			this._learnedLifeSkills[learnedSkillIndex] = skill;
			this.SetLearnedLifeSkills(this._learnedLifeSkills, context);
			sbyte lifeSkillType = LifeSkill.Instance[skill.SkillTemplateId].Type;
			bool flag = !isAllReadBefore && skill.IsAllPagesRead();
			if (flag)
			{
				DomainManager.Information.GainLifeSkillInformationToCharacter(context, this._id, lifeSkillType);
			}
		}

		// Token: 0x06006D5E RID: 27998 RVA: 0x003D5C00 File Offset: 0x003D3E00
		public unsafe short GetLifeSkillAttainment(sbyte lifeSkillType)
		{
			ref LifeSkillShorts attainments = ref this.GetLifeSkillAttainments();
			return *(ref attainments.Items.FixedElementField + (IntPtr)lifeSkillType * 2);
		}

		// Token: 0x06006D5F RID: 27999 RVA: 0x003D5C2C File Offset: 0x003D3E2C
		public unsafe short GetLifeSkillQualification(sbyte lifeSkillType)
		{
			ref LifeSkillShorts qualifications = ref this.GetLifeSkillQualifications();
			return *(ref qualifications.Items.FixedElementField + (IntPtr)lifeSkillType * 2);
		}

		// Token: 0x06006D60 RID: 28000 RVA: 0x003D5C58 File Offset: 0x003D3E58
		public unsafe short GetMaxLifeSkillAttainment()
		{
			ref LifeSkillShorts attainments = ref this.GetLifeSkillAttainments();
			short max = 0;
			for (int i = 0; i < 16; i++)
			{
				bool flag = *(ref attainments.Items.FixedElementField + (IntPtr)i * 2) > max;
				if (flag)
				{
					max = *(ref attainments.Items.FixedElementField + (IntPtr)i * 2);
				}
			}
			return max;
		}

		// Token: 0x06006D61 RID: 28001 RVA: 0x003D5CB8 File Offset: 0x003D3EB8
		public short GetMaxCombatSkillAttainment()
		{
			ref CombatSkillShorts attainments = ref this.GetCombatSkillAttainments();
			return attainments.GetMaxCombatSkillValue();
		}

		// Token: 0x06006D62 RID: 28002 RVA: 0x003D5CD8 File Offset: 0x003D3ED8
		public unsafe ValueTuple<sbyte, short> GetMaxCombatSkillAttainmentType()
		{
			ref CombatSkillShorts attainments = ref this.GetCombatSkillAttainments();
			sbyte combatType = attainments.GetMaxCombatSkillType();
			return new ValueTuple<sbyte, short>(combatType, *(ref attainments.Items.FixedElementField + (IntPtr)combatType * 2));
		}

		// Token: 0x06006D63 RID: 28003 RVA: 0x003D5D10 File Offset: 0x003D3F10
		public int FindLearnedLifeSkillIndex(short skillTemplateId)
		{
			for (int i = 0; i < this._learnedLifeSkills.Count; i++)
			{
				bool flag = this._learnedLifeSkills[i].SkillTemplateId == skillTemplateId;
				if (flag)
				{
					return i;
				}
			}
			return -1;
		}

		// Token: 0x06006D64 RID: 28004 RVA: 0x003D5D5C File Offset: 0x003D3F5C
		public sbyte GetMaxLifeSkillAttainmentType(DataContext context)
		{
			ref LifeSkillShorts attainments = ref this.GetLifeSkillAttainments();
			return attainments.GetMaxLifeSkillType(context.Random);
		}

		// Token: 0x06006D65 RID: 28005 RVA: 0x003D5D84 File Offset: 0x003D3F84
		private LifeSkillShorts GetPredictLifeSkillAttainments(short skillTemplateId, int count)
		{
			LifeSkillShorts value = default(LifeSkillShorts);
			value.Initialize();
			this.GetLifeSkillBaseAttainment(ref value);
			LifeSkillItem skillConfig = LifeSkill.Instance[skillTemplateId];
			int bonus = (int)(GlobalConfig.Instance.AddAttainmentPerGrade[(int)skillConfig.Grade] / 5) * count;
			ref short ptr = ref value.Items.FixedElementField + (IntPtr)skillConfig.Type * 2;
			ptr += (short)bonus;
			this.GetLifeSkillAttainmentAddOns(ref value);
			return value;
		}

		// Token: 0x06006D66 RID: 28006 RVA: 0x003D5DF8 File Offset: 0x003D3FF8
		public unsafe short GetPredictLifeSkillAttainment(short type, short skillTemplateId, int count)
		{
			return *(ref this.GetPredictLifeSkillAttainments(skillTemplateId, count).Items.FixedElementField + (IntPtr)type * 2);
		}

		// Token: 0x06006D67 RID: 28007 RVA: 0x003D5E28 File Offset: 0x003D4028
		public void GetLifeSkillBaseAttainment(ref LifeSkillShorts value)
		{
			int i = 0;
			int count = this._learnedLifeSkills.Count;
			while (i < count)
			{
				LifeSkillItem item = this._learnedLifeSkills[i];
				LifeSkillItem skillConfig = LifeSkill.Instance[item.SkillTemplateId];
				int readPageCount = item.GetReadPagesCount();
				int bonus = (int)(GlobalConfig.Instance.AddAttainmentPerGrade[(int)skillConfig.Grade] / 5) * readPageCount;
				ref short ptr = ref value.Items.FixedElementField + (IntPtr)skillConfig.Type * 2;
				ptr += (short)bonus;
				i++;
			}
		}

		// Token: 0x06006D68 RID: 28008 RVA: 0x003D5EB4 File Offset: 0x003D40B4
		public sbyte GetLearnedLifeSkillMaxGradeByType(sbyte lifeSkillType)
		{
			sbyte grade = 0;
			int i = 0;
			int count = this._learnedLifeSkills.Count;
			while (i < count)
			{
				LifeSkillItem item = this._learnedLifeSkills[i];
				LifeSkillItem skillItem = LifeSkill.Instance[item.SkillTemplateId];
				bool flag = skillItem.Type != lifeSkillType;
				if (!flag)
				{
					bool flag2 = skillItem.Grade > grade;
					if (flag2)
					{
						grade = skillItem.Grade;
					}
				}
				i++;
			}
			return grade;
		}

		// Token: 0x06006D69 RID: 28009 RVA: 0x003D5F38 File Offset: 0x003D4138
		public int GetLearnedLifeSkillTotalValue(sbyte lifeSkillType)
		{
			int totalValue = 0;
			int i = 0;
			int count = this._learnedLifeSkills.Count;
			while (i < count)
			{
				LifeSkillItem item = this._learnedLifeSkills[i];
				LifeSkillItem skillItem = LifeSkill.Instance[item.SkillTemplateId];
				bool flag = skillItem.Type != lifeSkillType;
				if (!flag)
				{
					int baseValue = ItemTemplateHelper.GetBaseValue(10, skillItem.SkillBookId);
					int value = baseValue * item.GetReadPagesCount() / 5;
					totalValue += value;
				}
				i++;
			}
			return totalValue;
		}

		// Token: 0x06006D6A RID: 28010 RVA: 0x003D5FC8 File Offset: 0x003D41C8
		public unsafe void GetLifeSkillAttainmentAddOns(ref LifeSkillShorts value)
		{
			ref LifeSkillShorts qualifications = ref this.GetLifeSkillQualifications();
			for (int i = 0; i < 16; i++)
			{
				int bonus = (int)(*(ref value.Items.FixedElementField + (IntPtr)i * 2));
				*(ref value.Items.FixedElementField + (IntPtr)i * 2) = (short)((int)(*(ref qualifications.Items.FixedElementField + (IntPtr)i * 2)) * (100 + bonus) / 100 + bonus);
			}
			IBuildingEffectValue buildingEffect = DomainManager.Building.GetBuildingBlockEffectObject(this._location, EBuildingScaleEffect.LifeSkillAttainment);
			bool flag = buildingEffect != null;
			if (flag)
			{
				for (int lifeSkillType = 0; lifeSkillType < 16; lifeSkillType++)
				{
					ref short ptr = ref value[lifeSkillType];
					ptr += (short)buildingEffect.Get(lifeSkillType);
				}
			}
			for (int j = 0; j < 16; j++)
			{
				bool flag2 = *(ref value.Items.FixedElementField + (IntPtr)j * 2) < 0;
				if (flag2)
				{
					*(ref value.Items.FixedElementField + (IntPtr)j * 2) = 0;
				}
			}
		}

		// Token: 0x06006D6B RID: 28011 RVA: 0x003D60C0 File Offset: 0x003D42C0
		public List<short> GetUnlockedDebateStrategyList()
		{
			List<short> strategyTemplateIdList = new List<short>();
			List<LifeSkillItem> learnedLifeSkills = this.GetLearnedLifeSkills();
			foreach (LifeSkillItem learnedLifeSkill in learnedLifeSkills)
			{
				short strategyTemplateId;
				sbyte b;
				bool unlocked = this.CheckLearnedBookHasUnlockedDebateStrategy(learnedLifeSkill, out strategyTemplateId, out b);
				bool flag = unlocked && !strategyTemplateIdList.Contains(strategyTemplateId);
				if (flag)
				{
					strategyTemplateIdList.Add(strategyTemplateId);
				}
			}
			strategyTemplateIdList.Sort();
			return strategyTemplateIdList;
		}

		// Token: 0x06006D6C RID: 28012 RVA: 0x003D6158 File Offset: 0x003D4358
		public Dictionary<sbyte, int> GetHasUnlockedDebateStrategyLearnedBookCountDict(int strategyLevel)
		{
			Dictionary<sbyte, int> dict = new Dictionary<sbyte, int>();
			List<LifeSkillItem> learnedLifeSkills = this.GetLearnedLifeSkills();
			foreach (LifeSkillItem learnedLifeSkill in learnedLifeSkills)
			{
				short strategyTemplateId;
				sbyte bookLifeSkillType;
				bool unlocked = this.CheckLearnedBookHasUnlockedDebateStrategy(learnedLifeSkill, out strategyTemplateId, out bookLifeSkillType);
				bool flag = unlocked && (int)DebateStrategy.Instance[strategyTemplateId].Level == strategyLevel;
				if (flag)
				{
					int count;
					dict.TryGetValue(bookLifeSkillType, out count);
					count = (dict[bookLifeSkillType] = count + 1);
				}
			}
			return dict;
		}

		// Token: 0x06006D6D RID: 28013 RVA: 0x003D6204 File Offset: 0x003D4404
		public short GetUnlockedDebateStrategy(LifeSkillItem learnedLifeSkill, Dictionary<sbyte, int> oldUnlockCountDict)
		{
			short strategyTemplateId;
			sbyte lifeSkillType;
			bool flag = !this.CheckLearnedBookHasUnlockedDebateStrategy(learnedLifeSkill, out strategyTemplateId, out lifeSkillType);
			short result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				DebateStrategyItem strategyConfig = DebateStrategy.Instance[strategyTemplateId];
				Dictionary<sbyte, int> newUnlockCountDict = this.GetHasUnlockedDebateStrategyLearnedBookCountDict((int)strategyConfig.Level);
				int oldCount;
				oldUnlockCountDict.TryGetValue(lifeSkillType, out oldCount);
				int newCount;
				newUnlockCountDict.TryGetValue(lifeSkillType, out newCount);
				bool flag2 = oldCount == 0 && newCount == 1;
				if (flag2)
				{
					result = strategyTemplateId;
				}
				else
				{
					result = -1;
				}
			}
			return result;
		}

		// Token: 0x06006D6E RID: 28014 RVA: 0x003D6278 File Offset: 0x003D4478
		public bool CheckLearnedBookHasUnlockedDebateStrategy(LifeSkillItem learnedLifeSkill, out short strategyTemplateId, out sbyte lifeSkillType)
		{
			lifeSkillType = -1;
			strategyTemplateId = -1;
			LifeSkillItem skillConfig = LifeSkill.Instance[learnedLifeSkill.SkillTemplateId];
			SkillBookItem bookConfig = Config.SkillBook.Instance[skillConfig.SkillBookId];
			sbyte grade = bookConfig.Grade;
			if (!true)
			{
			}
			int strategyLevel2;
			if (grade <= 5)
			{
				if (grade >= 0)
				{
					if (grade > 2)
					{
						strategyLevel2 = 2;
						goto IL_6F;
					}
					strategyLevel2 = 1;
					goto IL_6F;
				}
			}
			else if (grade <= 8)
			{
				strategyLevel2 = 3;
				goto IL_6F;
			}
			throw new ArgumentOutOfRangeException();
			IL_6F:
			if (!true)
			{
			}
			int strategyLevel = strategyLevel2;
			DebateStrategyItem strategyConfig = DebateStrategy.Instance.FirstOrDefault((DebateStrategyItem s) => s.LifeSkillType == bookConfig.LifeSkillType && (int)s.Level == strategyLevel);
			strategyTemplateId = ((strategyConfig != null) ? strategyConfig.TemplateId : -1);
			lifeSkillType = bookConfig.LifeSkillType;
			bool flag = !learnedLifeSkill.IsAllPagesRead();
			return !flag && strategyTemplateId >= 0;
		}

		// Token: 0x1700047B RID: 1147
		// (get) Token: 0x06006D6F RID: 28015 RVA: 0x003D6354 File Offset: 0x003D4554
		public bool IsOverweight
		{
			get
			{
				return this.GetCurrInventoryLoad() > this.GetMaxInventoryLoad();
			}
		}

		// Token: 0x06006D70 RID: 28016 RVA: 0x003D6364 File Offset: 0x003D4564
		public int CalcMoveTimePercent()
		{
			return (this.IsOverweight ? this.CalcOverweightSanctionPercent() : 100) * this.CalcCarrierTimeBonus();
		}

		// Token: 0x06006D71 RID: 28017 RVA: 0x003D6394 File Offset: 0x003D4594
		public int CalcOverweightSanctionPercent()
		{
			int currLoad = this.GetCurrInventoryLoad();
			int maxLoad = this.GetMaxInventoryLoad();
			return 300 + CValuePercent.ParseInt(currLoad - maxLoad, maxLoad);
		}

		// Token: 0x06006D72 RID: 28018 RVA: 0x003D63C4 File Offset: 0x003D45C4
		public CValuePercentBonus CalcCarrierTimeBonus()
		{
			ItemKey itemKey = this.GetEquipment()[11];
			bool flag = itemKey.IsValid();
			CValuePercentBonus result;
			if (flag)
			{
				result = (int)(-(int)DomainManager.Item.GetElement_Carriers(itemKey.Id).GetTravelTimeReduction());
			}
			else
			{
				result = 0;
			}
			return result;
		}

		// Token: 0x06006D73 RID: 28019 RVA: 0x003D6414 File Offset: 0x003D4614
		public void AddPersonalNeed(DataContext context, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = this.OfflineAddPersonalNeed(personalNeed);
			if (flag)
			{
				this.SetPersonalNeeds(this._personalNeeds, context);
			}
		}

		// Token: 0x06006D74 RID: 28020 RVA: 0x003D643C File Offset: 0x003D463C
		public void RemovePersonalNeed(DataContext context, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			int count = this._personalNeeds.RemoveAll((GameData.Domains.Character.Ai.PersonalNeed need) => GameData.Domains.Character.Ai.PersonalNeed.MatchType(need, personalNeed));
			bool flag = count > 0;
			if (flag)
			{
				this.SetPersonalNeeds(this._personalNeeds, context);
			}
		}

		// Token: 0x06006D75 RID: 28021 RVA: 0x003D6488 File Offset: 0x003D4688
		public bool OfflineAddPersonalNeed(GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			PersonalNeedItem config = Config.PersonalNeed.Instance[personalNeed.TemplateId];
			for (int i = 0; i < this._personalNeeds.Count; i++)
			{
				GameData.Domains.Character.Ai.PersonalNeed need = this._personalNeeds[i];
				bool flag = !GameData.Domains.Character.Ai.PersonalNeed.MatchType(personalNeed, need);
				if (!flag)
				{
					bool overwrite = config.Overwrite;
					if (overwrite)
					{
						this._personalNeeds[i] = personalNeed;
					}
					else
					{
						bool combine = config.Combine;
						if (combine)
						{
							bool flag2 = need.Amount < personalNeed.Amount;
							if (flag2)
							{
								need.Amount = personalNeed.Amount;
							}
							need.RemainingMonths = personalNeed.RemainingMonths;
							this._personalNeeds[i] = need;
						}
						else
						{
							bool flag3 = need.Amount == personalNeed.Amount;
							if (flag3)
							{
								return false;
							}
							this._personalNeeds.Add(personalNeed);
						}
					}
					return true;
				}
			}
			this._personalNeeds.Add(personalNeed);
			return true;
		}

		// Token: 0x06006D76 RID: 28022 RVA: 0x003D6594 File Offset: 0x003D4794
		public void OfflineUpdatePersonalNeedsDuration()
		{
			for (int i = this._personalNeeds.Count - 1; i >= 0; i--)
			{
				GameData.Domains.Character.Ai.PersonalNeed need = this._personalNeeds[i];
				bool flag = need.RemainingMonths <= 0;
				if (flag)
				{
					CollectionUtils.SwapAndRemove<GameData.Domains.Character.Ai.PersonalNeed>(this._personalNeeds, i);
				}
				else
				{
					need.RemainingMonths -= 1;
					this._personalNeeds[i] = need;
				}
			}
		}

		// Token: 0x06006D77 RID: 28023 RVA: 0x003D660C File Offset: 0x003D480C
		public void OfflinePossession(DeadCharacter deadCharacter)
		{
			this._happiness = deadCharacter.Happiness;
			this._baseMorality = deadCharacter.Morality;
			this._preexistenceCharIds = deadCharacter.PreexistenceCharIds;
			this._baseLifeSkillQualifications = deadCharacter.BaseLifeSkillQualifications;
			this._baseCombatSkillQualifications = deadCharacter.BaseCombatSkillQualifications;
			this._baseMainAttributes = deadCharacter.BaseMainAttributes;
			bool isMale = this._gender == 1;
			short birthFeatureId = CharacterDomain.GetBirthdayFeatureId(this.GetBirthMonth());
			this._featureIds.Clear();
			this._featureIds.Add(birthFeatureId);
			bool flag = this.GetFameType() >= 4;
			if (flag)
			{
				this._featureIds.Add(484);
			}
			else
			{
				sbyte fameType = this.GetFameType();
				bool flag2 = fameType >= 0 && fameType < 3;
				if (flag2)
				{
					this._featureIds.Add(485);
				}
			}
			foreach (short id in deadCharacter.FeatureIds)
			{
				bool flag3 = CharacterFeature.Instance[id].MutexGroupId == 734;
				if (!flag3)
				{
					bool flag4 = id == 169 && isMale;
					if (flag4)
					{
						this._featureIds.Add(168);
					}
					else
					{
						bool flag5 = id == 168 && !isMale;
						if (flag5)
						{
							this._featureIds.Add(169);
						}
						else
						{
							bool flag6 = CharacterFeature.Instance[id].SoulTransform && CharacterFeature.Instance[id].MutexGroupId != 183;
							if (flag6)
							{
								this._featureIds.Add(id);
							}
						}
					}
				}
			}
			this._featureIds.Sort(new Comparison<short>(CharacterFeatureHelper.CompareFeature));
		}

		// Token: 0x06006D78 RID: 28024 RVA: 0x003D67FC File Offset: 0x003D49FC
		public static RecruitCharacterData GenerateRecruitCharacterData(IRandomSource random, sbyte peopleLevel, BuildingBlockKey blockKey, BuildingBlockData blockData)
		{
			Character.<>c__DisplayClass541_0 CS$<>8__locals1 = new Character.<>c__DisplayClass541_0();
			Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
			Location location = DomainManager.Taiwu.GetTaiwuVillageLocation();
			BuildingBlockItem blockConfig = blockData.ConfigData;
			sbyte gender = Gender.GetRandom(random);
			bool transgender = false;
			short age = (short)random.Next(18, 25);
			sbyte stateTemplateId = DomainManager.Map.GetStateTemplateIdByAreaId(location.AreaId);
			sbyte orgTemplateId = MapState.Instance[stateTemplateId].SectID;
			short charTemplateId = OrganizationDomain.GetCharacterTemplateId(orgTemplateId, stateTemplateId, gender);
			OrganizationInfo orgInfo = taiwuChar.GetOrganizationInfo();
			short orgMemberId = OrganizationDomain.GetMemberId(orgInfo.OrgTemplateId, peopleLevel);
			OrganizationMemberItem orgMemberConfig = OrganizationMember.Instance.GetItem(orgMemberId);
			CharacterItem template = Character.Instance[charTemplateId];
			short baseAttraction = (blockData.TemplateId == 217) ? ((short)Math.Min(random.Next(500, 751) + (int)(25 * peopleLevel), 900)) : Character.GenerateRandomAttraction(random);
			short[] combatSkillAdjusts = blockConfig.RecruitCombatSkillsAdjust;
			bool flag = DomainManager.Building.IsDependKungfuPracticeRoom(blockConfig);
			if (flag)
			{
				List<short[]> adjusts = new List<short[]>();
				Action<BuildingBlockData, int> <>9__2;
				DomainManager.Building.BuildingBlockDependencies(blockKey, delegate(BuildingBlockData dependData, int _, BuildingBlockKey dependKey)
				{
					bool flag3 = dependData.TemplateId == 52;
					if (flag3)
					{
						BuildingDomain building = DomainManager.Building;
						Action<BuildingBlockData, int> onInfluenceFound;
						if ((onInfluenceFound = <>9__2) == null)
						{
							onInfluenceFound = (<>9__2 = delegate(BuildingBlockData influenceData, int _)
							{
								adjusts.Add(influenceData.ConfigData.RecruitCombatSkillsAdjust);
							});
						}
						building.BuildingBlockInfluences(dependKey, onInfluenceFound);
					}
				});
				combatSkillAdjusts = CharacterCreation.MergeAdjusts(adjusts, 14);
			}
			CS$<>8__locals1.featureCreationContext = new FeatureCreationContext
			{
				FeatureIds = new List<short>(),
				PotentialFeatureIds = new List<short>(),
				Gender = gender,
				BirthMonth = (sbyte)random.Next(0, 11),
				CurrAge = age,
				RandomFeaturesAtCreating = true,
				PotentialFeaturesAge = -1,
				DestinyType = -1,
				AllGoodBasicFeature = false,
				IsProtagonist = false
			};
			CharacterCreation.CreateFeatures(random, ref CS$<>8__locals1.featureCreationContext);
			short clothingTemplateId = OrganizationDomain.GetRandomOrgMemberClothing(random, orgMemberConfig);
			AvatarData avatarData;
			short avatarAttraction;
			do
			{
				avatarData = AvatarManager.Instance.GetRandomAvatar(random, gender, transgender, template.PresetBodyType, baseAttraction);
				bool isAbleToGrowHair = orgMemberConfig.MonkType != 130;
				bool isAbleToGrowBeard = gender == 1 && !transgender && !CS$<>8__locals1.featureCreationContext.FeatureIds.Contains(168);
				for (sbyte i = 0; i < 7; i += 1)
				{
					if (!true)
					{
					}
					bool flag2;
					switch (i)
					{
					case 0:
						flag2 = isAbleToGrowHair;
						break;
					case 1:
						flag2 = ((int)age >= GlobalConfig.Instance.AgeShowBeard1 && isAbleToGrowBeard);
						break;
					case 2:
						flag2 = isAbleToGrowBeard;
						break;
					case 3:
						flag2 = Character.IsAbleToGrowWrinkle1(age);
						break;
					case 4:
						flag2 = Character.IsAbleToGrowWrinkle2(age);
						break;
					case 5:
						flag2 = Character.IsAbleToGrowWrinkle3(age);
						break;
					case 6:
						flag2 = Character.IsAbleToGrowEyebrow();
						break;
					default:
						flag2 = false;
						break;
					}
					if (!true)
					{
					}
					bool isShow = flag2;
					avatarData.SetGrowableElementShowingAbility(i, isShow);
					avatarData.SetGrowableElementShowingState(i, isShow);
				}
				avatarAttraction = avatarData.GetCharm(age, Config.Clothing.Instance[clothingTemplateId].DisplayId);
			}
			while (Math.Abs((int)(baseAttraction - avatarAttraction)) > 100);
			baseAttraction = avatarAttraction;
			int bonus = 0;
			foreach (short featureId in CS$<>8__locals1.featureCreationContext.FeatureIds)
			{
				int value = CharacterFeature.GetCharacterPropertyBonus((int)featureId, ECharacterPropertyReferencedType.Attraction);
				bonus = EDataSumType.All.Sum(bonus, value);
			}
			short finalAttraction = (short)((int)baseAttraction + bonus);
			short attractionPercentBonus = 0;
			foreach (short featureId2 in CS$<>8__locals1.featureCreationContext.FeatureIds)
			{
				attractionPercentBonus += CharacterFeature.Instance[featureId2].AttractionPercentBonus;
			}
			finalAttraction = finalAttraction * (100 + attractionPercentBonus) / 100;
			List<sbyte> teammateCommands = new List<sbyte>();
			ExtraDomain.GetRandomCmdTypes(random, teammateCommands, new Func<sbyte, int>(CS$<>8__locals1.<GenerateRecruitCharacterData>g__CalcMedalCount|0));
			RecruitCharacterData data = new RecruitCharacterData
			{
				TemplateId = charTemplateId,
				PeopleLevel = peopleLevel,
				Age = age,
				BirthMonth = CS$<>8__locals1.featureCreationContext.BirthMonth,
				FullName = CharacterDomain.GenerateRandomHanName(random, -1, -1, gender, 0),
				BaseAttraction = baseAttraction,
				FinalAttraction = finalAttraction,
				AvatarData = avatarData,
				MainAttributes = CharacterCreation.CreateMainAttributes(random, peopleLevel, orgMemberConfig.MainAttributesAdjust),
				FeatureIds = CS$<>8__locals1.featureCreationContext.FeatureIds,
				Gender = gender,
				Transgender = transgender,
				CombatSkillQualifications = CharacterCreation.CreateCombatSkillQualifications(random, peopleLevel, combatSkillAdjusts),
				CombatSkillQualificationGrowthType = (sbyte)random.Next(3),
				LifeSkillQualifications = CharacterCreation.CreateLifeSkillQualifications(random, peopleLevel, blockConfig.RecruitLifeSkillsAdjust),
				LifeSkillQualificationGrowthType = (sbyte)random.Next(3),
				ClothingTemplateId = clothingTemplateId,
				TeammateCommands = teammateCommands
			};
			data.Recalculate();
			return data;
		}

		// Token: 0x06006D79 RID: 28025 RVA: 0x003D6CEC File Offset: 0x003D4EEC
		public IEnumerable<SolarTermItem> GetInvokedSolarTerm()
		{
			List<sbyte> validSolarTypes = ObjectPool<List<sbyte>>.Instance.Get();
			validSolarTypes.Clear();
			int num;
			for (int i = 0; i < 9; i = num + 1)
			{
				ItemKey itemKey = this._eatingItems.Get(i);
				bool flag = itemKey.ItemType != 9;
				if (!flag)
				{
					TeaWineItem config = Config.TeaWine.Instance[itemKey.TemplateId];
					bool flag2 = config.ItemSubType != 901 || config.SolarTermType < 0;
					if (!flag2)
					{
						bool flag3 = !validSolarTypes.Contains(config.SolarTermType);
						if (flag3)
						{
							validSolarTypes.Add(config.SolarTermType);
						}
						itemKey = default(ItemKey);
						config = null;
					}
				}
				num = i;
			}
			sbyte month = DomainManager.World.GetCurrMonthInYear();
			foreach (SolarTermItem solar in ((IEnumerable<SolarTermItem>)SolarTerm.Instance))
			{
				bool flag4 = solar.Month == month && validSolarTypes.Contains(solar.Type);
				if (flag4)
				{
					yield return solar;
				}
				solar = null;
			}
			IEnumerator<SolarTermItem> enumerator = null;
			ObjectPool<List<sbyte>>.Instance.Return(validSolarTypes);
			yield break;
			yield break;
		}

		// Token: 0x06006D7A RID: 28026 RVA: 0x003D6CFC File Offset: 0x003D4EFC
		public CValuePercentBonus GetSolarTermBonus(int value)
		{
			return this.GetSolarTermValue(value);
		}

		// Token: 0x06006D7B RID: 28027 RVA: 0x003D6D0C File Offset: 0x003D4F0C
		public int GetSolarTermValue(int value)
		{
			bool flag = DomainManager.Taiwu.GetTaiwuCharId() != this._id;
			int result;
			if (flag)
			{
				result = value;
			}
			else
			{
				bool flag2 = !DomainManager.Extra.IsProfessionalSkillUnlockedAndEquipped(25);
				if (flag2)
				{
					result = value;
				}
				else
				{
					List<short> allWineTemplateIds = ObjectPool<List<short>>.Instance.Get();
					for (int i = 0; i < 9; i++)
					{
						ItemKey itemKey = this._eatingItems.Get(i);
						bool flag3 = itemKey.ItemType != 9;
						if (!flag3)
						{
							TeaWineItem config = Config.TeaWine.Instance[itemKey.TemplateId];
							bool flag4 = config.ItemSubType != 901 || allWineTemplateIds.Contains(itemKey.TemplateId);
							if (!flag4)
							{
								allWineTemplateIds.Add(itemKey.TemplateId);
							}
						}
					}
					int wineCount = allWineTemplateIds.Count;
					ObjectPool<List<short>>.Instance.Return(allWineTemplateIds);
					ProfessionData professionData = DomainManager.Extra.GetProfessionData(7);
					result = value * professionData.GetSeniorityToWineTasterSolarTermBonus(wineCount);
				}
			}
			return result;
		}

		// Token: 0x06006D7C RID: 28028 RVA: 0x003D6E1A File Offset: 0x003D501A
		[MethodImpl(MethodImplOptions.AggressiveInlining)]
		internal void ActivateAdvanceMonthStatus(byte statusType)
		{
			this._advanceMonthStatus |= statusType;
		}

		// Token: 0x06006D7D RID: 28029 RVA: 0x003D6E2C File Offset: 0x003D502C
		[MethodImpl(MethodImplOptions.AggressiveInlining)]
		internal void DeactivateAdvanceMonthStatus(byte statusType)
		{
			this._advanceMonthStatus &= ~statusType;
		}

		// Token: 0x06006D7E RID: 28030 RVA: 0x003D6E40 File Offset: 0x003D5040
		[MethodImpl(MethodImplOptions.AggressiveInlining)]
		internal bool IsActiveAdvanceMonthStatus(byte statusType)
		{
			return (this._advanceMonthStatus & statusType) > 0;
		}

		// Token: 0x06006D7F RID: 28031 RVA: 0x003D6E5D File Offset: 0x003D505D
		[MethodImpl(MethodImplOptions.AggressiveInlining)]
		internal void ResetAdvanceMonthStatus()
		{
			this._advanceMonthStatus = 0;
		}

		// Token: 0x06006D80 RID: 28032 RVA: 0x003D6E68 File Offset: 0x003D5068
		public void PeriAdvanceMonth_UpdateStatus(DataContext context)
		{
			PeriAdvanceMonthUpdateStatusModification mod = new PeriAdvanceMonthUpdateStatusModification(this);
			this.OfflineChangeXiangshuInfection(mod);
			this.OfflineIncreaseAge(context, mod);
			bool flag = !this.OfflineUpdatePregnantState(context, mod);
			if (flag)
			{
				context.ParallelModificationsRecorder.RecordType(ParallelModificationType.PeriAdvanceMonthUpdateStatus);
				context.ParallelModificationsRecorder.RecordParameterClass<PeriAdvanceMonthUpdateStatusModification>(mod);
			}
			else
			{
				this.OfflineUpdateEatingItemEffect(context, mod);
				this.OfflineUpdateFeaturePoisons(context, mod);
				bool flag2 = this._xiangshuInfection < 200;
				if (flag2)
				{
					this.OfflineAutoRecoverCurrNeili(mod);
					this.OfflineChangeQiDisorder(mod);
					this.OfflineChangeInjuries(context.Random, mod);
					this.OfflineAutoRecoverPoisoned(mod);
					this.OfflineAutoRecoverMainAttributes();
				}
				else
				{
					this.OfflineRecoverAllForXiangshuInfected(mod);
				}
				this.OfflineUpdateHappiness(mod);
				bool flag3 = this._id != DomainManager.Taiwu.GetTaiwuCharId() && this.GetAgeGroup() != 0 && this._kidnapperId < 0;
				if (flag3)
				{
					this.OfflineUseResourcesForHealingAndDetox(mod);
					context.AdvanceMonthRelatedData.CategorizedRegenItems(this._inventory.Items);
					this.OfflineUseMedicineForHealingAndDetox(context, mod);
					this.OfflineUpdateHealth();
					this.OfflineUseResourcesForHealth(mod);
					this.OfflineUseMedicineForHealth(context, mod);
					this.OfflineUseMedicineForWug(context, mod);
					this.OfflineUseItemForNeili(context, mod);
					this.OfflineUseFoodForMainAttributes(context, mod);
					this.OfflineUseTeaWineForHappiness(context, mod);
					context.AdvanceMonthRelatedData.ReleaseCategorizedRegenItems();
				}
				else
				{
					this.OfflineUpdateHealth();
				}
				this.OfflineUpdateEatingItems(context, mod);
				ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
				recorder.RecordType(ParallelModificationType.PeriAdvanceMonthUpdateStatus);
				recorder.RecordParameterClass<PeriAdvanceMonthUpdateStatusModification>(mod);
			}
		}

		// Token: 0x06006D81 RID: 28033 RVA: 0x003D6FEC File Offset: 0x003D51EC
		public static void ComplementPeriAdvanceMonth_UpdateStatus(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			Character character = mod.Character;
			bool resourcesChanged = mod.ResourcesChanged;
			if (resourcesChanged)
			{
				character.SetResources(character.GetResources(), context);
			}
			bool eatingItemsChanged = mod.EatingItemsChanged;
			if (eatingItemsChanged)
			{
				character.SetEatingItems(character.GetEatingItems(), context);
				MonthlyNotificationCollection monthlyNotification = DomainManager.World.GetMonthlyNotificationCollection();
				bool flag = mod.RemovedWugKings != null;
				if (flag)
				{
					foreach (ItemKey wugKing in mod.RemovedWugKings)
					{
						monthlyNotification.AddWugKingDead(character.GetId(), wugKing.ItemType, wugKing.TemplateId);
					}
				}
				bool flag2 = mod.RemovedSafetyWugKings != null;
				if (flag2)
				{
					foreach (ItemKey wugKing2 in mod.RemovedSafetyWugKings)
					{
						monthlyNotification.AddWugKingDeadSpecial(character.GetId(), wugKing2.ItemType, wugKing2.TemplateId);
					}
				}
				bool flag3 = mod.RemovedWugs != null;
				if (flag3)
				{
					foreach (short wugTemplateId in mod.RemovedWugs)
					{
						Events.RaiseRemoveWug(context, character._id, wugTemplateId);
					}
				}
			}
			character.SetCurrMainAttributes(character.GetCurrMainAttributes(), context);
			bool currNeiliChanged = mod.CurrNeiliChanged;
			if (currNeiliChanged)
			{
				character.SetCurrNeili(character.GetCurrNeili(), context);
			}
			bool qiDisorderChanged = mod.QiDisorderChanged;
			if (qiDisorderChanged)
			{
				character.SetDisorderOfQi(character.GetDisorderOfQi(), context);
			}
			bool injuriesChanged = mod.InjuriesChanged;
			if (injuriesChanged)
			{
				character.SetInjuries(character.GetInjuries(), context);
			}
			bool poisonedChanged = mod.PoisonedChanged;
			if (poisonedChanged)
			{
				character.SetPoisoned(character.GetPoisoned(), context);
			}
			bool inventoryChanged = mod.InventoryChanged;
			if (inventoryChanged)
			{
				character.SetInventory(character.GetInventory(), context);
			}
			bool happinessChanged = mod.HappinessChanged;
			if (happinessChanged)
			{
				character.SetHappiness(character.GetHappiness(), context);
			}
			bool xiangshuInfectionChanged = mod.XiangshuInfectionChanged;
			if (xiangshuInfectionChanged)
			{
				character.SetXiangshuInfection(character._xiangshuInfection, context);
			}
			bool currAgeChanged = mod.CurrAgeChanged;
			if (currAgeChanged)
			{
				character.SetCurrAge(character._currAge, context);
				AvatarData avatar = character.GetAvatar();
				bool flag4 = avatar.UpdateGrowableElementsShowingAbilities(character);
				if (flag4)
				{
					character.SetAvatar(avatar, context);
				}
				Events.RaiseCharacterAgeChanged(context, character, (int)(character._currAge - 1), (int)character._currAge);
			}
			bool healthChanged = mod.HealthChanged;
			if (healthChanged)
			{
				character.SetHealth(character._health, context);
			}
			bool maxHealthChanged = mod.MaxHealthChanged;
			if (maxHealthChanged)
			{
				character.SetBaseMaxHealth(character._baseMaxHealth, context);
			}
			bool actualAgeChanged = mod.ActualAgeChanged;
			if (actualAgeChanged)
			{
				character.SetActualAge(character._actualAge, context);
			}
			character.TryGrowAvatarElements(context);
			bool hobbyChanged = mod.HobbyChanged;
			if (hobbyChanged)
			{
				character.CommitChangingHobby(context);
				bool flag5 = mod.FavorabilitiesOfRelatedChars != null;
				if (flag5)
				{
					DomainManager.Character.ApplyFavorabilitiesOfRelatedCharsWhenChangingHobby(context, character.GetId(), mod.FavorabilitiesOfRelatedChars);
				}
			}
			bool flag6 = mod.PregnantStateModification != null;
			if (flag6)
			{
				DomainManager.Character.ApplyPregnantStateChange(context, character, mod.PregnantStateModification);
			}
			bool flag7 = mod.ConsumedForbiddenFoodsOrWines != null;
			if (flag7)
			{
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				foreach (ItemKey itemKey in mod.ConsumedForbiddenFoodsOrWines)
				{
					lifeRecordCollection.AddMonkBreakRule(character._id, currDate, character._location, itemKey.ItemType, itemKey.TemplateId);
					SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
					int secretInfoOffset = secretInformationCollection.AddMonkBreakRule(character._id, (ulong)itemKey);
					DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				}
			}
			bool featuresChanged = mod.FeaturesChanged;
			if (featuresChanged)
			{
				character.SetFeatureIds(character.GetFeatureIds(), context);
			}
			DomainManager.Extra.TryRegenerateTeammateCommand(context, character);
			bool flag8 = character._id != DomainManager.Taiwu.GetTaiwuCharId() && character.GetAgeGroup() != 0;
			if (flag8)
			{
				DomainManager.Extra.UpdateCombatSkillProficiency(context, character);
			}
			bool personalNeedsChanged = mod.PersonalNeedsChanged;
			if (personalNeedsChanged)
			{
				character.SetPersonalNeeds(character._personalNeeds, context);
			}
			bool flag9 = mod.NewClothingTemplateId != -1;
			if (flag9)
			{
				character.ForceReplaceClothing(context, mod.NewClothingTemplateId);
			}
			short health = character.GetHealth();
			character.SetHealth(health, context);
			bool currMainAttributesChanged = mod.CurrMainAttributesChanged;
			if (currMainAttributesChanged)
			{
				character.SetCurrMainAttributes(character._currMainAttributes, context);
			}
			bool flag10 = mod.UsedHealingCount > 0;
			if (flag10)
			{
				DomainManager.Character.UseCombatResources(context, character._id, EHealActionType.Healing, mod.UsedHealingCount);
			}
			bool flag11 = mod.UsedDetoxCount > 0;
			if (flag11)
			{
				DomainManager.Character.UseCombatResources(context, character._id, EHealActionType.Detox, mod.UsedDetoxCount);
			}
			bool flag12 = mod.UsedBreathingCount > 0;
			if (flag12)
			{
				DomainManager.Character.UseCombatResources(context, character._id, EHealActionType.Breathing, mod.UsedBreathingCount);
			}
			bool flag13 = mod.UsedRecoverCount > 0;
			if (flag13)
			{
				DomainManager.Character.UseCombatResources(context, character._id, EHealActionType.Recover, mod.UsedRecoverCount);
			}
			bool flag14 = character.GetId() == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag14)
			{
				bool flag15 = mod.XiangshuInfectionFeatureChanged == 218;
				if (flag15)
				{
					DomainManager.World.SetTaiwuGettingCompletelyInfected();
				}
				else
				{
					bool flag16 = mod.XiangshuInfectionFeatureChanged == 217;
					if (flag16)
					{
						MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
						monthlyEventCollection.AddTaiwuInfectedPartially(character.GetId(), character._location);
						Events.RaiseXiangshuInfectionFeatureChanged(context, character, mod.XiangshuInfectionFeatureChanged);
					}
					else
					{
						bool flag17 = character.GetXiangshuInfection() >= 200 && character._featureIds.Contains(415);
						if (flag17)
						{
							MonthlyEventCollection monthlyEventCollection2 = DomainManager.World.GetMonthlyEventCollection();
							monthlyEventCollection2.AddMirrorCreatedImpostureXiangshuInfected(character._id, character._location);
						}
					}
				}
				PregnantStateModification pregnantStateModification = mod.PregnantStateModification;
				bool flag18 = pregnantStateModification != null && pregnantStateModification.LostMother;
				if (flag18)
				{
					DomainManager.World.SetTaiwuDying(true);
				}
			}
			else
			{
				bool flag19 = mod.XiangshuInfectionFeatureChanged >= 0;
				if (flag19)
				{
					Events.RaiseXiangshuInfectionFeatureChanged(context, character, mod.XiangshuInfectionFeatureChanged);
				}
				PregnantStateModification pregnantStateModification = mod.PregnantStateModification;
				bool flag20 = pregnantStateModification != null && pregnantStateModification.LostMother;
				if (flag20)
				{
					DomainManager.Character.MakeCharacterDead(context, character, 2);
				}
			}
		}

		// Token: 0x06006D82 RID: 28034 RVA: 0x003D76A8 File Offset: 0x003D58A8
		private void ApplyItemLost(DataContext context, [TupleElementNames(new string[]
		{
			"block",
			"itemKey",
			"amount"
		})] List<ValueTuple<MapBlockData, ItemKey, int>> itemsToBeLost)
		{
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			this.SetInventory(this._inventory, context);
			this.SetHappiness(this._happiness, context);
			bool addSecretInformation = false;
			ItemKey secretInfoParamItemKey = ItemKey.Invalid;
			int i = 0;
			int count = itemsToBeLost.Count;
			while (i < count)
			{
				ValueTuple<MapBlockData, ItemKey, int> valueTuple = itemsToBeLost[i];
				MapBlockData block = valueTuple.Item1;
				ItemKey itemKey = valueTuple.Item2;
				int amount = valueTuple.Item3;
				DomainManager.Item.RemoveOwner(itemKey, ItemOwnerType.CharacterInventory, this._id);
				bool flag = block != null;
				if (flag)
				{
					DomainManager.Map.AddBlockItem(context, block, itemKey, amount);
				}
				else
				{
					DomainManager.Item.RemoveItem(context, itemKey);
				}
				lifeRecordCollection.AddLoseOverloadingItem(this._id, currDate, this._location, itemKey.ItemType, itemKey.TemplateId);
				bool flag2 = !addSecretInformation && ItemTemplateHelper.GetGrade(itemKey.ItemType, itemKey.TemplateId) >= 6;
				if (flag2)
				{
					addSecretInformation = true;
					bool flag3 = !secretInfoParamItemKey.IsValid() || ItemTemplateHelper.GetBaseValue(secretInfoParamItemKey.ItemType, secretInfoParamItemKey.TemplateId) < ItemTemplateHelper.GetBaseValue(itemKey.ItemType, itemKey.TemplateId);
					if (flag3)
					{
						secretInfoParamItemKey = itemKey;
					}
				}
				i++;
			}
			bool flag4 = addSecretInformation;
			if (flag4)
			{
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddLoseOverloadingItem(this._id, (ulong)secretInfoParamItemKey, this._location);
				DomainManager.Information.AddSecretInformationMetaDataWithNecessity(context, secretInfoOffset, true, false, delegate(ICollection<int> charIds)
				{
					foreach (int charId in charIds)
					{
						Character character = DomainManager.Character.GetElement_Objects(charId);
						Location location = character.GetLocation();
						GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(24, location);
						character.AddPersonalNeed(context, personalNeed);
					}
				});
			}
			bool flag5 = this._id == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag5)
			{
				MonthlyNotificationCollection monthlyNotifications = DomainManager.World.GetMonthlyNotificationCollection();
				int j = 0;
				int count2 = Math.Min(100, itemsToBeLost.Count);
				while (j < count2)
				{
					ItemKey itemKey2 = itemsToBeLost[j].Item2;
					monthlyNotifications.AddLoseItemCausedByInventoryFull(this._id, itemKey2.ItemType, itemKey2.TemplateId);
					j++;
				}
			}
		}

		// Token: 0x06006D83 RID: 28035 RVA: 0x003D78F0 File Offset: 0x003D5AF0
		public void PeriAdvanceMonth_SelfImprovement(DataContext context)
		{
			bool flag = this.GetAgeGroup() == 0;
			if (!flag)
			{
				PeriAdvanceMonthSelfImprovementModification mod = new PeriAdvanceMonthSelfImprovementModification(this);
				sbyte maxConsummateLevel = this.GetMaxConsummateLevel();
				bool flag2 = this._consummateLevel < maxConsummateLevel;
				if (flag2)
				{
					int progress = DomainManager.Extra.GetCharacterConsummateLevelProgress(this._id);
					progress += GlobalConfig.Instance.ConsummateLevelProgressSpeed[(int)this._organizationInfo.Grade];
					do
					{
						int threshold = GlobalConfig.Instance.ConsummateLevelProgressThreshold[(int)this._consummateLevel];
						bool flag3 = progress >= threshold;
						if (!flag3)
						{
							break;
						}
						this._consummateLevel += 1;
						progress -= threshold;
					}
					while (this._consummateLevel < maxConsummateLevel);
					mod.ConsummateLevelChanged = true;
					mod.ConsummateLevelProgress = progress;
				}
				bool flag4 = this._loopingNeigong >= 0;
				if (flag4)
				{
					CombatSkillItem skillCfg = Config.CombatSkill.Instance[this._loopingNeigong];
					ValueTuple<short, short, int[]> valueTuple = CombatSkillDomain.CalcNeigongLoopingEffect(context.Random, this, skillCfg, true);
					short neili = valueTuple.Item1;
					short qiDisorder = valueTuple.Item2;
					int[] extraNeiliAllocationProgress = valueTuple.Item3;
					mod.LoopingNeigong = new ValueTuple<short, short, short>(this._loopingNeigong, neili, qiDisorder);
					mod.ExtraNeiliAllocationProgress = extraNeiliAllocationProgress;
				}
				short expectedNeili = this.CalcExpectedNeili();
				bool flag5 = this._extraNeili < (int)expectedNeili;
				if (flag5)
				{
					this._extraNeili = (int)expectedNeili;
					mod.ExtraNeiliChanged = true;
				}
				bool flag6 = context.Random.CheckPercentProb((int)(50 + this.GetPersonality(2)));
				if (flag6)
				{
					ValueTuple<GameData.Domains.Item.SkillBook, int, byte> readingInfo = context.Equipping.GetCurrReadingBook(this);
					bool flag7 = readingInfo.Item1 != null;
					if (flag7)
					{
						this.OfflineUpdateReadingProgress(context, mod, readingInfo.Item1, readingInfo.Item2, readingInfo.Item3);
					}
				}
				bool isChanged = mod.IsChanged;
				if (isChanged)
				{
					ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
					recorder.RecordType(ParallelModificationType.PeriAdvanceMonthSelfImprovement);
					recorder.RecordParameterClass<PeriAdvanceMonthSelfImprovementModification>(mod);
				}
			}
		}

		// Token: 0x06006D84 RID: 28036 RVA: 0x003D7AD0 File Offset: 0x003D5CD0
		public void PeriAdvanceMonth_SelfImprovement_Taiwu(DataContext context)
		{
			PeriAdvanceMonthSelfImprovementModification mod = new PeriAdvanceMonthSelfImprovementModification(this);
			short neili;
			short qiDisorder;
			int[] extraNeiliAllocationProgress;
			bool flag = this.GenerateNeigongLoopingImprovementForTaiwu(context, out neili, out qiDisorder, out extraNeiliAllocationProgress);
			if (flag)
			{
				mod.LoopingNeigong = new ValueTuple<short, short, short>(this._loopingNeigong, neili, qiDisorder);
				mod.ExtraNeiliAllocationProgress = extraNeiliAllocationProgress;
			}
			bool isChanged = mod.IsChanged;
			if (isChanged)
			{
				ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
				recorder.RecordType(ParallelModificationType.PeriAdvanceMonthSelfImprovement);
				recorder.RecordParameterClass<PeriAdvanceMonthSelfImprovementModification>(mod);
			}
		}

		// Token: 0x06006D85 RID: 28037 RVA: 0x003D7B40 File Offset: 0x003D5D40
		public bool GenerateNeigongLoopingImprovementForTaiwu(DataContext context, out short neili, out short qiDisorder, out int[] extraNeiliAllocationProgress)
		{
			bool flag = this._loopingNeigong >= 0;
			bool result;
			if (flag)
			{
				CombatSkillItem skillCfg = Config.CombatSkill.Instance[this._loopingNeigong];
				ValueTuple<short, short, int[]> valueTuple = CombatSkillDomain.CalcNeigongLoopingEffect(context.Random, this, skillCfg, true);
				neili = valueTuple.Item1;
				qiDisorder = valueTuple.Item2;
				extraNeiliAllocationProgress = valueTuple.Item3;
				byte loopingDifficulty = DomainManager.Extra.GetLoopingDifficulty();
				short factor = WorldCreation.Instance[10].InfluenceFactors[(int)loopingDifficulty];
				neili = neili * factor / 100;
				result = true;
			}
			else
			{
				neili = 0;
				qiDisorder = 0;
				extraNeiliAllocationProgress = null;
				result = false;
			}
			return result;
		}

		// Token: 0x06006D86 RID: 28038 RVA: 0x003D7BDC File Offset: 0x003D5DDC
		private short CalcExpectedNeili()
		{
			int expectedNeili = this._extraNeili;
			sbyte grade = this._organizationInfo.Grade;
			while (grade >= 0)
			{
				OrganizationInfo orgInfo = this._organizationInfo;
				orgInfo.Grade = grade;
				OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(orgInfo);
				bool flag = orgMemberCfg.ConsummateLevel > this._consummateLevel;
				if (flag)
				{
					grade -= 1;
				}
				else
				{
					bool flag2 = orgMemberCfg.ConsummateLevel == this._consummateLevel || grade == this._organizationInfo.Grade;
					if (flag2)
					{
						expectedNeili = (int)orgMemberCfg.Neili;
						break;
					}
					orgInfo.Grade += 1;
					OrganizationMemberItem prevLevelOrgMemberCfg = OrganizationDomain.GetOrgMemberConfig(orgInfo);
					expectedNeili = (int)((short)this._consummateLevel * (orgMemberCfg.Neili + prevLevelOrgMemberCfg.Neili) / (short)(orgMemberCfg.ConsummateLevel + prevLevelOrgMemberCfg.ConsummateLevel));
					break;
				}
			}
			return (short)expectedNeili;
		}

		// Token: 0x06006D87 RID: 28039 RVA: 0x003D7CB8 File Offset: 0x003D5EB8
		public static void ComplementPeriAdvanceMonth_SelfImprovement(DataContext context, PeriAdvanceMonthSelfImprovementModification mod)
		{
			Character character = mod.Character;
			bool flag = mod.LoopingNeigong.Item1 >= 0;
			if (flag)
			{
				DomainManager.CombatSkill.ApplyNeigongLoopingEffect(context, character, mod.LoopingNeigong.Item1, mod.LoopingNeigong.Item2, mod.ExtraNeiliAllocationProgress);
				bool flag2 = mod.LoopingNeigong.Item3 != 0;
				if (flag2)
				{
					character.ChangeDisorderOfQiRandomRecovery(context, (int)mod.LoopingNeigong.Item3);
				}
			}
			bool resourcesChanged = mod.ResourcesChanged;
			if (resourcesChanged)
			{
				character.SetResources(character.GetResources(), context);
			}
			bool consummateLevelChanged = mod.ConsummateLevelChanged;
			if (consummateLevelChanged)
			{
				character.SetConsummateLevel(character._consummateLevel, context);
				DomainManager.Extra.SetCharacterConsummateLevelProgress(context, character._id, mod.ConsummateLevelProgress);
			}
			bool extraNeiliChanged = mod.ExtraNeiliChanged;
			if (extraNeiliChanged)
			{
				character.SetExtraNeili(character.GetExtraNeili(), context);
			}
			bool flag3 = mod.ReadingResult.Item1 != null;
			if (flag3)
			{
				character.ApplyBookReadingResult(context, mod.ReadingResult.Item1, mod.ReadingResult.Item2, mod.ReadingResult.Item3, mod.ReadingResult.Item4);
			}
		}

		// Token: 0x06006D88 RID: 28040 RVA: 0x003D7DE0 File Offset: 0x003D5FE0
		public unsafe void PeriAdvanceMonth_SelfImprovement_LearnNewSkills(DataContext context)
		{
			bool flag = this.GetAgeGroup() == 0;
			if (!flag)
			{
				OrganizationItem orgCfg = Organization.Instance[this._organizationInfo.OrgTemplateId];
				bool flag2 = !orgCfg.IsSect && orgCfg.TemplateId != 16;
				if (!flag2)
				{
					sbyte cleverness = *(ref this.GetPersonalities().Items.FixedElementField + 1);
					ValueTuple<short, short, byte> combatSkillToLearn = this.GetCombatSkillToLearn();
					bool flag3 = combatSkillToLearn.Item1 >= 0;
					if (flag3)
					{
						CombatSkillShorts combatSkillAttainments = *this.GetCombatSkillAttainments();
						CombatSkillShorts combatSkillQualifications = *this.GetCombatSkillQualifications();
						CombatSkillItem combatSkillCfg = Config.CombatSkill.Instance[combatSkillToLearn.Item1];
						int successRate = Character.GetTaughtNewSkillSuccessRate(combatSkillCfg.Grade, *(ref combatSkillQualifications.Items.FixedElementField + (IntPtr)combatSkillCfg.Type * 2), *(ref combatSkillAttainments.Items.FixedElementField + (IntPtr)combatSkillCfg.Type * 2), cleverness);
						bool flag4 = !context.Random.CheckPercentProb(2 * successRate);
						if (flag4)
						{
							combatSkillToLearn.Item1 = -1;
						}
					}
					bool flag5 = combatSkillToLearn.Item2 >= 0;
					if (flag5)
					{
						CombatSkillShorts combatSkillAttainments2 = *this.GetCombatSkillAttainments();
						CombatSkillItem combatSkillCfg2 = Config.CombatSkill.Instance[combatSkillToLearn.Item2];
						int successRate2 = Character.GetReadingSuccessRate(combatSkillCfg2.Grade, 0, *(ref combatSkillAttainments2.Items.FixedElementField + (IntPtr)combatSkillCfg2.Type * 2), cleverness);
						bool flag6 = !context.Random.CheckPercentProb(successRate2);
						if (flag6)
						{
							combatSkillToLearn.Item2 = -1;
						}
					}
					ValueTuple<short, short, byte> lifeSkillToLearn = this.GetLifeSkillToLearn();
					bool flag7 = lifeSkillToLearn.Item1 >= 0;
					if (flag7)
					{
						LifeSkillShorts lifeSkillAttainments = *this.GetLifeSkillAttainments();
						LifeSkillShorts lifeSkillQualifications = *this.GetLifeSkillQualifications();
						LifeSkillItem lifeSkillCfg = LifeSkill.Instance[lifeSkillToLearn.Item1];
						int successRate3 = Character.GetTaughtNewSkillSuccessRate(lifeSkillCfg.Grade, *(ref lifeSkillQualifications.Items.FixedElementField + (IntPtr)lifeSkillCfg.Type * 2), *(ref lifeSkillAttainments.Items.FixedElementField + (IntPtr)lifeSkillCfg.Type * 2), cleverness);
						bool flag8 = !context.Random.CheckPercentProb(2 * successRate3);
						if (flag8)
						{
							lifeSkillToLearn.Item1 = -1;
						}
					}
					bool flag9 = lifeSkillToLearn.Item2 >= 0;
					if (flag9)
					{
						short newPageSkillTemplateId = this._learnedLifeSkills[(int)lifeSkillToLearn.Item2].SkillTemplateId;
						LifeSkillShorts lifeSkillAttainments2 = *this.GetLifeSkillAttainments();
						LifeSkillItem lifeSkillCfg2 = LifeSkill.Instance[newPageSkillTemplateId];
						int successRate4 = Character.GetReadingSuccessRate(lifeSkillCfg2.Grade, 0, *(ref lifeSkillAttainments2.Items.FixedElementField + (IntPtr)lifeSkillCfg2.Type * 2), cleverness);
						bool flag10 = !context.Random.CheckPercentProb(successRate4);
						if (flag10)
						{
							lifeSkillToLearn.Item2 = -1;
						}
					}
					bool flag11 = combatSkillToLearn.Item1 >= 0 || combatSkillToLearn.Item2 >= 0 || lifeSkillToLearn.Item1 >= 0 || lifeSkillToLearn.Item2 >= 0;
					if (flag11)
					{
						ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
						recorder.RecordType(ParallelModificationType.PeriAdvanceMonthSelfImprovementLearnNewSkills);
						recorder.RecordParameterClass<Character>(this);
						recorder.RecordParameterUnmanaged<ValueTuple<short, short, byte>>(combatSkillToLearn);
						recorder.RecordParameterUnmanaged<ValueTuple<short, short, byte>>(lifeSkillToLearn);
					}
				}
			}
		}

		// Token: 0x06006D89 RID: 28041 RVA: 0x003D8114 File Offset: 0x003D6314
		public static void ComplementPeriAdvanceMonth_SelfImprovement_LearnNewSkills(DataContext context, Character character, [TupleElementNames(new string[]
		{
			"newSkillTemplateId",
			"newPageSkillTemplateId",
			"pageId"
		})] ValueTuple<short, short, byte> combatSkillToLearn, [TupleElementNames(new string[]
		{
			"newSkillTemplateId",
			"newPageSkillIndex",
			"pageId"
		})] ValueTuple<short, short, byte> lifeSkillToLearn)
		{
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			bool flag = combatSkillToLearn.Item1 >= 0;
			if (flag)
			{
				lifeRecordCollection.AddLearnCombatSkill(character._id, currDate, character.GetLocation(), combatSkillToLearn.Item1);
				character.LearnNewCombatSkill(context, combatSkillToLearn.Item1, 0);
				character.CreateInventoryItem(context, 10, Config.CombatSkill.Instance[combatSkillToLearn.Item1].BookId, 1);
			}
			bool flag2 = combatSkillToLearn.Item2 >= 0;
			if (flag2)
			{
				GameData.Domains.CombatSkill.CombatSkill combatSkill = DomainManager.CombatSkill.GetElement_CombatSkills(new CombatSkillKey(character._id, combatSkillToLearn.Item2));
				sbyte direction = CombatSkillDirection.GetRandomDirection(context.Random);
				byte internalIndex = CombatSkillStateHelper.GetNormalPageInternalIndex(direction, combatSkillToLearn.Item3);
				ushort readingState = CombatSkillStateHelper.SetPageRead(combatSkill.GetReadingState(), internalIndex);
				combatSkill.SetReadingState(readingState, context);
				DomainManager.CombatSkill.TryActivateCombatSkillBookPageWhenSetReadingState(context, character.GetId(), combatSkill.GetId().SkillTemplateId, internalIndex);
			}
			bool flag3 = lifeSkillToLearn.Item1 >= 0;
			if (flag3)
			{
				lifeRecordCollection.AddLearnLifeSkill(character._id, currDate, character.GetLocation(), lifeSkillToLearn.Item1);
				character.LearnNewLifeSkill(context, lifeSkillToLearn.Item1, 1);
				character.CreateInventoryItem(context, 10, LifeSkill.Instance[lifeSkillToLearn.Item1].SkillBookId, 1);
			}
			bool flag4 = lifeSkillToLearn.Item2 >= 0;
			if (flag4)
			{
				character.ReadLifeSkillPage(context, (int)lifeSkillToLearn.Item2, lifeSkillToLearn.Item3);
			}
		}

		// Token: 0x06006D8A RID: 28042 RVA: 0x003D82A0 File Offset: 0x003D64A0
		[return: TupleElementNames(new string[]
		{
			"newSkillTemplateId",
			"newPageSkillIndex",
			"pageId"
		})]
		private ValueTuple<short, short, byte> GetLifeSkillToLearn()
		{
			OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
			bool flag = this._organizationInfo.OrgTemplateId == 16;
			if (flag)
			{
				bool flag2 = !DomainManager.Taiwu.GetVillagerLearnLifeSkillsFromSect();
				if (flag2)
				{
					return new ValueTuple<short, short, byte>(-1, -1, 0);
				}
				Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
				sbyte stateTemplateId = DomainManager.Map.GetStateTemplateIdByAreaId(taiwuVillageLocation.AreaId);
				MapStateItem stateCfg = MapState.Instance[stateTemplateId];
				orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(stateCfg.SectID, 6);
			}
			short newSkillTemplateId = -1;
			short newPageSkillIndex = -1;
			byte pageId = 0;
			sbyte lifeSkillType = 0;
			while ((int)lifeSkillType < orgMemberCfg.LifeSkillsAdjust.Length)
			{
				short adjust = orgMemberCfg.LifeSkillsAdjust[(int)lifeSkillType];
				bool flag3 = adjust <= 0;
				if (!flag3)
				{
					for (int i = 0; i <= (int)orgMemberCfg.LifeSkillGradeLimit; i++)
					{
						short lifeSkillTemplateId = LifeSkillType.Instance[lifeSkillType].SkillList[i];
						int index = this.FindLearnedLifeSkillIndex(lifeSkillTemplateId);
						bool flag4 = index < 0;
						if (flag4)
						{
							bool flag5 = newSkillTemplateId < 0;
							if (flag5)
							{
								newSkillTemplateId = lifeSkillTemplateId;
							}
						}
						else
						{
							bool flag6 = newPageSkillIndex < 0;
							if (flag6)
							{
								LifeSkillItem learnedLifeSkill = this._learnedLifeSkills[index];
								bool flag7 = !learnedLifeSkill.IsAllPagesRead();
								if (flag7)
								{
									newPageSkillIndex = (short)index;
									for (pageId = 0; pageId < 5; pageId += 1)
									{
										bool flag8 = !learnedLifeSkill.IsPageRead(pageId);
										if (flag8)
										{
											break;
										}
									}
								}
							}
						}
						bool flag9 = newSkillTemplateId >= 0 && newPageSkillIndex >= 0;
						if (flag9)
						{
							return new ValueTuple<short, short, byte>(newSkillTemplateId, newPageSkillIndex, pageId);
						}
					}
				}
				lifeSkillType += 1;
			}
			return new ValueTuple<short, short, byte>(newSkillTemplateId, newPageSkillIndex, pageId);
		}

		// Token: 0x06006D8B RID: 28043 RVA: 0x003D8460 File Offset: 0x003D6660
		[return: TupleElementNames(new string[]
		{
			"newSkillTemplateId",
			"newPageSkillTemplateId",
			"pageId"
		})]
		private ValueTuple<short, short, byte> GetCombatSkillToLearn()
		{
			OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
			bool flag = this._organizationInfo.OrgTemplateId == 16;
			if (flag)
			{
				bool flag2 = !DomainManager.Taiwu.GetVillagerLearnCombatSkillsFromSect();
				if (flag2)
				{
					return new ValueTuple<short, short, byte>(-1, -1, 0);
				}
				Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
				sbyte stateTemplateId = DomainManager.Map.GetStateTemplateIdByAreaId(taiwuVillageLocation.AreaId);
				MapStateItem stateCfg = MapState.Instance[stateTemplateId];
				orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(stateCfg.SectID, 6);
			}
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> learnedCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(this._id);
			short newSkillTemplateId = -1;
			short newPageSkillTemplateId = -1;
			byte pageId = 0;
			foreach (PresetOrgMemberCombatSkill presetCombatSkill in orgMemberCfg.CombatSkills)
			{
				CombatSkillItem presetSkillCfg = Config.CombatSkill.Instance[presetCombatSkill.SkillGroupId];
				IReadOnlyList<CombatSkillItem> group = CombatSkillDomain.GetLearnableCombatSkills(presetSkillCfg.SectId, presetSkillCfg.Type);
				int maxGrade = Math.Min((int)presetCombatSkill.MaxGrade, group.Count - 1);
				for (int skillGrade = 0; skillGrade <= maxGrade; skillGrade++)
				{
					short skillTemplateId = group[skillGrade].TemplateId;
					GameData.Domains.CombatSkill.CombatSkill combatSkill;
					bool flag3 = !learnedCombatSkills.TryGetValue(skillTemplateId, out combatSkill);
					if (flag3)
					{
						bool flag4 = newSkillTemplateId < 0;
						if (flag4)
						{
							newSkillTemplateId = skillTemplateId;
						}
					}
					else
					{
						bool flag5 = newPageSkillTemplateId < 0;
						if (flag5)
						{
							ushort readingState = combatSkill.GetReadingState();
							byte nextUnreadPage = CombatSkillStateHelper.GetNextPageToRead(readingState);
							bool flag6 = nextUnreadPage < 15 && !combatSkill.GetRevoked();
							if (flag6)
							{
								newPageSkillTemplateId = combatSkill.GetId().SkillTemplateId;
								pageId = nextUnreadPage;
							}
						}
					}
					bool flag7 = newSkillTemplateId >= 0 && newPageSkillTemplateId >= 0;
					if (flag7)
					{
						return new ValueTuple<short, short, byte>(newSkillTemplateId, newPageSkillTemplateId, pageId);
					}
				}
			}
			return new ValueTuple<short, short, byte>(newSkillTemplateId, newPageSkillTemplateId, pageId);
		}

		// Token: 0x06006D8C RID: 28044 RVA: 0x003D866C File Offset: 0x003D686C
		public void PeriAdvanceMonth_ActivePreparation_GetSupply(DataContext context)
		{
			sbyte ageGroup = this.GetAgeGroup();
			bool flag = ageGroup == 0;
			if (!flag)
			{
				PeriAdvanceMonthGetSupplyModification mod = new PeriAdvanceMonthGetSupplyModification(this);
				OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
				context.AdvanceMonthRelatedData.SummarizeItemSubTypeStats(this._inventory.Items, this._equipment);
				mod.ResourceChanged = this.OfflineGetResourcesSupply(orgMemberCfg);
				bool flag2 = this._location.IsValid() && this._location.AreaId != 138;
				if (flag2)
				{
					this.OfflineGetBookSupply(context, mod);
					bool flag3 = this._organizationInfo.OrgTemplateId == 16;
					if (flag3)
					{
						Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
						sbyte stateTemplateId = DomainManager.Map.GetStateTemplateIdByAreaId(taiwuVillageLocation.AreaId);
						MapStateItem stateCfg = MapState.Instance[stateTemplateId];
						OrganizationMemberItem sectOrgMemberCfg = OrganizationDomain.GetOrgMemberConfig(stateCfg.SectID, 6);
						bool villagerLearnLifeSkillsFromSect = DomainManager.Taiwu.GetVillagerLearnLifeSkillsFromSect();
						if (villagerLearnLifeSkillsFromSect)
						{
							this.OfflineGetItemSupply(context, mod, sectOrgMemberCfg.ItemSatisfyingThreshold, sectOrgMemberCfg.Inventory);
						}
						bool villagerLearnCombatSkillsFromSect = DomainManager.Taiwu.GetVillagerLearnCombatSkillsFromSect();
						if (villagerLearnCombatSkillsFromSect)
						{
							this.OfflineGetEquipmentSupply(context, mod, sectOrgMemberCfg.Equipment);
						}
					}
					else
					{
						this.OfflineGetItemSupply(context, mod, orgMemberCfg.ItemSatisfyingThreshold, orgMemberCfg.Inventory);
						this.OfflineGetEquipmentSupply(context, mod, orgMemberCfg.Equipment);
					}
				}
				bool flag4 = ageGroup == 2;
				if (flag4)
				{
					this.OfflineGetClothingSupply(context, mod, orgMemberCfg.Clothing.TemplateId);
				}
				context.AdvanceMonthRelatedData.ReleaseItemSubTypeStats();
				bool isChanged = mod.IsChanged;
				if (isChanged)
				{
					ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
					recorder.RecordType(ParallelModificationType.PeriAdvanceMonthActivePreparationGetSupply);
					recorder.RecordParameterClass<PeriAdvanceMonthGetSupplyModification>(mod);
				}
			}
		}

		// Token: 0x06006D8D RID: 28045 RVA: 0x003D881C File Offset: 0x003D6A1C
		public static void ComplementPeriAdvanceMonth_ActivePreparation_GetSupply(DataContext context, PeriAdvanceMonthGetSupplyModification mod)
		{
			Character character = mod.Character;
			List<ValueTuple<sbyte, short, int>> itemsToCreate = mod.ItemsToCreate;
			bool flag = itemsToCreate != null && itemsToCreate.Count > 0;
			if (flag)
			{
				foreach (ValueTuple<sbyte, short, int> itemInfo in mod.ItemsToCreate)
				{
					character.OfflineCreateInventoryItem(context, itemInfo.Item1, itemInfo.Item2, itemInfo.Item3);
				}
				character.SetInventory(character.GetInventory(), context);
			}
			bool resourceChanged = mod.ResourceChanged;
			if (resourceChanged)
			{
				character.SetResources(ref character._resources, context);
			}
			bool personalNeedChanged = mod.PersonalNeedChanged;
			if (personalNeedChanged)
			{
				character.SetPersonalNeeds(character._personalNeeds, context);
			}
		}

		// Token: 0x06006D8E RID: 28046 RVA: 0x003D88F0 File Offset: 0x003D6AF0
		public void PeriAdvanceMonth_ActivePreparation(DataContext context)
		{
			bool flag = this.GetAgeGroup() == 0;
			if (!flag)
			{
				PeriAdvanceMonthActivePreparationModification mod = new PeriAdvanceMonthActivePreparationModification(this);
				this.OfflineRepairEquipments(context, mod);
				this.OfflineFeedAnimalCarrier(context.Random, mod);
				bool outOfTaiwuGroup = !DomainManager.Taiwu.IsInGroup(this._id);
				bool flag2 = outOfTaiwuGroup || !DomainManager.Character.IsCombatSkillAttainmentLocked(this._id);
				if (flag2)
				{
					context.Equipping.ParallelSetInitialCombatSkillAttainmentPanels(context, this, true);
				}
				SelectEquipmentsModification selectEquipmentMod = context.Equipping.ParallelSelectEquipments(context, this, outOfTaiwuGroup, false, true);
				this.OfflineAddPoisonToEquipments(context, mod, selectEquipmentMod.EquippedItems);
				bool isChanged = mod.IsChanged;
				if (isChanged)
				{
					ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
					recorder.RecordType(ParallelModificationType.PeriAdvanceMonthActivePreparation);
					recorder.RecordParameterClass<PeriAdvanceMonthActivePreparationModification>(mod);
				}
			}
		}

		// Token: 0x06006D8F RID: 28047 RVA: 0x003D89BC File Offset: 0x003D6BBC
		public static void ComplementPeriAdvanceMonth_ActivePreparation(DataContext context, PeriAdvanceMonthActivePreparationModification mod)
		{
			Character character = mod.Character;
			int charId = character.GetId();
			Location location = character.GetLocation();
			bool flag = !location.IsValid();
			if (flag)
			{
				location = character.GetValidLocation();
			}
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			bool resourcesChanged = mod.ResourcesChanged;
			if (resourcesChanged)
			{
				character.SetResources(ref character._resources, context);
			}
			bool flag2 = mod.ItemsFixed != null;
			if (flag2)
			{
				foreach (ItemBase item in mod.ItemsFixed)
				{
					item.SetCurrDurability(item.GetCurrDurability(), context);
					lifeRecordCollection.AddRepairItem(charId, currDate, location, item.GetItemType(), item.GetTemplateId());
				}
			}
			bool flag3 = mod.CraftToolsUsed != null;
			if (flag3)
			{
				foreach (int itemId in mod.CraftToolsUsed)
				{
					GameData.Domains.Item.CraftTool craftTool = DomainManager.Item.GetElement_CraftTools(itemId);
					craftTool.SetCurrDurability(craftTool.GetCurrDurability(), context);
				}
			}
			bool personalNeedChanged = mod.PersonalNeedChanged;
			if (personalNeedChanged)
			{
				character.SetPersonalNeeds(character._personalNeeds, context);
			}
			bool flag4 = mod.FeedingCarrierKey.IsValid() && mod.FeedingFoodKey.IsValid();
			if (flag4)
			{
				DomainManager.Extra.FeedCarrier(context, character, mod.FeedingCarrierKey, mod.FeedingFoodKey, 1);
				lifeRecordCollection.AddFeedTheAnimal(charId, currDate, mod.FeedingFoodKey.ItemType, mod.FeedingFoodKey.TemplateId, mod.FeedingCarrierKey.ItemType, mod.FeedingCarrierKey.TemplateId);
			}
			bool flag5 = mod.PoisonsToUse != null && mod.EquipmentSlotToAddPoison >= 0;
			if (flag5)
			{
				ItemKey equipmentKey = character._equipment[(int)mod.EquipmentSlotToAddPoison];
				bool flag6 = !equipmentKey.IsValid();
				if (flag6)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(20, 1);
					defaultInterpolatedStringHandler.AppendLiteral("ActivePreparation (");
					defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
					defaultInterpolatedStringHandler.AppendLiteral(")");
					string tag = defaultInterpolatedStringHandler.ToStringAndClear();
					defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(50, 2);
					defaultInterpolatedStringHandler.AppendLiteral("Invalid item ");
					defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(equipmentKey);
					defaultInterpolatedStringHandler.AppendLiteral(" at slot ");
					defaultInterpolatedStringHandler.AppendFormatted<sbyte>(mod.EquipmentSlotToAddPoison);
					defaultInterpolatedStringHandler.AppendLiteral(" selected for adding poison.");
					AdaptableLog.TagWarning(tag, defaultInterpolatedStringHandler.ToStringAndClear(), false);
				}
				else
				{
					ItemKey newItemKey = character.ApplyAddPoisonsToItem(context, equipmentKey, mod.PoisonsToUse);
					bool flag7 = equipmentKey != newItemKey;
					if (flag7)
					{
						character._equipment[(int)mod.EquipmentSlotToAddPoison] = newItemKey;
						character.SetEquipment(character._equipment, context);
					}
				}
			}
		}

		// Token: 0x06006D90 RID: 28048 RVA: 0x003D8CB8 File Offset: 0x003D6EB8
		private ItemKey ApplyAddPoisonsToItem(DataContext context, ItemKey itemKey, ItemKey[] poisonKeys)
		{
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			Location location = this.GetValidLocation();
			ItemBase itemObj = DomainManager.Item.GetBaseItem(itemKey);
			bool flag = poisonKeys.Length == 3 && poisonKeys[0].TemplateEquals(poisonKeys[1]) && poisonKeys[0].TemplateEquals(poisonKeys[2]);
			if (flag)
			{
				ItemBase newItemObj = DomainManager.Item.SetAttachedPoisons(context, itemObj, poisonKeys[0].TemplateId, true, new short[]
				{
					poisonKeys[1].TemplateId,
					poisonKeys[1].TemplateId
				}).Item1;
				itemObj = newItemObj;
				lifeRecordCollection.AddEnvenomedItemOverload(this._id, currDate, location, poisonKeys[0].ItemType, poisonKeys[0].TemplateId, poisonKeys[1].ItemType, poisonKeys[1].TemplateId, poisonKeys[2].ItemType, poisonKeys[2].TemplateId, itemKey.ItemType, itemKey.TemplateId);
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddAddPoisonToItem(this._id, (ulong)newItemObj.GetItemKey(), (ulong)poisonKeys[0]);
				DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
			}
			else
			{
				foreach (ItemKey poisonItemKey in poisonKeys)
				{
					bool flag2 = !poisonItemKey.IsValid() || !this._inventory.Items.ContainsKey(poisonItemKey);
					if (!flag2)
					{
						MedicineItem poisonConfig = Config.Medicine.Instance[poisonItemKey.TemplateId];
						Tester.Assert(poisonConfig.EffectType == EMedicineEffectType.ApplyPoison, "");
						ItemBase newItemObj2 = DomainManager.Item.SetAttachedPoisons(context, itemObj, poisonItemKey.TemplateId, true, null).Item1;
						itemObj = newItemObj2;
						lifeRecordCollection.AddAddPoisonToItem(this._id, currDate, location, poisonItemKey.ItemType, poisonItemKey.TemplateId, itemKey.ItemType, itemKey.TemplateId);
						SecretInformationCollection secretInformationCollection2 = DomainManager.Information.GetSecretInformationCollection();
						int secretInfoOffset2 = secretInformationCollection2.AddAddPoisonToItem(this._id, (ulong)newItemObj2.GetItemKey(), (ulong)poisonItemKey);
						DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset2, true);
					}
				}
			}
			foreach (ItemKey poisonItemKey2 in poisonKeys)
			{
				this.RemoveInventoryItem(context, poisonItemKey2, 1, true, false);
			}
			return itemObj.GetItemKey();
		}

		// Token: 0x06006D91 RID: 28049 RVA: 0x003D8F5C File Offset: 0x003D715C
		public unsafe void PeriAdvanceMonth_PassivePreparation(DataContext context)
		{
			PeriAdvanceMonthPassivePreparationModification mod = new PeriAdvanceMonthPassivePreparationModification(this);
			bool flag = DomainManager.World.GetCurrMonthInYear() == (sbyte)(GlobalConfig.Instance.CricketActiveStartMonth + 1) && DomainManager.Item.HasNewDeadCricket();
			if (flag)
			{
				foreach (ItemKey itemKey in this._inventory.Items.Keys)
				{
					bool flag2 = itemKey.ItemType != 11 || !DomainManager.Item.IsNewDeadCricket(itemKey);
					if (!flag2)
					{
						GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(10, 11, itemKey.TemplateId);
						this.OfflineAddPersonalNeed(need);
						mod.PersonalNeedsChanged = true;
					}
				}
			}
			OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
			for (sbyte type = 0; type < 7; type += 1)
			{
				int oriAmount = *(ref this._resources.Items.FixedElementField + (IntPtr)type * 4);
				int amountThreshold = orgMemberCfg.GetAdjustedResourceSatisfyingAmount(type);
				bool flag3 = oriAmount <= amountThreshold;
				if (!flag3)
				{
					GameData.Domains.Character.Ai.PersonalNeed need2 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(9, type, orgMemberCfg.ResourceSatisfyingThreshold);
					this.OfflineAddPersonalNeed(need2);
					mod.PersonalNeedsChanged = true;
				}
			}
			int happinessChange = this.OfflineLoseOverloadedItems(context, mod);
			this._happiness = (sbyte)Math.Clamp((int)this._happiness + happinessChange, -119, 119);
			int inventoryTotalValue = this.GetInventoryTotalValue();
			bool flag4 = inventoryTotalValue > orgMemberCfg.ItemSatisfyingThreshold;
			if (flag4)
			{
				GameData.Domains.Character.Ai.PersonalNeed need3 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(13, orgMemberCfg.ItemSatisfyingThreshold);
				this.OfflineAddPersonalNeed(need3);
				mod.PersonalNeedsChanged = true;
			}
			ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
			recorder.RecordType(ParallelModificationType.PeriAdvanceMonthPassivePreparation);
			recorder.RecordParameterClass<PeriAdvanceMonthPassivePreparationModification>(mod);
		}

		// Token: 0x06006D92 RID: 28050 RVA: 0x003D9124 File Offset: 0x003D7324
		public void PeriAdvanceMonth_GearMateLoseOverLoadedItems(DataContext context)
		{
			int overloadedWeight = this.GetCurrInventoryLoad() - this.GetMaxInventoryLoad();
			bool flag = overloadedWeight <= 0;
			if (!flag)
			{
				PeriAdvanceMonthPassivePreparationModification mod = new PeriAdvanceMonthPassivePreparationModification(this);
				this.OfflineLoseOverloadedItems(context, mod);
				ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
				recorder.RecordType(ParallelModificationType.PeriAdvanceMonthPassivePreparation);
				recorder.RecordParameterClass<PeriAdvanceMonthPassivePreparationModification>(mod);
			}
		}

		// Token: 0x06006D93 RID: 28051 RVA: 0x003D9178 File Offset: 0x003D7378
		public static void ComplementPeriAdvanceMonth_PassivePreparation(DataContext context, PeriAdvanceMonthPassivePreparationModification mod)
		{
			Character character = mod.Character;
			bool flag = mod.ItemsToBeLost != null;
			if (flag)
			{
				character.ApplyItemLost(context, mod.ItemsToBeLost);
			}
			bool personalNeedsChanged = mod.PersonalNeedsChanged;
			if (personalNeedsChanged)
			{
				character.SetPersonalNeeds(character._personalNeeds, context);
			}
		}

		// Token: 0x06006D94 RID: 28052 RVA: 0x003D91C0 File Offset: 0x003D73C0
		public static void ComplementPostAdvanceMonth_PersonalNeedsUpdate(DataContext context, Character character)
		{
			character.SetPersonalNeeds(character._personalNeeds, context);
		}

		// Token: 0x06006D95 RID: 28053 RVA: 0x003D91D4 File Offset: 0x003D73D4
		public void PeriAdvanceMonth_PersonalNeedsProcessing(DataContext context)
		{
			bool flag = this._personalNeeds.Count == 0;
			if (!flag)
			{
				for (int i = this._personalNeeds.Count - 1; i >= 0; i--)
				{
					GameData.Domains.Character.Ai.PersonalNeed need = this._personalNeeds[i];
					bool flag2 = !need.CheckValid(this);
					if (flag2)
					{
						CollectionUtils.SwapAndRemove<GameData.Domains.Character.Ai.PersonalNeed>(this._personalNeeds, i);
					}
				}
				ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
				recorder.RecordType(ParallelModificationType.PeriAdvanceMonthPersonalNeedsProcessing);
				recorder.RecordParameterClass<Character>(this);
			}
		}

		// Token: 0x06006D96 RID: 28054 RVA: 0x003D925B File Offset: 0x003D745B
		public static void ComplementPeriAdvanceMonth_PersonalNeedsProcessing(DataContext context, Character character)
		{
			character.SetPersonalNeeds(character._personalNeeds, context);
		}

		// Token: 0x06006D97 RID: 28055 RVA: 0x003D926C File Offset: 0x003D746C
		public unsafe MainAttributes GetMainAttributesRecoveries()
		{
			MainAttributes recoveries = default(MainAttributes);
			MainAttributes maxMainAttributes = this.GetMaxMainAttributes();
			short physiologicalAge = this.GetPhysiologicalAge();
			int clampedAge = (int)((physiologicalAge <= 100) ? physiologicalAge : 100);
			MainAttributes ageInfluence = AgeEffect.Instance[clampedAge].MainAttributesRecoveries;
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int preserveDay = (this._id != taiwuCharId) ? 0 : (DomainManager.Extra.GetActionPointPrevMonth() / 10);
			for (sbyte i = 0; i < 6; i += 1)
			{
				short maxValue = *(ref maxMainAttributes.Items.FixedElementField + (IntPtr)i * 2);
				int recovery = (int)(maxValue / 5 * *(ref ageInfluence.Items.FixedElementField + (IntPtr)i * 2) / 100);
				recovery = Math.Max(1, recovery * (preserveDay + 100) / 100);
				bool flag = this._id == taiwuCharId;
				if (flag)
				{
					ExtraDomain extraDomain = DomainManager.Extra;
					int professionId = ProfessionRelatedConstants.MainAttributeRecoverProfessionIds[(int)i];
					bool flag2 = extraDomain.IsProfessionalSkillUnlocked(professionId, 0);
					if (flag2)
					{
						ProfessionData professionData = extraDomain.GetProfessionData(professionId);
						recovery = professionData.GetMainAttributesRecoveryBonusAppliedRate(i, recovery);
					}
				}
				*(ref recoveries.Items.FixedElementField + (IntPtr)i * 2) = (short)recovery;
			}
			return recoveries;
		}

		// Token: 0x06006D98 RID: 28056 RVA: 0x003D93A8 File Offset: 0x003D75A8
		public short GetHealthRecovery(bool isCompletelyInfected)
		{
			short result;
			if (isCompletelyInfected)
			{
				result = short.MaxValue;
			}
			else
			{
				int delta = 0;
				delta += Character.GetHealthChangeDueToInjuries(ref this._injuries);
				delta += Character.GetHealthChangeDueToPoisons(ref this._poisoned, this.GetPoisonResists());
				delta += this.GetHealthChangeDueToDisorderOfQi(this._disorderOfQi);
				int percent = 100;
				foreach (short featureId in this._featureIds)
				{
					bool flag = CharacterFeature.Instance[featureId].HealthDelta != 0;
					if (flag)
					{
						percent = percent * (100 - CharacterFeature.Instance[featureId].HealthDelta) / 100;
					}
				}
				delta -= (int)this._maxHealth * (100 - percent) / 100;
				delta += DomainManager.Building.GetBuildingBlockEffect(this._location, EBuildingScaleEffect.HealthRecovery, -1);
				int medicineEffectValue = this._eatingItems.GetTotalMedicineEffectValue(EMedicineEffectSubType.RecoverHealthValue);
				delta += this.GetSpecialEffectModifiedMedicineEffectValue(medicineEffectValue);
				medicineEffectValue = (int)this.GetLeftMaxHealth(false) * this._eatingItems.GetTotalMedicineEffectValue(EMedicineEffectSubType.RecoverHealthPercentage) / 100;
				delta += this.GetSpecialEffectModifiedMedicineEffectValue(medicineEffectValue);
				bool flag2 = this.GetAgeGroup() == 0 && this._leaderId < 0 && this._location.IsValid();
				if (flag2)
				{
					MapBlockData blockData = DomainManager.Map.GetBlock(this._location);
					int num = delta;
					EMapBlockType blockType = blockData.BlockType;
					if (!true)
					{
					}
					int num2;
					switch (blockType)
					{
					case EMapBlockType.City:
						num2 = 6;
						break;
					case EMapBlockType.Sect:
						num2 = 6;
						break;
					case EMapBlockType.Town:
						num2 = 6;
						break;
					case EMapBlockType.Station:
						num2 = 12;
						break;
					case EMapBlockType.Developed:
						num2 = 12;
						break;
					case EMapBlockType.Normal:
						num2 = 18;
						break;
					default:
						num2 = 24;
						break;
					}
					if (!true)
					{
					}
					delta = num - num2;
				}
				delta = DomainManager.SpecialEffect.ModifyValue(this._id, 263, delta, -1, -1, -1, 0, 0, 0, 0);
				result = (short)delta;
			}
			return result;
		}

		// Token: 0x06006D99 RID: 28057 RVA: 0x003D9598 File Offset: 0x003D7798
		public unsafe static int GetHealthChangeDueToInjuries(ref Injuries injuries)
		{
			int injuryLevel = 0;
			for (int i = 0; i < 14; i++)
			{
				injuryLevel += Math.Max((int)(*(ref injuries.Items.FixedElementField + i) / 2), 0);
			}
			return -injuryLevel * 12;
		}

		// Token: 0x06006D9A RID: 28058 RVA: 0x003D95DC File Offset: 0x003D77DC
		public unsafe static int GetHealthChangeDueToPoisons(ref PoisonInts poisoned, ref PoisonInts poisonResists)
		{
			int poisonedLevel = 0;
			for (int i = 0; i < 6; i++)
			{
				poisonedLevel += (int)((*(ref poisonResists.Items.FixedElementField + (IntPtr)i * 4) >= 1000) ? 0 : PoisonsAndLevels.CalcPoisonedLevel(*(ref poisoned.Items.FixedElementField + (IntPtr)i * 4)));
			}
			return -poisonedLevel * 12;
		}

		// Token: 0x06006D9B RID: 28059 RVA: 0x003D963C File Offset: 0x003D783C
		public int GetHealthChangeDueToDisorderOfQi(short disorderOfQi)
		{
			sbyte qiDisorderEffect = DisorderLevelOfQi.GetDisorderLevelOfQiConfig(disorderOfQi).HealthRecovery;
			bool flag = qiDisorderEffect > 0 && !DomainManager.SpecialEffect.ModifyData(this._id, -1, 295, true, -1, -1, -1);
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				result = (int)qiDisorderEffect;
			}
			return result;
		}

		// Token: 0x06006D9C RID: 28060 RVA: 0x003D9688 File Offset: 0x003D7888
		public short GetChangeOfQiDisorder()
		{
			int delta = (int)(-(int)GlobalConfig.Instance.RecoveryOfQiDisorderUnitValue);
			delta -= DomainManager.Building.GetBuildingBlockEffect(this._location, EBuildingScaleEffect.QiDisorderRecovery, -1);
			int percent = 100;
			int increase = 0;
			foreach (short featureId in this._featureIds)
			{
				CharacterFeatureItem config = CharacterFeature.Instance[featureId];
				percent += (int)config.QiDisorderBuffPercent;
				bool flag = config.QiDisorderDelta > 0;
				if (flag)
				{
					increase += (int)config.QiDisorderDelta;
				}
				else
				{
					delta += (int)config.QiDisorderDelta;
				}
			}
			delta = delta * percent / 100;
			int preserveDay = (this._id != DomainManager.Taiwu.GetTaiwuCharId()) ? 0 : DomainManager.Extra.GetPreserveDay();
			int add = delta * (int)this.GetRecoveryOfQiDisorder() / 100;
			add = add * (preserveDay + 100) / 100;
			delta += add;
			for (int i = 0; i < 9; i++)
			{
				ItemKey item = this._eatingItems.Get(i);
				bool flag2 = item.IsValid() && item.ItemType == 8;
				if (flag2)
				{
					MedicineItem config2 = item.GetConfigAs<MedicineItem>();
					bool flag3 = config2.EffectType == EMedicineEffectType.ChangeDisorderOfQi;
					if (flag3)
					{
						delta += this.CalcMedicineEffectDelta_RecoverDisorderOfQi(config2.EffectValue, config2.EffectIsPercentage);
					}
				}
			}
			return (short)Math.Clamp(delta + increase, (int)(DisorderLevelOfQi.MinValue - DisorderLevelOfQi.MaxValue), (int)(DisorderLevelOfQi.MaxValue - DisorderLevelOfQi.MinValue));
		}

		// Token: 0x06006D9D RID: 28061 RVA: 0x003D9820 File Offset: 0x003D7A20
		private unsafe bool OfflineGetResourcesSupply(OrganizationMemberItem orgMemberCfg)
		{
			bool resourcesChanged = false;
			for (sbyte type = 0; type < 8; type += 1)
			{
				int satisfyingAmount = orgMemberCfg.GetAdjustedResourceSatisfyingAmount(type) * DomainManager.World.GetGainResourcePercent(8) / 100;
				int halfAmount = satisfyingAmount / 2;
				int gainAmount = satisfyingAmount / 40;
				int oriAmount = *(ref this._resources.Items.FixedElementField + (IntPtr)type * 4);
				bool flag = oriAmount >= halfAmount;
				if (!flag)
				{
					*(ref this._resources.Items.FixedElementField + (IntPtr)type * 4) += gainAmount;
					resourcesChanged = true;
				}
			}
			return resourcesChanged;
		}

		// Token: 0x06006D9E RID: 28062 RVA: 0x003D98B4 File Offset: 0x003D7AB4
		private void OfflineGetBookSupply(DataContext context, PeriAdvanceMonthGetSupplyModification mod)
		{
			HashSet<short> ownedBooks = context.AdvanceMonthRelatedData.TemplateIdSet.Occupy();
			foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
			{
				ItemKey itemKey2;
				int num;
				keyValuePair.Deconstruct(out itemKey2, out num);
				ItemKey itemKey = itemKey2;
				bool flag = itemKey.ItemType == 10;
				if (flag)
				{
					ownedBooks.Add(itemKey.TemplateId);
				}
			}
			this.OfflineGetCombatSkillBookSupply(context, ownedBooks, mod);
			this.OfflineGetLifeSkillBookSupply(context, ownedBooks, mod);
			context.AdvanceMonthRelatedData.TemplateIdSet.Release(ref ownedBooks);
		}

		// Token: 0x06006D9F RID: 28063 RVA: 0x003D9970 File Offset: 0x003D7B70
		private unsafe void OfflineGetCombatSkillBookSupply(DataContext context, HashSet<short> ownedBooks, PeriAdvanceMonthGetSupplyModification mod)
		{
			bool flag = !OrganizationDomain.IsSect(this._organizationInfo.OrgTemplateId);
			if (!flag)
			{
				List<TemplateKey> supplyBooks = context.AdvanceMonthRelatedData.ItemTemplateKeys.Occupy();
				Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> combatSkills = DomainManager.CombatSkill.GetCharCombatSkills(this._id);
				foreach (KeyValuePair<short, GameData.Domains.CombatSkill.CombatSkill> keyValuePair in combatSkills)
				{
					short num;
					GameData.Domains.CombatSkill.CombatSkill combatSkill2;
					keyValuePair.Deconstruct(out num, out combatSkill2);
					short templateId = num;
					GameData.Domains.CombatSkill.CombatSkill combatSkill = combatSkill2;
					ushort readingState = combatSkill.GetReadingState();
					bool flag2 = combatSkill.GetRevoked() || CombatSkillStateHelper.CalcPagesToBeReadForActivation(readingState) <= 0;
					if (!flag2)
					{
						CombatSkillItem config = Config.CombatSkill.Instance[templateId];
						bool flag3 = config.SectId != this._organizationInfo.OrgTemplateId || config.BookId < 0 || this._organizationInfo.Grade < config.Grade || ownedBooks.Contains(config.BookId);
						if (!flag3)
						{
							bool flag4 = context.Random.CheckPercentProb((int)(*(ref this._combatSkillQualifications.Items.FixedElementField + (IntPtr)config.Type * 2) / 5));
							if (flag4)
							{
								supplyBooks.Add(new TemplateKey(10, config.BookId));
							}
						}
					}
				}
				bool flag5 = supplyBooks.Count == 0;
				if (flag5)
				{
					context.AdvanceMonthRelatedData.ItemTemplateKeys.Release(ref supplyBooks);
				}
				else
				{
					TemplateKey selectedBook = supplyBooks.GetRandom(context.Random);
					context.AdvanceMonthRelatedData.ItemTemplateKeys.Release(ref supplyBooks);
					mod.AddItemToCreate(selectedBook.ItemType, selectedBook.TemplateId, 1);
				}
			}
		}

		// Token: 0x06006DA0 RID: 28064 RVA: 0x003D9B38 File Offset: 0x003D7D38
		private unsafe void OfflineGetLifeSkillBookSupply(DataContext context, HashSet<short> ownedBooks, PeriAdvanceMonthGetSupplyModification mod)
		{
			OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
			List<TemplateKey> supplyBooks = context.AdvanceMonthRelatedData.ItemTemplateKeys.Occupy();
			foreach (LifeSkillItem learnedLifeSkill in this._learnedLifeSkills)
			{
				bool flag = learnedLifeSkill.IsAllPagesRead();
				if (!flag)
				{
					LifeSkillItem config = LifeSkill.Instance[learnedLifeSkill.SkillTemplateId];
					short adjust = orgMemberCfg.LifeSkillsAdjust[(int)config.Type];
					bool flag2 = adjust <= 0 || orgMemberCfg.LifeSkillGradeLimit < config.Grade;
					if (!flag2)
					{
						bool flag3 = ownedBooks.Contains(config.SkillBookId) || config.SkillBookId < 0;
						if (!flag3)
						{
							bool flag4 = context.Random.CheckPercentProb((int)(*(ref this._lifeSkillQualifications.Items.FixedElementField + (IntPtr)config.Type * 2) / 5));
							if (flag4)
							{
								supplyBooks.Add(new TemplateKey(10, config.SkillBookId));
							}
						}
					}
				}
			}
			bool flag5 = supplyBooks.Count == 0;
			if (flag5)
			{
				context.AdvanceMonthRelatedData.ItemTemplateKeys.Release(ref supplyBooks);
			}
			else
			{
				TemplateKey selectedBook = supplyBooks.GetRandom(context.Random);
				context.AdvanceMonthRelatedData.ItemTemplateKeys.Release(ref supplyBooks);
				mod.AddItemToCreate(selectedBook.ItemType, selectedBook.TemplateId, 1);
			}
		}

		// Token: 0x06006DA1 RID: 28065 RVA: 0x003D9CC4 File Offset: 0x003D7EC4
		private void OfflineGetItemSupply(DataContext context, PeriAdvanceMonthGetSupplyModification mod, int satisfyingThreshold, List<PresetInventoryItem> presetInventory)
		{
			bool flag = this.GetInventoryTotalValue() > satisfyingThreshold;
			if (!flag)
			{
				Dictionary<short, ValueTuple<sbyte, int>> itemSubTypeStats = context.AdvanceMonthRelatedData.ItemSubTypeStats.Get();
				foreach (PresetInventoryItem presetItem in presetInventory)
				{
					short itemSubType = ItemTemplateHelper.GetItemSubType(presetItem.Type, presetItem.TemplateId);
					sbyte expectedItemGrade = this._organizationInfo.Grade;
					sbyte minItemGrade = (sbyte)Math.Max(0, (int)(expectedItemGrade - 3));
					ValueTuple<sbyte, int> stat;
					bool flag2 = itemSubTypeStats.TryGetValue(itemSubType, out stat) && stat.Item1 >= minItemGrade;
					if (!flag2)
					{
						bool flag3 = !context.Random.CheckPercentProb((int)(presetItem.SpawnChance / 2));
						if (!flag3)
						{
							short templateId = ItemTemplateHelper.GetTemplateIdInGroup(presetItem.Type, presetItem.TemplateId, expectedItemGrade);
							GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(10, presetItem.Type, templateId);
							mod.PersonalNeedChanged = (mod.PersonalNeedChanged || this.OfflineAddPersonalNeed(personalNeed));
							break;
						}
					}
				}
			}
		}

		// Token: 0x06006DA2 RID: 28066 RVA: 0x003D9DEC File Offset: 0x003D7FEC
		private void OfflineGetEquipmentSupply(DataContext context, PeriAdvanceMonthGetSupplyModification mod, PresetEquipmentItemWithProb[] presetEquipments)
		{
			Dictionary<short, ValueTuple<sbyte, int>> itemSubTypeStats = context.AdvanceMonthRelatedData.ItemSubTypeStats.Get();
			sbyte expectedItemGrade = this._organizationInfo.Grade;
			sbyte minItemGrade = (sbyte)Math.Max(0, (int)(expectedItemGrade - 3));
			foreach (PresetEquipmentItemWithProb presetEquipment in presetEquipments)
			{
				bool flag = presetEquipment.TemplateId < 0;
				if (!flag)
				{
					short itemSubType = ItemTemplateHelper.GetItemSubType(presetEquipment.Type, presetEquipment.TemplateId);
					ValueTuple<sbyte, int> stat;
					bool flag2 = itemSubTypeStats.TryGetValue(itemSubType, out stat) && stat.Item1 >= minItemGrade;
					if (!flag2)
					{
						bool flag3 = !context.Random.CheckPercentProb((int)(presetEquipment.Prob / 2));
						if (!flag3)
						{
							short itemTemplateId = ItemTemplateHelper.GetTemplateIdInGroup(presetEquipment.Type, presetEquipment.TemplateId, expectedItemGrade);
							GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(10, presetEquipment.Type, itemTemplateId);
							mod.PersonalNeedChanged = (mod.PersonalNeedChanged || this.OfflineAddPersonalNeed(personalNeed));
							break;
						}
					}
				}
			}
			ArraySegmentList<short> attackSkills = this.GetCombatSkillEquipment().Attack;
			foreach (short ptr in attackSkills)
			{
				short combatSkillId = ptr;
				bool flag4 = combatSkillId < 0;
				if (!flag4)
				{
					CombatSkillItem config = Config.CombatSkill.Instance[combatSkillId];
					bool flag5 = config.MostFittingWeaponID >= 0;
					if (flag5)
					{
						short randomItemSubtype = Config.Weapon.Instance[config.MostFittingWeaponID].ItemSubType;
						ValueTuple<sbyte, int> stat2;
						bool flag6 = itemSubTypeStats.TryGetValue(randomItemSubtype, out stat2) && stat2.Item1 >= minItemGrade;
						if (!flag6)
						{
							short weaponTemplateId = ItemDomain.GenerateRandomItemTemplateId(context.Random, 0, config.MostFittingWeaponID, expectedItemGrade);
							mod.AddItemToCreate(0, weaponTemplateId, 1);
							break;
						}
					}
				}
			}
		}

		// Token: 0x06006DA3 RID: 28067 RVA: 0x003D9FC0 File Offset: 0x003D81C0
		private void OfflineGetClothingSupply(DataContext context, PeriAdvanceMonthGetSupplyModification mod, short clothingId)
		{
			ClothingItem clothing = Config.Clothing.Instance[clothingId];
			bool flag = clothing == null;
			if (!flag)
			{
				Dictionary<short, ValueTuple<sbyte, int>> itemSubTypeStats = context.AdvanceMonthRelatedData.ItemSubTypeStats.Get();
				sbyte itemGrade = clothing.Grade;
				ValueTuple<sbyte, int> stat;
				bool flag2 = itemSubTypeStats.TryGetValue(clothing.ItemSubType, out stat) && stat.Item1 >= itemGrade;
				if (!flag2)
				{
					bool flag3 = !context.Random.CheckPercentProb(30);
					if (!flag3)
					{
						mod.AddItemToCreate(3, clothingId, 1);
					}
				}
			}
		}

		// Token: 0x06006DA4 RID: 28068 RVA: 0x003DA04C File Offset: 0x003D824C
		private unsafe void OfflineRepairEquipments(DataContext context, PeriAdvanceMonthActivePreparationModification mod)
		{
			List<ItemKey> itemsToFix = ObjectPool<List<ItemKey>>.Instance.Get();
			List<ItemKey> tools = ObjectPool<List<ItemKey>>.Instance.Get();
			itemsToFix.Clear();
			tools.Clear();
			foreach (ItemKey equipment in this._equipment)
			{
				bool flag = DomainManager.Item.CheckItemNeedRepair(equipment);
				if (flag)
				{
					itemsToFix.Add(equipment);
				}
			}
			foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
			{
				ItemKey itemKey2;
				int num;
				keyValuePair.Deconstruct(out itemKey2, out num);
				ItemKey itemKey = itemKey2;
				bool flag2 = itemKey.ItemType == 6;
				if (flag2)
				{
					ItemBase toolBaseItem = DomainManager.Item.GetBaseItem(itemKey);
					bool flag3 = toolBaseItem.GetCurrDurability() <= 0;
					if (!flag3)
					{
						tools.Add(itemKey);
					}
				}
				else
				{
					bool flag4 = DomainManager.Item.CheckItemNeedRepair(itemKey);
					if (flag4)
					{
						itemsToFix.Add(itemKey);
					}
				}
			}
			bool flag5 = itemsToFix.Count > 0;
			if (flag5)
			{
				tools.Sort((ItemKey a, ItemKey b) => a.TemplateId.CompareTo(b.TemplateId));
				LifeSkillShorts lifeSkillAttainments = *this.GetLifeSkillAttainments();
				foreach (ItemKey itemToFix in itemsToFix)
				{
					ItemBase itemObj = DomainManager.Item.GetBaseItem(itemToFix);
					short currDurability = itemObj.GetCurrDurability();
					short maxDurability = itemObj.GetMaxDurability();
					sbyte resourceType = itemObj.GetResourceType();
					sbyte lifeSkillType = ItemTemplateHelper.GetCraftRequiredLifeSkillType(itemToFix.ItemType, itemToFix.TemplateId);
					short attainmentRequired = ItemTemplateHelper.GetRepairRequiredAttainment(itemToFix.ItemType, itemToFix.TemplateId, currDurability);
					EquipmentBase equip = DomainManager.Item.GetBaseEquipment(itemToFix);
					ResourceInts resourceRequired = ItemTemplateHelper.GetRepairNeedResources(equip.GetMaterialResources(), itemToFix, currDurability);
					short charAttainment = *(ref lifeSkillAttainments.Items.FixedElementField + (IntPtr)lifeSkillType * 2);
					int index = tools.FindIndex(delegate(ItemKey key)
					{
						CraftToolItem cfg2 = Config.CraftTool.Instance[key.TemplateId];
						short durabilityCost2 = cfg2.DurabilityCost[(int)itemObj.GetGrade()];
						GameData.Domains.Item.CraftTool toolItem = DomainManager.Item.GetElement_CraftTools(key.Id);
						return toolItem.GetCurrDurability() >= durabilityCost2 && charAttainment + cfg2.AttainmentBonus >= attainmentRequired && cfg2.RequiredLifeSkillTypes.Contains(lifeSkillType);
					});
					GameData.Domains.Item.CraftTool tool = (index >= 0) ? DomainManager.Item.GetElement_CraftTools(tools[index].Id) : null;
					bool flag6 = tool == null;
					if (flag6)
					{
						sbyte grade;
						for (grade = 0; grade <= this._organizationInfo.Grade; grade += 1)
						{
							CraftToolItem currGradeCraftToolCfg = ItemTemplateHelper.GetGradeCraftTool(resourceType, grade);
							bool flag7 = *(ref lifeSkillAttainments.Items.FixedElementField + (IntPtr)lifeSkillType * 2) + currGradeCraftToolCfg.AttainmentBonus < attainmentRequired;
							if (!flag7)
							{
								GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(10, 6, currGradeCraftToolCfg.TemplateId);
								this.OfflineAddPersonalNeed(personalNeed);
								mod.PersonalNeedChanged = true;
								break;
							}
						}
						bool flag8 = grade > this._organizationInfo.Grade;
						if (flag8)
						{
							GameData.Domains.Character.Ai.PersonalNeed personalNeed2 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(11, itemToFix.ItemType, itemToFix.Id);
							this.OfflineAddPersonalNeed(personalNeed2);
							mod.PersonalNeedChanged = true;
						}
					}
					else
					{
						bool flag9 = !this._resources.CheckIsMeet(ref resourceRequired);
						if (flag9)
						{
							for (int i = 0; i < 8; i++)
							{
								int amount = *(ref resourceRequired.Items.FixedElementField + (IntPtr)i * 4);
								bool flag10 = amount <= 0;
								if (!flag10)
								{
									GameData.Domains.Character.Ai.PersonalNeed personalNeed3 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(8, resourceType, amount);
									this.OfflineAddPersonalNeed(personalNeed3);
									mod.PersonalNeedChanged = true;
								}
							}
						}
						else
						{
							CraftToolItem cfg = Config.CraftTool.Instance[tool.GetTemplateId()];
							short durabilityCost = cfg.DurabilityCost[(int)itemObj.GetGrade()];
							ItemBase.OfflineRepairItem(tool, itemObj, itemObj.GetMaxDurability(), durabilityCost);
							this._resources = this._resources.Subtract(ref resourceRequired);
							mod.ResourcesChanged = true;
							if (mod.ItemsFixed == null)
							{
								mod.ItemsFixed = new List<ItemBase>();
							}
							mod.ItemsFixed.Add(itemObj);
							if (mod.CraftToolsUsed == null)
							{
								mod.CraftToolsUsed = new HashSet<int>();
							}
							mod.CraftToolsUsed.Add(tool.GetId());
							bool flag11 = tool.GetCurrDurability() <= 0;
							if (flag11)
							{
								tools.Remove(tool.GetItemKey());
							}
						}
					}
				}
			}
			ObjectPool<List<ItemKey>>.Instance.Return(itemsToFix);
			ObjectPool<List<ItemKey>>.Instance.Return(tools);
		}

		// Token: 0x06006DA5 RID: 28069 RVA: 0x003DA538 File Offset: 0x003D8738
		private void OfflineFeedAnimalCarrier(IRandomSource random, PeriAdvanceMonthActivePreparationModification mod)
		{
			int maxNeedTamePoint = 0;
			ItemKey equippedCarrierKey = this._equipment[7];
			bool flag = equippedCarrierKey.IsValid();
			if (flag)
			{
				int needTamePoint = Character.<OfflineFeedAnimalCarrier>g__GetNeedTamePoint|587_0(equippedCarrierKey);
				bool flag2 = needTamePoint > 0;
				if (flag2)
				{
					mod.FeedingCarrierKey = equippedCarrierKey;
					maxNeedTamePoint = needTamePoint;
				}
			}
			foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
			{
				ItemKey itemKey3;
				int num;
				keyValuePair.Deconstruct(out itemKey3, out num);
				ItemKey itemKey = itemKey3;
				int needTamePoint2 = Character.<OfflineFeedAnimalCarrier>g__GetNeedTamePoint|587_0(itemKey);
				bool flag3 = needTamePoint2 <= maxNeedTamePoint;
				if (!flag3)
				{
					maxNeedTamePoint = needTamePoint2;
					mod.FeedingCarrierKey = itemKey;
				}
			}
			bool flag4 = !mod.FeedingCarrierKey.IsValid();
			if (!flag4)
			{
				int bestFeedTamePoint = -128;
				foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
				{
					ItemKey itemKey3;
					int num;
					keyValuePair.Deconstruct(out itemKey3, out num);
					ItemKey itemKey2 = itemKey3;
					int feedTamePoint = Character.<OfflineFeedAnimalCarrier>g__GetFeedTamePoint|587_1(mod.FeedingCarrierKey, itemKey2);
					bool flag5 = feedTamePoint <= 0;
					if (!flag5)
					{
						bool flag6 = Math.Abs(bestFeedTamePoint - maxNeedTamePoint) < Math.Abs(feedTamePoint - maxNeedTamePoint);
						if (!flag6)
						{
							bestFeedTamePoint = feedTamePoint;
							mod.FeedingFoodKey = itemKey2;
						}
					}
				}
				bool flag7 = !mod.FeedingFoodKey.IsValid();
				if (flag7)
				{
					CarrierItem carrierCfg = Config.Carrier.Instance[mod.FeedingCarrierKey.TemplateId];
					bool flag8 = !carrierCfg.LoveFoodType.CheckIndex(0);
					if (!flag8)
					{
						short lovingType = carrierCfg.LoveFoodType.GetRandom(random);
						GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(10, 5, lovingType);
						mod.PersonalNeedChanged = (mod.PersonalNeedChanged || this.OfflineAddPersonalNeed(personalNeed));
					}
				}
			}
		}

		// Token: 0x06006DA6 RID: 28070 RVA: 0x003DA734 File Offset: 0x003D8934
		private unsafe void OfflineAddPoisonToEquipments(DataContext context, PeriAdvanceMonthActivePreparationModification mod, ItemKey[] equipments = null)
		{
			bool flag = !Organization.Instance[this._organizationInfo.OrgTemplateId].AllowPoisoning;
			if (!flag)
			{
				sbyte behaviorType = this.GetBehaviorType();
				bool* primaryPoisonTypes = stackalloc bool[(UIntPtr)6];
				this.GetAttackSkillPoisonTypes(primaryPoisonTypes);
				bool hasAttackSkillWithPoison = false;
				for (int i = 0; i < 6; i++)
				{
					bool flag2 = !primaryPoisonTypes[i];
					if (!flag2)
					{
						hasAttackSkillWithPoison = true;
						break;
					}
				}
				bool flag3 = !hasAttackSkillWithPoison;
				if (!flag3)
				{
					int chance = (int)(10 + AiHelper.ActivePreparationConstants.AddPoisonBonusChance[(int)behaviorType]);
					foreach (GameData.Domains.Character.Ai.PersonalNeed personalNeed in this._personalNeeds)
					{
						bool flag4 = personalNeed.TemplateId != 12;
						if (!flag4)
						{
							bool flag5 = primaryPoisonTypes[personalNeed.PoisonType];
							if (flag5)
							{
								chance = 100;
							}
						}
					}
					short rateAdjust = DomainManager.Extra.GetAiActionRateAdjust(this._id, 9, -1);
					bool flag6 = !context.Random.CheckPercentProb(chance + (int)rateAdjust);
					if (!flag6)
					{
						short toxicologyAttainment = this.GetLifeSkillAttainment(9);
						ItemKey* poisonItemKeys = stackalloc ItemKey[checked(unchecked((UIntPtr)6) * (UIntPtr)sizeof(ItemKey))];
						IntPtr intPtr = stackalloc byte[(UIntPtr)6];
						initblk(intPtr, 255, 6);
						sbyte* grades = intPtr;
						int primaryPoisonCount = 0;
						int secondaryPoisonCount = 0;
						foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
						{
							ItemKey itemKey3;
							int num;
							keyValuePair.Deconstruct(out itemKey3, out num);
							ItemKey itemKey = itemKey3;
							bool flag7 = itemKey.ItemType != 8;
							if (!flag7)
							{
								MedicineItem medicineCfg = Config.Medicine.Instance[itemKey.TemplateId];
								bool flag8 = medicineCfg.EffectType != EMedicineEffectType.ApplyPoison;
								if (!flag8)
								{
									sbyte poisonType = medicineCfg.PoisonType;
									short attainmentRequired = GlobalConfig.Instance.PoisonAttainments[(int)medicineCfg.Grade];
									bool flag9 = toxicologyAttainment < attainmentRequired;
									if (!flag9)
									{
										bool flag10 = medicineCfg.Grade <= grades[poisonType];
										if (!flag10)
										{
											bool flag11 = grades[poisonType] < 0;
											if (flag11)
											{
												bool flag12 = primaryPoisonTypes[poisonType];
												if (flag12)
												{
													primaryPoisonCount++;
												}
												else
												{
													secondaryPoisonCount++;
												}
											}
											poisonItemKeys[poisonType] = itemKey;
											grades[poisonType] = medicineCfg.Grade;
										}
									}
								}
							}
						}
						bool flag13 = primaryPoisonCount == 0;
						if (flag13)
						{
							ValueTuple<ItemKey, sbyte, short> leastPoisonedEquippedWeaponOrArmor = this.GetLeastPoisonedEquippedWeaponOrArmor();
							ItemKey leastPoisonedKey = leastPoisonedEquippedWeaponOrArmor.Item1;
							sbyte level = leastPoisonedEquippedWeaponOrArmor.Item2;
							short value = leastPoisonedEquippedWeaponOrArmor.Item3;
							sbyte charGradePoisonLevel = AiHelper.ActivePreparationConstants.GradePoisonLevel[(int)this._organizationInfo.Grade];
							short charGradePoisonValue = AiHelper.ActivePreparationConstants.GradePoisonValue[(int)this._organizationInfo.Grade];
							bool flag14 = charGradePoisonLevel > level || (charGradePoisonLevel == level && charGradePoisonValue > value);
							if (flag14)
							{
								for (sbyte poisonType2 = 0; poisonType2 < 6; poisonType2 += 1)
								{
									bool flag15 = !primaryPoisonTypes[poisonType2];
									if (!flag15)
									{
										GameData.Domains.Character.Ai.PersonalNeed personalNeed2 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(12, poisonType2);
										this.OfflineAddPersonalNeed(personalNeed2);
										mod.PersonalNeedChanged = true;
									}
								}
							}
						}
						else
						{
							int totalPoisonCount = primaryPoisonCount + secondaryPoisonCount;
							ItemKey* sortedPoisons = stackalloc ItemKey[checked(unchecked((UIntPtr)totalPoisonCount) * (UIntPtr)sizeof(ItemKey))];
							int primaryPoisonIndex = 0;
							int secondaryPoisonIndex = primaryPoisonCount;
							for (sbyte poisonType3 = 0; poisonType3 < 6; poisonType3 += 1)
							{
								bool flag16 = grades[poisonType3] < 0;
								if (!flag16)
								{
									ItemKey itemKey2 = poisonItemKeys[poisonType3];
									bool flag17 = primaryPoisonTypes[poisonType3];
									if (flag17)
									{
										sortedPoisons[primaryPoisonIndex] = itemKey2;
										primaryPoisonIndex++;
									}
									else
									{
										sortedPoisons[secondaryPoisonIndex] = itemKey2;
										secondaryPoisonIndex++;
									}
									Tester.Assert(itemKey2.ItemType == 8, "");
								}
							}
							Tester.Assert(primaryPoisonIndex == primaryPoisonCount, "");
							Tester.Assert(secondaryPoisonIndex == totalPoisonCount, "");
							bool flag18 = primaryPoisonCount > 0;
							if (flag18)
							{
								CollectionUtils.Shuffle<ItemKey>(context.Random, sortedPoisons, primaryPoisonCount);
							}
							bool flag19 = secondaryPoisonCount > 0;
							if (flag19)
							{
								CollectionUtils.Shuffle<ItemKey>(context.Random, sortedPoisons + primaryPoisonCount, secondaryPoisonCount);
							}
							IntPtr intPtr2 = stackalloc byte[(UIntPtr)3];
							cpblk(intPtr2, ref <PrivateImplementationDetails>.AE4B3280E56E2FAF83F414A6E3DABE9D5FBE18976544C05FED121ACCB85B53FC, 3);
							sbyte* weapons = intPtr2;
							ValueTuple<sbyte, ItemKey[]> valueTuple = this.SelectEquipmentSlotAndPoisonsToAdd(context.Random, sortedPoisons, totalPoisonCount, weapons, 3, equipments);
							mod.EquipmentSlotToAddPoison = valueTuple.Item1;
							mod.PoisonsToUse = valueTuple.Item2;
							bool flag20 = mod.EquipmentSlotToAddPoison >= 0;
							if (flag20)
							{
								this.RemovePersonalNeedOnAddPoisonToItem(mod);
							}
							else
							{
								IntPtr intPtr3 = stackalloc byte[(UIntPtr)4];
								cpblk(intPtr3, ref <PrivateImplementationDetails>.480952838458970426CE17954928B70D8BBE57CC04FF20CC1B20C238B682413A, 4);
								sbyte* armor = intPtr3;
								valueTuple = this.SelectEquipmentSlotAndPoisonsToAdd(context.Random, sortedPoisons, totalPoisonCount, armor, 4, equipments);
								mod.EquipmentSlotToAddPoison = valueTuple.Item1;
								mod.PoisonsToUse = valueTuple.Item2;
								bool flag21 = mod.EquipmentSlotToAddPoison >= 0;
								if (flag21)
								{
									this.RemovePersonalNeedOnAddPoisonToItem(mod);
								}
								else
								{
									IntPtr intPtr4 = stackalloc byte[(UIntPtr)3];
									cpblk(intPtr4, ref <PrivateImplementationDetails>.6E9FA019228FE1A9D342D4A0085AB80270C9726BD08CD5A35D7626A700B34E2F, 3);
									sbyte* accessories = intPtr4;
									valueTuple = this.SelectEquipmentSlotAndPoisonsToAdd(context.Random, sortedPoisons, totalPoisonCount, accessories, 3, equipments);
									mod.EquipmentSlotToAddPoison = valueTuple.Item1;
									mod.PoisonsToUse = valueTuple.Item2;
									bool flag22 = mod.EquipmentSlotToAddPoison >= 0;
									if (flag22)
									{
										this.RemovePersonalNeedOnAddPoisonToItem(mod);
									}
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06006DA7 RID: 28071 RVA: 0x003DACDC File Offset: 0x003D8EDC
		private void RemovePersonalNeedOnAddPoisonToItem(PeriAdvanceMonthActivePreparationModification mod)
		{
			bool flag = mod.PoisonsToUse == null;
			if (!flag)
			{
				ItemKey[] poisonsToUse = mod.PoisonsToUse;
				for (int i = 0; i < poisonsToUse.Length; i++)
				{
					ItemKey itemKey = poisonsToUse[i];
					MedicineItem config = Config.Medicine.Instance[itemKey.TemplateId];
					int findIndex = this._personalNeeds.FindIndex((GameData.Domains.Character.Ai.PersonalNeed n) => n.TemplateId == 12 && n.PoisonType == config.PoisonType);
					bool flag2 = findIndex >= 0;
					if (flag2)
					{
						this._personalNeeds.RemoveAt(findIndex);
						mod.PersonalNeedChanged = true;
					}
				}
			}
		}

		// Token: 0x06006DA8 RID: 28072 RVA: 0x003DAD78 File Offset: 0x003D8F78
		[return: TupleElementNames(new string[]
		{
			null,
			"level",
			"value"
		})]
		private unsafe ValueTuple<ItemKey, sbyte, short> GetLeastPoisonedEquippedWeaponOrArmor()
		{
			IntPtr intPtr = stackalloc byte[(UIntPtr)7];
			cpblk(intPtr, ref <PrivateImplementationDetails>.06B39EF5B04E3B17B41FE345176881E767B2990AF15A3AA5559339EAB1E28287, 7);
			sbyte* slots = intPtr;
			ItemKey leastPoisonedItemKey = ItemKey.Invalid;
			sbyte minPoisonLevel = 3;
			short minPoisonValue = short.MaxValue;
			for (int i = 0; i < 7; i++)
			{
				sbyte slotIndex = slots[i];
				ItemKey itemKey = this._equipment[(int)slotIndex];
				bool flag = !itemKey.IsValid();
				if (!flag)
				{
					bool flag2 = !ModificationStateHelper.IsActive(itemKey.ModificationState, 1);
					if (flag2)
					{
						return new ValueTuple<ItemKey, sbyte, short>(itemKey, 0, 0);
					}
					sbyte currPoisonLevel = 0;
					short currPoisonValue = 0;
					PoisonsAndLevels prevAttachedPoison = DomainManager.Item.GetAttachedPoisons(itemKey);
					for (sbyte poisonType = 0; poisonType < 6; poisonType += 1)
					{
						bool flag3 = *(ref prevAttachedPoison.Levels.FixedElementField + poisonType) <= 0;
						if (!flag3)
						{
							currPoisonLevel = *(ref prevAttachedPoison.Levels.FixedElementField + poisonType);
							currPoisonValue = *(ref prevAttachedPoison.Values.FixedElementField + (IntPtr)poisonType * 2);
							break;
						}
					}
					bool flag4 = currPoisonLevel > minPoisonLevel;
					if (!flag4)
					{
						bool flag5 = currPoisonLevel == minPoisonLevel && currPoisonValue > minPoisonValue;
						if (!flag5)
						{
							leastPoisonedItemKey = itemKey;
							minPoisonLevel = currPoisonLevel;
							minPoisonValue = currPoisonValue;
						}
					}
				}
			}
			return new ValueTuple<ItemKey, sbyte, short>(leastPoisonedItemKey, minPoisonLevel, minPoisonValue);
		}

		// Token: 0x06006DA9 RID: 28073 RVA: 0x003DAEC0 File Offset: 0x003D90C0
		public unsafe void GetAttackSkillPoisonTypes(bool* poisonTypes)
		{
			for (sbyte poisonType = 0; poisonType < 6; poisonType += 1)
			{
				poisonTypes[poisonType] = false;
			}
			ArraySegmentList<short> attackSkills = this.GetCombatSkillEquipment().Attack;
			foreach (short ptr in attackSkills)
			{
				short skillTemplateId = ptr;
				bool flag = skillTemplateId < 0;
				if (!flag)
				{
					CombatSkillItem skillConfig = Config.CombatSkill.Instance[skillTemplateId];
					bool flag2 = !skillConfig.Poisons.IsNonZero();
					if (!flag2)
					{
						for (sbyte poisonType2 = 0; poisonType2 < 6; poisonType2 += 1)
						{
							bool flag3 = *(ref skillConfig.Poisons.Values.FixedElementField + (IntPtr)poisonType2 * 2) > 0;
							if (flag3)
							{
								poisonTypes[poisonType2] = true;
							}
						}
					}
				}
			}
		}

		// Token: 0x06006DAA RID: 28074 RVA: 0x003DAF8C File Offset: 0x003D918C
		private unsafe sbyte SelectEquipmentInArrayToAddPoisonOn(IRandomSource random, MedicineItem poisonConfig, sbyte* equipmentArr, int length, ItemKey[] equipments = null)
		{
			if (equipments == null)
			{
				equipments = this._equipment;
			}
			CollectionUtils.Shuffle<sbyte>(random, equipmentArr, length);
			for (int i = 0; i < length; i++)
			{
				sbyte slotIndex = equipmentArr[i];
				ItemKey equipmentKey = equipments[(int)slotIndex];
				bool flag = !equipmentKey.IsValid();
				if (!flag)
				{
					bool flag2 = !ItemTemplateHelper.IsPoisonable(equipmentKey.ItemType, equipmentKey.TemplateId);
					if (!flag2)
					{
						EquipmentBase equipmentObj = DomainManager.Item.GetBaseEquipment(equipmentKey);
						byte modificationState = equipmentObj.GetModificationState();
						bool flag3 = ModificationStateHelper.IsActive(modificationState, 1);
						if (!flag3)
						{
							return slotIndex;
						}
					}
				}
			}
			return -1;
		}

		// Token: 0x06006DAB RID: 28075 RVA: 0x003DB030 File Offset: 0x003D9230
		private unsafe ValueTuple<sbyte, ItemKey[]> SelectEquipmentSlotAndPoisonsToAdd(IRandomSource random, ItemKey* poisonArr, int poisonLength, sbyte* equipSlotArr, int equipSlotLength, ItemKey[] equipments = null)
		{
			if (equipments == null)
			{
				equipments = this._equipment;
			}
			Span<ItemKey> span = new Span<ItemKey>(stackalloc byte[checked(unchecked((UIntPtr)3) * (UIntPtr)sizeof(ItemKey))], 3);
			SpanList<ItemKey> addedPoisons = span;
			CollectionUtils.Shuffle<sbyte>(random, equipSlotArr, equipSlotLength);
			for (int i = 0; i < equipSlotLength; i++)
			{
				sbyte slotIndex = equipSlotArr[i];
				ItemKey equipmentKey = equipments[(int)slotIndex];
				bool flag = !equipmentKey.IsValid();
				if (!flag)
				{
					bool flag2 = !ItemTemplateHelper.IsPoisonable(equipmentKey.ItemType, equipmentKey.TemplateId);
					if (!flag2)
					{
						EquipmentBase equipmentObj = DomainManager.Item.GetBaseEquipment(equipmentKey);
						byte modificationState = equipmentObj.GetModificationState();
						bool flag3 = ModificationStateHelper.IsActive(modificationState, 1);
						ValueTuple<sbyte, ItemKey[]> result;
						if (flag3)
						{
							FullPoisonEffects prevAttachedPoison = DomainManager.Item.GetPoisonEffects(equipmentKey);
							PoisonsAndLevels poisonsAndLevels = prevAttachedPoison.GetAllPoisonsAndLevels();
							int prevPoisonCount = prevAttachedPoison.IsTwoPoisonsMix() ? 2 : (prevAttachedPoison.IsThreePoisonsMix() ? 3 : 1);
							bool flag4 = prevPoisonCount >= 3;
							if (flag4)
							{
								goto IL_2FA;
							}
							for (int j = 0; j < poisonLength; j++)
							{
								ItemKey poisonItemKey = poisonArr[j];
								MedicineItem poisonCfg = Config.Medicine.Instance[poisonItemKey.TemplateId];
								sbyte poisonType = poisonCfg.PoisonType;
								sbyte level = *(ref poisonsAndLevels.Levels.FixedElementField + poisonType);
								short value = *(ref poisonsAndLevels.Values.FixedElementField + (IntPtr)poisonType * 2);
								bool flag5 = value > 0;
								if (!flag5)
								{
									bool flag6 = (short)level < poisonCfg.EffectThresholdValue || ((short)level == poisonCfg.EffectThresholdValue && value < poisonCfg.EffectValue);
									if (flag6)
									{
										addedPoisons.Add(poisonItemKey);
										bool flag7 = addedPoisons.Count + prevPoisonCount >= 3;
										if (flag7)
										{
											break;
										}
									}
								}
							}
							bool flag8 = addedPoisons.Count > 0;
							if (!flag8)
							{
								goto IL_2FA;
							}
							result = new ValueTuple<sbyte, ItemKey[]>(slotIndex, addedPoisons.ToArray());
						}
						else
						{
							bool flag9 = random.CheckPercentProb((int)this.GetPersonality(1));
							if (flag9)
							{
								for (int k = 0; k < poisonLength; k++)
								{
									ItemKey poisonItemKey2 = poisonArr[k];
									int amount = this._inventory.Items[poisonItemKey2];
									bool flag10 = amount < 3;
									if (!flag10)
									{
										addedPoisons.Add(poisonArr[k]);
										addedPoisons.Add(poisonArr[k]);
										addedPoisons.Add(poisonArr[k]);
										return new ValueTuple<sbyte, ItemKey[]>(slotIndex, addedPoisons.ToArray());
									}
								}
							}
							int count = Math.Min(poisonLength, 3);
							for (int l = 0; l < count; l++)
							{
								addedPoisons.Add(poisonArr[l]);
							}
							result = new ValueTuple<sbyte, ItemKey[]>(slotIndex, addedPoisons.ToArray());
						}
						return result;
					}
				}
				IL_2FA:;
			}
			return new ValueTuple<sbyte, ItemKey[]>(-1, null);
		}

		// Token: 0x06006DAC RID: 28076 RVA: 0x003DB358 File Offset: 0x003D9558
		private int PoisonCompare(ItemKey itemKeyA, ItemKey itemKeyB)
		{
			return Config.Medicine.Instance[itemKeyA.TemplateId].Grade.CompareTo(Config.Medicine.Instance[itemKeyB.TemplateId].Grade);
		}

		// Token: 0x06006DAD RID: 28077 RVA: 0x003DB39C File Offset: 0x003D959C
		private unsafe void OfflineLoseResources(PeriAdvanceMonthUpdateStatusModification mod)
		{
			int maxAmount = DomainManager.Taiwu.GetMaterialResourceMaxCount();
			for (sbyte type = 0; type < 6; type += 1)
			{
				int oriAmount = *(ref this._resources.Items.FixedElementField + (IntPtr)type * 4);
				bool flag = oriAmount <= maxAmount;
				if (!flag)
				{
					int lostAmount = Math.Max((oriAmount - maxAmount) / 2, 1);
					*(ref this._resources.Items.FixedElementField + (IntPtr)type * 4) = oriAmount - lostAmount;
					mod.ResourcesChanged = true;
				}
			}
		}

		// Token: 0x06006DAE RID: 28078 RVA: 0x003DB41C File Offset: 0x003D961C
		private int OfflineLoseOverloadedItems(DataContext context, PeriAdvanceMonthPassivePreparationModification mod)
		{
			int overloadedWeight = this.GetCurrInventoryLoad() - this.GetMaxInventoryLoad();
			bool flag = overloadedWeight <= 0;
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				Location charLocation = this._location.IsValid() ? this._location : this.GetValidLocation();
				List<MapBlockData> nearbyBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
				DomainManager.Map.GetRealNeighborBlocks(charLocation.AreaId, charLocation.BlockId, nearbyBlocks, 2, true);
				List<ValueTuple<ItemBase, int>> itemsToBeLost = context.AdvanceMonthRelatedData.ItemsWithAmount.Occupy();
				CharacterDomain.GetLostItemsDueToOverload(context, overloadedWeight, this._inventory.Items, itemsToBeLost, this._id == DomainManager.Taiwu.GetTaiwuCharId());
				mod.ItemsToBeLost = new List<ValueTuple<MapBlockData, ItemKey, int>>();
				int decreasedHappiness = 0;
				foreach (ValueTuple<ItemBase, int> valueTuple in itemsToBeLost)
				{
					ItemBase item = valueTuple.Item1;
					int amount = valueTuple.Item2;
					ItemKey itemKey = item.GetItemKey();
					this._inventory.OfflineRemove(itemKey, amount);
					MapBlockData block = nearbyBlocks.GetRandom(context.Random);
					mod.ItemsToBeLost.Add(new ValueTuple<MapBlockData, ItemKey, int>(block, itemKey, amount));
					decreasedHappiness += (int)item.GetHappinessChange() * amount;
				}
				context.AdvanceMonthRelatedData.ItemsWithAmount.Release(ref itemsToBeLost);
				ObjectPool<List<MapBlockData>>.Instance.Return(nearbyBlocks);
				result = -decreasedHappiness;
			}
			return result;
		}

		// Token: 0x06006DAF RID: 28079 RVA: 0x003DB598 File Offset: 0x003D9798
		[Obsolete]
		private void ApplyReadingResult(DataContext context, GameData.Domains.Item.SkillBook book, int learnedSkillIndex, byte readingPage, bool isSucceed)
		{
			this.ApplyBookReadingResult(context, book, learnedSkillIndex, readingPage, isSucceed ? 1 : 0);
		}

		// Token: 0x06006DB0 RID: 28080 RVA: 0x003DB5B0 File Offset: 0x003D97B0
		private void ApplyBookReadingResult(DataContext context, GameData.Domains.Item.SkillBook book, int learnedSkillIndex, byte readingPage, sbyte succeedPageCount)
		{
			int currDate = DomainManager.World.GetCurrDate();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			ItemKey bookItemKey = book.GetItemKey();
			this.TryApplyAttachedPoison(context, bookItemKey);
			book.SetCurrDurability(book.GetCurrDurability() - 1, context);
			bool flag = book.GetCurrDurability() <= 0;
			if (flag)
			{
				this.RemoveInventoryItem(context, bookItemKey, 1, true, false);
				GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(10, 10, book.GetTemplateId());
				this.AddPersonalNeed(context, need);
			}
			bool flag2 = succeedPageCount > 0;
			if (flag2)
			{
				this.SetExp(this._exp, context);
				bool flag3 = book.IsCombatSkillBook();
				byte nextPage;
				if (flag3)
				{
					short combatSkillTemplateId = book.GetCombatSkillTemplateId();
					byte pageTypes = book.GetPageTypes();
					bool flag4 = learnedSkillIndex < 0;
					if (flag4)
					{
						learnedSkillIndex = this._learnedCombatSkills.Count;
						byte internalIndex = CombatSkillStateHelper.GetPageInternalIndex(SkillBookStateHelper.GetOutlinePageType(pageTypes), SkillBookStateHelper.GetNormalPageType(pageTypes, readingPage), readingPage);
						this.LearnNewCombatSkill(context, combatSkillTemplateId, (ushort)(1 << (int)internalIndex));
						readingPage += 1;
						succeedPageCount -= 1;
					}
					GameData.Domains.CombatSkill.CombatSkill skillItem = DomainManager.CombatSkill.GetElement_CombatSkills(new CombatSkillKey(this._id, combatSkillTemplateId));
					while (succeedPageCount > 0 && readingPage < 6)
					{
						byte internalIndex2 = CombatSkillStateHelper.GetPageInternalIndex(SkillBookStateHelper.GetOutlinePageType(pageTypes), SkillBookStateHelper.GetNormalPageType(pageTypes, readingPage), readingPage);
						skillItem.SetReadingState(CombatSkillStateHelper.SetPageRead(skillItem.GetReadingState(), internalIndex2), context);
						DomainManager.CombatSkill.TryActivateCombatSkillBookPageWhenSetReadingState(context, this._id, combatSkillTemplateId, internalIndex2);
						readingPage += 1;
						succeedPageCount -= 1;
					}
					nextPage = this.GetCombatSkillBookCurrReadingInfo(book).Item2;
				}
				else
				{
					short lifeSkillTemplateId = book.GetLifeSkillTemplateId();
					bool flag5 = learnedSkillIndex < 0;
					if (flag5)
					{
						learnedSkillIndex = this._learnedLifeSkills.Count;
						this.LearnNewLifeSkill(context, lifeSkillTemplateId, (byte)(1 << (int)readingPage));
						readingPage += 1;
						succeedPageCount -= 1;
					}
					while (succeedPageCount > 0 && readingPage < 5)
					{
						this.ReadLifeSkillPage(context, learnedSkillIndex, readingPage);
						readingPage += 1;
						succeedPageCount -= 1;
					}
					nextPage = this.GetLifeSkillBookCurrReadingInfo(book).Item2;
				}
				bool flag6 = nextPage < book.GetPageCount() && SkillBookStateHelper.GetPageIncompleteState(book.GetPageIncompleteState(), nextPage) == 2;
				if (flag6)
				{
					GameData.Domains.Character.Ai.PersonalNeed need2 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(17, book.GetId());
					this.AddPersonalNeed(context, need2);
				}
			}
			else
			{
				short attainmentRequirement = SkillGradeData.Instance[book.GetGrade()].ReadingAttainmentRequirement;
				GameData.Domains.Character.Ai.PersonalNeed needForLearning = book.IsCombatSkillBook() ? GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(14, book.GetCombatSkillType(), attainmentRequirement) : GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(15, book.GetLifeSkillType(), attainmentRequirement);
				this.AddPersonalNeed(context, needForLearning);
				GameData.Domains.Character.Ai.PersonalNeed needForReading = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(17, book.GetId());
				this.AddPersonalNeed(context, needForReading);
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddReadBookFail(this._id, (ulong)bookItemKey);
				DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
			}
		}

		// Token: 0x06006DB1 RID: 28081 RVA: 0x003DB8B0 File Offset: 0x003D9AB0
		private void OfflineUpdateReadingProgress(DataContext context, PeriAdvanceMonthSelfImprovementModification mod, GameData.Domains.Item.SkillBook book, int learnedSkillIndex, byte readingPage)
		{
			sbyte lifeSkillType = book.GetLifeSkillType();
			sbyte combatSkillType = book.GetCombatSkillType();
			short attainment = (lifeSkillType >= 0) ? this.GetLifeSkillAttainment(lifeSkillType) : this.GetCombatSkillAttainment(combatSkillType);
			sbyte cleverness = this.GetPersonality(1);
			byte currPage = readingPage;
			byte pageCount = book.GetPageCount();
			int totalPoints = Character.GetTotalReadingPoint(book.GetGrade(), attainment, cleverness);
			bool flag = this._organizationInfo.SettlementId >= 0 && OrganizationDomain.IsSect(this._organizationInfo.OrgTemplateId);
			if (flag)
			{
				Settlement settlement = DomainManager.Organization.GetSettlement(this._organizationInfo.SettlementId);
				totalPoints = totalPoints * settlement.GetMemberSelfImproveSpeedFactor() / 100;
			}
			ValueTuple<short, int, ItemKey> feast;
			bool flag2 = DomainManager.Building.IsCharacterParticipantFeast(this._id, out feast);
			if (flag2)
			{
				FeastItem config = Config.Feast.Instance[feast.Item1];
				int percent = (lifeSkillType >= 0) ? config.ReadLifeSkillBook : config.ReadCombatSkillBook;
				totalPoints += totalPoints * percent / 100 * feast.Item2 / 100;
			}
			bool flag3 = DomainManager.SpecialEffect.ModifyData(this._id, -1, 260, true, -1, -1, -1);
			if (flag3)
			{
				while (currPage < pageCount)
				{
					sbyte incompleteState = SkillBookStateHelper.GetPageIncompleteState(book.GetPageIncompleteState(), readingPage);
					bool flag4 = incompleteState == 2;
					if (flag4)
					{
						break;
					}
					sbyte pointCost = SkillBookPageIncompleteState.ReadingPointCost[(int)incompleteState];
					bool flag5 = (int)pointCost > totalPoints;
					if (flag5)
					{
						break;
					}
					totalPoints -= (int)pointCost;
					currPage += 1;
				}
			}
			sbyte succeedPageCount = (sbyte)(currPage - readingPage);
			mod.ReadingResult = new ValueTuple<GameData.Domains.Item.SkillBook, int, byte, sbyte>(book, learnedSkillIndex, readingPage, succeedPageCount);
			bool flag6 = mod.ReadingResult.Item1 != null && mod.ReadingResult.Item4 > 0;
			if (flag6)
			{
				this._exp += (int)(SkillGradeData.Instance[book.GetGrade()].ReadingExpGainPerPage * (short)mod.ReadingResult.Item4);
			}
		}

		// Token: 0x06006DB2 RID: 28082 RVA: 0x003DBA90 File Offset: 0x003D9C90
		[return: TupleElementNames(new string[]
		{
			"learnedSkillIndex",
			"readingPage"
		})]
		public ValueTuple<int, byte> GetCombatSkillBookCurrReadingInfo(GameData.Domains.Item.SkillBook book)
		{
			short combatSkillTemplateId = book.GetCombatSkillTemplateId();
			int learnedCombatSkillIndex = this._learnedCombatSkills.IndexOf(combatSkillTemplateId);
			bool flag = learnedCombatSkillIndex < 0;
			ValueTuple<int, byte> result;
			if (flag)
			{
				result = new ValueTuple<int, byte>(learnedCombatSkillIndex, 0);
			}
			else
			{
				CombatSkillKey combatSkillKey = new CombatSkillKey(this._id, this._learnedCombatSkills[learnedCombatSkillIndex]);
				GameData.Domains.CombatSkill.CombatSkill combatSkill = DomainManager.CombatSkill.GetElement_CombatSkills(combatSkillKey);
				byte pageTypes = book.GetPageTypes();
				sbyte behaviorType = SkillBookStateHelper.GetOutlinePageType(pageTypes);
				ushort readingState = combatSkill.GetReadingState();
				for (byte readingPage = 0; readingPage < 6; readingPage += 1)
				{
					byte pageInternalIndex = CombatSkillStateHelper.GetPageInternalIndex(behaviorType, SkillBookStateHelper.GetNormalPageType(pageTypes, readingPage), readingPage);
					bool flag2 = !CombatSkillStateHelper.IsPageRead(readingState, pageInternalIndex);
					if (flag2)
					{
						return new ValueTuple<int, byte>(learnedCombatSkillIndex, readingPage);
					}
				}
				result = new ValueTuple<int, byte>(learnedCombatSkillIndex, 6);
			}
			return result;
		}

		// Token: 0x06006DB3 RID: 28083 RVA: 0x003DBB60 File Offset: 0x003D9D60
		[return: TupleElementNames(new string[]
		{
			"learnedSkillIndex",
			"readingPage"
		})]
		public ValueTuple<int, byte> GetLifeSkillBookCurrReadingInfo(GameData.Domains.Item.SkillBook book)
		{
			short lifeSkillTemplateId = book.GetLifeSkillTemplateId();
			int learnedLifeSkillIndex = this.FindLearnedLifeSkillIndex(lifeSkillTemplateId);
			bool flag = learnedLifeSkillIndex < 0;
			ValueTuple<int, byte> result;
			if (flag)
			{
				result = new ValueTuple<int, byte>(learnedLifeSkillIndex, 0);
			}
			else
			{
				LifeSkillItem lifeSkill = this._learnedLifeSkills[learnedLifeSkillIndex];
				for (byte readingPage = 0; readingPage < 5; readingPage += 1)
				{
					bool flag2 = !lifeSkill.IsPageRead(readingPage);
					if (flag2)
					{
						return new ValueTuple<int, byte>(learnedLifeSkillIndex, readingPage);
					}
				}
				result = new ValueTuple<int, byte>(learnedLifeSkillIndex, 5);
			}
			return result;
		}

		// Token: 0x06006DB4 RID: 28084 RVA: 0x003DBBE0 File Offset: 0x003D9DE0
		public static int GetTaughtNewSkillSuccessRate(sbyte grade, short qualification, short attainment, sbyte cleverness)
		{
			SkillGradeDataItem gradeDataCfg = SkillGradeData.Instance[grade];
			bool flag = attainment > gradeDataCfg.ReadingAttainmentRequirement;
			int result;
			if (flag)
			{
				result = 100;
			}
			else
			{
				bool flag2 = qualification > gradeDataCfg.PracticeQualificationRequirement;
				if (flag2)
				{
					result = 100;
				}
				else
				{
					result = Math.Max((int)(((short)cleverness + attainment * 100 / gradeDataCfg.ReadingAttainmentRequirement) / 2), (int)(((short)cleverness + qualification * 100 / gradeDataCfg.PracticeQualificationRequirement) / 4));
				}
			}
			return result;
		}

		// Token: 0x06006DB5 RID: 28085 RVA: 0x003DBC48 File Offset: 0x003D9E48
		public static int GetReadingSuccessRate(sbyte grade, sbyte incompleteState, short attainment, sbyte cleverness)
		{
			short needAttainment = SkillGradeData.Instance[grade].ReadingAttainmentRequirement;
			sbyte baseSuccessRate = SkillBookPageIncompleteState.BaseReadingSuccessRate[(int)incompleteState];
			bool flag = attainment >= needAttainment;
			int result;
			if (flag)
			{
				result = (int)baseSuccessRate;
			}
			else
			{
				result = (int)((short)baseSuccessRate * ((short)cleverness + attainment * 100 / needAttainment) / 200);
			}
			return result;
		}

		// Token: 0x06006DB6 RID: 28086 RVA: 0x003DBC94 File Offset: 0x003D9E94
		private static int GetTotalReadingPoint(sbyte grade, short attainment, sbyte cleverness)
		{
			short needAttainment = SkillGradeData.Instance[grade].ReadingAttainmentRequirement;
			return (int)(100 + (short)(100 + cleverness) * attainment / needAttainment / 2);
		}

		// Token: 0x06006DB7 RID: 28087 RVA: 0x003DBCC4 File Offset: 0x003D9EC4
		private bool OfflineUpdatePregnantState(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			CrossAreaMoveInfo crossAreaMoveInfo;
			bool flag = !this._featureIds.Contains(197) || DomainManager.Character.TryGetElement_CrossAreaMoveInfos((this._leaderId >= 0) ? this._leaderId : this._id, out crossAreaMoveInfo);
			bool result;
			if (flag)
			{
				result = true;
			}
			else
			{
				mod.PregnantStateModification = new PregnantStateModification();
				DomainManager.Character.ParallelUpdatePregnantState(context, this, mod.PregnantStateModification);
				bool flag2 = mod.PregnantStateModification.State == PregnantStateModification.ChildState.AliveHuman;
				if (flag2)
				{
					DomainManager.Character.ParallelCreateNewbornChildren(context, this, mod.PregnantStateModification.Dystocia, mod.PregnantStateModification.LostMother);
				}
				else
				{
					bool flag3 = mod.PregnantStateModification.State == PregnantStateModification.ChildState.Dead;
					if (flag3)
					{
						sbyte happinessChange = AiHelper.UpdateStatusConstants.LostChildHappinessChange[(int)this.GetBehaviorType()];
						this._happiness = (sbyte)Math.Clamp((int)(this._happiness + happinessChange), -119, 119);
						this._health += -72;
						mod.HappinessChanged = true;
					}
				}
				bool flag4 = mod.PregnantStateModification.State > PregnantStateModification.ChildState.Invalid;
				if (flag4)
				{
					this._featureIds.Remove(197);
					mod.FeaturesChanged = true;
					mod.PersonalNeedsChanged = true;
				}
				bool flag5 = !mod.PregnantStateModification.LostMother;
				if (flag5)
				{
					result = true;
				}
				else
				{
					this._health = 0;
					result = false;
				}
			}
			return result;
		}

		// Token: 0x06006DB8 RID: 28088 RVA: 0x003DBE18 File Offset: 0x003DA018
		private sbyte GetXiangshuInfectionDelta()
		{
			int delta = DomainManager.SpecialEffect.ModifyValue(this._id, 262, 0, -1, -1, -1, 0, 0, 0, 0);
			bool flag = !this.CanBeXiangshuInfected();
			sbyte result;
			if (flag)
			{
				result = (sbyte)Math.Clamp(delta, -128, 127);
			}
			else
			{
				int num = delta;
				sbyte happinessType = HappinessType.GetHappinessType(this._happiness);
				if (!true)
				{
				}
				int num2;
				switch (happinessType)
				{
				case 0:
					num2 = (int)GlobalConfig.Instance.XiangshuInfectionAddSpeed[0];
					break;
				case 1:
					num2 = (int)GlobalConfig.Instance.XiangshuInfectionAddSpeed[1];
					break;
				case 2:
					num2 = (int)GlobalConfig.Instance.XiangshuInfectionAddSpeed[2];
					break;
				default:
					num2 = 0;
					break;
				}
				if (!true)
				{
				}
				delta = num + num2;
				foreach (short featureId in this._featureIds)
				{
					bool flag2 = this.IgnoreFeature(featureId);
					if (!flag2)
					{
						CharacterFeatureItem featureCfg = CharacterFeature.Instance[featureId];
						delta += (int)featureCfg.XiangshuInfectionChange;
					}
				}
				bool flag3 = delta > 127;
				if (flag3)
				{
					delta = 127;
				}
				result = (sbyte)delta;
			}
			return result;
		}

		// Token: 0x06006DB9 RID: 28089 RVA: 0x003DBF4C File Offset: 0x003DA14C
		private void OfflineUpdateEatingItems(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			bool flag = this._eatingItems.UpdateDurations(context.AdvanceMonthRelatedData.WorldItemsToBeRemoved, ref mod.RemovedWugs, ref mod.RemovedWugKings);
			if (flag)
			{
				mod.EatingItemsChanged = true;
			}
			this.OfflineUpdateWugKings(context, mod);
		}

		// Token: 0x06006DBA RID: 28090 RVA: 0x003DBF90 File Offset: 0x003DA190
		private void OfflineUpdateWugKings(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			List<ItemKey> removedWugKings = mod.RemovedWugKings;
			bool flag = removedWugKings == null || removedWugKings.Count <= 0;
			if (!flag)
			{
				for (int i = 0; i < mod.RemovedWugKings.Count; i++)
				{
					bool flag2 = this.ChangeFeatureByWugKing(context.Random);
					if (flag2)
					{
						mod.FeaturesChanged = true;
					}
					else
					{
						if (mod.RemovedSafetyWugKings == null)
						{
							mod.RemovedSafetyWugKings = new List<ItemKey>();
						}
						mod.RemovedSafetyWugKings.Add(mod.RemovedWugKings[i]);
					}
				}
				bool flag3 = mod.RemovedSafetyWugKings == null;
				if (!flag3)
				{
					foreach (ItemKey removedSafetyWugKing in mod.RemovedSafetyWugKings)
					{
						mod.RemovedWugKings.Remove(removedSafetyWugKing);
					}
				}
			}
		}

		// Token: 0x06006DBB RID: 28091 RVA: 0x003DC08C File Offset: 0x003DA28C
		private unsafe void OfflineUpdateEatingItemEffect(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			for (int i = 0; i < 9; i++)
			{
				ItemKey itemKey = (ItemKey)(*(ref this._eatingItems.ItemKeys.FixedElementField + (IntPtr)i * 8));
				bool flag = !itemKey.IsValid();
				if (!flag)
				{
					short duration = *(ref this._eatingItems.Durations.FixedElementField + (IntPtr)i * 2);
					short maxDuration = ItemTemplateHelper.GetEatableItemDuration(itemKey.ItemType, itemKey.TemplateId);
					bool flag2 = ModificationStateHelper.IsActive(itemKey.ModificationState, 1);
					if (flag2)
					{
						FullPoisonEffects poisonEffects;
						bool flag3 = !DomainManager.Item.PoisonEffects.TryGetValue(itemKey.Id, out poisonEffects);
						if (!flag3)
						{
							PoisonsAndLevels poisons = poisonEffects.GetAllPoisonsAndLevels();
							short medicineTemplateId = poisonEffects.GetMedicineTemplateId();
							bool flag4 = medicineTemplateId < 0;
							if (!flag4)
							{
								maxDuration += Config.Medicine.Instance[medicineTemplateId].Duration;
								for (sbyte type = 0; type < 6; type += 1)
								{
									int delta = (int)(PoisonsAndLevels.CalcApplyItemPoisonAmount(*(ref poisons.Values.FixedElementField + (IntPtr)type * 2), *(ref poisons.Levels.FixedElementField + type)) / 2 * duration / maxDuration);
									*(ref poisons.Values.FixedElementField + (IntPtr)type * 2) = (short)delta;
								}
								this.OfflineChangePoisoned(ref poisons);
								mod.PoisonedChanged = true;
							}
						}
					}
					else
					{
						bool flag5 = itemKey.ItemType == 8;
						if (flag5)
						{
							MedicineItem medicineCfg = Config.Medicine.Instance[itemKey.TemplateId];
							MedicineEatingInstantEffect effect = new MedicineEatingInstantEffect(medicineCfg, null);
							switch (medicineCfg.EffectType)
							{
							case EMedicineEffectType.RecoverOuterInjury:
								this.CalcMedicineEffect_RecoverInjury(ref this._injuries, context.Random, false, ref effect);
								mod.InjuriesChanged = true;
								break;
							case EMedicineEffectType.RecoverInnerInjury:
								this.CalcMedicineEffect_RecoverInjury(ref this._injuries, context.Random, true, ref effect);
								mod.InjuriesChanged = true;
								break;
							case EMedicineEffectType.DetoxPoison:
							{
								sbyte poisonType = effect.PoisonType;
								sbyte poisonLevel = (sbyte)effect.EffectThresholdValue;
								int poisonValue = *(ref this.GetPoisoned().Items.FixedElementField + (IntPtr)poisonType * 4);
								bool flag6 = poisonLevel < PoisonsAndLevels.CalcPoisonedLevel(poisonValue);
								if (!flag6)
								{
									int delta2 = -this.CalcMedicineEffectDelta(poisonValue, effect.EffectValue, effect.EffectIsPercentage);
									bool flag7 = this.OfflineChangePoisoned(poisonType, poisonLevel, delta2);
									if (flag7)
									{
										mod.PoisonedChanged = true;
									}
								}
								break;
							}
							case EMedicineEffectType.ApplyPoison:
							{
								sbyte poisonType2 = medicineCfg.PoisonType;
								sbyte poisonLevel2 = (sbyte)medicineCfg.EffectThresholdValue;
								int delta3 = (int)(PoisonsAndLevels.CalcApplyItemPoisonAmount(medicineCfg.EffectValue, poisonLevel2) / 2 * duration / maxDuration);
								bool flag8 = this.OfflineChangePoisoned(poisonType2, poisonLevel2, delta3);
								if (flag8)
								{
									mod.PoisonedChanged = true;
								}
								break;
							}
							}
						}
					}
				}
			}
		}

		// Token: 0x06006DBC RID: 28092 RVA: 0x003DC364 File Offset: 0x003DA564
		private void OfflineUpdateFeaturePoisons(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			bool flag = !this._featureIds.Contains(637);
			if (!flag)
			{
				int prob = DomainManager.Extra.GetKongsangCharacterFeaturePoisonedProb();
				bool flag2 = prob < GlobalConfig.Instance.KongsangCharacterFeaturePoisonedProbParm[0];
				if (flag2)
				{
					prob = GlobalConfig.Instance.KongsangCharacterFeaturePoisonedProbParm[0];
				}
				bool flag3 = context.Random.CheckPercentProb(prob);
				if (flag3)
				{
					MedicineItem config = Config.Medicine.Instance[51];
					sbyte poisonLevel = (sbyte)config.EffectThresholdValue;
					short delta = PoisonsAndLevels.CalcApplyItemPoisonAmount(config.EffectValue, poisonLevel);
					sbyte poisonType = (sbyte)context.Random.Next(6);
					int range = context.Random.Next(1, 3);
					sbyte poisonType2 = (sbyte)((int)poisonType + range);
					bool flag4 = poisonType2 >= 6;
					if (flag4)
					{
						poisonType2 -= 6;
					}
					sbyte poisonType3 = (sbyte)((int)poisonType2 + range);
					bool flag5 = poisonType3 >= 6;
					if (flag5)
					{
						poisonType3 -= 6;
					}
					bool poison1Change = this.OfflineChangePoisoned(poisonType, poisonLevel, (int)delta);
					bool poison2Change = this.OfflineChangePoisoned(poisonType2, poisonLevel, (int)delta);
					bool poison3Change = this.OfflineChangePoisoned(poisonType3, poisonLevel, (int)delta);
					bool flag6 = poison1Change || poison2Change || poison3Change;
					if (flag6)
					{
						mod.PoisonedChanged = true;
						InstantNotificationCollection instantNotificationCollection = DomainManager.World.GetInstantNotifications();
						bool flag7 = poison1Change;
						if (flag7)
						{
							instantNotificationCollection.AddPoisonIncreased(this._id, poisonType, (int)delta);
						}
						bool flag8 = poison2Change;
						if (flag8)
						{
							instantNotificationCollection.AddPoisonIncreased(this._id, poisonType2, (int)delta);
						}
						bool flag9 = poison3Change;
						if (flag9)
						{
							instantNotificationCollection.AddPoisonIncreased(this._id, poisonType3, (int)delta);
						}
						DomainManager.LifeRecord.GetLifeRecordCollection().AddSpiritualDebtKongsangPoisoned(this._id, DomainManager.World.GetCurrDate());
					}
					prob = GlobalConfig.Instance.KongsangCharacterFeaturePoisonedProbParm[0];
				}
				else
				{
					prob += GlobalConfig.Instance.KongsangCharacterFeaturePoisonedProbParm[1];
				}
				DomainManager.Extra.SetKongsangCharacterFeaturePoisonedProb(prob, context);
			}
		}

		// Token: 0x06006DBD RID: 28093 RVA: 0x003DC53C File Offset: 0x003DA73C
		private unsafe void OfflineAutoRecoverMainAttributes()
		{
			MainAttributes maxMainAttributes = this.GetMaxMainAttributes();
			short physiologicalAge = this.GetPhysiologicalAge();
			int clampedAge = (int)((physiologicalAge <= 100) ? physiologicalAge : 100);
			MainAttributes ageInfluence = AgeEffect.Instance[clampedAge].MainAttributesRecoveries;
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int preserveDay = (this._id != taiwuCharId) ? 0 : (DomainManager.Extra.GetActionPointPrevMonth() / 10);
			for (sbyte i = 0; i < 6; i += 1)
			{
				short maxValue = *(ref maxMainAttributes.Items.FixedElementField + (IntPtr)i * 2);
				int recovery = (int)(maxValue / 5 * *(ref ageInfluence.Items.FixedElementField + (IntPtr)i * 2) / 100);
				recovery = Math.Max(1, recovery * (preserveDay + 100) / 100);
				bool flag = this._id == taiwuCharId;
				if (flag)
				{
					ExtraDomain extraDomain = DomainManager.Extra;
					int professionId = ProfessionRelatedConstants.MainAttributeRecoverProfessionIds[(int)i];
					bool flag2 = extraDomain.IsProfessionalSkillUnlocked(professionId, 0);
					if (flag2)
					{
						ProfessionData professionData = extraDomain.GetProfessionData(professionId);
						recovery = professionData.GetMainAttributesRecoveryBonusAppliedRate(i, recovery);
					}
				}
				int currValue = (int)(*(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)i * 2)) + recovery;
				*(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)i * 2) = (short)Math.Clamp(currValue, 0, (int)maxValue);
			}
		}

		// Token: 0x06006DBE RID: 28094 RVA: 0x003DC690 File Offset: 0x003DA890
		private void OfflineAutoRecoverCurrNeili(PeriAdvanceMonthUpdateStatusModification mod)
		{
			int oriCurrNeili = this._currNeili;
			int maxNeili = this.GetMaxNeili();
			int recovery = this.GetCurrNeiliRecovery(maxNeili);
			recovery = DomainManager.SpecialEffect.ModifyData(this._id, -1, 298, recovery, -1, -1, -1);
			this._currNeili = Math.Clamp(this._currNeili + recovery, 0, maxNeili);
			bool flag = this._currNeili != oriCurrNeili;
			if (flag)
			{
				mod.CurrNeiliChanged = true;
			}
		}

		// Token: 0x06006DBF RID: 28095 RVA: 0x003DC6FC File Offset: 0x003DA8FC
		private void OfflineChangeQiDisorder(PeriAdvanceMonthUpdateStatusModification mod)
		{
			short delta = this.GetChangeOfQiDisorder();
			int currDisorderOfQi = Math.Clamp((int)(this._disorderOfQi + delta), (int)DisorderLevelOfQi.MinValue, (int)DisorderLevelOfQi.MaxValue);
			bool flag = currDisorderOfQi != (int)this._disorderOfQi;
			if (flag)
			{
				this._disorderOfQi = (short)currDisorderOfQi;
				mod.QiDisorderChanged = true;
			}
		}

		// Token: 0x06006DC0 RID: 28096 RVA: 0x003DC74C File Offset: 0x003DA94C
		private unsafe void OfflineChangeInjuries(IRandomSource randomSource, PeriAdvanceMonthUpdateStatusModification mod)
		{
			bool flag = !DomainManager.SpecialEffect.ModifyData(this._id, -1, 269, true, -1, -1, -1);
			if (!flag)
			{
				sbyte month = DomainManager.World.GetCurrMonthInYear();
				List<sbyte> parts = Month.Instance[month].RecoverBodyParts;
				for (int i = 0; i < parts.Count; i++)
				{
					sbyte part = parts[i];
					ValueTuple<sbyte, sbyte> valueTuple = this._injuries.Get(part);
					sbyte outer = valueTuple.Item1;
					sbyte inner = valueTuple.Item2;
					int outerIndex = (int)(part * 2);
					bool flag2 = outer > 0;
					if (flag2)
					{
						*(ref this._injuries.Items.FixedElementField + outerIndex) = outer - 1;
						mod.InjuriesChanged = true;
					}
					bool flag3 = inner > 0;
					if (flag3)
					{
						*(ref this._injuries.Items.FixedElementField + (outerIndex + 1)) = inner - 1;
						mod.InjuriesChanged = true;
					}
				}
			}
		}

		// Token: 0x06006DC1 RID: 28097 RVA: 0x003DC844 File Offset: 0x003DAA44
		private unsafe void OfflineAutoRecoverPoisoned(PeriAdvanceMonthUpdateStatusModification mod)
		{
			ref PoisonInts poisonResists = ref this.GetPoisonResists();
			for (int i = 0; i < 6; i++)
			{
				bool flag = *(ref this._poisoned.Items.FixedElementField + (IntPtr)i * 4) > 0;
				if (flag)
				{
					int cureAmount = 100 + *(ref poisonResists.Items.FixedElementField + (IntPtr)i * 4);
					*(ref this._poisoned.Items.FixedElementField + (IntPtr)i * 4) = Math.Max(*(ref this._poisoned.Items.FixedElementField + (IntPtr)i * 4) - cureAmount, 0);
					mod.PoisonedChanged = true;
				}
			}
		}

		// Token: 0x06006DC2 RID: 28098 RVA: 0x003DC8DC File Offset: 0x003DAADC
		private unsafe void OfflineRecoverAllForXiangshuInfected(PeriAdvanceMonthUpdateStatusModification mod)
		{
			int maxNeili = this.GetMaxNeili();
			bool flag = this._currNeili != maxNeili;
			if (flag)
			{
				this._currNeili = maxNeili;
				mod.CurrNeiliChanged = true;
			}
			bool flag2 = this._disorderOfQi > 0;
			if (flag2)
			{
				this._disorderOfQi = 0;
				mod.QiDisorderChanged = true;
			}
			for (int i = 0; i < 14; i++)
			{
				bool flag3 = *(ref this._injuries.Items.FixedElementField + i) > 0;
				if (flag3)
				{
					*(ref this._injuries.Items.FixedElementField + i) = 0;
					mod.InjuriesChanged = true;
				}
			}
			for (int j = 0; j < 6; j++)
			{
				bool flag4 = *(ref this._poisoned.Items.FixedElementField + (IntPtr)j * 4) > 0;
				if (flag4)
				{
					*(ref this._poisoned.Items.FixedElementField + (IntPtr)j * 4) = 0;
					mod.PoisonedChanged = true;
				}
			}
			MainAttributes maxMainAttributes = this.GetMaxMainAttributes();
			for (int k = 0; k < 6; k++)
			{
				short maxValue = *(ref maxMainAttributes.Items.FixedElementField + (IntPtr)k * 2);
				*(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)k * 2) = maxValue;
			}
		}

		// Token: 0x06006DC3 RID: 28099 RVA: 0x003DCA28 File Offset: 0x003DAC28
		private void OfflineChangeXiangshuInfection(PeriAdvanceMonthUpdateStatusModification mod)
		{
			bool flag = AgeGroup.GetAgeGroup(this._actualAge) != 2;
			if (!flag)
			{
				bool flag2 = this._id != DomainManager.Taiwu.GetTaiwuCharId();
				if (flag2)
				{
					sbyte xiangshuLevel = DomainManager.World.GetXiangshuLevel();
					sbyte maxGrade = GlobalConfig.Instance.XiangshuInfectionGradeUpperLimits[(int)xiangshuLevel];
					bool flag3 = maxGrade < this._organizationInfo.Grade;
					if (flag3)
					{
						return;
					}
				}
				bool flag4 = this.GetLegendaryBookOwnerState() == 3;
				if (!flag4)
				{
					byte oriXiangshuInfection = this._xiangshuInfection;
					sbyte delta = this.GetXiangshuInfectionDelta();
					byte currXiangshuInfection = (byte)Math.Clamp((int)(oriXiangshuInfection + (byte)delta), 0, 200);
					bool flag5 = currXiangshuInfection != oriXiangshuInfection;
					if (flag5)
					{
						this._xiangshuInfection = currXiangshuInfection;
						mod.XiangshuInfectionChanged = true;
					}
					short featureId = XiangshuInfectionTypeHelper.GetInfectionFeatureIdThatShouldBe(currXiangshuInfection);
					bool flag6 = this._featureIds.Contains(featureId);
					if (!flag6)
					{
						bool flag7 = featureId == 218 && this._featureIds.Contains(415);
						if (!flag7)
						{
							bool flag8 = this.IsActiveExternalRelationState(4);
							if (!flag8)
							{
								this.OfflineAddFeature(featureId, true, false);
								mod.FeaturesChanged = true;
								mod.XiangshuInfectionFeatureChanged = featureId;
							}
						}
					}
				}
			}
		}

		// Token: 0x06006DC4 RID: 28100 RVA: 0x003DCB58 File Offset: 0x003DAD58
		private void OfflineIncreaseAge(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			bool flag = this._birthMonth == DomainManager.World.GetCurrMonthInYear();
			if (flag)
			{
				MainAttributes lackOfMainAttributes;
				this.RecordLacksOfCurrMainAttributes(ref lackOfMainAttributes);
				this._actualAge += 1;
				mod.ActualAgeChanged = true;
				bool flag2 = !this.IsAgeIncreaseStopped();
				if (flag2)
				{
					this._currAge += 1;
					mod.CurrAgeChanged = true;
					bool flag3 = this._id != DomainManager.Taiwu.GetTaiwuCharId();
					if (flag3)
					{
						bool flag4 = this._currAge == 1 && context.Random.CheckPercentProb(50);
						if (flag4)
						{
							short featureId = CharacterDomain.GenerateOneYearOldCatchFeature(context.Random);
							this.OfflineAddFeature(featureId, true, false);
							mod.FeaturesChanged = true;
						}
					}
					bool flag5 = DomainManager.SpecialEffect.ModifyData(this._id, -1, 266, false, -1, -1, -1);
					if (flag5)
					{
						this._currAge += 1;
						mod.CurrAgeChanged = true;
					}
				}
				bool flag6 = this._hobbyExpirationDate <= DomainManager.World.GetCurrDate();
				if (flag6)
				{
					this.OfflineChangeHobby(context.Random);
					mod.HobbyChanged = true;
					mod.FavorabilitiesOfRelatedChars = DomainManager.Character.ChangeFavorabilitiesOfAllRelatedCharsWhenChangingHobby(context, this);
				}
				bool currAgeChanged = mod.CurrAgeChanged;
				if (currAgeChanged)
				{
					bool flag7 = this.TryObtainPotentialFeatures();
					if (flag7)
					{
						mod.FeaturesChanged = true;
						mod.RecreateTeammateCommands = true;
					}
					mod.NewClothingTemplateId = this.TryGetNewClothingWhenAgeGroupChanges(context.Random, 0);
				}
				this.OfflineRestoreLacksOfCurrMainAttributes(context, lackOfMainAttributes, mod);
			}
		}

		// Token: 0x06006DC5 RID: 28101 RVA: 0x003DCCE8 File Offset: 0x003DAEE8
		private void OfflineUpdateHealth()
		{
			bool isCompletelyInfected = this.IsCompletelyInfected();
			int healthDelta = (int)(this.GetHealthRecovery(isCompletelyInfected) - 1);
			short leftMaxHealth = this.GetLeftMaxHealth(false);
			this._health = ((leftMaxHealth >= 0) ? ((short)Math.Clamp((int)this._health + healthDelta, 0, (int)leftMaxHealth)) : 0);
		}

		// Token: 0x06006DC6 RID: 28102 RVA: 0x003DCD2C File Offset: 0x003DAF2C
		private unsafe void RecordLacksOfCurrMainAttributes(ref MainAttributes lackOfCurrMainAtributes)
		{
			MainAttributes maxMainAttributes = this.GetMaxMainAttributes();
			for (int i = 0; i < 6; i++)
			{
				short lack = *(ref maxMainAttributes.Items.FixedElementField + (IntPtr)i * 2) - *(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)i * 2);
				*(ref lackOfCurrMainAtributes.Items.FixedElementField + (IntPtr)i * 2) = lack;
			}
		}

		// Token: 0x06006DC7 RID: 28103 RVA: 0x003DCD90 File Offset: 0x003DAF90
		private unsafe void OfflineRestoreLacksOfCurrMainAttributes(DataContext context, MainAttributes lacksOfCurrMainAttributes, PeriAdvanceMonthUpdateStatusModification mod)
		{
			MainAttributes maxMainAttributes = this.GetMaxMainAttributes();
			for (int i = 0; i < 6; i++)
			{
				short currValue = *(ref maxMainAttributes.Items.FixedElementField + (IntPtr)i * 2) - *(ref lacksOfCurrMainAttributes.Items.FixedElementField + (IntPtr)i * 2);
				bool flag = *(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)i * 2) == currValue;
				if (!flag)
				{
					*(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)i * 2) = currValue;
					mod.CurrMainAttributesChanged = true;
				}
			}
		}

		// Token: 0x06006DC8 RID: 28104 RVA: 0x003DCE20 File Offset: 0x003DB020
		private bool TryObtainPotentialFeatures()
		{
			bool flag = this._currAge > 16;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				int potentialFeaturesCount = this._potentialFeatureIds.Count;
				int oriCount = potentialFeaturesCount * (int)(this._currAge - 1) / 16;
				int currCount = potentialFeaturesCount * (int)this._currAge / 16;
				bool flag2 = oriCount >= currCount;
				if (flag2)
				{
					result = false;
				}
				else
				{
					for (int i = oriCount; i < currCount; i++)
					{
						this.OfflineAddFeature(this._potentialFeatureIds[i], true, true);
					}
					result = true;
				}
			}
			return result;
		}

		// Token: 0x06006DC9 RID: 28105 RVA: 0x003DCEAC File Offset: 0x003DB0AC
		private short TryGetNewClothingWhenAgeGroupChanges(IRandomSource random, sbyte shufangAgeChange)
		{
			bool flag = (this._currAge == 16 && shufangAgeChange >= 0) || (shufangAgeChange == 1 && this._currAge == 17);
			short result;
			if (flag)
			{
				bool flag2 = this._kidnapperId >= 0;
				if (flag2)
				{
					result = -2;
				}
				else
				{
					OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
					result = OrganizationDomain.GetRandomOrgMemberClothing(random, orgMemberCfg);
				}
			}
			else
			{
				bool flag3 = (int)this._currAge == GlobalConfig.Instance.AgeBaby;
				if (flag3)
				{
					result = 65;
				}
				else
				{
					result = -1;
				}
			}
			return result;
		}

		// Token: 0x06006DCA RID: 28106 RVA: 0x003DCF30 File Offset: 0x003DB130
		private unsafe void TryGrowAvatarElements(DataContext context)
		{
			short physiologicalAge = this.GetPhysiologicalAge();
			bool gotDates = false;
			bool grownSomething = false;
			AvatarElementsGrownDates dates;
			for (sbyte elementType = 0; elementType < 7; elementType += 1)
			{
				bool flag = this._avatar.GetGrowableElementShowingState(elementType) || !this.IsAbleToGrowAvatarElement(elementType, physiologicalAge);
				if (!flag)
				{
					bool flag2 = !gotDates;
					if (flag2)
					{
						bool flag3 = !DomainManager.Character.TryGetAvatarElementGrowthProgress(this._id, out dates);
						if (flag3)
						{
							break;
						}
						gotDates = true;
					}
					int grownDate = *(ref dates.Items.FixedElementField + (IntPtr)elementType * 4);
					bool flag4 = DomainManager.World.GetCurrDate() < grownDate;
					if (!flag4)
					{
						this._avatar.SetGrowableElementShowingState(elementType);
						*(ref dates.Items.FixedElementField + (IntPtr)elementType * 4) = -1;
						grownSomething = true;
					}
				}
			}
			bool flag5 = grownSomething;
			if (flag5)
			{
				this.SetAvatar(this._avatar, context);
				DomainManager.Character.SetAvatarElementGrowthProgress(context, this._id, ref dates);
			}
		}

		// Token: 0x06006DCB RID: 28107 RVA: 0x003DD034 File Offset: 0x003DB234
		public bool IsAgeIncreaseStopped()
		{
			bool hasSpiritualDebtKongsang = this._featureIds.Contains(637);
			bool flag = this._id == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				bool flag2 = hasSpiritualDebtKongsang;
				if (flag2)
				{
					return true;
				}
				ProfessionData professionData = DomainManager.Extra.GetProfessionData(5);
				TaoistMonkSkillsData skillsData = professionData.GetSkillsData<TaoistMonkSkillsData>();
				bool flag3 = !DomainManager.Extra.IsProfessionalSkillUnlockedAndEquipped(48) && skillsData.HasSurvivedAllTribulation() && !skillsData.ShouldIncreaseAge();
				if (flag3)
				{
					return true;
				}
			}
			else
			{
				bool flag4 = this.IsCompletelyInfected() || this.GetLegendaryBookOwnerState() > 0 || hasSpiritualDebtKongsang;
				if (flag4)
				{
					return true;
				}
			}
			return false;
		}

		// Token: 0x06006DCC RID: 28108 RVA: 0x003DD0E4 File Offset: 0x003DB2E4
		public void PeriAdvanceMonth_ExecuteFixedActions(DataContext context, HashSet<int> currBlockCharSet)
		{
			bool flag = this.IsActiveAdvanceMonthStatus(4);
			if (!flag)
			{
				PeriAdvanceMonthFixedActionModification mod = new PeriAdvanceMonthFixedActionModification(this);
				sbyte ageGroup = this.GetAgeGroup();
				bool flag2 = ageGroup == 0;
				if (flag2)
				{
					bool flag3 = !DomainManager.Taiwu.IsInGroup(this._id);
					if (flag3)
					{
						this.OfflineExecuteFixedAction_Regroup(context.Random, currBlockCharSet, mod);
					}
				}
				else
				{
					bool flag4 = ageGroup == 2;
					if (flag4)
					{
						this.OfflineExecuteFixedAction_MakeLove(context, currBlockCharSet, mod);
					}
					bool flag5 = !DomainManager.Taiwu.IsInGroup(this._id);
					if (flag5)
					{
						this.OfflineExecuteFixedAction_Regroup(context.Random, currBlockCharSet, mod);
					}
					this.OfflineExecuteFixedAction_ReleaseKidnappedCharacters(context.Random, mod);
					this.OfflineExecuteFixedAction_CollectResources(context.Random, mod);
				}
				bool isChanged = mod.IsChanged;
				if (isChanged)
				{
					ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
					recorder.RecordType(ParallelModificationType.PeriAdvanceMonthExecuteFixedActions);
					recorder.RecordParameterClass<PeriAdvanceMonthFixedActionModification>(mod);
				}
			}
		}

		// Token: 0x06006DCD RID: 28109 RVA: 0x003DD1C8 File Offset: 0x003DB3C8
		public static void ComplementPeriAdvanceMonth_ExecuteFixedActions(DataContext context, PeriAdvanceMonthFixedActionModification mod)
		{
			Character character = mod.Character;
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int currDate = DomainManager.World.GetCurrDate();
			Location location = character.GetLocation();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			bool flag = mod.MakeLoveTargetList != null;
			if (flag)
			{
				character.SetFeatureIds(character._featureIds, context);
				foreach (ValueTuple<Character, PeriAdvanceMonthFixedActionModification.MakeLoveState, bool> valueTuple in mod.MakeLoveTargetList)
				{
					Character target = valueTuple.Item1;
					PeriAdvanceMonthFixedActionModification.MakeLoveState state = valueTuple.Item2;
					bool isPregnant = valueTuple.Item3;
					target.SetFeatureIds(target._featureIds, context);
					target.SetHappiness(target._happiness, context);
					switch (state)
					{
					case PeriAdvanceMonthFixedActionModification.MakeLoveState.Legal:
					{
						bool flag2 = target._id == taiwuCharId;
						if (flag2)
						{
							monthlyNotificationCollection.AddMakeLove(character._id, location, target._id);
						}
						break;
					}
					case PeriAdvanceMonthFixedActionModification.MakeLoveState.Illegal:
					case PeriAdvanceMonthFixedActionModification.MakeLoveState.Wug:
					{
						bool flag3 = target._id == taiwuCharId;
						if (flag3)
						{
							monthlyNotificationCollection.AddMakeLove(character._id, location, target._id);
						}
						lifeRecordCollection.AddMakeLoveIllegal(character._id, currDate, target._id, location);
						int secretInfoOffset = secretInformationCollection.AddMakeLoveIllegal(character._id, target._id);
						int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
						break;
					}
					case PeriAdvanceMonthFixedActionModification.MakeLoveState.RapeSucceed:
					{
						lifeRecordCollection.AddRapeSucceed(character._id, currDate, target._id, location);
						DomainManager.Character.AddRelation(context, target._id, character._id, 32768, currDate);
						DomainManager.Character.ChangeFavorabilityOptionalMonthlyEvolution(context, target, character, -30000);
						int secretInfoOffset2 = secretInformationCollection.AddRape(character._id, target._id);
						int secretInfoId2 = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset2, true);
						break;
					}
					case PeriAdvanceMonthFixedActionModification.MakeLoveState.RapeFail:
					{
						bool flag4 = target._id == taiwuCharId;
						if (flag4)
						{
							monthlyNotificationCollection.AddRapeFailure(character._id, location, target._id);
						}
						lifeRecordCollection.AddRapeFail(character._id, currDate, target._id, location);
						DomainManager.Character.AddRelation(context, target._id, character._id, 32768, currDate);
						DomainManager.Character.ChangeFavorabilityOptionalMonthlyEvolution(context, target, character, -30000);
						break;
					}
					}
					Events.RaiseMakeLove(context, character, target, (sbyte)state);
					bool flag5 = !isPregnant;
					if (!flag5)
					{
						bool flag6 = character._gender == 1;
						Character father;
						Character mother;
						if (flag6)
						{
							father = character;
							mother = target;
						}
						else
						{
							father = target;
							mother = character;
						}
						DomainManager.Character.CreatePregnantState(context, mother, father, state == PeriAdvanceMonthFixedActionModification.MakeLoveState.RapeSucceed);
					}
				}
			}
			bool leaveGroup = mod.LeaveGroup;
			if (leaveGroup)
			{
				DomainManager.Character.LeaveGroup(context, character, true);
			}
			bool flag7 = mod.NewGroupLeader >= 0;
			if (flag7)
			{
				character.ApplyFixedAction_JoinGroup(context, mod.NewGroupLeader, mod.NewGroupActionTemplateId);
			}
			bool travelTargetsChanged = mod.TravelTargetsChanged;
			if (travelTargetsChanged)
			{
				character.SetNpcTravelTargets(character._npcTravelTargets, context);
			}
			bool flag8 = mod.ReleaseKidnappedCharList != null;
			if (flag8)
			{
				KidnappedCharacterList kidnappedChars = DomainManager.Character.GetKidnappedCharacters(character._id);
				bool selfIsTaiwuPeople = DomainManager.Character.IsTaiwuPeople(character._id);
				foreach (int charId in mod.ReleaseKidnappedCharList)
				{
					int slotIndex = kidnappedChars.IndexOf(charId);
					lifeRecordCollection.AddReleaseKidnappedCharacter(character._id, currDate, charId, location);
					DomainManager.Character.RemoveKidnappedCharacter(context, character, kidnappedChars, slotIndex, false);
					bool flag9 = selfIsTaiwuPeople || DomainManager.Character.IsTaiwuPeople(charId);
					if (flag9)
					{
						monthlyNotificationCollection.AddReleasePrisoner(character._id, location, charId);
					}
					int secretInfoOffset3 = secretInformationCollection.AddReleaseKidnappedCharacter(character._id, charId);
					DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset3, true);
				}
			}
			bool flag10 = mod.ModifiedMapBlocks != null;
			if (flag10)
			{
				character.SetResources(ref character._resources, context);
				foreach (MapBlockData blockData in mod.ModifiedMapBlocks)
				{
					DomainManager.Map.SetBlockData(context, blockData);
				}
			}
		}

		// Token: 0x06006DCE RID: 28110 RVA: 0x003DD69C File Offset: 0x003DB89C
		private void OfflineExecuteFixedAction_MakeLove(DataContext context, HashSet<int> currBlockCharSet, PeriAdvanceMonthFixedActionModification mod)
		{
			IRandomSource random = context.Random;
			bool flag = SpecialEffectUtils.HasAzureMarrowMakeLoveEffect(this._id);
			if (flag)
			{
				List<int> potentialCharIds = context.AdvanceMonthRelatedData.CharIdList.Occupy();
				foreach (int charId in currBlockCharSet)
				{
					RelatedCharacter selfToTarget;
					RelatedCharacter targetToSelf;
					bool flag2 = !DomainManager.Character.TryGetRelation(this._id, charId, out selfToTarget) || !DomainManager.Character.TryGetRelation(charId, this._id, out targetToSelf);
					if (!flag2)
					{
						bool flag3 = selfToTarget.GetFavorabilityType() < 4 || targetToSelf.GetFavorabilityType() < 4;
						if (!flag3)
						{
							Character targetChar = DomainManager.Character.GetElement_Objects(charId);
							bool flag4 = this._gender == targetChar._gender;
							if (!flag4)
							{
								int successRate = AiHelper.Relation.GetStartRelationSuccessRate_BoyOrGirlFriend(this, targetChar, selfToTarget, targetToSelf, false);
								DomainManager.SpecialEffect.ModifyValue(this._id, 268, successRate, -1, -1, -1, 0, 0, 0, 0);
								successRate = successRate * (int)this.GetFertility() * (int)targetChar.GetFertility() / 10000;
								bool flag5 = random.CheckPercentProb(successRate);
								if (flag5)
								{
									potentialCharIds.Add(charId);
								}
							}
						}
					}
				}
				int targetCharId = potentialCharIds.GetRandomOrDefault(random, -1);
				context.AdvanceMonthRelatedData.CharIdList.Release(ref potentialCharIds);
				bool flag6 = targetCharId >= 0;
				if (flag6)
				{
					Character targetChar2 = DomainManager.Character.GetElement_Objects(targetCharId);
					ValueTuple<Character, Character> parentalInfoOnMakeLove = Character.GetParentalInfoOnMakeLove(this, targetChar2);
					Character father = parentalInfoOnMakeLove.Item1;
					Character mother = parentalInfoOnMakeLove.Item2;
					bool isPregnant = this.OfflineMakeLove(random, father, mother, false);
					if (mod.MakeLoveTargetList == null)
					{
						mod.MakeLoveTargetList = new List<ValueTuple<Character, PeriAdvanceMonthFixedActionModification.MakeLoveState, bool>>();
					}
					mod.MakeLoveTargetList.Add(new ValueTuple<Character, PeriAdvanceMonthFixedActionModification.MakeLoveState, bool>(targetChar2, PeriAdvanceMonthFixedActionModification.MakeLoveState.Wug, isPregnant));
					return;
				}
			}
			bool hasNeedForMakingLove = false;
			for (int i = this._personalNeeds.Count - 1; i >= 0; i--)
			{
				GameData.Domains.Character.Ai.PersonalNeed need = this._personalNeeds[i];
				bool flag7 = need.TemplateId != 23;
				if (!flag7)
				{
					hasNeedForMakingLove = true;
					bool flag8 = currBlockCharSet.Contains(need.CharId);
					if (flag8)
					{
						this.OfflineExecuteFixedAction_MakeLove_Mutual(random, need.CharId, true, mod);
					}
					else
					{
						NpcTravelTarget target = new NpcTravelTarget(need.CharId, 3);
						this.OfflineAddNpcTravelTarget(target);
						mod.TravelTargetsChanged = true;
					}
					CollectionUtils.SwapAndRemove<GameData.Domains.Character.Ai.PersonalNeed>(this._personalNeeds, i);
				}
			}
			bool flag9 = !hasNeedForMakingLove;
			if (flag9)
			{
				foreach (int charId2 in currBlockCharSet)
				{
					RelatedCharacter selfToTarget2;
					bool flag10 = (DomainManager.Character.TryGetRelation(this._id, charId2, out selfToTarget2) && RelationType.HasRelation(selfToTarget2.RelationType, 16384)) || RelationType.HasRelation(selfToTarget2.RelationType, 1024);
					if (flag10)
					{
						this.OfflineExecuteFixedAction_MakeLove_Mutual(random, charId2, false, mod);
					}
				}
			}
		}

		// Token: 0x06006DCF RID: 28111 RVA: 0x003DD9D4 File Offset: 0x003DBBD4
		private void OfflineExecuteFixedAction_MakeLove_Mutual(IRandomSource random, int targetCharId, bool allowRape, PeriAdvanceMonthFixedActionModification mod)
		{
			Character target = DomainManager.Character.GetElement_Objects(targetCharId);
			bool flag = target.GetAgeGroup() != 2;
			if (!flag)
			{
				RelatedCharacter targetToSelf = DomainManager.Character.GetRelation(targetCharId, this._id);
				RelatedCharacter selfToTarget = DomainManager.Character.GetRelation(this._id, targetCharId);
				sbyte selfToTargetFavorType = FavorabilityType.GetFavorabilityType(selfToTarget.Favorability);
				sbyte targetToSelfFavorType = FavorabilityType.GetFavorabilityType(targetToSelf.Favorability);
				ValueTuple<Character, Character> parentalInfoOnMakeLove = Character.GetParentalInfoOnMakeLove(this, target);
				Character father = parentalInfoOnMakeLove.Item1;
				Character mother = parentalInfoOnMakeLove.Item2;
				bool flag2 = RelationType.HasRelation(targetToSelf.RelationType, 1024);
				if (flag2)
				{
					int baseChance = (int)(50 + 50 * (selfToTargetFavorType + targetToSelfFavorType) / 12);
					int rate = baseChance * (int)this.GetFertility() * (int)target.GetFertility() / 10000;
					DomainManager.SpecialEffect.ModifyValue(this._id, 268, rate, -1, -1, -1, 0, 0, 0, 0);
					bool flag3 = random.CheckPercentProb(rate);
					if (flag3)
					{
						if (mod.MakeLoveTargetList == null)
						{
							mod.MakeLoveTargetList = new List<ValueTuple<Character, PeriAdvanceMonthFixedActionModification.MakeLoveState, bool>>();
						}
						mod.MakeLoveTargetList.Add(new ValueTuple<Character, PeriAdvanceMonthFixedActionModification.MakeLoveState, bool>(target, PeriAdvanceMonthFixedActionModification.MakeLoveState.Legal, this.OfflineMakeLove(random, father, mother, false)));
					}
				}
				else
				{
					bool flag4 = RelationType.HasRelation(targetToSelf.RelationType, 16384);
					if (flag4)
					{
						int baseChance2 = (int)(50 + 50 * (selfToTargetFavorType + targetToSelfFavorType) / 12);
						baseChance2 = baseChance2 * (int)AiHelper.FixedActionConstants.BoyAndGirlFriendMakeLoveBaseChance[(int)this.GetBehaviorType()] / 100;
						int rate2 = baseChance2 * (int)this.GetFertility() * (int)target.GetFertility() / 10000;
						rate2 += (int)DomainManager.Extra.GetAiActionRateAdjust(this._id, 4, 1);
						DomainManager.SpecialEffect.ModifyValue(this._id, 268, rate2, -1, -1, -1, 0, 0, 0, 0);
						bool flag5 = rate2 > 0 && random.CheckPercentProb(rate2);
						if (flag5)
						{
							if (mod.MakeLoveTargetList == null)
							{
								mod.MakeLoveTargetList = new List<ValueTuple<Character, PeriAdvanceMonthFixedActionModification.MakeLoveState, bool>>();
							}
							mod.MakeLoveTargetList.Add(new ValueTuple<Character, PeriAdvanceMonthFixedActionModification.MakeLoveState, bool>(target, PeriAdvanceMonthFixedActionModification.MakeLoveState.Illegal, this.OfflineMakeLove(random, father, mother, false)));
						}
					}
					else if (allowRape)
					{
						short fertility = this.GetFertility();
						int rate3 = (int)((short)AiHelper.FixedActionConstants.RapeBaseChance[(int)this.GetBehaviorType()] * fertility / 100);
						rate3 += (int)DomainManager.Extra.GetAiActionRateAdjust(this._id, 4, 3);
						DomainManager.SpecialEffect.ModifyValue(this._id, 268, rate3, -1, -1, -1, 0, 0, 0, 0);
						bool flag6 = rate3 > 0 && random.CheckPercentProb(rate3);
						if (flag6)
						{
							if (mod.MakeLoveTargetList == null)
							{
								mod.MakeLoveTargetList = new List<ValueTuple<Character, PeriAdvanceMonthFixedActionModification.MakeLoveState, bool>>();
							}
							bool flag7 = targetCharId != DomainManager.Taiwu.GetTaiwuCharId() && this.GetCombatPower() > target.GetCombatPower() && fertility > 50;
							if (flag7)
							{
								mod.MakeLoveTargetList.Add(new ValueTuple<Character, PeriAdvanceMonthFixedActionModification.MakeLoveState, bool>(target, PeriAdvanceMonthFixedActionModification.MakeLoveState.RapeSucceed, this.OfflineMakeLove(random, father, mother, true)));
							}
							else
							{
								mod.MakeLoveTargetList.Add(new ValueTuple<Character, PeriAdvanceMonthFixedActionModification.MakeLoveState, bool>(target, PeriAdvanceMonthFixedActionModification.MakeLoveState.RapeFail, false));
							}
						}
					}
				}
			}
		}

		// Token: 0x06006DD0 RID: 28112 RVA: 0x003DDCDC File Offset: 0x003DBEDC
		[return: TupleElementNames(new string[]
		{
			"father",
			"mother"
		})]
		private static ValueTuple<Character, Character> GetParentalInfoOnMakeLove(Character self, Character target)
		{
			return (self._gender == 1) ? new ValueTuple<Character, Character>(self, target) : new ValueTuple<Character, Character>(target, self);
		}

		// Token: 0x06006DD1 RID: 28113 RVA: 0x003DDD08 File Offset: 0x003DBF08
		private bool OfflineMakeLove(IRandomSource random, Character father, Character mother, bool isRape)
		{
			bool flag = mother.GetGender() == father.GetGender();
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				mother.OfflineAddFeature(196, true, false);
				father.OfflineAddFeature(196, true, false);
				bool flag2 = !PregnantState.CheckPregnant(random, father, mother, isRape);
				if (flag2)
				{
					result = false;
				}
				else
				{
					mother.OfflineAddFeature(197, true, false);
					result = true;
				}
			}
			return result;
		}

		// Token: 0x06006DD2 RID: 28114 RVA: 0x003DDD70 File Offset: 0x003DBF70
		private unsafe void OfflineExecuteFixedAction_Regroup(IRandomSource random, HashSet<int> currBlockCharSet, PeriAdvanceMonthFixedActionModification mod)
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			bool flag = this._leaderId == taiwuCharId;
			if (!flag)
			{
				int leaderId = this._leaderId;
				bool flag2 = leaderId == this._id;
				if (flag2)
				{
					bool flag3 = DomainManager.Character.HasNonBabyMemberInGroup(leaderId);
					if (flag3)
					{
						return;
					}
					leaderId = -1;
				}
				sbyte behaviorType = this.GetBehaviorType();
				bool flag4 = this.OfflineExecuteFixedAction_Regroup_PrioritizedAction(random, behaviorType, currBlockCharSet, mod);
				if (!flag4)
				{
					int targetLeaderId = -1;
					for (int i = this._personalNeeds.Count - 1; i >= 0; i--)
					{
						GameData.Domains.Character.Ai.PersonalNeed need = this._personalNeeds[i];
						bool flag5 = need.TemplateId != 20;
						if (!flag5)
						{
							Character targetLeader;
							bool flag6 = !DomainManager.Character.TryGetElement_Objects(need.CharId, out targetLeader);
							if (!flag6)
							{
								targetLeaderId = need.CharId;
								bool flag7 = leaderId < 0;
								if (flag7)
								{
									break;
								}
								bool flag8 = targetLeader._leaderId >= 0;
								if (flag8)
								{
									targetLeaderId = targetLeader._leaderId;
								}
								bool flag9 = leaderId == targetLeaderId;
								if (flag9)
								{
									return;
								}
								mod.LeaveGroup = true;
								return;
							}
						}
					}
					Personalities personalities = this.GetPersonalities();
					sbyte ageGroup = AgeGroup.GetAgeGroup(this._currAge);
					bool flag10 = leaderId >= 0;
					if (flag10)
					{
						RelatedCharacter relation = DomainManager.Character.GetRelation(this._id, leaderId);
						RelatedCharacter targetToSelf = DomainManager.Character.GetRelation(leaderId, this._id);
						sbyte groupRelationType = AiHelper.JoinGroupRelationType.GetJoinGroupRelationType(relation.RelationType, targetToSelf.RelationType);
						sbyte b = ageGroup;
						sbyte b2 = b;
						if (b2 != 0)
						{
							if (b2 == 1)
							{
								if (groupRelationType - 2 <= 1)
								{
									goto IL_1B4;
								}
							}
							sbyte favorabilityType = FavorabilityType.GetFavorabilityType(relation.Favorability);
							bool flag11 = groupRelationType == -1 || favorabilityType < AiHelper.FixedActionConstants.JoinGroupFavorabilityReq[(int)groupRelationType];
							if (flag11)
							{
								mod.LeaveGroup = true;
							}
							else
							{
								int stayInGroupMonth = DomainManager.World.GetCurrDate() - DomainManager.Character.GetElement_JoinGroupDates(this._id);
								bool flag12 = stayInGroupMonth < (int)AiHelper.FixedActionConstants.StayInGroupMonth[(int)groupRelationType];
								if (!flag12)
								{
									int leaveGroupChance = Math.Min((int)AiHelper.FixedActionConstants.MaxLeaveGroupChance[(int)groupRelationType], (stayInGroupMonth - (int)AiHelper.FixedActionConstants.StayInGroupMonth[(int)groupRelationType]) * (int)AiHelper.FixedActionConstants.LeaveGroupChancePerMonth[(int)groupRelationType]);
									bool flag13 = !random.CheckPercentProb(leaveGroupChance);
									if (!flag13)
									{
										mod.LeaveGroup = true;
									}
								}
							}
						}
						IL_1B4:;
					}
					else
					{
						bool flag14 = targetLeaderId >= 0;
						if (flag14)
						{
							bool flag15 = currBlockCharSet.Contains(targetLeaderId) && !DomainManager.Taiwu.IsInGroup(targetLeaderId);
							if (flag15)
							{
								mod.NewGroupLeader = targetLeaderId;
							}
							else
							{
								NpcTravelTarget target = new NpcTravelTarget(targetLeaderId, 3);
								this.OfflineAddNpcTravelTarget(target);
								mod.TravelTargetsChanged = true;
							}
						}
						else
						{
							bool flag16 = currBlockCharSet.Count > 0;
							if (flag16)
							{
								List<ValueTuple<Character, RelatedCharacter>>[] groupTypes = new List<ValueTuple<Character, RelatedCharacter>>[7];
								for (int j = 0; j < 7; j++)
								{
									groupTypes[j] = new List<ValueTuple<Character, RelatedCharacter>>();
								}
								foreach (int charId in currBlockCharSet)
								{
									bool flag17 = DomainManager.Taiwu.IsInGroup(charId);
									if (!flag17)
									{
										RelatedCharacter relation2;
										RelatedCharacter targetToSelf2;
										bool flag18 = !DomainManager.Character.TryGetRelation(this._id, charId, out relation2) || !DomainManager.Character.TryGetRelation(charId, this._id, out targetToSelf2);
										if (!flag18)
										{
											sbyte groupRelationType2 = AiHelper.JoinGroupRelationType.GetJoinGroupRelationType(relation2.RelationType, targetToSelf2.RelationType);
											bool flag19 = groupRelationType2 == -1;
											if (!flag19)
											{
												Character character = DomainManager.Character.GetElement_Objects(charId);
												bool flag20 = character.GetAgeGroup() == 0;
												if (!flag20)
												{
													bool flag21 = character.GetLegendaryBookOwnerState() >= 2;
													if (!flag21)
													{
														sbyte b3 = ageGroup;
														sbyte b4 = b3;
														if (b4 != 0)
														{
															if (b4 == 1)
															{
																if (groupRelationType2 - 2 <= 1)
																{
																	bool flag22 = character.GetCurrAge() > this._currAge;
																	if (flag22)
																	{
																		groupTypes[(int)groupRelationType2].Add(new ValueTuple<Character, RelatedCharacter>(character, relation2));
																	}
																	continue;
																}
															}
															sbyte favorabilityType2 = FavorabilityType.GetFavorabilityType(relation2.Favorability);
															bool flag23 = favorabilityType2 < AiHelper.FixedActionConstants.JoinGroupFavorabilityReq[(int)groupRelationType2];
															if (!flag23)
															{
																Comparison<ValueTuple<Character, RelatedCharacter>> comparison = AiHelper.JoinGroupRelationType.Comparisons[(int)groupRelationType2];
																bool flag24 = groupRelationType2 - 1 <= 1;
																bool flag25 = !flag24 && comparison(new ValueTuple<Character, RelatedCharacter>(this, targetToSelf2), new ValueTuple<Character, RelatedCharacter>(character, relation2)) > 0;
																if (!flag25)
																{
																	groupTypes[(int)groupRelationType2].Add(new ValueTuple<Character, RelatedCharacter>(character, relation2));
																}
															}
														}
														else
														{
															bool flag24 = groupRelationType2 - 1 <= 2;
															bool flag26 = !flag24;
															if (!flag26)
															{
																bool flag27 = character.GetCurrAge() > this._currAge;
																if (flag27)
																{
																	groupTypes[(int)groupRelationType2].Add(new ValueTuple<Character, RelatedCharacter>(character, relation2));
																}
															}
														}
													}
												}
											}
										}
									}
								}
								sbyte b5 = ageGroup;
								sbyte b6 = b5;
								if (b6 != 0)
								{
									if (b6 == 1)
									{
										bool flag28 = groupTypes[2].Count > 0;
										if (flag28)
										{
											List<ValueTuple<Character, RelatedCharacter>> potentialLeaders = groupTypes[2];
											Comparison<ValueTuple<Character, RelatedCharacter>> comparison2 = AiHelper.JoinGroupRelationType.Comparisons[2];
											Character character2 = potentialLeaders.Max(comparison2).Item1;
											mod.NewGroupLeader = character2._id;
											return;
										}
										bool flag29 = groupTypes[3].Count > 0;
										if (flag29)
										{
											List<ValueTuple<Character, RelatedCharacter>> potentialLeaders2 = groupTypes[3];
											Comparison<ValueTuple<Character, RelatedCharacter>> comparison3 = AiHelper.JoinGroupRelationType.Comparisons[3];
											Character character3 = potentialLeaders2.Max(comparison3).Item1;
											mod.NewGroupLeader = character3._id;
											return;
										}
									}
									foreach (sbyte groupRelationType3 in AiHelper.JoinGroupRelationType.Priorities[(int)behaviorType])
									{
										List<ValueTuple<Character, RelatedCharacter>> potentialLeaders3 = groupTypes[(int)groupRelationType3];
										bool flag30 = potentialLeaders3.Count == 0;
										if (!flag30)
										{
											sbyte personalityType = AiHelper.JoinGroupRelationType.ToPersonalityType[(int)groupRelationType3];
											int joinGroupChance = (int)(AiHelper.FixedActionConstants.JoinGroupBaseChance[(int)behaviorType] + *(ref personalities.Items.FixedElementField + personalityType));
											bool flag31 = random.CheckPercentProb(joinGroupChance);
											if (!flag31)
											{
												bool flag24 = groupRelationType3 - 1 <= 1;
												bool flag32 = flag24;
												if (flag32)
												{
													Comparison<ValueTuple<Character, RelatedCharacter>> comparison4 = AiHelper.JoinGroupRelationType.Comparisons[(int)groupRelationType3];
													Character character4 = potentialLeaders3.Max(comparison4).Item1;
													mod.NewGroupLeader = character4._id;
													break;
												}
												Character character5 = potentialLeaders3.GetRandom(random).Item1;
												mod.NewGroupLeader = character5._id;
												break;
											}
										}
									}
								}
								else
								{
									bool flag33 = groupTypes[2].Count > 0;
									if (flag33)
									{
										List<ValueTuple<Character, RelatedCharacter>> potentialLeaders4 = groupTypes[2];
										Comparison<ValueTuple<Character, RelatedCharacter>> comparison5 = AiHelper.JoinGroupRelationType.Comparisons[2];
										Character character6 = potentialLeaders4.Max(comparison5).Item1;
										mod.NewGroupLeader = character6._id;
									}
									else
									{
										bool flag34 = groupTypes[3].Count > 0;
										if (flag34)
										{
											List<ValueTuple<Character, RelatedCharacter>> potentialLeaders5 = groupTypes[3];
											Comparison<ValueTuple<Character, RelatedCharacter>> comparison6 = AiHelper.JoinGroupRelationType.Comparisons[3];
											Character character7 = potentialLeaders5.Max(comparison6).Item1;
											mod.NewGroupLeader = character7._id;
										}
										else
										{
											bool flag35 = groupTypes[1].Count > 0;
											if (flag35)
											{
												List<ValueTuple<Character, RelatedCharacter>> potentialLeaders6 = groupTypes[1];
												Comparison<ValueTuple<Character, RelatedCharacter>> comparison7 = AiHelper.JoinGroupRelationType.Comparisons[1];
												Character character8 = potentialLeaders6.Max(comparison7).Item1;
												mod.NewGroupLeader = character8._id;
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06006DD3 RID: 28115 RVA: 0x003DE4FC File Offset: 0x003DC6FC
		private bool OfflineExecuteFixedAction_Regroup_PrioritizedAction(IRandomSource random, sbyte behaviorType, HashSet<int> currBlockCharSet, PeriAdvanceMonthFixedActionModification mod)
		{
			BasePrioritizedAction selfAction;
			bool flag = !DomainManager.Character.TryGetCharacterPrioritizedAction(this._id, out selfAction);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				PrioritizedActionsItem actionCfg = PrioritizedActions.Instance[selfAction.ActionType];
				bool flag2 = this._leaderId >= 0;
				if (flag2)
				{
					BasePrioritizedAction leaderAction;
					bool flag3 = DomainManager.Character.TryGetCharacterPrioritizedAction(this._leaderId, out leaderAction) && leaderAction.CanJointActionWith(selfAction);
					if (flag3)
					{
						return true;
					}
					mod.LeaveGroup = true;
				}
				bool flag4 = !random.CheckPercentProb((int)actionCfg.ActionJointChance[(int)behaviorType]);
				if (flag4)
				{
					result = true;
				}
				else
				{
					foreach (int charId in currBlockCharSet)
					{
						BasePrioritizedAction targetAction;
						bool flag5 = !DomainManager.Character.TryGetCharacterPrioritizedAction(charId, out targetAction) || !targetAction.CanJointActionWith(selfAction);
						if (!flag5)
						{
							bool flag6 = DomainManager.Taiwu.IsInGroup(charId);
							if (!flag6)
							{
								RelatedCharacter relation;
								RelatedCharacter targetToSelf;
								bool flag7 = !DomainManager.Character.TryGetRelation(this._id, charId, out relation) || !DomainManager.Character.TryGetRelation(charId, this._id, out targetToSelf);
								if (!flag7)
								{
									bool flag8 = RelationType.HasRelation(relation.RelationType, 32768) || RelationType.HasRelation(targetToSelf.RelationType, 32768);
									if (!flag8)
									{
										Character blockChar = DomainManager.Character.GetElement_Objects(charId);
										int blockCharLeaderId = blockChar.GetLeaderId();
										bool flag9 = blockCharLeaderId >= 0 && blockCharLeaderId != charId;
										if (!flag9)
										{
											sbyte targetBehaviorType = blockChar.GetBehaviorType();
											bool flag10 = random.CheckPercentProb((int)actionCfg.ActionJointChance[(int)targetBehaviorType]);
											if (!flag10)
											{
												mod.NewGroupLeader = charId;
												mod.NewGroupActionTemplateId = selfAction.ActionType;
												break;
											}
										}
									}
								}
							}
						}
					}
					result = true;
				}
			}
			return result;
		}

		// Token: 0x06006DD4 RID: 28116 RVA: 0x003DE70C File Offset: 0x003DC90C
		private void OfflineExecuteFixedAction_ReleaseKidnappedCharacters(IRandomSource random, PeriAdvanceMonthFixedActionModification mod)
		{
			bool flag = !this.IsActiveExternalRelationState(2);
			if (!flag)
			{
				KidnappedCharacterList kidnappedCharList = DomainManager.Character.GetKidnappedCharacters(this._id);
				sbyte behaviorType = this.GetBehaviorType();
				sbyte releaseThreshold = AiHelper.FixedActionConstants.ReleaseKidnappedCharResistanceThreshold[(int)behaviorType];
				sbyte releaseBaseChance = AiHelper.FixedActionConstants.ReleaseKidnappedCharChance[(int)behaviorType];
				Character kidnapper = DomainManager.Character.GetElement_Objects(this._id);
				foreach (KidnappedCharacter kidnappedChar in kidnappedCharList.GetCollection())
				{
					int totalResistance = DomainManager.Character.CalcKidnappedCharacterTotalResistance(kidnapper, kidnappedChar);
					bool flag2 = totalResistance < (int)releaseThreshold;
					if (!flag2)
					{
						short favorability = DomainManager.Character.GetFavorability(this._id, kidnappedChar.CharId);
						int releaseChance = (int)(releaseBaseChance + FavorabilityType.GetFavorabilityType(favorability) * 5);
						bool flag3 = random.CheckPercentProb(releaseChance);
						if (flag3)
						{
							if (mod.ReleaseKidnappedCharList == null)
							{
								mod.ReleaseKidnappedCharList = new List<int>();
							}
							mod.ReleaseKidnappedCharList.Add(kidnappedChar.CharId);
						}
					}
				}
			}
		}

		// Token: 0x06006DD5 RID: 28117 RVA: 0x003DE834 File Offset: 0x003DCA34
		private unsafe void OfflineExecuteFixedAction_CollectResources(IRandomSource random, PeriAdvanceMonthFixedActionModification mod)
		{
			foreach (GameData.Domains.Character.Ai.PersonalNeed need in this._personalNeeds)
			{
				bool flag = need.TemplateId != 8;
				if (!flag)
				{
					bool flag2 = need.ResourceType >= 6;
					if (!flag2)
					{
						MapBlockData block = DomainManager.Map.GetBlock(this._location);
						short currentResource = *(ref block.CurrResources.Items.FixedElementField + (IntPtr)need.ResourceType * 2);
						bool flag3 = currentResource < *(ref block.MaxResources.Items.FixedElementField + (IntPtr)need.ResourceType * 2) / 2;
						if (!flag3)
						{
							int addResource = DomainManager.Map.GetCollectResourceAmount(random, block, need.ResourceType);
							*(ref this._resources.Items.FixedElementField + (IntPtr)need.ResourceType * 4) += addResource;
							ResourceTypeItem resourceConfig = ResourceType.Instance[need.ResourceType];
							*(ref block.CurrResources.Items.FixedElementField + (IntPtr)need.ResourceType * 2) = (short)Math.Max((int)(currentResource - (short)resourceConfig.ResourceReducePerCollection), 0);
							MapBlockData mapBlockData = block;
							mapBlockData.Malice += 10;
							if (mod.ModifiedMapBlocks == null)
							{
								mod.ModifiedMapBlocks = new List<MapBlockData>();
							}
							mod.ModifiedMapBlocks.Add(block);
						}
					}
				}
			}
		}

		// Token: 0x06006DD6 RID: 28118 RVA: 0x003DE9C4 File Offset: 0x003DCBC4
		private void ApplyFixedAction_JoinGroup(DataContext context, int newGroupLeader, short actionTemplateId)
		{
			Character targetLeader = DomainManager.Character.GetElement_Objects(newGroupLeader);
			bool flag = this._leaderId == this._id;
			if (flag)
			{
				bool flag2 = DomainManager.Character.HasNonBabyMemberInGroup(this._leaderId);
				if (flag2)
				{
					return;
				}
				CharacterSet prevGroup = DomainManager.Character.GetGroup(this._leaderId);
				HashSet<int> toRemoveGroupChars = context.AdvanceMonthRelatedData.RelatedCharIds.Occupy();
				toRemoveGroupChars.UnionWith(prevGroup.GetCollection());
				toRemoveGroupChars.Remove(this._id);
				foreach (int memberId in toRemoveGroupChars)
				{
					Character memberChar = DomainManager.Character.GetElement_Objects(memberId);
					Tester.Assert(memberChar.GetAgeGroup() == 0, "");
					DomainManager.Character.LeaveGroup(context, memberChar, true);
					DomainManager.Character.JoinGroup(context, memberChar, targetLeader);
				}
				context.AdvanceMonthRelatedData.RelatedCharIds.Release(ref toRemoveGroupChars);
			}
			DomainManager.LifeRecord.GetLifeRecordCollection().AddTeamUp(this, targetLeader, actionTemplateId, true);
			DomainManager.Character.JoinGroup(context, this, targetLeader);
		}

		// Token: 0x06006DD7 RID: 28119 RVA: 0x003DEB04 File Offset: 0x003DCD04
		public void PeriAdvanceMonth_ExecuteGeneralAction(DataContext context, HashSet<int> currBlockChars, HashSet<int> currBlockGraves)
		{
			bool flag = this.GetAgeGroup() == 0;
			if (!flag)
			{
				bool flag2 = currBlockChars.Count <= 1 && currBlockGraves == null;
				if (!flag2)
				{
					bool flag3 = this.IsActiveAdvanceMonthStatus(1);
					if (!flag3)
					{
						PeriAdvanceMonthGeneralActionModification mod = new PeriAdvanceMonthGeneralActionModification(this);
						bool isEnergiesChanged = this.OfflineRecoverActionEnergies();
						HashSet<int> caringCharIds = context.AdvanceMonthRelatedData.CaringCharIds.Occupy();
						this.GetAllCaringCharsInSet(currBlockChars, caringCharIds);
						foreach (GameData.Domains.Character.Ai.PersonalNeed personalNeed in this._personalNeeds)
						{
							bool flag4 = !personalNeed.CheckValid(this);
							if (!flag4)
							{
								switch (personalNeed.TemplateId)
								{
								case 0:
								{
									bool flag5 = currBlockChars.Count > 1;
									if (flag5)
									{
										this.OfflineCalcGeneralAction_IncreaseHappiness(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 1:
								{
									bool flag6 = currBlockChars.Count > 1;
									if (flag6)
									{
										this.OfflineCalcGeneralAction_IncreaseHealth(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 2:
								{
									bool flag7 = currBlockChars.Count > 1;
									if (flag7)
									{
										this.OfflineCalcGeneralAction_RestoreDisorderOfQi(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 3:
								{
									bool flag8 = currBlockChars.Count > 1;
									if (flag8)
									{
										this.OfflineCalcGeneralAction_IncreaseNeili(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 4:
								{
									bool flag9 = currBlockChars.Count > 1;
									if (flag9)
									{
										this.OfflineCalcGeneralAction_HealInjury(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 5:
								{
									bool flag10 = currBlockChars.Count > 1;
									if (flag10)
									{
										this.OfflineCalcGeneralAction_DetoxPoison(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 6:
								{
									bool flag11 = currBlockChars.Count > 1;
									if (flag11)
									{
										this.OfflineCalcGeneralAction_RecoverMainAttribute(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 7:
								{
									bool flag12 = currBlockChars.Count > 1;
									if (flag12)
									{
										this.OfflineCalcGeneralAction_KillWug(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 8:
									this.OfflineCalcGeneralAction_GainResource(context, mod, currBlockChars, currBlockGraves, personalNeed);
									break;
								case 9:
								{
									bool flag13 = currBlockChars.Count > 1;
									if (flag13)
									{
										this.OfflineCalcGeneralAction_SpendResource(context, mod, currBlockChars, caringCharIds, personalNeed);
									}
									break;
								}
								case 10:
									this.OfflineCalcGeneralAction_GainItem(context, mod, currBlockChars, currBlockGraves, personalNeed);
									break;
								case 11:
								{
									bool flag14 = currBlockChars.Count > 1;
									if (flag14)
									{
										this.OfflineCalcGeneralAction_RepairItem(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 12:
								{
									bool flag15 = currBlockChars.Count > 1;
									if (flag15)
									{
										this.OfflineCalcGeneralAction_AddPoisonToItem(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 13:
								{
									bool flag16 = currBlockChars.Count > 1;
									if (flag16)
									{
										this.OfflineCalcGeneralAction_SpendItem(context, mod, currBlockChars, caringCharIds, personalNeed);
									}
									break;
								}
								case 14:
								{
									bool flag17 = currBlockChars.Count > 1;
									if (flag17)
									{
										this.OfflineCalcGeneralAction_LearnCombatSkill(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 15:
								{
									bool flag18 = currBlockChars.Count > 1;
									if (flag18)
									{
										this.OfflineCalcGeneralAction_LearnLifeSkill(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 16:
									this.OfflineCalcGeneralAction_GainExp(context, mod, currBlockChars, personalNeed);
									break;
								case 17:
								{
									bool flag19 = currBlockChars.Count > 1;
									if (flag19)
									{
										this.OfflineCalcGeneralAction_AskHelpOnReading(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								case 18:
								{
									bool flag20 = currBlockChars.Count > 1;
									if (flag20)
									{
										this.OfflineCalcGeneralAction_AskHelpOnBreaking(context, mod, currBlockChars, personalNeed);
									}
									break;
								}
								}
							}
						}
						bool flag21 = currBlockChars.Count > 1;
						if (flag21)
						{
							this.OfflineCalcGeneralAction_RandomActions(context, mod, currBlockChars, caringCharIds);
						}
						context.AdvanceMonthRelatedData.CaringCharIds.Release(ref caringCharIds);
						bool flag22 = mod.IsChanged || isEnergiesChanged;
						if (flag22)
						{
							ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
							recorder.RecordType(ParallelModificationType.PeriAdvanceMonthExecuteGeneralActions);
							recorder.RecordParameterClass<PeriAdvanceMonthGeneralActionModification>(mod);
						}
					}
				}
			}
		}

		// Token: 0x06006DD8 RID: 28120 RVA: 0x003DEECC File Offset: 0x003DD0CC
		public static void ComplementPeriAdvanceMonth_ExecuteGeneralActions(DataContext context, PeriAdvanceMonthGeneralActionModification mod)
		{
			Character character = mod.Character;
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			foreach (ValueTuple<Character, IGeneralAction> valueTuple in mod.PerformedActions)
			{
				Character targetChar = valueTuple.Item1;
				IGeneralAction performAction = valueTuple.Item2;
				bool flag = !Character.CanPerformAction(character);
				if (flag)
				{
					return;
				}
				bool flag2 = (targetChar == null || Character.CanPerformAction(targetChar)) && performAction.CheckValid(character, targetChar);
				if (flag2)
				{
					bool flag3 = targetChar != null && targetChar.GetId() == taiwuCharId;
					if (flag3)
					{
						performAction.ApplyInitialChangesForTaiwu(context, character, targetChar);
					}
					else
					{
						performAction.ApplyChanges(context, character, targetChar);
					}
				}
				else
				{
					character._actionEnergies.Change(performAction.ActionEnergyType, 100);
				}
			}
			character.SetActionEnergies(character._actionEnergies, context);
		}

		// Token: 0x06006DD9 RID: 28121 RVA: 0x003DEFC8 File Offset: 0x003DD1C8
		private static bool CanPerformAction(Character character)
		{
			return DomainManager.Character.IsCharacterAlive(character._id) && character._kidnapperId < 0;
		}

		// Token: 0x06006DDA RID: 28122 RVA: 0x003DEFF8 File Offset: 0x003DD1F8
		private unsafe bool OfflineRecoverActionEnergies()
		{
			sbyte behaviorType = this.GetBehaviorType();
			Personalities personalities = this.GetPersonalities();
			byte[] energyTypesRecoverSpeed = AiHelper.GeneralActionConstants.EnergyGainSpeed[(int)behaviorType];
			bool isChanged = false;
			for (sbyte actionEnergyType = 0; actionEnergyType < 5; actionEnergyType += 1)
			{
				bool flag = *(ref this._actionEnergies.Items.FixedElementField + actionEnergyType) >= 200;
				if (!flag)
				{
					sbyte personalityType = ActionEnergyType.ToPersonalityType[(int)actionEnergyType];
					int recoverAmount = (int)(energyTypesRecoverSpeed[(int)actionEnergyType] + (byte)(*(ref personalities.Items.FixedElementField + personalityType)));
					*(ref this._actionEnergies.Items.FixedElementField + actionEnergyType) = (byte)Math.Clamp((int)(*(ref this._actionEnergies.Items.FixedElementField + actionEnergyType)) + recoverAmount, 0, 200);
					isChanged = true;
				}
			}
			return isChanged;
		}

		// Token: 0x06006DDB RID: 28123 RVA: 0x003DF0C4 File Offset: 0x003DD2C4
		private unsafe void OfflineCalcGeneralAction_HealInjury(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(0);
			if (!flag)
			{
				sbyte minLevel = sbyte.MaxValue;
				sbyte totalLevel = 0;
				for (sbyte bodyPart = 0; bodyPart < 7; bodyPart += 1)
				{
					sbyte injuryLevel = this._injuries.Get(bodyPart, personalNeed.InjuryType == 1);
					totalLevel += injuryLevel;
					bool flag2 = injuryLevel > 0 && injuryLevel < minLevel;
					if (flag2)
					{
						minLevel = injuryLevel;
					}
				}
				EMedicineEffectType requiredEffectType = (personalNeed.InjuryType == 1) ? EMedicineEffectType.RecoverInnerInjury : EMedicineEffectType.RecoverOuterInjury;
				Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
				{
					foreach (ItemKey itemKey in character._inventory.Items.Keys)
					{
						bool flag7 = itemKey.ItemType != 8;
						if (!flag7)
						{
							MedicineItem medicineCfg = Config.Medicine.Instance[itemKey.TemplateId];
							bool flag8 = medicineCfg.EffectType != requiredEffectType;
							if (!flag8)
							{
								bool flag9 = this.TryDetectAttachedPoisons(itemKey);
								if (!flag9)
								{
									bool flag10 = medicineCfg.RequiredMainAttributeType >= 0 && *this._currMainAttributes[(int)medicineCfg.RequiredMainAttributeType] < (short)medicineCfg.RequiredMainAttributeValue;
									if (!flag10)
									{
										bool flag11 = medicineCfg.Duration > 0 && this._eatingItems.GetAvailableEatingSlot(this.GetCurrMaxEatingSlotsCount()) < 0;
										if (!flag11)
										{
											return true;
										}
									}
								}
							}
						}
					}
					return false;
				}, false);
				bool flag3 = targetChar == null;
				if (!flag3)
				{
					ItemKey selectedItemKey = ItemKey.Invalid;
					context.AdvanceMonthRelatedData.CategorizedRegenItems(targetChar._inventory.Items);
					List<ValueTuple<GameData.Domains.Item.Medicine, int>>[] categorizedMedicines = context.AdvanceMonthRelatedData.CategorizedMedicines.Get();
					List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines = (personalNeed.InjuryType == 1) ? categorizedMedicines[1] : categorizedMedicines[0];
					medicines.Sort(EatingItemComparer.MedicineInjury);
					int selectedIndex = this.SelectTopicalMedicineIndex(medicines, minLevel, ref this._currMainAttributes, null);
					bool flag4 = selectedIndex >= 0;
					if (flag4)
					{
						GameData.Domains.Item.Medicine medicine = medicines[selectedIndex].Item1;
						selectedItemKey = medicine.GetItemKey();
					}
					else
					{
						selectedIndex = this.SelectMedicineIndexForInjury(medicines, minLevel, totalLevel, null);
						bool flag5 = selectedIndex >= 0;
						if (flag5)
						{
							GameData.Domains.Item.Medicine medicine2 = medicines[selectedIndex].Item1;
							selectedItemKey = medicine2.GetItemKey();
						}
					}
					context.AdvanceMonthRelatedData.ReleaseCategorizedRegenItems();
					bool flag6 = !selectedItemKey.IsValid();
					if (flag6)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(65, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Fail to find valid medicine for injury ");
						defaultInterpolatedStringHandler.AppendFormatted<sbyte>(personalNeed.InjuryType);
						defaultInterpolatedStringHandler.AppendLiteral(" in ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
						defaultInterpolatedStringHandler.AppendLiteral("'s inventory to cure ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					sbyte targetBehaviorType = targetChar.GetBehaviorType();
					short favorability = DomainManager.Character.GetFavorability(targetChar.GetId(), this._id);
					sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
					sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestHealInjuryAction
					{
						ItemUsed = selectedItemKey,
						IsInnerInjury = (personalNeed.InjuryType == 1),
						AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
					}));
					this._actionEnergies.SpendEnergyOnAction(0);
				}
			}
		}

		// Token: 0x06006DDC RID: 28124 RVA: 0x003DF35C File Offset: 0x003DD55C
		private unsafe void OfflineCalcGeneralAction_DetoxPoison(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(0);
			if (!flag)
			{
				int poisonVal = *(ref this._poisoned.Items.FixedElementField + (IntPtr)personalNeed.PoisonType * 4);
				sbyte poisonLevel = PoisonsAndLevels.CalcPoisonedLevel(*(ref this._poisoned.Items.FixedElementField + (IntPtr)personalNeed.PoisonType * 4));
				Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
				{
					foreach (ItemKey itemKey in character._inventory.Items.Keys)
					{
						bool flag5 = itemKey.ItemType != 8;
						if (!flag5)
						{
							MedicineItem medicineCfg = Config.Medicine.Instance[itemKey.TemplateId];
							bool flag6 = medicineCfg.DetoxPoisonType != personalNeed.PoisonType;
							if (!flag6)
							{
								short threshold = medicineCfg.EffectThresholdValue;
								bool flag7 = threshold < (short)poisonLevel;
								if (!flag7)
								{
									bool flag8 = this.TryDetectAttachedPoisons(itemKey);
									if (!flag8)
									{
										return true;
									}
								}
							}
						}
					}
					return false;
				}, false);
				bool flag2 = targetChar == null;
				if (!flag2)
				{
					ItemKey selectedItemKey = ItemKey.Invalid;
					context.AdvanceMonthRelatedData.CategorizedRegenItems(targetChar._inventory.Items);
					List<ValueTuple<GameData.Domains.Item.Medicine, int>>[] categorizedMedicines = context.AdvanceMonthRelatedData.CategorizedMedicines.Get();
					List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines = categorizedMedicines[4];
					medicines.Sort(new Comparison<ValueTuple<GameData.Domains.Item.Medicine, int>>(this.CompareDetoxPoisonMedicines));
					int selectedIndex = this.SelectMedicineIndexForDetoxPoison(medicines, personalNeed.PoisonType, poisonLevel, poisonVal, null);
					bool flag3 = selectedIndex >= 0;
					if (flag3)
					{
						GameData.Domains.Item.Medicine medicine = medicines[selectedIndex].Item1;
						selectedItemKey = medicine.GetItemKey();
					}
					context.AdvanceMonthRelatedData.ReleaseCategorizedRegenItems();
					bool flag4 = !selectedItemKey.IsValid();
					if (flag4)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(64, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Fail to find valid medicine for detox ");
						defaultInterpolatedStringHandler.AppendFormatted<sbyte>(personalNeed.PoisonType);
						defaultInterpolatedStringHandler.AppendLiteral(" in ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
						defaultInterpolatedStringHandler.AppendLiteral("'s inventory to cure ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					sbyte targetBehaviorType = targetChar.GetBehaviorType();
					short favorability = DomainManager.Character.GetFavorability(targetChar.GetId(), this._id);
					sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
					sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestDetoxPoisonAction
					{
						ItemUsed = selectedItemKey,
						PoisonType = personalNeed.PoisonType,
						AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
					}));
					this._actionEnergies.SpendEnergyOnAction(0);
				}
			}
		}

		// Token: 0x06006DDD RID: 28125 RVA: 0x003DF5A8 File Offset: 0x003DD7A8
		private void OfflineCalcGeneralAction_IncreaseHealth(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(0);
			if (!flag)
			{
				short leftMaxHealth = this.GetLeftMaxHealth(false);
				Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
				{
					foreach (ItemKey itemKey in character._inventory.Items.Keys)
					{
						bool flag5 = itemKey.ItemType != 8;
						if (!flag5)
						{
							MedicineItem medicineCfg = Config.Medicine.Instance[itemKey.TemplateId];
							bool flag6 = medicineCfg.EffectType != EMedicineEffectType.RecoverHealth;
							if (!flag6)
							{
								bool flag7 = this.TryDetectAttachedPoisons(itemKey);
								if (!flag7)
								{
									return true;
								}
							}
						}
					}
					return false;
				}, false);
				bool flag2 = targetChar == null;
				if (!flag2)
				{
					ItemKey selectedItemKey = ItemKey.Invalid;
					context.AdvanceMonthRelatedData.CategorizedRegenItems(targetChar._inventory.Items);
					List<ValueTuple<GameData.Domains.Item.Medicine, int>>[] categorizedMedicines = context.AdvanceMonthRelatedData.CategorizedMedicines.Get();
					List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines = categorizedMedicines[2];
					medicines.Sort(EatingItemComparer.MedicineEffect);
					int selectedIndex = this.SelectMedicineIndexForHealth(medicines, this._health, leftMaxHealth, null);
					bool flag3 = selectedIndex >= 0;
					if (flag3)
					{
						GameData.Domains.Item.Medicine medicine = medicines[selectedIndex].Item1;
						selectedItemKey = medicine.GetItemKey();
					}
					context.AdvanceMonthRelatedData.ReleaseCategorizedRegenItems();
					bool flag4 = !selectedItemKey.IsValid();
					if (flag4)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(64, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Fail to find valid medicine for health in ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
						defaultInterpolatedStringHandler.AppendLiteral("'s inventory to cure ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					sbyte targetBehaviorType = targetChar.GetBehaviorType();
					short favorability = DomainManager.Character.GetFavorability(targetChar.GetId(), this._id);
					sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
					sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestIncreaseHealthAction
					{
						ItemUsed = selectedItemKey,
						AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
					}));
					this._actionEnergies.SpendEnergyOnAction(0);
				}
			}
		}

		// Token: 0x06006DDE RID: 28126 RVA: 0x003DF758 File Offset: 0x003DD958
		private void OfflineCalcGeneralAction_RestoreDisorderOfQi(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(0);
			if (!flag)
			{
				Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
				{
					foreach (ItemKey itemKey in character._inventory.Items.Keys)
					{
						bool flag5 = itemKey.ItemType != 8;
						if (!flag5)
						{
							MedicineItem medicineCfg = Config.Medicine.Instance[itemKey.TemplateId];
							bool flag6 = medicineCfg.EffectType != EMedicineEffectType.ChangeDisorderOfQi;
							if (!flag6)
							{
								bool flag7 = this.TryDetectAttachedPoisons(itemKey);
								if (!flag7)
								{
									return true;
								}
							}
						}
					}
					return false;
				}, false);
				bool flag2 = targetChar == null;
				if (!flag2)
				{
					ItemKey selectedItemKey = ItemKey.Invalid;
					context.AdvanceMonthRelatedData.CategorizedRegenItems(targetChar._inventory.Items);
					List<ValueTuple<GameData.Domains.Item.Medicine, int>>[] categorizedMedicines = context.AdvanceMonthRelatedData.CategorizedMedicines.Get();
					List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines = categorizedMedicines[3];
					medicines.Sort(EatingItemComparer.MedicineQiDisorder);
					int selectedIndex = this.SelectMedicineIndexForQiDisorder(medicines, this._disorderOfQi, null);
					bool flag3 = selectedIndex >= 0;
					if (flag3)
					{
						GameData.Domains.Item.Medicine medicine = medicines[selectedIndex].Item1;
						selectedItemKey = medicine.GetItemKey();
					}
					context.AdvanceMonthRelatedData.ReleaseCategorizedRegenItems();
					bool flag4 = !selectedItemKey.IsValid();
					if (flag4)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(72, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Fail to find valid medicine for disorder of Qi in ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
						defaultInterpolatedStringHandler.AppendLiteral("'s inventory to cure ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					sbyte targetBehaviorType = targetChar.GetBehaviorType();
					short favorability = DomainManager.Character.GetFavorability(targetChar.GetId(), this._id);
					sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
					sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestRestoreQiAction
					{
						ItemUsed = selectedItemKey,
						AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
					}));
					this._actionEnergies.SpendEnergyOnAction(0);
				}
			}
		}

		// Token: 0x06006DDF RID: 28127 RVA: 0x003DF8F8 File Offset: 0x003DDAF8
		private void OfflineCalcGeneralAction_IncreaseNeili(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(0);
			if (!flag)
			{
				Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
				{
					foreach (ItemKey itemKey in character._inventory.Items.Keys)
					{
						bool flag5 = itemKey.ItemType != 12;
						if (!flag5)
						{
							MiscItem miscCfg = Config.Misc.Instance[itemKey.TemplateId];
							bool flag6 = miscCfg.Neili <= 0;
							if (!flag6)
							{
								bool flag7 = this.TryDetectAttachedPoisons(itemKey);
								if (!flag7)
								{
									return true;
								}
							}
						}
					}
					return false;
				}, false);
				bool flag2 = targetChar == null;
				if (!flag2)
				{
					ItemKey selectedItemKey = ItemKey.Invalid;
					context.AdvanceMonthRelatedData.CategorizedRegenItems(targetChar._inventory.Items);
					List<ValueTuple<GameData.Domains.Item.Misc, int>> itemsForNeili = context.AdvanceMonthRelatedData.ItemsForNeili.Get();
					itemsForNeili.Sort(EatingItemComparer.MiscNeili);
					int selectedIndex = this.SelectItemIndexForNeili(itemsForNeili, this._currNeili, this.GetMaxNeili(), null);
					bool flag3 = selectedIndex >= 0;
					if (flag3)
					{
						GameData.Domains.Item.Misc item = itemsForNeili[selectedIndex].Item1;
						selectedItemKey = item.GetItemKey();
					}
					context.AdvanceMonthRelatedData.ReleaseCategorizedRegenItems();
					bool flag4 = !selectedItemKey.IsValid();
					if (flag4)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(66, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Fail to find valid item to restore Neili in ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
						defaultInterpolatedStringHandler.AppendLiteral("'s inventory to help ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					sbyte targetBehaviorType = targetChar.GetBehaviorType();
					short favorability = DomainManager.Character.GetFavorability(targetChar.GetId(), this._id);
					sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
					sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestIncreaseNeiliAction
					{
						ItemUsed = selectedItemKey,
						AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
					}));
					this._actionEnergies.SpendEnergyOnAction(0);
				}
			}
		}

		// Token: 0x06006DE0 RID: 28128 RVA: 0x003DFA98 File Offset: 0x003DDC98
		private unsafe void OfflineCalcGeneralAction_KillWug(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(0);
			if (!flag)
			{
				Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
				{
					foreach (ItemKey itemKey in character._inventory.Items.Keys)
					{
						bool flag6 = itemKey.ItemType != 8;
						if (!flag6)
						{
							MedicineItem medicineCfg = Config.Medicine.Instance[itemKey.TemplateId];
							bool flag7 = medicineCfg.DetoxWugType == personalNeed.WugType;
							if (flag7)
							{
								return true;
							}
						}
					}
					return false;
				}, false);
				bool flag2 = targetChar == null;
				if (!flag2)
				{
					ItemKey selectedItemKey = ItemKey.Invalid;
					context.AdvanceMonthRelatedData.CategorizedRegenItems(targetChar._inventory.Items);
					List<ValueTuple<GameData.Domains.Item.Medicine, int>>[] categorizedMedicines = context.AdvanceMonthRelatedData.CategorizedMedicines.Get();
					List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines = categorizedMedicines[5];
					List<ValueTuple<GameData.Domains.Item.Medicine, int>> poisons = categorizedMedicines[6];
					medicines.Sort(EatingItemComparer.MedicineGrade);
					poisons.Sort(EatingItemComparer.MedicineGrade);
					int wugSlot = this._eatingItems.IndexOfWug(personalNeed.WugType, false);
					int selectedIndex = this.SelectMedicineIndexForWug(medicines, personalNeed.WugType, *(ref this._eatingItems.Durations.FixedElementField + (IntPtr)wugSlot * 2), null);
					bool flag3 = selectedIndex >= 0;
					if (flag3)
					{
						GameData.Domains.Item.Medicine medicine = medicines[selectedIndex].Item1;
						selectedItemKey = medicine.GetItemKey();
					}
					else
					{
						selectedIndex = Character.SelectPoisonIndexForWug(poisons, personalNeed.WugType, *(ref this._eatingItems.Durations.FixedElementField + (IntPtr)wugSlot * 2), null);
						bool flag4 = selectedIndex >= 0;
						if (flag4)
						{
							GameData.Domains.Item.Medicine poison = poisons[selectedIndex].Item1;
							selectedItemKey = poison.GetItemKey();
						}
					}
					context.AdvanceMonthRelatedData.ReleaseCategorizedRegenItems();
					bool flag5 = !selectedItemKey.IsValid();
					if (flag5)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(69, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Fail to find valid medicine for killing wug in ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
						defaultInterpolatedStringHandler.AppendLiteral("'s inventory to help ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					sbyte targetBehaviorType = targetChar.GetBehaviorType();
					short favorability = DomainManager.Character.GetFavorability(targetChar.GetId(), this._id);
					sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
					sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestKillWugAction
					{
						ItemUsed = selectedItemKey,
						WugType = personalNeed.WugType,
						AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
					}));
					this._actionEnergies.SpendEnergyOnAction(0);
				}
			}
		}

		// Token: 0x06006DE1 RID: 28129 RVA: 0x003DFCFC File Offset: 0x003DDEFC
		private unsafe void OfflineCalcGeneralAction_RecoverMainAttribute(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(0);
			if (!flag)
			{
				sbyte behaviorType = this.GetBehaviorType();
				short rateAdjust = DomainManager.Extra.GetAiActionRateAdjust(this._id, 6, -1);
				sbyte eatForbiddenFoodChance = AiHelper.UpdateStatusConstants.EatForbiddenFoodChance[(int)behaviorType];
				bool isMeatForbidden = this.IsForbiddenToEatMeat();
				bool allowMeat = !isMeatForbidden || context.Random.CheckPercentProb((int)((short)eatForbiddenFoodChance + rateAdjust));
				Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
				{
					foreach (ItemKey itemKey in character._inventory.Items.Keys)
					{
						bool flag5 = itemKey.ItemType != 7;
						if (!flag5)
						{
							FoodItem foodCfg = Config.Food.Instance[itemKey.TemplateId];
							bool flag6 = *(ref foodCfg.MainAttributesRegen.Items.FixedElementField + (IntPtr)personalNeed.MainAttributeType * 2) <= 0;
							if (!flag6)
							{
								bool flag7 = this.TryDetectAttachedPoisons(itemKey);
								if (!flag7)
								{
									bool flag8 = foodCfg.ItemSubType != 701;
									if (flag8)
									{
										return true;
									}
									bool allowMeat = allowMeat;
									if (allowMeat)
									{
										return true;
									}
								}
							}
						}
					}
					return false;
				}, false);
				bool flag2 = targetChar == null;
				if (!flag2)
				{
					ItemKey selectedItemKey = ItemKey.Invalid;
					context.AdvanceMonthRelatedData.CategorizedRegenItems(targetChar._inventory.Items);
					List<ValueTuple<GameData.Domains.Item.Food, int>>[] foodsForMainAttributes = context.AdvanceMonthRelatedData.FoodsForMainAttributes.Get();
					List<ValueTuple<GameData.Domains.Item.Food, int>> foods = foodsForMainAttributes[(int)personalNeed.MainAttributeType];
					foods.Sort(EatingItemComparer.FoodMainAttributes[(int)personalNeed.MainAttributeType]);
					MainAttributes maxMainAttributes = this.GetMaxMainAttributes();
					int selectedIndex = this.SelectFoodIndexForMainAttributes(foods, personalNeed.MainAttributeType, *(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)personalNeed.MainAttributeType * 2), *(ref maxMainAttributes.Items.FixedElementField + (IntPtr)personalNeed.MainAttributeType * 2), allowMeat, null);
					bool flag3 = selectedIndex >= 0;
					if (flag3)
					{
						GameData.Domains.Item.Food medicine = foods[selectedIndex].Item1;
						selectedItemKey = medicine.GetItemKey();
					}
					context.AdvanceMonthRelatedData.ReleaseCategorizedRegenItems();
					bool flag4 = !selectedItemKey.IsValid();
					if (flag4)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(81, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Fail to find valid medicine for main attribute recovery in ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
						defaultInterpolatedStringHandler.AppendLiteral("'s inventory to help ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					sbyte targetBehaviorType = targetChar.GetBehaviorType();
					short favorability = DomainManager.Character.GetFavorability(targetChar.GetId(), this._id);
					sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
					sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestRecoverMainAttributeAction
					{
						ItemUsed = selectedItemKey,
						MainAttributeType = personalNeed.MainAttributeType,
						AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
					}));
					this._actionEnergies.SpendEnergyOnAction(0);
				}
			}
		}

		// Token: 0x06006DE2 RID: 28130 RVA: 0x003DFF7C File Offset: 0x003DE17C
		private void OfflineCalcGeneralAction_IncreaseHappiness(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(0);
			if (!flag)
			{
				bool flag2 = this.GetAgeGroup() != 2;
				if (!flag2)
				{
					sbyte behaviorType = this.GetBehaviorType();
					short rateAdjust = DomainManager.Extra.GetAiActionRateAdjust(this._id, 6, -1);
					sbyte eatForbiddenFoodChance = AiHelper.UpdateStatusConstants.EatForbiddenFoodChance[(int)behaviorType];
					bool isWineForbidden = this.IsForbiddenToDrinkingWines();
					bool allowWines = !isWineForbidden || context.Random.CheckPercentProb((int)((short)eatForbiddenFoodChance + rateAdjust));
					Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
					{
						foreach (ItemKey itemKey in character._inventory.Items.Keys)
						{
							bool flag6 = itemKey.ItemType != 9;
							if (!flag6)
							{
								TeaWineItem teaWineCfg = Config.TeaWine.Instance[itemKey.TemplateId];
								bool flag7 = DomainManager.Item.GetBaseItem(itemKey).GetHappinessChange() <= 0;
								if (!flag7)
								{
									bool flag8 = this.TryDetectAttachedPoisons(itemKey);
									if (!flag8)
									{
										bool flag9 = teaWineCfg.ItemSubType == 900;
										if (flag9)
										{
											return true;
										}
										bool allowWines = allowWines;
										if (allowWines)
										{
											return true;
										}
									}
								}
							}
						}
						return false;
					}, false);
					bool flag3 = targetChar == null;
					if (!flag3)
					{
						ItemKey selectedItemKey = ItemKey.Invalid;
						context.AdvanceMonthRelatedData.CategorizedRegenItems(targetChar._inventory.Items);
						List<ValueTuple<GameData.Domains.Item.TeaWine, int>> teaWines = context.AdvanceMonthRelatedData.TeaWinesForHappiness.Get();
						teaWines.Sort(EatingItemComparer.TeaWineHappiness);
						int selectedIndex = this.SelectTeaWineForHappiness(teaWines, (int)this._happiness, (int)HappinessType.Ranges[3].Item1, allowWines, null);
						bool flag4 = selectedIndex >= 0;
						if (flag4)
						{
							GameData.Domains.Item.TeaWine medicine = teaWines[selectedIndex].Item1;
							selectedItemKey = medicine.GetItemKey();
						}
						context.AdvanceMonthRelatedData.ReleaseCategorizedRegenItems();
						bool flag5 = !selectedItemKey.IsValid();
						if (flag5)
						{
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(70, 2);
							defaultInterpolatedStringHandler.AppendLiteral("Fail to find valid tea or wine for happiness in ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
							defaultInterpolatedStringHandler.AppendLiteral("'s inventory to help ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
							defaultInterpolatedStringHandler.AppendLiteral(".");
							throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						sbyte targetBehaviorType = targetChar.GetBehaviorType();
						short favorability = DomainManager.Character.GetFavorability(targetChar.GetId(), this._id);
						sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
						sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
						mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestIncreaseHappinessAction
						{
							ItemUsed = selectedItemKey,
							AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
						}));
						this._actionEnergies.SpendEnergyOnAction(0);
					}
				}
			}
		}

		// Token: 0x06006DE3 RID: 28131 RVA: 0x003E01A8 File Offset: 0x003DE3A8
		private unsafe void OfflineCalcGeneralAction_GainResource(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> currBlockGraves, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(1);
			if (!flag)
			{
				bool flag2 = this.OfflineCalcGeneralAction_TakeTreasuryResource(context.Random, mod, personalNeed.ResourceType, personalNeed.Amount);
				if (!flag2)
				{
					ValueTuple<int, sbyte> valueTuple = this.SelectDemandActionTarget(context, currBlockChars, currBlockGraves, (Character character) => *(ref character._resources.Items.FixedElementField + (IntPtr)personalNeed.ResourceType * 4) >= personalNeed.Amount, delegate(Grave grave)
					{
						ResourceInts resources = *grave.GetResources();
						return *(ref resources.Items.FixedElementField + (IntPtr)personalNeed.ResourceType * 4) >= personalNeed.Amount;
					}, 1);
					int targetCharId = valueTuple.Item1;
					sbyte requestActionType = valueTuple.Item2;
					bool flag3 = targetCharId < 0;
					if (!flag3)
					{
						sbyte mainAttributeType = AiHelper.DemandActionType.ToMainAttributeType(requestActionType, false);
						bool flag4 = mainAttributeType >= 0 && this.GetCurrMainAttribute(mainAttributeType) < (short)GlobalConfig.Instance.HarmfulActionCost;
						if (!flag4)
						{
							short favorability = DomainManager.Character.GetFavorability(targetCharId, this._id);
							sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
							Character targetChar;
							int alertFactor = DomainManager.Character.TryGetElement_Objects(targetCharId, out targetChar) ? targetChar.GetResourceAlertFactor(personalNeed.ResourceType) : 0;
							switch (requestActionType)
							{
							case 0:
							{
								sbyte targetBehaviorType = targetChar.GetBehaviorType();
								sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
								mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestResourceAction
								{
									AgreeToRequest = context.Random.CheckPercentProb((int)respondChance),
									ResourceType = personalNeed.ResourceType,
									Amount = personalNeed.Amount
								}));
								break;
							}
							case 1:
								mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new StealResourceAction
								{
									ResourceType = personalNeed.ResourceType,
									Amount = personalNeed.Amount,
									Phase = this.GetStealActionPhase(context.Random, targetChar, alertFactor, false)
								}));
								break;
							case 2:
								mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new ScamResourceAction
								{
									ResourceType = personalNeed.ResourceType,
									Amount = personalNeed.Amount,
									Phase = this.GetScamActionPhase(context.Random, targetChar, alertFactor, false)
								}));
								break;
							case 3:
								mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RobResourceAction
								{
									ResourceType = personalNeed.ResourceType,
									Amount = personalNeed.Amount,
									Phase = this.GetRobActionPhase(context.Random, targetChar, alertFactor, false)
								}));
								break;
							case 4:
							{
								int successRate = (int)(7 * (100 + *(ref this.GetPersonalities().Items.FixedElementField + 6) * 5) / 35);
								mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new RobGraveResourceAction
								{
									ResourceType = personalNeed.ResourceType,
									Amount = personalNeed.Amount,
									Succeed = context.Random.CheckPercentProb(successRate),
									TargetGraveId = targetCharId
								}));
								break;
							}
							}
							this._actionEnergies.SpendEnergyOnAction(1);
						}
					}
				}
			}
		}

		// Token: 0x06006DE4 RID: 28132 RVA: 0x003E04CC File Offset: 0x003DE6CC
		private unsafe void OfflineCalcGeneralAction_GainItem(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> currBlockGraves, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			IRandomSource random = context.Random;
			bool flag = !this._actionEnergies.HasEnoughForAction(1);
			if (!flag)
			{
				ItemKey itemKeyFromBuyBack = DomainManager.Merchant.TryGetBuyBackItemForPersonalNeed(context, personalNeed);
				bool flag2 = itemKeyFromBuyBack.IsValid();
				if (flag2)
				{
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new PurchaseBuybackItemAction
					{
						TargetItem = itemKeyFromBuyBack
					}));
					this._actionEnergies.SpendEnergyOnAction(1);
				}
				else
				{
					bool flag3 = this.OfflineCalcGeneralAction_TakeTreasuryItem(context.Random, mod, personalNeed);
					if (!flag3)
					{
						bool flag4 = personalNeed.ItemType == 3;
						if (!flag4)
						{
							bool flag5 = (context.Random.NextBool() || *(ref this._resources.Items.FixedElementField + (IntPtr)6 * 4) > this.GetAdjustedResourceSatisfyingThreshold(6)) && personalNeed.ItemType != 11 && this.IsInRegularSettlementRange();
							if (flag5)
							{
								bool flag6 = this.OfflineCalcGeneralAction_MakeArtisanOrder(context, mod, personalNeed, -1);
								if (flag6)
								{
									return;
								}
								bool flag7 = this.OfflineCalcGeneralAction_PurchaseItem(context, mod, personalNeed, null);
								if (flag7)
								{
									return;
								}
							}
							Func<KeyValuePair<ItemKey, int>, bool> <>9__2;
							Func<KeyValuePair<ItemKey, int>, bool> <>9__3;
							ValueTuple<int, sbyte> valueTuple = this.SelectDemandActionTarget(context, currBlockChars, currBlockGraves, delegate(Character character)
							{
								IEnumerable<KeyValuePair<ItemKey, int>> items = character._inventory.Items;
								Func<KeyValuePair<ItemKey, int>, bool> predicate;
								if ((predicate = <>9__2) == null)
								{
									predicate = (<>9__2 = ((KeyValuePair<ItemKey, int> pair) => pair.Key.ItemType == personalNeed.ItemType && pair.Key.TemplateId == personalNeed.ItemTemplateId));
								}
								return items.Any(predicate);
							}, delegate(Grave grave)
							{
								IEnumerable<KeyValuePair<ItemKey, int>> items = grave.GetInventory().Items;
								Func<KeyValuePair<ItemKey, int>, bool> predicate;
								if ((predicate = <>9__3) == null)
								{
									predicate = (<>9__3 = ((KeyValuePair<ItemKey, int> pair) => pair.Key.ItemType == personalNeed.ItemType && pair.Key.TemplateId == personalNeed.ItemTemplateId));
								}
								return items.Any(predicate);
							}, 0);
							int targetCharId = valueTuple.Item1;
							sbyte requestActionType = valueTuple.Item2;
							bool flag8 = targetCharId < 0;
							if (!flag8)
							{
								ItemKey selectedItemKey = ItemKey.Invalid;
								int targetAmount = 1;
								Character targetChar;
								bool flag9 = DomainManager.Character.TryGetElement_Objects(targetCharId, out targetChar);
								if (flag9)
								{
									foreach (KeyValuePair<ItemKey, int> keyValuePair in targetChar._inventory.Items)
									{
										ItemKey itemKey3;
										int num;
										keyValuePair.Deconstruct(out itemKey3, out num);
										ItemKey itemKey = itemKey3;
										bool flag10 = itemKey.ItemType != personalNeed.ItemType || itemKey.TemplateId != personalNeed.ItemTemplateId;
										if (!flag10)
										{
											selectedItemKey = itemKey;
											targetAmount = 1;
											break;
										}
									}
								}
								else
								{
									Grave grave3 = DomainManager.Character.GetElement_Graves(targetCharId);
									Inventory graveInventory = grave3.GetInventory();
									int index = context.Random.Next(graveInventory.Items.Count);
									foreach (KeyValuePair<ItemKey, int> keyValuePair in graveInventory.Items)
									{
										ItemKey itemKey3;
										int num;
										keyValuePair.Deconstruct(out itemKey3, out num);
										ItemKey itemKey2 = itemKey3;
										int amount = num;
										bool flag11 = index <= 0;
										if (flag11)
										{
											selectedItemKey = itemKey2;
											targetAmount = amount;
											break;
										}
										index--;
									}
								}
								bool flag12 = !selectedItemKey.IsValid();
								if (flag12)
								{
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(79, 3);
									defaultInterpolatedStringHandler.AppendLiteral("Failed to find target item ");
									defaultInterpolatedStringHandler.AppendFormatted<GameData.Domains.Character.Ai.PersonalNeed>(personalNeed);
									defaultInterpolatedStringHandler.AppendLiteral(" in selected character ");
									defaultInterpolatedStringHandler.AppendFormatted<int>(targetCharId);
									defaultInterpolatedStringHandler.AppendLiteral("'s inventory for ");
									defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
									defaultInterpolatedStringHandler.AppendLiteral(" to request.");
									throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
								}
								sbyte mainAttributeType = AiHelper.DemandActionType.ToMainAttributeType(requestActionType, false);
								bool flag13 = mainAttributeType >= 0 && this.GetCurrMainAttribute(mainAttributeType) < (short)GlobalConfig.Instance.HarmfulActionCost;
								if (!flag13)
								{
									short targetToSelfFavor = DomainManager.Character.GetFavorability(targetCharId, this._id);
									sbyte favorabilityType = FavorabilityType.GetFavorabilityType(targetToSelfFavor);
									switch (requestActionType)
									{
									case 0:
									{
										sbyte targetBehaviorType = targetChar.GetBehaviorType();
										sbyte addPoisonChance = AiHelper.GeneralActionConstants.AddPoisonOnTransferItemChance[(int)targetBehaviorType];
										sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
										bool agreeToRequest = context.Random.CheckPercentProb((int)respondChance);
										ItemKey[] poisons = (agreeToRequest && random.CheckPercentProb((int)addPoisonChance)) ? targetChar.SelectInventoryPoisonsToAdd(random, selectedItemKey) : null;
										mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestItemAction
										{
											TargetItem = selectedItemKey,
											Amount = targetAmount,
											AgreeToRequest = agreeToRequest,
											PoisonsToAdd = poisons
										}));
										break;
									}
									case 1:
									{
										int alertFactor = targetChar.GetItemAlertFactor(selectedItemKey, targetAmount);
										sbyte phase = this.GetStealActionPhase(random, targetChar, alertFactor, false);
										ItemKey[] poisons2 = null;
										bool flag14 = phase >= 5;
										if (flag14)
										{
											sbyte targetBehaviorType2 = targetChar.GetBehaviorType();
											sbyte addPoisonChance2 = AiHelper.GeneralActionConstants.AddPoisonOnTransferItemChance[(int)targetBehaviorType2];
											bool flag15 = random.CheckPercentProb((int)addPoisonChance2);
											if (flag15)
											{
												poisons2 = targetChar.SelectInventoryPoisonsToAdd(random, selectedItemKey);
											}
										}
										mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new StealItemAction
										{
											TargetItem = selectedItemKey,
											Amount = targetAmount,
											Phase = phase,
											PoisonsToAdd = poisons2
										}));
										break;
									}
									case 2:
									{
										int alertFactor2 = targetChar.GetItemAlertFactor(selectedItemKey, targetAmount);
										sbyte phase2 = this.GetScamActionPhase(context.Random, targetChar, alertFactor2, false);
										ItemKey[] poisons3 = null;
										bool flag16 = phase2 >= 5;
										if (flag16)
										{
											sbyte targetBehaviorType3 = targetChar.GetBehaviorType();
											sbyte addPoisonChance3 = AiHelper.GeneralActionConstants.AddPoisonOnTransferItemChance[(int)targetBehaviorType3];
											bool flag17 = random.CheckPercentProb((int)addPoisonChance3);
											if (flag17)
											{
												poisons3 = targetChar.SelectInventoryPoisonsToAdd(random, selectedItemKey);
											}
										}
										mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new ScamItemAction
										{
											TargetItem = selectedItemKey,
											Amount = targetAmount,
											Phase = phase2,
											PoisonsToAdd = poisons3
										}));
										break;
									}
									case 3:
									{
										int alertFactor3 = targetChar.GetItemAlertFactor(selectedItemKey, targetAmount);
										sbyte phase3 = this.GetRobActionPhase(context.Random, targetChar, alertFactor3, false);
										ItemKey[] poisons4 = null;
										bool flag18 = phase3 >= 5;
										if (flag18)
										{
											sbyte targetBehaviorType4 = targetChar.GetBehaviorType();
											sbyte addPoisonChance4 = AiHelper.GeneralActionConstants.AddPoisonOnTransferItemChance[(int)targetBehaviorType4];
											bool flag19 = random.CheckPercentProb((int)addPoisonChance4);
											if (flag19)
											{
												poisons4 = targetChar.SelectInventoryPoisonsToAdd(random, selectedItemKey);
											}
										}
										mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RobItemAction
										{
											TargetItem = selectedItemKey,
											Amount = targetAmount,
											Phase = phase3,
											PoisonsToAdd = poisons4
										}));
										break;
									}
									case 4:
									{
										Personalities personalities = this.GetPersonalities();
										Grave grave2 = DomainManager.Character.GetElement_Graves(targetCharId);
										int successRate = grave2.GetInventory().Items.Count * (int)(100 + *(ref personalities.Items.FixedElementField + 6) * 5) / 35;
										mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RobGraveItemAction
										{
											TargetItem = selectedItemKey,
											Amount = targetAmount,
											TargetGraveId = targetCharId,
											Succeed = context.Random.CheckPercentProb(successRate)
										}));
										break;
									}
									}
									this._actionEnergies.SpendEnergyOnAction(1);
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06006DE5 RID: 28133 RVA: 0x003E0B98 File Offset: 0x003DED98
		private void OfflineCalcGeneralAction_RepairItem(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(1);
			if (!flag)
			{
				ItemBase itemToRepair = DomainManager.Item.GetBaseItem(new ItemKey(personalNeed.ItemType, 0, 0, personalNeed.ItemId));
				ItemKey itemKey = itemToRepair.GetItemKey();
				sbyte grade = itemToRepair.GetGrade();
				short currDurability = itemToRepair.GetCurrDurability();
				sbyte requiredLifeSkillType = ItemTemplateHelper.GetCraftRequiredLifeSkillType(itemKey.ItemType, itemKey.TemplateId);
				short attainmentRequired = ItemTemplateHelper.GetRepairRequiredAttainment(itemKey.ItemType, itemKey.TemplateId, currDurability);
				sbyte requiredResourceType = ItemTemplateHelper.GetCraftRequiredResourceType(itemKey.ItemType, itemKey.TemplateId);
				EquipmentBase equip = DomainManager.Item.GetBaseEquipment(itemKey);
				int requiredResourceAmount = ItemTemplateHelper.GetRepairNeedResourceCount(equip.GetMaterialResources(), itemKey, currDurability);
				Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
				{
					bool flag4 = character.GetResource(requiredResourceType) < requiredResourceAmount;
					bool result;
					if (flag4)
					{
						result = false;
					}
					else
					{
						short characterAttainment = character.GetLifeSkillAttainment(requiredLifeSkillType);
						foreach (ItemKey toolItemKey in character._inventory.Items.Keys)
						{
							bool flag5 = toolItemKey.ItemType != 6;
							if (!flag5)
							{
								ItemBase tool = DomainManager.Item.GetBaseItem(toolItemKey);
								CraftToolItem cfg = Config.CraftTool.Instance[toolItemKey.TemplateId];
								short cost = cfg.DurabilityCost[(int)grade];
								bool flag6 = tool.GetCurrDurability() < cost;
								if (!flag6)
								{
									bool flag7 = !cfg.RequiredLifeSkillTypes.Contains(requiredLifeSkillType);
									if (!flag7)
									{
										bool flag8 = characterAttainment + cfg.AttainmentBonus >= attainmentRequired;
										if (flag8)
										{
											return true;
										}
									}
								}
							}
						}
						result = false;
					}
					return result;
				}, false);
				bool flag2 = targetChar == null;
				if (!flag2)
				{
					short targetToSelfFavor = DomainManager.Character.GetFavorability(targetChar.GetId(), this._id);
					sbyte favorabilityType = FavorabilityType.GetFavorabilityType(targetToSelfFavor);
					sbyte targetBehaviorType = targetChar.GetBehaviorType();
					sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
					short targetCharAttainment = targetChar.GetLifeSkillAttainment(requiredLifeSkillType);
					short durabilityCost;
					ItemKey selectedTool = targetChar._inventory.GetWorstUsableCraftTool(requiredLifeSkillType, attainmentRequired, targetCharAttainment, itemToRepair.GetGrade(), out durabilityCost);
					bool flag3 = !selectedTool.IsValid();
					if (flag3)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(78, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Failed to find target tool to repair ");
						defaultInterpolatedStringHandler.AppendFormatted<GameData.Domains.Character.Ai.PersonalNeed>(personalNeed);
						defaultInterpolatedStringHandler.AppendLiteral(" in selected character ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
						defaultInterpolatedStringHandler.AppendLiteral("'s inventory for ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestRepairItemAction
					{
						TargetItem = itemKey,
						ToolUsed = selectedTool,
						ResourceType = requiredResourceType,
						ResourceAmount = requiredResourceAmount,
						AgreeToRequest = context.Random.CheckPercentProb((int)respondChance),
						ToolDurabilityCost = durabilityCost
					}));
					this._actionEnergies.SpendEnergyOnAction(1);
				}
			}
		}

		// Token: 0x06006DE6 RID: 28134 RVA: 0x003E0DD8 File Offset: 0x003DEFD8
		private unsafe bool OfflineCalcGeneralAction_PurchaseItem(DataContext context, PeriAdvanceMonthGeneralActionModification mod, GameData.Domains.Character.Ai.PersonalNeed personalNeed, Character targetChar = null)
		{
			int price = ItemTemplateHelper.GetBaseValue(personalNeed.ItemType, personalNeed.ItemTemplateId) * 2 * OrganizationDomain.GetOrgMemberConfig(this._organizationInfo).PurchaseItemDiscount / 100;
			bool flag = price <= 0 || *this._resources[6] < price;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new PurchaseItemAction
				{
					MoneyCost = price,
					PurchasedItem = new TemplateKey(personalNeed.ItemType, personalNeed.ItemTemplateId),
					ItemAmount = 1
				}));
				result = true;
			}
			return result;
		}

		// Token: 0x06006DE7 RID: 28135 RVA: 0x003E0E70 File Offset: 0x003DF070
		private bool OfflineCalcGeneralAction_MakeArtisanOrder(DataContext context, PeriAdvanceMonthGeneralActionModification mod, GameData.Domains.Character.Ai.PersonalNeed personalNeed, int giftTargetCharId = -1)
		{
			bool flag = !ItemTemplateHelper.CanMakeArtisanOrder(personalNeed.ItemType, personalNeed.ItemTemplateId);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				sbyte lifeSkillType = ItemTemplateHelper.GetCraftRequiredLifeSkillType(personalNeed.ItemType, personalNeed.ItemTemplateId);
				bool flag2 = lifeSkillType < 0;
				if (flag2)
				{
					result = false;
				}
				else
				{
					short itemSubType = ItemTemplateHelper.GetItemSubType(personalNeed.ItemType, personalNeed.ItemTemplateId);
					bool flag3 = DomainManager.Extra.IsItemSubTypeSubscribed(this._id, itemSubType);
					if (flag3)
					{
						result = true;
					}
					else
					{
						List<Character> targetCharList = ObjectPool<List<Character>>.Instance.Get();
						MapCharacterFilter.Find((Character character) => character.IsInteractableAsIntelligentCharacter() && character.IdentifyCanCraftItem(personalNeed.ItemType, personalNeed.ItemTemplateId) && DomainManager.Extra.IsArtisanIdle(character.GetId()), targetCharList, this._location.AreaId, false);
						Character purchaseTarget = targetCharList.GetRandomOrDefault(context.Random, null);
						ObjectPool<List<Character>>.Instance.Return(targetCharList);
						bool flag4 = purchaseTarget == null;
						if (flag4)
						{
							result = true;
						}
						else
						{
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(purchaseTarget, new MakeArtisanOrderAction
							{
								ItemSubType = itemSubType,
								LifeSkillType = lifeSkillType,
								GiftTargetCharId = giftTargetCharId
							}));
							bool flag5 = giftTargetCharId >= 0;
							if (flag5)
							{
								this._actionEnergies.SpendEnergyOnAction(3);
							}
							else
							{
								this._actionEnergies.SpendEnergyOnAction(1);
							}
							result = true;
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006DE8 RID: 28136 RVA: 0x003E0FD4 File Offset: 0x003DF1D4
		private unsafe void OfflineCalcGeneralAction_AddPoisonToItem(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(1);
			if (!flag)
			{
				Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
				{
					short characterAttainment = character.GetLifeSkillAttainment(9);
					foreach (ItemKey itemKey2 in character._inventory.Items.Keys)
					{
						bool flag11 = itemKey2.ItemType != 8;
						if (!flag11)
						{
							MedicineItem medicineCfg2 = Config.Medicine.Instance[itemKey2.TemplateId];
							bool flag12 = medicineCfg2.EffectType != EMedicineEffectType.ApplyPoison;
							if (!flag12)
							{
								sbyte poisonType2 = medicineCfg2.PoisonType;
								short attainmentRequired2 = GlobalConfig.Instance.PoisonAttainments[(int)medicineCfg2.Grade];
								bool flag13 = poisonType2 != personalNeed.PoisonType || characterAttainment < attainmentRequired2;
								if (!flag13)
								{
									return true;
								}
							}
						}
					}
					return false;
				}, false);
				bool flag2 = targetChar == null;
				if (!flag2)
				{
					short favorability = DomainManager.Character.GetFavorability(targetChar.GetId(), this._id);
					sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
					sbyte targetBehaviorType = targetChar.GetBehaviorType();
					sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
					short toxicologyAttainment = targetChar.GetLifeSkillAttainment(9);
					int minDeviation = 16129;
					ItemKey selectedPoison = ItemKey.Invalid;
					foreach (ItemKey itemKey in targetChar._inventory.Items.Keys)
					{
						bool flag3 = itemKey.ItemType != 8;
						if (!flag3)
						{
							MedicineItem medicineCfg = Config.Medicine.Instance[itemKey.TemplateId];
							bool flag4 = medicineCfg.EffectType != EMedicineEffectType.ApplyPoison;
							if (!flag4)
							{
								sbyte poisonType = medicineCfg.ApplyPoisonType;
								short attainmentRequired = GlobalConfig.Instance.PoisonAttainments[(int)medicineCfg.Grade];
								bool flag5 = poisonType != personalNeed.PoisonType || toxicologyAttainment < attainmentRequired;
								if (!flag5)
								{
									int diff = (int)(medicineCfg.Grade - this._organizationInfo.Grade);
									int currDeviation = diff * diff;
									bool flag6 = currDeviation > minDeviation;
									if (!flag6)
									{
										minDeviation = currDeviation;
										selectedPoison = itemKey;
									}
								}
							}
						}
					}
					bool flag7 = !selectedPoison.IsValid();
					if (flag7)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(70, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Failed to find target poison ");
						defaultInterpolatedStringHandler.AppendFormatted<GameData.Domains.Character.Ai.PersonalNeed>(personalNeed);
						defaultInterpolatedStringHandler.AppendLiteral(" in selected character ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
						defaultInterpolatedStringHandler.AppendLiteral("'s inventory for ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					MedicineItem selectedPoisonCfg = Config.Medicine.Instance[selectedPoison.TemplateId];
					IntPtr intPtr = stackalloc byte[(UIntPtr)3];
					cpblk(intPtr, ref <PrivateImplementationDetails>.AE4B3280E56E2FAF83F414A6E3DABE9D5FBE18976544C05FED121ACCB85B53FC, 3);
					sbyte* weapons = intPtr;
					sbyte selectedWeapon = this.SelectEquipmentInArrayToAddPoisonOn(context.Random, selectedPoisonCfg, weapons, 3, null);
					bool flag8 = selectedWeapon >= 0;
					if (flag8)
					{
						mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestAddPoisonToItemAction
						{
							TargetItem = this._equipment[(int)selectedWeapon],
							PoisonUsed = selectedPoison,
							AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
						}));
						this._actionEnergies.SpendEnergyOnAction(1);
					}
					else
					{
						IntPtr intPtr2 = stackalloc byte[(UIntPtr)4];
						cpblk(intPtr2, ref <PrivateImplementationDetails>.480952838458970426CE17954928B70D8BBE57CC04FF20CC1B20C238B682413A, 4);
						sbyte* armor = intPtr2;
						sbyte selectedArmor = this.SelectEquipmentInArrayToAddPoisonOn(context.Random, selectedPoisonCfg, armor, 4, null);
						bool flag9 = selectedArmor >= 0;
						if (flag9)
						{
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestAddPoisonToItemAction
							{
								TargetItem = this._equipment[(int)selectedArmor],
								PoisonUsed = selectedPoison,
								AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
							}));
							this._actionEnergies.SpendEnergyOnAction(1);
						}
						else
						{
							IntPtr intPtr3 = stackalloc byte[(UIntPtr)3];
							cpblk(intPtr3, ref <PrivateImplementationDetails>.6E9FA019228FE1A9D342D4A0085AB80270C9726BD08CD5A35D7626A700B34E2F, 3);
							sbyte* accessories = intPtr3;
							sbyte selectedAccessory = this.SelectEquipmentInArrayToAddPoisonOn(context.Random, selectedPoisonCfg, accessories, 3, null);
							bool flag10 = selectedAccessory >= 0;
							if (flag10)
							{
								mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new RequestAddPoisonToItemAction
								{
									TargetItem = this._equipment[(int)selectedAccessory],
									PoisonUsed = selectedPoison,
									AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
								}));
								this._actionEnergies.SpendEnergyOnAction(1);
							}
						}
					}
				}
			}
		}

		// Token: 0x06006DE9 RID: 28137 RVA: 0x003E13AC File Offset: 0x003DF5AC
		public bool CanLearnLifeSkillFrom(Character character, sbyte lifeSkillType = -1)
		{
			foreach (LifeSkillItem item in character._learnedLifeSkills)
			{
				LifeSkillItem lifeSkillConfig = LifeSkill.Instance[item.SkillTemplateId];
				bool flag = lifeSkillConfig.SkillBookId < 0;
				if (!flag)
				{
					bool flag2 = lifeSkillConfig.Type != lifeSkillType && lifeSkillType >= 0;
					if (!flag2)
					{
						int learnedLifeSkillIndex = this.FindLearnedLifeSkillIndex(item.SkillTemplateId);
						bool flag3 = learnedLifeSkillIndex >= 0;
						if (!flag3)
						{
							bool flag4 = item.ReadingState > 0;
							if (flag4)
							{
								return true;
							}
						}
					}
				}
			}
			return false;
		}

		// Token: 0x06006DEA RID: 28138 RVA: 0x003E1474 File Offset: 0x003DF674
		[return: TupleElementNames(new string[]
		{
			"skillId",
			"pageId"
		})]
		public ValueTuple<short, byte> CalcLifeSkillToLearnFromCharacter(DataContext context, Character character, sbyte lifeSkillType = -1)
		{
			List<ValueTuple<short, short>> weightTable = context.AdvanceMonthRelatedData.WeightTable.Occupy();
			short index = 0;
			while ((int)index < character._learnedLifeSkills.Count)
			{
				LifeSkillItem lifeSkillItem = character._learnedLifeSkills[(int)index];
				LifeSkillItem lifeSkillCfg = LifeSkill.Instance[lifeSkillItem.SkillTemplateId];
				bool flag = lifeSkillCfg.SkillBookId < 0;
				if (!flag)
				{
					bool flag2 = lifeSkillCfg.Type != lifeSkillType && lifeSkillType >= 0;
					if (!flag2)
					{
						bool flag3 = this.FindLearnedLifeSkillIndex(lifeSkillItem.SkillTemplateId) >= 0;
						if (!flag3)
						{
							bool flag4 = lifeSkillItem.ReadingState == 0;
							if (!flag4)
							{
								weightTable.Add(new ValueTuple<short, short>(index, (short)(3 << (int)(8 - lifeSkillCfg.Grade))));
							}
						}
					}
				}
				index += 1;
			}
			bool flag5 = weightTable.Count == 0;
			ValueTuple<short, byte> result;
			if (flag5)
			{
				context.AdvanceMonthRelatedData.WeightTable.Release(ref weightTable);
				result = new ValueTuple<short, byte>(-1, 0);
			}
			else
			{
				short selectedIndex = RandomUtils.GetRandomResult<short>(weightTable, context.Random);
				context.AdvanceMonthRelatedData.WeightTable.Release(ref weightTable);
				LifeSkillItem learnedLifeSkill = character._learnedLifeSkills[(int)selectedIndex];
				short lifeSkillTemplateId = learnedLifeSkill.SkillTemplateId;
				byte pageId;
				for (pageId = 0; pageId < 5; pageId += 1)
				{
					bool flag6 = learnedLifeSkill.IsPageRead(pageId);
					if (flag6)
					{
						break;
					}
				}
				result = new ValueTuple<short, byte>(lifeSkillTemplateId, pageId);
			}
			return result;
		}

		// Token: 0x06006DEB RID: 28139 RVA: 0x003E15F0 File Offset: 0x003DF7F0
		public bool CanLearnCombatSkillFrom(Character character, sbyte combatSkillType = -1)
		{
			int targetCharId = character.GetId();
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> targetCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(targetCharId);
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> selfCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(this._id);
			foreach (KeyValuePair<short, GameData.Domains.CombatSkill.CombatSkill> keyValuePair in targetCombatSkills)
			{
				short num;
				GameData.Domains.CombatSkill.CombatSkill combatSkill;
				keyValuePair.Deconstruct(out num, out combatSkill);
				short skillTemplateId = num;
				GameData.Domains.CombatSkill.CombatSkill skill = combatSkill;
				CombatSkillItem combatSkillCfg = Config.CombatSkill.Instance[skillTemplateId];
				bool flag = combatSkillCfg.BookId < 0;
				if (!flag)
				{
					bool flag2 = combatSkillCfg.Type != combatSkillType && combatSkillType >= 0;
					if (!flag2)
					{
						bool flag3 = selfCombatSkills.ContainsKey(skillTemplateId);
						if (!flag3)
						{
							bool flag4 = skill.GetReadingState() > 0;
							if (flag4)
							{
								return true;
							}
						}
					}
				}
			}
			return false;
		}

		// Token: 0x06006DEC RID: 28140 RVA: 0x003E16E4 File Offset: 0x003DF8E4
		[return: TupleElementNames(new string[]
		{
			"skillId",
			"internalIndex",
			"pageTypes"
		})]
		public ValueTuple<short, byte, byte> CalcCombatSkillToLearnFromCharacter(DataContext context, Character character, sbyte combatSkillType = -1)
		{
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> targetCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(character.GetId());
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> selfCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(this._id);
			List<ValueTuple<short, short>> weightTable = context.AdvanceMonthRelatedData.WeightTable.Occupy();
			foreach (KeyValuePair<short, GameData.Domains.CombatSkill.CombatSkill> keyValuePair in targetCombatSkills)
			{
				short num;
				GameData.Domains.CombatSkill.CombatSkill combatSkill2;
				keyValuePair.Deconstruct(out num, out combatSkill2);
				short templateId = num;
				GameData.Domains.CombatSkill.CombatSkill combatSkill = combatSkill2;
				CombatSkillItem combatSkillCfg = Config.CombatSkill.Instance[templateId];
				bool flag = combatSkillCfg.BookId < 0;
				if (!flag)
				{
					bool flag2 = combatSkillCfg.Type != combatSkillType && combatSkillType >= 0;
					if (!flag2)
					{
						bool flag3 = selfCombatSkills.ContainsKey(templateId);
						if (!flag3)
						{
							bool flag4 = combatSkill.GetReadingState() == 0;
							if (!flag4)
							{
								int weight = 3 << (int)(8 - combatSkillCfg.Grade);
								bool isNonPublic = combatSkillCfg.IsNonPublic;
								if (isNonPublic)
								{
									weight /= 3;
								}
								weightTable.Add(new ValueTuple<short, short>(templateId, (short)weight));
							}
						}
					}
				}
			}
			bool flag5 = weightTable.Count == 0;
			ValueTuple<short, byte, byte> result;
			if (flag5)
			{
				context.AdvanceMonthRelatedData.WeightTable.Release(ref weightTable);
				result = new ValueTuple<short, byte, byte>(-1, 0, 0);
			}
			else
			{
				short skillTemplateId = RandomUtils.GetRandomResult<short>(weightTable, context.Random);
				context.AdvanceMonthRelatedData.WeightTable.Release(ref weightTable);
				GameData.Domains.CombatSkill.CombatSkill selectedCombatSkill = targetCombatSkills[skillTemplateId];
				ushort readingState = selectedCombatSkill.GetReadingState();
				byte currInternalIndex;
				for (currInternalIndex = 0; currInternalIndex < 15; currInternalIndex += 1)
				{
					bool flag6 = CombatSkillStateHelper.IsPageRead(readingState, currInternalIndex);
					if (flag6)
					{
						break;
					}
				}
				byte pageTypes = CombatSkillStateHelper.GeneratePageTypesFromReadingState(context.Random, readingState);
				result = new ValueTuple<short, byte, byte>(skillTemplateId, currInternalIndex, pageTypes);
			}
			return result;
		}

		// Token: 0x06006DED RID: 28141 RVA: 0x003E18BC File Offset: 0x003DFABC
		private void OfflineCalcGeneralAction_LearnLifeSkill(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(2);
			if (!flag)
			{
				ValueTuple<int, sbyte> valueTuple = this.SelectDemandActionTarget(context, currBlockChars, null, (Character character) => this.CanLearnLifeSkillFrom(character, personalNeed.LifeSkillType), null, 3);
				int targetCharId = valueTuple.Item1;
				sbyte requestActionType = valueTuple.Item2;
				bool flag2 = targetCharId < 0;
				if (!flag2)
				{
					sbyte mainAttributeType = AiHelper.DemandActionType.ToMainAttributeType(requestActionType, true);
					bool flag3 = mainAttributeType >= 0 && this.GetCurrMainAttribute(mainAttributeType) < (short)GlobalConfig.Instance.HarmfulActionCost;
					if (!flag3)
					{
						Character character2 = DomainManager.Character.GetElement_Objects(targetCharId);
						short favorability = DomainManager.Character.GetFavorability(targetCharId, this._id);
						sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
						ValueTuple<short, byte> valueTuple2 = this.CalcLifeSkillToLearnFromCharacter(context, character2, personalNeed.LifeSkillType);
						short lifeSkillTemplateId = valueTuple2.Item1;
						byte pageId = valueTuple2.Item2;
						LifeSkillItem lifeSkillCfg = LifeSkill.Instance[lifeSkillTemplateId];
						short bookTemplateId = lifeSkillCfg.SkillBookId;
						sbyte grade = LifeSkill.Instance[lifeSkillTemplateId].Grade;
						switch (requestActionType)
						{
						case 0:
						{
							int respondChance = AiHelper.GeneralActionConstants.GetAskToTeachSkillRespondChance(this, character2, favorabilityType, grade);
							bool agreeToRequest = context.Random.CheckPercentProb(respondChance);
							bool succeed = false;
							bool flag4 = agreeToRequest;
							if (flag4)
							{
								short attainment = this.GetLifeSkillAttainment(personalNeed.LifeSkillType);
								short qualification = this.GetLifeSkillQualification(personalNeed.LifeSkillType);
								sbyte personality = this.GetPersonality(1);
								int successRate = Character.GetTaughtNewSkillSuccessRate(grade, qualification, attainment, personality);
								succeed = context.Random.CheckPercentProb(successRate);
							}
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(character2, new RequestLifeSkillDemandAction
							{
								BookTemplateId = bookTemplateId,
								PageId = pageId,
								AgreeToRequest = agreeToRequest,
								Succeed = succeed
							}));
							break;
						}
						case 1:
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(character2, new StealLifeSkillDemandAction
							{
								BookTemplateId = bookTemplateId,
								PageId = pageId,
								Phase = this.GetStealLifeSkillActionPhase(context.Random, character2, personalNeed.LifeSkillType, grade, false)
							}));
							break;
						case 2:
						{
							int alertFactor = character2.GetGradeAlertFactor(grade, 1);
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(character2, new ScamLifeSkillDemandAction
							{
								BookTemplateId = bookTemplateId,
								PageId = pageId,
								Phase = this.GetScamActionPhase(context.Random, character2, alertFactor, false)
							}));
							break;
						}
						default:
						{
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 3);
							defaultInterpolatedStringHandler.AppendLiteral("Unrecognized request action type ");
							defaultInterpolatedStringHandler.AppendFormatted<sbyte>(requestActionType);
							defaultInterpolatedStringHandler.AppendLiteral(" for ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
							defaultInterpolatedStringHandler.AppendLiteral(" to ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(targetCharId);
							throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						}
						this._actionEnergies.SpendEnergyOnAction(2);
					}
				}
			}
		}

		// Token: 0x06006DEE RID: 28142 RVA: 0x003E1BA4 File Offset: 0x003DFDA4
		private void OfflineCalcGeneralAction_LearnCombatSkill(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(2);
			if (!flag)
			{
				ValueTuple<int, sbyte> valueTuple = this.SelectDemandActionTarget(context, currBlockChars, null, (Character character) => this.CanLearnCombatSkillFrom(character, personalNeed.CombatSkillType), null, 2);
				int targetCharId = valueTuple.Item1;
				sbyte requestActionType = valueTuple.Item2;
				bool flag2 = targetCharId < 0;
				if (!flag2)
				{
					sbyte mainAttributeType = AiHelper.DemandActionType.ToMainAttributeType(requestActionType, true);
					bool flag3 = mainAttributeType >= 0 && this.GetCurrMainAttribute(mainAttributeType) < (short)GlobalConfig.Instance.HarmfulActionCost;
					if (!flag3)
					{
						Character character2 = DomainManager.Character.GetElement_Objects(targetCharId);
						short favorability = DomainManager.Character.GetFavorability(targetCharId, this._id);
						sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
						ValueTuple<short, byte, byte> valueTuple2 = this.CalcCombatSkillToLearnFromCharacter(context, character2, personalNeed.CombatSkillType);
						short skillTemplateId = valueTuple2.Item1;
						byte currInternalIndex = valueTuple2.Item2;
						byte pageTypes = valueTuple2.Item3;
						CombatSkillItem skillConfig = Config.CombatSkill.Instance[skillTemplateId];
						short bookTemplateId = skillConfig.BookId;
						sbyte grade = Config.CombatSkill.Instance[skillTemplateId].Grade;
						switch (requestActionType)
						{
						case 0:
						{
							int respondChance = AiHelper.GeneralActionConstants.GetAskToTeachSkillRespondChance(this, character2, favorabilityType, skillConfig.Grade);
							bool agreeToRequest = context.Random.CheckPercentProb(respondChance);
							bool succeed = false;
							bool flag4 = agreeToRequest;
							if (flag4)
							{
								short qualification = this.GetCombatSkillQualification(skillConfig.Type);
								short attainment = this.GetCombatSkillAttainment(skillConfig.Type);
								sbyte personality = this.GetPersonality(1);
								int successRate = Character.GetTaughtNewSkillSuccessRate(skillConfig.Grade, qualification, attainment, personality);
								succeed = context.Random.CheckPercentProb(successRate);
							}
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(character2, new RequestCombatSkillDemandAction
							{
								BookTemplateId = bookTemplateId,
								InternalIndex = currInternalIndex,
								GeneratedPageTypes = pageTypes,
								AgreeToRequest = agreeToRequest,
								Succeed = succeed
							}));
							break;
						}
						case 1:
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(character2, new StealCombatSkillDemandAction
							{
								BookTemplateId = bookTemplateId,
								InternalIndex = currInternalIndex,
								GeneratedPageTypes = pageTypes,
								Phase = this.GetStealCombatSkillActionPhase(context.Random, character2, personalNeed.CombatSkillType, grade, false)
							}));
							break;
						case 2:
						{
							int alertFactor = character2.GetGradeAlertFactor(grade, 1);
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(character2, new ScamCombatSkillDemandAction
							{
								BookTemplateId = bookTemplateId,
								InternalIndex = currInternalIndex,
								GeneratedPageTypes = pageTypes,
								Phase = this.GetScamActionPhase(context.Random, character2, alertFactor, false)
							}));
							break;
						}
						default:
						{
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 3);
							defaultInterpolatedStringHandler.AppendLiteral("Unrecognized request action type ");
							defaultInterpolatedStringHandler.AppendFormatted<sbyte>(requestActionType);
							defaultInterpolatedStringHandler.AppendLiteral(" for ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
							defaultInterpolatedStringHandler.AppendLiteral(" to ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(targetCharId);
							throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						}
						this._actionEnergies.SpendEnergyOnAction(2);
					}
				}
			}
		}

		// Token: 0x06006DEF RID: 28143 RVA: 0x003E1EB0 File Offset: 0x003E00B0
		private void OfflineCalcGeneralAction_AskHelpOnCombatSkillReading(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Item.SkillBook book)
		{
			short combatSkillTemplateId = book.GetCombatSkillTemplateId();
			ValueTuple<int, byte> combatSkillBookCurrReadingInfo = this.GetCombatSkillBookCurrReadingInfo(book);
			int combatSkillIndex = combatSkillBookCurrReadingInfo.Item1;
			byte needHelpPage = combatSkillBookCurrReadingInfo.Item2;
			bool flag = needHelpPage >= 6;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(64, 2);
				defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
				defaultInterpolatedStringHandler.AppendLiteral(" is trying to ask help on reading ");
				defaultInterpolatedStringHandler.AppendFormatted(Config.CombatSkill.Instance[combatSkillTemplateId].Name);
				defaultInterpolatedStringHandler.AppendLiteral(", which has already been read.");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			byte bookPageTypes = book.GetPageTypes();
			sbyte bookBehaviorType = SkillBookStateHelper.GetOutlinePageType(bookPageTypes);
			sbyte pageType = (needHelpPage == 0) ? bookBehaviorType : SkillBookStateHelper.GetNormalPageType(bookPageTypes, needHelpPage);
			byte pageInternalIndex = CombatSkillStateHelper.GetPageInternalIndex(bookBehaviorType, pageType, needHelpPage);
			Character character2 = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
			{
				GameData.Domains.CombatSkill.CombatSkill combatSkill;
				bool flag3 = !DomainManager.CombatSkill.TryGetElement_CombatSkills(new CombatSkillKey(character._id, combatSkillTemplateId), out combatSkill);
				bool result;
				if (flag3)
				{
					result = false;
				}
				else
				{
					ushort targetReadingState = combatSkill.GetReadingState();
					result = CombatSkillStateHelper.IsPageRead(targetReadingState, pageInternalIndex);
				}
				return result;
			}, false);
			bool flag2 = character2 == null;
			if (!flag2)
			{
				short favorability = DomainManager.Character.GetFavorability(character2.GetId(), this._id);
				sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
				sbyte targetBehaviorType = character2.GetBehaviorType();
				sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
				mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(character2, new CombatSkillReadingDemandAction
				{
					BookItemKey = book.GetItemKey(),
					InternalIndex = pageInternalIndex,
					AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
				}));
				this._actionEnergies.SpendEnergyOnAction(2);
			}
		}

		// Token: 0x06006DF0 RID: 28144 RVA: 0x003E2028 File Offset: 0x003E0228
		private void OfflineCalcGeneralAction_AskHelpOnLifeSkillReading(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Item.SkillBook book)
		{
			short lifeSkillTemplateId = book.GetLifeSkillTemplateId();
			ValueTuple<int, byte> lifeSkillBookCurrReadingInfo = this.GetLifeSkillBookCurrReadingInfo(book);
			int lifeSkillIndex = lifeSkillBookCurrReadingInfo.Item1;
			byte needHelpPage = lifeSkillBookCurrReadingInfo.Item2;
			bool flag = needHelpPage >= 5;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(64, 2);
				defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
				defaultInterpolatedStringHandler.AppendLiteral(" is trying to ask help on reading ");
				defaultInterpolatedStringHandler.AppendFormatted(LifeSkill.Instance[lifeSkillTemplateId].Name);
				defaultInterpolatedStringHandler.AppendLiteral(", which has already been read.");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			Character character2 = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
			{
				int index = character.FindLearnedLifeSkillIndex(lifeSkillTemplateId);
				return index >= 0 && character._learnedLifeSkills[index].IsPageRead(needHelpPage);
			}, false);
			bool flag2 = character2 == null;
			if (!flag2)
			{
				short favorability = DomainManager.Character.GetFavorability(character2.GetId(), this._id);
				sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
				sbyte targetBehaviorType = character2.GetBehaviorType();
				sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
				mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(character2, new LifeSkillReadingDemandAction
				{
					BookItemKey = book.GetItemKey(),
					PageId = needHelpPage,
					AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
				}));
				this._actionEnergies.SpendEnergyOnAction(2);
			}
		}

		// Token: 0x06006DF1 RID: 28145 RVA: 0x003E2178 File Offset: 0x003E0378
		private void OfflineCalcGeneralAction_AskHelpOnReading(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(2);
			if (!flag)
			{
				GameData.Domains.Item.SkillBook book = DomainManager.Item.GetElement_SkillBooks(personalNeed.ItemId);
				bool flag2 = book.IsCombatSkillBook();
				if (flag2)
				{
					this.OfflineCalcGeneralAction_AskHelpOnCombatSkillReading(context, mod, currBlockChars, book);
				}
				else
				{
					this.OfflineCalcGeneralAction_AskHelpOnLifeSkillReading(context, mod, currBlockChars, book);
				}
			}
		}

		// Token: 0x06006DF2 RID: 28146 RVA: 0x003E21D0 File Offset: 0x003E03D0
		private void OfflineCalcGeneralAction_AskHelpOnBreaking(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(2);
			if (!flag)
			{
				GameData.Domains.CombatSkill.CombatSkill selfCombatSkill = DomainManager.CombatSkill.GetElement_CombatSkills(new CombatSkillKey(this._id, personalNeed.CombatSkillTemplateId));
				Character character2 = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
				{
					GameData.Domains.CombatSkill.CombatSkill targetCombatSkill;
					return DomainManager.CombatSkill.TryGetElement_CombatSkills(new CombatSkillKey(character._id, personalNeed.CombatSkillTemplateId), out targetCombatSkill) && CombatSkillStateHelper.IsBrokenOut(targetCombatSkill.GetActivationState());
				}, false);
				bool flag2 = character2 == null;
				if (!flag2)
				{
					short favorability = DomainManager.Character.GetFavorability(character2.GetId(), this._id);
					sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
					sbyte targetBehaviorType = character2.GetBehaviorType();
					sbyte respondChance = AiHelper.GeneralActionConstants.GetAskForHelpRespondChance(targetBehaviorType, favorabilityType);
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(character2, new BreakingDemandAction
					{
						CombatSkillTemplateId = personalNeed.CombatSkillTemplateId,
						AgreeToRequest = context.Random.CheckPercentProb((int)respondChance)
					}));
					this._actionEnergies.SpendEnergyOnAction(2);
				}
			}
		}

		// Token: 0x06006DF3 RID: 28147 RVA: 0x003E22C4 File Offset: 0x003E04C4
		private unsafe void OfflineCalcGeneralAction_GainExp(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(3);
			if (!flag)
			{
				sbyte behaviorType = this.GetBehaviorType();
				sbyte selfGrade = this._organizationInfo.Grade;
				short selfEclecticAttainment = this.GetLifeSkillAttainment(15);
				List<int>[] actionTargets = context.AdvanceMonthRelatedData.DemandActionTargets.Occupy();
				List<int> playCombatTargets = actionTargets[0];
				List<int> beatCombatTargets = actionTargets[1];
				List<int> lifeSkillBattleTargets = actionTargets[2];
				List<int> cricketBattleTargets = actionTargets[3];
				bool canStartCombatPlay = !this.NeedToAvoidCombat(CombatType.Play);
				bool canStartCombatBeat = canStartCombatPlay && !this.NeedToAvoidCombat(CombatType.Beat);
				sbyte[] validGradeOffsets = AiHelper.GeneralActionConstants.CricketBattleGradeOffsets[(int)behaviorType];
				foreach (int blockCharId in currBlockChars)
				{
					Character targetChar;
					bool flag2 = !DomainManager.Character.TryGetElement_Objects(blockCharId, out targetChar);
					if (!flag2)
					{
						bool flag3 = targetChar.GetAgeGroup() != 2;
						if (!flag3)
						{
							bool flag4 = this._consummateLevel > targetChar._consummateLevel || this._consummateLevel < targetChar._consummateLevel - 4;
							if (!flag4)
							{
								RelatedCharacter relation;
								bool flag5 = !DomainManager.Character.TryGetRelation(this._id, blockCharId, out relation);
								if (!flag5)
								{
									sbyte favorabilityType = FavorabilityType.GetFavorabilityType(relation.Favorability);
									bool targetCanAcceptCombatPlay = !targetChar.NeedToAvoidCombat(CombatType.Play);
									bool targetCanAcceptCombatBeat = targetCanAcceptCombatPlay && !targetChar.NeedToAvoidCombat(CombatType.Beat);
									bool flag6 = favorabilityType <= 2 && canStartCombatPlay && targetCanAcceptCombatPlay;
									if (flag6)
									{
										beatCombatTargets.Add(blockCharId);
									}
									bool flag7 = favorabilityType >= 3 && canStartCombatBeat && targetCanAcceptCombatBeat;
									if (flag7)
									{
										playCombatTargets.Add(blockCharId);
									}
									bool flag8 = favorabilityType >= 2;
									if (flag8)
									{
										lifeSkillBattleTargets.Add(blockCharId);
									}
									foreach (sbyte offset in validGradeOffsets)
									{
										bool flag9 = selfGrade + offset != targetChar.GetInteractionGrade();
										if (!flag9)
										{
											cricketBattleTargets.Add(blockCharId);
											break;
										}
									}
								}
							}
						}
					}
				}
				int selectableCount = 0;
				ValueTuple<sbyte, short>* selectableActionTypes = stackalloc ValueTuple<sbyte, short>[checked(unchecked((UIntPtr)6) * (UIntPtr)sizeof(ValueTuple<sbyte, short>))];
				sbyte[] weights = AiHelper.GainExpActionType.Weights;
				sbyte[] priorities = AiHelper.GainExpActionType.Priorities[(int)behaviorType];
				for (int i = 0; i < priorities.Length; i++)
				{
					sbyte actionType = priorities[i];
					bool flag10 = actionType == 3 && selfEclecticAttainment <= 150;
					if (!flag10)
					{
						bool flag11 = actionType < 4;
						if (flag11)
						{
							bool flag12 = actionTargets[(int)actionType].Count <= 0;
							if (!flag12)
							{
								selectableActionTypes[(IntPtr)selectableCount * (IntPtr)sizeof(ValueTuple<sbyte, short>) / (IntPtr)sizeof(ValueTuple<sbyte, short>)] = new ValueTuple<sbyte, short>(actionType, (short)weights[i]);
								selectableCount++;
							}
						}
						else
						{
							bool flag13 = actionType == 4;
							if (flag13)
							{
								bool flag14 = !this.HasBookToReadForExp();
								if (!flag14)
								{
									selectableActionTypes[(IntPtr)selectableCount * (IntPtr)sizeof(ValueTuple<sbyte, short>) / (IntPtr)sizeof(ValueTuple<sbyte, short>)] = new ValueTuple<sbyte, short>(actionType, (short)weights[i]);
									selectableCount++;
								}
							}
							else
							{
								selectableActionTypes[(IntPtr)selectableCount * (IntPtr)sizeof(ValueTuple<sbyte, short>) / (IntPtr)sizeof(ValueTuple<sbyte, short>)] = new ValueTuple<sbyte, short>(actionType, (short)weights[i]);
								selectableCount++;
							}
						}
					}
				}
				bool flag15 = selectableCount <= 0;
				if (flag15)
				{
					context.AdvanceMonthRelatedData.DemandActionTargets.Release(ref actionTargets);
				}
				else
				{
					switch (CollectionUtils.GetRandomWeightedElement<sbyte>(context.Random, selectableActionTypes, selectableCount))
					{
					case 0:
					{
						int targetCharId = playCombatTargets.GetRandom(context.Random);
						Character targetChar2 = DomainManager.Character.GetElement_Objects(targetCharId);
						mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar2, new GainExpByCombatAction
						{
							CombatType = CombatType.Play
						}));
						break;
					}
					case 1:
					{
						int targetCharId2 = beatCombatTargets.GetRandom(context.Random);
						Character targetChar3 = DomainManager.Character.GetElement_Objects(targetCharId2);
						mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar3, new GainExpByCombatAction
						{
							CombatType = CombatType.Beat
						}));
						break;
					}
					case 2:
					{
						int targetCharId3 = lifeSkillBattleTargets.GetRandom(context.Random);
						Character targetChar4 = DomainManager.Character.GetElement_Objects(targetCharId3);
						short selfMaxAttainment = Math.Max(1, this.GetLifeSkillAttainments().GetMaxLifeSkillValue());
						short targetMaxAttainment = Math.Max(1, targetChar4.GetLifeSkillAttainments().GetMaxLifeSkillValue());
						bool succeed = context.Random.CheckPercentProb((int)(selfMaxAttainment * 50 / targetMaxAttainment));
						int expGain = succeed ? DomainManager.Character.CalcExpGain(targetChar4._organizationInfo.Grade, (int)(targetMaxAttainment * 50 / selfMaxAttainment)) : DomainManager.Character.CalcExpGain(this._organizationInfo.Grade, (int)(selfMaxAttainment * 50 / targetMaxAttainment));
						mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar4, new GainExpByLifeSkillBattleAction
						{
							Succeed = succeed,
							ExpGain = expGain
						}));
						break;
					}
					case 3:
					{
						int targetCharId4 = cricketBattleTargets.GetRandom(context.Random);
						Character targetChar5 = DomainManager.Character.GetElement_Objects(targetCharId4);
						short targetAttainment = Math.Max(1, targetChar5.GetLifeSkillAttainment(15));
						sbyte targetGrade = targetChar5.GetInteractionGrade();
						int successRate = (int)(selfEclecticAttainment * 50 / targetAttainment + (short)((selfGrade - targetGrade) * 20));
						bool succeed2 = context.Random.CheckPercentProb(successRate);
						Wager wager = succeed2 ? DomainManager.Item.SelectCharacterValidWager(context, targetChar5) : DomainManager.Item.SelectCharacterValidWager(context, this);
						int expGain2 = succeed2 ? DomainManager.Character.CalcExpGain(targetChar5._organizationInfo.Grade, (int)(targetAttainment * 50 / selfEclecticAttainment)) : DomainManager.Character.CalcExpGain(this._organizationInfo.Grade, (int)(selfEclecticAttainment * 50 / targetAttainment));
						mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar5, new GainExpByCricketBattleAction
						{
							Wager = wager,
							Succeed = succeed2,
							ExpGain = expGain2
						}));
						break;
					}
					case 4:
					{
						ItemKey itemKey = this.SelectBookToReadForExp(context);
						bool flag16 = !itemKey.IsValid();
						if (!flag16)
						{
							sbyte grade = Config.SkillBook.Instance[itemKey.TemplateId].Grade;
							short durabilityReduction = 3;
							short durability = DomainManager.Item.GetElement_SkillBooks(itemKey.Id).GetCurrDurability();
							bool flag17 = durabilityReduction > durability;
							if (flag17)
							{
								durabilityReduction = durability;
							}
							int expGain3 = (int)(SkillGradeData.Instance[grade].ReadingExpGainPerPage * durabilityReduction);
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new GainExpByReadingAction
							{
								ExpGain = expGain3,
								DurabilityReduction = durabilityReduction,
								ItemKey = itemKey
							}));
						}
						break;
					}
					case 5:
					{
						int expGain4 = DomainManager.Character.CalcExpGain(this._organizationInfo.Grade, 100);
						mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new GainExpByStrollAction
						{
							ExpGain = expGain4
						}));
						break;
					}
					}
					this._actionEnergies.SpendEnergyOnAction(3);
					context.AdvanceMonthRelatedData.DemandActionTargets.Release(ref actionTargets);
				}
			}
		}

		// Token: 0x06006DF4 RID: 28148 RVA: 0x003E29B4 File Offset: 0x003E0BB4
		private unsafe void OfflineCalcGeneralAction_SpendResource(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(3);
			if (!flag)
			{
				int amount = this.GetResource(personalNeed.ResourceType) - personalNeed.Amount;
				bool flag2 = amount <= 0;
				if (!flag2)
				{
					Span<int> span = new Span<int>(stackalloc byte[(UIntPtr)32], 8);
					Span<int> neededResources = span;
					neededResources.Fill(0);
					Span<sbyte> span2 = new Span<sbyte>(stackalloc byte[(UIntPtr)4], 4);
					SpanList<sbyte> validActions = span2;
					validActions.Add(0);
					bool flag3 = this.IsInRegularSettlementRange();
					if (flag3)
					{
						validActions.Add(1);
						bool flag4 = personalNeed.ResourceType == 6;
						if (flag4)
						{
							validActions.Add(2);
						}
					}
					bool flag5 = this.CanInteractTreasury() && context.Random.CheckPercentProb((int)AiHelper.GeneralActionConstants.StoreInTreasuryChance[(int)this.GetBehaviorType()]);
					if (flag5)
					{
						validActions.Add(3);
					}
					CollectionUtils.Shuffle<sbyte>(context.Random, validActions);
					switch (validActions.GetRandom(context.Random))
					{
					case 0:
					{
						HashSet<int> srcSet = (caringCharIds.Count > 0) ? caringCharIds : currBlockChars;
						Character targetChar = this.SelectMaxPriorityActionTarget(context, srcSet, null, true);
						bool flag6 = targetChar == null;
						if (!flag6)
						{
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new GiveResourceAction
							{
								ResourceType = personalNeed.ResourceType,
								Amount = amount
							}));
							this._actionEnergies.SpendEnergyOnAction(3);
						}
						break;
					}
					case 1:
					{
						bool hasNeededResourceType = false;
						foreach (GameData.Domains.Character.Ai.PersonalNeed need in this._personalNeeds)
						{
							bool flag7 = need.TemplateId != 8;
							if (!flag7)
							{
								bool flag8 = need.ResourceType == personalNeed.ResourceType;
								if (!flag8)
								{
									*neededResources[(int)need.ResourceType] = Math.Max(0, need.Amount - *(ref this._resources.Items.FixedElementField + (IntPtr)need.ResourceType * 4));
									bool flag9 = *neededResources[(int)need.ResourceType] > 0;
									if (flag9)
									{
										hasNeededResourceType = true;
									}
								}
							}
						}
						sbyte spentResourceType = personalNeed.ResourceType;
						sbyte gainResourceType = hasNeededResourceType ? ((sbyte)RandomUtils.GetRandomIndex(neededResources, context.Random)) : 6;
						bool flag10 = spentResourceType == gainResourceType;
						if (!flag10)
						{
							int gainAmount = *neededResources[(int)gainResourceType];
							int neededResourceTotalWorth = gainAmount * (int)GlobalConfig.ResourcesWorth[(int)gainResourceType];
							int spentAmount = neededResourceTotalWorth * 2 / (int)GlobalConfig.ResourcesWorth[(int)spentResourceType];
							bool flag11 = spentAmount > amount || !hasNeededResourceType;
							if (flag11)
							{
								spentAmount = amount;
								gainAmount = spentAmount * (int)GlobalConfig.ResourcesWorth[(int)spentResourceType] / (int)(2 * GlobalConfig.ResourcesWorth[(int)gainResourceType]);
							}
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new ExchangeResourceAction
							{
								SpentResourceType = personalNeed.ResourceType,
								SpentResourceAmount = spentAmount,
								GainResourceType = gainResourceType,
								GainResourceAmount = gainAmount
							}));
							this._actionEnergies.SpendEnergyOnAction(3);
						}
						break;
					}
					case 2:
					{
						HashSet<int> srcSet2 = (caringCharIds.Count > 0) ? caringCharIds : currBlockChars;
						Character targetChar2 = this.SelectMaxPriorityActionTarget(context, srcSet2, delegate(Character character)
						{
							bool flag16 = character._id == DomainManager.Taiwu.GetTaiwuCharId();
							bool result;
							if (flag16)
							{
								result = false;
							}
							else
							{
								foreach (GameData.Domains.Character.Ai.PersonalNeed need2 in character._personalNeeds)
								{
									bool flag17 = need2.TemplateId == 10 && need2.ItemType != 11;
									if (flag17)
									{
										return true;
									}
								}
								result = false;
							}
							return result;
						}, true);
						bool flag12 = targetChar2 == null;
						if (!flag12)
						{
							foreach (GameData.Domains.Character.Ai.PersonalNeed targetNeed in targetChar2._personalNeeds)
							{
								bool flag13 = targetNeed.TemplateId != 10 || targetNeed.ItemType == 11 || targetNeed.ItemType == 3;
								if (!flag13)
								{
									bool flag14 = this.OfflineCalcGeneralAction_MakeArtisanOrder(context, mod, targetNeed, targetChar2._id);
									if (flag14)
									{
										break;
									}
									bool flag15 = this.OfflineCalcGeneralAction_PurchaseItem(context, mod, targetNeed, targetChar2);
									if (flag15)
									{
										break;
									}
								}
							}
						}
						break;
					}
					case 3:
						mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new StoreTreasuryResourceAction
						{
							ResourceType = personalNeed.ResourceType,
							Amount = amount
						}));
						this._actionEnergies.SpendEnergyOnAction(3);
						break;
					}
				}
			}
		}

		// Token: 0x06006DF5 RID: 28149 RVA: 0x003E2E10 File Offset: 0x003E1010
		private unsafe void OfflineCalcGeneralAction_SpendItem(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(3);
			if (!flag)
			{
				HashSet<int> srcSet = (caringCharIds.Count > 0) ? caringCharIds : currBlockChars;
				bool allowSell = this.IsInRegularSettlementRange();
				Character targetChar = (allowSell && context.Random.NextBool()) ? null : this.SelectMaxPriorityActionTarget(context, srcSet, null, true);
				sbyte targetBestGrade = (targetChar != null) ? targetChar.GetInteractionGrade() : 0;
				ItemBase selectedItem = this.SelectSpareableItem(context, targetBestGrade, allowSell);
				bool flag2 = selectedItem == null;
				if (!flag2)
				{
					Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)3], 3);
					SpanList<sbyte> validActions = span;
					bool flag3 = targetChar != null && selectedItem.GetCurrDurability() >= selectedItem.GetMaxDurability();
					if (flag3)
					{
						validActions.Add(0);
					}
					bool flag4 = this.IsInRegularSettlementRange();
					if (flag4)
					{
						validActions.Add(1);
					}
					bool flag5 = this.CanInteractTreasury() && context.Random.CheckPercentProb((int)AiHelper.GeneralActionConstants.StoreInTreasuryChance[(int)this.GetBehaviorType()]);
					if (flag5)
					{
						validActions.Add(2);
					}
					bool flag6 = validActions.Count == 0;
					if (!flag6)
					{
						ItemKey selectedItemKey = selectedItem.GetItemKey();
						switch (validActions.GetRandom(context.Random))
						{
						case 0:
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new GiveItemAction
							{
								TargetItem = selectedItemKey,
								Amount = 1
							}));
							break;
						case 1:
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new SellItemAction
							{
								TargetItem = selectedItemKey,
								Amount = Math.Max(1, this._inventory.Items[selectedItemKey] / 2)
							}));
							break;
						case 2:
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new StoreTreasuryItemAction
							{
								TargetItem = selectedItem.GetItemKey(),
								Amount = 1
							}));
							break;
						default:
							this._actionEnergies.SpendEnergyOnAction(3);
							break;
						}
					}
				}
			}
		}

		// Token: 0x06006DF6 RID: 28150 RVA: 0x003E3008 File Offset: 0x003E1208
		private bool CanInteractTreasury()
		{
			bool flag = this._organizationInfo.SettlementId < 0;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				Settlement settlement = DomainManager.Organization.GetSettlement(this._organizationInfo.SettlementId);
				bool flag2 = !settlement.HasTreasury() && this._organizationInfo.OrgTemplateId != 16;
				if (flag2)
				{
					result = false;
				}
				else
				{
					Location settlementLocation = settlement.GetLocation();
					bool flag3 = settlementLocation.AreaId != this._location.AreaId;
					if (flag3)
					{
						result = false;
					}
					else
					{
						MapBlockData block = DomainManager.Map.GetBlock(this._location);
						bool flag4 = block.GetRootBlock().GetLocation() != settlementLocation;
						result = !flag4;
					}
				}
			}
			return result;
		}

		// Token: 0x06006DF7 RID: 28151 RVA: 0x003E30CC File Offset: 0x003E12CC
		private bool OfflineCalcGeneralAction_TakeTreasuryItem(IRandomSource random, PeriAdvanceMonthGeneralActionModification mod, GameData.Domains.Character.Ai.PersonalNeed personalNeed)
		{
			bool flag = !this.CanInteractTreasury();
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = !random.CheckPercentProb((int)AiHelper.GeneralActionConstants.TakeFromTreasuryChance[(int)this.GetBehaviorType()]);
				if (flag2)
				{
					result = false;
				}
				else
				{
					bool flag3 = this._organizationInfo.OrgTemplateId == 16 && personalNeed.ItemType == 3 && this._equipment[4].IsValid() && (short)personalNeed.TemplateId != this.GetIdealClothingTemplateId();
					if (flag3)
					{
						result = false;
					}
					else
					{
						Settlement settlement = DomainManager.Organization.GetSettlement(this._organizationInfo.SettlementId);
						SettlementTreasury treasury = DomainManager.Organization.GetTreasury(this._organizationInfo);
						ItemKey targetItemKey = treasury.Inventory.GetItemInSameGroup(personalNeed.ItemType, personalNeed.ItemTemplateId, -2);
						bool flag4 = !targetItemKey.IsValid();
						if (flag4)
						{
							result = false;
						}
						else
						{
							int requiredContribution = DomainManager.Organization.CalcItemContribution(settlement, targetItemKey, 1);
							bool flag5 = this._organizationInfo.OrgTemplateId != 16 && treasury.GetMemberContribution(this) < requiredContribution;
							if (flag5)
							{
								result = false;
							}
							else
							{
								mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new TakeTreasuryItemAction
								{
									TargetItem = targetItemKey,
									Amount = 1
								}));
								this._actionEnergies.SpendEnergyOnAction(1);
								result = true;
							}
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006DF8 RID: 28152 RVA: 0x003E3228 File Offset: 0x003E1428
		[Obsolete]
		private bool OfflineCalcGeneralAction_TakeTreasuryItem(PeriAdvanceMonthGeneralActionModification mod, Predicate<ItemKey> predicate)
		{
			bool flag = this._organizationInfo.SettlementId < 0;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				SettlementTreasury treasury = DomainManager.Organization.GetTreasury(this._organizationInfo);
				ItemKey selectedItemKey = ItemKey.Invalid;
				foreach (KeyValuePair<ItemKey, int> keyValuePair in treasury.Inventory.Items)
				{
					ItemKey itemKey2;
					int num;
					keyValuePair.Deconstruct(out itemKey2, out num);
					ItemKey itemKey = itemKey2;
					bool flag2 = !predicate(itemKey);
					if (!flag2)
					{
						selectedItemKey = itemKey;
						break;
					}
				}
				bool flag3 = !selectedItemKey.IsValid();
				if (flag3)
				{
					result = false;
				}
				else
				{
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new TakeTreasuryItemAction
					{
						TargetItem = selectedItemKey,
						Amount = 1
					}));
					this._actionEnergies.SpendEnergyOnAction(1);
					result = true;
				}
			}
			return result;
		}

		// Token: 0x06006DF9 RID: 28153 RVA: 0x003E3328 File Offset: 0x003E1528
		private unsafe bool OfflineCalcGeneralAction_TakeTreasuryResource(IRandomSource random, PeriAdvanceMonthGeneralActionModification mod, sbyte resourceType, int amount)
		{
			bool flag = !this.CanInteractTreasury();
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = !random.CheckPercentProb((int)AiHelper.GeneralActionConstants.TakeFromTreasuryChance[(int)this.GetBehaviorType()]);
				if (flag2)
				{
					result = false;
				}
				else
				{
					SettlementTreasury treasury = DomainManager.Organization.GetTreasury(this._organizationInfo);
					bool flag3 = *treasury.Resources[(int)resourceType] < amount;
					if (flag3)
					{
						result = false;
					}
					else
					{
						int requiredContribution = DomainManager.Organization.CalcResourceContribution(this._organizationInfo.OrgTemplateId, resourceType, amount);
						bool flag4 = treasury.GetMemberContribution(this) < requiredContribution;
						if (flag4)
						{
							result = false;
						}
						else
						{
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new TakeTreasuryResourceAction
							{
								ResourceType = resourceType,
								Amount = amount
							}));
							this._actionEnergies.SpendEnergyOnAction(1);
							result = true;
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006DFA RID: 28154 RVA: 0x003E3400 File Offset: 0x003E1600
		private unsafe void OfflineCalcGeneralAction_RandomActions(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			bool flag = this._organizationInfo.SettlementId >= 0;
			if (flag)
			{
				Settlement settlement = DomainManager.Organization.GetSettlement(this._organizationInfo.SettlementId);
				MapAreaData areaData = DomainManager.Map.GetElement_Areas((int)settlement.GetLocation().AreaId);
			}
			IntPtr intPtr = stackalloc byte[(UIntPtr)3];
			cpblk(intPtr, ref <PrivateImplementationDetails>.AE4B3280E56E2FAF83F414A6E3DABE9D5FBE18976544C05FED121ACCB85B53FC, 3);
			sbyte* actionTypes = intPtr;
			CollectionUtils.Shuffle<sbyte>(context.Random, actionTypes, 3);
			int i = 0;
			while (i < 3 && this._actionEnergies.HasEnoughForAction(4))
			{
				switch (actionTypes[i])
				{
				case 0:
					this.OfflineCalcGeneralAction_TeachSkill(context, mod, currBlockChars, caringCharIds);
					break;
				case 1:
					this.OfflineCalcGeneralAction_SocialStatus(context, mod, currBlockChars, caringCharIds);
					break;
				case 2:
					this.OfflineCalcGeneralAction_LifeSkill(context, mod, currBlockChars, caringCharIds);
					break;
				}
				i++;
			}
		}

		// Token: 0x06006DFB RID: 28155 RVA: 0x003E34E8 File Offset: 0x003E16E8
		public bool CanTeachCombatSkill(Character targetChar)
		{
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> selfCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(this._id);
			foreach (KeyValuePair<short, GameData.Domains.CombatSkill.CombatSkill> keyValuePair in selfCombatSkills)
			{
				short num;
				GameData.Domains.CombatSkill.CombatSkill combatSkill;
				keyValuePair.Deconstruct(out num, out combatSkill);
				short skillId = num;
				GameData.Domains.CombatSkill.CombatSkill skill = combatSkill;
				bool flag = skill.GetReadingState() != 0 && Config.CombatSkill.Instance[skillId].BookId >= 0 && !targetChar._learnedCombatSkills.Contains(skillId);
				if (flag)
				{
					return true;
				}
			}
			return false;
		}

		// Token: 0x06006DFC RID: 28156 RVA: 0x003E3598 File Offset: 0x003E1798
		public bool CanTeachLifeSkill(Character targetChar)
		{
			foreach (LifeSkillItem item in this._learnedLifeSkills)
			{
				bool flag = item.ReadingState != 0 && LifeSkill.Instance[item.SkillTemplateId].SkillBookId >= 0 && targetChar.FindLearnedLifeSkillIndex(item.SkillTemplateId) < 0;
				if (flag)
				{
					return true;
				}
			}
			return false;
		}

		// Token: 0x06006DFD RID: 28157 RVA: 0x003E3628 File Offset: 0x003E1828
		public void GetTeachableCombatSkillBookIds(Character targetChar, List<ValueTuple<short, short>> weightTable)
		{
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> selfCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(this._id);
			foreach (short combatSkillTemplateId in this._learnedCombatSkills)
			{
				CombatSkillItem combatSkillCfg = Config.CombatSkill.Instance[combatSkillTemplateId];
				bool flag = combatSkillCfg.BookId < 0;
				if (!flag)
				{
					ushort selfReadingState = selfCombatSkills[combatSkillTemplateId].GetReadingState();
					bool flag2 = selfReadingState == 0;
					if (!flag2)
					{
						bool flag3 = targetChar._learnedCombatSkills.Contains(combatSkillTemplateId);
						if (!flag3)
						{
							int weight = 3 << (int)(8 - combatSkillCfg.Grade);
							bool isNonPublic = combatSkillCfg.IsNonPublic;
							if (isNonPublic)
							{
								weight /= 3;
							}
							weightTable.Add(new ValueTuple<short, short>(combatSkillCfg.BookId, (short)weight));
						}
					}
				}
			}
		}

		// Token: 0x06006DFE RID: 28158 RVA: 0x003E3714 File Offset: 0x003E1914
		public void GetTeachableLifeSkillBookIds(Character targetChar, List<ValueTuple<short, short>> weightTable)
		{
			foreach (LifeSkillItem lifeSkillItem in this._learnedLifeSkills)
			{
				LifeSkillItem lifeSkillCfg = LifeSkill.Instance[lifeSkillItem.SkillTemplateId];
				byte selfReadingState = lifeSkillItem.ReadingState;
				bool flag = lifeSkillCfg.SkillBookId < 0 || selfReadingState == 0;
				if (!flag)
				{
					bool flag2 = targetChar.FindLearnedLifeSkillIndex(lifeSkillItem.SkillTemplateId) >= 0;
					if (!flag2)
					{
						int weight = 3 << (int)(8 - lifeSkillCfg.Grade);
						weightTable.Add(new ValueTuple<short, short>(lifeSkillCfg.SkillBookId, (short)weight));
					}
				}
			}
		}

		// Token: 0x06006DFF RID: 28159 RVA: 0x003E37D8 File Offset: 0x003E19D8
		private unsafe void OfflineCalcGeneralAction_TeachSkill(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			bool flag = !this._actionEnergies.HasEnoughForAction(4);
			if (!flag)
			{
				Character targetChar = null;
				bool flag2 = caringCharIds.Count > 0;
				if (flag2)
				{
					targetChar = this.SelectMaxPriorityActionTarget(context, caringCharIds, new Predicate<Character>(this.<OfflineCalcGeneralAction_TeachSkill>g__IsValidTargetForTeachSkill|677_0), false);
				}
				if (targetChar == null)
				{
					targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, new Predicate<Character>(this.<OfflineCalcGeneralAction_TeachSkill>g__IsValidTargetForTeachSkill|677_0), false);
				}
				bool flag3 = targetChar == null;
				if (!flag3)
				{
					List<ValueTuple<short, short>> weightTable = context.AdvanceMonthRelatedData.WeightTable.Occupy();
					this.GetTeachableCombatSkillBookIds(targetChar, weightTable);
					this.GetTeachableLifeSkillBookIds(targetChar, weightTable);
					short skillBookTemplateId = RandomUtils.GetRandomResult<short>(weightTable, context.Random);
					context.AdvanceMonthRelatedData.WeightTable.Release(ref weightTable);
					SkillBookItem bookCfg = Config.SkillBook.Instance[skillBookTemplateId];
					short favorability = DomainManager.Character.GetFavorability(targetChar.GetId(), this._id);
					sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
					int teachChance = AiHelper.GeneralActionConstants.GetAskToTeachSkillRespondChance(targetChar, this, favorabilityType, bookCfg.Grade);
					bool flag4 = !context.Random.CheckPercentProb(teachChance);
					if (!flag4)
					{
						bool flag5 = bookCfg.CombatSkillType >= 0;
						if (flag5)
						{
							Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> selfCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(this._id);
							ushort readingState = selfCombatSkills[bookCfg.CombatSkillTemplateId].GetReadingState();
							byte currInternalIndex;
							for (currInternalIndex = 0; currInternalIndex < 15; currInternalIndex += 1)
							{
								bool flag6 = CombatSkillStateHelper.IsPageRead(readingState, currInternalIndex);
								if (flag6)
								{
									break;
								}
							}
							byte pageTypes = CombatSkillStateHelper.GeneratePageTypesFromReadingState(context.Random, readingState);
							CombatSkillShorts combatSkillAttainments = *targetChar.GetCombatSkillAttainments();
							CombatSkillShorts combatSkillQualifications = *targetChar.GetCombatSkillQualifications();
							Personalities personalities = targetChar.GetPersonalities();
							int successRate = Character.GetTaughtNewSkillSuccessRate(bookCfg.Grade, *(ref combatSkillQualifications.Items.FixedElementField + (IntPtr)bookCfg.CombatSkillType * 2), *(ref combatSkillAttainments.Items.FixedElementField + (IntPtr)bookCfg.CombatSkillType * 2), *(ref personalities.Items.FixedElementField + 1));
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new TeachCombatSkillAction
							{
								SkillTemplateId = bookCfg.CombatSkillTemplateId,
								InternalIndex = currInternalIndex,
								GeneratedPageTypes = pageTypes,
								Succeed = context.Random.CheckPercentProb(successRate)
							}));
						}
						else
						{
							int selectedIndex = this.FindLearnedLifeSkillIndex(bookCfg.LifeSkillTemplateId);
							LifeSkillItem learnedLifeSkill = this._learnedLifeSkills[selectedIndex];
							byte pageId;
							for (pageId = 0; pageId < 5; pageId += 1)
							{
								bool flag7 = learnedLifeSkill.IsPageRead(pageId);
								if (flag7)
								{
									break;
								}
							}
							LifeSkillShorts lifeSkillAttainments = *targetChar.GetLifeSkillAttainments();
							LifeSkillShorts lifeSkillQualifications = *targetChar.GetLifeSkillQualifications();
							Personalities personalities2 = targetChar.GetPersonalities();
							int successRate2 = Character.GetTaughtNewSkillSuccessRate(bookCfg.Grade, *(ref lifeSkillQualifications.Items.FixedElementField + (IntPtr)bookCfg.LifeSkillType * 2), *(ref lifeSkillAttainments.Items.FixedElementField + (IntPtr)bookCfg.LifeSkillType * 2), *(ref personalities2.Items.FixedElementField + 1));
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new TeachLifeSkillAction
							{
								SkillTemplateId = bookCfg.LifeSkillTemplateId,
								PageId = pageId,
								Succeed = context.Random.CheckPercentProb(successRate2)
							}));
						}
						this._actionEnergies.SpendEnergyOnAction(4);
					}
				}
			}
		}

		// Token: 0x06006E00 RID: 28160 RVA: 0x003E3B18 File Offset: 0x003E1D18
		private unsafe void OfflineCalcGeneralAction_SocialStatus(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
			bool flag = orgMemberCfg.IdentityInteractConfig == null || orgMemberCfg.IdentityInteractConfig.Count == 0 || (orgMemberCfg.IdentityActiveAge >= 0 && this._currAge < orgMemberCfg.IdentityActiveAge);
			if (!flag)
			{
				sbyte* actionTypes = stackalloc sbyte[(UIntPtr)orgMemberCfg.IdentityInteractConfig.Count];
				int count = 0;
				foreach (sbyte identityInteractionType in orgMemberCfg.IdentityInteractConfig)
				{
					actionTypes[count] = identityInteractionType;
					count++;
				}
				CollectionUtils.Shuffle<sbyte>(context.Random, actionTypes, count);
				int i = 0;
				while (i < count && this._actionEnergies.HasEnoughForAction(4))
				{
					switch (actionTypes[i])
					{
					case 4:
						this.OfflineCalcGeneralAction_SocialStatus_SellItem(context, mod, currBlockChars, caringCharIds);
						break;
					case 5:
						this.OfflineCalcGeneralAction_SocialStatus_Heal(context, mod, currBlockChars, caringCharIds);
						break;
					case 6:
						this.OfflineCalcGeneralAction_SocialStatus_Repair(context, mod, currBlockChars, caringCharIds);
						break;
					case 7:
						this.OfflineCalcGeneralAction_SocialStatus_Barb(context, mod, currBlockChars, caringCharIds);
						break;
					case 8:
						this.OfflineCalcGeneralAction_SocialStatus_Beg(context, mod, currBlockChars, caringCharIds);
						break;
					}
					i++;
				}
			}
		}

		// Token: 0x06006E01 RID: 28161 RVA: 0x003E3C94 File Offset: 0x003E1E94
		private void OfflineCalcGeneralAction_SocialStatus_ExtendFavor(DataContext context, PeriAdvanceMonthGeneralActionModification mod)
		{
			Character taiwu = DomainManager.Taiwu.GetTaiwu();
			bool flag = !this._location.Equals(taiwu.GetLocation());
			if (!flag)
			{
				Settlement settlement = DomainManager.Organization.GetSettlement(this._organizationInfo.SettlementId);
				Location settlementLocation = settlement.GetLocation();
				bool flag2 = DomainManager.Extra.GetAreaSpiritualDebt(settlementLocation.AreaId) < 200;
				if (!flag2)
				{
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(taiwu, new SocialStatusExtendFavorAction()));
				}
			}
		}

		// Token: 0x06006E02 RID: 28162 RVA: 0x003E3D1C File Offset: 0x003E1F1C
		private void OfflineCalcGeneralAction_SocialStatus_CultivateWill(DataContext context, PeriAdvanceMonthGeneralActionModification mod)
		{
			Character taiwu = DomainManager.Taiwu.GetTaiwu();
			bool flag = !this._location.Equals(taiwu.GetLocation());
			if (!flag)
			{
				int taiwuMoney = taiwu.GetResource(6);
				bool flag2 = taiwuMoney < 10000;
				if (!flag2)
				{
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(taiwu, new SocialStatusCultivateWillAction()));
				}
			}
		}

		// Token: 0x06006E03 RID: 28163 RVA: 0x003E3D7C File Offset: 0x003E1F7C
		private void OfflineCalcGeneralAction_SocialStatus_MerchantPraise(DataContext context, PeriAdvanceMonthGeneralActionModification mod)
		{
			Character taiwu = DomainManager.Taiwu.GetTaiwu();
			bool flag = !this._location.Equals(taiwu.GetLocation());
			if (!flag)
			{
				Settlement settlement = DomainManager.Organization.GetSettlement(this._organizationInfo.SettlementId);
				Location settlementLocation = settlement.GetLocation();
				bool flag2 = DomainManager.Extra.GetAreaSpiritualDebt(settlementLocation.AreaId) < 200;
				if (!flag2)
				{
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(taiwu, new SocialStatusMerchantPraiseAction()));
				}
			}
		}

		// Token: 0x06006E04 RID: 28164 RVA: 0x003E3E04 File Offset: 0x003E2004
		private void OfflineCalcGeneralAction_SocialStatus_TeaWine(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			sbyte currMaxEatingSlotCount = this.GetCurrMaxEatingSlotsCount();
			sbyte eatingSlot = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
			bool flag = eatingSlot < 0;
			if (!flag)
			{
				bool flag2 = this.GetAgeGroup() != 2;
				if (!flag2)
				{
					sbyte behaviorType = this.GetBehaviorType();
					short rateAdjust = DomainManager.Extra.GetAiActionRateAdjust(this._id, 6, -1);
					sbyte selfEatForbiddenFoodChance = AiHelper.UpdateStatusConstants.EatForbiddenFoodChance[(int)behaviorType];
					bool isWineForbidden = this.IsForbiddenToDrinkingWines();
					bool allowWines = !isWineForbidden || context.Random.CheckPercentProb((int)((short)selfEatForbiddenFoodChance + rateAdjust));
					List<ItemKey> teaWines = context.AdvanceMonthRelatedData.ItemKeys.Occupy();
					foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
					{
						ItemKey itemKey2;
						int num;
						keyValuePair.Deconstruct(out itemKey2, out num);
						ItemKey itemKey = itemKey2;
						int amount = num;
						bool flag3 = itemKey.ItemType != 9;
						if (!flag3)
						{
							bool flag4 = amount < 2;
							if (!flag4)
							{
								short itemSubType = ItemTemplateHelper.GetItemSubType(itemKey.ItemType, itemKey.TemplateId);
								bool flag5 = itemSubType == 901 && !allowWines;
								if (!flag5)
								{
									bool flag6 = this.TryDetectAttachedPoisons(itemKey);
									if (!flag6)
									{
										teaWines.Add(itemKey);
									}
								}
							}
						}
					}
					ItemKey selectedItem = teaWines.GetRandomOrDefault(context.Random, ItemKey.Invalid);
					context.AdvanceMonthRelatedData.ItemKeys.Release(ref teaWines);
					bool flag7 = !selectedItem.IsValid();
					if (!flag7)
					{
						bool isWine = ItemTemplateHelper.GetItemSubType(selectedItem.ItemType, selectedItem.TemplateId) == 901;
						Character selectedChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, (Character character) => character.GetEatingItems().GetAvailableEatingSlotsCount(character.GetCurrMaxEatingSlotsCount()) > 0, false);
						bool flag8 = selectedChar == null;
						if (!flag8)
						{
							sbyte baseChance = isWine ? AiHelper.GeneralActionConstants.SocialStatusDrinkWineChance[(int)behaviorType] : AiHelper.GeneralActionConstants.SocialStatusDrinkTeaChance[(int)behaviorType];
							bool flag9 = !context.Random.CheckPercentProb((int)(caringCharIds.Contains(selectedChar.GetId()) ? (baseChance + 30) : baseChance));
							if (!flag9)
							{
								bool succeed = true;
								bool flag10 = isWine && selectedChar.IsForbiddenToDrinkingWines();
								if (flag10)
								{
									sbyte targetBehaviorType = selectedChar.GetBehaviorType();
									short targetRateAdjust = DomainManager.Extra.GetAiActionRateAdjust(selectedChar.GetId(), 6, -1);
									sbyte targetBreakRuleChance = AiHelper.UpdateStatusConstants.EatForbiddenFoodChance[(int)targetBehaviorType];
									succeed = context.Random.CheckPercentProb((int)((short)targetBreakRuleChance + targetRateAdjust));
								}
								mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(selectedChar, new SocialStatusTeaWineAction
								{
									SelfTeaWineItem = selectedItem,
									TargetTeaWineItem = selectedItem,
									Succeed = succeed
								}));
								this._actionEnergies.SpendEnergyOnAction(4);
							}
						}
					}
				}
			}
		}

		// Token: 0x06006E05 RID: 28165 RVA: 0x003E40DC File Offset: 0x003E22DC
		private void OfflineCalcGeneralAction_SocialStatus_SellItem(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			MerchantData merchantData;
			bool flag = !DomainManager.Merchant.TryGetMerchantData(this._id, out merchantData);
			if (!flag)
			{
				List<ItemKey> itemKeys = context.AdvanceMonthRelatedData.ItemKeys.Occupy();
				bool flag2 = merchantData.GoodsList0 != null;
				if (flag2)
				{
					itemKeys.AddRange(merchantData.GoodsList0.Items.Keys);
				}
				bool flag3 = merchantData.GoodsList1 != null;
				if (flag3)
				{
					itemKeys.AddRange(merchantData.GoodsList1.Items.Keys);
				}
				bool flag4 = merchantData.GoodsList2 != null;
				if (flag4)
				{
					itemKeys.AddRange(merchantData.GoodsList2.Items.Keys);
				}
				bool flag5 = merchantData.GoodsList3 != null;
				if (flag5)
				{
					itemKeys.AddRange(merchantData.GoodsList3.Items.Keys);
				}
				bool flag6 = merchantData.GoodsList4 != null;
				if (flag6)
				{
					itemKeys.AddRange(merchantData.GoodsList4.Items.Keys);
				}
				bool flag7 = merchantData.GoodsList5 != null;
				if (flag7)
				{
					itemKeys.AddRange(merchantData.GoodsList5.Items.Keys);
				}
				bool flag8 = merchantData.GoodsList6 != null;
				if (flag8)
				{
					itemKeys.AddRange(merchantData.GoodsList6.Items.Keys);
				}
				ItemKey itemKey = itemKeys.GetRandomOrDefault(context.Random, ItemKey.Invalid);
				context.AdvanceMonthRelatedData.ItemKeys.Release(ref itemKeys);
				bool flag9 = !itemKey.IsValid();
				if (!flag9)
				{
					int price = ItemTemplateHelper.GetBaseValue(itemKey.ItemType, itemKey.TemplateId) * 150 / 100;
					Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, (Character character) => character.GetResource(6) >= price, false);
					bool flag10 = targetChar == null;
					if (!flag10)
					{
						sbyte behaviorType = this.GetBehaviorType();
						sbyte baseChance = AiHelper.GeneralActionConstants.SocialStatusSellItemChance[(int)behaviorType];
						bool flag11 = !context.Random.CheckPercentProb((int)(caringCharIds.Contains(targetChar.GetId()) ? (baseChance + 30) : baseChance));
						if (!flag11)
						{
							int successChance = (int)(40 + this.GetLifeSkillAttainment(15) / 10);
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new SocialStatusSellItemAction
							{
								ItemKey = itemKey,
								Amount = 1,
								Price = price,
								Succeed = context.Random.CheckPercentProb(successChance)
							}));
							this._actionEnergies.SpendEnergyOnAction(4);
						}
					}
				}
			}
		}

		// Token: 0x06006E06 RID: 28166 RVA: 0x003E4350 File Offset: 0x003E2550
		private unsafe void OfflineCalcGeneralAction_SocialStatus_Heal(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			sbyte behaviorType = this.GetBehaviorType();
			sbyte baseChance = AiHelper.GeneralActionConstants.SocialStatusHealChance[(int)behaviorType];
			bool flag = *(ref this._resources.Items.FixedElementField + (IntPtr)5 * 4) < (int)GlobalConfig.Instance.HealInjuryBaseHerb;
			if (!flag)
			{
				CombatResources usableCombatResources = DomainManager.Character.GetUsableCombatResources(this._id);
				Span<EHealActionType> span = new Span<EHealActionType>(stackalloc byte[(UIntPtr)16], 4);
				SpanList<EHealActionType> actionTypes = span;
				foreach (EHealActionType type2 in Character.AllHealActions)
				{
					bool flag2 = this.CalcHealAttainment(type2) >= 200 && usableCombatResources.Get(type2) > 0;
					if (flag2)
					{
						actionTypes.Add(type2);
					}
				}
				bool flag3 = actionTypes.Count == 0;
				if (!flag3)
				{
					CollectionUtils.Shuffle<EHealActionType>(context.Random, actionTypes);
					SpanList<EHealActionType>.Enumerator enumerator2 = actionTypes.GetEnumerator();
					while (enumerator2.MoveNext())
					{
						EHealActionType type = *enumerator2.Current;
						Character selectedChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, (Character character) => character.NeedHealAction(type) && character.CalcHealCostHerb(type, false) <= *(ref this._resources.Items.FixedElementField + (IntPtr)5 * 4), false);
						bool flag4 = selectedChar == null;
						if (!flag4)
						{
							bool flag5 = !context.Random.CheckPercentProb((int)(caringCharIds.Contains(selectedChar.GetId()) ? (baseChance + 30) : baseChance));
							if (!flag5)
							{
								mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(selectedChar, new SocialStatusHealAction
								{
									Type = type,
									HerbAmount = selectedChar.CalcHealCostHerb(type, false)
								}));
								this._actionEnergies.SpendEnergyOnAction(4);
								break;
							}
						}
					}
				}
			}
		}

		// Token: 0x06006E07 RID: 28167 RVA: 0x003E4528 File Offset: 0x003E2728
		private void OfflineCalcGeneralAction_SocialStatus_Repair(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, (Character character) => character._inventory.Items.Keys.Any(new Func<ItemKey, bool>(Character.NeedRepair)) || character._equipment.Any(new Func<ItemKey, bool>(Character.NeedRepair)), false);
			bool flag = targetChar == null;
			if (!flag)
			{
				sbyte behaviorType = this.GetBehaviorType();
				sbyte baseChance = AiHelper.GeneralActionConstants.SocialStatusHealChance[(int)behaviorType];
				bool flag2 = !context.Random.CheckPercentProb((int)(caringCharIds.Contains(targetChar.GetId()) ? (baseChance + 30) : baseChance));
				if (!flag2)
				{
					List<ItemKey> itemKeys = context.AdvanceMonthRelatedData.ItemKeys.Occupy();
					foreach (ItemKey itemKey in targetChar._inventory.Items.Keys)
					{
						bool flag3 = Character.NeedRepair(itemKey);
						if (flag3)
						{
							itemKeys.Add(itemKey);
						}
					}
					foreach (ItemKey itemKey2 in targetChar._equipment)
					{
						bool flag4 = Character.NeedRepair(itemKey2);
						if (flag4)
						{
							itemKeys.Add(itemKey2);
						}
					}
					ItemKey selectedItemKey = itemKeys.GetRandom(context.Random);
					context.AdvanceMonthRelatedData.ItemKeys.Release(ref itemKeys);
					ItemBase selectedItem = DomainManager.Item.GetBaseItem(selectedItemKey);
					short currDurability = selectedItem.GetCurrDurability();
					sbyte requiredResourceType = 6;
					EquipmentBase equip = DomainManager.Item.GetBaseEquipment(selectedItemKey);
					int requiredMoney = ItemTemplateHelper.GetRepairNeedResourceCount(equip.GetMaterialResources(), selectedItemKey, currDurability);
					bool flag5 = !targetChar.CheckResources(context, requiredResourceType, requiredMoney);
					if (!flag5)
					{
						sbyte requiredLifeSkillType = ItemTemplateHelper.GetCraftRequiredLifeSkillType(selectedItemKey.ItemType, selectedItemKey.TemplateId);
						short attainmentRequired = ItemTemplateHelper.GetRepairRequiredAttainment(selectedItemKey.ItemType, selectedItemKey.TemplateId, currDurability);
						short charAttainment = this.GetLifeSkillAttainment(requiredLifeSkillType);
						itemKeys = context.AdvanceMonthRelatedData.ItemKeys.Occupy();
						foreach (ItemKey itemKey3 in this._inventory.Items.Keys)
						{
							bool flag6 = itemKey3.ItemType != 6;
							if (!flag6)
							{
								ItemBase baseItem = DomainManager.Item.GetBaseItem(itemKey3);
								bool flag7 = baseItem.GetCurrDurability() <= 0;
								if (!flag7)
								{
									CraftToolItem cfg = Config.CraftTool.Instance[itemKey3.TemplateId];
									bool flag8 = charAttainment + cfg.AttainmentBonus >= attainmentRequired && cfg.RequiredLifeSkillTypes.Contains(requiredLifeSkillType);
									if (flag8)
									{
										itemKeys.Add(itemKey3);
									}
								}
							}
						}
						ItemKey selectedToolKey = itemKeys.GetRandomOrDefault(context.Random, ItemKey.Invalid);
						context.AdvanceMonthRelatedData.ItemKeys.Release(ref itemKeys);
						bool flag9 = !selectedItemKey.IsValid();
						if (!flag9)
						{
							mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new SocialStatusRepairAction
							{
								RepairedItem = selectedItemKey,
								ToolUsed = selectedToolKey,
								ResourceType = requiredResourceType,
								Amount = requiredMoney
							}));
							this._actionEnergies.SpendEnergyOnAction(4);
						}
					}
				}
			}
		}

		// Token: 0x06006E08 RID: 28168 RVA: 0x003E4860 File Offset: 0x003E2A60
		private static bool NeedRepair(ItemKey itemKey)
		{
			bool flag = !itemKey.IsValid();
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				ItemBase baseItem = DomainManager.Item.GetBaseItem(itemKey);
				short currDurability = baseItem.GetCurrDurability();
				result = (baseItem.GetRepairable() && currDurability > 0 && currDurability < baseItem.GetMaxDurability() / 2);
			}
			return result;
		}

		// Token: 0x06006E09 RID: 28169 RVA: 0x003E48B4 File Offset: 0x003E2AB4
		private void OfflineCalcGeneralAction_SocialStatus_Barb(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			Character targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, delegate(Character character)
			{
				int targetCharId = character.GetId();
				bool flag8 = character.GetAgeGroup() != 2;
				bool result;
				if (flag8)
				{
					result = false;
				}
				else
				{
					RelatedCharacter relation;
					bool flag9 = !DomainManager.Character.TryGetRelation(this._id, targetCharId, out relation) || relation.GetFavorabilityType() < 3;
					if (flag9)
					{
						result = false;
					}
					else
					{
						bool flag10 = !character._avatar.GetGrowableElementShowingState(0);
						if (flag10)
						{
							result = false;
						}
						else
						{
							bool flag11 = character.GetGroupFeature(496) >= 0;
							if (flag11)
							{
								result = false;
							}
							else
							{
								sbyte chance = 10;
								bool flag12 = caringCharIds.Contains(targetCharId);
								if (flag12)
								{
									chance += 10;
								}
								result = context.Random.CheckPercentProb((int)chance);
							}
						}
					}
				}
				return result;
			}, false);
			bool flag = targetChar == null;
			if (!flag)
			{
				short attainment = this.GetLifeSkillAttainment(5);
				int successRate = (int)(80 + attainment / 10);
				int attractionIncreaseRate = (int)(20 + attainment / 5);
				bool succeed = context.Random.CheckPercentProb(successRate);
				bool attractionIncreased = context.Random.CheckPercentProb(attractionIncreaseRate);
				AvatarData avatar = targetChar.GetAvatar();
				short frontHairId = avatar.FrontHairId;
				short backHairId = avatar.BackHairId;
				short beard1Id = avatar.Beard1Id;
				short beard2Id = avatar.Beard2Id;
				bool flag2 = succeed;
				if (flag2)
				{
					AvatarGroup avatarGroup = AvatarManager.Instance.GetAvatarGroup((int)avatar.AvatarId);
					bool flag3 = avatar.GetGrowableElementShowingState(1) && avatar.GetGrowableElementShowingAbility(1) && avatar.GetGrowableElementShowingState(2) && avatar.GetGrowableElementShowingAbility(2) && avatarGroup.Beard1Res.CheckIndex(0) && avatarGroup.Beard2Res.CheckIndex(0);
					if (flag3)
					{
						AvatarAsset currBeard1Res = avatarGroup.Beard1Res.First((AvatarAsset beardRes) => beardRes.Id == beard1Id);
						AvatarAsset currBeard2Res = avatarGroup.Beard2Res.First((AvatarAsset beardRes) => beardRes.Id == beard2Id);
						float beardCharmRate = Math.Min(currBeard1Res.Config.CharmExtraArg, currBeard2Res.Config.CharmExtraArg);
						if (!attractionIncreased)
						{
							ValueTuple<short, short> randomBeardsWithCondition = avatarGroup.GetRandomBeardsWithCondition(context.Random, (AvatarAsset beardRes) => beardRes.Config.CharmExtraArg < beardCharmRate);
							beard1Id = randomBeardsWithCondition.Item1;
							beard2Id = randomBeardsWithCondition.Item2;
						}
						else
						{
							ValueTuple<short, short> randomBeardsWithCondition = avatarGroup.GetRandomBeardsWithCondition(context.Random, (AvatarAsset beardRes) => beardRes.Config.CharmExtraArg > beardCharmRate);
							beard1Id = randomBeardsWithCondition.Item1;
							beard2Id = randomBeardsWithCondition.Item2;
						}
						bool flag4 = avatarGroup.IsBeardless(beard1Id, beard2Id);
						if (flag4)
						{
							short num = avatar.Beard1Id;
							short num2 = avatar.Beard2Id;
							beard2Id = num2;
							beard1Id = num;
						}
					}
					bool flag5 = avatar.GetGrowableElementShowingState(0) && avatar.GetGrowableElementShowingAbility(0) && avatarGroup.Hair1Res.CheckIndex(0) && avatarGroup.Hair2Res.CheckIndex(0);
					if (flag5)
					{
						HairRes currFrontHairRes = avatarGroup.Hair1Res.First((HairRes hairRes) => hairRes.Id == frontHairId);
						HairRes currBackHairRes = avatarGroup.Hair2Res.First((HairRes hairRes) => hairRes.Id == backHairId);
						float hairCharmRate = Math.Min(currFrontHairRes.Hair.Config.CharmExtraArg, currBackHairRes.Hair.Config.CharmExtraArg);
						if (!attractionIncreased)
						{
							ValueTuple<short, short> randomHairsWithCondition = avatarGroup.GetRandomHairsWithCondition(context.Random, (HairRes hairRes) => hairRes.Hair.Config.CharmExtraArg < hairCharmRate);
							frontHairId = randomHairsWithCondition.Item1;
							backHairId = randomHairsWithCondition.Item2;
						}
						else
						{
							ValueTuple<short, short> randomHairsWithCondition = avatarGroup.GetRandomHairsWithCondition(context.Random, (HairRes hairRes) => hairRes.Hair.Config.CharmExtraArg > hairCharmRate);
							frontHairId = randomHairsWithCondition.Item1;
							backHairId = randomHairsWithCondition.Item2;
						}
						bool flag6 = avatarGroup.IsHairless(frontHairId, backHairId);
						if (flag6)
						{
							short num2 = avatar.FrontHairId;
							short num = avatar.BackHairId;
							backHairId = num;
							frontHairId = num2;
						}
					}
					bool flag7 = avatar.FrontHairId == frontHairId && avatar.BackHairId == backHairId && avatar.Beard1Id == beard1Id && avatar.Beard2Id == beard2Id;
					if (flag7)
					{
						return;
					}
				}
				mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new SocialStatusBarbAction
				{
					AttractionIncreased = attractionIncreased,
					Succeed = succeed,
					TargetBeard1Id = beard1Id,
					TargetBeard2Id = beard2Id,
					TargetFrontHairId = frontHairId,
					TargetBackHairId = backHairId
				}));
				this._actionEnergies.SpendEnergyOnAction(4);
			}
		}

		// Token: 0x06006E0A RID: 28170 RVA: 0x003E4D14 File Offset: 0x003E2F14
		private void OfflineCalcGeneralAction_SocialStatus_Beg(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			sbyte behaviorType = this.GetBehaviorType();
			sbyte startChance = AiHelper.GeneralActionConstants.StartBegChance[(int)behaviorType];
			bool flag = !context.Random.CheckPercentProb((int)startChance);
			if (!flag)
			{
				List<int> potentialTargets = context.AdvanceMonthRelatedData.CharIdList.Occupy();
				foreach (int charId in currBlockChars)
				{
					bool flag2 = charId == this._id;
					if (!flag2)
					{
						Character character = DomainManager.Character.GetElement_Objects(charId);
						bool flag3 = character.GetAgeGroup() == 0;
						if (!flag3)
						{
							bool flag4 = character.GetResource(6) >= 500;
							if (flag4)
							{
								potentialTargets.Add(charId);
							}
						}
					}
				}
				int targetCharId = potentialTargets.GetRandomOrDefault(context.Random, -1);
				context.AdvanceMonthRelatedData.CharIdList.Release(ref potentialTargets);
				bool flag5 = targetCharId < 0;
				if (!flag5)
				{
					Character targetChar = DomainManager.Character.GetElement_Objects(targetCharId);
					sbyte targetBehaviorType = targetChar.GetBehaviorType();
					sbyte successRate = AiHelper.GeneralActionConstants.BegSuccessChance[(int)targetBehaviorType];
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new SocialStatusBegAction
					{
						MoneyAmount = context.Random.Next(50, 101),
						Succeed = context.Random.CheckPercentProb((int)successRate)
					}));
					this._actionEnergies.SpendEnergyOnAction(4);
				}
			}
		}

		// Token: 0x06006E0B RID: 28171 RVA: 0x003E4E8C File Offset: 0x003E308C
		private unsafe void OfflineCalcGeneralAction_LifeSkill(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			IntPtr intPtr = stackalloc byte[(UIntPtr)6];
			cpblk(intPtr, ref <PrivateImplementationDetails>.17E88DB187AFD62C16E5DEBF3E6527CD006BC012BC90B51A810CD80C2D511F43, 6);
			sbyte* selectableLifeSkills = intPtr;
			CollectionUtils.Shuffle<sbyte>(context.Random, selectableLifeSkills, 6);
			int i = 0;
			while (i < 6 && this._actionEnergies.HasEnoughForAction(4))
			{
				switch (selectableLifeSkills[i])
				{
				case 0:
					this.OfflineCalcGeneralAction_Entertainment(context, mod, currBlockChars, caringCharIds);
					break;
				case 1:
					this.OfflineCalcGeneralAction_Crafting(context, mod);
					break;
				case 2:
					this.OfflineCalcGeneralAction_Awakening(context, mod, currBlockChars, caringCharIds);
					break;
				case 3:
					this.OfflineCalcGeneralAction_TeaWine(context, mod);
					break;
				case 4:
					this.OfflineCalcGeneralAction_CricketBattle(context, mod, currBlockChars, caringCharIds);
					break;
				case 5:
					this.OfflineCalcGeneralAction_Divination(context, mod, currBlockChars, caringCharIds);
					break;
				}
				i++;
			}
		}

		// Token: 0x06006E0C RID: 28172 RVA: 0x003E4F58 File Offset: 0x003E3158
		private unsafe void OfflineCalcGeneralAction_Entertainment(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			LifeSkillShorts selfLifeSkillAttainments = *this.GetLifeSkillAttainments();
			int num = LifeSkillType.EntertainingTypes.Length;
			Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)num], num);
			Span<sbyte> entertainingLifeSkillTypes = span;
			int entertainingLifeSkillTypeCount = 0;
			foreach (sbyte lifeSkillType in LifeSkillType.EntertainingTypes)
			{
				bool flag = *(ref selfLifeSkillAttainments.Items.FixedElementField + (IntPtr)lifeSkillType * 2) >= 200;
				if (flag)
				{
					*entertainingLifeSkillTypes[entertainingLifeSkillTypeCount] = lifeSkillType;
					entertainingLifeSkillTypeCount++;
				}
			}
			bool flag2 = entertainingLifeSkillTypeCount == 0;
			if (!flag2)
			{
				sbyte selectedLifeSkillType = *entertainingLifeSkillTypes[context.Random.Next(entertainingLifeSkillTypeCount)];
				HashSet<int> srcSet = (caringCharIds.Count > 0) ? caringCharIds : currBlockChars;
				Character targetChar = this.SelectMaxPriorityActionTarget(context, srcSet, null, false);
				bool flag3 = targetChar == null;
				if (!flag3)
				{
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new LifeSkillEntertainmentAction
					{
						LifeSkillType = selectedLifeSkillType
					}));
					this._actionEnergies.SpendEnergyOnAction(4);
				}
			}
		}

		// Token: 0x06006E0D RID: 28173 RVA: 0x003E5060 File Offset: 0x003E3260
		private unsafe void OfflineCalcGeneralAction_Crafting(DataContext context, PeriAdvanceMonthGeneralActionModification mod)
		{
			bool flag = this._inventory.Items.Count <= 1;
			if (!flag)
			{
				bool flag2 = !context.Random.CheckPercentProb((int)(50 + this.GetPersonality(2)));
				if (!flag2)
				{
					LifeSkillShorts lifeSkillAttainments = *this.GetLifeSkillAttainments();
					sbyte* craftingLifeSkillTypes = stackalloc sbyte[(UIntPtr)LifeSkillType.CraftingTypes.Length];
					int craftingLifeSkillTypeCount = 0;
					foreach (sbyte lifeSkillType in LifeSkillType.CraftingTypes)
					{
						bool flag3 = *(ref lifeSkillAttainments.Items.FixedElementField + (IntPtr)lifeSkillType * 2) < 200;
						if (!flag3)
						{
							craftingLifeSkillTypes[craftingLifeSkillTypeCount] = lifeSkillType;
							craftingLifeSkillTypeCount++;
						}
					}
					bool flag4 = craftingLifeSkillTypeCount == 0;
					if (!flag4)
					{
						CollectionUtils.Shuffle<sbyte>(context.Random, craftingLifeSkillTypes, craftingLifeSkillTypeCount);
						List<ItemKey> materials = context.AdvanceMonthRelatedData.ItemKeys.Occupy();
						for (int i = 0; i < craftingLifeSkillTypeCount; i++)
						{
							sbyte lifeSkillType2 = craftingLifeSkillTypes[i];
							this._inventory.GetCraftMaterials(lifeSkillType2, materials);
							bool flag5 = materials.Count == 0;
							if (!flag5)
							{
								ItemKey selectedMaterial = materials.GetRandom(context.Random);
								MaterialItem selectedMaterialCfg = Config.Material.Instance[selectedMaterial.TemplateId];
								short durabilityCost;
								ItemKey bestTool = this._inventory.GetBestCraftTool(lifeSkillType2, selectedMaterialCfg.Grade, out durabilityCost);
								bool flag6 = !bestTool.IsValid();
								if (!flag6)
								{
									short makeItemType = selectedMaterialCfg.CraftableItemTypes.GetRandom(context.Random);
									List<short> makeItemSubTypeList = MakeItemType.Instance[makeItemType].MakeItemSubTypes;
									short makeItemSubType = makeItemSubTypeList.GetRandom(context.Random);
									MakeItemSubTypeItem makeItemSubTypeCfg = MakeItemSubType.Instance[makeItemSubType];
									int requiredMoney = Character.<OfflineCalcGeneralAction_Crafting>g__GetMakeItemRequiredResourceWorth|691_0(selectedMaterialCfg, makeItemSubTypeCfg) * OrganizationDomain.GetOrgMemberConfig(this._organizationInfo).PurchaseItemDiscount / 100;
									bool flag7 = *(ref this._resources.Items.FixedElementField + (IntPtr)6 * 4) < requiredMoney;
									if (!flag7)
									{
										short attainment = *(ref lifeSkillAttainments.Items.FixedElementField + (IntPtr)lifeSkillType2 * 2) + Config.CraftTool.Instance[bestTool.TemplateId].AttainmentBonus;
										ValueTuple<sbyte, short> makeResult = DomainManager.Building.GetMakeResultTargetItemGradeAndTemplateId(selectedMaterial.TemplateId, attainment, lifeSkillType2, makeItemSubTypeList, makeItemSubType, this.GetLearnedLifeSkills(), context.Random, false, 0);
										bool flag8 = makeResult.Item2 < 0;
										if (!flag8)
										{
											mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new LifeSkillCraftingAction
											{
												ToolUsed = bestTool,
												Material = selectedMaterial,
												RequiredMoney = requiredMoney,
												LifeSkillType = lifeSkillType2,
												TargetItemType = makeItemSubTypeCfg.Result.ItemType,
												TargetItemTemplateId = makeResult.Item2
											}));
											this._actionEnergies.SpendEnergyOnAction(4);
											break;
										}
									}
								}
							}
						}
						context.AdvanceMonthRelatedData.ItemKeys.Release(ref materials);
					}
				}
			}
		}

		// Token: 0x06006E0E RID: 28174 RVA: 0x003E5348 File Offset: 0x003E3548
		private unsafe void OfflineCalcGeneralAction_Awakening(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			LifeSkillShorts lifeSkillQualification = *this.GetBaseLifeSkillQualifications();
			LifeSkillShorts lifeSkillAttainments = *this.GetLifeSkillAttainments();
			short selfBuddhismAttainment = *(ref lifeSkillAttainments.Items.FixedElementField + (IntPtr)13 * 2);
			short selfTaoismAttainment = *(ref lifeSkillAttainments.Items.FixedElementField + (IntPtr)12 * 2);
			bool flag = selfBuddhismAttainment < 200 && selfTaoismAttainment < 200;
			if (!flag)
			{
				Character targetChar = null;
				bool flag2 = caringCharIds.Count > 0;
				if (flag2)
				{
					targetChar = this.SelectMaxPriorityActionTarget(context, caringCharIds, new Predicate<Character>(this.IsValidForLifeSkillAwakening), false);
				}
				if (targetChar == null)
				{
					targetChar = this.SelectMaxPriorityActionTarget(context, currBlockChars, new Predicate<Character>(this.IsValidForLifeSkillAwakening), false);
				}
				bool flag3 = targetChar == null;
				if (!flag3)
				{
					LifeSkillShorts targetLifeSkillQualifications = *targetChar.GetBaseLifeSkillQualifications();
					Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)16], 16);
					Span<sbyte> canImproveLifeSkillTypes = span;
					int canImproveCount = 0;
					for (sbyte lifeSkillType = 0; lifeSkillType < 16; lifeSkillType += 1)
					{
						bool flag4 = *(ref targetLifeSkillQualifications.Items.FixedElementField + (IntPtr)lifeSkillType * 2) < 90;
						if (flag4)
						{
							*canImproveLifeSkillTypes[canImproveCount] = lifeSkillType;
							canImproveCount++;
						}
					}
					bool flag5 = canImproveCount == 0;
					if (flag5)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(77, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Selected character ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
						defaultInterpolatedStringHandler.AppendLiteral(" does not have a life skill type that can be awakened by ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					sbyte selectedLifeSkillType = *canImproveLifeSkillTypes[context.Random.Next(canImproveCount)];
					int num = LifeSkillType.ReligiousTypes.Length;
					span = new Span<sbyte>(stackalloc byte[(UIntPtr)num], num);
					Span<sbyte> religiousLifeSkillTypes = span;
					int religiousLifeSkillTypeCount = 0;
					foreach (sbyte lifeSkillType2 in LifeSkillType.ReligiousTypes)
					{
						bool flag6 = *(ref lifeSkillQualification.Items.FixedElementField + (IntPtr)lifeSkillType2 * 2) > *(ref targetLifeSkillQualifications.Items.FixedElementField + (IntPtr)lifeSkillType2 * 2) && *(ref lifeSkillAttainments.Items.FixedElementField + (IntPtr)lifeSkillType2 * 2) >= 200;
						if (flag6)
						{
							*religiousLifeSkillTypes[religiousLifeSkillTypeCount] = lifeSkillType2;
							religiousLifeSkillTypeCount++;
						}
					}
					bool flag7 = religiousLifeSkillTypeCount == 0;
					if (flag7)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(87, 2);
						defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
						defaultInterpolatedStringHandler.AppendLiteral(" cannot perform awakening action to ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
						defaultInterpolatedStringHandler.AppendLiteral(" due to insufficient buddhism or taoism attainment.");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					sbyte religiousLifeSkillType = *religiousLifeSkillTypes[context.Random.Next(religiousLifeSkillTypeCount)];
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new LifeSkillAwakeningAction
					{
						AwakeningLifeSkillType = religiousLifeSkillType,
						IncreasedLifeSkillType = selectedLifeSkillType
					}));
					this._actionEnergies.SpendEnergyOnAction(4);
				}
			}
		}

		// Token: 0x06006E0F RID: 28175 RVA: 0x003E5628 File Offset: 0x003E3828
		private unsafe bool IsValidForLifeSkillAwakening(Character targetChar)
		{
			LifeSkillShorts selfQualifications = *this.GetBaseLifeSkillQualifications();
			LifeSkillShorts selfAttainments = *this.GetLifeSkillAttainments();
			LifeSkillShorts targetQualifications = *targetChar.GetBaseLifeSkillQualifications();
			bool hasValidLifeSkillType = false;
			for (sbyte lifeSkillType = 0; lifeSkillType < 16; lifeSkillType += 1)
			{
				bool flag = *(ref targetQualifications.Items.FixedElementField + (IntPtr)lifeSkillType * 2) < 90;
				if (flag)
				{
					hasValidLifeSkillType = true;
					break;
				}
			}
			bool flag2 = !hasValidLifeSkillType;
			bool result;
			if (flag2)
			{
				result = false;
			}
			else
			{
				bool flag3 = *(ref selfQualifications.Items.FixedElementField + (IntPtr)13 * 2) > *(ref targetQualifications.Items.FixedElementField + (IntPtr)13 * 2) && *(ref selfAttainments.Items.FixedElementField + (IntPtr)13 * 2) >= 200;
				if (flag3)
				{
					result = true;
				}
				else
				{
					bool flag4 = *(ref selfQualifications.Items.FixedElementField + (IntPtr)12 * 2) > *(ref targetQualifications.Items.FixedElementField + (IntPtr)12 * 2) && *(ref selfAttainments.Items.FixedElementField + (IntPtr)12 * 2) >= 200;
					result = flag4;
				}
			}
			return result;
		}

		// Token: 0x06006E10 RID: 28176 RVA: 0x003E5758 File Offset: 0x003E3958
		private unsafe void OfflineCalcGeneralAction_TeaWine(DataContext context, PeriAdvanceMonthGeneralActionModification mod)
		{
			int happinessAbs = (int)((this._happiness >= 0) ? this._happiness : (-(int)this._happiness));
			bool flag = !context.Random.CheckPercentProb(happinessAbs);
			if (!flag)
			{
				bool flag2 = this.GetAgeGroup() != 2;
				if (!flag2)
				{
					short appraisalAttainment = this.GetLifeSkillAttainment(5);
					bool flag3 = appraisalAttainment < 150;
					if (!flag3)
					{
						int targetGrade = (int)(appraisalAttainment / 75) - context.Random.Next(4);
						bool flag4 = targetGrade > 8;
						if (flag4)
						{
							targetGrade = 8;
						}
						short targetTeaWineTemplateId = -1;
						bool flag5 = targetGrade >= 0;
						if (flag5)
						{
							sbyte behaviorType = this.GetBehaviorType();
							sbyte eatForbiddenFoodChance = AiHelper.UpdateStatusConstants.EatForbiddenFoodChance[(int)behaviorType];
							bool isWineForbidden = this.IsForbiddenToDrinkingWines();
							bool allowWines = !isWineForbidden || context.Random.CheckPercentProb((int)eatForbiddenFoodChance);
							IntPtr intPtr = stackalloc byte[(UIntPtr)8];
							*intPtr = 27;
							*(intPtr + 2) = 18;
							*(intPtr + (IntPtr)2 * 2) = 9;
							*(intPtr + (IntPtr)3 * 2) = 0;
							Span<short> span = new Span<short>(intPtr, 4);
							Span<short> validTeaWines = span;
							int validTeaWineCount = allowWines ? 4 : 2;
							targetTeaWineTemplateId = (short)((int)(*validTeaWines[context.Random.Next(validTeaWineCount)]) + targetGrade);
						}
						mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(null, new LifeSkillTeaWineAction
						{
							TeaWineTemplateId = targetTeaWineTemplateId,
							Amount = 1
						}));
						this._actionEnergies.SpendEnergyOnAction(4);
					}
				}
			}
		}

		// Token: 0x06006E11 RID: 28177 RVA: 0x003E58B0 File Offset: 0x003E3AB0
		private void OfflineCalcGeneralAction_CricketBattle(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			short selfAttainment = this.GetLifeSkillAttainment(15);
			bool flag = selfAttainment < 150;
			if (!flag)
			{
				sbyte selfGrade = this._organizationInfo.Grade;
				sbyte behaviorType = this.GetBehaviorType();
				sbyte[] validGradeOffsets = AiHelper.GeneralActionConstants.CricketBattleGradeOffsets[(int)behaviorType];
				HashSet<int> charSet = (caringCharIds.Count > 0) ? caringCharIds : currBlockChars;
				Character targetChar = this.SelectMaxPriorityActionTarget(context, charSet, delegate(Character character)
				{
					sbyte grade = character.GetInteractionGrade();
					sbyte[] validGradeOffsets;
					foreach (sbyte offset in validGradeOffsets)
					{
						bool flag4 = grade + offset == selfGrade;
						if (flag4)
						{
							return true;
						}
					}
					return false;
				}, false);
				bool flag2 = targetChar == null;
				if (!flag2)
				{
					short targetAttainment = targetChar.GetLifeSkillAttainment(15);
					sbyte targetGrade = targetChar.GetInteractionGrade();
					bool flag3 = targetAttainment <= 0;
					if (flag3)
					{
						targetAttainment = 1;
					}
					int successRate = (int)(selfAttainment * 50 / targetAttainment + (short)((selfGrade - targetGrade) * 20));
					bool succeed = context.Random.CheckPercentProb(successRate);
					Wager wager = succeed ? DomainManager.Item.SelectCharacterValidWager(context, targetChar) : DomainManager.Item.SelectCharacterValidWager(context, this);
					mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new LifeSkillCricketAction
					{
						Wager = wager,
						Succeed = succeed
					}));
					this._actionEnergies.SpendEnergyOnAction(4);
				}
			}
		}

		// Token: 0x06006E12 RID: 28178 RVA: 0x003E59DC File Offset: 0x003E3BDC
		private void OfflineCalcGeneralAction_Divination(DataContext context, PeriAdvanceMonthGeneralActionModification mod, HashSet<int> currBlockChars, HashSet<int> caringCharIds)
		{
			short selfMathAttainment = this.GetLifeSkillAttainment(4);
			bool flag = selfMathAttainment < 150;
			if (!flag)
			{
				bool flag2 = this._health < this.GetLeftMaxHealth(false) || this._health <= 12;
				if (!flag2)
				{
					SecretInformationCharacterDataCollection selfSecretInfoCollection;
					DomainManager.Information.TryGetElement_CharacterSecretInformation(this._id, out selfSecretInfoCollection);
					HashSet<int> charSet = (caringCharIds.Count > 0) ? caringCharIds : currBlockChars;
					Character targetChar = this.SelectMaxPriorityActionTarget(context, charSet, delegate(Character character)
					{
						int charId = character.GetId();
						SecretInformationCharacterDataCollection secretInfoCollection;
						bool flag8 = !DomainManager.Information.TryGetElement_CharacterSecretInformation(charId, out secretInfoCollection);
						bool result;
						if (flag8)
						{
							result = false;
						}
						else
						{
							bool flag9 = secretInfoCollection.Collection.Count == 0;
							if (flag9)
							{
								result = false;
							}
							else
							{
								bool flag10 = selfSecretInfoCollection == null;
								if (flag10)
								{
									result = true;
								}
								else
								{
									foreach (int infoId in secretInfoCollection.Collection.Keys)
									{
										bool flag11 = !selfSecretInfoCollection.Collection.ContainsKey(infoId);
										if (flag11)
										{
											return true;
										}
									}
									result = false;
								}
							}
						}
						return result;
					}, false);
					bool flag3 = targetChar == null;
					if (!flag3)
					{
						SecretInformationCharacterDataCollection targetSecretInfoCollection = DomainManager.Information.GetElement_CharacterSecretInformation(targetChar.GetId());
						List<int> metaIdList = context.AdvanceMonthRelatedData.IntList.Occupy();
						metaIdList.Clear();
						bool flag4 = selfSecretInfoCollection == null;
						if (flag4)
						{
							metaIdList.AddRange(targetSecretInfoCollection.Collection.Keys);
						}
						else
						{
							foreach (KeyValuePair<int, SecretInformationCharacterData> pair in targetSecretInfoCollection.Collection)
							{
								bool flag5 = !selfSecretInfoCollection.Collection.ContainsKey(pair.Key);
								if (flag5)
								{
									metaIdList.Add(pair.Key);
								}
							}
						}
						bool flag6 = metaIdList.Count == 0;
						if (flag6)
						{
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(98, 3);
							defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
							defaultInterpolatedStringHandler.AppendLiteral(" cannot perform divination action to ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(targetChar);
							defaultInterpolatedStringHandler.AppendLiteral(" because target has no secret information that ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
							defaultInterpolatedStringHandler.AppendLiteral(" doesn't have.");
							throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						int selectedSecretInfoId = metaIdList.GetRandom(context.Random);
						context.AdvanceMonthRelatedData.IntList.Release(ref metaIdList);
						sbyte selfGrade = this.GetInteractionGrade();
						sbyte targetGrade = targetChar.GetInteractionGrade();
						short targetAttainment = targetChar.GetLifeSkillAttainment(4);
						bool flag7 = targetAttainment <= 0;
						if (flag7)
						{
							targetAttainment = 1;
						}
						int successRate = (int)(selfMathAttainment * 50 / targetAttainment - (short)((targetGrade - selfGrade) * 20));
						mod.PerformedActions.Add(new ValueTuple<Character, IGeneralAction>(targetChar, new LifeSkillDivinationAction
						{
							SecretInfoMetaDataId = selectedSecretInfoId,
							Succeed = context.Random.CheckPercentProb(successRate)
						}));
						this._actionEnergies.SpendEnergyOnAction(4);
					}
				}
			}
		}

		// Token: 0x06006E13 RID: 28179 RVA: 0x003E5C4C File Offset: 0x003E3E4C
		public void ClassifyPrioritizedActionTargets(List<int>[] prioritizedActionTargets, HashSet<int> charSet, IRandomSource random)
		{
			foreach (List<int> targets in prioritizedActionTargets)
			{
				targets.Clear();
			}
			foreach (int charId in charSet)
			{
				RelatedCharacter selfToTarget;
				bool flag = !DomainManager.Character.TryGetRelation(this._id, charId, out selfToTarget);
				if (!flag)
				{
					sbyte priorityType = AiHelper.ActionTargetType.GetActionTargetType(selfToTarget.RelationType);
					bool flag2 = priorityType == -1;
					if (!flag2)
					{
						prioritizedActionTargets[(int)priorityType].Add(charId);
					}
				}
			}
			int taiwuId = DomainManager.Taiwu.GetTaiwuCharId();
			RelatedCharacter selfToTaiwu;
			bool flag3 = DomainManager.Extra.IsProfessionalSkillUnlockedAndEquipped(28) && charSet.Contains(taiwuId) && DomainManager.Character.TryGetRelation(this._id, taiwuId, out selfToTaiwu);
			if (flag3)
			{
				sbyte priorityType2 = AiHelper.ActionTargetType.GetActionTargetType(selfToTaiwu.RelationType);
				bool flag4 = priorityType2 == -1;
				if (!flag4)
				{
					ProfessionSkillHandle.AristocratSkill_BoostTaiwuAsTargetInCollection(prioritizedActionTargets[(int)priorityType2]);
					CollectionUtils.Shuffle<int>(random, prioritizedActionTargets[(int)priorityType2]);
				}
			}
		}

		// Token: 0x06006E14 RID: 28180 RVA: 0x003E5D70 File Offset: 0x003E3F70
		public int SelectMaxPriorityActionTarget(List<int>[] prioritizedActionTargets, Predicate<int> condition)
		{
			sbyte behaviorType = this.GetBehaviorType();
			sbyte[] priorities = AiHelper.ActionTargetType.Priorities[(int)behaviorType];
			foreach (sbyte actionTargetType in priorities)
			{
				List<int> actionTargets = prioritizedActionTargets[(int)actionTargetType];
				foreach (int charId in actionTargets)
				{
					bool flag = condition(charId);
					if (flag)
					{
						return charId;
					}
				}
			}
			return -1;
		}

		// Token: 0x06006E15 RID: 28181 RVA: 0x003E5E08 File Offset: 0x003E4008
		public Character SelectRandomActionTarget(DataContext context, HashSet<int> currBlockChars, Predicate<Character> condition, bool includeBabies = false)
		{
			bool flag = currBlockChars == null;
			Character result;
			if (flag)
			{
				result = null;
			}
			else
			{
				List<int> targets = context.AdvanceMonthRelatedData.CharIdList.Occupy();
				List<int> boostedTargets = context.AdvanceMonthRelatedData.TargetCharIdList.Occupy();
				boostedTargets.Clear();
				targets.Clear();
				foreach (int charId in currBlockChars)
				{
					Character targetChar = DomainManager.Character.GetElement_Objects(charId);
					bool flag2 = !includeBabies && targetChar.GetAgeGroup() == 0;
					if (!flag2)
					{
						RelatedCharacter selfToTarget;
						bool flag3 = !DomainManager.Character.TryGetRelation(this._id, charId, out selfToTarget);
						if (!flag3)
						{
							bool flag4 = condition != null && !condition(targetChar);
							if (!flag4)
							{
								targets.Add(charId);
								boostedTargets.Add(charId);
							}
						}
					}
				}
				bool flag5 = DomainManager.Extra.IsProfessionalSkillUnlockedAndEquipped(28) && boostedTargets.Contains(DomainManager.Taiwu.GetTaiwuCharId());
				if (flag5)
				{
					ProfessionSkillHandle.AristocratSkill_BoostTaiwuAsTargetInCollection(boostedTargets);
					int targetCharId = boostedTargets.GetRandom(context.Random);
					context.AdvanceMonthRelatedData.CharIdList.Release(ref targets);
					context.AdvanceMonthRelatedData.TargetCharIdList.Release(ref boostedTargets);
					result = DomainManager.Character.GetElement_Objects(targetCharId);
				}
				else
				{
					Character selectedChar = (targets.Count == 0) ? null : DomainManager.Character.GetElement_Objects(targets.GetRandom(context.Random));
					context.AdvanceMonthRelatedData.CharIdList.Release(ref targets);
					context.AdvanceMonthRelatedData.TargetCharIdList.Release(ref boostedTargets);
					result = selectedChar;
				}
			}
			return result;
		}

		// Token: 0x06006E16 RID: 28182 RVA: 0x003E5FCC File Offset: 0x003E41CC
		public Character SelectMaxPriorityActionTarget(DataContext context, HashSet<int> currBlockChars, Predicate<Character> condition, bool includeBabies = false)
		{
			bool flag = currBlockChars == null;
			Character result;
			if (flag)
			{
				result = null;
			}
			else
			{
				sbyte currMaxPriorityType = -1;
				int currMaxPriorityScore = 0;
				List<int> maxPriorityTargets = context.AdvanceMonthRelatedData.CharIdList.Occupy();
				List<int> boostedTargets = context.AdvanceMonthRelatedData.TargetCharIdList.Occupy();
				sbyte behaviorType = this.GetBehaviorType();
				foreach (int charId in currBlockChars)
				{
					Character targetChar = DomainManager.Character.GetElement_Objects(charId);
					bool flag2 = !includeBabies && targetChar.GetAgeGroup() == 0;
					if (!flag2)
					{
						RelatedCharacter selfToTarget;
						bool flag3 = !DomainManager.Character.TryGetRelation(this._id, charId, out selfToTarget);
						if (!flag3)
						{
							bool flag4 = condition != null && !condition(targetChar);
							if (!flag4)
							{
								sbyte currPriorityType = AiHelper.ActionTargetType.GetActionTargetType(selfToTarget.RelationType);
								bool flag5 = currPriorityType == -1;
								if (!flag5)
								{
									sbyte currPriorityScore = AiHelper.ActionTargetType.PriorityScores[(int)behaviorType][(int)currPriorityType];
									bool flag6 = currPriorityType == currMaxPriorityType;
									if (flag6)
									{
										maxPriorityTargets.Add(charId);
										boostedTargets.Add(charId);
									}
									else
									{
										bool flag7 = currMaxPriorityScore < (int)currPriorityScore;
										if (flag7)
										{
											currMaxPriorityType = currPriorityType;
											currMaxPriorityScore = (int)currPriorityScore;
											maxPriorityTargets.Clear();
											maxPriorityTargets.Add(charId);
											boostedTargets.Clear();
											boostedTargets.Add(charId);
										}
									}
								}
							}
						}
					}
				}
				bool flag8 = DomainManager.Extra.IsProfessionalSkillUnlockedAndEquipped(28) && boostedTargets.Contains(DomainManager.Taiwu.GetTaiwuCharId());
				if (flag8)
				{
					ProfessionSkillHandle.AristocratSkill_BoostTaiwuAsTargetInCollection(boostedTargets);
					int targetCharId = boostedTargets.GetRandom(context.Random);
					context.AdvanceMonthRelatedData.CharIdList.Release(ref maxPriorityTargets);
					context.AdvanceMonthRelatedData.TargetCharIdList.Release(ref boostedTargets);
					result = DomainManager.Character.GetElement_Objects(targetCharId);
				}
				else
				{
					Character selectedChar = (maxPriorityTargets.Count == 0) ? null : DomainManager.Character.GetElement_Objects(maxPriorityTargets.GetRandom(context.Random));
					context.AdvanceMonthRelatedData.CharIdList.Release(ref maxPriorityTargets);
					context.AdvanceMonthRelatedData.TargetCharIdList.Release(ref boostedTargets);
					result = selectedChar;
				}
			}
			return result;
		}

		// Token: 0x06006E17 RID: 28183 RVA: 0x003E6208 File Offset: 0x003E4408
		[return: TupleElementNames(new string[]
		{
			"charId",
			"actionType"
		})]
		private unsafe ValueTuple<int, sbyte> SelectDemandActionTarget(DataContext context, HashSet<int> currBlockChars, HashSet<int> currBlockGraves, Predicate<Character> characterFilter, Predicate<Grave> graveFilter, sbyte restrictActionType)
		{
			IRandomSource random = context.Random;
			sbyte selfBehaviorType = this.GetBehaviorType();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			bool taiwuCanBeHarmed = DomainManager.Taiwu.CanTaiwuBeSneakyHarmfulActionTarget();
			List<int>[] requestActionTargets = context.AdvanceMonthRelatedData.DemandActionTargets.Occupy();
			sbyte currMaxPriorityType = -1;
			int currMaxPriorityScore = 0;
			short scamRateAdjust = DomainManager.Extra.GetAiActionRateAdjust(this._id, restrictActionType, 2);
			short stealRateAdjust = DomainManager.Extra.GetAiActionRateAdjust(this._id, restrictActionType, 1);
			short robRateAdjust = DomainManager.Extra.GetAiActionRateAdjust(this._id, restrictActionType, 3);
			bool flag = currBlockChars != null;
			if (flag)
			{
				foreach (int charId in currBlockChars)
				{
					Character targetChar = DomainManager.Character.GetElement_Objects(charId);
					bool flag2 = targetChar.GetAgeGroup() == 0;
					if (!flag2)
					{
						RelatedCharacter selfToTarget;
						bool flag3 = !DomainManager.Character.TryGetRelation(this._id, targetChar._id, out selfToTarget);
						if (!flag3)
						{
							bool flag4 = !characterFilter(targetChar);
							if (!flag4)
							{
								sbyte category = AiHelper.ActionTargetRelationCategory.GetTargetRelationCategory(selfToTarget.RelationType);
								bool flag5 = graveFilter != null && random.CheckPercentProb((int)((short)AiHelper.GeneralActionConstants.StartRobbingChance[(int)selfBehaviorType][(int)category] + robRateAdjust));
								if (flag5)
								{
									requestActionTargets[3].Add(charId);
								}
								bool flag6 = charId != taiwuCharId || taiwuCanBeHarmed;
								if (flag6)
								{
									bool flag7 = random.CheckPercentProb((int)((short)AiHelper.GeneralActionConstants.StartScammingChance[(int)selfBehaviorType][(int)category] + scamRateAdjust));
									if (flag7)
									{
										requestActionTargets[2].Add(charId);
									}
									bool flag8 = random.CheckPercentProb((int)((short)AiHelper.GeneralActionConstants.StartStealingChance[(int)selfBehaviorType][(int)category] + stealRateAdjust));
									if (flag8)
									{
										requestActionTargets[1].Add(charId);
									}
								}
								sbyte currPriorityType = AiHelper.ActionTargetType.GetActionTargetType(selfToTarget.RelationType);
								bool flag9 = currPriorityType == -1;
								if (!flag9)
								{
									sbyte currPriorityScore = AiHelper.ActionTargetType.PriorityScores[(int)selfBehaviorType][(int)currPriorityType];
									bool flag10 = currPriorityType == currMaxPriorityType;
									if (flag10)
									{
										requestActionTargets[0].Add(charId);
									}
									else
									{
										bool flag11 = currMaxPriorityScore < (int)currPriorityScore;
										if (flag11)
										{
											currMaxPriorityType = currPriorityType;
											currMaxPriorityScore = (int)currPriorityScore;
											requestActionTargets[0].Clear();
											requestActionTargets[0].Add(charId);
										}
									}
								}
							}
						}
					}
				}
			}
			bool flag12 = graveFilter != null && currBlockGraves != null;
			if (flag12)
			{
				short rateAdjust = DomainManager.Extra.GetAiActionRateAdjust(this._id, restrictActionType, 4);
				foreach (int graveId in currBlockGraves)
				{
					Grave grave = DomainManager.Character.GetElement_Graves(graveId);
					RelatedCharacter selfToTarget2;
					bool flag13 = !DomainManager.Character.TryGetRelation(this._id, graveId, out selfToTarget2);
					if (!flag13)
					{
						bool flag14 = !graveFilter(grave);
						if (!flag14)
						{
							bool flag15 = DomainManager.Character.IsGraveProtected(grave);
							if (!flag15)
							{
								sbyte category2 = AiHelper.ActionTargetRelationCategory.GetTargetRelationCategory(selfToTarget2.RelationType);
								bool flag16 = random.CheckPercentProb((int)((short)AiHelper.GeneralActionConstants.StartRobbingFromGraveChance[(int)selfBehaviorType][(int)category2] + rateAdjust));
								if (flag16)
								{
									requestActionTargets[4].Add(graveId);
								}
							}
						}
					}
				}
			}
			sbyte* targetActionTypeRange = stackalloc sbyte[(UIntPtr)5];
			int selectableActionTypeCount = 0;
			for (sbyte actionType = 0; actionType < 5; actionType += 1)
			{
				bool flag17 = requestActionTargets[(int)actionType].Count <= 0;
				if (!flag17)
				{
					targetActionTypeRange[selectableActionTypeCount] = actionType;
					selectableActionTypeCount++;
				}
			}
			bool flag18 = selectableActionTypeCount <= 0;
			ValueTuple<int, sbyte> result;
			if (flag18)
			{
				context.AdvanceMonthRelatedData.DemandActionTargets.Release(ref requestActionTargets);
				result = new ValueTuple<int, sbyte>(-1, -1);
			}
			else
			{
				sbyte targetActionType = targetActionTypeRange[random.Next(selectableActionTypeCount)];
				bool flag19 = DomainManager.Extra.IsProfessionalSkillUnlockedAndEquipped(28) && requestActionTargets[(int)targetActionType].Contains(DomainManager.Taiwu.GetTaiwuCharId());
				if (flag19)
				{
					List<int> boostedTargets = context.AdvanceMonthRelatedData.TargetCharIdList.Occupy();
					foreach (int charId2 in requestActionTargets[(int)targetActionType])
					{
						boostedTargets.Add(charId2);
					}
					ProfessionSkillHandle.AristocratSkill_BoostTaiwuAsTargetInCollection(boostedTargets);
					int targetCharId = boostedTargets.GetRandom(random);
					context.AdvanceMonthRelatedData.TargetCharIdList.Release(ref boostedTargets);
					context.AdvanceMonthRelatedData.DemandActionTargets.Release(ref requestActionTargets);
					result = new ValueTuple<int, sbyte>(targetCharId, targetActionType);
				}
				else
				{
					int selectedCharId = requestActionTargets[(int)targetActionType].GetRandom(random);
					context.AdvanceMonthRelatedData.DemandActionTargets.Release(ref requestActionTargets);
					result = new ValueTuple<int, sbyte>(selectedCharId, targetActionType);
				}
			}
			return result;
		}

		// Token: 0x06006E18 RID: 28184 RVA: 0x003E66E8 File Offset: 0x003E48E8
		private void GetAllCaringCharsInSet(HashSet<int> charSet, HashSet<int> caringCharIds)
		{
			caringCharIds.Clear();
			foreach (GameData.Domains.Character.Ai.PersonalNeed personalNeed in this._personalNeeds)
			{
				bool flag = personalNeed.TemplateId != 19;
				if (!flag)
				{
					bool flag2 = charSet.Contains(personalNeed.CharId);
					if (flag2)
					{
						caringCharIds.Add(personalNeed.CharId);
					}
				}
			}
		}

		// Token: 0x06006E19 RID: 28185 RVA: 0x003E6770 File Offset: 0x003E4970
		public ItemBase SelectSpareableItem(DataContext context, sbyte targetGrade, bool allowUsed)
		{
			int currBestGrade = 9;
			List<ValueTuple<ItemBase, int>> selectableItems = context.AdvanceMonthRelatedData.ItemsWithAmount.Occupy();
			IReadOnlyDictionary<ItemKey, int> taiwuGiftItems = DomainManager.Extra.GetTaiwuGiftItems(this._id);
			int villagerIdealClothing = (int)((this._organizationInfo.OrgTemplateId == 16) ? this.GetIdealClothingTemplateId() : -1);
			bool hasVillagerRole = villagerIdealClothing >= 0;
			int keepClothingCount = (hasVillagerRole && this._equipment.Exist((ItemKey e) => e.IsValid() && e.ItemType == 3 && (int)e.TemplateId == villagerIdealClothing)) ? 1 : 0;
			foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
			{
				ItemKey itemKey2;
				int num;
				keyValuePair.Deconstruct(out itemKey2, out num);
				ItemKey itemKey = itemKey2;
				int amount = num;
				bool flag = !ItemTemplateHelper.IsTransferable(itemKey.ItemType, itemKey.TemplateId);
				if (!flag)
				{
					bool flag2 = ItemTemplateHelper.GetBaseValue(itemKey.ItemType, itemKey.TemplateId) <= 0;
					if (!flag2)
					{
						int giftAmount;
						bool flag3 = taiwuGiftItems.TryGetValue(itemKey, out giftAmount) && giftAmount >= amount;
						if (!flag3)
						{
							ItemBase baseItem = DomainManager.Item.GetBaseItem(itemKey);
							bool flag4 = !allowUsed && baseItem.GetCurrDurability() < baseItem.GetMaxDurability();
							if (!flag4)
							{
								bool flag5 = this.TryDetectAttachedPoisons(itemKey);
								if (!flag5)
								{
									bool flag6 = itemKey.ItemType == 10;
									if (flag6)
									{
										bool flag7 = baseItem.GetItemSubType() == 1001;
										if (flag7)
										{
											ValueTuple<int, byte> readingInfo = this.GetCombatSkillBookCurrReadingInfo((GameData.Domains.Item.SkillBook)baseItem);
											bool flag8 = readingInfo.Item1 < 0 || readingInfo.Item2 < 6;
											if (flag8)
											{
												continue;
											}
										}
										else
										{
											ValueTuple<int, byte> readingInfo2 = this.GetLifeSkillBookCurrReadingInfo((GameData.Domains.Item.SkillBook)baseItem);
											bool flag9 = readingInfo2.Item1 < 0 || readingInfo2.Item2 < 5;
											if (flag9)
											{
												continue;
											}
										}
									}
									else
									{
										bool flag10 = itemKey.ItemType == 3;
										if (flag10)
										{
											bool flag11 = keepClothingCount > 0;
											if (flag11)
											{
												keepClothingCount--;
												continue;
											}
										}
									}
									bool flag12 = itemKey.ItemType == 12 && itemKey.TemplateId == 225;
									if (!flag12)
									{
										sbyte grade = baseItem.GetGrade();
										bool flag13 = (int)grade == currBestGrade;
										if (flag13)
										{
											selectableItems.Add(new ValueTuple<ItemBase, int>(baseItem, amount));
										}
										else
										{
											bool flag14 = currBestGrade < (int)targetGrade;
											if (flag14)
											{
												bool flag15 = (int)grade < currBestGrade || grade > targetGrade;
												if (!flag15)
												{
													currBestGrade = (int)grade;
													selectableItems.Clear();
													selectableItems.Add(new ValueTuple<ItemBase, int>(baseItem, amount));
												}
											}
											else
											{
												bool flag16 = currBestGrade > (int)targetGrade;
												if (flag16)
												{
													bool flag17 = (int)grade >= currBestGrade;
													if (!flag17)
													{
														currBestGrade = (int)grade;
														selectableItems.Clear();
														selectableItems.Add(new ValueTuple<ItemBase, int>(baseItem, amount));
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			ItemBase selectedItem = (selectableItems.Count == 0) ? null : selectableItems.GetRandom(context.Random).Item1;
			context.AdvanceMonthRelatedData.ItemsWithAmount.Release(ref selectableItems);
			return selectedItem;
		}

		// Token: 0x06006E1A RID: 28186 RVA: 0x003E6AD4 File Offset: 0x003E4CD4
		private bool HasBookToReadForExp()
		{
			foreach (ItemKey itemKey in this._inventory.Items.Keys)
			{
				bool flag = itemKey.ItemType != 10;
				if (!flag)
				{
					GameData.Domains.Item.SkillBook skillBook = DomainManager.Item.GetElement_SkillBooks(itemKey.Id);
					bool flag2 = skillBook.GetCurrDurability() >= skillBook.GetMaxDurability();
					if (!flag2)
					{
						return true;
					}
				}
			}
			return false;
		}

		// Token: 0x06006E1B RID: 28187 RVA: 0x003E6B78 File Offset: 0x003E4D78
		private ItemKey SelectBookToReadForExp(DataContext context)
		{
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> combatSkills = DomainManager.CombatSkill.GetCharCombatSkills(this._id);
			List<ItemKey> books = context.AdvanceMonthRelatedData.ItemKeys.Occupy();
			foreach (ItemKey itemKey in this._inventory.Items.Keys)
			{
				bool flag = itemKey.ItemType != 10;
				if (!flag)
				{
					GameData.Domains.Item.SkillBook skillBook = DomainManager.Item.GetElement_SkillBooks(itemKey.Id);
					bool flag2 = skillBook.GetCurrDurability() >= skillBook.GetMaxDurability();
					if (!flag2)
					{
						bool flag3 = skillBook.IsCombatSkillBook();
						if (flag3)
						{
							GameData.Domains.CombatSkill.CombatSkill combatSkill;
							bool flag4 = combatSkills.TryGetValue(skillBook.GetCombatSkillTemplateId(), out combatSkill) && CombatSkillStateHelper.IsReadNormalPagesMeetConditionOfBreakout(combatSkill.GetReadingState());
							if (flag4)
							{
								books.Add(itemKey);
							}
						}
						else
						{
							int index = this.FindLearnedLifeSkillIndex(skillBook.GetLifeSkillTemplateId());
							bool flag5 = index >= 0 && this._learnedLifeSkills[index].IsAllPagesRead();
							if (flag5)
							{
								books.Add(itemKey);
							}
						}
					}
				}
			}
			ItemKey selectedBook = books.GetRandomOrDefault(context.Random, ItemKey.Invalid);
			context.AdvanceMonthRelatedData.ItemKeys.Release(ref books);
			return selectedBook;
		}

		// Token: 0x06006E1C RID: 28188 RVA: 0x003E6CF0 File Offset: 0x003E4EF0
		[Obsolete("Use SelectSpareableItem instead.")]
		public ItemKey SelectItemToGive(DataContext context, sbyte targetGrade)
		{
			ItemBase itemBase = this.SelectSpareableItem(context, targetGrade, true);
			return (itemBase != null) ? itemBase.GetItemKey() : ItemKey.Invalid;
		}

		// Token: 0x06006E1D RID: 28189 RVA: 0x003E6D1C File Offset: 0x003E4F1C
		public unsafe sbyte GetStealActionPhase(IRandomSource random, Character targetChar, int alertFactor, bool showCheckAnim = false)
		{
			MainAttributes mainAttributes = this.GetMaxMainAttributes();
			HitOrAvoidInts selfHitValues = this.GetHitValues();
			HitOrAvoidInts selfAvoidValues = this.GetAvoidValues();
			CombatSkillShorts selfCombatSkillAttainments = *this.GetCombatSkillAttainments();
			short selfMoveSpeed = this.GetMoveSpeed();
			HitOrAvoidInts targetHitValues = targetChar.GetHitValues();
			HitOrAvoidInts targetAvoidValues = targetChar.GetAvoidValues();
			CombatSkillShorts targetCombatSkillAttainments = *targetChar.GetCombatSkillAttainments();
			short targetMoveSpeed = targetChar.GetMoveSpeed();
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData = new EventInteractCheckData(1)
				{
					SelfMainAttributes = mainAttributes,
					SelfHitValues = selfHitValues,
					SelfAvoidValues = selfAvoidValues,
					SelfCombatSkillAttainments = selfCombatSkillAttainments,
					SelfMoveSpeed = selfMoveSpeed,
					TargetHitValues = targetHitValues,
					TargetAvoidValues = targetAvoidValues,
					TargetCombatSkillAttainments = targetCombatSkillAttainments,
					TargetMoveSpeed = targetMoveSpeed,
					TargetAlertFactor = alertFactor,
					SelfNameRelatedData = DomainManager.Character.GetNameRelatedData(this._id),
					TargetNameRelatedData = DomainManager.Character.GetNameRelatedData(targetChar.GetId())
				};
				DomainManager.TaiwuEvent.ShowInteractCheckAnimation = true;
			}
			int successRate = (int)(*(ref mainAttributes.Items.FixedElementField + 2));
			successRate = this.GetPhaseAdjustedSuccessRate(successRate, 0);
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
			}
			bool flag = !random.CheckPercentProb(successRate);
			sbyte result;
			if (flag)
			{
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 0;
				}
				result = 0;
			}
			else
			{
				successRate = Character.GetPhaseBaseSuccessRate((int)(*(ref selfCombatSkillAttainments.Items.FixedElementField + 2)), (int)(*(ref targetCombatSkillAttainments.Items.FixedElementField + 2)), alertFactor);
				successRate = this.GetPhaseAdjustedSuccessRate(successRate, 1);
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
				}
				bool flag2 = !random.CheckPercentProb(successRate);
				if (flag2)
				{
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 1;
					}
					result = 1;
				}
				else
				{
					successRate = Character.GetPhaseBaseSuccessRate(*(ref selfHitValues.Items.FixedElementField + (IntPtr)2 * 4), *(ref targetAvoidValues.Items.FixedElementField + (IntPtr)2 * 4), alertFactor);
					successRate = this.GetPhaseAdjustedSuccessRate(successRate, 2);
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
					}
					bool flag3 = !random.CheckPercentProb(successRate);
					if (flag3)
					{
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 2;
						}
						result = 2;
					}
					else
					{
						successRate = Character.GetPhaseBaseSuccessRate((int)selfMoveSpeed, (int)targetMoveSpeed, alertFactor) / 3;
						successRate = this.GetPhaseAdjustedSuccessRate(successRate, 3);
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
						}
						bool flag4 = !random.CheckPercentProb(successRate);
						if (flag4)
						{
							if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 3;
							}
							result = 3;
						}
						else
						{
							bool flag5 = !targetChar.NeedToAvoidCombat(CombatType.Beat);
							if (flag5)
							{
								successRate = Character.GetPhaseBaseSuccessRate(*(ref selfAvoidValues.Items.FixedElementField + (IntPtr)2 * 4), *(ref targetHitValues.Items.FixedElementField + (IntPtr)2 * 4), alertFactor);
								successRate = this.GetPhaseAdjustedSuccessRate(successRate, 4);
								if (showCheckAnim)
								{
									DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
								}
								bool flag6 = !random.CheckPercentProb(successRate);
								if (flag6)
								{
									if (showCheckAnim)
									{
										DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 4;
									}
									return 4;
								}
							}
							else if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(100);
							}
							result = 5;
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006E1E RID: 28190 RVA: 0x003E70C0 File Offset: 0x003E52C0
		public unsafe sbyte GetScamActionPhase(IRandomSource random, Character targetChar, int alertFactor, bool showCheckAnim = false)
		{
			MainAttributes mainAttributes = this.GetMaxMainAttributes();
			HitOrAvoidInts selfHitValues = this.GetHitValues();
			HitOrAvoidInts selfAvoidValues = this.GetAvoidValues();
			CombatSkillShorts selfCombatSkillAttainments = *this.GetCombatSkillAttainments();
			short selfMaxLifeSkillAttainment = this.GetLifeSkillAttainments().GetMaxLifeSkillValue();
			HitOrAvoidInts targetHitValues = targetChar.GetHitValues();
			HitOrAvoidInts targetAvoidValues = targetChar.GetAvoidValues();
			CombatSkillShorts targetCombatSkillAttainments = *targetChar.GetCombatSkillAttainments();
			short targetMaxLifeSkillAttainment = targetChar.GetLifeSkillAttainments().GetMaxLifeSkillValue();
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData = new EventInteractCheckData(0)
				{
					SelfMainAttributes = mainAttributes,
					SelfHitValues = selfHitValues,
					SelfAvoidValues = selfAvoidValues,
					SelfCombatSkillAttainments = selfCombatSkillAttainments,
					TargetHitValues = targetHitValues,
					TargetAvoidValues = targetAvoidValues,
					TargetCombatSkillAttainments = targetCombatSkillAttainments,
					TargetAlertFactor = alertFactor,
					SelfNameRelatedData = DomainManager.Character.GetNameRelatedData(this._id),
					TargetNameRelatedData = DomainManager.Character.GetNameRelatedData(targetChar.GetId())
				};
				DomainManager.TaiwuEvent.ShowInteractCheckAnimation = true;
			}
			int successRate = (int)(*(ref mainAttributes.Items.FixedElementField + (IntPtr)2 * 2));
			successRate = this.GetPhaseAdjustedSuccessRate(successRate, 0);
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
			}
			bool flag = !random.CheckPercentProb(successRate);
			sbyte result;
			if (flag)
			{
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 0;
				}
				result = 0;
			}
			else
			{
				successRate = Character.GetPhaseBaseSuccessRate((int)(*(ref selfCombatSkillAttainments.Items.FixedElementField + 2)), (int)(*(ref targetCombatSkillAttainments.Items.FixedElementField + 2)), alertFactor);
				successRate = this.GetPhaseAdjustedSuccessRate(successRate, 1);
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
				}
				bool flag2 = !random.CheckPercentProb(successRate);
				if (flag2)
				{
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 1;
					}
					result = 1;
				}
				else
				{
					successRate = Character.GetPhaseBaseSuccessRate(*(ref selfHitValues.Items.FixedElementField + (IntPtr)3 * 4), *(ref targetAvoidValues.Items.FixedElementField + (IntPtr)3 * 4), alertFactor);
					successRate = this.GetPhaseAdjustedSuccessRate(successRate, 2);
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
					}
					bool flag3 = !random.CheckPercentProb(successRate);
					if (flag3)
					{
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 2;
						}
						result = 2;
					}
					else
					{
						successRate = Character.GetPhaseBaseSuccessRate((int)selfMaxLifeSkillAttainment, (int)targetMaxLifeSkillAttainment, alertFactor) / 3;
						successRate = this.GetPhaseAdjustedSuccessRate(successRate, 3);
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
						}
						bool flag4 = !showCheckAnim;
						if (flag4)
						{
							bool flag5 = !random.CheckPercentProb(successRate);
							if (flag5)
							{
								return 3;
							}
						}
						bool flag6 = !targetChar.NeedToAvoidCombat(CombatType.Beat);
						if (flag6)
						{
							successRate = Character.GetPhaseBaseSuccessRate(*(ref selfAvoidValues.Items.FixedElementField + (IntPtr)3 * 4), *(ref targetHitValues.Items.FixedElementField + (IntPtr)3 * 4), alertFactor);
							successRate = this.GetPhaseAdjustedSuccessRate(successRate, 4);
							if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
							}
							bool flag7 = !random.CheckPercentProb(successRate);
							if (flag7)
							{
								if (showCheckAnim)
								{
									DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 4;
								}
								return 4;
							}
						}
						else if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(100);
						}
						result = 5;
					}
				}
			}
			return result;
		}

		// Token: 0x06006E1F RID: 28191 RVA: 0x003E7454 File Offset: 0x003E5654
		public unsafe sbyte GetRobActionPhase(IRandomSource random, Character targetChar, int alertFactor, bool showCheckAnim = false)
		{
			MainAttributes mainAttributes = this.GetMaxMainAttributes();
			HitOrAvoidInts selfHitValues = this.GetHitValues();
			HitOrAvoidInts selfAvoidValues = this.GetAvoidValues();
			CombatSkillShorts selfCombatSkillAttainments = *this.GetCombatSkillAttainments();
			int selfCombatPower = this.GetCombatPower();
			HitOrAvoidInts targetHitValues = targetChar.GetHitValues();
			HitOrAvoidInts targetAvoidValues = targetChar.GetAvoidValues();
			CombatSkillShorts targetCombatSkillAttainments = *targetChar.GetCombatSkillAttainments();
			int targetCombatPower = targetChar.GetCombatPower();
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData = new EventInteractCheckData(2)
				{
					SelfMainAttributes = mainAttributes,
					SelfHitValues = selfHitValues,
					SelfAvoidValues = selfAvoidValues,
					SelfCombatSkillAttainments = selfCombatSkillAttainments,
					TargetHitValues = targetHitValues,
					TargetAvoidValues = targetAvoidValues,
					TargetCombatSkillAttainments = targetCombatSkillAttainments,
					CombatPowerHigher = (selfCombatPower > targetCombatPower),
					TargetAlertFactor = alertFactor,
					SelfNameRelatedData = DomainManager.Character.GetNameRelatedData(this._id),
					TargetNameRelatedData = DomainManager.Character.GetNameRelatedData(targetChar.GetId())
				};
				DomainManager.TaiwuEvent.ShowInteractCheckAnimation = true;
			}
			int successRate = (int)mainAttributes.Items.FixedElementField;
			successRate = this.GetPhaseAdjustedSuccessRate(successRate, 0);
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
			}
			bool flag = !random.CheckPercentProb(successRate);
			sbyte result;
			if (flag)
			{
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 0;
				}
				result = 0;
			}
			else
			{
				successRate = Character.GetPhaseBaseSuccessRate((int)(*(ref selfCombatSkillAttainments.Items.FixedElementField + 2)), (int)(*(ref targetCombatSkillAttainments.Items.FixedElementField + 2)), alertFactor);
				successRate = this.GetPhaseAdjustedSuccessRate(successRate, 1);
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
				}
				bool flag2 = !random.CheckPercentProb(successRate);
				if (flag2)
				{
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 1;
					}
					result = 1;
				}
				else
				{
					successRate = Character.GetPhaseBaseSuccessRate(selfHitValues.Items.FixedElementField, targetAvoidValues.Items.FixedElementField, alertFactor);
					successRate = this.GetPhaseAdjustedSuccessRate(successRate, 2);
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
					}
					bool flag3 = !random.CheckPercentProb(successRate);
					if (flag3)
					{
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 2;
						}
						result = 2;
					}
					else
					{
						successRate = Character.GetPhaseBaseSuccessRate(selfCombatPower, targetCombatPower, alertFactor) / 3;
						successRate = this.GetPhaseAdjustedSuccessRate(successRate, 3);
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
						}
						bool flag4 = !random.CheckPercentProb(successRate);
						if (flag4)
						{
							if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 3;
							}
							result = 3;
						}
						else
						{
							bool flag5 = !targetChar.NeedToAvoidCombat(CombatType.Beat);
							if (flag5)
							{
								successRate = Character.GetPhaseBaseSuccessRate(selfAvoidValues.Items.FixedElementField, targetHitValues.Items.FixedElementField, alertFactor);
								successRate = this.GetPhaseAdjustedSuccessRate(successRate, 4);
								if (showCheckAnim)
								{
									DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
								}
								bool flag6 = !random.CheckPercentProb(successRate);
								if (flag6)
								{
									if (showCheckAnim)
									{
										DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 4;
									}
									return 4;
								}
							}
							else if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(100);
							}
							result = 5;
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006E20 RID: 28192 RVA: 0x003E77DC File Offset: 0x003E59DC
		public unsafe sbyte GetStealLifeSkillActionPhase(IRandomSource random, Character targetChar, sbyte lifeSkillType, sbyte grade, bool showCheckAnim = false)
		{
			MainAttributes mainAttributes = this.GetMaxMainAttributes();
			HitOrAvoidInts selfHitValues = this.GetHitValues();
			HitOrAvoidInts selfAvoidValues = this.GetAvoidValues();
			CombatSkillShorts selfCombatSkillAttainments = *this.GetCombatSkillAttainments();
			LifeSkillShorts selfLifeSkillQualifications = *this.GetLifeSkillQualifications();
			HitOrAvoidInts targetHitValues = targetChar.GetHitValues();
			HitOrAvoidInts targetAvoidValues = targetChar.GetAvoidValues();
			CombatSkillShorts targetCombatSkillAttainments = *targetChar.GetCombatSkillAttainments();
			short qualificationReq = SkillGradeData.Instance[grade].PracticeQualificationRequirement;
			int alertFactor = targetChar.GetGradeAlertFactor(grade, 1);
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData = new EventInteractCheckData(6)
				{
					SelfMainAttributes = mainAttributes,
					SelfHitValues = selfHitValues,
					SelfAvoidValues = selfAvoidValues,
					SelfCombatSkillAttainments = selfCombatSkillAttainments,
					SelfLifeSkillQualities = selfLifeSkillQualifications,
					TargetHitValues = targetHitValues,
					TargetAvoidValues = targetAvoidValues,
					TargetCombatSkillAttainments = targetCombatSkillAttainments,
					StealSkillGrade = grade,
					StealLifeSkillType = lifeSkillType,
					TargetAlertFactor = alertFactor,
					SelfNameRelatedData = DomainManager.Character.GetNameRelatedData(this._id),
					TargetNameRelatedData = DomainManager.Character.GetNameRelatedData(targetChar.GetId())
				};
				DomainManager.TaiwuEvent.ShowInteractCheckAnimation = true;
			}
			int successRate = (int)(*(ref mainAttributes.Items.FixedElementField + (IntPtr)5 * 2));
			successRate = this.GetPhaseAdjustedSuccessRate(successRate, 0);
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
			}
			bool flag = !random.CheckPercentProb(successRate);
			sbyte result;
			if (flag)
			{
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 0;
				}
				result = 0;
			}
			else
			{
				successRate = Character.GetPhaseBaseSuccessRate((int)(*(ref selfCombatSkillAttainments.Items.FixedElementField + 2)), (int)(*(ref targetCombatSkillAttainments.Items.FixedElementField + 2)), alertFactor);
				successRate = this.GetPhaseAdjustedSuccessRate(successRate, 1);
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
				}
				bool flag2 = !random.CheckPercentProb(successRate);
				if (flag2)
				{
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 1;
					}
					result = 1;
				}
				else
				{
					successRate = Character.GetPhaseBaseSuccessRate(*(ref selfHitValues.Items.FixedElementField + 4), *(ref targetAvoidValues.Items.FixedElementField + 4), alertFactor);
					successRate = this.GetPhaseAdjustedSuccessRate(successRate, 2);
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
					}
					bool flag3 = !random.CheckPercentProb(successRate);
					if (flag3)
					{
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 2;
						}
						result = 2;
					}
					else
					{
						successRate = Character.GetPhaseBaseSuccessRate((int)(*(ref selfLifeSkillQualifications.Items.FixedElementField + (IntPtr)lifeSkillType * 2)), (int)qualificationReq, alertFactor) / 3;
						successRate = this.GetPhaseAdjustedSuccessRate(successRate, 3);
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
						}
						bool flag4 = !random.CheckPercentProb(successRate);
						if (flag4)
						{
							if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 3;
							}
							result = 3;
						}
						else
						{
							bool flag5 = !targetChar.NeedToAvoidCombat(CombatType.Beat);
							if (flag5)
							{
								successRate = Character.GetPhaseBaseSuccessRate(*(ref selfAvoidValues.Items.FixedElementField + 4), *(ref targetHitValues.Items.FixedElementField + 4), alertFactor);
								successRate = this.GetPhaseAdjustedSuccessRate(successRate, 4);
								if (showCheckAnim)
								{
									DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
								}
								bool flag6 = !random.CheckPercentProb(successRate);
								if (flag6)
								{
									if (showCheckAnim)
									{
										DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 4;
									}
									return 4;
								}
							}
							else if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(100);
							}
							result = 5;
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006E21 RID: 28193 RVA: 0x003E7BAC File Offset: 0x003E5DAC
		public unsafe sbyte GetStealCombatSkillActionPhase(IRandomSource random, Character targetChar, sbyte combatSkillType, sbyte grade, bool showCheckAnim = false)
		{
			MainAttributes mainAttributes = this.GetMaxMainAttributes();
			HitOrAvoidInts selfHitValues = this.GetHitValues();
			HitOrAvoidInts selfAvoidValues = this.GetAvoidValues();
			CombatSkillShorts selfCombatSkillAttainments = *this.GetCombatSkillAttainments();
			CombatSkillShorts selfCombatSkillQualifications = *this.GetCombatSkillQualifications();
			HitOrAvoidInts targetHitValues = targetChar.GetHitValues();
			HitOrAvoidInts targetAvoidValues = targetChar.GetAvoidValues();
			CombatSkillShorts targetCombatSkillAttainments = *targetChar.GetCombatSkillAttainments();
			short qualificationReq = SkillGradeData.Instance[grade].PracticeQualificationRequirement;
			int alertFactor = targetChar.GetGradeAlertFactor(grade, 1);
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData = new EventInteractCheckData(7)
				{
					SelfMainAttributes = mainAttributes,
					SelfHitValues = selfHitValues,
					SelfAvoidValues = selfAvoidValues,
					SelfCombatSkillAttainments = selfCombatSkillAttainments,
					SelfCombatSkillQualities = selfCombatSkillQualifications,
					TargetHitValues = targetHitValues,
					TargetAvoidValues = targetAvoidValues,
					TargetCombatSkillAttainments = targetCombatSkillAttainments,
					StealSkillGrade = grade,
					StealCombatSkillType = combatSkillType,
					TargetAlertFactor = alertFactor,
					SelfNameRelatedData = DomainManager.Character.GetNameRelatedData(this._id),
					TargetNameRelatedData = DomainManager.Character.GetNameRelatedData(targetChar.GetId())
				};
				DomainManager.TaiwuEvent.ShowInteractCheckAnimation = true;
			}
			int successRate = (int)(*(ref mainAttributes.Items.FixedElementField + (IntPtr)5 * 2));
			successRate = this.GetPhaseAdjustedSuccessRate(successRate, 0);
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
			}
			bool flag = !random.CheckPercentProb(successRate);
			sbyte result;
			if (flag)
			{
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 0;
				}
				result = 0;
			}
			else
			{
				successRate = Character.GetPhaseBaseSuccessRate((int)(*(ref selfCombatSkillAttainments.Items.FixedElementField + 2)), (int)(*(ref targetCombatSkillAttainments.Items.FixedElementField + 2)), alertFactor);
				successRate = this.GetPhaseAdjustedSuccessRate(successRate, 1);
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
				}
				bool flag2 = !random.CheckPercentProb(successRate);
				if (flag2)
				{
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 1;
					}
					result = 1;
				}
				else
				{
					successRate = Character.GetPhaseBaseSuccessRate(*(ref selfHitValues.Items.FixedElementField + 4), *(ref targetAvoidValues.Items.FixedElementField + 4), alertFactor);
					successRate = this.GetPhaseAdjustedSuccessRate(successRate, 2);
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
					}
					bool flag3 = !random.CheckPercentProb(successRate);
					if (flag3)
					{
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 2;
						}
						result = 2;
					}
					else
					{
						successRate = Character.GetPhaseBaseSuccessRate((int)(*(ref selfCombatSkillQualifications.Items.FixedElementField + (IntPtr)combatSkillType * 2)), (int)qualificationReq, alertFactor) / 3;
						successRate = this.GetPhaseAdjustedSuccessRate(successRate, 3);
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
						}
						bool flag4 = !random.CheckPercentProb(successRate);
						if (flag4)
						{
							if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 3;
							}
							result = 3;
						}
						else
						{
							bool flag5 = !targetChar.NeedToAvoidCombat(CombatType.Beat);
							if (flag5)
							{
								successRate = Character.GetPhaseBaseSuccessRate(*(ref selfAvoidValues.Items.FixedElementField + 4), *(ref targetHitValues.Items.FixedElementField + 4), alertFactor);
								successRate = this.GetPhaseAdjustedSuccessRate(successRate, 4);
								if (showCheckAnim)
								{
									DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
								}
								bool flag6 = !random.CheckPercentProb(successRate);
								if (flag6)
								{
									if (showCheckAnim)
									{
										DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 4;
									}
									return 4;
								}
							}
							else if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(100);
							}
							result = 5;
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006E22 RID: 28194 RVA: 0x003E7F7C File Offset: 0x003E617C
		public unsafe sbyte GetPoisonActionPhase(IRandomSource random, Character targetChar, int alertFactor = 100, bool showCheckAnim = false)
		{
			CombatSkillShorts selfCombatSkillAttainments = *this.GetCombatSkillAttainments();
			LifeSkillShorts selfLifeSkillAttainments = *this.GetLifeSkillAttainments();
			OuterAndInnerInts selfPenetrations = this.GetPenetrations();
			OuterAndInnerInts selfPenetrationResists = this.GetPenetrationResists();
			short selfCastSpeed = this.GetCastSpeed();
			CombatSkillShorts targetCombatSkillAttainments = *targetChar.GetCombatSkillAttainments();
			LifeSkillShorts targetLifeSkillAttainments = *targetChar.GetLifeSkillAttainments();
			OuterAndInnerInts targetPenetrations = targetChar.GetPenetrations();
			OuterAndInnerInts targetPenetrationResists = targetChar.GetPenetrationResists();
			short targetCastSpeed = targetChar.GetCastSpeed();
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData = new EventInteractCheckData(3)
				{
					SelfCombatSkillAttainments = selfCombatSkillAttainments,
					SelfLifeSkillAttainments = selfLifeSkillAttainments,
					SelfPenetrations = selfPenetrations,
					SelfPenetrationResists = selfPenetrationResists,
					SelfCastSpeed = selfCastSpeed,
					TargetCombatSkillAttainments = targetCombatSkillAttainments,
					TargetLifeSkillAttainments = targetLifeSkillAttainments,
					TargetPenetrations = targetPenetrations,
					TargetPenetrationResists = targetPenetrationResists,
					TargetCastSpeed = targetCastSpeed,
					TargetAlertFactor = alertFactor,
					SelfNameRelatedData = DomainManager.Character.GetNameRelatedData(this._id),
					TargetNameRelatedData = DomainManager.Character.GetNameRelatedData(targetChar.GetId())
				};
				DomainManager.TaiwuEvent.ShowInteractCheckAnimation = true;
			}
			int successRate = Character.GetPhaseBaseSuccessRate((int)(*(ref selfLifeSkillAttainments.Items.FixedElementField + (IntPtr)9 * 2)), (int)(*(ref targetLifeSkillAttainments.Items.FixedElementField + (IntPtr)9 * 2)), alertFactor);
			successRate = this.GetPhaseAdjustedSuccessRate(successRate, 0);
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
			}
			bool flag = !random.CheckPercentProb(successRate);
			sbyte result;
			if (flag)
			{
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 0;
				}
				result = 0;
			}
			else
			{
				successRate = Character.GetPhaseBaseSuccessRate((int)(*(ref selfCombatSkillAttainments.Items.FixedElementField + 2)), (int)(*(ref targetCombatSkillAttainments.Items.FixedElementField + 2)), alertFactor);
				successRate = this.GetPhaseAdjustedSuccessRate(successRate, 1);
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
				}
				bool flag2 = !random.CheckPercentProb(successRate);
				if (flag2)
				{
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 1;
					}
					result = 1;
				}
				else
				{
					successRate = Character.GetPhaseBaseSuccessRate(selfPenetrations.Inner, targetPenetrationResists.Inner, alertFactor);
					successRate = this.GetPhaseAdjustedSuccessRate(successRate, 2);
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
					}
					bool flag3 = !random.CheckPercentProb(successRate);
					if (flag3)
					{
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 2;
						}
						result = 2;
					}
					else
					{
						successRate = Character.GetPhaseBaseSuccessRate((int)selfCastSpeed, (int)targetCastSpeed, alertFactor) / 3;
						successRate = this.GetPhaseAdjustedSuccessRate(successRate, 3);
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
						}
						bool flag4 = !random.CheckPercentProb(successRate);
						if (flag4)
						{
							if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 3;
							}
							result = 3;
						}
						else
						{
							bool flag5 = !targetChar.NeedToAvoidCombat(CombatType.Beat);
							if (flag5)
							{
								successRate = Character.GetPhaseBaseSuccessRate(selfPenetrationResists.Inner, targetPenetrations.Inner, alertFactor);
								successRate = this.GetPhaseAdjustedSuccessRate(successRate, 4);
								if (showCheckAnim)
								{
									DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
								}
								bool flag6 = !random.CheckPercentProb(successRate);
								if (flag6)
								{
									if (showCheckAnim)
									{
										DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 4;
									}
									return 4;
								}
							}
							else if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(100);
							}
							result = 5;
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006E23 RID: 28195 RVA: 0x003E8324 File Offset: 0x003E6524
		public unsafe sbyte GetPlotHarmActionPhase(IRandomSource random, Character targetChar, int alertFactor = 100, bool showCheckAnim = false)
		{
			CombatSkillShorts selfCombatSkillAttainments = *this.GetCombatSkillAttainments();
			LifeSkillShorts selfLifeSkillAttainments = *this.GetLifeSkillAttainments();
			OuterAndInnerInts selfPenetrations = this.GetPenetrations();
			OuterAndInnerInts selfPenetrationResists = this.GetPenetrationResists();
			short selfAttackSpeed = this.GetAttackSpeed();
			CombatSkillShorts targetCombatSkillAttainments = *targetChar.GetCombatSkillAttainments();
			LifeSkillShorts targetLifeSkillAttainments = *targetChar.GetLifeSkillAttainments();
			OuterAndInnerInts targetPenetrations = targetChar.GetPenetrations();
			OuterAndInnerInts targetPenetrationResists = targetChar.GetPenetrationResists();
			short targetAttackSpeed = targetChar.GetAttackSpeed();
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData = new EventInteractCheckData(4)
				{
					SelfCombatSkillAttainments = selfCombatSkillAttainments,
					SelfLifeSkillAttainments = selfLifeSkillAttainments,
					SelfPenetrations = selfPenetrations,
					SelfPenetrationResists = selfPenetrationResists,
					SelfAttackSpeed = selfAttackSpeed,
					TargetCombatSkillAttainments = targetCombatSkillAttainments,
					TargetLifeSkillAttainments = targetLifeSkillAttainments,
					TargetPenetrations = targetPenetrations,
					TargetPenetrationResists = targetPenetrationResists,
					TargetAttackSpeed = targetAttackSpeed,
					TargetAlertFactor = alertFactor,
					SelfNameRelatedData = DomainManager.Character.GetNameRelatedData(this._id),
					TargetNameRelatedData = DomainManager.Character.GetNameRelatedData(targetChar.GetId())
				};
				DomainManager.TaiwuEvent.ShowInteractCheckAnimation = true;
			}
			int successRate = Character.GetPhaseBaseSuccessRate((int)(*(ref selfLifeSkillAttainments.Items.FixedElementField + (IntPtr)8 * 2)), (int)(*(ref targetLifeSkillAttainments.Items.FixedElementField + (IntPtr)8 * 2)), alertFactor);
			successRate = this.GetPhaseAdjustedSuccessRate(successRate, 0);
			if (showCheckAnim)
			{
				DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
			}
			bool flag = !random.CheckPercentProb(successRate);
			sbyte result;
			if (flag)
			{
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 0;
				}
				result = 0;
			}
			else
			{
				successRate = Character.GetPhaseBaseSuccessRate((int)(*(ref selfCombatSkillAttainments.Items.FixedElementField + 2)), (int)(*(ref targetCombatSkillAttainments.Items.FixedElementField + 2)), alertFactor);
				successRate = this.GetPhaseAdjustedSuccessRate(successRate, 1);
				if (showCheckAnim)
				{
					DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
				}
				bool flag2 = !random.CheckPercentProb(successRate);
				if (flag2)
				{
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 1;
					}
					result = 1;
				}
				else
				{
					successRate = Character.GetPhaseBaseSuccessRate(selfPenetrations.Outer, targetPenetrationResists.Outer, alertFactor);
					successRate = this.GetPhaseAdjustedSuccessRate(successRate, 2);
					if (showCheckAnim)
					{
						DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
					}
					bool flag3 = !random.CheckPercentProb(successRate);
					if (flag3)
					{
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 2;
						}
						result = 2;
					}
					else
					{
						successRate = Character.GetPhaseBaseSuccessRate((int)selfAttackSpeed, (int)targetAttackSpeed, alertFactor) / 3;
						successRate = this.GetPhaseAdjustedSuccessRate(successRate, 3);
						if (showCheckAnim)
						{
							DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
						}
						bool flag4 = !random.CheckPercentProb(successRate);
						if (flag4)
						{
							if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 3;
							}
							result = 3;
						}
						else
						{
							bool flag5 = !targetChar.NeedToAvoidCombat(CombatType.Beat);
							if (flag5)
							{
								successRate = Character.GetPhaseBaseSuccessRate(selfPenetrationResists.Outer, targetPenetrations.Outer, alertFactor);
								successRate = this.GetPhaseAdjustedSuccessRate(successRate, 4);
								if (showCheckAnim)
								{
									DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(successRate);
								}
								bool flag6 = !random.CheckPercentProb(successRate);
								if (flag6)
								{
									if (showCheckAnim)
									{
										DomainManager.TaiwuEvent.InteractCheckData.FailPhase = 4;
									}
									return 4;
								}
							}
							else if (showCheckAnim)
							{
								DomainManager.TaiwuEvent.InteractCheckData.PhaseProbList.Add(100);
							}
							result = 5;
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006E24 RID: 28196 RVA: 0x003E86CC File Offset: 0x003E68CC
		private static int GetPhaseBaseSuccessRate(int selfVal, int targetVal, int targetAlertFactor)
		{
			return Math.Max(selfVal, 1) * (int)GlobalConfig.Instance.HarmfulActionPhaseBaseSuccessRate / Math.Max(targetVal * targetAlertFactor / 100, 1);
		}

		// Token: 0x06006E25 RID: 28197 RVA: 0x003E8700 File Offset: 0x003E6900
		private unsafe int GetPhaseAdjustedSuccessRate(int baseSuccessRate, sbyte harmfulActionPhase)
		{
			sbyte personalityFactor = *(ref this.GetPersonalities().Items.FixedElementField + HarmfulActionPhase.ToPersonalityType[(int)harmfulActionPhase]);
			return baseSuccessRate * (int)(GlobalConfig.Instance.HarmfulActionSuccessGlobalFactor + (short)personalityFactor) / 100;
		}

		// Token: 0x06006E26 RID: 28198 RVA: 0x003E8740 File Offset: 0x003E6940
		public Character GetGuardForCalculation(IRandomSource random)
		{
			bool flag = this._organizationInfo.SettlementId >= 0 && Organization.Instance[this._organizationInfo.OrgTemplateId].IsCivilian && DomainManager.Character.HasGuard(this._id, this);
			Character result;
			if (flag)
			{
				sbyte targetFameType = this.GetFameType();
				bool isHeretic = (targetFameType == -2) ? random.NextBool() : (targetFameType < 3);
				Location settlementLocation = DomainManager.Organization.GetSettlement(this._organizationInfo.SettlementId).GetLocation();
				sbyte stateTemplateId = DomainManager.Map.GetStateTemplateIdByAreaId(settlementLocation.AreaId);
				result = DomainManager.Character.GetPregeneratedCityTownGuard(stateTemplateId, isHeretic, this._organizationInfo.Grade);
			}
			else
			{
				result = this;
			}
			return result;
		}

		// Token: 0x06006E27 RID: 28199 RVA: 0x003E87FC File Offset: 0x003E69FC
		public int GetItemAlertFactor(ItemKey itemKey, int amount)
		{
			sbyte grade = ItemTemplateHelper.GetGrade(itemKey.ItemType, itemKey.TemplateId);
			return this.GetGradeAlertFactor(grade, amount);
		}

		// Token: 0x06006E28 RID: 28200 RVA: 0x003E8828 File Offset: 0x003E6A28
		public unsafe int GetResourceAlertFactor(sbyte resourceType)
		{
			sbyte grade = ResourceTypeHelper.ResourceAmountToGrade(resourceType, *this._resources[(int)resourceType]);
			bool flag = grade < 0;
			if (flag)
			{
				grade = 0;
			}
			return this.GetGradeAlertFactor(grade, 1);
		}

		// Token: 0x06006E29 RID: 28201 RVA: 0x003E8860 File Offset: 0x003E6A60
		public int GetGradeAlertFactor(sbyte grade, int amount)
		{
			sbyte gradeAlertness = GlobalConfig.Instance.CharacterGradeAlertness[(int)this._organizationInfo.Grade];
			return Math.Clamp(100 + (int)(grade - gradeAlertness) * amount * 100, 100, 300);
		}

		// Token: 0x06006E2A RID: 28202 RVA: 0x003E88A0 File Offset: 0x003E6AA0
		public void PeriAdvanceMonth_MixedPoisonEffect(DataContext context)
		{
			List<ValueTuple<sbyte, int>> mixedPoisonInfoList = null;
			foreach (MixPoisonEffectItem mixedPoisonEffect in ((IEnumerable<MixPoisonEffectItem>)MixPoisonEffect.Instance))
			{
				sbyte mixedPoisonType = MixedPoisonType.FromMedicineTemplateId(mixedPoisonEffect.MedicineId);
				int markCount = this.GetMixedPoisonTypeRelatedMarkCount(mixedPoisonType);
				bool flag = markCount <= 0;
				if (!flag)
				{
					bool flag2 = mixedPoisonType == 22 && (!this._location.IsValid() || this._kidnapperId >= 0);
					if (!flag2)
					{
						if (mixedPoisonInfoList == null)
						{
							mixedPoisonInfoList = new List<ValueTuple<sbyte, int>>();
						}
						mixedPoisonInfoList.Add(new ValueTuple<sbyte, int>(mixedPoisonType, markCount));
					}
				}
			}
			bool flag3 = mixedPoisonInfoList != null;
			if (flag3)
			{
				ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
				recorder.RecordType(ParallelModificationType.PeriAdvanceMonthMixedPoisonEffect);
				recorder.RecordParameterClass<Character>(this);
				recorder.RecordParameterClass<List<ValueTuple<sbyte, int>>>(mixedPoisonInfoList);
			}
		}

		// Token: 0x06006E2B RID: 28203 RVA: 0x003E8984 File Offset: 0x003E6B84
		public static void ComplementPeriAdvanceMonth_MixedPoisonEffect(DataContext context, Character character, [TupleElementNames(new string[]
		{
			"mixedPoisonType",
			"markCount"
		})] List<ValueTuple<sbyte, int>> mixedPoisonInfoList)
		{
			bool flag = !DomainManager.Character.IsCharacterAlive(character._id);
			if (!flag)
			{
				Character taiwu = DomainManager.Taiwu.GetTaiwu();
				MonthlyNotificationCollection monthlyNotifications = DomainManager.World.GetMonthlyNotificationCollection();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				int currDate = DomainManager.World.GetCurrDate();
				foreach (ValueTuple<sbyte, int> valueTuple in mixedPoisonInfoList)
				{
					sbyte mixedPoisonType = valueTuple.Item1;
					int markCount = valueTuple.Item2;
					switch (mixedPoisonType)
					{
					case 15:
						character.ChangeHealth(context, -markCount * 12);
						lifeRecordCollection.AddMixPoisonHotRedRotten(character._id, currDate, character._location);
						break;
					case 17:
					{
						List<ValueTuple<ItemBase, int>> lostItems = context.AdvanceMonthRelatedData.ItemsWithAmount.Occupy();
						CharacterDomain.GetLostItemsByAmount(context, markCount, character._inventory.Items, lostItems, character._id == taiwu._id);
						Location location = character.GetValidLocation();
						List<MapBlockData> nearbyBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
						DomainManager.Map.GetRealNeighborBlocks(location.AreaId, location.BlockId, nearbyBlocks, 2, true);
						bool flag2 = character._id == taiwu._id;
						if (flag2)
						{
							foreach (ValueTuple<ItemBase, int> valueTuple2 in lostItems)
							{
								ItemBase item = valueTuple2.Item1;
								monthlyNotifications.AddPoisonMakeLoss(taiwu._id, location, item.GetItemType(), item.GetTemplateId());
							}
						}
						int deltaHappiness = 0;
						foreach (ValueTuple<ItemBase, int> valueTuple3 in lostItems)
						{
							ItemBase item2 = valueTuple3.Item1;
							int amount = valueTuple3.Item2;
							ItemKey itemKey = item2.GetItemKey();
							character.RemoveInventoryItem(context, itemKey, amount, false, false);
							lifeRecordCollection.AddMixPoisonHotRottenGloomy(character._id, currDate, location, itemKey.ItemType, itemKey.TemplateId);
							MapBlockData block = nearbyBlocks.GetRandom(context.Random);
							DomainManager.Map.AddBlockItem(context, block, itemKey, amount);
							deltaHappiness -= (int)item2.GetHappinessChange() * amount;
						}
						context.AdvanceMonthRelatedData.ItemsWithAmount.Release(ref lostItems);
						ObjectPool<List<MapBlockData>>.Instance.Return(nearbyBlocks);
						character.ChangeHappiness(context, deltaHappiness);
						break;
					}
					case 21:
					{
						Location location2 = character._location;
						bool flag3 = !location2.IsValid();
						if (flag3)
						{
							location2 = character.GetValidLocation();
						}
						MapBlockData currBlockData = DomainManager.Map.GetBlock(location2);
						bool flag4 = currBlockData.CharacterSet != null;
						if (flag4)
						{
							foreach (int charId in currBlockData.CharacterSet)
							{
								bool flag5 = charId == character._id;
								if (!flag5)
								{
									Character targetChar = DomainManager.Character.GetElement_Objects(charId);
									targetChar.ChangePoisoned(context, 4, 3, 100 + markCount * 20);
								}
							}
						}
						bool flag6 = location2.Equals(taiwu._location);
						if (flag6)
						{
							HashSet<int> taiwuGroup = DomainManager.Taiwu.GetGroupCharIds().GetCollection();
							foreach (int charId2 in taiwuGroup)
							{
								bool flag7 = charId2 == character._id;
								if (!flag7)
								{
									Character targetChar2 = DomainManager.Character.GetElement_Objects(charId2);
									targetChar2.ChangePoisoned(context, 4, 3, 100 + markCount * 20);
								}
							}
						}
						bool flag8 = character._id == taiwu._id;
						if (flag8)
						{
							monthlyNotifications.AddRottenPoisonDiffuse(character._id, location2);
						}
						lifeRecordCollection.AddMixPoisonRedRottenCold(character._id, currDate, location2);
						break;
					}
					case 22:
					{
						bool flag9 = character.GetAgeGroup() == 0;
						if (!flag9)
						{
							List<int> charIdList = context.AdvanceMonthRelatedData.CharIdList.Occupy();
							character.GetPotentialHarmfulActionTargets(charIdList);
							lifeRecordCollection.AddMixPoisonHotRedIllusory(character._id, currDate, character._location);
							character.ActivateAdvanceMonthStatus(7);
							int i = 0;
							while (i < markCount)
							{
								Character targetChar3;
								for (;;)
								{
									bool flag10 = charIdList.Count == 0;
									if (flag10)
									{
										goto Block_16;
									}
									int index = context.Random.Next(charIdList.Count);
									int targetCharId = charIdList[index];
									bool flag11 = !DomainManager.Character.TryGetElement_Objects(targetCharId, out targetChar3) || !targetChar3._location.IsValid();
									if (!flag11)
									{
										break;
									}
									CollectionUtils.SwapAndRemove<int>(charIdList, index);
								}
								character.PerformHarmfulActionToTarget(context, targetChar3);
								bool flag12 = !DomainManager.Character.IsCharacterAlive(character._id) || !character._location.IsValid();
								if (flag12)
								{
									break;
								}
								i++;
								continue;
								Block_16:
								context.AdvanceMonthRelatedData.CharIdList.Release(ref charIdList);
								return;
							}
							context.AdvanceMonthRelatedData.CharIdList.Release(ref charIdList);
						}
						break;
					}
					case 23:
					{
						bool flag13 = character.GetAgeGroup() == 0;
						if (!flag13)
						{
							DomainManager.Extra.TryAddCharacterAvatarSnapshot(context, character);
							character._avatar.AdjustToBaseCharm(context.Random, (short)Math.Max(0, (int)character._avatar.BaseCharm - markCount * 50));
							character.SetAvatar(character._avatar, context);
							bool flag14 = character._id == taiwu._id;
							if (flag14)
							{
								monthlyNotifications.AddPoisonDestroyFace(character._id);
							}
							lifeRecordCollection.AddMixPoisonHotRedGloomy(character._id, currDate, character._location);
						}
						break;
					}
					case 24:
						character.MakeExistingInjuriesWorse(context, false, (sbyte)(markCount / 3));
						lifeRecordCollection.AddMixPoisonHotRedCold(character._id, currDate, character._location);
						break;
					case 26:
					{
						List<short> equippedSkills = ObjectPool<List<short>>.Instance.Get();
						CombatSkillEquipment skillEquipment = character.GetCombatSkillEquipment();
						skillEquipment.GetValidSkills(equippedSkills);
						bool flag15 = equippedSkills.Count > 0;
						if (flag15)
						{
							for (int j = 0; j < markCount; j++)
							{
								short skillId = equippedSkills.GetRandom(context.Random);
								DomainManager.Combat.AddGoneMadInjuryOutOfCombat(context, character, skillId);
							}
						}
						ObjectPool<List<short>>.Instance.Return(equippedSkills);
						lifeRecordCollection.AddMixPoisonRottenGloomyCold(character._id, currDate, character._location);
						break;
					}
					case 27:
						character.ChangeDisorderOfQiRandomRecovery(context, (int)((short)Math.Clamp(markCount * 500, (int)DisorderLevelOfQi.MinValue, (int)DisorderLevelOfQi.MaxValue)));
						lifeRecordCollection.AddMixPoisonHotGloomyCold(character._id, currDate, character._location);
						break;
					case 28:
						character.MakeExistingInjuriesWorse(context, true, (sbyte)(markCount / 3));
						lifeRecordCollection.AddMixPoisonRedGloomyCold(character._id, currDate, character._location);
						break;
					case 31:
					{
						Location location3 = character._location;
						bool flag16 = !location3.IsValid();
						if (flag16)
						{
							location3 = character.GetValidLocation();
						}
						MapBlockData currBlockData2 = DomainManager.Map.GetBlock(location3);
						bool flag17 = currBlockData2.CharacterSet != null;
						if (flag17)
						{
							foreach (int charId3 in currBlockData2.CharacterSet)
							{
								bool flag18 = charId3 == character._id;
								if (!flag18)
								{
									Character targetChar4 = DomainManager.Character.GetElement_Objects(charId3);
									targetChar4.ChangePoisoned(context, 5, 3, 100 + markCount * 20);
								}
							}
						}
						bool flag19 = location3.Equals(taiwu._location);
						if (flag19)
						{
							HashSet<int> taiwuGroup2 = DomainManager.Taiwu.GetGroupCharIds().GetCollection();
							foreach (int charId4 in taiwuGroup2)
							{
								bool flag20 = charId4 == character._id;
								if (!flag20)
								{
									Character targetChar5 = DomainManager.Character.GetElement_Objects(charId4);
									targetChar5.ChangePoisoned(context, 5, 3, 100 + markCount * 20);
								}
							}
						}
						bool flag21 = character._id == taiwu._id;
						if (flag21)
						{
							monthlyNotifications.AddIllusoryPoisonDiffuse(character._id, location3);
						}
						lifeRecordCollection.AddMixPoisonRedColdIllusory(character._id, currDate, location3);
						break;
					}
					case 33:
					{
						int delta = -character._currNeili * markCount * 5 / 100;
						character.ChangeCurrNeili(context, delta);
						lifeRecordCollection.AddMixPoisonHotGloomyIllusory(character._id, currDate, character._location);
						break;
					}
					}
				}
			}
		}

		// Token: 0x06006E2C RID: 28204 RVA: 0x003E92F8 File Offset: 0x003E74F8
		public void GetPotentialHarmfulActionTargets(List<int> charIdList)
		{
			charIdList.Clear();
			bool flag = !this._location.IsValid();
			if (!flag)
			{
				MapBlockData currBlockData = DomainManager.Map.GetBlock(this._location);
				bool flag2 = currBlockData.CharacterSet != null;
				if (flag2)
				{
					this.GetPotentialHarmfulActionTargetsInSet(currBlockData.CharacterSet, charIdList);
				}
				bool flag3 = this._location.Equals(DomainManager.Taiwu.GetTaiwu()._location);
				if (flag3)
				{
					HashSet<int> taiwuGroup = DomainManager.Taiwu.GetGroupCharIds().GetCollection();
					this.GetPotentialHarmfulActionTargetsInSet(taiwuGroup, charIdList);
				}
			}
		}

		// Token: 0x06006E2D RID: 28205 RVA: 0x003E938C File Offset: 0x003E758C
		private void GetPotentialHarmfulActionTargetsInSet(HashSet<int> allCharSet, List<int> charIdList)
		{
			foreach (int charId in allCharSet)
			{
				bool flag = charId == this._id;
				if (!flag)
				{
					Character targetChar;
					bool flag2 = !DomainManager.Character.TryGetElement_Objects(charId, out targetChar) || targetChar.GetAgeGroup() == 0;
					if (!flag2)
					{
						charIdList.Add(charId);
					}
				}
			}
		}

		// Token: 0x06006E2E RID: 28206 RVA: 0x003E9414 File Offset: 0x003E7614
		private unsafe void PerformHarmfulActionToTarget(DataContext context, Character targetChar)
		{
			MonthlyNotificationCollection monthlyNotifications = DomainManager.World.GetMonthlyNotificationCollection();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			IRandomSource random = context.Random;
			sbyte* actionTypes = stackalloc sbyte[(UIntPtr)4];
			for (sbyte i = 0; i < 4; i += 1)
			{
				actionTypes[i] = i;
			}
			CollectionUtils.Shuffle<sbyte>(context.Random, actionTypes, 4);
			for (int j = 0; j < 4; j++)
			{
				switch (actionTypes[j])
				{
				case 0:
				{
					bool success = DomainManager.Character.HandleAttackAction(context, this, targetChar);
					bool flag = this._id == taiwuCharId;
					if (flag)
					{
						bool flag2 = success;
						if (flag2)
						{
							monthlyNotifications.AddPoisonDisturbMindAttckSuccess(this._id, this._location, targetChar._id);
						}
						else
						{
							monthlyNotifications.AddPoisonDisturbMindAttckFalse(this._id, this._location, targetChar._id);
						}
					}
					return;
				}
				case 1:
				{
					bool success2 = DomainManager.Character.HandlePoisonAction(context, this, targetChar, ItemKey.Invalid, -1);
					bool flag3 = this._id == taiwuCharId;
					if (flag3)
					{
						bool flag4 = success2;
						if (flag4)
						{
							monthlyNotifications.AddPoisonDisturbMindEmpoisonSuccess(this._id, this._location, targetChar._id);
						}
						else
						{
							monthlyNotifications.AddPoisonDisturbMindEmpoisonFalse(this._id, this._location, targetChar._id);
						}
					}
					return;
				}
				case 2:
				{
					bool success3 = DomainManager.Character.HandlePlotHarmAction(context, this, targetChar, ItemKey.Invalid, -1);
					bool flag5 = this._id == taiwuCharId;
					if (flag5)
					{
						bool flag6 = success3;
						if (flag6)
						{
							monthlyNotifications.AddPoisonDisturbMindSneakAttckSuccess(this._id, this._location, targetChar._id);
						}
						else
						{
							monthlyNotifications.AddPoisonDisturbMindSneakAttckFalse(this._id, this._location, targetChar._id);
						}
					}
					return;
				}
				case 3:
				{
					bool flag7 = this.GetAgeGroup() != 2 || targetChar.GetAgeGroup() != 2;
					if (!flag7)
					{
						bool success4 = DomainManager.Character.HandleRapeAction(context, this, targetChar);
						bool flag8 = this._id == taiwuCharId;
						if (flag8)
						{
							bool flag9 = success4;
							if (flag9)
							{
								monthlyNotifications.AddPoisonDisturbMindRapeSuccess(this._id, this._location, targetChar._id);
							}
							else
							{
								monthlyNotifications.AddPoisonDisturbMindRapeFalse(this._id, this._location, targetChar._id);
							}
						}
						return;
					}
					break;
				}
				}
			}
		}

		// Token: 0x06006E2F RID: 28207 RVA: 0x003E966C File Offset: 0x003E786C
		public bool IsOnRegularSettlement()
		{
			Location location = this._location;
			bool flag = !location.IsValid();
			if (flag)
			{
				location = this.GetValidLocation();
			}
			bool flag2 = location.AreaId >= 45;
			bool result;
			if (flag2)
			{
				result = false;
			}
			else
			{
				MapBlockData currBlock = DomainManager.Map.GetBlockData(location.AreaId, location.BlockId);
				result = currBlock.IsCityTown();
			}
			return result;
		}

		// Token: 0x06006E30 RID: 28208 RVA: 0x003E96D0 File Offset: 0x003E78D0
		public bool IsInRegularSettlementRange()
		{
			Location location = this._location;
			bool flag = !location.IsValid();
			if (flag)
			{
				location = this.GetValidLocation();
			}
			bool flag2 = location.AreaId >= 45;
			return !flag2 && DomainManager.Map.GetBelongSettlementBlock(location) != null;
		}

		// Token: 0x06006E31 RID: 28209 RVA: 0x003E9721 File Offset: 0x003E7921
		public void AddTravelTarget(DataContext context, NpcTravelTarget target)
		{
			this._npcTravelTargets.Add(target);
			this.SetNpcTravelTargets(this._npcTravelTargets, context);
		}

		// Token: 0x06006E32 RID: 28210 RVA: 0x003E9740 File Offset: 0x003E7940
		public void UpdateTravelTargetRemainingMonths(DataContext context)
		{
			for (int i = this._npcTravelTargets.Count - 1; i >= 0; i--)
			{
				NpcTravelTarget travelTarget = this._npcTravelTargets[i];
				travelTarget.RemainingMonth--;
				bool flag = travelTarget.RemainingMonth <= 0;
				if (flag)
				{
					this._npcTravelTargets.RemoveAt(i);
				}
			}
			this.SetNpcTravelTargets(this._npcTravelTargets, context);
		}

		// Token: 0x06006E33 RID: 28211 RVA: 0x003E97B4 File Offset: 0x003E79B4
		public void UpdateIntelligentCharacterMovement(DataContext context)
		{
			bool flag = this.IsActiveExternalRelationState(60);
			if (!flag)
			{
				bool flag2 = this.GetAgeGroup() == 0;
				if (!flag2)
				{
					bool flag3 = this._kidnapperId >= 0;
					if (!flag3)
					{
						bool flag4 = this._leaderId >= 0 && this._leaderId != this._id;
						if (!flag4)
						{
							bool flag5 = this.IsCompletelyInfected() && this._location.IsValid();
							if (!flag5)
							{
								bool flag6 = this.GetLegendaryBookOwnerState() >= 2;
								if (!flag6)
								{
									bool flag7 = this._location.IsValid();
									if (flag7)
									{
										HashSet<int> charSet = DomainManager.Map.GetBlock(this._location).CharacterSet;
										bool flag8 = charSet == null || !charSet.Contains(this._id);
										if (flag8)
										{
											return;
										}
									}
									VillagerWorkData work;
									bool flag9 = this.IsActiveExternalRelationState(1) && DomainManager.Taiwu.TryGetElement_VillagerWork(this._id, out work) && work.WorkType != 2;
									if (!flag9)
									{
										bool flag10 = this.ContinueCurrCrossAreaTravel(context);
										if (!flag10)
										{
											bool flag11 = this.TravelToPrioritizedActionTargetLocation(context);
											if (!flag11)
											{
												bool flag12 = this.TravelToTargets(context);
												if (!flag12)
												{
													this.TravelToRandomTarget(context);
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06006E34 RID: 28212 RVA: 0x003E990C File Offset: 0x003E7B0C
		public void CompletelyInfectedCharacterMovement(DataContext context)
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			Location taiwuLocation = DomainManager.Taiwu.GetTaiwu().GetLocation();
			bool flag = this.InfectedMoveCloserToLocationInSameArea(context, taiwuLocation);
			if (!flag)
			{
				switch (this.GetBehaviorType())
				{
				case 0:
				case 1:
				{
					HashSet<int> charSet = context.AdvanceMonthRelatedData.RelatedCharIds.Occupy();
					RelatedCharacters relatedChars = DomainManager.Character.GetRelatedCharacters(this._id);
					if (relatedChars != null)
					{
						relatedChars.GetAllPrioritizedCharIds(charSet);
					}
					List<int>[] prioritizedActionTargets = context.AdvanceMonthRelatedData.PrioritizedTargets.Occupy();
					this.ClassifyPrioritizedActionTargets(prioritizedActionTargets, charSet, context.Random);
					context.AdvanceMonthRelatedData.RelatedCharIds.Release(ref charSet);
					int targetCharId = this.SelectMaxPriorityActionTarget(prioritizedActionTargets, delegate(int charId)
					{
						Character character;
						bool flag6 = !DomainManager.Character.TryGetElement_Objects(charId, out character);
						bool result;
						if (flag6)
						{
							result = false;
						}
						else
						{
							bool flag7 = character._location.IsValid();
							if (flag7)
							{
								result = (character._location.AreaId == this._location.AreaId);
							}
							else
							{
								bool flag8 = character._leaderId != taiwuCharId;
								if (flag8)
								{
									result = false;
								}
								else
								{
									Location validLocation = character.GetValidLocation();
									result = (validLocation.AreaId == this._location.AreaId);
								}
							}
						}
						return result;
					});
					context.AdvanceMonthRelatedData.PrioritizedTargets.Release(ref prioritizedActionTargets);
					bool flag2 = targetCharId < 0;
					if (flag2)
					{
						this.InfectedMoveToRandomLocationInThreeBlocks(context, this._location, false);
					}
					else
					{
						Character targetChar = DomainManager.Character.GetElement_Objects(targetCharId);
						Location targetLocation = targetChar._location;
						bool flag3 = !targetLocation.IsValid();
						if (flag3)
						{
							targetLocation = targetChar.GetValidLocation();
						}
						this.InfectedMoveAwayFromLocationInSameArea(context, targetLocation);
					}
					break;
				}
				case 2:
					this.InfectedMoveToRandomLocationInThreeBlocks(context, this._location, false);
					break;
				case 3:
				case 4:
				{
					HashSet<int> charSet2 = context.AdvanceMonthRelatedData.RelatedCharIds.Occupy();
					RelatedCharacters relatedChars2 = DomainManager.Character.GetRelatedCharacters(this._id);
					if (relatedChars2 != null)
					{
						relatedChars2.GetAllPrioritizedCharIds(charSet2);
					}
					List<int>[] prioritizedActionTargets2 = context.AdvanceMonthRelatedData.PrioritizedTargets.Occupy();
					this.ClassifyPrioritizedActionTargets(prioritizedActionTargets2, charSet2, context.Random);
					context.AdvanceMonthRelatedData.RelatedCharIds.Release(ref charSet2);
					int targetCharId2 = this.SelectMaxPriorityActionTarget(prioritizedActionTargets2, delegate(int charId)
					{
						Character character;
						bool flag6 = !DomainManager.Character.TryGetElement_Objects(charId, out character);
						bool result;
						if (flag6)
						{
							result = false;
						}
						else
						{
							bool flag7 = character._location.IsValid();
							if (flag7)
							{
								result = (character._location.AreaId == this._location.AreaId);
							}
							else
							{
								bool flag8 = character._leaderId != taiwuCharId;
								if (flag8)
								{
									result = false;
								}
								else
								{
									Location validLocation = character.GetValidLocation();
									result = (validLocation.AreaId == this._location.AreaId);
								}
							}
						}
						return result;
					});
					context.AdvanceMonthRelatedData.PrioritizedTargets.Release(ref prioritizedActionTargets2);
					bool flag4 = targetCharId2 < 0;
					if (flag4)
					{
						this.InfectedMoveToRandomLocationInThreeBlocks(context, this._location, false);
					}
					else
					{
						Character targetChar2 = DomainManager.Character.GetElement_Objects(targetCharId2);
						Location targetLocation2 = targetChar2._location;
						bool flag5 = !targetLocation2.IsValid();
						if (flag5)
						{
							targetLocation2 = targetChar2.GetValidLocation();
						}
						this.InfectedMoveCloserToLocationInSameArea(context, targetLocation2);
					}
					break;
				}
				}
			}
		}

		// Token: 0x06006E35 RID: 28213 RVA: 0x003E9B7C File Offset: 0x003E7D7C
		private bool InfectedMoveCloserToLocationInSameArea(DataContext context, Location destLocation)
		{
			bool flag = this._location.AreaId != destLocation.AreaId;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = this._location.BlockId == destLocation.BlockId;
				if (flag2)
				{
					result = true;
				}
				else
				{
					byte areaSize = DomainManager.Map.GetAreaSize(this._location.AreaId);
					ByteCoordinate selfCoordinate = ByteCoordinate.IndexToCoordinate(this._location.BlockId, areaSize);
					ByteCoordinate destCoordinate = ByteCoordinate.IndexToCoordinate(destLocation.BlockId, areaSize);
					bool flag3 = selfCoordinate.GetManhattanDistance(destCoordinate) > 3;
					if (flag3)
					{
						this.InfectedMoveToRandomLocationInThreeBlocks(context, destLocation, false);
					}
					else
					{
						DomainManager.Character.GroupMove(context, this, destLocation);
					}
					result = true;
				}
			}
			return result;
		}

		// Token: 0x06006E36 RID: 28214 RVA: 0x003E9C34 File Offset: 0x003E7E34
		private unsafe bool InfectedMoveAwayFromLocationInSameArea(DataContext context, Location moveAwayFrom)
		{
			bool flag = this._location.AreaId != moveAwayFrom.AreaId;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = this._location.BlockId == moveAwayFrom.BlockId;
				if (flag2)
				{
					bool flag3 = this.InfectedMoveToRandomLocationInThreeBlocks(context, moveAwayFrom, false);
					if (flag3)
					{
						return true;
					}
				}
				byte areaSize = DomainManager.Map.GetAreaSize(this._location.AreaId);
				ByteCoordinate selfCoordinate = ByteCoordinate.IndexToCoordinate(this._location.BlockId, areaSize);
				ByteCoordinate destCoordinate = ByteCoordinate.IndexToCoordinate(moveAwayFrom.BlockId, areaSize);
				bool flag4 = selfCoordinate.GetManhattanDistance(destCoordinate) > 3;
				if (flag4)
				{
					this.InfectedMoveToRandomLocationInThreeBlocks(context, this._location, false);
					result = true;
				}
				else
				{
					Span<MapBlockData> allBlocks = DomainManager.Map.GetAreaBlocks(this._location.AreaId);
					int maxDistance = 0;
					Location selectedLocation = Location.Invalid;
					for (int i = 0; i < 10; i++)
					{
						int index = context.Random.Next(allBlocks.Length);
						MapBlockData selectedBlock = *allBlocks[index];
						Location targetLocation = new Location(selectedBlock.AreaId, selectedBlock.BlockId);
						MapBlockData block = DomainManager.Map.GetBlock(targetLocation);
						bool flag5 = !block.IsPassable();
						if (!flag5)
						{
							ByteCoordinate targetCoordinate = ByteCoordinate.IndexToCoordinate(targetLocation.BlockId, areaSize);
							int distance = selfCoordinate.GetManhattanDistance(targetCoordinate);
							bool flag6 = distance > 3;
							if (flag6)
							{
								selectedLocation = targetLocation;
								break;
							}
							bool flag7 = distance < maxDistance;
							if (!flag7)
							{
								maxDistance = distance;
								selectedLocation = targetLocation;
							}
						}
					}
					DomainManager.Character.GroupMove(context, this, selectedLocation);
					result = true;
				}
			}
			return result;
		}

		// Token: 0x06006E37 RID: 28215 RVA: 0x003E9DE0 File Offset: 0x003E7FE0
		private bool InfectedMoveToRandomLocationInThreeBlocks(DataContext context, Location srcLocation, bool includeCenter = false)
		{
			List<MapBlockData> blocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
			DomainManager.Adventure.GetValidBlocksForRandomEnemy(srcLocation.AreaId, srcLocation.BlockId, 3, true, false, true, blocks);
			MapBlockData selectedBlock = blocks.GetRandomOrDefault(context.Random, null);
			context.AdvanceMonthRelatedData.Blocks.Release(ref blocks);
			bool flag = selectedBlock == null;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				Location targetLocation = new Location(selectedBlock.AreaId, selectedBlock.BlockId);
				DomainManager.Character.GroupMove(context, this, targetLocation);
				result = true;
			}
			return result;
		}

		// Token: 0x06006E38 RID: 28216 RVA: 0x003E9E74 File Offset: 0x003E8074
		private bool ContinueCurrCrossAreaTravel(DataContext context)
		{
			CrossAreaMoveInfo crossAreaMoveInfo;
			bool flag = !DomainManager.Character.TryGetElement_CrossAreaMoveInfos(this._id, out crossAreaMoveInfo);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = this._location.IsValid();
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(10, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Character ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(this._id);
					string tag = defaultInterpolatedStringHandler.ToStringAndClear();
					defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(69, 1);
					defaultInterpolatedStringHandler.AppendLiteral("character is currently in valid location ");
					defaultInterpolatedStringHandler.AppendFormatted<Location>(this._location);
					defaultInterpolatedStringHandler.AppendLiteral(" while cross area traveling.");
					AdaptableLog.TagWarning(tag, defaultInterpolatedStringHandler.ToStringAndClear(), false);
					result = true;
				}
				else
				{
					BasePrioritizedAction action;
					bool flag3 = DomainManager.Character.TryGetCharacterPrioritizedAction(this._id, out action);
					if (flag3)
					{
						Location targetLocation = action.Target.GetRealTargetLocation();
						List<short> areaList = crossAreaMoveInfo.Route.AreaList;
						bool flag4 = areaList[areaList.Count - 1] != targetLocation.AreaId;
						if (flag4)
						{
							Location location0 = this.GetValidLocation();
							Location location = this.GetValidAndNotForbiddenByBeggarSkillLocation(location0);
							bool flag5 = !location.IsValid();
							if (flag5)
							{
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(46, 2);
								defaultInterpolatedStringHandler.AppendLiteral("Character ");
								defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
								defaultInterpolatedStringHandler.AppendLiteral(" cannot find a valid location near ");
								defaultInterpolatedStringHandler.AppendFormatted<Location>(location0);
								defaultInterpolatedStringHandler.AppendLiteral(".");
								throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
							}
							DomainManager.Character.RemoveCrossAreaTravelInfo(context, this._id);
							DomainManager.Character.GroupMove(context, this, location);
							return false;
						}
					}
					this.NpcCrossAreaTravel(context, crossAreaMoveInfo);
					result = true;
				}
			}
			return result;
		}

		// Token: 0x06006E39 RID: 28217 RVA: 0x003EA028 File Offset: 0x003E8228
		public bool IsCrossAreaTraveling()
		{
			bool flag = this._leaderId >= 0;
			bool result;
			if (flag)
			{
				CrossAreaMoveInfo crossAreaMoveInfo;
				result = DomainManager.Character.TryGetElement_CrossAreaMoveInfos(this._leaderId, out crossAreaMoveInfo);
			}
			else
			{
				CrossAreaMoveInfo crossAreaMoveInfo;
				result = DomainManager.Character.TryGetElement_CrossAreaMoveInfos(this._id, out crossAreaMoveInfo);
			}
			return result;
		}

		// Token: 0x06006E3A RID: 28218 RVA: 0x003EA074 File Offset: 0x003E8274
		private bool TravelToPrioritizedActionTargetLocation(DataContext context)
		{
			BasePrioritizedAction action;
			bool flag = !DomainManager.Character.TryGetCharacterPrioritizedAction(this._id, out action);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				Location prioritizedTargetLocation = action.Target.GetRealTargetLocation();
				prioritizedTargetLocation = this.GetValidAndNotForbiddenByBeggarSkillLocation(prioritizedTargetLocation);
				bool flag2 = !prioritizedTargetLocation.IsValid();
				if (flag2)
				{
					result = false;
				}
				else
				{
					bool flag3 = prioritizedTargetLocation.Equals(this._location);
					if (flag3)
					{
						result = true;
					}
					else
					{
						bool flag4 = prioritizedTargetLocation.AreaId != this._location.AreaId;
						if (flag4)
						{
							bool flag5 = !DomainManager.Map.AllowCrossAreaTravel(this._location.AreaId, prioritizedTargetLocation.AreaId);
							if (flag5)
							{
								return false;
							}
							CrossAreaMoveInfo crossTravelRoute = DomainManager.Map.CalcAreaTravelRoute(this, this._location.AreaId, this._location.BlockId, prioritizedTargetLocation.AreaId);
							for (int index = 0; index < this._npcTravelTargets.Count; index++)
							{
								NpcTravelTarget travelTarget = this._npcTravelTargets[index];
								Location targetLocation = travelTarget.GetRealTargetLocation();
								targetLocation = this.GetValidAndNotForbiddenByBeggarSkillLocation(targetLocation);
								bool flag6 = !targetLocation.IsValid();
								if (!flag6)
								{
									bool flag7 = !crossTravelRoute.Route.AreaList.Contains(targetLocation.AreaId);
									if (!flag7)
									{
										bool flag8 = targetLocation.AreaId != this._location.AreaId;
										if (flag8)
										{
											crossTravelRoute.ToAreaId = targetLocation.AreaId;
											bool flag9 = !this.NpcCrossAreaTravel(context, crossTravelRoute);
											if (flag9)
											{
												return true;
											}
										}
										Tester.Assert(targetLocation.AreaId == this._location.AreaId, "");
										DomainManager.Character.GroupMove(context, this, targetLocation);
										this._npcTravelTargets.RemoveAt(index);
										this.SetNpcTravelTargets(this._npcTravelTargets, context);
										return true;
									}
								}
							}
							bool flag10 = !this.NpcCrossAreaTravel(context, crossTravelRoute);
							if (flag10)
							{
								return true;
							}
						}
						Tester.Assert(prioritizedTargetLocation.AreaId == this._location.AreaId, "");
						DomainManager.Character.GroupMove(context, this, prioritizedTargetLocation);
						result = true;
					}
				}
			}
			return result;
		}

		// Token: 0x06006E3B RID: 28219 RVA: 0x003EA2BC File Offset: 0x003E84BC
		private bool TravelToTargets(DataContext context)
		{
			for (int index = 0; index < this._npcTravelTargets.Count; index++)
			{
				NpcTravelTarget travelTarget = this._npcTravelTargets[index];
				Location targetLocation = travelTarget.GetRealTargetLocation();
				targetLocation = this.GetValidAndNotForbiddenByBeggarSkillLocation(targetLocation);
				bool flag = !targetLocation.IsValid();
				if (!flag)
				{
					bool flag2 = targetLocation.AreaId != this._location.AreaId;
					if (flag2)
					{
						bool flag3 = !DomainManager.Map.AllowCrossAreaTravel(this._location.AreaId, targetLocation.AreaId);
						if (flag3)
						{
							return false;
						}
						CrossAreaMoveInfo crossTravelRoute = DomainManager.Map.CalcAreaTravelRoute(this, this._location.AreaId, this._location.BlockId, targetLocation.AreaId);
						bool flag4 = !this.NpcCrossAreaTravel(context, crossTravelRoute);
						if (flag4)
						{
							return true;
						}
					}
					Tester.Assert(targetLocation.AreaId == this._location.AreaId, "");
					DomainManager.Character.GroupMove(context, this, targetLocation);
					this._npcTravelTargets.RemoveAt(index);
					this.SetNpcTravelTargets(this._npcTravelTargets, context);
					return true;
				}
			}
			return false;
		}

		// Token: 0x06006E3C RID: 28220 RVA: 0x003EA3FC File Offset: 0x003E85FC
		private void TravelToRandomTarget(DataContext context)
		{
			bool flag = !context.Random.CheckPercentProb(30);
			if (!flag)
			{
				Location randomMovementTarget = this.OfflineCalcRandomMovementTarget(context);
				randomMovementTarget = this.GetValidAndNotForbiddenByBeggarSkillLocation(randomMovementTarget);
				bool flag2 = !randomMovementTarget.IsValid();
				if (!flag2)
				{
					bool flag3 = randomMovementTarget.AreaId != this._location.AreaId;
					if (flag3)
					{
						bool flag4 = !DomainManager.Map.AllowCrossAreaTravel(this._location.AreaId, randomMovementTarget.AreaId);
						if (flag4)
						{
							return;
						}
						CrossAreaMoveInfo crossTravelRoute = DomainManager.Map.CalcAreaTravelRoute(this, this._location.AreaId, this._location.BlockId, randomMovementTarget.AreaId);
						bool flag5 = !this.NpcCrossAreaTravel(context, crossTravelRoute);
						if (flag5)
						{
							return;
						}
					}
					Tester.Assert(randomMovementTarget.AreaId == this._location.AreaId, "");
					DomainManager.Character.GroupMove(context, this, randomMovementTarget);
				}
			}
		}

		// Token: 0x06006E3D RID: 28221 RVA: 0x003EA4F4 File Offset: 0x003E86F4
		public bool NpcCrossAreaTravel(DataContext context, CrossAreaMoveInfo travelInfo)
		{
			travelInfo.CostedDays += 30;
			int currDays = 0;
			int i = 0;
			while (i < travelInfo.Route.CostList.Count)
			{
				short currAreaId = travelInfo.Route.AreaList[i];
				currDays += (int)travelInfo.Route.CostList[i];
				bool flag;
				if (currAreaId != travelInfo.ToAreaId)
				{
					short num = currAreaId;
					List<short> areaList = travelInfo.Route.AreaList;
					flag = (num == areaList[areaList.Count - 1]);
				}
				else
				{
					flag = true;
				}
				bool flag2 = flag;
				if (flag2)
				{
					short targetBlockId = DomainManager.Map.GetElement_Areas((int)currAreaId).StationBlockId;
					Location targetLocation0 = new Location(currAreaId, targetBlockId);
					Location targetLocation = this.GetValidAndNotForbiddenByBeggarSkillLocation(targetLocation0);
					bool flag3 = !targetLocation.IsValid();
					if (flag3)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(46, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Character ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
						defaultInterpolatedStringHandler.AppendLiteral(" cannot find a valid location near ");
						defaultInterpolatedStringHandler.AppendFormatted<Location>(targetLocation0);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					DomainManager.Character.RemoveCrossAreaTravelInfo(context, this._id);
					DomainManager.Character.GroupMove(context, this, targetLocation);
					return true;
				}
				else
				{
					bool flag4 = currDays >= travelInfo.CostedDays;
					if (flag4)
					{
						break;
					}
					i++;
				}
			}
			bool flag5 = this._location.IsValid();
			if (flag5)
			{
				DomainManager.Character.GroupMove(context, this, Location.Invalid);
			}
			DomainManager.Character.SetCrossAreaTravelInfo(context, this._id, travelInfo);
			return false;
		}

		// Token: 0x06006E3E RID: 28222 RVA: 0x003EA690 File Offset: 0x003E8890
		public unsafe Location OfflineCalcRandomMovementTarget(DataContext context)
		{
			Location currLocation = this._location;
			OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo);
			bool canStroll = orgMemberCfg.CanStroll;
			if (canStroll)
			{
				foreach (GameData.Domains.Character.Ai.PersonalNeed personalNeed in this._personalNeeds)
				{
					bool flag = personalNeed.TemplateId != 8 || personalNeed.ResourceType >= 6;
					if (!flag)
					{
						MapBlockData block = DomainManager.Map.GetBlock(currLocation);
						short currentResource = *(ref block.CurrResources.Items.FixedElementField + (IntPtr)personalNeed.ResourceType * 2);
						bool flag2 = currentResource >= *(ref block.MaxResources.Items.FixedElementField + (IntPtr)personalNeed.ResourceType * 2) / 2;
						if (!flag2)
						{
							List<MapBlockData> neighborBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
							DomainManager.Map.GetRealNeighborBlocks(currLocation.AreaId, currLocation.BlockId, neighborBlocks, 3, false);
							Location targetLocation = currLocation;
							foreach (MapBlockData neighborBlock in neighborBlocks)
							{
								bool flag3 = *(ref neighborBlock.CurrResources.Items.FixedElementField + (IntPtr)personalNeed.ResourceType * 2) < *(ref neighborBlock.MaxResources.Items.FixedElementField + (IntPtr)personalNeed.ResourceType * 2) / 2;
								if (!flag3)
								{
									targetLocation = new Location(neighborBlock.AreaId, neighborBlock.BlockId);
									break;
								}
							}
							ObjectPool<List<MapBlockData>>.Instance.Return(neighborBlocks);
							return targetLocation;
						}
					}
				}
			}
			bool flag4 = this._organizationInfo.SettlementId >= 0;
			Location result;
			if (flag4)
			{
				Settlement settlement = DomainManager.Organization.GetSettlement(this._organizationInfo.SettlementId);
				Location settlementLocation = settlement.GetLocation();
				List<short> blockIds = context.AdvanceMonthRelatedData.BlockIds.Occupy();
				DomainManager.Map.GetSettlementBlocksAndAffiliatedBlocks(settlementLocation.AreaId, settlementLocation.BlockId, blockIds);
				bool isNearSettlement = currLocation.AreaId == settlementLocation.AreaId && blockIds.Contains(currLocation.BlockId);
				bool flag5 = !isNearSettlement;
				if (flag5)
				{
					context.AdvanceMonthRelatedData.BlockIds.Release(ref blockIds);
					result = settlementLocation;
				}
				else
				{
					bool canStroll2 = orgMemberCfg.CanStroll;
					if (canStroll2)
					{
						short targetBlockId = blockIds.GetRandom(context.Random);
						context.AdvanceMonthRelatedData.BlockIds.Release(ref blockIds);
						result = new Location(settlementLocation.AreaId, targetBlockId);
					}
					else
					{
						blockIds.Clear();
						DomainManager.Map.GetSettlementBlocks(settlementLocation.AreaId, settlementLocation.BlockId, blockIds);
						short targetBlockId2 = blockIds.GetRandom(context.Random);
						context.AdvanceMonthRelatedData.BlockIds.Release(ref blockIds);
						result = new Location(settlementLocation.AreaId, targetBlockId2);
					}
				}
			}
			else
			{
				result = currLocation;
			}
			return result;
		}

		// Token: 0x06006E3F RID: 28223 RVA: 0x003EA9D0 File Offset: 0x003E8BD0
		private void OfflineAddNpcTravelTarget(NpcTravelTarget target)
		{
			for (int i = 0; i < this._npcTravelTargets.Count; i++)
			{
				bool flag = !target.IsSameTargetWith(this._npcTravelTargets[i]);
				if (!flag)
				{
					this._npcTravelTargets[i] = target;
					return;
				}
			}
			this._npcTravelTargets.Add(target);
		}

		// Token: 0x06006E40 RID: 28224 RVA: 0x003EAA34 File Offset: 0x003E8C34
		private Location GetValidAndNotForbiddenByBeggarSkillLocation(Location location)
		{
			bool flag = !location.IsValid();
			Location result;
			if (flag)
			{
				result = location;
			}
			else
			{
				bool flag2 = !ProfessionSkillHandle.IsLocationForbiddenByBeggarSkill(location);
				if (flag2)
				{
					result = location;
				}
				else
				{
					int maxSteps = 2;
					List<MapBlockData> neighborBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
					DomainManager.Map.GetRealNeighborBlocks(location.AreaId, location.BlockId, neighborBlocks, maxSteps, false);
					byte centerSize = DomainManager.Map.GetAreaSize(location.AreaId);
					ByteCoordinate centerCoordinate = ByteCoordinate.IndexToCoordinate(location.BlockId, centerSize);
					neighborBlocks.Sort(delegate(MapBlockData a, MapBlockData b)
					{
						byte aSize = DomainManager.Map.GetAreaSize(a.AreaId);
						ByteCoordinate aCoordinate = ByteCoordinate.IndexToCoordinate(a.BlockId, aSize);
						byte bSize = DomainManager.Map.GetAreaSize(b.AreaId);
						ByteCoordinate bCoordinate = ByteCoordinate.IndexToCoordinate(b.BlockId, bSize);
						int aDistance = centerCoordinate.GetManhattanDistance(aCoordinate);
						int bDistance = centerCoordinate.GetManhattanDistance(bCoordinate);
						return aDistance.CompareTo(bDistance);
					});
					Location targetLocation = Location.Invalid;
					foreach (MapBlockData neighborBlock in neighborBlocks)
					{
						Location neighborLocation = neighborBlock.GetLocation();
						bool flag3 = !neighborLocation.IsValid() || ProfessionSkillHandle.IsLocationForbiddenByBeggarSkill(neighborLocation);
						if (!flag3)
						{
							targetLocation = neighborLocation;
							break;
						}
					}
					ObjectPool<List<MapBlockData>>.Instance.Return(neighborBlocks);
					result = targetLocation;
				}
			}
			return result;
		}

		// Token: 0x06006E41 RID: 28225 RVA: 0x003EAB58 File Offset: 0x003E8D58
		public void PeriAdvanceMonth_ExecutePrioritizedAction(DataContext context)
		{
			bool flag = this.GetAgeGroup() == 0;
			if (!flag)
			{
				bool flag2 = this.IsActiveAdvanceMonthStatus(2);
				if (!flag2)
				{
					bool flag3 = this.IsActiveExternalRelationState(60);
					if (!flag3)
					{
						VillagerWorkData work;
						bool flag4 = this.IsActiveExternalRelationState(1) && DomainManager.Taiwu.TryGetElement_VillagerWork(this._id, out work) && work.WorkType != 2;
						if (!flag4)
						{
							bool flag5 = this._kidnapperId >= 0;
							if (!flag5)
							{
								bool flag6 = DomainManager.LegendaryBook.IsCharacterActingCrazy(this);
								if (!flag6)
								{
									sbyte behaviorType = this.GetBehaviorType();
									BasePrioritizedAction prevAction;
									bool hasPrevAction = DomainManager.Character.TryGetCharacterPrioritizedAction(this._id, out prevAction);
									int prevPriority = (int)((!hasPrevAction) ? -1 : (PrioritizedActions.Instance[prevAction.ActionType].BasePriority + PrioritizedActions.Instance[prevAction.ActionType].MoralityPriority[(int)behaviorType]));
									PrioritizedActionModification mod = new PrioritizedActionModification(this)
									{
										Action = (hasPrevAction ? prevAction : null),
										IsNewAction = false
									};
									PrioritizedActionConditions conditions = new PrioritizedActionConditions
									{
										IsAdult = (this.GetAgeGroup() == 2),
										IsLeader = (this._leaderId < 0 || this._id == this._leaderId),
										IsTaiwuTeammate = (this._leaderId == DomainManager.Taiwu.GetTaiwuCharId()),
										IsAllowMarriage = this.OrgAndMonkTypeAllowMarriage(),
										CanStroll = OrganizationDomain.GetOrgMemberConfig(this._organizationInfo).CanStroll,
										LoafDice = context.Random.Next(0, 100),
										OrgTemplateId = this._organizationInfo.OrgTemplateId,
										OrgGrade = this._organizationInfo.Grade
									};
									List<int>[] prioritizedActionTargets = context.AdvanceMonthRelatedData.PrioritizedTargets.Occupy();
									HashSet<int> charSet = context.AdvanceMonthRelatedData.RelatedCharIds.Occupy();
									RelatedCharacters relatedChars = DomainManager.Character.GetRelatedCharacters(this._id);
									if (relatedChars != null)
									{
										relatedChars.GetAllPrioritizedCharIds(charSet);
									}
									this.ClassifyPrioritizedActionTargets(prioritizedActionTargets, charSet, context.Random);
									context.AdvanceMonthRelatedData.RelatedCharIds.Release(ref charSet);
									short i = 0;
									while ((int)i < PrioritizedActions.Instance.Count)
									{
										PrioritizedActionsItem config = PrioritizedActions.Instance[i];
										int priority = (int)(config.BasePriority + config.MoralityPriority[(int)behaviorType]);
										bool flag7 = priority <= prevPriority;
										if (!flag7)
										{
											bool flag8 = hasPrevAction && !config.IsPrevActionInterrupted;
											if (!flag8)
											{
												bool flag9 = DomainManager.Extra.IsPrioritizedActionInCooldown(this._id, i);
												if (!flag9)
												{
													BasePrioritizedAction action = PrioritizedActionTypeHelper.TryCreatePrioritizedAction(context, this, i, ref conditions);
													bool flag10 = action == null;
													if (flag10)
													{
														bool flag11 = config.FailToCreateActionCoolDown >= 0;
														if (flag11)
														{
															PrioritizedActionModification prioritizedActionModification = mod;
															if (prioritizedActionModification.FailToCreateActions == null)
															{
																prioritizedActionModification.FailToCreateActions = new List<short>();
															}
															mod.FailToCreateActions.Add(i);
														}
													}
													else
													{
														mod.Action = action;
														mod.IsNewAction = true;
														prevPriority = priority;
													}
												}
											}
										}
										i += 1;
									}
									context.AdvanceMonthRelatedData.PrioritizedTargets.Release(ref prioritizedActionTargets);
									bool flag12 = mod.Action is HuntTaiwuAction;
									if (flag12)
									{
										DomainManager.Taiwu.JieqingHuntTaiwu = true;
									}
									bool flag13 = mod.Action != null || mod.FailToCreateActions != null;
									if (flag13)
									{
										ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
										recorder.RecordType(ParallelModificationType.PeriAdvanceMonthExecutePrioritizedAction);
										recorder.RecordParameterClass<PrioritizedActionModification>(mod);
									}
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06006E42 RID: 28226 RVA: 0x003EAEF8 File Offset: 0x003E90F8
		public static void ComplementPeriAdvanceMonth_ExecutePrioritizedAction(DataContext context, PrioritizedActionModification mod)
		{
			Character character = mod.Character;
			int charId = character.GetId();
			BasePrioritizedAction action = mod.Action;
			bool flag = !DomainManager.Character.IsCharacterAlive(charId) || character.GetKidnapperId() >= 0;
			if (!flag)
			{
				DomainManager.Extra.UpdatePrioritizedActionCooldown(context, charId);
				bool flag2 = mod.FailToCreateActions != null;
				if (flag2)
				{
					foreach (short templateId in mod.FailToCreateActions)
					{
						character.ResetPrioritizedActionCooldown(context, templateId, true);
					}
				}
				bool flag3 = mod.Action == null;
				if (!flag3)
				{
					bool isActionValid = action.CheckValid(character);
					bool isNewAction = mod.IsNewAction;
					if (isNewAction)
					{
						bool flag4 = !isActionValid;
						if (flag4)
						{
							return;
						}
						BasePrioritizedAction prevAction;
						bool flag5 = DomainManager.Character.TryGetCharacterPrioritizedAction(charId, out prevAction);
						if (flag5)
						{
							prevAction.OnInterrupt(context, character);
							DomainManager.Character.RemoveCharacterPrioritizedAction(context, charId);
							character.ResetPrioritizedActionCooldown(context, mod.Action.ActionType, false);
						}
						DomainManager.Character.AddCharacterPrioritizedAction(context, charId, mod.Action);
						action.OnStart(context, character);
					}
					else
					{
						BasePrioritizedAction basePrioritizedAction = action;
						basePrioritizedAction.Target.RemainingMonth = basePrioritizedAction.Target.RemainingMonth - 1;
					}
					BasePrioritizedAction basePrioritizedAction2;
					bool flag6 = !DomainManager.Character.TryGetCharacterPrioritizedAction(charId, out basePrioritizedAction2);
					if (!flag6)
					{
						bool flag7 = isActionValid;
						if (flag7)
						{
							bool flag8 = mod.IsNewAction || !character._location.IsValid() || !action.Target.IsTargetInteractable() || !character._location.Equals(action.Target.GetRealTargetLocation());
							if (flag8)
							{
								DomainManager.Character.SetCharacterPrioritizedAction(context, charId);
							}
							else
							{
								bool flag9 = !action.HasArrived;
								if (flag9)
								{
									action.OnArrival(context, character);
									bool flag10 = !DomainManager.Character.IsCharacterAlive(charId);
									if (flag10)
									{
										return;
									}
								}
								bool flag11 = action.Execute(context, character);
								if (flag11)
								{
									bool flag12 = !DomainManager.Character.IsCharacterAlive(charId);
									if (!flag12)
									{
										DomainManager.Character.RemoveCharacterPrioritizedAction(context, charId);
										character.ResetPrioritizedActionCooldown(context, mod.Action.ActionType, false);
									}
								}
								else
								{
									DomainManager.Character.SetCharacterPrioritizedAction(context, charId);
								}
							}
						}
						else
						{
							action.OnInterrupt(context, character);
							bool flag13 = !DomainManager.Character.IsCharacterAlive(charId);
							if (!flag13)
							{
								DomainManager.Character.RemoveCharacterPrioritizedAction(context, charId);
								character.ResetPrioritizedActionCooldown(context, mod.Action.ActionType, false);
							}
						}
					}
				}
			}
		}

		// Token: 0x06006E43 RID: 28227 RVA: 0x003EB1A0 File Offset: 0x003E93A0
		public void ResetPrioritizedActionCooldown(DataContext context, short actionType, bool isFailToCreate)
		{
			PrioritizedActionsItem actionCfg = PrioritizedActions.Instance[actionType];
			short coolDown = isFailToCreate ? actionCfg.FailToCreateActionCoolDown : actionCfg.ActionCoolDown;
			bool flag = coolDown <= 0;
			if (!flag)
			{
				DomainManager.Extra.SetPrioritizedActionCooldown(context, this._id, actionType, coolDown);
			}
		}

		// Token: 0x06006E44 RID: 28228 RVA: 0x003EB1F0 File Offset: 0x003E93F0
		public unsafe Location CalcFurthestEscapeDestination(IRandomSource random)
		{
			short srcAreaId = this.GetValidLocation().AreaId;
			int maxTimeCost = -1;
			short maxDistanceAreaId = -1;
			for (short areaId = 0; areaId < 135; areaId += 1)
			{
				bool flag = areaId == srcAreaId;
				if (!flag)
				{
					int totalTimeCost = DomainManager.Map.GetTotalTimeCost(this, srcAreaId, areaId);
					bool flag2 = totalTimeCost > maxTimeCost;
					if (flag2)
					{
						maxTimeCost = totalTimeCost;
						maxDistanceAreaId = areaId;
					}
				}
			}
			MapAreaData areaData = DomainManager.Map.GetElement_Areas((int)maxDistanceAreaId);
			short dstBlockId = areaData.StationBlockId;
			bool flag3 = maxDistanceAreaId < 45;
			if (flag3)
			{
				int num = areaData.SettlementInfos.Length;
				Span<short> span = new Span<short>(stackalloc byte[checked(unchecked((UIntPtr)num) * 2)], num);
				SpanList<short> blockIds = span;
				foreach (SettlementInfo settlementInfo in areaData.SettlementInfos)
				{
					bool flag4 = settlementInfo.SettlementId >= 0;
					if (flag4)
					{
						blockIds.Add(settlementInfo.BlockId);
					}
				}
				dstBlockId = blockIds.GetRandom(random);
			}
			return new Location(maxDistanceAreaId, dstBlockId);
		}

		// Token: 0x06006E45 RID: 28229 RVA: 0x003EB300 File Offset: 0x003E9500
		private unsafe void OfflineUseResourcesForHealingAndDetox(PeriAdvanceMonthUpdateStatusModification mod)
		{
			CombatResources combatResources = DomainManager.Character.GetUsableCombatResources(this._id);
			bool flag = combatResources.HealingCount > 0;
			if (flag)
			{
				for (int i = 0; i < (int)combatResources.HealingCount; i++)
				{
					bool flag2 = !this._injuries.HasAnyInjury();
					if (flag2)
					{
						break;
					}
					int costHerb = CombatDomain.GetHealInjuryCostHerb(this._injuries);
					bool flag3 = this.OfflineCheckHerbLackAndAddPersonalNeed(mod, costHerb);
					if (flag3)
					{
						break;
					}
					this._injuries = DomainManager.Combat.HealInjury(this._id, this, false);
					*(ref this._resources.Items.FixedElementField + (IntPtr)5 * 4) -= costHerb;
					mod.InjuriesChanged = true;
					mod.ResourcesChanged = true;
					mod.UsedHealingCount += 1;
				}
			}
			bool flag4 = combatResources.DetoxCount > 0;
			if (flag4)
			{
				for (int j = 0; j < (int)combatResources.DetoxCount; j++)
				{
					bool flag5 = !this._poisoned.IsNonZero();
					if (flag5)
					{
						break;
					}
					int costHerb2 = CombatDomain.GetHealPoisonCostHerb(this._poisoned);
					bool flag6 = this.OfflineCheckHerbLackAndAddPersonalNeed(mod, costHerb2);
					if (flag6)
					{
						break;
					}
					this._poisoned = DomainManager.Combat.HealPoison(this._id, this, false);
					*(ref this._resources.Items.FixedElementField + (IntPtr)5 * 4) -= costHerb2;
					mod.PoisonedChanged = true;
					mod.ResourcesChanged = true;
					mod.UsedDetoxCount += 1;
				}
			}
			bool flag7 = combatResources.BreathingCount > 0;
			if (flag7)
			{
				for (int k = 0; k < (int)combatResources.BreathingCount; k++)
				{
					bool flag8 = this._disorderOfQi <= 0;
					if (flag8)
					{
						break;
					}
					int costHerb3 = CombatDomain.GetHealQiDisorderCostHerb(this._disorderOfQi);
					bool flag9 = this.OfflineCheckHerbLackAndAddPersonalNeed(mod, costHerb3);
					if (flag9)
					{
						break;
					}
					this._disorderOfQi = DomainManager.Combat.HealQiDisorder(this._id, this, false);
					*(ref this._resources.Items.FixedElementField + (IntPtr)5 * 4) -= costHerb3;
					mod.QiDisorderChanged = true;
					mod.ResourcesChanged = true;
					mod.UsedBreathingCount += 1;
				}
			}
		}

		// Token: 0x06006E46 RID: 28230 RVA: 0x003EB550 File Offset: 0x003E9750
		private unsafe void OfflineUseResourcesForHealth(PeriAdvanceMonthUpdateStatusModification mod)
		{
			CombatResources combatResources = DomainManager.Character.GetUsableCombatResources(this._id);
			bool flag = combatResources.RecoverCount > 0;
			if (flag)
			{
				short maxHealth = this.GetLeftMaxHealth(false);
				for (int i = 0; i < (int)combatResources.RecoverCount; i++)
				{
					bool flag2 = this._health == maxHealth;
					if (flag2)
					{
						break;
					}
					EHealthType type = HealthTypeHelper.CalcType(this._featureIds, this._health, maxHealth);
					int costHerb = CombatDomain.GetHealHealthCostHerb(type);
					bool flag3 = this.OfflineCheckHerbLackAndAddPersonalNeed(mod, costHerb);
					if (flag3)
					{
						break;
					}
					this._health = DomainManager.Combat.HealHealth(this._id, this, false);
					*(ref this._resources.Items.FixedElementField + (IntPtr)5 * 4) -= costHerb;
					mod.ResourcesChanged = true;
					mod.UsedRecoverCount += 1;
				}
			}
		}

		// Token: 0x06006E47 RID: 28231 RVA: 0x003EB634 File Offset: 0x003E9834
		private unsafe bool OfflineCheckHerbLackAndAddPersonalNeed(PeriAdvanceMonthUpdateStatusModification mod, int costHerb)
		{
			bool flag = *(ref this._resources.Items.FixedElementField + (IntPtr)5 * 4) >= costHerb;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(8, 5, costHerb);
				this.OfflineAddPersonalNeed(need);
				mod.PersonalNeedsChanged = true;
				result = true;
			}
			return result;
		}

		// Token: 0x06006E48 RID: 28232 RVA: 0x003EB684 File Offset: 0x003E9884
		private unsafe void OfflineUseMedicineForHealingAndDetox(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			sbyte currMaxEatingSlotCount = this.GetCurrMaxEatingSlotsCount();
			int availableEatingSlotsCount = this._eatingItems.GetAvailableEatingSlotsCount(currMaxEatingSlotCount);
			PoisonInts poisonResists = *this.GetPoisonResists();
			List<ValueTuple<GameData.Domains.Item.Medicine, int>>[] categorizedMedicines = context.AdvanceMonthRelatedData.CategorizedMedicines.Get();
			List<ValueTuple<GameData.Domains.Item.Medicine, int>> outerMedicines = categorizedMedicines[0];
			List<ValueTuple<GameData.Domains.Item.Medicine, int>> innerMedicines = categorizedMedicines[1];
			outerMedicines.Sort(EatingItemComparer.MedicineInjury);
			innerMedicines.Sort(EatingItemComparer.MedicineInjury);
			for (sbyte bodyPart = 0; bodyPart < 7; bodyPart += 1)
			{
				ValueTuple<sbyte, sbyte> valueTuple = this._injuries.Get(bodyPart);
				sbyte outer = valueTuple.Item1;
				sbyte inner = valueTuple.Item2;
				bool flag = outer > 2 && outerMedicines.Count > 0;
				if (flag)
				{
					int selectedIndex = this.SelectTopicalMedicineIndex(outerMedicines, outer, ref this._currMainAttributes, null);
					bool flag2 = selectedIndex >= 0;
					if (flag2)
					{
						ValueTuple<GameData.Domains.Item.Medicine, int> valueTuple2 = outerMedicines[selectedIndex];
						GameData.Domains.Item.Medicine medicine = valueTuple2.Item1;
						int amount = valueTuple2.Item2;
						MedicineItem config = Config.Medicine.Instance[medicine.GetTemplateId()];
						this.OfflineApplyTopicalMedicineInternal(context.Random, config);
						mod.InjuriesChanged = true;
						mod.CurrMainAttributesChanged = true;
						this.OfflineRemoveUsedMedicine(outerMedicines, selectedIndex, -1, mod);
					}
				}
				bool flag3 = inner > 2 && innerMedicines.Count > 0;
				if (flag3)
				{
					int selectedIndex2 = this.SelectTopicalMedicineIndex(innerMedicines, inner, ref this._currMainAttributes, null);
					bool flag4 = selectedIndex2 >= 0;
					if (flag4)
					{
						ValueTuple<GameData.Domains.Item.Medicine, int> valueTuple3 = innerMedicines[selectedIndex2];
						GameData.Domains.Item.Medicine medicine2 = valueTuple3.Item1;
						int amount2 = valueTuple3.Item2;
						MedicineItem config2 = Config.Medicine.Instance[medicine2.GetTemplateId()];
						this.OfflineApplyTopicalMedicineInternal(context.Random, config2);
						mod.InjuriesChanged = true;
						mod.CurrMainAttributesChanged = true;
						this.OfflineRemoveUsedMedicine(innerMedicines, selectedIndex2, -1, mod);
					}
				}
			}
			categorizedMedicines[3].Sort(EatingItemComparer.MedicineQiDisorder);
			int* healthChanges = stackalloc int[(UIntPtr)12];
			while (availableEatingSlotsCount > 1)
			{
				*healthChanges = Character.GetHealthChangeDueToInjuries(ref this._injuries) << 8;
				healthChanges[1] = (Character.GetHealthChangeDueToPoisons(ref this._poisoned, ref poisonResists) << 8) + 1;
				healthChanges[2] = (this.GetHealthChangeDueToDisorderOfQi(this._disorderOfQi) << 8) + 2;
				CollectionUtils.Sort(healthChanges, 3);
				bool flag5 = *healthChanges >> 8 >= 0;
				if (flag5)
				{
					break;
				}
				bool flag6 = !this.OfflineUseMedicineForHealingAndDetoxHelper(context, healthChanges, ref poisonResists, mod);
				if (flag6)
				{
					break;
				}
				availableEatingSlotsCount--;
			}
			this.OfflineCheckPersonalNeedForHealingAndDetox(mod);
		}

		// Token: 0x06006E49 RID: 28233 RVA: 0x003EB8EC File Offset: 0x003E9AEC
		private unsafe bool OfflineUseMedicineForHealingAndDetoxHelper(DataContext context, int* healthChanges, ref PoisonInts poisonResists, PeriAdvanceMonthUpdateStatusModification mod)
		{
			sbyte currMaxEatingSlotCount = this.GetCurrMaxEatingSlotsCount();
			List<ValueTuple<GameData.Domains.Item.Medicine, int>>[] categorizedMedicines = context.AdvanceMonthRelatedData.CategorizedMedicines.Get();
			int* poisonLevels = stackalloc int[(UIntPtr)24];
			int i = 0;
			while (i < 3)
			{
				int type = healthChanges[i] & 255;
				int deltaHealth = healthChanges[i] >> 8;
				bool flag = deltaHealth >= 0;
				if (flag)
				{
					break;
				}
				switch (type)
				{
				case 0:
				{
					List<ValueTuple<GameData.Domains.Item.Medicine, int>> outerMedicines = categorizedMedicines[0];
					List<ValueTuple<GameData.Domains.Item.Medicine, int>> innerMedicines = categorizedMedicines[1];
					sbyte innerInjuryMinLevel = sbyte.MaxValue;
					sbyte outerInjuryMinLevel = sbyte.MaxValue;
					sbyte outerInjuryTotalLevel = 0;
					sbyte innerInjuryTotalLevel = 0;
					for (sbyte bodyPart = 0; bodyPart < 7; bodyPart += 1)
					{
						ValueTuple<sbyte, sbyte> valueTuple = this._injuries.Get(bodyPart);
						sbyte outer = valueTuple.Item1;
						sbyte inner = valueTuple.Item2;
						outerInjuryTotalLevel += outer;
						innerInjuryTotalLevel += inner;
						bool flag2 = outer > 0 && outer < outerInjuryMinLevel;
						if (flag2)
						{
							outerInjuryMinLevel = outer;
						}
						bool flag3 = inner > 0 && inner < innerInjuryMinLevel;
						if (flag3)
						{
							innerInjuryMinLevel = inner;
						}
					}
					bool flag4 = outerMedicines.Count > 0 && outerInjuryMinLevel > innerInjuryMinLevel && outerInjuryMinLevel <= 6;
					if (flag4)
					{
						int medicineIndex = this.SelectMedicineIndexForInjury(outerMedicines, outerInjuryMinLevel, outerInjuryTotalLevel, null);
						bool flag5 = medicineIndex >= 0;
						if (flag5)
						{
							ValueTuple<GameData.Domains.Item.Medicine, int> valueTuple2 = outerMedicines[medicineIndex];
							GameData.Domains.Item.Medicine medicine = valueTuple2.Item1;
							int amount = valueTuple2.Item2;
							MedicineItem config = Config.Medicine.Instance[medicine.GetTemplateId()];
							MedicineEatingInstantEffect effect = new MedicineEatingInstantEffect(config, null);
							this.CalcMedicineEffect_RecoverInjury(ref this._injuries, context.Random, false, ref effect);
							sbyte slot = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
							this.OfflineRemoveUsedMedicine(outerMedicines, medicineIndex, slot, mod);
							mod.InjuriesChanged = true;
							return true;
						}
					}
					bool flag6 = innerMedicines.Count > 0 && innerInjuryMinLevel <= 6;
					if (flag6)
					{
						int medicineIndex = this.SelectMedicineIndexForInjury(innerMedicines, innerInjuryMinLevel, innerInjuryTotalLevel, null);
						bool flag7 = medicineIndex >= 0;
						if (flag7)
						{
							ValueTuple<GameData.Domains.Item.Medicine, int> valueTuple3 = innerMedicines[medicineIndex];
							GameData.Domains.Item.Medicine medicine2 = valueTuple3.Item1;
							int amount2 = valueTuple3.Item2;
							MedicineItem config2 = Config.Medicine.Instance[medicine2.GetTemplateId()];
							MedicineEatingInstantEffect effect2 = new MedicineEatingInstantEffect(config2, null);
							this.CalcMedicineEffect_RecoverInjury(ref this._injuries, context.Random, true, ref effect2);
							sbyte slot2 = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
							this.OfflineRemoveUsedMedicine(innerMedicines, medicineIndex, slot2, mod);
							mod.InjuriesChanged = true;
							return true;
						}
					}
					break;
				}
				case 1:
				{
					List<ValueTuple<GameData.Domains.Item.Medicine, int>> detoxMedicines = categorizedMedicines[4];
					bool flag8 = detoxMedicines.Count <= 0;
					if (!flag8)
					{
						detoxMedicines.Sort(new Comparison<ValueTuple<GameData.Domains.Item.Medicine, int>>(this.CompareDetoxPoisonMedicines));
						for (sbyte poisonType = 0; poisonType < 6; poisonType += 1)
						{
							int level = (int)((*(ref poisonResists.Items.FixedElementField + (IntPtr)poisonType * 4) >= 1000) ? 0 : PoisonsAndLevels.CalcPoisonedLevel(*(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType * 4)));
							poisonLevels[poisonType] = (level << 8) + (int)poisonType;
						}
						CollectionUtils.Sort(poisonLevels, 6);
						for (sbyte index = 5; index >= 0; index -= 1)
						{
							sbyte poisonType2 = (sbyte)(poisonLevels[index] & 255);
							sbyte level2 = (sbyte)(poisonLevels[index] >> 8);
							bool flag9 = level2 <= 0;
							if (flag9)
							{
								break;
							}
							int medicineIndex2 = this.SelectMedicineIndexForDetoxPoison(detoxMedicines, poisonType2, level2, *(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType2 * 4), null);
							bool flag10 = medicineIndex2 < 0;
							if (!flag10)
							{
								ValueTuple<GameData.Domains.Item.Medicine, int> medicine3 = detoxMedicines[medicineIndex2];
								MedicineItem config3 = Config.Medicine.Instance[medicine3.Item1.GetTemplateId()];
								int delta = -this.CalcMedicineEffectDelta(*(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType2 * 4), config3.EffectValue, config3.EffectIsPercentage);
								*(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType2 * 4) = Math.Max(*(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType2 * 4) + delta, 0);
								sbyte slot3 = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
								this.OfflineRemoveUsedMedicine(detoxMedicines, medicineIndex2, slot3, mod);
								mod.PoisonedChanged = true;
								return true;
							}
						}
					}
					break;
				}
				case 2:
				{
					List<ValueTuple<GameData.Domains.Item.Medicine, int>> qiMedicines = categorizedMedicines[3];
					int selectedIndex = this.SelectMedicineIndexForQiDisorder(qiMedicines, this._disorderOfQi, null);
					bool flag11 = selectedIndex >= 0;
					if (flag11)
					{
						ValueTuple<GameData.Domains.Item.Medicine, int> valueTuple4 = qiMedicines[selectedIndex];
						GameData.Domains.Item.Medicine medicine4 = valueTuple4.Item1;
						int amount3 = valueTuple4.Item2;
						short delta2 = medicine4.GetEffectValue();
						this._disorderOfQi = (short)Math.Clamp((int)(this._disorderOfQi + delta2), (int)DisorderLevelOfQi.MinValue, (int)DisorderLevelOfQi.MaxValue);
						sbyte slot4 = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
						this.OfflineRemoveUsedMedicine(qiMedicines, selectedIndex, slot4, mod);
						mod.QiDisorderChanged = true;
						return true;
					}
					break;
				}
				}
				IL_4ED:
				i++;
				continue;
				goto IL_4ED;
			}
			return false;
		}

		// Token: 0x06006E4A RID: 28234 RVA: 0x003EBE00 File Offset: 0x003EA000
		public unsafe int CompareDetoxPoisonMedicines([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] ValueTuple<GameData.Domains.Item.Medicine, int> a, [TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] ValueTuple<GameData.Domains.Item.Medicine, int> b)
		{
			short aEffect = a.Item1.GetEffectValue();
			short bEffect = b.Item1.GetEffectValue();
			sbyte aPoisonedType = a.Item1.GetEffectSubType().PoisonType();
			sbyte bPoisonedType = b.Item1.GetEffectSubType().PoisonType();
			int aPoisonedVal = (aPoisonedType < 0) ? 0 : (*(ref this._poisoned.Items.FixedElementField + (IntPtr)aPoisonedType * 4));
			int aDelta = (aPoisonedType < 0) ? int.MinValue : this.CalcMedicineEffectDelta(aPoisonedVal, aEffect, a.Item1.GetEffectSubType().IsPercentage());
			int bPoisonedVal = (bPoisonedType < 0) ? -1 : (*(ref this._poisoned.Items.FixedElementField + (IntPtr)bPoisonedType * 4));
			return ((aPoisonedType < 0) ? int.MinValue : this.CalcMedicineEffectDelta(bPoisonedVal, bEffect, b.Item1.GetEffectSubType().IsPercentage())).CompareTo(aDelta);
		}

		// Token: 0x06006E4B RID: 28235 RVA: 0x003EBEE4 File Offset: 0x003EA0E4
		private unsafe void OfflineCheckPersonalNeedForHealingAndDetox(PeriAdvanceMonthUpdateStatusModification mod)
		{
			int totalOuter = 0;
			int totalInner = 0;
			bool outerNeedHeal = false;
			bool innerNeedHeal = false;
			for (sbyte bodyPart = 0; bodyPart < 7; bodyPart += 1)
			{
				ValueTuple<sbyte, sbyte> valueTuple = this._injuries.Get(bodyPart);
				sbyte outer = valueTuple.Item1;
				sbyte inner = valueTuple.Item2;
				totalOuter += (int)outer;
				totalInner += (int)inner;
				bool flag = outer > 2;
				if (flag)
				{
					outerNeedHeal = true;
				}
				bool flag2 = inner > 2;
				if (flag2)
				{
					innerNeedHeal = true;
				}
			}
			bool flag3 = outerNeedHeal;
			if (flag3)
			{
				GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(4, 0, totalOuter);
				this.OfflineAddPersonalNeed(personalNeed);
				mod.PersonalNeedsChanged = true;
			}
			bool flag4 = innerNeedHeal;
			if (flag4)
			{
				GameData.Domains.Character.Ai.PersonalNeed personalNeed2 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(4, 1, totalInner);
				this.OfflineAddPersonalNeed(personalNeed2);
				mod.PersonalNeedsChanged = true;
			}
			for (sbyte poisonType = 0; poisonType < 6; poisonType += 1)
			{
				int poisonAmount = *(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType * 4);
				sbyte poisonLevel = PoisonsAndLevels.CalcPoisonedLevel(poisonAmount);
				bool flag5 = poisonLevel <= 0;
				if (!flag5)
				{
					GameData.Domains.Character.Ai.PersonalNeed personalNeed3 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(5, poisonType, poisonAmount);
					this.OfflineAddPersonalNeed(personalNeed3);
					mod.PersonalNeedsChanged = true;
				}
			}
			bool flag6 = this.GetHealthChangeDueToDisorderOfQi(this._disorderOfQi) < 0;
			if (flag6)
			{
				GameData.Domains.Character.Ai.PersonalNeed personalNeed4 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(2, this._disorderOfQi);
				this.OfflineAddPersonalNeed(personalNeed4);
				mod.PersonalNeedsChanged = true;
			}
		}

		// Token: 0x06006E4C RID: 28236 RVA: 0x003EC038 File Offset: 0x003EA238
		private void OfflineUseMedicineForHealth(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			short leftMaxHealth = this.GetLeftMaxHealth(false);
			bool flag = this._health >= leftMaxHealth / 2;
			if (!flag)
			{
				sbyte currMaxEatingSlotCount = this.GetCurrMaxEatingSlotsCount();
				sbyte eatingSlot = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
				List<ValueTuple<GameData.Domains.Item.Medicine, int>>[] categorizedMedicines = context.AdvanceMonthRelatedData.CategorizedMedicines.Get();
				List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines = categorizedMedicines[2];
				bool flag2 = eatingSlot >= 0 && medicines.Count > 0;
				if (flag2)
				{
					medicines.Sort(EatingItemComparer.MedicineEffect);
					while (eatingSlot >= 0 && this._health < leftMaxHealth)
					{
						int selectedIndex = this.SelectMedicineIndexForHealth(medicines, this._health, leftMaxHealth, null);
						bool flag3 = selectedIndex < 0;
						if (flag3)
						{
							break;
						}
						short medicineEffect = medicines[selectedIndex].Item1.GetEffectValue();
						this._health = (short)Math.Min((int)(this._health + medicineEffect), (int)leftMaxHealth);
						this.OfflineRemoveUsedMedicine(medicines, selectedIndex, eatingSlot, mod);
						eatingSlot = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
					}
				}
				bool flag4 = this._health < leftMaxHealth;
				if (flag4)
				{
					GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(1, (int)(leftMaxHealth - this._health));
					this.OfflineAddPersonalNeed(personalNeed);
					mod.PersonalNeedsChanged = true;
				}
			}
		}

		// Token: 0x06006E4D RID: 28237 RVA: 0x003EC16C File Offset: 0x003EA36C
		private unsafe void OfflineUseMedicineForWug(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			sbyte currMaxEatingSlotCount = this.GetCurrMaxEatingSlotsCount();
			sbyte eatingSlot = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
			List<ValueTuple<GameData.Domains.Item.Medicine, int>>[] categorizedMedicines = context.AdvanceMonthRelatedData.CategorizedMedicines.Get();
			List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines = categorizedMedicines[5];
			List<ValueTuple<GameData.Domains.Item.Medicine, int>> poisons = categorizedMedicines[6];
			bool flag = eatingSlot >= 0 && (medicines.Count > 0 || poisons.Count > 0);
			if (flag)
			{
				medicines.Sort(EatingItemComparer.MedicineGrade);
				poisons.Sort(EatingItemComparer.MedicineGrade);
				for (sbyte currSlot = 0; currSlot < 9; currSlot += 1)
				{
					ItemKey itemKey = (ItemKey)(*(ref this._eatingItems.ItemKeys.FixedElementField + (IntPtr)currSlot * 8));
					bool flag2 = !EatingItems.IsWug(itemKey) || itemKey.IsValid();
					if (!flag2)
					{
						MedicineItem wugConfig = Config.Medicine.Instance[itemKey.TemplateId];
						bool hasWug = EatingItems.IsWug(this._eatingItems.Get((int)currSlot)) && !this._eatingItems.Get((int)currSlot).IsValid();
						while (eatingSlot >= 0 && hasWug)
						{
							int selectedIndex = this.SelectMedicineIndexForWug(medicines, wugConfig.WugType, *(ref this._eatingItems.Durations.FixedElementField + (IntPtr)currSlot * 2), null);
							bool flag3 = selectedIndex >= 0;
							if (flag3)
							{
								short deltaDuration = GameData.Domains.Item.Medicine.GetDeltaWugDuration(medicines[selectedIndex].Item1.GetGrade());
								ref this._eatingItems.ChangeDuration(context, (int)currSlot, deltaDuration, ref mod.RemovedWugs);
								this.OfflineRemoveUsedMedicine(medicines, selectedIndex, eatingSlot, mod);
								eatingSlot = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
							}
							else
							{
								selectedIndex = Character.SelectPoisonIndexForWug(poisons, wugConfig.WugType, *(ref this._eatingItems.Durations.FixedElementField + (IntPtr)currSlot * 2), null);
								bool flag4 = selectedIndex >= 0;
								if (!flag4)
								{
									break;
								}
								MedicineItem config = Config.Medicine.Instance[poisons[selectedIndex].Item1.GetTemplateId()];
								short deltaDuration2 = GameData.Domains.Item.Medicine.GetDeltaWugDuration(config.Grade);
								ref this._eatingItems.ChangeDuration(context, (int)currSlot, deltaDuration2, ref mod.RemovedWugs);
								sbyte poisonType = config.PoisonType;
								sbyte poisonLevel = (sbyte)config.EffectThresholdValue;
								bool flag5 = !this.HasPoisonImmunity(poisonType);
								if (flag5)
								{
									int maxValue = 25000;
									int poisoned = *(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType * 4);
									*(ref this._poisoned.Items.FixedElementField + (IntPtr)poisonType * 4) = Math.Clamp(poisoned + (int)config.EffectValue, 0, maxValue);
									mod.PoisonedChanged = true;
								}
								this.OfflineRemoveUsedMedicine(poisons, selectedIndex, eatingSlot, mod);
								eatingSlot = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
							}
						}
					}
				}
			}
			for (sbyte currSlot2 = 0; currSlot2 < 9; currSlot2 += 1)
			{
				ItemKey itemKey2 = (ItemKey)(*(ref this._eatingItems.ItemKeys.FixedElementField + (IntPtr)currSlot2 * 8));
				bool flag6 = !EatingItems.IsWug(itemKey2) || itemKey2.IsValid();
				if (!flag6)
				{
					MedicineItem wugConfig2 = Config.Medicine.Instance[itemKey2.TemplateId];
					bool hasWug2 = EatingItems.IsWug(this._eatingItems.Get((int)currSlot2)) && !this._eatingItems.Get((int)currSlot2).IsValid();
					bool flag7 = hasWug2;
					if (flag7)
					{
						GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeedKillWug(wugConfig2.WugType);
						this.OfflineAddPersonalNeed(personalNeed);
						mod.PersonalNeedsChanged = true;
					}
				}
			}
		}

		// Token: 0x06006E4E RID: 28238 RVA: 0x003EC500 File Offset: 0x003EA700
		private void OfflineUseItemForNeili(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			int maxNeili = this.GetMaxNeili();
			bool flag = this._currNeili >= maxNeili;
			if (!flag)
			{
				List<ValueTuple<GameData.Domains.Item.Misc, int>> itemsForNeili = context.AdvanceMonthRelatedData.ItemsForNeili.Get();
				bool flag2 = itemsForNeili.Count > 0;
				if (flag2)
				{
					itemsForNeili.Sort(EatingItemComparer.MiscNeili);
					while (this._currNeili < maxNeili)
					{
						int selectedIndex = this.SelectItemIndexForNeili(itemsForNeili, this._currNeili, maxNeili, null);
						bool flag3 = selectedIndex < 0;
						if (flag3)
						{
							break;
						}
						ValueTuple<GameData.Domains.Item.Misc, int> valueTuple = itemsForNeili[selectedIndex];
						GameData.Domains.Item.Misc item = valueTuple.Item1;
						int amount = valueTuple.Item2;
						short neili = item.GetNeili();
						this._currNeili = (int)((short)Math.Min(this._currNeili + (int)neili, maxNeili));
						mod.CurrNeiliChanged = true;
						bool flag4 = amount > 1;
						if (flag4)
						{
							itemsForNeili[selectedIndex] = new ValueTuple<GameData.Domains.Item.Misc, int>(item, amount - 1);
						}
						else
						{
							itemsForNeili.RemoveAt(selectedIndex);
						}
						ItemKey itemKey = item.GetItemKey();
						this._inventory.OfflineRemove(itemKey, 1);
						mod.InventoryChanged = true;
					}
				}
				bool flag5 = this._currNeili < maxNeili;
				if (flag5)
				{
					GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(3, maxNeili - this._currNeili);
					this.OfflineAddPersonalNeed(need);
					mod.PersonalNeedsChanged = true;
				}
			}
		}

		// Token: 0x06006E4F RID: 28239 RVA: 0x003EC64C File Offset: 0x003EA84C
		private unsafe void OfflineUseFoodForMainAttributes(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			MainAttributes maxMainAttributes = this.GetMaxMainAttributes();
			sbyte currMaxEatingSlotCount = this.GetCurrMaxEatingSlotsCount();
			sbyte eatingSlot = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
			List<ValueTuple<GameData.Domains.Item.Food, int>>[] foodsForMainAttributes = context.AdvanceMonthRelatedData.FoodsForMainAttributes.Get();
			for (sbyte attrType = 0; attrType < 6; attrType += 1)
			{
				short maxMainAttr = *(ref maxMainAttributes.Items.FixedElementField + (IntPtr)attrType * 2);
				bool flag = *(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)attrType * 2) * 2 >= maxMainAttr;
				if (!flag)
				{
					List<ValueTuple<GameData.Domains.Item.Food, int>> foods = foodsForMainAttributes[(int)attrType];
					bool flag2 = eatingSlot >= 0 && foods.Count > 0;
					if (flag2)
					{
						sbyte behaviorType = this.GetBehaviorType();
						sbyte eatForbiddenFoodChance = AiHelper.UpdateStatusConstants.EatForbiddenFoodChance[(int)behaviorType];
						bool isMeatForbidden = this.IsForbiddenToEatMeat();
						short rateAdjust = DomainManager.Extra.GetAiActionRateAdjust(this._id, 6, -1);
						bool allowMeat = !isMeatForbidden || context.Random.CheckPercentProb((int)((short)eatForbiddenFoodChance + rateAdjust));
						foods.Sort(EatingItemComparer.FoodMainAttributes[(int)attrType]);
						while (eatingSlot >= 0 && *(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)attrType * 2) < maxMainAttr)
						{
							int selectedIndex = this.SelectFoodIndexForMainAttributes(foods, attrType, *(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)attrType * 2), maxMainAttr, allowMeat, null);
							bool flag3 = selectedIndex < 0;
							if (flag3)
							{
								break;
							}
							FoodItem config = Config.Food.Instance[foods[selectedIndex].Item1.GetTemplateId()];
							short regenAmount = *(ref config.MainAttributesRegen.Items.FixedElementField + (IntPtr)attrType * 2);
							*(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)attrType * 2) = (short)Math.Min((int)(*(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)attrType * 2) + regenAmount), (int)maxMainAttr);
							mod.CurrMainAttributesChanged = true;
							bool flag4 = isMeatForbidden && config.ItemSubType == 701;
							if (flag4)
							{
								ItemKey itemKey = foods[selectedIndex].Item1.GetItemKey();
								if (mod.ConsumedForbiddenFoodsOrWines == null)
								{
									mod.ConsumedForbiddenFoodsOrWines = new List<ItemKey>();
								}
								bool flag5 = !mod.ConsumedForbiddenFoodsOrWines.Contains(itemKey);
								if (flag5)
								{
									mod.ConsumedForbiddenFoodsOrWines.Add(itemKey);
								}
								sbyte happinessChange = AiHelper.UpdateStatusConstants.EatForbiddenFoodHappinessChange[(int)behaviorType];
								this._happiness = (sbyte)Math.Clamp((int)(this._happiness + happinessChange), -119, 119);
								mod.HappinessChanged = true;
							}
							this.OfflineRemoveUsedFood(foods, selectedIndex, eatingSlot, mod);
							eatingSlot = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
						}
					}
					bool flag6 = *(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)attrType * 2) < *(ref maxMainAttributes.Items.FixedElementField + (IntPtr)attrType * 2);
					if (flag6)
					{
						GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(6, attrType, (int)(*(ref maxMainAttributes.Items.FixedElementField + (IntPtr)attrType * 2) - *(ref this._currMainAttributes.Items.FixedElementField + (IntPtr)attrType * 2)));
						this.OfflineAddPersonalNeed(need);
						mod.PersonalNeedsChanged = true;
					}
				}
			}
		}

		// Token: 0x06006E50 RID: 28240 RVA: 0x003EC96C File Offset: 0x003EAB6C
		private void OfflineUpdateHappiness(PeriAdvanceMonthUpdateStatusModification mod)
		{
			int happinessDelta = DomainManager.SpecialEffect.ModifyValue(this._id, 270, 0, -1, -1, -1, 0, 0, 0, 0);
			bool flag = happinessDelta == 0;
			if (!flag)
			{
				sbyte prevHappiness = this._happiness;
				this._happiness = (sbyte)Math.Clamp((int)this._happiness + happinessDelta, -119, 119);
				bool flag2 = prevHappiness != this._happiness;
				if (flag2)
				{
					mod.HappinessChanged = true;
				}
			}
		}

		// Token: 0x06006E51 RID: 28241 RVA: 0x003EC9D8 File Offset: 0x003EABD8
		private void OfflineUseTeaWineForHappiness(DataContext context, PeriAdvanceMonthUpdateStatusModification mod)
		{
			sbyte happinessThreshold = HappinessType.Ranges[3].Item1;
			bool flag = this._happiness >= happinessThreshold;
			if (!flag)
			{
				sbyte currMaxEatingSlotCount = this.GetCurrMaxEatingSlotsCount();
				sbyte eatingSlot = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
				List<ValueTuple<GameData.Domains.Item.TeaWine, int>> teaWines = context.AdvanceMonthRelatedData.TeaWinesForHappiness.Get();
				bool flag2 = eatingSlot >= 0 && teaWines.Count > 0;
				if (flag2)
				{
					sbyte behaviorType = this.GetBehaviorType();
					short rateAdjust = DomainManager.Extra.GetAiActionRateAdjust(this._id, 6, -1);
					sbyte eatForbiddenFoodChance = AiHelper.UpdateStatusConstants.EatForbiddenFoodChance[(int)behaviorType];
					bool isWineForbidden = this.IsForbiddenToDrinkingWines();
					bool allowWines = !isWineForbidden || context.Random.CheckPercentProb((int)((short)eatForbiddenFoodChance + rateAdjust));
					teaWines.Sort(EatingItemComparer.TeaWineHappiness);
					while (eatingSlot >= 0 && this._happiness < happinessThreshold)
					{
						int selectedIndex = this.SelectTeaWineForHappiness(teaWines, (int)this._happiness, (int)happinessThreshold, allowWines, null);
						bool flag3 = selectedIndex < 0;
						if (flag3)
						{
							break;
						}
						TeaWineItem config = Config.TeaWine.Instance[teaWines[selectedIndex].Item1.GetTemplateId()];
						this._happiness = (sbyte)Math.Clamp((int)(this._happiness + config.EatHappinessChange), -119, 119);
						mod.HappinessChanged = true;
						bool flag4 = isWineForbidden && config.ItemSubType == 901;
						if (flag4)
						{
							ItemKey itemKey = teaWines[selectedIndex].Item1.GetItemKey();
							if (mod.ConsumedForbiddenFoodsOrWines == null)
							{
								mod.ConsumedForbiddenFoodsOrWines = new List<ItemKey>();
							}
							bool flag5 = !mod.ConsumedForbiddenFoodsOrWines.Contains(itemKey);
							if (flag5)
							{
								mod.ConsumedForbiddenFoodsOrWines.Add(itemKey);
							}
							sbyte happinessChange = AiHelper.UpdateStatusConstants.EatForbiddenFoodHappinessChange[(int)behaviorType];
							this._happiness = (sbyte)Math.Clamp((int)(this._happiness + happinessChange), -119, 119);
						}
						this.OfflineRemoveUsedTeaWine(teaWines, selectedIndex, eatingSlot, mod);
						eatingSlot = this._eatingItems.GetAvailableEatingSlot(currMaxEatingSlotCount);
					}
				}
				bool flag6 = this._happiness < happinessThreshold;
				if (flag6)
				{
					GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(0, (int)(happinessThreshold - this._happiness));
					this.OfflineAddPersonalNeed(need);
					mod.PersonalNeedsChanged = true;
				}
			}
		}

		// Token: 0x06006E52 RID: 28242 RVA: 0x003ECC04 File Offset: 0x003EAE04
		private void OfflineRemoveUsedMedicine([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines, int selectedIndex, sbyte eatingSlot, PeriAdvanceMonthUpdateStatusModification mod)
		{
			ValueTuple<GameData.Domains.Item.Medicine, int> valueTuple = medicines[selectedIndex];
			GameData.Domains.Item.Medicine medicine = valueTuple.Item1;
			int amount = valueTuple.Item2;
			bool flag = amount > 1;
			if (flag)
			{
				medicines[selectedIndex] = new ValueTuple<GameData.Domains.Item.Medicine, int>(medicine, amount - 1);
			}
			else
			{
				medicines.RemoveAt(selectedIndex);
			}
			ItemKey itemKey = medicine.GetItemKey();
			this._inventory.OfflineRemove(itemKey, 1);
			mod.InventoryChanged = true;
			bool flag2 = eatingSlot < 0;
			if (!flag2)
			{
				this._eatingItems.Set((int)eatingSlot, itemKey, medicine.GetDuration());
				mod.EatingItemsChanged = true;
			}
		}

		// Token: 0x06006E53 RID: 28243 RVA: 0x003ECC90 File Offset: 0x003EAE90
		private void OfflineRemoveUsedTeaWine([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.TeaWine, int>> items, int selectedIndex, sbyte eatingSlot, PeriAdvanceMonthUpdateStatusModification mod)
		{
			ValueTuple<GameData.Domains.Item.TeaWine, int> valueTuple = items[selectedIndex];
			GameData.Domains.Item.TeaWine teaWine = valueTuple.Item1;
			int amount = valueTuple.Item2;
			bool flag = amount > 1;
			if (flag)
			{
				items[selectedIndex] = new ValueTuple<GameData.Domains.Item.TeaWine, int>(teaWine, amount - 1);
			}
			else
			{
				items.RemoveAt(selectedIndex);
			}
			ItemKey itemKey = teaWine.GetItemKey();
			this._inventory.OfflineRemove(itemKey, 1);
			mod.InventoryChanged = true;
			short duration = Config.TeaWine.Instance[itemKey.TemplateId].Duration;
			this._eatingItems.Set((int)eatingSlot, itemKey, duration);
			mod.EatingItemsChanged = true;
		}

		// Token: 0x06006E54 RID: 28244 RVA: 0x003ECD24 File Offset: 0x003EAF24
		private void OfflineRemoveUsedFood([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.Food, int>> items, int selectedIndex, sbyte eatingSlot, PeriAdvanceMonthUpdateStatusModification mod)
		{
			ValueTuple<GameData.Domains.Item.Food, int> valueTuple = items[selectedIndex];
			GameData.Domains.Item.Food food = valueTuple.Item1;
			int amount = valueTuple.Item2;
			bool flag = amount > 1;
			if (flag)
			{
				items[selectedIndex] = new ValueTuple<GameData.Domains.Item.Food, int>(food, amount - 1);
			}
			else
			{
				items.RemoveAt(selectedIndex);
			}
			ItemKey itemKey = food.GetItemKey();
			this._inventory.OfflineRemove(itemKey, 1);
			mod.InventoryChanged = true;
			short duration = Config.Food.Instance[itemKey.TemplateId].Duration;
			this._eatingItems.Set((int)eatingSlot, itemKey, duration);
			mod.EatingItemsChanged = true;
		}

		// Token: 0x06006E55 RID: 28245 RVA: 0x003ECDB8 File Offset: 0x003EAFB8
		public unsafe int SelectTopicalMedicineIndex([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines, sbyte level, ref MainAttributes mainAttributes, List<ItemKey> selections = null)
		{
			bool hasSelections = selections != null;
			bool flag = hasSelections;
			if (flag)
			{
				selections.Clear();
			}
			int workingIndex = -1;
			for (int currIndex = 0; currIndex < medicines.Count; currIndex++)
			{
				ValueTuple<GameData.Domains.Item.Medicine, int> medicine = medicines[currIndex];
				bool flag2 = this.TryDetectAttachedPoisons(medicine.Item1.GetItemKey());
				if (!flag2)
				{
					sbyte requiredMainAttrType = medicine.Item1.GetRequiredMainAttributeType();
					sbyte requiredMainAttrVal = medicine.Item1.GetRequiredMainAttributeValue();
					bool flag3 = *(ref mainAttributes.Items.FixedElementField + (IntPtr)requiredMainAttrType * 2) < (short)requiredMainAttrVal;
					if (!flag3)
					{
						bool flag4 = hasSelections;
						if (flag4)
						{
							selections.Add(medicine.Item1.GetItemKey());
						}
						int totalEffect = (int)(medicine.Item1.GetEffectValue() * (short)medicine.Item1.GetInjuryRecoveryTimes() * medicine.Item1.GetDuration());
						bool flag5 = totalEffect >= (int)level;
						if (flag5)
						{
							return currIndex;
						}
						workingIndex = currIndex;
					}
				}
			}
			return workingIndex;
		}

		// Token: 0x06006E56 RID: 28246 RVA: 0x003ECEBC File Offset: 0x003EB0BC
		public int SelectMedicineIndexForInjury([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines, sbyte minLevel, sbyte injuryTotalLevel, List<ItemKey> selections = null)
		{
			bool hasSelections = selections != null;
			bool flag = hasSelections;
			if (flag)
			{
				selections.Clear();
			}
			int workingIndex = -1;
			for (int currIndex = 0; currIndex < medicines.Count; currIndex++)
			{
				ValueTuple<GameData.Domains.Item.Medicine, int> medicine = medicines[currIndex];
				bool flag2 = this.TryDetectAttachedPoisons(medicine.Item1.GetItemKey());
				if (!flag2)
				{
					bool flag3 = hasSelections;
					if (flag3)
					{
						selections.Add(medicine.Item1.GetItemKey());
					}
					int totalEffect = (int)(medicine.Item1.GetEffectValue() * (short)medicine.Item1.GetInjuryRecoveryTimes() * medicine.Item1.GetDuration());
					bool flag4 = totalEffect >= (int)injuryTotalLevel;
					if (flag4)
					{
						return currIndex;
					}
					workingIndex = currIndex;
				}
			}
			return workingIndex;
		}

		// Token: 0x06006E57 RID: 28247 RVA: 0x003ECF80 File Offset: 0x003EB180
		public int SelectMedicineIndexForDetoxPoison([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines, sbyte poisonType, sbyte level, int poisonedVal, List<ItemKey> selections = null)
		{
			bool hasSelections = selections != null;
			bool flag = hasSelections;
			if (flag)
			{
				selections.Clear();
			}
			int workingIndex = -1;
			for (int i = 0; i < medicines.Count; i++)
			{
				ValueTuple<GameData.Domains.Item.Medicine, int> medicine = medicines[i];
				bool flag2 = medicine.Item1.GetEffectSubType().DetoxPoisonType() != poisonType;
				if (!flag2)
				{
					MedicineItem config = Config.Medicine.Instance[medicine.Item1.GetTemplateId()];
					sbyte threshold = (sbyte)config.EffectThresholdValue;
					bool flag3 = level > threshold;
					if (!flag3)
					{
						bool flag4 = this.TryDetectAttachedPoisons(medicine.Item1.GetItemKey());
						if (!flag4)
						{
							bool flag5 = hasSelections;
							if (flag5)
							{
								selections.Add(medicine.Item1.GetItemKey());
							}
							int delta = this.CalcMedicineEffectDelta(poisonedVal, config.EffectValue, config.EffectIsPercentage);
							bool flag6 = delta + poisonedVal <= 0;
							if (flag6)
							{
								return i;
							}
							workingIndex = i;
						}
					}
				}
			}
			return workingIndex;
		}

		// Token: 0x06006E58 RID: 28248 RVA: 0x003ED088 File Offset: 0x003EB288
		public int SelectMedicineIndexForWug([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines, sbyte wugType, short remainingDuration, List<ItemKey> selections = null)
		{
			bool hasSelections = selections != null;
			bool flag = hasSelections;
			if (flag)
			{
				selections.Clear();
			}
			int workingIndex = -1;
			for (int i = 0; i < medicines.Count; i++)
			{
				ValueTuple<GameData.Domains.Item.Medicine, int> medicine = medicines[i];
				bool flag2 = EMedicineEffectSubTypeExtension.DetoxWugType(medicine.Item1.GetEffectType(), medicine.Item1.GetSideEffectValue()) != wugType;
				if (!flag2)
				{
					bool flag3 = this.TryDetectAttachedPoisons(medicine.Item1.GetItemKey());
					if (!flag3)
					{
						bool flag4 = hasSelections;
						if (flag4)
						{
							selections.Add(medicine.Item1.GetItemKey());
						}
						short deltaDuration = GameData.Domains.Item.Medicine.GetDeltaWugDuration(medicine.Item1.GetGrade());
						bool flag5 = remainingDuration + deltaDuration <= 0;
						if (flag5)
						{
							return i;
						}
						workingIndex = i;
					}
				}
			}
			return workingIndex;
		}

		// Token: 0x06006E59 RID: 28249 RVA: 0x003ED164 File Offset: 0x003EB364
		public static int SelectPoisonIndexForWug([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.Medicine, int>> poisons, sbyte wugType, short remainingDuration, List<ItemKey> selections = null)
		{
			bool hasSelections = selections != null;
			bool flag = hasSelections;
			if (flag)
			{
				selections.Clear();
			}
			int workingIndex = -1;
			for (int i = 0; i < poisons.Count; i++)
			{
				ValueTuple<GameData.Domains.Item.Medicine, int> medicine = poisons[i];
				bool flag2 = EMedicineEffectSubTypeExtension.DetoxWugType(medicine.Item1.GetEffectType(), medicine.Item1.GetSideEffectValue()) != wugType;
				if (!flag2)
				{
					bool flag3 = hasSelections;
					if (flag3)
					{
						selections.Add(medicine.Item1.GetItemKey());
					}
					short deltaDuration = GameData.Domains.Item.Medicine.GetDeltaWugDuration(medicine.Item1.GetGrade());
					bool flag4 = remainingDuration + deltaDuration <= 0;
					if (flag4)
					{
						return i;
					}
					workingIndex = i;
				}
			}
			return workingIndex;
		}

		// Token: 0x06006E5A RID: 28250 RVA: 0x003ED220 File Offset: 0x003EB420
		public int SelectMedicineIndexForQiDisorder([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines, short disorderOfQi, List<ItemKey> selections = null)
		{
			bool hasSelections = selections != null;
			bool flag = hasSelections;
			if (flag)
			{
				selections.Clear();
			}
			int workingIndex = -1;
			for (int index = 0; index < medicines.Count; index++)
			{
				ValueTuple<GameData.Domains.Item.Medicine, int> medicine = medicines[index];
				bool flag2 = this.TryDetectAttachedPoisons(medicine.Item1.GetItemKey());
				if (!flag2)
				{
					bool flag3 = hasSelections;
					if (flag3)
					{
						selections.Add(medicine.Item1.GetItemKey());
					}
					int delta = this.CalcMedicineEffectDelta((int)disorderOfQi, medicine.Item1.GetEffectValue(), medicine.Item1.GetEffectSubType().IsPercentage());
					bool flag4 = (int)disorderOfQi + delta <= (int)DisorderLevelOfQi.MinValue;
					if (flag4)
					{
						return index;
					}
					workingIndex = index;
				}
			}
			return workingIndex;
		}

		// Token: 0x06006E5B RID: 28251 RVA: 0x003ED2E8 File Offset: 0x003EB4E8
		public int SelectMedicineIndexForHealth([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.Medicine, int>> medicines, short health, short leftMaxHealth, List<ItemKey> selections = null)
		{
			bool hasSelections = selections != null;
			bool flag = hasSelections;
			if (flag)
			{
				selections.Clear();
			}
			int workingIndex = -1;
			for (int index = 0; index < medicines.Count; index++)
			{
				ValueTuple<GameData.Domains.Item.Medicine, int> medicine = medicines[index];
				bool flag2 = this.TryDetectAttachedPoisons(medicine.Item1.GetItemKey());
				if (!flag2)
				{
					bool flag3 = hasSelections;
					if (flag3)
					{
						selections.Add(medicine.Item1.GetItemKey());
					}
					int delta = this.CalcMedicineEffectDelta((int)(leftMaxHealth - health), medicine.Item1.GetEffectValue(), medicine.Item1.GetEffectSubType().IsPercentage());
					bool flag4 = (int)health + delta >= (int)leftMaxHealth;
					if (flag4)
					{
						return index;
					}
					workingIndex = index;
				}
			}
			return workingIndex;
		}

		// Token: 0x06006E5C RID: 28252 RVA: 0x003ED3B0 File Offset: 0x003EB5B0
		public int SelectItemIndexForNeili([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.Misc, int>> items, int currNeili, int maxNeili, List<ItemKey> selections = null)
		{
			bool hasSelections = selections != null;
			bool flag = hasSelections;
			if (flag)
			{
				selections.Clear();
			}
			int workingIndex = -1;
			for (int index = 0; index < items.Count; index++)
			{
				ValueTuple<GameData.Domains.Item.Misc, int> misc = items[index];
				bool flag2 = this.TryDetectAttachedPoisons(misc.Item1.GetItemKey());
				if (!flag2)
				{
					bool flag3 = hasSelections;
					if (flag3)
					{
						selections.Add(misc.Item1.GetItemKey());
					}
					bool flag4 = currNeili + (int)misc.Item1.GetNeili() >= maxNeili;
					if (flag4)
					{
						return index;
					}
					workingIndex = index;
				}
			}
			return workingIndex;
		}

		// Token: 0x06006E5D RID: 28253 RVA: 0x003ED454 File Offset: 0x003EB654
		public unsafe int SelectFoodIndexForMainAttributes([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.Food, int>> foods, sbyte attrType, short currAttr, short maxAttr, bool allowMeat, List<ItemKey> selections = null)
		{
			bool hasSelections = selections != null;
			bool flag = hasSelections;
			if (flag)
			{
				selections.Clear();
			}
			int workingIndex = -1;
			for (int index = 0; index < foods.Count; index++)
			{
				ValueTuple<GameData.Domains.Item.Food, int> food = foods[index];
				FoodItem config = Config.Food.Instance[food.Item1.GetTemplateId()];
				bool flag2 = !allowMeat && config.ItemSubType == 701;
				if (!flag2)
				{
					bool flag3 = this.TryDetectAttachedPoisons(food.Item1.GetItemKey());
					if (!flag3)
					{
						bool flag4 = hasSelections;
						if (flag4)
						{
							selections.Add(food.Item1.GetItemKey());
						}
						bool flag5 = currAttr + *(ref config.MainAttributesRegen.Items.FixedElementField + (IntPtr)attrType * 2) >= maxAttr;
						if (flag5)
						{
							return index;
						}
						workingIndex = index;
					}
				}
			}
			return workingIndex;
		}

		// Token: 0x06006E5E RID: 28254 RVA: 0x003ED540 File Offset: 0x003EB740
		public int SelectTeaWineForHappiness([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<GameData.Domains.Item.TeaWine, int>> teaWines, int currHappiness, int targetHappiness, bool allowWines, List<ItemKey> selections = null)
		{
			bool hasSelections = selections != null;
			bool flag = hasSelections;
			if (flag)
			{
				selections.Clear();
			}
			int workingIndex = -1;
			for (int index = 0; index < teaWines.Count; index++)
			{
				ValueTuple<GameData.Domains.Item.TeaWine, int> teaWine = teaWines[index];
				TeaWineItem config = Config.TeaWine.Instance[teaWine.Item1.GetTemplateId()];
				bool flag2 = !allowWines && config.ItemSubType == 901;
				if (!flag2)
				{
					bool flag3 = this.TryDetectAttachedPoisons(teaWine.Item1.GetItemKey());
					if (!flag3)
					{
						bool flag4 = hasSelections;
						if (flag4)
						{
							selections.Add(teaWine.Item1.GetItemKey());
						}
						bool flag5 = currHappiness + (int)teaWine.Item1.GetHappinessChange() >= targetHappiness;
						if (flag5)
						{
							return index;
						}
						workingIndex = index;
					}
				}
			}
			return workingIndex;
		}

		// Token: 0x06006E5F RID: 28255 RVA: 0x003ED620 File Offset: 0x003EB820
		private bool TripleStartRelationChance(short aiRelationsTemplateId)
		{
			Location tripleAdoreLocation = DomainManager.Character.TripleAdoreLocation;
			Location tripleHateLocation = DomainManager.Character.TripleHateLocation;
			bool flag = aiRelationsTemplateId == 2 && tripleAdoreLocation.IsValid() && tripleAdoreLocation.AreaId == this._location.AreaId;
			bool result;
			if (flag)
			{
				byte areaData = DomainManager.Map.GetAreaSize(this._location.AreaId);
				ByteCoordinate tripleAdoreCoordinate = ByteCoordinate.IndexToCoordinate(tripleAdoreLocation.BlockId, areaData);
				ByteCoordinate selfCoordinate = ByteCoordinate.IndexToCoordinate(this._location.BlockId, areaData);
				result = (tripleAdoreCoordinate.GetManhattanDistance(selfCoordinate) <= 2);
			}
			else
			{
				bool flag2 = aiRelationsTemplateId == 0 && tripleHateLocation.IsValid() && tripleHateLocation.AreaId == this._location.AreaId;
				if (flag2)
				{
					byte areaData2 = DomainManager.Map.GetAreaSize(this._location.AreaId);
					ByteCoordinate tripleHateCoordinate = ByteCoordinate.IndexToCoordinate(tripleHateLocation.BlockId, areaData2);
					ByteCoordinate selfCoordinate2 = ByteCoordinate.IndexToCoordinate(this._location.BlockId, areaData2);
					result = (tripleHateCoordinate.GetManhattanDistance(selfCoordinate2) <= 2);
				}
				else
				{
					result = false;
				}
			}
			return result;
		}

		// Token: 0x06006E60 RID: 28256 RVA: 0x003ED734 File Offset: 0x003EB934
		private Character GetStartOrEndRelationTarget(IRandomSource random, short aiRelationsTemplateId, List<int> selectableChars, ref Personalities selfPersonalities)
		{
			bool flag = selectableChars.Count == 0;
			Character result;
			if (flag)
			{
				result = null;
			}
			else
			{
				int multiplier = this.TripleStartRelationChance(aiRelationsTemplateId) ? 3 : 1;
				AiRelationsItem relationCfg = AiHelper.Relation.GetAiRelationConfig(aiRelationsTemplateId);
				bool flag2 = !AiHelper.Relation.CheckChangeRelationTypeChance(random, ref selfPersonalities, relationCfg.PersonalityType, multiplier);
				if (flag2)
				{
					result = null;
				}
				else
				{
					int targetCharId = selectableChars.GetRandom(random);
					Character targetChar = DomainManager.Character.GetElement_Objects(targetCharId);
					RelatedCharacter relation = DomainManager.Character.GetRelation(this._id, targetCharId);
					sbyte sectFavorability = DomainManager.Organization.GetSectFavorability(this._organizationInfo.OrgTemplateId, targetChar.GetOrganizationInfo().OrgTemplateId);
					int triggerRate = AiHelper.Relation.GetStartOrEndRelationChance(relationCfg, this, targetChar, relation.RelationType, sectFavorability, multiplier);
					result = (random.CheckProb(triggerRate, 10000) ? targetChar : null);
				}
			}
			return result;
		}

		// Token: 0x06006E61 RID: 28257 RVA: 0x003ED804 File Offset: 0x003EBA04
		private Character GetStartAdoptiveParentRelationTarget(IRandomSource random, short aiRelationsTemplateId, List<int> selectableChars, ref Personalities selfPersonalities)
		{
			bool flag = selectableChars.Count == 0;
			Character result;
			if (flag)
			{
				result = null;
			}
			else
			{
				AiRelationsItem relationCfg = AiHelper.Relation.GetAiRelationConfig(aiRelationsTemplateId);
				bool flag2 = !AiHelper.Relation.CheckChangeRelationTypeChance(random, ref selfPersonalities, relationCfg.PersonalityType, 1);
				if (flag2)
				{
					result = null;
				}
				else
				{
					int targetCharId = selectableChars.GetRandom(random);
					Character targetChar = DomainManager.Character.GetElement_Objects(targetCharId);
					RelatedCharacter relation = DomainManager.Character.GetRelation(targetCharId, this._id);
					int triggerProb = (int)(targetChar.GetCurrAge() - this._currAge);
					triggerProb += (int)((targetChar.GetInteractionGrade() - this.GetInteractionGrade()) * 3);
					triggerProb += (int)((FavorabilityType.GetFavorabilityType(relation.Favorability) - 4) * 5);
					result = (random.CheckPercentProb(triggerProb) ? targetChar : null);
				}
			}
			return result;
		}

		// Token: 0x06006E62 RID: 28258 RVA: 0x003ED8C0 File Offset: 0x003EBAC0
		private Character GetStartAdoptiveChildRelationTarget(IRandomSource random, short aiRelationsTemplateId, List<int> selectableChars, ref Personalities selfPersonalities)
		{
			bool flag = selectableChars.Count == 0;
			Character result;
			if (flag)
			{
				result = null;
			}
			else
			{
				AiRelationsItem relationCfg = AiHelper.Relation.GetAiRelationConfig(aiRelationsTemplateId);
				bool flag2 = !AiHelper.Relation.CheckChangeRelationTypeChance(random, ref selfPersonalities, relationCfg.PersonalityType, 1);
				if (flag2)
				{
					result = null;
				}
				else
				{
					int targetCharId = selectableChars.GetRandom(random);
					Character targetChar = DomainManager.Character.GetElement_Objects(targetCharId);
					RelatedCharacter relation = DomainManager.Character.GetRelation(targetCharId, this._id);
					int triggerProb = (int)(this._currAge - targetChar.GetCurrAge());
					triggerProb += (int)((this.GetInteractionGrade() - targetChar.GetInteractionGrade()) * 3);
					triggerProb += (int)((FavorabilityType.GetFavorabilityType(relation.Favorability) - 4) * 5);
					result = (random.CheckPercentProb(triggerProb) ? targetChar : null);
				}
			}
			return result;
		}

		// Token: 0x06006E63 RID: 28259 RVA: 0x003ED97C File Offset: 0x003EBB7C
		public void PeriAdvanceMonth_RelationsUpdate(DataContext context, HashSet<int> charSet)
		{
			bool flag = this.GetAgeGroup() == 0;
			if (!flag)
			{
				bool flag2 = DomainManager.LegendaryBook.IsCharacterActingCrazy(this);
				if (!flag2)
				{
					PeriAdvanceMonthRelationsUpdateModification mod = new PeriAdvanceMonthRelationsUpdateModification(this);
					bool isChanged = false;
					List<Character> newlyMetCharacters = new List<Character>();
					PotentialRelatedCharacters canStartRelationChars = context.AdvanceMonthRelatedData.CurrBlockCanStartRelationChars.Occupy();
					PotentialRelatedCharacters canEndRelationChars = context.AdvanceMonthRelatedData.CurrBlockCanEndRelationChars.Occupy();
					DomainManager.Character.GetPotentialRelatedCharactersInSet(canStartRelationChars, canEndRelationChars, newlyMetCharacters, this, charSet);
					bool flag3 = newlyMetCharacters.Count != 0;
					if (flag3)
					{
						mod.NewlyMetCharacters = newlyMetCharacters;
						isChanged = true;
					}
					Personalities personalities = this.GetPersonalities();
					IRandomSource random = context.Random;
					Character targetChar = this.GetStartOrEndRelationTarget(random, 0, canStartRelationChars.Enemies, ref personalities);
					bool flag4 = targetChar != null;
					if (flag4)
					{
						isChanged = true;
						sbyte targetBehaviorType = targetChar.GetBehaviorType();
						bool targetHateBack = random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.SeverEnemyNotMutuallyChance[(int)targetBehaviorType]);
						PeriAdvanceMonthRelationsUpdateModification periAdvanceMonthRelationsUpdateModification = mod;
						if (periAdvanceMonthRelationsUpdateModification.NewRegularRelations == null)
						{
							periAdvanceMonthRelationsUpdateModification.NewRegularRelations = new List<ValueTuple<Character, ushort, bool>>();
						}
						mod.NewRegularRelations.Add(new ValueTuple<Character, ushort, bool>(targetChar, 32768, targetHateBack));
					}
					targetChar = this.GetStartOrEndRelationTarget(random, 1, canEndRelationChars.Enemies, ref personalities);
					bool flag5 = targetChar != null;
					if (flag5)
					{
						isChanged = true;
						sbyte targetBehaviorType2 = targetChar.GetBehaviorType();
						bool targetStillHateSelf = random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.SeverEnemyNotMutuallyChance[(int)targetBehaviorType2]);
						PeriAdvanceMonthRelationsUpdateModification periAdvanceMonthRelationsUpdateModification = mod;
						if (periAdvanceMonthRelationsUpdateModification.RemovedRegularRelations == null)
						{
							periAdvanceMonthRelationsUpdateModification.RemovedRegularRelations = new List<ValueTuple<Character, ushort, bool>>();
						}
						mod.RemovedRegularRelations.Add(new ValueTuple<Character, ushort, bool>(targetChar, 32768, targetStillHateSelf));
					}
					targetChar = this.GetStartOrEndRelationTarget(random, 2, canStartRelationChars.Adored, ref personalities);
					bool flag6 = targetChar != null;
					if (flag6)
					{
						RelatedCharacter selfToTarget = DomainManager.Character.GetRelation(this._id, targetChar.GetId());
						RelatedCharacter targetToSelf = DomainManager.Character.GetRelation(targetChar.GetId(), this._id);
						int successRate = AiHelper.Relation.GetStartRelationSuccessRate_Adored(this, targetChar, selfToTarget, targetToSelf);
						bool flag7 = random.CheckProb(successRate, 100);
						if (flag7)
						{
							isChanged = true;
							int targetLovesBackRate = AiHelper.Relation.GetStartRelationSuccessRate_Adored(targetChar, this, selfToTarget, targetToSelf);
							PeriAdvanceMonthRelationsUpdateModification periAdvanceMonthRelationsUpdateModification = mod;
							if (periAdvanceMonthRelationsUpdateModification.NewRegularRelations == null)
							{
								periAdvanceMonthRelationsUpdateModification.NewRegularRelations = new List<ValueTuple<Character, ushort, bool>>();
							}
							mod.NewRegularRelations.Add(new ValueTuple<Character, ushort, bool>(targetChar, 16384, random.CheckPercentProb(targetLovesBackRate)));
						}
					}
					targetChar = this.GetStartOrEndRelationTarget(random, 3, canStartRelationChars.BoyAndGirlFriends, ref personalities);
					bool flag8 = targetChar != null;
					if (flag8)
					{
						isChanged = true;
						RelatedCharacter selfToTarget2 = DomainManager.Character.GetRelation(this._id, targetChar.GetId());
						RelatedCharacter targetToSelf2 = DomainManager.Character.GetRelation(targetChar.GetId(), this._id);
						int successRate2 = AiHelper.Relation.GetStartRelationSuccessRate_BoyOrGirlFriend(this, targetChar, selfToTarget2, targetToSelf2, false);
						mod.NewBoyOrGirlFriend = new ValueTuple<Character, bool>(targetChar, random.CheckPercentProb(successRate2));
					}
					targetChar = this.GetStartOrEndRelationTarget(random, 4, canEndRelationChars.BoyAndGirlFriends, ref personalities);
					bool flag9 = targetChar != null;
					if (flag9)
					{
						isChanged = true;
						sbyte targetBehaviorType3 = targetChar.GetBehaviorType();
						bool targetStillLoveSelf = !random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.BreakupMutuallyChance[(int)targetBehaviorType3]);
						PeriAdvanceMonthRelationsUpdateModification periAdvanceMonthRelationsUpdateModification = mod;
						if (periAdvanceMonthRelationsUpdateModification.RemovedRegularRelations == null)
						{
							periAdvanceMonthRelationsUpdateModification.RemovedRegularRelations = new List<ValueTuple<Character, ushort, bool>>();
						}
						mod.RemovedRegularRelations.Add(new ValueTuple<Character, ushort, bool>(targetChar, 16384, targetStillLoveSelf));
					}
					targetChar = this.GetStartOrEndRelationTarget(random, 5, canStartRelationChars.HusbandsAndWives, ref personalities);
					bool flag10 = targetChar != null;
					if (flag10)
					{
						isChanged = true;
						RelatedCharacter selfToTarget3 = DomainManager.Character.GetRelation(this._id, targetChar.GetId());
						RelatedCharacter targetToSelf3 = DomainManager.Character.GetRelation(targetChar.GetId(), this._id);
						int successRate3 = AiHelper.Relation.GetStartRelationSuccessRate_HusbandOrWife(this, targetChar, selfToTarget3, targetToSelf3);
						PeriAdvanceMonthRelationsUpdateModification periAdvanceMonthRelationsUpdateModification = mod;
						if (periAdvanceMonthRelationsUpdateModification.NewRegularRelations == null)
						{
							periAdvanceMonthRelationsUpdateModification.NewRegularRelations = new List<ValueTuple<Character, ushort, bool>>();
						}
						mod.NewRegularRelations.Add(new ValueTuple<Character, ushort, bool>(targetChar, 1024, random.CheckProb(successRate3, 100)));
					}
					targetChar = this.GetStartOrEndRelationTarget(random, 12, canEndRelationChars.HusbandsAndWives, ref personalities);
					bool flag11 = targetChar != null;
					if (flag11)
					{
						isChanged = true;
						PeriAdvanceMonthRelationsUpdateModification periAdvanceMonthRelationsUpdateModification = mod;
						if (periAdvanceMonthRelationsUpdateModification.RemovedRegularRelations == null)
						{
							periAdvanceMonthRelationsUpdateModification.RemovedRegularRelations = new List<ValueTuple<Character, ushort, bool>>();
						}
						mod.RemovedRegularRelations.Add(new ValueTuple<Character, ushort, bool>(targetChar, 1024, false));
					}
					targetChar = this.GetStartOrEndRelationTarget(random, 6, canStartRelationChars.Friends, ref personalities);
					bool flag12 = targetChar != null;
					if (flag12)
					{
						isChanged = true;
						PeriAdvanceMonthRelationsUpdateModification periAdvanceMonthRelationsUpdateModification = mod;
						if (periAdvanceMonthRelationsUpdateModification.NewRegularRelations == null)
						{
							periAdvanceMonthRelationsUpdateModification.NewRegularRelations = new List<ValueTuple<Character, ushort, bool>>();
						}
						mod.NewRegularRelations.Add(new ValueTuple<Character, ushort, bool>(targetChar, 8192, true));
					}
					targetChar = this.GetStartOrEndRelationTarget(random, 7, canEndRelationChars.Friends, ref personalities);
					bool flag13 = targetChar != null;
					if (flag13)
					{
						isChanged = true;
						PeriAdvanceMonthRelationsUpdateModification periAdvanceMonthRelationsUpdateModification = mod;
						if (periAdvanceMonthRelationsUpdateModification.RemovedRegularRelations == null)
						{
							periAdvanceMonthRelationsUpdateModification.RemovedRegularRelations = new List<ValueTuple<Character, ushort, bool>>();
						}
						mod.RemovedRegularRelations.Add(new ValueTuple<Character, ushort, bool>(targetChar, 8192, false));
					}
					targetChar = this.GetStartOrEndRelationTarget(random, 8, canStartRelationChars.SwornBrothersAndSisters, ref personalities);
					bool flag14 = targetChar != null;
					if (flag14)
					{
						isChanged = true;
						PeriAdvanceMonthRelationsUpdateModification periAdvanceMonthRelationsUpdateModification = mod;
						if (periAdvanceMonthRelationsUpdateModification.NewRegularRelations == null)
						{
							periAdvanceMonthRelationsUpdateModification.NewRegularRelations = new List<ValueTuple<Character, ushort, bool>>();
						}
						mod.NewRegularRelations.Add(new ValueTuple<Character, ushort, bool>(targetChar, 512, true));
					}
					targetChar = this.GetStartOrEndRelationTarget(random, 9, canEndRelationChars.SwornBrothersAndSisters, ref personalities);
					bool flag15 = targetChar != null;
					if (flag15)
					{
						isChanged = true;
						PeriAdvanceMonthRelationsUpdateModification periAdvanceMonthRelationsUpdateModification = mod;
						if (periAdvanceMonthRelationsUpdateModification.RemovedRegularRelations == null)
						{
							periAdvanceMonthRelationsUpdateModification.RemovedRegularRelations = new List<ValueTuple<Character, ushort, bool>>();
						}
						mod.RemovedRegularRelations.Add(new ValueTuple<Character, ushort, bool>(targetChar, 512, false));
					}
					targetChar = this.GetStartAdoptiveParentRelationTarget(random, 10, canStartRelationChars.AdoptiveParents, ref personalities);
					bool flag16 = targetChar != null;
					if (flag16)
					{
						isChanged = true;
						PeriAdvanceMonthRelationsUpdateModification periAdvanceMonthRelationsUpdateModification = mod;
						if (periAdvanceMonthRelationsUpdateModification.NewRegularRelations == null)
						{
							periAdvanceMonthRelationsUpdateModification.NewRegularRelations = new List<ValueTuple<Character, ushort, bool>>();
						}
						mod.NewRegularRelations.Add(new ValueTuple<Character, ushort, bool>(targetChar, 64, true));
					}
					targetChar = this.GetStartAdoptiveChildRelationTarget(random, 11, canStartRelationChars.AdoptiveChildren, ref personalities);
					bool flag17 = targetChar != null;
					if (flag17)
					{
						isChanged = true;
						PeriAdvanceMonthRelationsUpdateModification periAdvanceMonthRelationsUpdateModification = mod;
						if (periAdvanceMonthRelationsUpdateModification.NewRegularRelations == null)
						{
							periAdvanceMonthRelationsUpdateModification.NewRegularRelations = new List<ValueTuple<Character, ushort, bool>>();
						}
						mod.NewRegularRelations.Add(new ValueTuple<Character, ushort, bool>(targetChar, 128, true));
					}
					bool flag18 = isChanged;
					if (flag18)
					{
						ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
						recorder.RecordType(ParallelModificationType.PeriAdvanceMonthRelationsUpdate);
						recorder.RecordParameterClass<PeriAdvanceMonthRelationsUpdateModification>(mod);
					}
					context.AdvanceMonthRelatedData.CurrBlockCanStartRelationChars.Release(ref canStartRelationChars);
					context.AdvanceMonthRelatedData.CurrBlockCanEndRelationChars.Release(ref canEndRelationChars);
				}
			}
		}

		// Token: 0x06006E64 RID: 28260 RVA: 0x003EDFD8 File Offset: 0x003EC1D8
		public static void ComplementPeriAdvanceMonth_RelationsUpdate(DataContext context, PeriAdvanceMonthRelationsUpdateModification mod)
		{
			Character character = mod.Character;
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int charId = character.GetId();
			sbyte charBehaviorType = character.GetBehaviorType();
			bool charIsTaiwuPeople = DomainManager.Character.IsTaiwuPeople(charId);
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			Location taiwuLocation = DomainManager.Taiwu.GetTaiwu().GetLocation();
			sbyte taiwuGender = DomainManager.Taiwu.GetTaiwu().GetGender();
			bool flag = mod.NewlyMetCharacters != null;
			if (flag)
			{
				foreach (Character targetChar in mod.NewlyMetCharacters)
				{
					DomainManager.Character.TryCreateGeneralRelation(context, character, targetChar);
				}
			}
			bool flag2 = mod.NewRegularRelations != null;
			if (flag2)
			{
				foreach (ValueTuple<Character, ushort, bool> valueTuple in mod.NewRegularRelations)
				{
					Character targetChar2 = valueTuple.Item1;
					ushort relationType = valueTuple.Item2;
					bool succeed = valueTuple.Item3;
					bool targetIsTaiwuPeople = DomainManager.Character.IsTaiwuPeople(targetChar2._id);
					ushort num = relationType;
					ushort num2 = num;
					if (num2 <= 512)
					{
						if (num2 != 64)
						{
							if (num2 != 128)
							{
								if (num2 != 512)
								{
									goto IL_33E;
								}
								bool flag3 = targetChar2._id == taiwuCharId;
								if (flag3)
								{
									monthlyEventCollection.AddBecomeSwornBrotherOrSister(charId, taiwuLocation, taiwuCharId);
								}
								else
								{
									Character.ApplyBecomeSwornBrotherOrSister(context, character, targetChar2, charBehaviorType, charIsTaiwuPeople, targetIsTaiwuPeople);
								}
							}
							else
							{
								bool flag4 = targetChar2._id == taiwuCharId;
								if (flag4)
								{
									bool flag5 = taiwuGender == 0;
									if (flag5)
									{
										monthlyEventCollection.AddAdoptDaughter(charId, taiwuLocation, taiwuCharId);
									}
									else
									{
										monthlyEventCollection.AddAdoptSon(charId, taiwuLocation, taiwuCharId);
									}
								}
								else
								{
									Character.ApplyAddRelation_AdoptiveChild(context, character, targetChar2, charBehaviorType, charIsTaiwuPeople, targetIsTaiwuPeople);
								}
							}
						}
						else
						{
							bool flag6 = targetChar2._id == taiwuCharId;
							if (flag6)
							{
								bool flag7 = taiwuGender == 0;
								if (flag7)
								{
									monthlyEventCollection.AddGetAdoptedByMother(charId, taiwuLocation, taiwuCharId);
								}
								else
								{
									monthlyEventCollection.AddGetAdoptedByFather(charId, taiwuLocation, taiwuCharId);
								}
							}
							else
							{
								Character.ApplyAddRelation_AdoptiveParent(context, character, targetChar2, charBehaviorType, charIsTaiwuPeople, targetIsTaiwuPeople);
							}
						}
					}
					else if (num2 <= 8192)
					{
						if (num2 != 1024)
						{
							if (num2 != 8192)
							{
								goto IL_33E;
							}
							bool flag8 = targetChar2._id == taiwuCharId;
							if (flag8)
							{
								monthlyEventCollection.AddBecomeFriend(charId, taiwuLocation, taiwuCharId);
							}
							else
							{
								Character.ApplyBecomeFriend(context, character, targetChar2, charBehaviorType, charIsTaiwuPeople, targetIsTaiwuPeople);
							}
						}
						else
						{
							bool flag9 = targetChar2._id == taiwuCharId;
							if (flag9)
							{
								monthlyEventCollection.AddProposeMarriage(charId, taiwuLocation, taiwuCharId);
							}
							else
							{
								Character.ApplyBecomeHusbandOrWife(context, character, targetChar2, charBehaviorType, succeed, charIsTaiwuPeople, targetIsTaiwuPeople);
							}
						}
					}
					else if (num2 != 16384)
					{
						if (num2 != 32768)
						{
							goto IL_33E;
						}
						bool flag10 = targetChar2._id == taiwuCharId;
						if (flag10)
						{
							monthlyEventCollection.AddMakeEnemy(charId, taiwuLocation, taiwuCharId);
						}
						else
						{
							Character.ApplyAddRelation_Enemy(context, character, targetChar2, charIsTaiwuPeople, 0);
							bool flag11 = succeed;
							if (flag11)
							{
								Character.ApplyAddRelation_Enemy(context, targetChar2, character, targetIsTaiwuPeople, 0);
							}
						}
					}
					else
					{
						bool flag12 = targetChar2._id == taiwuCharId;
						if (flag12)
						{
							monthlyEventCollection.AddAdore(charId, taiwuLocation, taiwuCharId);
						}
						else
						{
							Character.ApplyAddRelation_Adore(context, character, targetChar2, charBehaviorType, succeed, charIsTaiwuPeople, targetIsTaiwuPeople);
						}
					}
					continue;
					IL_33E:
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(65, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Given relation type cannot be handled as a regular relation type ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(relationType);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
			bool flag13 = mod.RemovedRegularRelations != null;
			if (flag13)
			{
				foreach (ValueTuple<Character, ushort, bool> valueTuple2 in mod.RemovedRegularRelations)
				{
					Character targetChar3 = valueTuple2.Item1;
					ushort relationType2 = valueTuple2.Item2;
					bool targetStillHasRelation = valueTuple2.Item3;
					bool targetIsTaiwuPeople2 = DomainManager.Character.IsTaiwuPeople(targetChar3._id);
					ushort num3 = relationType2;
					ushort num4 = num3;
					if (num4 <= 1024)
					{
						if (num4 != 512)
						{
							if (num4 != 1024)
							{
								goto IL_551;
							}
							bool flag14 = targetChar3._id == taiwuCharId;
							if (!flag14)
							{
								Character.ApplySeverHusbandOrWife(context, character, targetChar3, charBehaviorType, charIsTaiwuPeople, targetIsTaiwuPeople2);
							}
						}
						else
						{
							bool flag15 = targetChar3._id == taiwuCharId;
							if (flag15)
							{
								monthlyEventCollection.AddSeverSwornBrotherhood(charId, taiwuLocation, taiwuCharId);
							}
							else
							{
								Character.ApplySeverSwornBrotherOrSister(context, character, targetChar3, charBehaviorType, charIsTaiwuPeople, targetIsTaiwuPeople2);
							}
						}
					}
					else if (num4 != 8192)
					{
						if (num4 != 16384)
						{
							if (num4 != 32768)
							{
								goto IL_551;
							}
							bool flag16 = targetChar3._id == taiwuCharId;
							if (flag16)
							{
								monthlyEventCollection.AddSeverEnemy(charId, taiwuLocation, taiwuCharId);
							}
							else
							{
								Character.ApplySeverEnemy(context, character, targetChar3, charBehaviorType, charIsTaiwuPeople);
								bool flag17 = !targetStillHasRelation;
								if (flag17)
								{
									Character.ApplySeverEnemy(context, targetChar3, character, targetChar3.GetBehaviorType(), targetIsTaiwuPeople2);
								}
							}
						}
						else
						{
							bool flag18 = targetChar3._id == taiwuCharId;
							if (flag18)
							{
								monthlyEventCollection.AddBreakup(charId, taiwuLocation, taiwuCharId);
							}
							else
							{
								Character.ApplyBreakupWithBoyOrGirlFriend(context, character, targetChar3, charBehaviorType, targetStillHasRelation, charIsTaiwuPeople, targetIsTaiwuPeople2);
							}
						}
					}
					else
					{
						bool flag19 = targetChar3._id == taiwuCharId;
						if (flag19)
						{
							monthlyEventCollection.AddSeverFriendship(charId, taiwuLocation, taiwuCharId);
						}
						else
						{
							Character.ApplySeverFriend(context, character, targetChar3, charBehaviorType, charIsTaiwuPeople, targetIsTaiwuPeople2);
						}
					}
					continue;
					IL_551:
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(65, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Given relation type cannot be handled as a regular relation type ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(relationType2);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
			bool flag20 = mod.NewBoyOrGirlFriend.Item1 != null;
			if (flag20)
			{
				ValueTuple<Character, bool> newBoyOrGirlFriend = mod.NewBoyOrGirlFriend;
				Character targetChar4 = newBoyOrGirlFriend.Item1;
				bool succeed2 = newBoyOrGirlFriend.Item2;
				bool flag21 = targetChar4._id == taiwuCharId;
				if (flag21)
				{
					monthlyEventCollection.AddConfess(charId, taiwuLocation, taiwuCharId);
				}
				else
				{
					bool targetIsTaiwuPeople3 = DomainManager.Character.IsTaiwuPeople(targetChar4._id);
					Character.ApplyBecomeBoyOrGirlFriend(context, character, targetChar4, charBehaviorType, succeed2, charIsTaiwuPeople, targetIsTaiwuPeople3);
				}
			}
		}

		// Token: 0x06006E65 RID: 28261 RVA: 0x003EE640 File Offset: 0x003EC840
		public static void ApplyAddRelation_Enemy(DataContext context, Character selfChar, Character targetChar, bool selfIsTaiwuPeople, short becomeEnemyType)
		{
			CharacterBecomeEnemyInfo becomeEnemyInfo = new CharacterBecomeEnemyInfo(selfChar);
			Character.ApplyAddRelation_Enemy(context, selfChar, targetChar, selfIsTaiwuPeople, becomeEnemyType, becomeEnemyInfo);
		}

		// Token: 0x06006E66 RID: 28262 RVA: 0x003EE664 File Offset: 0x003EC864
		public static void ApplyAddRelation_Enemy(DataContext context, Character selfChar, Character targetChar, bool selfIsTaiwuPeople, short becomeEnemyType, CharacterBecomeEnemyInfo becomeEnemyInfo)
		{
			bool flag = !RelationTypeHelper.AllowAddingEnemyRelation(selfChar._id, targetChar._id);
			if (!flag)
			{
				int currDate = DomainManager.World.GetCurrDate();
				Location location = selfChar._location;
				bool flag2 = !location.IsValid();
				if (flag2)
				{
					location = targetChar._location;
				}
				DomainManager.Character.AddRelation(context, selfChar._id, targetChar._id, 32768, currDate);
				sbyte charBehaviorType = selfChar.GetBehaviorType();
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.BecomeEnemyHappinessChange[(int)charBehaviorType]);
				BecomeEnemyTypeItem becomeEnemyCfg = BecomeEnemyType.Instance[becomeEnemyType];
				LifeRecordCollection collection = DomainManager.LifeRecord.GetLifeRecordCollection();
				collection.AddBecomeEnemyRecord(selfChar, targetChar, becomeEnemyCfg, ref becomeEnemyInfo);
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddBecomeEnemy(selfChar._id, targetChar._id);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				if (selfIsTaiwuPeople)
				{
					DomainManager.World.GetMonthlyNotificationCollection().AddCreateHatred(selfChar._id, location, targetChar._id);
					DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), selfChar._id);
				}
			}
		}

		// Token: 0x06006E67 RID: 28263 RVA: 0x003EE78C File Offset: 0x003EC98C
		public static void ApplySeverEnemy(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople)
		{
			int currDate = DomainManager.World.GetCurrDate();
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !DomainManager.Character.HasRelation(charId, targetCharId, 32768);
			if (!flag)
			{
				Location location = selfChar._location;
				DomainManager.Character.ChangeRelationType(context, charId, targetCharId, 32768, 0);
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.SeverEnemyHappinessChange[(int)charBehaviorType]);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, 3000);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, 3000);
				DomainManager.LifeRecord.GetLifeRecordCollection().AddSeverEnemy(charId, currDate, targetCharId, location);
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddSeverEnemy(selfChar._id, targetChar._id);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				if (selfIsTaiwuPeople)
				{
					DomainManager.World.GetMonthlyNotificationCollection().AddDecreaseHatred(charId, location, targetCharId);
					DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), selfChar._id);
				}
			}
		}

		// Token: 0x06006E68 RID: 28264 RVA: 0x003EE8A4 File Offset: 0x003ECAA4
		public static void ApplyBecomeFriend(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !RelationTypeHelper.AllowAddingFriendRelation(targetCharId, charId);
			if (!flag)
			{
				sbyte targetCharBehaviorType = targetChar.GetBehaviorType();
				Location location = selfChar._location;
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				DomainManager.Character.AddRelation(context, charId, targetCharId, 8192, currDate);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, 3000);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, 3000);
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.BecomeFriendHappinessChange[(int)charBehaviorType]);
				targetChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.BecomeFriendHappinessChange[(int)targetCharBehaviorType]);
				lifeRecordCollection.AddBecomeFriend(charId, currDate, targetCharId, location);
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddBecomeFriend(selfChar._id, targetChar._id);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				bool flag2 = selfIsTaiwuPeople || targetIsTaiwuPeople;
				if (flag2)
				{
					monthlyNotificationCollection.AddBecomeFriend(charId, location, targetCharId);
					DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), selfIsTaiwuPeople ? selfChar._id : targetChar._id);
				}
				DomainManager.Character.AddFavorabilityChangeInstantNotification(targetChar, selfChar, true);
			}
		}

		// Token: 0x06006E69 RID: 28265 RVA: 0x003EE9F0 File Offset: 0x003ECBF0
		public static void ApplySeverFriend(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !DomainManager.Character.HasRelation(targetCharId, charId, 8192);
			if (!flag)
			{
				sbyte targetCharBehaviorType = targetChar.GetBehaviorType();
				Location location = selfChar._location;
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				DomainManager.Character.ChangeRelationType(context, charId, targetCharId, 8192, 0);
				DomainManager.Character.ChangeRelationType(context, targetCharId, charId, 8192, 0);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, -3000);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, -3000);
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.SeverFriendHappinessChange[(int)charBehaviorType]);
				targetChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.SeverFriendHappinessChange[(int)targetCharBehaviorType]);
				lifeRecordCollection.AddSeverFriendship(charId, currDate, targetCharId, location);
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddSeverFriend(selfChar._id, targetChar._id);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				bool flag2 = selfIsTaiwuPeople || targetIsTaiwuPeople;
				if (flag2)
				{
					monthlyNotificationCollection.AddDecreaseFriendship(charId, location, targetCharId);
					DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), selfIsTaiwuPeople ? selfChar._id : targetChar._id);
				}
			}
		}

		// Token: 0x06006E6A RID: 28266 RVA: 0x003EEB4C File Offset: 0x003ECD4C
		public static void ApplyBecomeSwornBrotherOrSister(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !RelationTypeHelper.AllowAddingSwornBrotherOrSisterRelation(targetCharId, charId);
			if (!flag)
			{
				sbyte targetCharBehaviorType = targetChar.GetBehaviorType();
				Location location = selfChar._location;
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				DomainManager.Character.AddRelation(context, charId, targetCharId, 512, currDate);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, 12000);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, 12000);
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.BecomeSwornOrAdoptedFamilyHappinessChange[(int)charBehaviorType]);
				targetChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.BecomeSwornOrAdoptedFamilyHappinessChange[(int)targetCharBehaviorType]);
				lifeRecordCollection.AddBecomeSwornBrotherOrSister(charId, currDate, targetCharId, location);
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddBecomeSwornBrothersAndSisters(selfChar._id, targetChar._id);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				bool flag2 = selfIsTaiwuPeople || targetIsTaiwuPeople;
				if (flag2)
				{
					monthlyNotificationCollection.AddBecomeSwornBrotherOrSister(charId, location, targetCharId);
					DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), selfIsTaiwuPeople ? selfChar._id : targetChar._id);
				}
			}
		}

		// Token: 0x06006E6B RID: 28267 RVA: 0x003EEC88 File Offset: 0x003ECE88
		public static void ApplySeverSwornBrotherOrSister(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !DomainManager.Character.HasRelation(targetCharId, charId, 512);
			if (!flag)
			{
				sbyte targetCharBehaviorType = targetChar.GetBehaviorType();
				Location location = selfChar._location;
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				DomainManager.Character.ChangeRelationType(context, charId, targetCharId, 512, 0);
				DomainManager.Character.ChangeRelationType(context, targetCharId, charId, 512, 0);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, -12000);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, -12000);
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.SeverSwornOrAdoptedFamilyHappinessChange[(int)charBehaviorType]);
				targetChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.SeverSwornOrAdoptedFamilyHappinessChange[(int)targetCharBehaviorType]);
				lifeRecordCollection.AddSeverSwornBrotherhood(charId, currDate, targetCharId, location);
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddSeverSwornBrothersAndSisters(selfChar._id, targetChar._id);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				bool flag2 = selfIsTaiwuPeople || targetIsTaiwuPeople;
				if (flag2)
				{
					monthlyNotificationCollection.AddSeverFriendship(charId, location, targetCharId);
					DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), selfIsTaiwuPeople ? selfChar._id : targetChar._id);
				}
			}
		}

		// Token: 0x06006E6C RID: 28268 RVA: 0x003EEDE4 File Offset: 0x003ECFE4
		public static void ApplySeverHusbandOrWife(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !DomainManager.Character.HasRelation(targetCharId, charId, 1024);
			if (!flag)
			{
				sbyte targetCharBehaviorType = targetChar.GetBehaviorType();
				Location location = selfChar.GetValidLocation();
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				DomainManager.Character.ChangeRelationType(context, charId, targetCharId, 1024, 0);
				DomainManager.Character.ChangeRelationType(context, targetCharId, charId, 1024, 0);
				bool principal = selfChar._organizationInfo.Principal;
				if (principal)
				{
					DomainManager.Organization.TryDowngradeDeputySpouse(context, charId, selfChar._organizationInfo, targetCharId);
				}
				else
				{
					DomainManager.Organization.TryDowngradeDeputySpouse(context, targetCharId, targetChar._organizationInfo, charId);
				}
				DomainManager.Character.ChangeRelationType(context, charId, targetCharId, 16384, 0);
				DomainManager.Character.ChangeRelationType(context, targetCharId, charId, 16384, 0);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, -12000);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, -12000);
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.SeverHusbandOrWifeHappinessChange[(int)charBehaviorType]);
				targetChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.SeverHusbandOrWifeHappinessChange[(int)targetCharBehaviorType]);
				lifeRecordCollection.AddDivorce(charId, currDate, targetCharId, location);
			}
		}

		// Token: 0x06006E6D RID: 28269 RVA: 0x003EEF30 File Offset: 0x003ED130
		public static void ApplyAddRelation_Adore(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool targetLovesBack, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !RelationTypeHelper.AllowAddingAdoredRelation(charId, targetCharId);
			if (!flag)
			{
				Location location = selfChar._location;
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				int currDate = DomainManager.World.GetCurrDate();
				DomainManager.Character.AddRelation(context, charId, targetCharId, 16384, currDate);
				lifeRecordCollection.AddAdore(charId, currDate, targetCharId, location);
				bool flag2 = targetLovesBack && !DomainManager.Character.HasRelation(targetCharId, charId, 16384);
				if (flag2)
				{
					DomainManager.Character.AddRelation(context, targetCharId, charId, 16384, int.MinValue);
					DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, 3000);
					DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, 3000);
					selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.ConfessLoveSucceedHappinessChange[(int)charBehaviorType]);
					targetChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.ConfessLoveSucceedHappinessChange[(int)targetChar.GetBehaviorType()]);
					lifeRecordCollection.AddAdore(targetCharId, currDate, charId, location);
					lifeRecordCollection.AddLoveAtFirstSight(charId, currDate, targetCharId, location);
					SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
					int secretInfoOffset = secretInformationCollection.AddBecomeLover(selfChar._id, targetChar._id);
					int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
					bool flag3 = selfIsTaiwuPeople || targetIsTaiwuPeople;
					if (flag3)
					{
						monthlyNotificationCollection.AddConfessLoveAndSucceed(charId, location, targetCharId);
						DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), selfIsTaiwuPeople ? selfChar._id : targetChar._id);
					}
					bool flag4 = context.Random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.ConfessLoveSucceedNeedForSexChance[(int)charBehaviorType]);
					if (flag4)
					{
						GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(23, targetCharId);
						selfChar.AddPersonalNeed(context, need);
					}
				}
			}
		}

		// Token: 0x06006E6E RID: 28270 RVA: 0x003EF0EC File Offset: 0x003ED2EC
		public static void ApplySeverAdore(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople)
		{
			int currDate = DomainManager.World.GetCurrDate();
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !DomainManager.Character.HasRelation(charId, targetCharId, 16384);
			if (!flag)
			{
				Location location = selfChar._location;
				DomainManager.Character.ChangeRelationType(context, charId, targetCharId, 16384, 0);
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.ConfessLoveFailedHappinessChange[(int)charBehaviorType]);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, -3000);
				DomainManager.LifeRecord.GetLifeRecordCollection().AddEndAdored(charId, currDate, targetCharId, location);
				bool flag2 = context.Random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.BecomeSingleNeedNewLoveChance[(int)charBehaviorType]);
				if (flag2)
				{
					GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(25, 16384);
					selfChar.AddPersonalNeed(context, need);
				}
			}
		}

		// Token: 0x06006E6F RID: 28271 RVA: 0x003EF1B8 File Offset: 0x003ED3B8
		public static void ApplyBecomeBoyOrGirlFriend(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool succeed, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !RelationTypeHelper.AllowAddingAdoredRelation(targetCharId, charId);
			if (!flag)
			{
				Location location = selfChar._location;
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				int currDate = DomainManager.World.GetCurrDate();
				if (succeed)
				{
					DomainManager.Character.AddRelation(context, targetCharId, charId, 16384, int.MinValue);
					DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, 3000);
					DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, 3000);
					selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.ConfessLoveSucceedHappinessChange[(int)charBehaviorType]);
					lifeRecordCollection.AddConfessLoveSucceed(charId, currDate, targetCharId, location);
					SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
					int secretInfoOffset = secretInformationCollection.AddBecomeLover(selfChar._id, targetChar._id);
					int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
					bool flag2 = selfIsTaiwuPeople || targetIsTaiwuPeople;
					if (flag2)
					{
						monthlyNotificationCollection.AddConfessLoveAndSucceed(charId, location, targetCharId);
						DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), selfIsTaiwuPeople ? selfChar._id : targetChar._id);
					}
					bool flag3 = context.Random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.ConfessLoveSucceedNeedForSexChance[(int)charBehaviorType]);
					if (flag3)
					{
						GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(23, targetCharId);
						selfChar.AddPersonalNeed(context, need);
					}
				}
				else
				{
					DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, -3000);
					DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, -3000);
					selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.ConfessLoveFailedHappinessChange[(int)charBehaviorType]);
					lifeRecordCollection.AddConfessLoveFail(charId, currDate, targetCharId, location);
					bool flag4 = context.Random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.BecomeSingleNeedNewLoveChance[(int)charBehaviorType]);
					if (flag4)
					{
						GameData.Domains.Character.Ai.PersonalNeed need2 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(25, 16384);
						selfChar.AddPersonalNeed(context, need2);
					}
					bool flag5 = context.Random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.ConfessLoveFailedNeedForRapeChance[(int)charBehaviorType]);
					if (flag5)
					{
						GameData.Domains.Character.Ai.PersonalNeed need3 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(23, targetCharId);
						selfChar.AddPersonalNeed(context, need3);
					}
					bool flag6 = context.Random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.ConfessLoveOrProposeFailedBecomeEnemyChance[(int)charBehaviorType]);
					if (flag6)
					{
						Character.ApplyAddRelation_Enemy(context, selfChar, targetChar, selfIsTaiwuPeople, 9);
					}
				}
			}
		}

		// Token: 0x06006E70 RID: 28272 RVA: 0x003EF3E8 File Offset: 0x003ED5E8
		public static void ApplyBreakupWithBoyOrGirlFriend(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool targetStillLoveSelf, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !DomainManager.Character.HasRelation(targetCharId, charId, 16384);
			if (!flag)
			{
				Location location = selfChar._location;
				int currDate = DomainManager.World.GetCurrDate();
				sbyte targetBehaviorType = targetChar.GetBehaviorType();
				DomainManager.Character.ChangeRelationType(context, charId, targetCharId, 16384, 0);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, -12000);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, -12000);
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.ConfessLoveFailedHappinessChange[(int)charBehaviorType]);
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddBreakupWithLover(selfChar._id, targetChar._id);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				bool flag2 = selfIsTaiwuPeople || targetIsTaiwuPeople;
				if (flag2)
				{
					DomainManager.World.GetMonthlyNotificationCollection().AddSeverLove(charId, location, targetCharId);
					DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), selfIsTaiwuPeople ? selfChar._id : targetChar._id);
				}
				if (targetStillLoveSelf)
				{
					DomainManager.LifeRecord.GetLifeRecordCollection().AddDumpLover(charId, currDate, targetCharId, location);
				}
				else
				{
					DomainManager.LifeRecord.GetLifeRecordCollection().AddBreakupMutually(charId, currDate, targetCharId, location);
					DomainManager.Character.ChangeRelationType(context, targetCharId, charId, 16384, 0);
					targetChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.ConfessLoveFailedHappinessChange[(int)targetBehaviorType]);
				}
				bool flag3 = context.Random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.BecomeSingleNeedNewLoveChance[(int)charBehaviorType]);
				if (flag3)
				{
					GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(25, 16384);
					selfChar.AddPersonalNeed(context, need);
				}
				bool flag4 = context.Random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.BreakupBecomeEnemyChance[(int)targetBehaviorType]);
				if (flag4)
				{
					Character.ApplyAddRelation_Enemy(context, targetChar, selfChar, targetIsTaiwuPeople, 3);
				}
				if (selfIsTaiwuPeople)
				{
					InteractOfLove.LeaveLover(context, targetChar.GetId());
				}
				else if (targetIsTaiwuPeople)
				{
					InteractOfLove.LeaveLover(context, selfChar.GetId());
				}
			}
		}

		// Token: 0x06006E71 RID: 28273 RVA: 0x003EF5E0 File Offset: 0x003ED7E0
		public static void ApplyBecomeHusbandOrWife(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool succeed, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !RelationTypeHelper.AllowAddingHusbandOrWifeRelation(targetCharId, charId);
			if (!flag)
			{
				sbyte targetCharBehaviorType = targetChar.GetBehaviorType();
				Location location = selfChar._location;
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				if (succeed)
				{
					DomainManager.Character.AddHusbandOrWifeRelations(context, charId, targetCharId, currDate);
					DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, 12000);
					DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, 12000);
					selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.ProposeMarriageSucceedHappinessChange[(int)charBehaviorType]);
					lifeRecordCollection.AddProposeMarriageSucceed(charId, currDate, targetCharId, location);
					SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
					int secretInfoOffset = secretInformationCollection.AddBecomeHusbandAndWife(selfChar._id, targetChar._id);
					int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
					bool flag2 = selfIsTaiwuPeople || targetIsTaiwuPeople;
					if (flag2)
					{
						monthlyNotificationCollection.AddMarriage(charId, location, targetCharId);
						DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), selfIsTaiwuPeople ? selfChar._id : targetChar._id);
					}
					DomainManager.Organization.UpdateOrganizationAfterMarriage(context, selfChar, targetChar);
					GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(23, targetCharId);
					selfChar.AddPersonalNeed(context, need);
				}
				else
				{
					DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, -3000);
					DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, -3000);
					selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.ProposeMarriageFailHappinessChange[(int)charBehaviorType]);
					lifeRecordCollection.AddProposeMarriageFail(charId, currDate, targetCharId, location);
					bool flag3 = context.Random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.BecomeSingleNeedNewLoveChance[(int)charBehaviorType]);
					if (flag3)
					{
						GameData.Domains.Character.Ai.PersonalNeed need2 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(25, 16384);
						selfChar.AddPersonalNeed(context, need2);
					}
					bool flag4 = context.Random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.ConfessLoveOrProposeFailedBecomeEnemyChance[(int)charBehaviorType]);
					if (flag4)
					{
						Character.ApplyAddRelation_Enemy(context, selfChar, targetChar, selfIsTaiwuPeople, 4);
					}
				}
			}
		}

		// Token: 0x06006E72 RID: 28274 RVA: 0x003EF7D8 File Offset: 0x003ED9D8
		public static void ApplyEndRelation_AdoptiveParent(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !DomainManager.Character.HasRelation(charId, targetCharId, 64);
			if (!flag)
			{
				sbyte targetCharBehaviorType = targetChar.GetBehaviorType();
				Location location = selfChar._location;
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				DomainManager.Character.ChangeRelationType(context, charId, targetCharId, 64, 0);
				DomainManager.Character.ChangeRelationType(context, targetCharId, charId, 128, 0);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, -12000);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, -12000);
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.SeverSwornOrAdoptedFamilyHappinessChange[(int)charBehaviorType]);
				targetChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.SeverSwornOrAdoptedFamilyHappinessChange[(int)targetCharBehaviorType]);
				lifeRecordCollection.AddSeverAdoptiveParent(charId, currDate, targetCharId, location);
				bool flag2 = selfIsTaiwuPeople || targetIsTaiwuPeople;
				if (flag2)
				{
				}
			}
		}

		// Token: 0x06006E73 RID: 28275 RVA: 0x003EF8C5 File Offset: 0x003EDAC5
		public static void ApplyEndRelation_AdoptiveChild(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			Character.ApplyEndRelation_AdoptiveParent(context, targetChar, selfChar, targetChar.GetBehaviorType(), targetIsTaiwuPeople, selfIsTaiwuPeople);
		}

		// Token: 0x06006E74 RID: 28276 RVA: 0x003EF8DC File Offset: 0x003EDADC
		public static void ApplyAddRelation_AdoptiveParent(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !RelationTypeHelper.AllowAddingAdoptiveParentRelation(charId, targetCharId);
			if (!flag)
			{
				sbyte targetCharBehaviorType = targetChar.GetBehaviorType();
				Location location = selfChar._location;
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				DomainManager.Character.AddAdoptiveParentRelations(context, charId, targetCharId, currDate);
				int spouseId = DomainManager.Character.GetAliveSpouse(targetCharId);
				bool flag2 = spouseId >= 0;
				if (flag2)
				{
					DomainManager.Character.AddAdoptiveParentRelations(context, charId, spouseId, currDate);
				}
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, 12000);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, 12000);
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.BecomeSwornOrAdoptedFamilyHappinessChange[(int)charBehaviorType]);
				targetChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.BecomeSwornOrAdoptedFamilyHappinessChange[(int)targetCharBehaviorType]);
				short relatedRecordId = (targetChar.GetGender() == 1) ? 46 : 47;
				bool flag3 = selfChar.GetGender() == 1;
				if (flag3)
				{
					lifeRecordCollection.AddAdoptSon(targetCharId, currDate, charId, location, relatedRecordId);
				}
				else
				{
					lifeRecordCollection.AddAdoptDaughter(targetCharId, currDate, charId, location, relatedRecordId);
				}
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddGetAdopted(selfChar._id, targetChar._id);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				if (selfIsTaiwuPeople)
				{
					bool flag4 = targetChar.GetGender() == 1;
					if (flag4)
					{
						monthlyNotificationCollection.AddRecognizeFather(charId, location, targetCharId);
					}
					else
					{
						monthlyNotificationCollection.AddRecognizeMother(charId, location, targetCharId);
					}
					DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), selfChar._id);
				}
				secretInfoOffset = secretInformationCollection.AddAdoptChild(targetChar._id, selfChar._id);
				secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				if (targetIsTaiwuPeople)
				{
					bool flag5 = selfChar.GetGender() == 1;
					if (flag5)
					{
						monthlyNotificationCollection.AddAdoptBoy(targetCharId, location, charId);
					}
					else
					{
						monthlyNotificationCollection.AddAdoptGirl(targetCharId, location, charId);
					}
					DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), targetChar._id);
				}
			}
		}

		// Token: 0x06006E75 RID: 28277 RVA: 0x003EFAF4 File Offset: 0x003EDCF4
		public static void ApplyAddRelation_AdoptiveChild(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !RelationTypeHelper.AllowAddingAdoptiveChildRelation(charId, targetCharId);
			if (!flag)
			{
				sbyte targetCharBehaviorType = targetChar.GetBehaviorType();
				Location location = selfChar._location;
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				DomainManager.Character.AddAdoptiveParentRelations(context, targetCharId, charId, currDate);
				int spouseId = DomainManager.Character.GetAliveSpouse(charId);
				bool flag2 = spouseId >= 0;
				if (flag2)
				{
					DomainManager.Character.AddAdoptiveParentRelations(context, targetCharId, spouseId, currDate);
				}
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, 12000);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, 12000);
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.BecomeSwornOrAdoptedFamilyHappinessChange[(int)charBehaviorType]);
				targetChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.BecomeSwornOrAdoptedFamilyHappinessChange[(int)targetCharBehaviorType]);
				short relatedRecordId = (selfChar.GetGender() == 1) ? 46 : 47;
				bool flag3 = targetChar.GetGender() == 1;
				if (flag3)
				{
					lifeRecordCollection.AddAdoptSon(charId, currDate, targetCharId, location, relatedRecordId);
				}
				else
				{
					lifeRecordCollection.AddAdoptDaughter(charId, currDate, targetCharId, location, relatedRecordId);
				}
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddAdoptChild(selfChar._id, targetChar._id);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				if (selfIsTaiwuPeople)
				{
					bool flag4 = targetChar.GetGender() == 1;
					if (flag4)
					{
						monthlyNotificationCollection.AddAdoptBoy(charId, location, targetCharId);
					}
					else
					{
						monthlyNotificationCollection.AddAdoptGirl(charId, location, targetCharId);
					}
					DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), selfChar._id);
				}
				secretInfoOffset = secretInformationCollection.AddGetAdopted(targetChar._id, selfChar._id);
				secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				if (targetIsTaiwuPeople)
				{
					bool flag5 = selfChar.GetGender() == 1;
					if (flag5)
					{
						monthlyNotificationCollection.AddRecognizeFather(targetCharId, location, charId);
					}
					else
					{
						monthlyNotificationCollection.AddRecognizeMother(targetCharId, location, charId);
					}
					DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, DomainManager.Taiwu.GetTaiwuCharId(), targetChar._id);
				}
			}
		}

		// Token: 0x06006E76 RID: 28278 RVA: 0x003EFD0C File Offset: 0x003EDF0C
		public static void ApplyAddRelation_Mentor(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !RelationTypeHelper.AllowAddingMentorRelation(charId, targetCharId);
			if (!flag)
			{
				sbyte targetCharBehaviorType = targetChar.GetBehaviorType();
				Location location = selfChar._location;
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				DomainManager.Character.AddRelation(context, charId, targetCharId, 2048, int.MinValue);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, 3000);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, 3000);
				selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.BecomeMentorHappinessChange[(int)charBehaviorType]);
				targetChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.BecomeMentorHappinessChange[(int)targetCharBehaviorType]);
				lifeRecordCollection.AddGetMentor(charId, currDate, targetCharId, location);
				bool flag2 = selfIsTaiwuPeople || targetIsTaiwuPeople;
				if (flag2)
				{
				}
			}
		}

		// Token: 0x06006E77 RID: 28279 RVA: 0x003EFDE8 File Offset: 0x003EDFE8
		public static void ApplyEndRelation_Mentor(DataContext context, Character selfChar, Character targetChar, sbyte charBehaviorType, bool selfIsTaiwuPeople, bool targetIsTaiwuPeople)
		{
			int charId = selfChar._id;
			int targetCharId = targetChar._id;
			bool flag = !DomainManager.Character.HasRelation(charId, targetCharId, 2048);
			if (!flag)
			{
				sbyte targetCharBehaviorType = targetChar.GetBehaviorType();
				Location location = selfChar._location;
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				DomainManager.Character.ChangeRelationType(context, charId, targetCharId, 2048, 0);
				DomainManager.Character.ChangeRelationType(context, targetCharId, charId, 4096, 0);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, selfChar, targetChar, -3000);
				DomainManager.Character.ChangeFavorabilityOptionalRepeatedEvent(context, targetChar, selfChar, -3000);
				selfChar.ChangeHappiness(context, (int)(-(int)AiHelper.RelationsRelatedConstants.BecomeMentorHappinessChange[(int)charBehaviorType]));
				targetChar.ChangeHappiness(context, (int)(-(int)AiHelper.RelationsRelatedConstants.BecomeMentorHappinessChange[(int)targetCharBehaviorType]));
				lifeRecordCollection.AddSeverMentor(charId, currDate, targetCharId, location);
				bool flag2 = selfIsTaiwuPeople || targetIsTaiwuPeople;
				if (flag2)
				{
				}
			}
		}

		// Token: 0x06006E78 RID: 28280 RVA: 0x003EFEE0 File Offset: 0x003EE0E0
		public int GetId()
		{
			return this._id;
		}

		// Token: 0x06006E79 RID: 28281 RVA: 0x003EFEF8 File Offset: 0x003EE0F8
		public short GetTemplateId()
		{
			return this._templateId;
		}

		// Token: 0x06006E7A RID: 28282 RVA: 0x003EFF10 File Offset: 0x003EE110
		public byte GetCreatingType()
		{
			return this._creatingType;
		}

		// Token: 0x06006E7B RID: 28283 RVA: 0x003EFF28 File Offset: 0x003EE128
		public sbyte GetGender()
		{
			return this._gender;
		}

		// Token: 0x06006E7C RID: 28284 RVA: 0x003EFF40 File Offset: 0x003EE140
		public short GetActualAge()
		{
			return this._actualAge;
		}

		// Token: 0x06006E7D RID: 28285 RVA: 0x003EFF58 File Offset: 0x003EE158
		public unsafe void SetActualAge(short actualAge, DataContext context)
		{
			this._actualAge = actualAge;
			base.SetModifiedAndInvalidateInfluencedCache(4, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 8U, 2);
				*(short*)pData = this._actualAge;
				pData += 2;
			}
		}

		// Token: 0x06006E7E RID: 28286 RVA: 0x003EFFB8 File Offset: 0x003EE1B8
		public sbyte GetBirthMonth()
		{
			return this._birthMonth;
		}

		// Token: 0x06006E7F RID: 28287 RVA: 0x003EFFD0 File Offset: 0x003EE1D0
		public sbyte GetHappiness()
		{
			return this._happiness;
		}

		// Token: 0x06006E80 RID: 28288 RVA: 0x003EFFE8 File Offset: 0x003EE1E8
		public unsafe void SetHappiness(sbyte happiness, DataContext context)
		{
			this._happiness = happiness;
			base.SetModifiedAndInvalidateInfluencedCache(6, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 11U, 1);
				*pData = (byte)this._happiness;
				pData++;
			}
		}

		// Token: 0x06006E81 RID: 28289 RVA: 0x003F0048 File Offset: 0x003EE248
		public short GetBaseMorality()
		{
			return this._baseMorality;
		}

		// Token: 0x06006E82 RID: 28290 RVA: 0x003F0060 File Offset: 0x003EE260
		public unsafe void SetBaseMorality(short baseMorality, DataContext context)
		{
			this._baseMorality = baseMorality;
			base.SetModifiedAndInvalidateInfluencedCache(7, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 12U, 2);
				*(short*)pData = this._baseMorality;
				pData += 2;
			}
		}

		// Token: 0x06006E83 RID: 28291 RVA: 0x003F00C0 File Offset: 0x003EE2C0
		public OrganizationInfo GetOrganizationInfo()
		{
			return this._organizationInfo;
		}

		// Token: 0x06006E84 RID: 28292 RVA: 0x003F00D8 File Offset: 0x003EE2D8
		public unsafe void SetOrganizationInfo(OrganizationInfo organizationInfo, DataContext context)
		{
			this._organizationInfo = organizationInfo;
			base.SetModifiedAndInvalidateInfluencedCache(8, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 14U, 8);
				pData += this._organizationInfo.Serialize(pData);
			}
		}

		// Token: 0x06006E85 RID: 28293 RVA: 0x003F013C File Offset: 0x003EE33C
		public sbyte GetIdealSect()
		{
			return this._idealSect;
		}

		// Token: 0x06006E86 RID: 28294 RVA: 0x003F0154 File Offset: 0x003EE354
		public unsafe void SetIdealSect(sbyte idealSect, DataContext context)
		{
			this._idealSect = idealSect;
			base.SetModifiedAndInvalidateInfluencedCache(9, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 22U, 1);
				*pData = (byte)this._idealSect;
				pData++;
			}
		}

		// Token: 0x06006E87 RID: 28295 RVA: 0x003F01B8 File Offset: 0x003EE3B8
		public sbyte GetLifeSkillTypeInterest()
		{
			return this._lifeSkillTypeInterest;
		}

		// Token: 0x06006E88 RID: 28296 RVA: 0x003F01D0 File Offset: 0x003EE3D0
		public unsafe void SetLifeSkillTypeInterest(sbyte lifeSkillTypeInterest, DataContext context)
		{
			this._lifeSkillTypeInterest = lifeSkillTypeInterest;
			base.SetModifiedAndInvalidateInfluencedCache(10, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 23U, 1);
				*pData = (byte)this._lifeSkillTypeInterest;
				pData++;
			}
		}

		// Token: 0x06006E89 RID: 28297 RVA: 0x003F0234 File Offset: 0x003EE434
		public sbyte GetCombatSkillTypeInterest()
		{
			return this._combatSkillTypeInterest;
		}

		// Token: 0x06006E8A RID: 28298 RVA: 0x003F024C File Offset: 0x003EE44C
		public unsafe void SetCombatSkillTypeInterest(sbyte combatSkillTypeInterest, DataContext context)
		{
			this._combatSkillTypeInterest = combatSkillTypeInterest;
			base.SetModifiedAndInvalidateInfluencedCache(11, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 24U, 1);
				*pData = (byte)this._combatSkillTypeInterest;
				pData++;
			}
		}

		// Token: 0x06006E8B RID: 28299 RVA: 0x003F02B0 File Offset: 0x003EE4B0
		public sbyte GetMainAttributeInterest()
		{
			return this._mainAttributeInterest;
		}

		// Token: 0x06006E8C RID: 28300 RVA: 0x003F02C8 File Offset: 0x003EE4C8
		public unsafe void SetMainAttributeInterest(sbyte mainAttributeInterest, DataContext context)
		{
			this._mainAttributeInterest = mainAttributeInterest;
			base.SetModifiedAndInvalidateInfluencedCache(12, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 25U, 1);
				*pData = (byte)this._mainAttributeInterest;
				pData++;
			}
		}

		// Token: 0x06006E8D RID: 28301 RVA: 0x003F032C File Offset: 0x003EE52C
		public bool GetTransgender()
		{
			return this._transgender;
		}

		// Token: 0x06006E8E RID: 28302 RVA: 0x003F0344 File Offset: 0x003EE544
		public bool GetBisexual()
		{
			return this._bisexual;
		}

		// Token: 0x06006E8F RID: 28303 RVA: 0x003F035C File Offset: 0x003EE55C
		public sbyte GetXiangshuType()
		{
			return this._xiangshuType;
		}

		// Token: 0x06006E90 RID: 28304 RVA: 0x003F0374 File Offset: 0x003EE574
		public byte GetMonkType()
		{
			return this._monkType;
		}

		// Token: 0x06006E91 RID: 28305 RVA: 0x003F038C File Offset: 0x003EE58C
		public unsafe void SetMonkType(byte monkType, DataContext context)
		{
			this._monkType = monkType;
			base.SetModifiedAndInvalidateInfluencedCache(16, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 29U, 1);
				*pData = this._monkType;
				pData++;
			}
		}

		// Token: 0x06006E92 RID: 28306 RVA: 0x003F03F0 File Offset: 0x003EE5F0
		public List<short> GetFeatureIds()
		{
			return this._featureIds;
		}

		// Token: 0x06006E93 RID: 28307 RVA: 0x003F0408 File Offset: 0x003EE608
		public unsafe void SetFeatureIds(List<short> featureIds, DataContext context)
		{
			this._featureIds = featureIds;
			base.SetModifiedAndInvalidateInfluencedCache(17, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				int elementsCount = this._featureIds.Count;
				int contentSize = 2 * elementsCount;
				int dataSize = 2 + contentSize;
				byte* pData = OperationAdder.DynamicObjectCollection_SetDynamicField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 0, dataSize);
				*(short*)pData = (short)((ushort)elementsCount);
				pData += 2;
				for (int i = 0; i < elementsCount; i++)
				{
					*(short*)(pData + (IntPtr)i * 2) = this._featureIds[i];
				}
				pData += contentSize;
			}
		}

		// Token: 0x06006E94 RID: 28308 RVA: 0x003F04B0 File Offset: 0x003EE6B0
		public MainAttributes GetBaseMainAttributes()
		{
			return this._baseMainAttributes;
		}

		// Token: 0x06006E95 RID: 28309 RVA: 0x003F04C8 File Offset: 0x003EE6C8
		public unsafe void SetBaseMainAttributes(MainAttributes baseMainAttributes, DataContext context)
		{
			this._baseMainAttributes = baseMainAttributes;
			base.SetModifiedAndInvalidateInfluencedCache(18, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 30U, 12);
				pData += this._baseMainAttributes.Serialize(pData);
			}
		}

		// Token: 0x06006E96 RID: 28310 RVA: 0x003F0530 File Offset: 0x003EE730
		public short GetHealth()
		{
			return this._health;
		}

		// Token: 0x06006E97 RID: 28311 RVA: 0x003F0548 File Offset: 0x003EE748
		public unsafe void SetHealth(short health, DataContext context)
		{
			this._health = health;
			base.SetModifiedAndInvalidateInfluencedCache(19, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 42U, 2);
				*(short*)pData = this._health;
				pData += 2;
			}
		}

		// Token: 0x06006E98 RID: 28312 RVA: 0x003F05AC File Offset: 0x003EE7AC
		public short GetBaseMaxHealth()
		{
			return this._baseMaxHealth;
		}

		// Token: 0x06006E99 RID: 28313 RVA: 0x003F05C4 File Offset: 0x003EE7C4
		public unsafe void SetBaseMaxHealth(short baseMaxHealth, DataContext context)
		{
			this._baseMaxHealth = baseMaxHealth;
			base.SetModifiedAndInvalidateInfluencedCache(20, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 44U, 2);
				*(short*)pData = this._baseMaxHealth;
				pData += 2;
			}
		}

		// Token: 0x06006E9A RID: 28314 RVA: 0x003F0628 File Offset: 0x003EE828
		public short GetDisorderOfQi()
		{
			return this._disorderOfQi;
		}

		// Token: 0x06006E9B RID: 28315 RVA: 0x003F0640 File Offset: 0x003EE840
		public unsafe void SetDisorderOfQi(short disorderOfQi, DataContext context)
		{
			this._disorderOfQi = disorderOfQi;
			base.SetModifiedAndInvalidateInfluencedCache(21, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 46U, 2);
				*(short*)pData = this._disorderOfQi;
				pData += 2;
			}
		}

		// Token: 0x06006E9C RID: 28316 RVA: 0x003F06A4 File Offset: 0x003EE8A4
		public bool GetHaveLeftArm()
		{
			return this._haveLeftArm;
		}

		// Token: 0x06006E9D RID: 28317 RVA: 0x003F06BC File Offset: 0x003EE8BC
		public unsafe void SetHaveLeftArm(bool haveLeftArm, DataContext context)
		{
			this._haveLeftArm = haveLeftArm;
			base.SetModifiedAndInvalidateInfluencedCache(22, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 48U, 1);
				*pData = (this._haveLeftArm ? 1 : 0);
				pData++;
			}
		}

		// Token: 0x06006E9E RID: 28318 RVA: 0x003F0720 File Offset: 0x003EE920
		public bool GetHaveRightArm()
		{
			return this._haveRightArm;
		}

		// Token: 0x06006E9F RID: 28319 RVA: 0x003F0738 File Offset: 0x003EE938
		public unsafe void SetHaveRightArm(bool haveRightArm, DataContext context)
		{
			this._haveRightArm = haveRightArm;
			base.SetModifiedAndInvalidateInfluencedCache(23, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 49U, 1);
				*pData = (this._haveRightArm ? 1 : 0);
				pData++;
			}
		}

		// Token: 0x06006EA0 RID: 28320 RVA: 0x003F079C File Offset: 0x003EE99C
		public bool GetHaveLeftLeg()
		{
			return this._haveLeftLeg;
		}

		// Token: 0x06006EA1 RID: 28321 RVA: 0x003F07B4 File Offset: 0x003EE9B4
		public unsafe void SetHaveLeftLeg(bool haveLeftLeg, DataContext context)
		{
			this._haveLeftLeg = haveLeftLeg;
			base.SetModifiedAndInvalidateInfluencedCache(24, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 50U, 1);
				*pData = (this._haveLeftLeg ? 1 : 0);
				pData++;
			}
		}

		// Token: 0x06006EA2 RID: 28322 RVA: 0x003F0818 File Offset: 0x003EEA18
		public bool GetHaveRightLeg()
		{
			return this._haveRightLeg;
		}

		// Token: 0x06006EA3 RID: 28323 RVA: 0x003F0830 File Offset: 0x003EEA30
		public unsafe void SetHaveRightLeg(bool haveRightLeg, DataContext context)
		{
			this._haveRightLeg = haveRightLeg;
			base.SetModifiedAndInvalidateInfluencedCache(25, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 51U, 1);
				*pData = (this._haveRightLeg ? 1 : 0);
				pData++;
			}
		}

		// Token: 0x06006EA4 RID: 28324 RVA: 0x003F0894 File Offset: 0x003EEA94
		public Injuries GetInjuries()
		{
			return this._injuries;
		}

		// Token: 0x06006EA5 RID: 28325 RVA: 0x003F08AC File Offset: 0x003EEAAC
		public unsafe void SetInjuries(Injuries injuries, DataContext context)
		{
			this._injuries = injuries;
			base.SetModifiedAndInvalidateInfluencedCache(26, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 52U, 16);
				pData += this._injuries.Serialize(pData);
			}
		}

		// Token: 0x06006EA6 RID: 28326 RVA: 0x003F0914 File Offset: 0x003EEB14
		public int GetExtraNeili()
		{
			return this._extraNeili;
		}

		// Token: 0x06006EA7 RID: 28327 RVA: 0x003F092C File Offset: 0x003EEB2C
		public unsafe void SetExtraNeili(int extraNeili, DataContext context)
		{
			this._extraNeili = extraNeili;
			base.SetModifiedAndInvalidateInfluencedCache(27, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 68U, 4);
				*(int*)pData = this._extraNeili;
				pData += 4;
			}
		}

		// Token: 0x06006EA8 RID: 28328 RVA: 0x003F0990 File Offset: 0x003EEB90
		public sbyte GetConsummateLevel()
		{
			return this._consummateLevel;
		}

		// Token: 0x06006EA9 RID: 28329 RVA: 0x003F09A8 File Offset: 0x003EEBA8
		public unsafe void SetConsummateLevel(sbyte consummateLevel, DataContext context)
		{
			this._consummateLevel = consummateLevel;
			base.SetModifiedAndInvalidateInfluencedCache(28, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 72U, 1);
				*pData = (byte)this._consummateLevel;
				pData++;
			}
		}

		// Token: 0x06006EAA RID: 28330 RVA: 0x003F0A0C File Offset: 0x003EEC0C
		public List<LifeSkillItem> GetLearnedLifeSkills()
		{
			return this._learnedLifeSkills;
		}

		// Token: 0x06006EAB RID: 28331 RVA: 0x003F0A24 File Offset: 0x003EEC24
		public unsafe void SetLearnedLifeSkills(List<LifeSkillItem> learnedLifeSkills, DataContext context)
		{
			this._learnedLifeSkills = learnedLifeSkills;
			base.SetModifiedAndInvalidateInfluencedCache(29, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				int elementsCount = this._learnedLifeSkills.Count;
				int contentSize = 4 * elementsCount;
				int dataSize = 2 + contentSize;
				byte* pData = OperationAdder.DynamicObjectCollection_SetDynamicField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 1, dataSize);
				*(short*)pData = (short)((ushort)elementsCount);
				pData += 2;
				for (int i = 0; i < elementsCount; i++)
				{
					pData += this._learnedLifeSkills[i].Serialize(pData);
				}
			}
		}

		// Token: 0x06006EAC RID: 28332 RVA: 0x003F0ACC File Offset: 0x003EECCC
		public ref LifeSkillShorts GetBaseLifeSkillQualifications()
		{
			return ref this._baseLifeSkillQualifications;
		}

		// Token: 0x06006EAD RID: 28333 RVA: 0x003F0AE4 File Offset: 0x003EECE4
		public unsafe void SetBaseLifeSkillQualifications(ref LifeSkillShorts baseLifeSkillQualifications, DataContext context)
		{
			this._baseLifeSkillQualifications = baseLifeSkillQualifications;
			base.SetModifiedAndInvalidateInfluencedCache(30, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 73U, 32);
				pData += this._baseLifeSkillQualifications.Serialize(pData);
			}
		}

		// Token: 0x06006EAE RID: 28334 RVA: 0x003F0B50 File Offset: 0x003EED50
		public sbyte GetLifeSkillQualificationGrowthType()
		{
			return this._lifeSkillQualificationGrowthType;
		}

		// Token: 0x06006EAF RID: 28335 RVA: 0x003F0B68 File Offset: 0x003EED68
		public unsafe void SetLifeSkillQualificationGrowthType(sbyte lifeSkillQualificationGrowthType, DataContext context)
		{
			this._lifeSkillQualificationGrowthType = lifeSkillQualificationGrowthType;
			base.SetModifiedAndInvalidateInfluencedCache(31, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 105U, 1);
				*pData = (byte)this._lifeSkillQualificationGrowthType;
				pData++;
			}
		}

		// Token: 0x06006EB0 RID: 28336 RVA: 0x003F0BCC File Offset: 0x003EEDCC
		public ref CombatSkillShorts GetBaseCombatSkillQualifications()
		{
			return ref this._baseCombatSkillQualifications;
		}

		// Token: 0x06006EB1 RID: 28337 RVA: 0x003F0BE4 File Offset: 0x003EEDE4
		public unsafe void SetBaseCombatSkillQualifications(ref CombatSkillShorts baseCombatSkillQualifications, DataContext context)
		{
			this._baseCombatSkillQualifications = baseCombatSkillQualifications;
			base.SetModifiedAndInvalidateInfluencedCache(32, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 106U, 28);
				pData += this._baseCombatSkillQualifications.Serialize(pData);
			}
		}

		// Token: 0x06006EB2 RID: 28338 RVA: 0x003F0C50 File Offset: 0x003EEE50
		public sbyte GetCombatSkillQualificationGrowthType()
		{
			return this._combatSkillQualificationGrowthType;
		}

		// Token: 0x06006EB3 RID: 28339 RVA: 0x003F0C68 File Offset: 0x003EEE68
		public unsafe void SetCombatSkillQualificationGrowthType(sbyte combatSkillQualificationGrowthType, DataContext context)
		{
			this._combatSkillQualificationGrowthType = combatSkillQualificationGrowthType;
			base.SetModifiedAndInvalidateInfluencedCache(33, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 134U, 1);
				*pData = (byte)this._combatSkillQualificationGrowthType;
				pData++;
			}
		}

		// Token: 0x06006EB4 RID: 28340 RVA: 0x003F0CCC File Offset: 0x003EEECC
		public ref ResourceInts GetResources()
		{
			return ref this._resources;
		}

		// Token: 0x06006EB5 RID: 28341 RVA: 0x003F0CE4 File Offset: 0x003EEEE4
		public unsafe void SetResources(ref ResourceInts resources, DataContext context)
		{
			this._resources = resources;
			base.SetModifiedAndInvalidateInfluencedCache(34, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 135U, 32);
				pData += this._resources.Serialize(pData);
			}
		}

		// Token: 0x06006EB6 RID: 28342 RVA: 0x003F0D54 File Offset: 0x003EEF54
		public short GetLovingItemSubType()
		{
			return this._lovingItemSubType;
		}

		// Token: 0x06006EB7 RID: 28343 RVA: 0x003F0D6C File Offset: 0x003EEF6C
		public unsafe void SetLovingItemSubType(short lovingItemSubType, DataContext context)
		{
			this._lovingItemSubType = lovingItemSubType;
			base.SetModifiedAndInvalidateInfluencedCache(35, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 167U, 2);
				*(short*)pData = this._lovingItemSubType;
				pData += 2;
			}
		}

		// Token: 0x06006EB8 RID: 28344 RVA: 0x003F0DD0 File Offset: 0x003EEFD0
		public short GetHatingItemSubType()
		{
			return this._hatingItemSubType;
		}

		// Token: 0x06006EB9 RID: 28345 RVA: 0x003F0DE8 File Offset: 0x003EEFE8
		public unsafe void SetHatingItemSubType(short hatingItemSubType, DataContext context)
		{
			this._hatingItemSubType = hatingItemSubType;
			base.SetModifiedAndInvalidateInfluencedCache(36, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 169U, 2);
				*(short*)pData = this._hatingItemSubType;
				pData += 2;
			}
		}

		// Token: 0x06006EBA RID: 28346 RVA: 0x003F0E4C File Offset: 0x003EF04C
		public FullName GetFullName()
		{
			return this._fullName;
		}

		// Token: 0x06006EBB RID: 28347 RVA: 0x003F0E64 File Offset: 0x003EF064
		public unsafe void SetFullName(FullName fullName, DataContext context)
		{
			this._fullName = fullName;
			base.SetModifiedAndInvalidateInfluencedCache(37, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 171U, 10);
				pData += this._fullName.Serialize(pData);
			}
		}

		// Token: 0x06006EBC RID: 28348 RVA: 0x003F0ECC File Offset: 0x003EF0CC
		public MonasticTitle GetMonasticTitle()
		{
			return this._monasticTitle;
		}

		// Token: 0x06006EBD RID: 28349 RVA: 0x003F0EE4 File Offset: 0x003EF0E4
		public unsafe void SetMonasticTitle(MonasticTitle monasticTitle, DataContext context)
		{
			this._monasticTitle = monasticTitle;
			base.SetModifiedAndInvalidateInfluencedCache(38, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 181U, 4);
				pData += this._monasticTitle.Serialize(pData);
			}
		}

		// Token: 0x06006EBE RID: 28350 RVA: 0x003F0F4C File Offset: 0x003EF14C
		public AvatarData GetAvatar()
		{
			return this._avatar;
		}

		// Token: 0x06006EBF RID: 28351 RVA: 0x003F0F64 File Offset: 0x003EF164
		public unsafe void SetAvatar(AvatarData avatar, DataContext context)
		{
			this._avatar = avatar;
			base.SetModifiedAndInvalidateInfluencedCache(39, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 185U, 76);
				pData += this._avatar.Serialize(pData);
			}
		}

		// Token: 0x06006EC0 RID: 28352 RVA: 0x003F0FCC File Offset: 0x003EF1CC
		public List<short> GetPotentialFeatureIds()
		{
			return this._potentialFeatureIds;
		}

		// Token: 0x06006EC1 RID: 28353 RVA: 0x003F0FE4 File Offset: 0x003EF1E4
		public unsafe void SetPotentialFeatureIds(List<short> potentialFeatureIds, DataContext context)
		{
			this._potentialFeatureIds = potentialFeatureIds;
			base.SetModifiedAndInvalidateInfluencedCache(40, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				int elementsCount = this._potentialFeatureIds.Count;
				int contentSize = 2 * elementsCount;
				int dataSize = 2 + contentSize;
				byte* pData = OperationAdder.DynamicObjectCollection_SetDynamicField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 2, dataSize);
				*(short*)pData = (short)((ushort)elementsCount);
				pData += 2;
				for (int i = 0; i < elementsCount; i++)
				{
					*(short*)(pData + (IntPtr)i * 2) = this._potentialFeatureIds[i];
				}
				pData += contentSize;
			}
		}

		// Token: 0x06006EC2 RID: 28354 RVA: 0x003F108C File Offset: 0x003EF28C
		public List<FameActionRecord> GetFameActionRecords()
		{
			return this._fameActionRecords;
		}

		// Token: 0x06006EC3 RID: 28355 RVA: 0x003F10A4 File Offset: 0x003EF2A4
		public unsafe void SetFameActionRecords(List<FameActionRecord> fameActionRecords, DataContext context)
		{
			this._fameActionRecords = fameActionRecords;
			base.SetModifiedAndInvalidateInfluencedCache(41, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				int elementsCount = this._fameActionRecords.Count;
				int contentSize = 8 * elementsCount;
				int dataSize = 2 + contentSize;
				byte* pData = OperationAdder.DynamicObjectCollection_SetDynamicField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 3, dataSize);
				*(short*)pData = (short)((ushort)elementsCount);
				pData += 2;
				for (int i = 0; i < elementsCount; i++)
				{
					pData += this._fameActionRecords[i].Serialize(pData);
				}
			}
		}

		// Token: 0x06006EC4 RID: 28356 RVA: 0x003F114C File Offset: 0x003EF34C
		public ref Genome GetGenome()
		{
			return ref this._genome;
		}

		// Token: 0x06006EC5 RID: 28357 RVA: 0x003F1164 File Offset: 0x003EF364
		public MainAttributes GetCurrMainAttributes()
		{
			return this._currMainAttributes;
		}

		// Token: 0x06006EC6 RID: 28358 RVA: 0x003F117C File Offset: 0x003EF37C
		public unsafe void SetCurrMainAttributes(MainAttributes currMainAttributes, DataContext context)
		{
			this._currMainAttributes = currMainAttributes;
			base.SetModifiedAndInvalidateInfluencedCache(43, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 325U, 12);
				pData += this._currMainAttributes.Serialize(pData);
			}
		}

		// Token: 0x06006EC7 RID: 28359 RVA: 0x003F11E4 File Offset: 0x003EF3E4
		public ref PoisonInts GetPoisoned()
		{
			return ref this._poisoned;
		}

		// Token: 0x06006EC8 RID: 28360 RVA: 0x003F11FC File Offset: 0x003EF3FC
		public unsafe void SetPoisoned(ref PoisonInts poisoned, DataContext context)
		{
			this._poisoned = poisoned;
			base.SetModifiedAndInvalidateInfluencedCache(44, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 337U, 24);
				pData += this._poisoned.Serialize(pData);
			}
		}

		// Token: 0x06006EC9 RID: 28361 RVA: 0x003F126C File Offset: 0x003EF46C
		public byte[] GetInjuriesRecoveryProgress()
		{
			return this._injuriesRecoveryProgress;
		}

		// Token: 0x06006ECA RID: 28362 RVA: 0x003F1284 File Offset: 0x003EF484
		public unsafe void SetInjuriesRecoveryProgress(byte[] injuriesRecoveryProgress, DataContext context)
		{
			this._injuriesRecoveryProgress = injuriesRecoveryProgress;
			base.SetModifiedAndInvalidateInfluencedCache(45, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 361U, 14);
				for (int i = 0; i < 14; i++)
				{
					pData[i] = this._injuriesRecoveryProgress[i];
				}
				pData += 14;
			}
		}

		// Token: 0x06006ECB RID: 28363 RVA: 0x003F1300 File Offset: 0x003EF500
		public int GetCurrNeili()
		{
			return this._currNeili;
		}

		// Token: 0x06006ECC RID: 28364 RVA: 0x003F1318 File Offset: 0x003EF518
		public unsafe void SetCurrNeili(int currNeili, DataContext context)
		{
			this._currNeili = currNeili;
			base.SetModifiedAndInvalidateInfluencedCache(46, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 375U, 4);
				*(int*)pData = this._currNeili;
				pData += 4;
			}
		}

		// Token: 0x06006ECD RID: 28365 RVA: 0x003F137C File Offset: 0x003EF57C
		public short GetLoopingNeigong()
		{
			return this._loopingNeigong;
		}

		// Token: 0x06006ECE RID: 28366 RVA: 0x003F1394 File Offset: 0x003EF594
		public unsafe void SetLoopingNeigong(short loopingNeigong, DataContext context)
		{
			this._loopingNeigong = loopingNeigong;
			base.SetModifiedAndInvalidateInfluencedCache(47, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 379U, 2);
				*(short*)pData = this._loopingNeigong;
				pData += 2;
			}
		}

		// Token: 0x06006ECF RID: 28367 RVA: 0x003F13F8 File Offset: 0x003EF5F8
		public NeiliAllocation GetBaseNeiliAllocation()
		{
			return this._baseNeiliAllocation;
		}

		// Token: 0x06006ED0 RID: 28368 RVA: 0x003F1410 File Offset: 0x003EF610
		public unsafe void SetBaseNeiliAllocation(NeiliAllocation baseNeiliAllocation, DataContext context)
		{
			this._baseNeiliAllocation = baseNeiliAllocation;
			base.SetModifiedAndInvalidateInfluencedCache(48, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 381U, 8);
				pData += this._baseNeiliAllocation.Serialize(pData);
			}
		}

		// Token: 0x06006ED1 RID: 28369 RVA: 0x003F1478 File Offset: 0x003EF678
		public NeiliAllocation GetExtraNeiliAllocation()
		{
			return this._extraNeiliAllocation;
		}

		// Token: 0x06006ED2 RID: 28370 RVA: 0x003F1490 File Offset: 0x003EF690
		public unsafe void SetExtraNeiliAllocation(NeiliAllocation extraNeiliAllocation, DataContext context)
		{
			this._extraNeiliAllocation = extraNeiliAllocation;
			base.SetModifiedAndInvalidateInfluencedCache(49, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 389U, 8);
				pData += this._extraNeiliAllocation.Serialize(pData);
			}
		}

		// Token: 0x06006ED3 RID: 28371 RVA: 0x003F14F8 File Offset: 0x003EF6F8
		public NeiliProportionOfFiveElements GetBaseNeiliProportionOfFiveElements()
		{
			return this._baseNeiliProportionOfFiveElements;
		}

		// Token: 0x06006ED4 RID: 28372 RVA: 0x003F1510 File Offset: 0x003EF710
		public unsafe void SetBaseNeiliProportionOfFiveElements(NeiliProportionOfFiveElements baseNeiliProportionOfFiveElements, DataContext context)
		{
			this._baseNeiliProportionOfFiveElements = baseNeiliProportionOfFiveElements;
			base.SetModifiedAndInvalidateInfluencedCache(50, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 397U, 8);
				pData += this._baseNeiliProportionOfFiveElements.Serialize(pData);
			}
		}

		// Token: 0x06006ED5 RID: 28373 RVA: 0x003F1578 File Offset: 0x003EF778
		public int GetHobbyExpirationDate()
		{
			return this._hobbyExpirationDate;
		}

		// Token: 0x06006ED6 RID: 28374 RVA: 0x003F1590 File Offset: 0x003EF790
		public unsafe void SetHobbyExpirationDate(int hobbyExpirationDate, DataContext context)
		{
			this._hobbyExpirationDate = hobbyExpirationDate;
			base.SetModifiedAndInvalidateInfluencedCache(51, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 405U, 4);
				*(int*)pData = this._hobbyExpirationDate;
				pData += 4;
			}
		}

		// Token: 0x06006ED7 RID: 28375 RVA: 0x003F15F4 File Offset: 0x003EF7F4
		public bool GetLovingItemRevealed()
		{
			return this._lovingItemRevealed;
		}

		// Token: 0x06006ED8 RID: 28376 RVA: 0x003F160C File Offset: 0x003EF80C
		public unsafe void SetLovingItemRevealed(bool lovingItemRevealed, DataContext context)
		{
			this._lovingItemRevealed = lovingItemRevealed;
			base.SetModifiedAndInvalidateInfluencedCache(52, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 409U, 1);
				*pData = (this._lovingItemRevealed ? 1 : 0);
				pData++;
			}
		}

		// Token: 0x06006ED9 RID: 28377 RVA: 0x003F1670 File Offset: 0x003EF870
		public bool GetHatingItemRevealed()
		{
			return this._hatingItemRevealed;
		}

		// Token: 0x06006EDA RID: 28378 RVA: 0x003F1688 File Offset: 0x003EF888
		public unsafe void SetHatingItemRevealed(bool hatingItemRevealed, DataContext context)
		{
			this._hatingItemRevealed = hatingItemRevealed;
			base.SetModifiedAndInvalidateInfluencedCache(53, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 410U, 1);
				*pData = (this._hatingItemRevealed ? 1 : 0);
				pData++;
			}
		}

		// Token: 0x06006EDB RID: 28379 RVA: 0x003F16EC File Offset: 0x003EF8EC
		public sbyte GetLegitimateBoysCount()
		{
			return this._legitimateBoysCount;
		}

		// Token: 0x06006EDC RID: 28380 RVA: 0x003F1704 File Offset: 0x003EF904
		public unsafe void SetLegitimateBoysCount(sbyte legitimateBoysCount, DataContext context)
		{
			this._legitimateBoysCount = legitimateBoysCount;
			base.SetModifiedAndInvalidateInfluencedCache(54, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 411U, 1);
				*pData = (byte)this._legitimateBoysCount;
				pData++;
			}
		}

		// Token: 0x06006EDD RID: 28381 RVA: 0x003F1768 File Offset: 0x003EF968
		public Location GetBirthLocation()
		{
			return this._birthLocation;
		}

		// Token: 0x06006EDE RID: 28382 RVA: 0x003F1780 File Offset: 0x003EF980
		public Location GetLocation()
		{
			return this._location;
		}

		// Token: 0x06006EDF RID: 28383 RVA: 0x003F1798 File Offset: 0x003EF998
		public unsafe void SetLocation(Location location, DataContext context)
		{
			this._location = location;
			base.SetModifiedAndInvalidateInfluencedCache(56, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 416U, 4);
				pData += this._location.Serialize(pData);
			}
		}

		// Token: 0x06006EE0 RID: 28384 RVA: 0x003F1800 File Offset: 0x003EFA00
		public ItemKey[] GetEquipment()
		{
			return this._equipment;
		}

		// Token: 0x06006EE1 RID: 28385 RVA: 0x003F1818 File Offset: 0x003EFA18
		public unsafe void SetEquipment(ItemKey[] equipment, DataContext context)
		{
			this._equipment = equipment;
			base.SetModifiedAndInvalidateInfluencedCache(57, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 420U, 96);
				for (int i = 0; i < 12; i++)
				{
					pData += this._equipment[i].Serialize(pData);
				}
			}
		}

		// Token: 0x06006EE2 RID: 28386 RVA: 0x003F1898 File Offset: 0x003EFA98
		public Inventory GetInventory()
		{
			return this._inventory;
		}

		// Token: 0x06006EE3 RID: 28387 RVA: 0x003F18B0 File Offset: 0x003EFAB0
		public unsafe void SetInventory(Inventory inventory, DataContext context)
		{
			this._inventory = inventory;
			base.SetModifiedAndInvalidateInfluencedCache(58, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				int dataSize = this._inventory.GetSerializedSize();
				byte* pData = OperationAdder.DynamicObjectCollection_SetDynamicField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 4, dataSize);
				pData += this._inventory.Serialize(pData);
			}
		}

		// Token: 0x06006EE4 RID: 28388 RVA: 0x003F1920 File Offset: 0x003EFB20
		public ref EatingItems GetEatingItems()
		{
			return ref this._eatingItems;
		}

		// Token: 0x06006EE5 RID: 28389 RVA: 0x003F1938 File Offset: 0x003EFB38
		public unsafe void SetEatingItems(ref EatingItems eatingItems, DataContext context)
		{
			this._eatingItems = eatingItems;
			base.SetModifiedAndInvalidateInfluencedCache(59, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 516U, 90);
				pData += this._eatingItems.Serialize(pData);
			}
		}

		// Token: 0x06006EE6 RID: 28390 RVA: 0x003F19A8 File Offset: 0x003EFBA8
		public List<short> GetLearnedCombatSkills()
		{
			return this._learnedCombatSkills;
		}

		// Token: 0x06006EE7 RID: 28391 RVA: 0x003F19C0 File Offset: 0x003EFBC0
		public unsafe void SetLearnedCombatSkills(List<short> learnedCombatSkills, DataContext context)
		{
			this._learnedCombatSkills = learnedCombatSkills;
			base.SetModifiedAndInvalidateInfluencedCache(60, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				int elementsCount = this._learnedCombatSkills.Count;
				int contentSize = 2 * elementsCount;
				int dataSize = 2 + contentSize;
				byte* pData = OperationAdder.DynamicObjectCollection_SetDynamicField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 5, dataSize);
				*(short*)pData = (short)((ushort)elementsCount);
				pData += 2;
				for (int i = 0; i < elementsCount; i++)
				{
					*(short*)(pData + (IntPtr)i * 2) = this._learnedCombatSkills[i];
				}
				pData += contentSize;
			}
		}

		// Token: 0x06006EE8 RID: 28392 RVA: 0x003F1A68 File Offset: 0x003EFC68
		public short[] GetEquippedCombatSkills()
		{
			return this._equippedCombatSkills;
		}

		// Token: 0x06006EE9 RID: 28393 RVA: 0x003F1A80 File Offset: 0x003EFC80
		public unsafe void SetEquippedCombatSkills(short[] equippedCombatSkills, DataContext context)
		{
			this._equippedCombatSkills = equippedCombatSkills;
			base.SetModifiedAndInvalidateInfluencedCache(61, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 606U, 96);
				for (int i = 0; i < 48; i++)
				{
					*(short*)(pData + (IntPtr)i * 2) = this._equippedCombatSkills[i];
				}
				pData += 96;
			}
		}

		// Token: 0x06006EEA RID: 28394 RVA: 0x003F1B00 File Offset: 0x003EFD00
		public short[] GetCombatSkillAttainmentPanels()
		{
			return this._combatSkillAttainmentPanels;
		}

		// Token: 0x06006EEB RID: 28395 RVA: 0x003F1B18 File Offset: 0x003EFD18
		public unsafe void SetCombatSkillAttainmentPanels(short[] combatSkillAttainmentPanels, DataContext context)
		{
			this._combatSkillAttainmentPanels = combatSkillAttainmentPanels;
			base.SetModifiedAndInvalidateInfluencedCache(62, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 702U, 252);
				for (int i = 0; i < 126; i++)
				{
					*(short*)(pData + (IntPtr)i * 2) = this._combatSkillAttainmentPanels[i];
				}
				pData += 252;
			}
		}

		// Token: 0x06006EEC RID: 28396 RVA: 0x003F1B9C File Offset: 0x003EFD9C
		public List<SkillQualificationBonus> GetSkillQualificationBonuses()
		{
			return this._skillQualificationBonuses;
		}

		// Token: 0x06006EED RID: 28397 RVA: 0x003F1BB4 File Offset: 0x003EFDB4
		public unsafe void SetSkillQualificationBonuses(List<SkillQualificationBonus> skillQualificationBonuses, DataContext context)
		{
			this._skillQualificationBonuses = skillQualificationBonuses;
			base.SetModifiedAndInvalidateInfluencedCache(63, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				int elementsCount = this._skillQualificationBonuses.Count;
				int contentSize = 4 * elementsCount;
				int dataSize = 2 + contentSize;
				byte* pData = OperationAdder.DynamicObjectCollection_SetDynamicField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 6, dataSize);
				*(short*)pData = (short)((ushort)elementsCount);
				pData += 2;
				for (int i = 0; i < elementsCount; i++)
				{
					pData += this._skillQualificationBonuses[i].Serialize(pData);
				}
			}
		}

		// Token: 0x06006EEE RID: 28398 RVA: 0x003F1C5C File Offset: 0x003EFE5C
		public ref PreexistenceCharIds GetPreexistenceCharIds()
		{
			return ref this._preexistenceCharIds;
		}

		// Token: 0x06006EEF RID: 28399 RVA: 0x003F1C74 File Offset: 0x003EFE74
		public byte GetXiangshuInfection()
		{
			return this._xiangshuInfection;
		}

		// Token: 0x06006EF0 RID: 28400 RVA: 0x003F1C8C File Offset: 0x003EFE8C
		public unsafe void SetXiangshuInfection(byte xiangshuInfection, DataContext context)
		{
			this._xiangshuInfection = xiangshuInfection;
			base.SetModifiedAndInvalidateInfluencedCache(65, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 1006U, 1);
				*pData = this._xiangshuInfection;
				pData++;
			}
		}

		// Token: 0x06006EF1 RID: 28401 RVA: 0x003F1CF0 File Offset: 0x003EFEF0
		public short GetCurrAge()
		{
			return this._currAge;
		}

		// Token: 0x06006EF2 RID: 28402 RVA: 0x003F1D08 File Offset: 0x003EFF08
		public unsafe void SetCurrAge(short currAge, DataContext context)
		{
			this._currAge = currAge;
			base.SetModifiedAndInvalidateInfluencedCache(66, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 1007U, 2);
				*(short*)pData = this._currAge;
				pData += 2;
			}
		}

		// Token: 0x06006EF3 RID: 28403 RVA: 0x003F1D6C File Offset: 0x003EFF6C
		public int GetExp()
		{
			return this._exp;
		}

		// Token: 0x06006EF4 RID: 28404 RVA: 0x003F1D84 File Offset: 0x003EFF84
		public unsafe void SetExp(int exp, DataContext context)
		{
			this._exp = exp;
			base.SetModifiedAndInvalidateInfluencedCache(67, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 1009U, 4);
				*(int*)pData = this._exp;
				pData += 4;
			}
		}

		// Token: 0x06006EF5 RID: 28405 RVA: 0x003F1DE8 File Offset: 0x003EFFE8
		public byte GetExternalRelationState()
		{
			return this._externalRelationState;
		}

		// Token: 0x06006EF6 RID: 28406 RVA: 0x003F1E00 File Offset: 0x003F0000
		public unsafe void SetExternalRelationState(byte externalRelationState, DataContext context)
		{
			this._externalRelationState = externalRelationState;
			base.SetModifiedAndInvalidateInfluencedCache(68, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 1013U, 1);
				*pData = this._externalRelationState;
				pData++;
			}
		}

		// Token: 0x06006EF7 RID: 28407 RVA: 0x003F1E64 File Offset: 0x003F0064
		public int GetKidnapperId()
		{
			return this._kidnapperId;
		}

		// Token: 0x06006EF8 RID: 28408 RVA: 0x003F1E7C File Offset: 0x003F007C
		public unsafe void SetKidnapperId(int kidnapperId, DataContext context)
		{
			this._kidnapperId = kidnapperId;
			base.SetModifiedAndInvalidateInfluencedCache(69, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 1014U, 4);
				*(int*)pData = this._kidnapperId;
				pData += 4;
			}
		}

		// Token: 0x06006EF9 RID: 28409 RVA: 0x003F1EE0 File Offset: 0x003F00E0
		public int GetLeaderId()
		{
			return this._leaderId;
		}

		// Token: 0x06006EFA RID: 28410 RVA: 0x003F1EF8 File Offset: 0x003F00F8
		public unsafe void SetLeaderId(int leaderId, DataContext context)
		{
			this._leaderId = leaderId;
			base.SetModifiedAndInvalidateInfluencedCache(70, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 1018U, 4);
				*(int*)pData = this._leaderId;
				pData += 4;
			}
		}

		// Token: 0x06006EFB RID: 28411 RVA: 0x003F1F5C File Offset: 0x003F015C
		public int GetFactionId()
		{
			return this._factionId;
		}

		// Token: 0x06006EFC RID: 28412 RVA: 0x003F1F74 File Offset: 0x003F0174
		public unsafe void SetFactionId(int factionId, DataContext context)
		{
			this._factionId = factionId;
			base.SetModifiedAndInvalidateInfluencedCache(71, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 1022U, 4);
				*(int*)pData = this._factionId;
				pData += 4;
			}
		}

		// Token: 0x06006EFD RID: 28413 RVA: 0x003F1FD8 File Offset: 0x003F01D8
		public List<GameData.Domains.Character.Ai.PersonalNeed> GetPersonalNeeds()
		{
			return this._personalNeeds;
		}

		// Token: 0x06006EFE RID: 28414 RVA: 0x003F1FF0 File Offset: 0x003F01F0
		public unsafe void SetPersonalNeeds(List<GameData.Domains.Character.Ai.PersonalNeed> personalNeeds, DataContext context)
		{
			this._personalNeeds = personalNeeds;
			base.SetModifiedAndInvalidateInfluencedCache(72, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				int elementsCount = this._personalNeeds.Count;
				int contentSize = 8 * elementsCount;
				int dataSize = 2 + contentSize;
				byte* pData = OperationAdder.DynamicObjectCollection_SetDynamicField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 7, dataSize);
				*(short*)pData = (short)((ushort)elementsCount);
				pData += 2;
				for (int i = 0; i < elementsCount; i++)
				{
					pData += this._personalNeeds[i].Serialize(pData);
				}
			}
		}

		// Token: 0x06006EFF RID: 28415 RVA: 0x003F2098 File Offset: 0x003F0298
		public ActionEnergySbytes GetActionEnergies()
		{
			return this._actionEnergies;
		}

		// Token: 0x06006F00 RID: 28416 RVA: 0x003F20B0 File Offset: 0x003F02B0
		public unsafe void SetActionEnergies(ActionEnergySbytes actionEnergies, DataContext context)
		{
			this._actionEnergies = actionEnergies;
			base.SetModifiedAndInvalidateInfluencedCache(73, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 1026U, 5);
				pData += this._actionEnergies.Serialize(pData);
			}
		}

		// Token: 0x06006F01 RID: 28417 RVA: 0x003F2118 File Offset: 0x003F0318
		public List<NpcTravelTarget> GetNpcTravelTargets()
		{
			return this._npcTravelTargets;
		}

		// Token: 0x06006F02 RID: 28418 RVA: 0x003F2130 File Offset: 0x003F0330
		public unsafe void SetNpcTravelTargets(List<NpcTravelTarget> npcTravelTargets, DataContext context)
		{
			this._npcTravelTargets = npcTravelTargets;
			base.SetModifiedAndInvalidateInfluencedCache(74, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				int elementsCount = this._npcTravelTargets.Count;
				int contentSize = 16 * elementsCount;
				int dataSize = 2 + contentSize;
				byte* pData = OperationAdder.DynamicObjectCollection_SetDynamicField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 8, dataSize);
				*(short*)pData = (short)((ushort)elementsCount);
				pData += 2;
				for (int i = 0; i < elementsCount; i++)
				{
					pData += this._npcTravelTargets[i].Serialize(pData);
				}
			}
		}

		// Token: 0x06006F03 RID: 28419 RVA: 0x003F21D8 File Offset: 0x003F03D8
		public PrioritizedActionCooldownSbytes GetPrioritizedActionCooldowns()
		{
			return this._prioritizedActionCooldowns;
		}

		// Token: 0x06006F04 RID: 28420 RVA: 0x003F21F0 File Offset: 0x003F03F0
		public unsafe void SetPrioritizedActionCooldowns(PrioritizedActionCooldownSbytes prioritizedActionCooldowns, DataContext context)
		{
			this._prioritizedActionCooldowns = prioritizedActionCooldowns;
			base.SetModifiedAndInvalidateInfluencedCache(75, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 1031U, 9);
				pData += this._prioritizedActionCooldowns.Serialize(pData);
			}
		}

		// Token: 0x06006F05 RID: 28421 RVA: 0x003F2258 File Offset: 0x003F0458
		public short GetPhysiologicalAge()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 76);
			short physiologicalAge;
			if (flag)
			{
				physiologicalAge = this._physiologicalAge;
			}
			else
			{
				short value = this.CalcPhysiologicalAge();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._physiologicalAge = value;
					dataStates.SetCached(this.DataStatesOffset, 76);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				physiologicalAge = this._physiologicalAge;
			}
			return physiologicalAge;
		}

		// Token: 0x06006F06 RID: 28422 RVA: 0x003F2300 File Offset: 0x003F0500
		public sbyte GetFame()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 77);
			sbyte fame;
			if (flag)
			{
				fame = this._fame;
			}
			else
			{
				sbyte value = this.CalcFame();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._fame = value;
					dataStates.SetCached(this.DataStatesOffset, 77);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				fame = this._fame;
			}
			return fame;
		}

		// Token: 0x06006F07 RID: 28423 RVA: 0x003F23A8 File Offset: 0x003F05A8
		public short GetMorality()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 78);
			short morality;
			if (flag)
			{
				morality = this._morality;
			}
			else
			{
				short value = this.CalcMorality();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._morality = value;
					dataStates.SetCached(this.DataStatesOffset, 78);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				morality = this._morality;
			}
			return morality;
		}

		// Token: 0x06006F08 RID: 28424 RVA: 0x003F2450 File Offset: 0x003F0650
		public short GetAttraction()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 79);
			short attraction;
			if (flag)
			{
				attraction = this._attraction;
			}
			else
			{
				short value = this.CalcAttraction();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._attraction = value;
					dataStates.SetCached(this.DataStatesOffset, 79);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				attraction = this._attraction;
			}
			return attraction;
		}

		// Token: 0x06006F09 RID: 28425 RVA: 0x003F24F8 File Offset: 0x003F06F8
		public MainAttributes GetMaxMainAttributes()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 80);
			MainAttributes maxMainAttributes;
			if (flag)
			{
				maxMainAttributes = this._maxMainAttributes;
			}
			else
			{
				MainAttributes value = this.CalcMaxMainAttributes();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._maxMainAttributes = value;
					dataStates.SetCached(this.DataStatesOffset, 80);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				maxMainAttributes = this._maxMainAttributes;
			}
			return maxMainAttributes;
		}

		// Token: 0x06006F0A RID: 28426 RVA: 0x003F25A0 File Offset: 0x003F07A0
		public HitOrAvoidInts GetHitValues()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 81);
			HitOrAvoidInts hitValues;
			if (flag)
			{
				hitValues = this._hitValues;
			}
			else
			{
				HitOrAvoidInts value = this.CalcHitValues();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._hitValues = value;
					dataStates.SetCached(this.DataStatesOffset, 81);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				hitValues = this._hitValues;
			}
			return hitValues;
		}

		// Token: 0x06006F0B RID: 28427 RVA: 0x003F2648 File Offset: 0x003F0848
		public OuterAndInnerInts GetPenetrations()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 82);
			OuterAndInnerInts penetrations;
			if (flag)
			{
				penetrations = this._penetrations;
			}
			else
			{
				OuterAndInnerInts value = this.CalcPenetrations();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._penetrations = value;
					dataStates.SetCached(this.DataStatesOffset, 82);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				penetrations = this._penetrations;
			}
			return penetrations;
		}

		// Token: 0x06006F0C RID: 28428 RVA: 0x003F26F0 File Offset: 0x003F08F0
		public HitOrAvoidInts GetAvoidValues()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 83);
			HitOrAvoidInts avoidValues;
			if (flag)
			{
				avoidValues = this._avoidValues;
			}
			else
			{
				HitOrAvoidInts value = this.CalcAvoidValues();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._avoidValues = value;
					dataStates.SetCached(this.DataStatesOffset, 83);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				avoidValues = this._avoidValues;
			}
			return avoidValues;
		}

		// Token: 0x06006F0D RID: 28429 RVA: 0x003F2798 File Offset: 0x003F0998
		public OuterAndInnerInts GetPenetrationResists()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 84);
			OuterAndInnerInts penetrationResists;
			if (flag)
			{
				penetrationResists = this._penetrationResists;
			}
			else
			{
				OuterAndInnerInts value = this.CalcPenetrationResists();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._penetrationResists = value;
					dataStates.SetCached(this.DataStatesOffset, 84);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				penetrationResists = this._penetrationResists;
			}
			return penetrationResists;
		}

		// Token: 0x06006F0E RID: 28430 RVA: 0x003F2840 File Offset: 0x003F0A40
		public OuterAndInnerShorts GetRecoveryOfStanceAndBreath()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 85);
			OuterAndInnerShorts recoveryOfStanceAndBreath;
			if (flag)
			{
				recoveryOfStanceAndBreath = this._recoveryOfStanceAndBreath;
			}
			else
			{
				OuterAndInnerShorts value = this.CalcRecoveryOfStanceAndBreath();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._recoveryOfStanceAndBreath = value;
					dataStates.SetCached(this.DataStatesOffset, 85);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				recoveryOfStanceAndBreath = this._recoveryOfStanceAndBreath;
			}
			return recoveryOfStanceAndBreath;
		}

		// Token: 0x06006F0F RID: 28431 RVA: 0x003F28E8 File Offset: 0x003F0AE8
		public short GetMoveSpeed()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 86);
			short moveSpeed;
			if (flag)
			{
				moveSpeed = this._moveSpeed;
			}
			else
			{
				short value = this.CalcMoveSpeed();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._moveSpeed = value;
					dataStates.SetCached(this.DataStatesOffset, 86);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				moveSpeed = this._moveSpeed;
			}
			return moveSpeed;
		}

		// Token: 0x06006F10 RID: 28432 RVA: 0x003F2990 File Offset: 0x003F0B90
		public short GetRecoveryOfFlaw()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 87);
			short recoveryOfFlaw;
			if (flag)
			{
				recoveryOfFlaw = this._recoveryOfFlaw;
			}
			else
			{
				short value = this.CalcRecoveryOfFlaw();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._recoveryOfFlaw = value;
					dataStates.SetCached(this.DataStatesOffset, 87);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				recoveryOfFlaw = this._recoveryOfFlaw;
			}
			return recoveryOfFlaw;
		}

		// Token: 0x06006F11 RID: 28433 RVA: 0x003F2A38 File Offset: 0x003F0C38
		public short GetCastSpeed()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 88);
			short castSpeed;
			if (flag)
			{
				castSpeed = this._castSpeed;
			}
			else
			{
				short value = this.CalcCastSpeed();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._castSpeed = value;
					dataStates.SetCached(this.DataStatesOffset, 88);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				castSpeed = this._castSpeed;
			}
			return castSpeed;
		}

		// Token: 0x06006F12 RID: 28434 RVA: 0x003F2AE0 File Offset: 0x003F0CE0
		public short GetRecoveryOfBlockedAcupoint()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 89);
			short recoveryOfBlockedAcupoint;
			if (flag)
			{
				recoveryOfBlockedAcupoint = this._recoveryOfBlockedAcupoint;
			}
			else
			{
				short value = this.CalcRecoveryOfBlockedAcupoint();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._recoveryOfBlockedAcupoint = value;
					dataStates.SetCached(this.DataStatesOffset, 89);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				recoveryOfBlockedAcupoint = this._recoveryOfBlockedAcupoint;
			}
			return recoveryOfBlockedAcupoint;
		}

		// Token: 0x06006F13 RID: 28435 RVA: 0x003F2B88 File Offset: 0x003F0D88
		public short GetWeaponSwitchSpeed()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 90);
			short weaponSwitchSpeed;
			if (flag)
			{
				weaponSwitchSpeed = this._weaponSwitchSpeed;
			}
			else
			{
				short value = this.CalcWeaponSwitchSpeed();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._weaponSwitchSpeed = value;
					dataStates.SetCached(this.DataStatesOffset, 90);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				weaponSwitchSpeed = this._weaponSwitchSpeed;
			}
			return weaponSwitchSpeed;
		}

		// Token: 0x06006F14 RID: 28436 RVA: 0x003F2C30 File Offset: 0x003F0E30
		public short GetAttackSpeed()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 91);
			short attackSpeed;
			if (flag)
			{
				attackSpeed = this._attackSpeed;
			}
			else
			{
				short value = this.CalcAttackSpeed();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._attackSpeed = value;
					dataStates.SetCached(this.DataStatesOffset, 91);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				attackSpeed = this._attackSpeed;
			}
			return attackSpeed;
		}

		// Token: 0x06006F15 RID: 28437 RVA: 0x003F2CD8 File Offset: 0x003F0ED8
		public short GetInnerRatio()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 92);
			short innerRatio;
			if (flag)
			{
				innerRatio = this._innerRatio;
			}
			else
			{
				short value = this.CalcInnerRatio();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._innerRatio = value;
					dataStates.SetCached(this.DataStatesOffset, 92);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				innerRatio = this._innerRatio;
			}
			return innerRatio;
		}

		// Token: 0x06006F16 RID: 28438 RVA: 0x003F2D80 File Offset: 0x003F0F80
		public short GetRecoveryOfQiDisorder()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 93);
			short recoveryOfQiDisorder;
			if (flag)
			{
				recoveryOfQiDisorder = this._recoveryOfQiDisorder;
			}
			else
			{
				short value = this.CalcRecoveryOfQiDisorder();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._recoveryOfQiDisorder = value;
					dataStates.SetCached(this.DataStatesOffset, 93);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				recoveryOfQiDisorder = this._recoveryOfQiDisorder;
			}
			return recoveryOfQiDisorder;
		}

		// Token: 0x06006F17 RID: 28439 RVA: 0x003F2E28 File Offset: 0x003F1028
		public ref PoisonInts GetPoisonResists()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 94);
			PoisonInts result;
			if (flag)
			{
				result = ref this._poisonResists;
			}
			else
			{
				PoisonInts value = this.CalcPoisonResists();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._poisonResists = value;
					dataStates.SetCached(this.DataStatesOffset, 94);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				result = ref this._poisonResists;
			}
			return ref result;
		}

		// Token: 0x06006F18 RID: 28440 RVA: 0x003F2ED0 File Offset: 0x003F10D0
		public short GetMaxHealth()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 95);
			short maxHealth;
			if (flag)
			{
				maxHealth = this._maxHealth;
			}
			else
			{
				short value = this.CalcMaxHealth();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._maxHealth = value;
					dataStates.SetCached(this.DataStatesOffset, 95);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				maxHealth = this._maxHealth;
			}
			return maxHealth;
		}

		// Token: 0x06006F19 RID: 28441 RVA: 0x003F2F78 File Offset: 0x003F1178
		public short GetFertility()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 96);
			short fertility;
			if (flag)
			{
				fertility = this._fertility;
			}
			else
			{
				short value = this.CalcFertility();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._fertility = value;
					dataStates.SetCached(this.DataStatesOffset, 96);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				fertility = this._fertility;
			}
			return fertility;
		}

		// Token: 0x06006F1A RID: 28442 RVA: 0x003F3020 File Offset: 0x003F1220
		public ref LifeSkillShorts GetLifeSkillQualifications()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 97);
			LifeSkillShorts result;
			if (flag)
			{
				result = ref this._lifeSkillQualifications;
			}
			else
			{
				LifeSkillShorts value = this.CalcLifeSkillQualifications();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._lifeSkillQualifications = value;
					dataStates.SetCached(this.DataStatesOffset, 97);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				result = ref this._lifeSkillQualifications;
			}
			return ref result;
		}

		// Token: 0x06006F1B RID: 28443 RVA: 0x003F30C8 File Offset: 0x003F12C8
		public ref LifeSkillShorts GetLifeSkillAttainments()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 98);
			LifeSkillShorts result;
			if (flag)
			{
				result = ref this._lifeSkillAttainments;
			}
			else
			{
				LifeSkillShorts value = this.CalcLifeSkillAttainments();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._lifeSkillAttainments = value;
					dataStates.SetCached(this.DataStatesOffset, 98);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				result = ref this._lifeSkillAttainments;
			}
			return ref result;
		}

		// Token: 0x06006F1C RID: 28444 RVA: 0x003F3170 File Offset: 0x003F1370
		public ref CombatSkillShorts GetCombatSkillQualifications()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 99);
			CombatSkillShorts result;
			if (flag)
			{
				result = ref this._combatSkillQualifications;
			}
			else
			{
				CombatSkillShorts value = this.CalcCombatSkillQualifications();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._combatSkillQualifications = value;
					dataStates.SetCached(this.DataStatesOffset, 99);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				result = ref this._combatSkillQualifications;
			}
			return ref result;
		}

		// Token: 0x06006F1D RID: 28445 RVA: 0x003F3218 File Offset: 0x003F1418
		public ref CombatSkillShorts GetCombatSkillAttainments()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 100);
			CombatSkillShorts result;
			if (flag)
			{
				result = ref this._combatSkillAttainments;
			}
			else
			{
				CombatSkillShorts value = this.CalcCombatSkillAttainments();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._combatSkillAttainments = value;
					dataStates.SetCached(this.DataStatesOffset, 100);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				result = ref this._combatSkillAttainments;
			}
			return ref result;
		}

		// Token: 0x06006F1E RID: 28446 RVA: 0x003F32C0 File Offset: 0x003F14C0
		public Personalities GetPersonalities()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 101);
			Personalities personalities;
			if (flag)
			{
				personalities = this._personalities;
			}
			else
			{
				Personalities value = this.CalcPersonalities();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._personalities = value;
					dataStates.SetCached(this.DataStatesOffset, 101);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				personalities = this._personalities;
			}
			return personalities;
		}

		// Token: 0x06006F1F RID: 28447 RVA: 0x003F3368 File Offset: 0x003F1568
		public sbyte GetHobbyChangingPeriod()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 102);
			sbyte hobbyChangingPeriod;
			if (flag)
			{
				hobbyChangingPeriod = this._hobbyChangingPeriod;
			}
			else
			{
				sbyte value = this.CalcHobbyChangingPeriod();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._hobbyChangingPeriod = value;
					dataStates.SetCached(this.DataStatesOffset, 102);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				hobbyChangingPeriod = this._hobbyChangingPeriod;
			}
			return hobbyChangingPeriod;
		}

		// Token: 0x06006F20 RID: 28448 RVA: 0x003F3410 File Offset: 0x003F1610
		public OuterAndInnerShorts GetFavorabilityChangingFactor()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 103);
			OuterAndInnerShorts favorabilityChangingFactor;
			if (flag)
			{
				favorabilityChangingFactor = this._favorabilityChangingFactor;
			}
			else
			{
				OuterAndInnerShorts value = this.CalcFavorabilityChangingFactor();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._favorabilityChangingFactor = value;
					dataStates.SetCached(this.DataStatesOffset, 103);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				favorabilityChangingFactor = this._favorabilityChangingFactor;
			}
			return favorabilityChangingFactor;
		}

		// Token: 0x06006F21 RID: 28449 RVA: 0x003F34B8 File Offset: 0x003F16B8
		public int GetMaxInventoryLoad()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 104);
			int maxInventoryLoad;
			if (flag)
			{
				maxInventoryLoad = this._maxInventoryLoad;
			}
			else
			{
				int value = this.CalcMaxInventoryLoad();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._maxInventoryLoad = value;
					dataStates.SetCached(this.DataStatesOffset, 104);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				maxInventoryLoad = this._maxInventoryLoad;
			}
			return maxInventoryLoad;
		}

		// Token: 0x06006F22 RID: 28450 RVA: 0x003F3560 File Offset: 0x003F1760
		public int GetCurrInventoryLoad()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 105);
			int currInventoryLoad;
			if (flag)
			{
				currInventoryLoad = this._currInventoryLoad;
			}
			else
			{
				int value = this.CalcCurrInventoryLoad();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._currInventoryLoad = value;
					dataStates.SetCached(this.DataStatesOffset, 105);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				currInventoryLoad = this._currInventoryLoad;
			}
			return currInventoryLoad;
		}

		// Token: 0x06006F23 RID: 28451 RVA: 0x003F3608 File Offset: 0x003F1808
		public int GetMaxEquipmentLoad()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 106);
			int maxEquipmentLoad;
			if (flag)
			{
				maxEquipmentLoad = this._maxEquipmentLoad;
			}
			else
			{
				int value = this.CalcMaxEquipmentLoad();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._maxEquipmentLoad = value;
					dataStates.SetCached(this.DataStatesOffset, 106);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				maxEquipmentLoad = this._maxEquipmentLoad;
			}
			return maxEquipmentLoad;
		}

		// Token: 0x06006F24 RID: 28452 RVA: 0x003F36B0 File Offset: 0x003F18B0
		public int GetCurrEquipmentLoad()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 107);
			int currEquipmentLoad;
			if (flag)
			{
				currEquipmentLoad = this._currEquipmentLoad;
			}
			else
			{
				int value = this.CalcCurrEquipmentLoad();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._currEquipmentLoad = value;
					dataStates.SetCached(this.DataStatesOffset, 107);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				currEquipmentLoad = this._currEquipmentLoad;
			}
			return currEquipmentLoad;
		}

		// Token: 0x06006F25 RID: 28453 RVA: 0x003F3758 File Offset: 0x003F1958
		public int GetInventoryTotalValue()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 108);
			int inventoryTotalValue;
			if (flag)
			{
				inventoryTotalValue = this._inventoryTotalValue;
			}
			else
			{
				int value = this.CalcInventoryTotalValue();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._inventoryTotalValue = value;
					dataStates.SetCached(this.DataStatesOffset, 108);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				inventoryTotalValue = this._inventoryTotalValue;
			}
			return inventoryTotalValue;
		}

		// Token: 0x06006F26 RID: 28454 RVA: 0x003F3800 File Offset: 0x003F1A00
		public int GetMaxNeili()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 109);
			int maxNeili;
			if (flag)
			{
				maxNeili = this._maxNeili;
			}
			else
			{
				int value = this.CalcMaxNeili();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._maxNeili = value;
					dataStates.SetCached(this.DataStatesOffset, 109);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				maxNeili = this._maxNeili;
			}
			return maxNeili;
		}

		// Token: 0x06006F27 RID: 28455 RVA: 0x003F38A8 File Offset: 0x003F1AA8
		public NeiliAllocation GetNeiliAllocation()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 110);
			NeiliAllocation neiliAllocation;
			if (flag)
			{
				neiliAllocation = this._neiliAllocation;
			}
			else
			{
				NeiliAllocation value = this.CalcNeiliAllocation();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._neiliAllocation = value;
					dataStates.SetCached(this.DataStatesOffset, 110);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				neiliAllocation = this._neiliAllocation;
			}
			return neiliAllocation;
		}

		// Token: 0x06006F28 RID: 28456 RVA: 0x003F3950 File Offset: 0x003F1B50
		public NeiliProportionOfFiveElements GetNeiliProportionOfFiveElements()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 111);
			NeiliProportionOfFiveElements neiliProportionOfFiveElements;
			if (flag)
			{
				neiliProportionOfFiveElements = this._neiliProportionOfFiveElements;
			}
			else
			{
				NeiliProportionOfFiveElements value = this.CalcNeiliProportionOfFiveElements();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._neiliProportionOfFiveElements = value;
					dataStates.SetCached(this.DataStatesOffset, 111);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				neiliProportionOfFiveElements = this._neiliProportionOfFiveElements;
			}
			return neiliProportionOfFiveElements;
		}

		// Token: 0x06006F29 RID: 28457 RVA: 0x003F39F8 File Offset: 0x003F1BF8
		public sbyte GetNeiliType()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 112);
			sbyte neiliType;
			if (flag)
			{
				neiliType = this._neiliType;
			}
			else
			{
				sbyte value = this.CalcNeiliType();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._neiliType = value;
					dataStates.SetCached(this.DataStatesOffset, 112);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				neiliType = this._neiliType;
			}
			return neiliType;
		}

		// Token: 0x06006F2A RID: 28458 RVA: 0x003F3AA0 File Offset: 0x003F1CA0
		public int GetCombatPower()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 113);
			int combatPower;
			if (flag)
			{
				combatPower = this._combatPower;
			}
			else
			{
				int value = this.CalcCombatPower();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._combatPower = value;
					dataStates.SetCached(this.DataStatesOffset, 113);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				combatPower = this._combatPower;
			}
			return combatPower;
		}

		// Token: 0x06006F2B RID: 28459 RVA: 0x003F3B48 File Offset: 0x003F1D48
		public sbyte GetAttackTendencyOfInnerAndOuter()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 114);
			sbyte attackTendencyOfInnerAndOuter;
			if (flag)
			{
				attackTendencyOfInnerAndOuter = this._attackTendencyOfInnerAndOuter;
			}
			else
			{
				sbyte value = this.CalcAttackTendencyOfInnerAndOuter();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._attackTendencyOfInnerAndOuter = value;
					dataStates.SetCached(this.DataStatesOffset, 114);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				attackTendencyOfInnerAndOuter = this._attackTendencyOfInnerAndOuter;
			}
			return attackTendencyOfInnerAndOuter;
		}

		// Token: 0x06006F2C RID: 28460 RVA: 0x003F3BF0 File Offset: 0x003F1DF0
		public NeiliAllocation GetAllocatedNeiliEffects()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 115);
			NeiliAllocation allocatedNeiliEffects;
			if (flag)
			{
				allocatedNeiliEffects = this._allocatedNeiliEffects;
			}
			else
			{
				NeiliAllocation value = this.CalcAllocatedNeiliEffects();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._allocatedNeiliEffects = value;
					dataStates.SetCached(this.DataStatesOffset, 115);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				allocatedNeiliEffects = this._allocatedNeiliEffects;
			}
			return allocatedNeiliEffects;
		}

		// Token: 0x06006F2D RID: 28461 RVA: 0x003F3C98 File Offset: 0x003F1E98
		public sbyte GetMaxConsummateLevel()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 116);
			sbyte maxConsummateLevel;
			if (flag)
			{
				maxConsummateLevel = this._maxConsummateLevel;
			}
			else
			{
				sbyte value = this.CalcMaxConsummateLevel();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._maxConsummateLevel = value;
					dataStates.SetCached(this.DataStatesOffset, 116);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				maxConsummateLevel = this._maxConsummateLevel;
			}
			return maxConsummateLevel;
		}

		// Token: 0x06006F2E RID: 28462 RVA: 0x003F3D40 File Offset: 0x003F1F40
		public CombatSkillEquipment GetCombatSkillEquipment()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 117);
			CombatSkillEquipment combatSkillEquipment;
			if (flag)
			{
				combatSkillEquipment = this._combatSkillEquipment;
			}
			else
			{
				CombatSkillEquipment value = new CombatSkillEquipment();
				this.CalcCombatSkillEquipment(value);
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._combatSkillEquipment.Assign(value);
					dataStates.SetCached(this.DataStatesOffset, 117);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				combatSkillEquipment = this._combatSkillEquipment;
			}
			return combatSkillEquipment;
		}

		// Token: 0x06006F2F RID: 28463 RVA: 0x003F3DF4 File Offset: 0x003F1FF4
		public uint GetDarkAshProtector()
		{
			ObjectCollectionDataStates dataStates = this.CollectionHelperData.DataStates;
			Thread.MemoryBarrier();
			bool flag = dataStates.IsCached(this.DataStatesOffset, 118);
			uint darkAshProtector;
			if (flag)
			{
				darkAshProtector = this._darkAshProtector;
			}
			else
			{
				uint value = this.CalcDarkAshProtector();
				bool lockTaken = false;
				try
				{
					this._spinLock.Enter(ref lockTaken);
					this._darkAshProtector = value;
					dataStates.SetCached(this.DataStatesOffset, 118);
				}
				finally
				{
					bool flag2 = lockTaken;
					if (flag2)
					{
						this._spinLock.Exit(false);
					}
				}
				Thread.MemoryBarrier();
				darkAshProtector = this._darkAshProtector;
			}
			return darkAshProtector;
		}

		// Token: 0x06006F30 RID: 28464 RVA: 0x003F3E9C File Offset: 0x003F209C
		[CollectionObjectField(true, false, false, false, false)]
		public string GetSurname()
		{
			return Character.Instance[this._templateId].Surname;
		}

		// Token: 0x06006F31 RID: 28465 RVA: 0x003F3EC4 File Offset: 0x003F20C4
		[CollectionObjectField(true, false, false, false, false)]
		public string GetGivenName()
		{
			return Character.Instance[this._templateId].GivenName;
		}

		// Token: 0x06006F32 RID: 28466 RVA: 0x003F3EEC File Offset: 0x003F20EC
		[CollectionObjectField(true, false, false, false, false)]
		public string GetAnonymousTitle()
		{
			return Character.Instance[this._templateId].AnonymousTitle;
		}

		// Token: 0x06006F33 RID: 28467 RVA: 0x003F3F14 File Offset: 0x003F2114
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetRandomFeaturesAtCreating()
		{
			return Character.Instance[this._templateId].RandomFeaturesAtCreating;
		}

		// Token: 0x06006F34 RID: 28468 RVA: 0x003F3F3C File Offset: 0x003F213C
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetAllowUseFreeWeapon()
		{
			return Character.Instance[this._templateId].AllowUseFreeWeapon;
		}

		// Token: 0x06006F35 RID: 28469 RVA: 0x003F3F64 File Offset: 0x003F2164
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetAllowEscape()
		{
			return Character.Instance[this._templateId].AllowEscape;
		}

		// Token: 0x06006F36 RID: 28470 RVA: 0x003F3F8C File Offset: 0x003F218C
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetAllowHeal()
		{
			return Character.Instance[this._templateId].AllowHeal;
		}

		// Token: 0x06006F37 RID: 28471 RVA: 0x003F3FB4 File Offset: 0x003F21B4
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetCanDefeat()
		{
			return Character.Instance[this._templateId].CanDefeat;
		}

		// Token: 0x06006F38 RID: 28472 RVA: 0x003F3FDC File Offset: 0x003F21DC
		[CollectionObjectField(true, false, false, false, false)]
		public short GetRandomEnemyId()
		{
			return Character.Instance[this._templateId].RandomEnemyId;
		}

		// Token: 0x06006F39 RID: 28473 RVA: 0x003F4004 File Offset: 0x003F2204
		[CollectionObjectField(true, false, false, false, false)]
		public short GetLeadingEnemyNestId()
		{
			return Character.Instance[this._templateId].LeadingEnemyNestId;
		}

		// Token: 0x06006F3A RID: 28474 RVA: 0x003F402C File Offset: 0x003F222C
		[CollectionObjectField(true, false, false, false, false)]
		public string GetFixedAvatarName()
		{
			return Character.Instance[this._templateId].FixedAvatarName;
		}

		// Token: 0x06006F3B RID: 28475 RVA: 0x003F4054 File Offset: 0x003F2254
		[CollectionObjectField(true, false, false, false, false)]
		public sbyte GetPresetBodyType()
		{
			return Character.Instance[this._templateId].PresetBodyType;
		}

		// Token: 0x06006F3C RID: 28476 RVA: 0x003F407C File Offset: 0x003F227C
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetHideAge()
		{
			return Character.Instance[this._templateId].HideAge;
		}

		// Token: 0x06006F3D RID: 28477 RVA: 0x003F40A4 File Offset: 0x003F22A4
		[CollectionObjectField(true, false, false, false, false)]
		public sbyte GetRace()
		{
			return Character.Instance[this._templateId].Race;
		}

		// Token: 0x06006F3E RID: 28478 RVA: 0x003F40CC File Offset: 0x003F22CC
		[CollectionObjectField(true, false, false, false, false)]
		public sbyte GetPresetFame()
		{
			return Character.Instance[this._templateId].PresetFame;
		}

		// Token: 0x06006F3F RID: 28479 RVA: 0x003F40F4 File Offset: 0x003F22F4
		[CollectionObjectField(true, false, false, false, false)]
		public short GetBaseAttraction()
		{
			return Character.Instance[this._templateId].BaseAttraction;
		}

		// Token: 0x06006F40 RID: 28480 RVA: 0x003F411C File Offset: 0x003F231C
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetCanBeKidnapped()
		{
			return Character.Instance[this._templateId].CanBeKidnapped;
		}

		// Token: 0x06006F41 RID: 28481 RVA: 0x003F4144 File Offset: 0x003F2344
		[CollectionObjectField(true, false, false, false, false)]
		public short GetFixWeaponPower()
		{
			return Character.Instance[this._templateId].FixWeaponPower;
		}

		// Token: 0x06006F42 RID: 28482 RVA: 0x003F416C File Offset: 0x003F236C
		[CollectionObjectField(true, false, false, false, false)]
		public short GetFixArmorPower()
		{
			return Character.Instance[this._templateId].FixArmorPower;
		}

		// Token: 0x06006F43 RID: 28483 RVA: 0x003F4194 File Offset: 0x003F2394
		[CollectionObjectField(true, false, false, false, false)]
		public short GetFixCombatSkillPower()
		{
			return Character.Instance[this._templateId].FixCombatSkillPower;
		}

		// Token: 0x06006F44 RID: 28484 RVA: 0x003F41BC File Offset: 0x003F23BC
		[CollectionObjectField(true, false, false, false, false)]
		public HitOrAvoidInts GetBaseHitValues()
		{
			return Character.Instance[this._templateId].BaseHitValues;
		}

		// Token: 0x06006F45 RID: 28485 RVA: 0x003F41E4 File Offset: 0x003F23E4
		[CollectionObjectField(true, false, false, false, false)]
		public OuterAndInnerInts GetBasePenetrations()
		{
			return Character.Instance[this._templateId].BasePenetrations;
		}

		// Token: 0x06006F46 RID: 28486 RVA: 0x003F420C File Offset: 0x003F240C
		[CollectionObjectField(true, false, false, false, false)]
		public HitOrAvoidInts GetBaseAvoidValues()
		{
			return Character.Instance[this._templateId].BaseAvoidValues;
		}

		// Token: 0x06006F47 RID: 28487 RVA: 0x003F4234 File Offset: 0x003F2434
		[CollectionObjectField(true, false, false, false, false)]
		public OuterAndInnerInts GetBasePenetrationResists()
		{
			return Character.Instance[this._templateId].BasePenetrationResists;
		}

		// Token: 0x06006F48 RID: 28488 RVA: 0x003F425C File Offset: 0x003F245C
		[CollectionObjectField(true, false, false, false, false)]
		public OuterAndInnerShorts GetBaseRecoveryOfStanceAndBreath()
		{
			return Character.Instance[this._templateId].BaseRecoveryOfStanceAndBreath;
		}

		// Token: 0x06006F49 RID: 28489 RVA: 0x003F4284 File Offset: 0x003F2484
		[CollectionObjectField(true, false, false, false, false)]
		public short GetBaseMoveSpeed()
		{
			return Character.Instance[this._templateId].BaseMoveSpeed;
		}

		// Token: 0x06006F4A RID: 28490 RVA: 0x003F42AC File Offset: 0x003F24AC
		[CollectionObjectField(true, false, false, false, false)]
		public short GetBaseRecoveryOfFlaw()
		{
			return Character.Instance[this._templateId].BaseRecoveryOfFlaw;
		}

		// Token: 0x06006F4B RID: 28491 RVA: 0x003F42D4 File Offset: 0x003F24D4
		[CollectionObjectField(true, false, false, false, false)]
		public short GetBaseCastSpeed()
		{
			return Character.Instance[this._templateId].BaseCastSpeed;
		}

		// Token: 0x06006F4C RID: 28492 RVA: 0x003F42FC File Offset: 0x003F24FC
		[CollectionObjectField(true, false, false, false, false)]
		public short GetBaseRecoveryOfBlockedAcupoint()
		{
			return Character.Instance[this._templateId].BaseRecoveryOfBlockedAcupoint;
		}

		// Token: 0x06006F4D RID: 28493 RVA: 0x003F4324 File Offset: 0x003F2524
		[CollectionObjectField(true, false, false, false, false)]
		public short GetBaseWeaponSwitchSpeed()
		{
			return Character.Instance[this._templateId].BaseWeaponSwitchSpeed;
		}

		// Token: 0x06006F4E RID: 28494 RVA: 0x003F434C File Offset: 0x003F254C
		[CollectionObjectField(true, false, false, false, false)]
		public short GetBaseAttackSpeed()
		{
			return Character.Instance[this._templateId].BaseAttackSpeed;
		}

		// Token: 0x06006F4F RID: 28495 RVA: 0x003F4374 File Offset: 0x003F2574
		[CollectionObjectField(true, false, false, false, false)]
		public short GetBaseInnerRatio()
		{
			return Character.Instance[this._templateId].BaseInnerRatio;
		}

		// Token: 0x06006F50 RID: 28496 RVA: 0x003F439C File Offset: 0x003F259C
		[CollectionObjectField(true, false, false, false, false)]
		public short GetBaseRecoveryOfQiDisorder()
		{
			return Character.Instance[this._templateId].BaseRecoveryOfQiDisorder;
		}

		// Token: 0x06006F51 RID: 28497 RVA: 0x003F43C4 File Offset: 0x003F25C4
		[CollectionObjectField(true, false, false, false, false)]
		public ref readonly PoisonInts GetBasePoisonResists()
		{
			return ref Character.Instance[this._templateId].BasePoisonResists;
		}

		// Token: 0x06006F52 RID: 28498 RVA: 0x003F43EC File Offset: 0x003F25EC
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetInnerInjuryImmunity()
		{
			return Character.Instance[this._templateId].InnerInjuryImmunity;
		}

		// Token: 0x06006F53 RID: 28499 RVA: 0x003F4414 File Offset: 0x003F2614
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetOuterInjuryImmunity()
		{
			return Character.Instance[this._templateId].OuterInjuryImmunity;
		}

		// Token: 0x06006F54 RID: 28500 RVA: 0x003F443C File Offset: 0x003F263C
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetMindImmunity()
		{
			return Character.Instance[this._templateId].MindImmunity;
		}

		// Token: 0x06006F55 RID: 28501 RVA: 0x003F4464 File Offset: 0x003F2664
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetFlawImmunity()
		{
			return Character.Instance[this._templateId].FlawImmunity;
		}

		// Token: 0x06006F56 RID: 28502 RVA: 0x003F448C File Offset: 0x003F268C
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetAcupointImmunity()
		{
			return Character.Instance[this._templateId].AcupointImmunity;
		}

		// Token: 0x06006F57 RID: 28503 RVA: 0x003F44B4 File Offset: 0x003F26B4
		[CollectionObjectField(true, false, false, false, false, ArrayElementsCount = 6)]
		public bool[] GetPoisonImmunities()
		{
			return Character.Instance[this._templateId].PoisonImmunities;
		}

		// Token: 0x06006F58 RID: 28504 RVA: 0x003F44DC File Offset: 0x003F26DC
		[CollectionObjectField(true, false, false, false, false, ArrayElementsCount = 12)]
		public PresetEquipmentItem[] GetPresetEquipment()
		{
			return Character.Instance[this._templateId].PresetEquipment;
		}

		// Token: 0x06006F59 RID: 28505 RVA: 0x003F4504 File Offset: 0x003F2704
		[CollectionObjectField(true, false, false, false, false)]
		public List<PresetInventoryItem> GetPresetInventory()
		{
			return Character.Instance[this._templateId].PresetInventory;
		}

		// Token: 0x06006F5A RID: 28506 RVA: 0x003F452C File Offset: 0x003F272C
		[CollectionObjectField(true, false, false, false, false)]
		public List<PresetCombatSkill> GetPresetCombatSkills()
		{
			return Character.Instance[this._templateId].PresetCombatSkills;
		}

		// Token: 0x06006F5B RID: 28507 RVA: 0x003F4554 File Offset: 0x003F2754
		[CollectionObjectField(true, false, false, false, false)]
		public NeiliProportionOfFiveElements GetPresetNeiliProportionOfFiveElements()
		{
			return Character.Instance[this._templateId].PresetNeiliProportionOfFiveElements;
		}

		// Token: 0x06006F5C RID: 28508 RVA: 0x003F457C File Offset: 0x003F277C
		[CollectionObjectField(true, false, false, false, false)]
		public short GetMinionGroupId()
		{
			return Character.Instance[this._templateId].MinionGroupId;
		}

		// Token: 0x06006F5D RID: 28509 RVA: 0x003F45A4 File Offset: 0x003F27A4
		[CollectionObjectField(true, false, false, false, false)]
		public DamageStepCollection GetDamageSteps()
		{
			return Character.Instance[this._templateId].DamageSteps;
		}

		// Token: 0x06006F5E RID: 28510 RVA: 0x003F45CC File Offset: 0x003F27CC
		[CollectionObjectField(true, false, false, false, false, ArrayElementsCount = 4)]
		public sbyte[] GetIdeaAllocationProportion()
		{
			return Character.Instance[this._templateId].IdeaAllocationProportion;
		}

		// Token: 0x06006F5F RID: 28511 RVA: 0x003F45F4 File Offset: 0x003F27F4
		[CollectionObjectField(true, false, false, false, false)]
		public int GetExtraEquipmentLoad()
		{
			return Character.Instance[this._templateId].ExtraEquipmentLoad;
		}

		// Token: 0x06006F60 RID: 28512 RVA: 0x003F461C File Offset: 0x003F281C
		[CollectionObjectField(true, false, false, false, false)]
		public short GetInitCurrAge()
		{
			return Character.Instance[this._templateId].InitCurrAge;
		}

		// Token: 0x06006F61 RID: 28513 RVA: 0x003F4644 File Offset: 0x003F2844
		[CollectionObjectField(true, false, false, false, false)]
		public List<sbyte> GetPresetTeammateCommands()
		{
			return Character.Instance[this._templateId].PresetTeammateCommands;
		}

		// Token: 0x06006F62 RID: 28514 RVA: 0x003F466C File Offset: 0x003F286C
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetIsFavorabilityDisplay()
		{
			return Character.Instance[this._templateId].IsFavorabilityDisplay;
		}

		// Token: 0x06006F63 RID: 28515 RVA: 0x003F4694 File Offset: 0x003F2894
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetFixedCharacterShowNameOnMap()
		{
			return Character.Instance[this._templateId].FixedCharacterShowNameOnMap;
		}

		// Token: 0x06006F64 RID: 28516 RVA: 0x003F46BC File Offset: 0x003F28BC
		[CollectionObjectField(true, false, false, false, false)]
		public sbyte GetSpecialCombatSkeleton()
		{
			return Character.Instance[this._templateId].SpecialCombatSkeleton;
		}

		// Token: 0x06006F65 RID: 28517 RVA: 0x003F46E4 File Offset: 0x003F28E4
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetDieImmunity()
		{
			return Character.Instance[this._templateId].DieImmunity;
		}

		// Token: 0x06006F66 RID: 28518 RVA: 0x003F470C File Offset: 0x003F290C
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetFatalImmunity()
		{
			return Character.Instance[this._templateId].FatalImmunity;
		}

		// Token: 0x06006F67 RID: 28519 RVA: 0x003F4734 File Offset: 0x003F2934
		[CollectionObjectField(true, false, false, false, false, ArrayElementsCount = 16)]
		public sbyte[] GetLearnedLifeSkillGrades()
		{
			return Character.Instance[this._templateId].LearnedLifeSkillGrades;
		}

		// Token: 0x06006F68 RID: 28520 RVA: 0x003F475C File Offset: 0x003F295C
		[CollectionObjectField(true, false, false, false, false)]
		public int GetCombatAi()
		{
			return Character.Instance[this._templateId].CombatAi;
		}

		// Token: 0x06006F69 RID: 28521 RVA: 0x003F4784 File Offset: 0x003F2984
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetCanMove()
		{
			return Character.Instance[this._templateId].CanMove;
		}

		// Token: 0x06006F6A RID: 28522 RVA: 0x003F47AC File Offset: 0x003F29AC
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetCanOpenCharacterMenu()
		{
			return Character.Instance[this._templateId].CanOpenCharacterMenu;
		}

		// Token: 0x06006F6B RID: 28523 RVA: 0x003F47D4 File Offset: 0x003F29D4
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetRandomAnimalAttack()
		{
			return Character.Instance[this._templateId].RandomAnimalAttack;
		}

		// Token: 0x06006F6C RID: 28524 RVA: 0x003F47FC File Offset: 0x003F29FC
		[CollectionObjectField(true, false, false, false, false)]
		public ref readonly ResourceInts GetDropResources()
		{
			return ref Character.Instance[this._templateId].DropResources;
		}

		// Token: 0x06006F6D RID: 28525 RVA: 0x003F4824 File Offset: 0x003F2A24
		[CollectionObjectField(true, false, false, false, false)]
		public string GetSpecialGradeName()
		{
			return Character.Instance[this._templateId].SpecialGradeName;
		}

		// Token: 0x06006F6E RID: 28526 RVA: 0x003F484C File Offset: 0x003F2A4C
		[CollectionObjectField(true, false, false, false, false, ArrayElementsCount = 4)]
		public sbyte[] GetExtraNeiliAllocationProgress()
		{
			return Character.Instance[this._templateId].ExtraNeiliAllocationProgress;
		}

		// Token: 0x06006F6F RID: 28527 RVA: 0x003F4874 File Offset: 0x003F2A74
		[CollectionObjectField(true, false, false, false, false)]
		public List<PresetItemTemplateId> GetPresetEatingItems()
		{
			return Character.Instance[this._templateId].PresetEatingItems;
		}

		// Token: 0x06006F70 RID: 28528 RVA: 0x003F489C File Offset: 0x003F2A9C
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetCanSpeak()
		{
			return Character.Instance[this._templateId].CanSpeak;
		}

		// Token: 0x06006F71 RID: 28529 RVA: 0x003F48C4 File Offset: 0x003F2AC4
		[CollectionObjectField(true, false, false, false, false, ArrayElementsCount = 4)]
		public sbyte[] GetRandomEnemyFavorability()
		{
			return Character.Instance[this._templateId].RandomEnemyFavorability;
		}

		// Token: 0x06006F72 RID: 28530 RVA: 0x003F48EC File Offset: 0x003F2AEC
		[CollectionObjectField(true, false, false, false, false)]
		public short GetGroupId()
		{
			return Character.Instance[this._templateId].GroupId;
		}

		// Token: 0x06006F73 RID: 28531 RVA: 0x003F4914 File Offset: 0x003F2B14
		[CollectionObjectField(true, false, false, false, false, ArrayElementsCount = 5)]
		public sbyte[] GetExtraCombatSkillGrids()
		{
			return Character.Instance[this._templateId].ExtraCombatSkillGrids;
		}

		// Token: 0x06006F74 RID: 28532 RVA: 0x003F493C File Offset: 0x003F2B3C
		[CollectionObjectField(true, false, false, false, false)]
		public ECharacterSpecialTemmateType GetSpecialTemmateType()
		{
			return Character.Instance[this._templateId].SpecialTemmateType;
		}

		// Token: 0x06006F75 RID: 28533 RVA: 0x003F4964 File Offset: 0x003F2B64
		[CollectionObjectField(true, false, false, false, false)]
		public List<sbyte> GetRandomIdealSects()
		{
			return Character.Instance[this._templateId].RandomIdealSects;
		}

		// Token: 0x06006F76 RID: 28534 RVA: 0x003F498C File Offset: 0x003F2B8C
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetAllowDropWugKing()
		{
			return Character.Instance[this._templateId].AllowDropWugKing;
		}

		// Token: 0x06006F77 RID: 28535 RVA: 0x003F49B4 File Offset: 0x003F2BB4
		[CollectionObjectField(true, false, false, false, false)]
		public bool GetAllowFavorabilitySkipCd()
		{
			return Character.Instance[this._templateId].AllowFavorabilitySkipCd;
		}

		// Token: 0x06006F78 RID: 28536 RVA: 0x003F49DC File Offset: 0x003F2BDC
		[CollectionObjectField(true, false, false, false, false)]
		public string GetSpecialMuteBubbleEnemy()
		{
			return Character.Instance[this._templateId].SpecialMuteBubbleEnemy;
		}

		// Token: 0x06006F79 RID: 28537 RVA: 0x003F4A04 File Offset: 0x003F2C04
		[CollectionObjectField(true, false, false, false, false)]
		public string GetSpecialMuteBubbleSelf()
		{
			return Character.Instance[this._templateId].SpecialMuteBubbleSelf;
		}

		// Token: 0x06006F7A RID: 28538 RVA: 0x003F4A2C File Offset: 0x003F2C2C
		[CollectionObjectField(true, false, false, false, false)]
		public int GetDropRatePercentAsTeammate()
		{
			return Character.Instance[this._templateId].DropRatePercentAsTeammate;
		}

		// Token: 0x06006F7B RID: 28539 RVA: 0x003F4A54 File Offset: 0x003F2C54
		[CollectionObjectField(true, false, false, false, false)]
		public int GetDropRatePercentAsMainChar()
		{
			return Character.Instance[this._templateId].DropRatePercentAsMainChar;
		}

		// Token: 0x06006F7C RID: 28540 RVA: 0x003F4A7C File Offset: 0x003F2C7C
		public Character()
		{
			this._featureIds = new List<short>();
			this._learnedLifeSkills = new List<LifeSkillItem>();
			this._avatar = new AvatarData();
			this._potentialFeatureIds = new List<short>();
			this._fameActionRecords = new List<FameActionRecord>();
			this._injuriesRecoveryProgress = new byte[14];
			this._equipment = new ItemKey[12];
			this._inventory = new Inventory();
			this._learnedCombatSkills = new List<short>();
			this._equippedCombatSkills = new short[48];
			this._combatSkillAttainmentPanels = new short[126];
			this._skillQualificationBonuses = new List<SkillQualificationBonus>();
			this._personalNeeds = new List<GameData.Domains.Character.Ai.PersonalNeed>();
			this._npcTravelTargets = new List<NpcTravelTarget>();
			this._combatSkillEquipment = new CombatSkillEquipment();
		}

		// Token: 0x06006F7D RID: 28541 RVA: 0x003F4B5C File Offset: 0x003F2D5C
		public Character(short templateId)
		{
			CharacterItem template = Character.Instance[templateId];
			this._templateId = template.TemplateId;
			this._creatingType = template.CreatingType;
			this._gender = template.Gender;
			this._actualAge = template.ActualAge;
			this._birthMonth = template.BirthMonth;
			this._happiness = template.Happiness;
			this._baseMorality = template.BaseMorality;
			this._organizationInfo = template.OrganizationInfo;
			this._idealSect = template.IdealSect;
			this._lifeSkillTypeInterest = template.LifeSkillTypeInterest;
			this._combatSkillTypeInterest = template.CombatSkillTypeInterest;
			this._mainAttributeInterest = template.MainAttributeInterest;
			this._transgender = template.Transgender;
			this._bisexual = template.Bisexual;
			this._xiangshuType = template.XiangshuType;
			this._monkType = template.MonkType;
			this._featureIds = new List<short>(template.FeatureIds);
			this._baseMainAttributes = template.BaseMainAttributes;
			this._health = template.Health;
			this._baseMaxHealth = template.BaseMaxHealth;
			this._disorderOfQi = template.DisorderOfQi;
			this._haveLeftArm = template.HaveLeftArm;
			this._haveRightArm = template.HaveRightArm;
			this._haveLeftLeg = template.HaveLeftLeg;
			this._haveRightLeg = template.HaveRightLeg;
			this._injuries = template.Injuries;
			this._extraNeili = template.ExtraNeili;
			this._consummateLevel = template.ConsummateLevel;
			this._learnedLifeSkills = new List<LifeSkillItem>(template.LearnedLifeSkills);
			this._baseLifeSkillQualifications = template.BaseLifeSkillQualifications;
			this._lifeSkillQualificationGrowthType = template.LifeSkillQualificationGrowthType;
			this._baseCombatSkillQualifications = template.BaseCombatSkillQualifications;
			this._combatSkillQualificationGrowthType = template.CombatSkillQualificationGrowthType;
			this._resources = template.Resources;
			this._lovingItemSubType = template.LovingItemSubType;
			this._hatingItemSubType = template.HatingItemSubType;
			this._avatar = new AvatarData();
			this._potentialFeatureIds = new List<short>();
			this._fameActionRecords = new List<FameActionRecord>();
			this._injuriesRecoveryProgress = new byte[14];
			this._equipment = new ItemKey[12];
			this._inventory = new Inventory();
			this._learnedCombatSkills = new List<short>();
			this._equippedCombatSkills = new short[48];
			this._combatSkillAttainmentPanels = new short[126];
			this._skillQualificationBonuses = new List<SkillQualificationBonus>();
			this._personalNeeds = new List<GameData.Domains.Character.Ai.PersonalNeed>();
			this._npcTravelTargets = new List<NpcTravelTarget>();
			this._combatSkillEquipment = new CombatSkillEquipment();
		}

		// Token: 0x06006F7E RID: 28542 RVA: 0x003F4DEC File Offset: 0x003F2FEC
		public bool IsSerializedSizeFixed()
		{
			return false;
		}

		// Token: 0x06006F7F RID: 28543 RVA: 0x003F4E00 File Offset: 0x003F3000
		public int GetSerializedSize()
		{
			int totalSize = 1076;
			int elementsCount = this._featureIds.Count;
			int contentSize = 2 * elementsCount;
			int dataSize = 2 + contentSize;
			totalSize += dataSize;
			int elementsCount2 = this._learnedLifeSkills.Count;
			int contentSize2 = 4 * elementsCount2;
			int dataSize2 = 2 + contentSize2;
			totalSize += dataSize2;
			int elementsCount3 = this._potentialFeatureIds.Count;
			int contentSize3 = 2 * elementsCount3;
			int dataSize3 = 2 + contentSize3;
			totalSize += dataSize3;
			int elementsCount4 = this._fameActionRecords.Count;
			int contentSize4 = 8 * elementsCount4;
			int dataSize4 = 2 + contentSize4;
			totalSize += dataSize4;
			int dataSize5 = this._inventory.GetSerializedSize();
			totalSize += dataSize5;
			int elementsCount5 = this._learnedCombatSkills.Count;
			int contentSize5 = 2 * elementsCount5;
			int dataSize6 = 2 + contentSize5;
			totalSize += dataSize6;
			int elementsCount6 = this._skillQualificationBonuses.Count;
			int contentSize6 = 4 * elementsCount6;
			int dataSize7 = 2 + contentSize6;
			totalSize += dataSize7;
			int elementsCount7 = this._personalNeeds.Count;
			int contentSize7 = 8 * elementsCount7;
			int dataSize8 = 2 + contentSize7;
			totalSize += dataSize8;
			int elementsCount8 = this._npcTravelTargets.Count;
			int contentSize8 = 16 * elementsCount8;
			int dataSize9 = 2 + contentSize8;
			return totalSize + dataSize9;
		}

		// Token: 0x06006F80 RID: 28544 RVA: 0x003F4F2C File Offset: 0x003F312C
		public unsafe int Serialize(byte* pData)
		{
			*(int*)pData = this._id;
			byte* pCurrData = pData + 4;
			*(short*)pCurrData = this._templateId;
			pCurrData += 2;
			*pCurrData = this._creatingType;
			pCurrData++;
			*pCurrData = (byte)this._gender;
			pCurrData++;
			*(short*)pCurrData = this._actualAge;
			pCurrData += 2;
			*pCurrData = (byte)this._birthMonth;
			pCurrData++;
			*pCurrData = (byte)this._happiness;
			pCurrData++;
			*(short*)pCurrData = this._baseMorality;
			pCurrData += 2;
			pCurrData += this._organizationInfo.Serialize(pCurrData);
			*pCurrData = (byte)this._idealSect;
			pCurrData++;
			*pCurrData = (byte)this._lifeSkillTypeInterest;
			pCurrData++;
			*pCurrData = (byte)this._combatSkillTypeInterest;
			pCurrData++;
			*pCurrData = (byte)this._mainAttributeInterest;
			pCurrData++;
			*pCurrData = (this._transgender ? 1 : 0);
			pCurrData++;
			*pCurrData = (this._bisexual ? 1 : 0);
			pCurrData++;
			*pCurrData = (byte)this._xiangshuType;
			pCurrData++;
			*pCurrData = this._monkType;
			pCurrData++;
			pCurrData += this._baseMainAttributes.Serialize(pCurrData);
			*(short*)pCurrData = this._health;
			pCurrData += 2;
			*(short*)pCurrData = this._baseMaxHealth;
			pCurrData += 2;
			*(short*)pCurrData = this._disorderOfQi;
			pCurrData += 2;
			*pCurrData = (this._haveLeftArm ? 1 : 0);
			pCurrData++;
			*pCurrData = (this._haveRightArm ? 1 : 0);
			pCurrData++;
			*pCurrData = (this._haveLeftLeg ? 1 : 0);
			pCurrData++;
			*pCurrData = (this._haveRightLeg ? 1 : 0);
			pCurrData++;
			pCurrData += this._injuries.Serialize(pCurrData);
			*(int*)pCurrData = this._extraNeili;
			pCurrData += 4;
			*pCurrData = (byte)this._consummateLevel;
			pCurrData++;
			pCurrData += this._baseLifeSkillQualifications.Serialize(pCurrData);
			*pCurrData = (byte)this._lifeSkillQualificationGrowthType;
			pCurrData++;
			pCurrData += this._baseCombatSkillQualifications.Serialize(pCurrData);
			*pCurrData = (byte)this._combatSkillQualificationGrowthType;
			pCurrData++;
			pCurrData += this._resources.Serialize(pCurrData);
			*(short*)pCurrData = this._lovingItemSubType;
			pCurrData += 2;
			*(short*)pCurrData = this._hatingItemSubType;
			pCurrData += 2;
			pCurrData += this._fullName.Serialize(pCurrData);
			pCurrData += this._monasticTitle.Serialize(pCurrData);
			pCurrData += this._avatar.Serialize(pCurrData);
			pCurrData += this._genome.Serialize(pCurrData);
			pCurrData += this._currMainAttributes.Serialize(pCurrData);
			pCurrData += this._poisoned.Serialize(pCurrData);
			bool flag = this._injuriesRecoveryProgress.Length != 14;
			if (flag)
			{
				throw new Exception("Elements count of field _injuriesRecoveryProgress is not equal to declaration");
			}
			for (int i = 0; i < 14; i++)
			{
				pCurrData[i] = this._injuriesRecoveryProgress[i];
			}
			pCurrData += 14;
			*(int*)pCurrData = this._currNeili;
			pCurrData += 4;
			*(short*)pCurrData = this._loopingNeigong;
			pCurrData += 2;
			pCurrData += this._baseNeiliAllocation.Serialize(pCurrData);
			pCurrData += this._extraNeiliAllocation.Serialize(pCurrData);
			pCurrData += this._baseNeiliProportionOfFiveElements.Serialize(pCurrData);
			*(int*)pCurrData = this._hobbyExpirationDate;
			pCurrData += 4;
			*pCurrData = (this._lovingItemRevealed ? 1 : 0);
			pCurrData++;
			*pCurrData = (this._hatingItemRevealed ? 1 : 0);
			pCurrData++;
			*pCurrData = (byte)this._legitimateBoysCount;
			pCurrData++;
			pCurrData += this._birthLocation.Serialize(pCurrData);
			pCurrData += this._location.Serialize(pCurrData);
			bool flag2 = this._equipment.Length != 12;
			if (flag2)
			{
				throw new Exception("Elements count of field _equipment is not equal to declaration");
			}
			for (int j = 0; j < 12; j++)
			{
				pCurrData += this._equipment[j].Serialize(pCurrData);
			}
			pCurrData += this._eatingItems.Serialize(pCurrData);
			bool flag3 = this._equippedCombatSkills.Length != 48;
			if (flag3)
			{
				throw new Exception("Elements count of field _equippedCombatSkills is not equal to declaration");
			}
			for (int k = 0; k < 48; k++)
			{
				*(short*)(pCurrData + (IntPtr)k * 2) = this._equippedCombatSkills[k];
			}
			pCurrData += 96;
			bool flag4 = this._combatSkillAttainmentPanels.Length != 126;
			if (flag4)
			{
				throw new Exception("Elements count of field _combatSkillAttainmentPanels is not equal to declaration");
			}
			for (int l = 0; l < 126; l++)
			{
				*(short*)(pCurrData + (IntPtr)l * 2) = this._combatSkillAttainmentPanels[l];
			}
			pCurrData += 252;
			pCurrData += this._preexistenceCharIds.Serialize(pCurrData);
			*pCurrData = this._xiangshuInfection;
			pCurrData++;
			*(short*)pCurrData = this._currAge;
			pCurrData += 2;
			*(int*)pCurrData = this._exp;
			pCurrData += 4;
			*pCurrData = this._externalRelationState;
			pCurrData++;
			*(int*)pCurrData = this._kidnapperId;
			pCurrData += 4;
			*(int*)pCurrData = this._leaderId;
			pCurrData += 4;
			*(int*)pCurrData = this._factionId;
			pCurrData += 4;
			pCurrData += this._actionEnergies.Serialize(pCurrData);
			pCurrData += this._prioritizedActionCooldowns.Serialize(pCurrData);
			int elementsCount = this._featureIds.Count;
			int contentSize = 2 * elementsCount;
			bool flag5 = contentSize > 4194300;
			if (flag5)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Size of field ");
				defaultInterpolatedStringHandler.AppendFormatted("_featureIds");
				defaultInterpolatedStringHandler.AppendLiteral(" must be less than ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(4096);
				defaultInterpolatedStringHandler.AppendLiteral("KB");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			*(int*)pCurrData = contentSize + 2;
			pCurrData += 4;
			*(short*)pCurrData = (short)((ushort)elementsCount);
			pCurrData += 2;
			for (int m = 0; m < elementsCount; m++)
			{
				*(short*)(pCurrData + (IntPtr)m * 2) = this._featureIds[m];
			}
			pCurrData += contentSize;
			int elementsCount2 = this._learnedLifeSkills.Count;
			int contentSize2 = 4 * elementsCount2;
			bool flag6 = contentSize2 > 4194300;
			if (flag6)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Size of field ");
				defaultInterpolatedStringHandler.AppendFormatted("_learnedLifeSkills");
				defaultInterpolatedStringHandler.AppendLiteral(" must be less than ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(4096);
				defaultInterpolatedStringHandler.AppendLiteral("KB");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			*(int*)pCurrData = contentSize2 + 2;
			pCurrData += 4;
			*(short*)pCurrData = (short)((ushort)elementsCount2);
			pCurrData += 2;
			for (int n = 0; n < elementsCount2; n++)
			{
				pCurrData += this._learnedLifeSkills[n].Serialize(pCurrData);
			}
			int elementsCount3 = this._potentialFeatureIds.Count;
			int contentSize3 = 2 * elementsCount3;
			bool flag7 = contentSize3 > 4194300;
			if (flag7)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Size of field ");
				defaultInterpolatedStringHandler.AppendFormatted("_potentialFeatureIds");
				defaultInterpolatedStringHandler.AppendLiteral(" must be less than ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(4096);
				defaultInterpolatedStringHandler.AppendLiteral("KB");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			*(int*)pCurrData = contentSize3 + 2;
			pCurrData += 4;
			*(short*)pCurrData = (short)((ushort)elementsCount3);
			pCurrData += 2;
			for (int i2 = 0; i2 < elementsCount3; i2++)
			{
				*(short*)(pCurrData + (IntPtr)i2 * 2) = this._potentialFeatureIds[i2];
			}
			pCurrData += contentSize3;
			int elementsCount4 = this._fameActionRecords.Count;
			int contentSize4 = 8 * elementsCount4;
			bool flag8 = contentSize4 > 4194300;
			if (flag8)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Size of field ");
				defaultInterpolatedStringHandler.AppendFormatted("_fameActionRecords");
				defaultInterpolatedStringHandler.AppendLiteral(" must be less than ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(4096);
				defaultInterpolatedStringHandler.AppendLiteral("KB");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			*(int*)pCurrData = contentSize4 + 2;
			pCurrData += 4;
			*(short*)pCurrData = (short)((ushort)elementsCount4);
			pCurrData += 2;
			for (int i3 = 0; i3 < elementsCount4; i3++)
			{
				pCurrData += this._fameActionRecords[i3].Serialize(pCurrData);
			}
			byte* pBegin = pCurrData;
			pCurrData += 4;
			pCurrData += this._inventory.Serialize(pCurrData);
			int fieldSize = (int)((long)(pCurrData - pBegin) - 4L);
			bool flag9 = fieldSize > 4194304;
			if (flag9)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Size of field ");
				defaultInterpolatedStringHandler.AppendFormatted("_inventory");
				defaultInterpolatedStringHandler.AppendLiteral(" must be less than ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(4096);
				defaultInterpolatedStringHandler.AppendLiteral("KB");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			*(int*)pBegin = fieldSize;
			int elementsCount5 = this._learnedCombatSkills.Count;
			int contentSize5 = 2 * elementsCount5;
			bool flag10 = contentSize5 > 4194300;
			if (flag10)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Size of field ");
				defaultInterpolatedStringHandler.AppendFormatted("_learnedCombatSkills");
				defaultInterpolatedStringHandler.AppendLiteral(" must be less than ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(4096);
				defaultInterpolatedStringHandler.AppendLiteral("KB");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			*(int*)pCurrData = contentSize5 + 2;
			pCurrData += 4;
			*(short*)pCurrData = (short)((ushort)elementsCount5);
			pCurrData += 2;
			for (int i4 = 0; i4 < elementsCount5; i4++)
			{
				*(short*)(pCurrData + (IntPtr)i4 * 2) = this._learnedCombatSkills[i4];
			}
			pCurrData += contentSize5;
			int elementsCount6 = this._skillQualificationBonuses.Count;
			int contentSize6 = 4 * elementsCount6;
			bool flag11 = contentSize6 > 4194300;
			if (flag11)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Size of field ");
				defaultInterpolatedStringHandler.AppendFormatted("_skillQualificationBonuses");
				defaultInterpolatedStringHandler.AppendLiteral(" must be less than ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(4096);
				defaultInterpolatedStringHandler.AppendLiteral("KB");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			*(int*)pCurrData = contentSize6 + 2;
			pCurrData += 4;
			*(short*)pCurrData = (short)((ushort)elementsCount6);
			pCurrData += 2;
			for (int i5 = 0; i5 < elementsCount6; i5++)
			{
				pCurrData += this._skillQualificationBonuses[i5].Serialize(pCurrData);
			}
			int elementsCount7 = this._personalNeeds.Count;
			int contentSize7 = 8 * elementsCount7;
			bool flag12 = contentSize7 > 4194300;
			if (flag12)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Size of field ");
				defaultInterpolatedStringHandler.AppendFormatted("_personalNeeds");
				defaultInterpolatedStringHandler.AppendLiteral(" must be less than ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(4096);
				defaultInterpolatedStringHandler.AppendLiteral("KB");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			*(int*)pCurrData = contentSize7 + 2;
			pCurrData += 4;
			*(short*)pCurrData = (short)((ushort)elementsCount7);
			pCurrData += 2;
			for (int i6 = 0; i6 < elementsCount7; i6++)
			{
				pCurrData += this._personalNeeds[i6].Serialize(pCurrData);
			}
			int elementsCount8 = this._npcTravelTargets.Count;
			int contentSize8 = 16 * elementsCount8;
			bool flag13 = contentSize8 > 4194300;
			if (flag13)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Size of field ");
				defaultInterpolatedStringHandler.AppendFormatted("_npcTravelTargets");
				defaultInterpolatedStringHandler.AppendLiteral(" must be less than ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(4096);
				defaultInterpolatedStringHandler.AppendLiteral("KB");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			*(int*)pCurrData = contentSize8 + 2;
			pCurrData += 4;
			*(short*)pCurrData = (short)((ushort)elementsCount8);
			pCurrData += 2;
			for (int i7 = 0; i7 < elementsCount8; i7++)
			{
				pCurrData += this._npcTravelTargets[i7].Serialize(pCurrData);
			}
			return (int)((long)(pCurrData - pData));
		}

		// Token: 0x06006F81 RID: 28545 RVA: 0x003F5A38 File Offset: 0x003F3C38
		public unsafe int Deserialize(byte* pData)
		{
			this._id = *(int*)pData;
			byte* pCurrData = pData + 4;
			this._templateId = *(short*)pCurrData;
			pCurrData += 2;
			this._creatingType = *pCurrData;
			pCurrData++;
			this._gender = *(sbyte*)pCurrData;
			pCurrData++;
			this._actualAge = *(short*)pCurrData;
			pCurrData += 2;
			this._birthMonth = *(sbyte*)pCurrData;
			pCurrData++;
			this._happiness = *(sbyte*)pCurrData;
			pCurrData++;
			this._baseMorality = *(short*)pCurrData;
			pCurrData += 2;
			pCurrData += this._organizationInfo.Deserialize(pCurrData);
			this._idealSect = *(sbyte*)pCurrData;
			pCurrData++;
			this._lifeSkillTypeInterest = *(sbyte*)pCurrData;
			pCurrData++;
			this._combatSkillTypeInterest = *(sbyte*)pCurrData;
			pCurrData++;
			this._mainAttributeInterest = *(sbyte*)pCurrData;
			pCurrData++;
			this._transgender = (*pCurrData != 0);
			pCurrData++;
			this._bisexual = (*pCurrData != 0);
			pCurrData++;
			this._xiangshuType = *(sbyte*)pCurrData;
			pCurrData++;
			this._monkType = *pCurrData;
			pCurrData++;
			pCurrData += this._baseMainAttributes.Deserialize(pCurrData);
			this._health = *(short*)pCurrData;
			pCurrData += 2;
			this._baseMaxHealth = *(short*)pCurrData;
			pCurrData += 2;
			this._disorderOfQi = *(short*)pCurrData;
			pCurrData += 2;
			this._haveLeftArm = (*pCurrData != 0);
			pCurrData++;
			this._haveRightArm = (*pCurrData != 0);
			pCurrData++;
			this._haveLeftLeg = (*pCurrData != 0);
			pCurrData++;
			this._haveRightLeg = (*pCurrData != 0);
			pCurrData++;
			pCurrData += this._injuries.Deserialize(pCurrData);
			this._extraNeili = *(int*)pCurrData;
			pCurrData += 4;
			this._consummateLevel = *(sbyte*)pCurrData;
			pCurrData++;
			pCurrData += this._baseLifeSkillQualifications.Deserialize(pCurrData);
			this._lifeSkillQualificationGrowthType = *(sbyte*)pCurrData;
			pCurrData++;
			pCurrData += this._baseCombatSkillQualifications.Deserialize(pCurrData);
			this._combatSkillQualificationGrowthType = *(sbyte*)pCurrData;
			pCurrData++;
			pCurrData += this._resources.Deserialize(pCurrData);
			this._lovingItemSubType = *(short*)pCurrData;
			pCurrData += 2;
			this._hatingItemSubType = *(short*)pCurrData;
			pCurrData += 2;
			pCurrData += this._fullName.Deserialize(pCurrData);
			pCurrData += this._monasticTitle.Deserialize(pCurrData);
			pCurrData += this._avatar.Deserialize(pCurrData);
			pCurrData += this._genome.Deserialize(pCurrData);
			pCurrData += this._currMainAttributes.Deserialize(pCurrData);
			pCurrData += this._poisoned.Deserialize(pCurrData);
			bool flag = this._injuriesRecoveryProgress.Length != 14;
			if (flag)
			{
				throw new Exception("Elements count of field _injuriesRecoveryProgress is not equal to declaration");
			}
			for (int i = 0; i < 14; i++)
			{
				this._injuriesRecoveryProgress[i] = pCurrData[i];
			}
			pCurrData += 14;
			this._currNeili = *(int*)pCurrData;
			pCurrData += 4;
			this._loopingNeigong = *(short*)pCurrData;
			pCurrData += 2;
			pCurrData += this._baseNeiliAllocation.Deserialize(pCurrData);
			pCurrData += this._extraNeiliAllocation.Deserialize(pCurrData);
			pCurrData += this._baseNeiliProportionOfFiveElements.Deserialize(pCurrData);
			this._hobbyExpirationDate = *(int*)pCurrData;
			pCurrData += 4;
			this._lovingItemRevealed = (*pCurrData != 0);
			pCurrData++;
			this._hatingItemRevealed = (*pCurrData != 0);
			pCurrData++;
			this._legitimateBoysCount = *(sbyte*)pCurrData;
			pCurrData++;
			pCurrData += this._birthLocation.Deserialize(pCurrData);
			pCurrData += this._location.Deserialize(pCurrData);
			bool flag2 = this._equipment.Length != 12;
			if (flag2)
			{
				throw new Exception("Elements count of field _equipment is not equal to declaration");
			}
			for (int j = 0; j < 12; j++)
			{
				ItemKey element = default(ItemKey);
				pCurrData += element.Deserialize(pCurrData);
				this._equipment[j] = element;
			}
			pCurrData += this._eatingItems.Deserialize(pCurrData);
			bool flag3 = this._equippedCombatSkills.Length != 48;
			if (flag3)
			{
				throw new Exception("Elements count of field _equippedCombatSkills is not equal to declaration");
			}
			for (int k = 0; k < 48; k++)
			{
				this._equippedCombatSkills[k] = *(short*)(pCurrData + (IntPtr)k * 2);
			}
			pCurrData += 96;
			bool flag4 = this._combatSkillAttainmentPanels.Length != 126;
			if (flag4)
			{
				throw new Exception("Elements count of field _combatSkillAttainmentPanels is not equal to declaration");
			}
			for (int l = 0; l < 126; l++)
			{
				this._combatSkillAttainmentPanels[l] = *(short*)(pCurrData + (IntPtr)l * 2);
			}
			pCurrData += 252;
			pCurrData += this._preexistenceCharIds.Deserialize(pCurrData);
			this._xiangshuInfection = *pCurrData;
			pCurrData++;
			this._currAge = *(short*)pCurrData;
			pCurrData += 2;
			this._exp = *(int*)pCurrData;
			pCurrData += 4;
			this._externalRelationState = *pCurrData;
			pCurrData++;
			this._kidnapperId = *(int*)pCurrData;
			pCurrData += 4;
			this._leaderId = *(int*)pCurrData;
			pCurrData += 4;
			this._factionId = *(int*)pCurrData;
			pCurrData += 4;
			pCurrData += this._actionEnergies.Deserialize(pCurrData);
			pCurrData += this._prioritizedActionCooldowns.Deserialize(pCurrData);
			pCurrData += 4;
			ushort elementsCount = *(ushort*)pCurrData;
			pCurrData += 2;
			this._featureIds.Clear();
			for (int m = 0; m < (int)elementsCount; m++)
			{
				this._featureIds.Add(*(short*)(pCurrData + (IntPtr)m * 2));
			}
			pCurrData += 2 * elementsCount;
			pCurrData += 4;
			ushort elementsCount2 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._learnedLifeSkills.Clear();
			for (int n = 0; n < (int)elementsCount2; n++)
			{
				LifeSkillItem element2 = default(LifeSkillItem);
				pCurrData += element2.Deserialize(pCurrData);
				this._learnedLifeSkills.Add(element2);
			}
			pCurrData += 4;
			ushort elementsCount3 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._potentialFeatureIds.Clear();
			for (int i2 = 0; i2 < (int)elementsCount3; i2++)
			{
				this._potentialFeatureIds.Add(*(short*)(pCurrData + (IntPtr)i2 * 2));
			}
			pCurrData += 2 * elementsCount3;
			pCurrData += 4;
			ushort elementsCount4 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._fameActionRecords.Clear();
			for (int i3 = 0; i3 < (int)elementsCount4; i3++)
			{
				FameActionRecord element3 = default(FameActionRecord);
				pCurrData += element3.Deserialize(pCurrData);
				this._fameActionRecords.Add(element3);
			}
			pCurrData += 4;
			pCurrData += this._inventory.Deserialize(pCurrData);
			pCurrData += 4;
			ushort elementsCount5 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._learnedCombatSkills.Clear();
			for (int i4 = 0; i4 < (int)elementsCount5; i4++)
			{
				this._learnedCombatSkills.Add(*(short*)(pCurrData + (IntPtr)i4 * 2));
			}
			pCurrData += 2 * elementsCount5;
			pCurrData += 4;
			ushort elementsCount6 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._skillQualificationBonuses.Clear();
			for (int i5 = 0; i5 < (int)elementsCount6; i5++)
			{
				SkillQualificationBonus element4 = default(SkillQualificationBonus);
				pCurrData += element4.Deserialize(pCurrData);
				this._skillQualificationBonuses.Add(element4);
			}
			pCurrData += 4;
			ushort elementsCount7 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._personalNeeds.Clear();
			for (int i6 = 0; i6 < (int)elementsCount7; i6++)
			{
				GameData.Domains.Character.Ai.PersonalNeed element5 = default(GameData.Domains.Character.Ai.PersonalNeed);
				pCurrData += element5.Deserialize(pCurrData);
				this._personalNeeds.Add(element5);
			}
			pCurrData += 4;
			ushort elementsCount8 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._npcTravelTargets.Clear();
			for (int i7 = 0; i7 < (int)elementsCount8; i7++)
			{
				NpcTravelTarget element6 = default(NpcTravelTarget);
				pCurrData += element6.Deserialize(pCurrData);
				this._npcTravelTargets.Add(element6);
			}
			return (int)((long)(pCurrData - pData));
		}

		// Token: 0x06006F82 RID: 28546 RVA: 0x003F615C File Offset: 0x003F435C
		internal int GetSerializedSize_Legacy()
		{
			int totalSize = 1058;
			int elementsCount = this._featureIds.Count;
			int contentSize = 2 * elementsCount;
			int dataSize = 2 + contentSize;
			totalSize += dataSize;
			int elementsCount2 = this._learnedLifeSkills.Count;
			int contentSize2 = 4 * elementsCount2;
			int dataSize2 = 2 + contentSize2;
			totalSize += dataSize2;
			int elementsCount3 = this._potentialFeatureIds.Count;
			int contentSize3 = 2 * elementsCount3;
			int dataSize3 = 2 + contentSize3;
			totalSize += dataSize3;
			int elementsCount4 = this._fameActionRecords.Count;
			int contentSize4 = 8 * elementsCount4;
			int dataSize4 = 2 + contentSize4;
			totalSize += dataSize4;
			int dataSize5 = this._inventory.GetSerializedSize();
			totalSize += dataSize5;
			int elementsCount5 = this._learnedCombatSkills.Count;
			int contentSize5 = 2 * elementsCount5;
			int dataSize6 = 2 + contentSize5;
			totalSize += dataSize6;
			int elementsCount6 = this._skillQualificationBonuses.Count;
			int contentSize6 = 4 * elementsCount6;
			int dataSize7 = 2 + contentSize6;
			totalSize += dataSize7;
			int elementsCount7 = this._personalNeeds.Count;
			int contentSize7 = 8 * elementsCount7;
			int dataSize8 = 2 + contentSize7;
			totalSize += dataSize8;
			int elementsCount8 = this._npcTravelTargets.Count;
			int contentSize8 = 16 * elementsCount8;
			int dataSize9 = 2 + contentSize8;
			return totalSize + dataSize9;
		}

		// Token: 0x06006F83 RID: 28547 RVA: 0x003F6288 File Offset: 0x003F4488
		internal unsafe int Serialize_Legacy(byte* pData)
		{
			*(int*)pData = this._id;
			byte* pCurrData = pData + 4;
			*(short*)pCurrData = this._templateId;
			pCurrData += 2;
			*pCurrData = this._creatingType;
			pCurrData++;
			*pCurrData = (byte)this._gender;
			pCurrData++;
			*(short*)pCurrData = this._actualAge;
			pCurrData += 2;
			*pCurrData = (byte)this._birthMonth;
			pCurrData++;
			*pCurrData = (byte)this._happiness;
			pCurrData++;
			*(short*)pCurrData = this._baseMorality;
			pCurrData += 2;
			pCurrData += this._organizationInfo.Serialize(pCurrData);
			*pCurrData = (byte)this._idealSect;
			pCurrData++;
			*pCurrData = (byte)this._lifeSkillTypeInterest;
			pCurrData++;
			*pCurrData = (byte)this._combatSkillTypeInterest;
			pCurrData++;
			*pCurrData = (byte)this._mainAttributeInterest;
			pCurrData++;
			*pCurrData = (this._transgender ? 1 : 0);
			pCurrData++;
			*pCurrData = (this._bisexual ? 1 : 0);
			pCurrData++;
			*pCurrData = (byte)this._xiangshuType;
			pCurrData++;
			*pCurrData = this._monkType;
			pCurrData++;
			pCurrData += this._baseMainAttributes.Serialize(pCurrData);
			*(short*)pCurrData = this._health;
			pCurrData += 2;
			*(short*)pCurrData = this._baseMaxHealth;
			pCurrData += 2;
			*(short*)pCurrData = this._disorderOfQi;
			pCurrData += 2;
			*pCurrData = (this._haveLeftArm ? 1 : 0);
			pCurrData++;
			*pCurrData = (this._haveRightArm ? 1 : 0);
			pCurrData++;
			*pCurrData = (this._haveLeftLeg ? 1 : 0);
			pCurrData++;
			*pCurrData = (this._haveRightLeg ? 1 : 0);
			pCurrData++;
			pCurrData += this._injuries.Serialize(pCurrData);
			*(int*)pCurrData = this._extraNeili;
			pCurrData += 4;
			*pCurrData = (byte)this._consummateLevel;
			pCurrData++;
			pCurrData += this._baseLifeSkillQualifications.Serialize(pCurrData);
			*pCurrData = (byte)this._lifeSkillQualificationGrowthType;
			pCurrData++;
			pCurrData += this._baseCombatSkillQualifications.Serialize(pCurrData);
			*pCurrData = (byte)this._combatSkillQualificationGrowthType;
			pCurrData++;
			pCurrData += this._resources.Serialize(pCurrData);
			*(short*)pCurrData = this._lovingItemSubType;
			pCurrData += 2;
			*(short*)pCurrData = this._hatingItemSubType;
			pCurrData += 2;
			pCurrData += this._fullName.Serialize(pCurrData);
			pCurrData += this._monasticTitle.Serialize(pCurrData);
			pCurrData += this._avatar.Serialize(pCurrData);
			pCurrData += this._genome.Serialize(pCurrData);
			pCurrData += this._currMainAttributes.Serialize(pCurrData);
			pCurrData += this._poisoned.Serialize(pCurrData);
			bool flag = this._injuriesRecoveryProgress.Length != 14;
			if (flag)
			{
				throw new Exception("Elements count of field _injuriesRecoveryProgress is not equal to declaration");
			}
			for (int i = 0; i < 14; i++)
			{
				pCurrData[i] = this._injuriesRecoveryProgress[i];
			}
			pCurrData += 14;
			*(int*)pCurrData = this._currNeili;
			pCurrData += 4;
			*(short*)pCurrData = this._loopingNeigong;
			pCurrData += 2;
			pCurrData += this._baseNeiliAllocation.Serialize(pCurrData);
			pCurrData += this._extraNeiliAllocation.Serialize(pCurrData);
			pCurrData += this._baseNeiliProportionOfFiveElements.Serialize(pCurrData);
			*(int*)pCurrData = this._hobbyExpirationDate;
			pCurrData += 4;
			*pCurrData = (this._lovingItemRevealed ? 1 : 0);
			pCurrData++;
			*pCurrData = (this._hatingItemRevealed ? 1 : 0);
			pCurrData++;
			*pCurrData = (byte)this._legitimateBoysCount;
			pCurrData++;
			pCurrData += this._birthLocation.Serialize(pCurrData);
			pCurrData += this._location.Serialize(pCurrData);
			bool flag2 = this._equipment.Length != 12;
			if (flag2)
			{
				throw new Exception("Elements count of field _equipment is not equal to declaration");
			}
			for (int j = 0; j < 12; j++)
			{
				pCurrData += this._equipment[j].Serialize(pCurrData);
			}
			pCurrData += this._eatingItems.Serialize(pCurrData);
			bool flag3 = this._equippedCombatSkills.Length != 48;
			if (flag3)
			{
				throw new Exception("Elements count of field _equippedCombatSkills is not equal to declaration");
			}
			for (int k = 0; k < 48; k++)
			{
				*(short*)(pCurrData + (IntPtr)k * 2) = this._equippedCombatSkills[k];
			}
			pCurrData += 96;
			bool flag4 = this._combatSkillAttainmentPanels.Length != 126;
			if (flag4)
			{
				throw new Exception("Elements count of field _combatSkillAttainmentPanels is not equal to declaration");
			}
			for (int l = 0; l < 126; l++)
			{
				*(short*)(pCurrData + (IntPtr)l * 2) = this._combatSkillAttainmentPanels[l];
			}
			pCurrData += 252;
			pCurrData += this._preexistenceCharIds.Serialize(pCurrData);
			*pCurrData = this._xiangshuInfection;
			pCurrData++;
			*(short*)pCurrData = this._currAge;
			pCurrData += 2;
			*(int*)pCurrData = this._exp;
			pCurrData += 4;
			*pCurrData = this._externalRelationState;
			pCurrData++;
			*(int*)pCurrData = this._kidnapperId;
			pCurrData += 4;
			*(int*)pCurrData = this._leaderId;
			pCurrData += 4;
			*(int*)pCurrData = this._factionId;
			pCurrData += 4;
			pCurrData += this._actionEnergies.Serialize(pCurrData);
			pCurrData += this._prioritizedActionCooldowns.Serialize(pCurrData);
			int elementsCount = this._featureIds.Count;
			int contentSize = 2 * elementsCount;
			bool flag5 = contentSize > 65533;
			if (flag5)
			{
				throw new Exception("Size of field _featureIds must be less than 64KB");
			}
			*(short*)pCurrData = (short)((ushort)(contentSize + 2));
			pCurrData += 2;
			*(short*)pCurrData = (short)((ushort)elementsCount);
			pCurrData += 2;
			for (int m = 0; m < elementsCount; m++)
			{
				*(short*)(pCurrData + (IntPtr)m * 2) = this._featureIds[m];
			}
			pCurrData += contentSize;
			int elementsCount2 = this._learnedLifeSkills.Count;
			int contentSize2 = 4 * elementsCount2;
			bool flag6 = contentSize2 > 65533;
			if (flag6)
			{
				throw new Exception("Size of field _learnedLifeSkills must be less than 64KB");
			}
			*(short*)pCurrData = (short)((ushort)(contentSize2 + 2));
			pCurrData += 2;
			*(short*)pCurrData = (short)((ushort)elementsCount2);
			pCurrData += 2;
			for (int n = 0; n < elementsCount2; n++)
			{
				pCurrData += this._learnedLifeSkills[n].Serialize(pCurrData);
			}
			int elementsCount3 = this._potentialFeatureIds.Count;
			int contentSize3 = 2 * elementsCount3;
			bool flag7 = contentSize3 > 65533;
			if (flag7)
			{
				throw new Exception("Size of field _potentialFeatureIds must be less than 64KB");
			}
			*(short*)pCurrData = (short)((ushort)(contentSize3 + 2));
			pCurrData += 2;
			*(short*)pCurrData = (short)((ushort)elementsCount3);
			pCurrData += 2;
			for (int i2 = 0; i2 < elementsCount3; i2++)
			{
				*(short*)(pCurrData + (IntPtr)i2 * 2) = this._potentialFeatureIds[i2];
			}
			pCurrData += contentSize3;
			int elementsCount4 = this._fameActionRecords.Count;
			int contentSize4 = 8 * elementsCount4;
			bool flag8 = contentSize4 > 65533;
			if (flag8)
			{
				throw new Exception("Size of field _fameActionRecords must be less than 64KB");
			}
			*(short*)pCurrData = (short)((ushort)(contentSize4 + 2));
			pCurrData += 2;
			*(short*)pCurrData = (short)((ushort)elementsCount4);
			pCurrData += 2;
			for (int i3 = 0; i3 < elementsCount4; i3++)
			{
				pCurrData += this._fameActionRecords[i3].Serialize(pCurrData);
			}
			byte* pBegin = pCurrData;
			pCurrData += 2;
			pCurrData += this._inventory.Serialize(pCurrData);
			int fieldSize = (int)((long)(pCurrData - pBegin) - 2L);
			bool flag9 = fieldSize > 65535;
			if (flag9)
			{
				throw new Exception("Size of field _inventory must be less than 64KB");
			}
			*(short*)pBegin = (short)((ushort)fieldSize);
			int elementsCount5 = this._learnedCombatSkills.Count;
			int contentSize5 = 2 * elementsCount5;
			bool flag10 = contentSize5 > 65533;
			if (flag10)
			{
				throw new Exception("Size of field _learnedCombatSkills must be less than 64KB");
			}
			*(short*)pCurrData = (short)((ushort)(contentSize5 + 2));
			pCurrData += 2;
			*(short*)pCurrData = (short)((ushort)elementsCount5);
			pCurrData += 2;
			for (int i4 = 0; i4 < elementsCount5; i4++)
			{
				*(short*)(pCurrData + (IntPtr)i4 * 2) = this._learnedCombatSkills[i4];
			}
			pCurrData += contentSize5;
			int elementsCount6 = this._skillQualificationBonuses.Count;
			int contentSize6 = 4 * elementsCount6;
			bool flag11 = contentSize6 > 65533;
			if (flag11)
			{
				throw new Exception("Size of field _skillQualificationBonuses must be less than 64KB");
			}
			*(short*)pCurrData = (short)((ushort)(contentSize6 + 2));
			pCurrData += 2;
			*(short*)pCurrData = (short)((ushort)elementsCount6);
			pCurrData += 2;
			for (int i5 = 0; i5 < elementsCount6; i5++)
			{
				pCurrData += this._skillQualificationBonuses[i5].Serialize(pCurrData);
			}
			int elementsCount7 = this._personalNeeds.Count;
			int contentSize7 = 8 * elementsCount7;
			bool flag12 = contentSize7 > 65533;
			if (flag12)
			{
				throw new Exception("Size of field _personalNeeds must be less than 64KB");
			}
			*(short*)pCurrData = (short)((ushort)(contentSize7 + 2));
			pCurrData += 2;
			*(short*)pCurrData = (short)((ushort)elementsCount7);
			pCurrData += 2;
			for (int i6 = 0; i6 < elementsCount7; i6++)
			{
				pCurrData += this._personalNeeds[i6].Serialize(pCurrData);
			}
			int elementsCount8 = this._npcTravelTargets.Count;
			int contentSize8 = 16 * elementsCount8;
			bool flag13 = contentSize8 > 65533;
			if (flag13)
			{
				throw new Exception("Size of field _npcTravelTargets must be less than 64KB");
			}
			*(short*)pCurrData = (short)((ushort)(contentSize8 + 2));
			pCurrData += 2;
			*(short*)pCurrData = (short)((ushort)elementsCount8);
			pCurrData += 2;
			for (int i7 = 0; i7 < elementsCount8; i7++)
			{
				pCurrData += this._npcTravelTargets[i7].Serialize(pCurrData);
			}
			return (int)((long)(pCurrData - pData));
		}

		// Token: 0x06006F84 RID: 28548 RVA: 0x003F6AE8 File Offset: 0x003F4CE8
		internal unsafe int Deserialize_Legacy(byte* pData)
		{
			this._id = *(int*)pData;
			byte* pCurrData = pData + 4;
			this._templateId = *(short*)pCurrData;
			pCurrData += 2;
			this._creatingType = *pCurrData;
			pCurrData++;
			this._gender = *(sbyte*)pCurrData;
			pCurrData++;
			this._actualAge = *(short*)pCurrData;
			pCurrData += 2;
			this._birthMonth = *(sbyte*)pCurrData;
			pCurrData++;
			this._happiness = *(sbyte*)pCurrData;
			pCurrData++;
			this._baseMorality = *(short*)pCurrData;
			pCurrData += 2;
			pCurrData += this._organizationInfo.Deserialize(pCurrData);
			this._idealSect = *(sbyte*)pCurrData;
			pCurrData++;
			this._lifeSkillTypeInterest = *(sbyte*)pCurrData;
			pCurrData++;
			this._combatSkillTypeInterest = *(sbyte*)pCurrData;
			pCurrData++;
			this._mainAttributeInterest = *(sbyte*)pCurrData;
			pCurrData++;
			this._transgender = (*pCurrData != 0);
			pCurrData++;
			this._bisexual = (*pCurrData != 0);
			pCurrData++;
			this._xiangshuType = *(sbyte*)pCurrData;
			pCurrData++;
			this._monkType = *pCurrData;
			pCurrData++;
			pCurrData += this._baseMainAttributes.Deserialize(pCurrData);
			this._health = *(short*)pCurrData;
			pCurrData += 2;
			this._baseMaxHealth = *(short*)pCurrData;
			pCurrData += 2;
			this._disorderOfQi = *(short*)pCurrData;
			pCurrData += 2;
			this._haveLeftArm = (*pCurrData != 0);
			pCurrData++;
			this._haveRightArm = (*pCurrData != 0);
			pCurrData++;
			this._haveLeftLeg = (*pCurrData != 0);
			pCurrData++;
			this._haveRightLeg = (*pCurrData != 0);
			pCurrData++;
			pCurrData += this._injuries.Deserialize(pCurrData);
			this._extraNeili = *(int*)pCurrData;
			pCurrData += 4;
			this._consummateLevel = *(sbyte*)pCurrData;
			pCurrData++;
			pCurrData += this._baseLifeSkillQualifications.Deserialize(pCurrData);
			this._lifeSkillQualificationGrowthType = *(sbyte*)pCurrData;
			pCurrData++;
			pCurrData += this._baseCombatSkillQualifications.Deserialize(pCurrData);
			this._combatSkillQualificationGrowthType = *(sbyte*)pCurrData;
			pCurrData++;
			pCurrData += this._resources.Deserialize(pCurrData);
			this._lovingItemSubType = *(short*)pCurrData;
			pCurrData += 2;
			this._hatingItemSubType = *(short*)pCurrData;
			pCurrData += 2;
			pCurrData += this._fullName.Deserialize(pCurrData);
			pCurrData += this._monasticTitle.Deserialize(pCurrData);
			pCurrData += this._avatar.Deserialize(pCurrData);
			pCurrData += this._genome.Deserialize(pCurrData);
			pCurrData += this._currMainAttributes.Deserialize(pCurrData);
			pCurrData += this._poisoned.Deserialize(pCurrData);
			bool flag = this._injuriesRecoveryProgress.Length != 14;
			if (flag)
			{
				throw new Exception("Elements count of field _injuriesRecoveryProgress is not equal to declaration");
			}
			for (int i = 0; i < 14; i++)
			{
				this._injuriesRecoveryProgress[i] = pCurrData[i];
			}
			pCurrData += 14;
			this._currNeili = *(int*)pCurrData;
			pCurrData += 4;
			this._loopingNeigong = *(short*)pCurrData;
			pCurrData += 2;
			pCurrData += this._baseNeiliAllocation.Deserialize(pCurrData);
			pCurrData += this._extraNeiliAllocation.Deserialize(pCurrData);
			pCurrData += this._baseNeiliProportionOfFiveElements.Deserialize(pCurrData);
			this._hobbyExpirationDate = *(int*)pCurrData;
			pCurrData += 4;
			this._lovingItemRevealed = (*pCurrData != 0);
			pCurrData++;
			this._hatingItemRevealed = (*pCurrData != 0);
			pCurrData++;
			this._legitimateBoysCount = *(sbyte*)pCurrData;
			pCurrData++;
			pCurrData += this._birthLocation.Deserialize(pCurrData);
			pCurrData += this._location.Deserialize(pCurrData);
			bool flag2 = this._equipment.Length != 12;
			if (flag2)
			{
				throw new Exception("Elements count of field _equipment is not equal to declaration");
			}
			for (int j = 0; j < 12; j++)
			{
				ItemKey element = default(ItemKey);
				pCurrData += element.Deserialize(pCurrData);
				this._equipment[j] = element;
			}
			pCurrData += this._eatingItems.Deserialize(pCurrData);
			bool flag3 = this._equippedCombatSkills.Length != 48;
			if (flag3)
			{
				throw new Exception("Elements count of field _equippedCombatSkills is not equal to declaration");
			}
			for (int k = 0; k < 48; k++)
			{
				this._equippedCombatSkills[k] = *(short*)(pCurrData + (IntPtr)k * 2);
			}
			pCurrData += 96;
			bool flag4 = this._combatSkillAttainmentPanels.Length != 126;
			if (flag4)
			{
				throw new Exception("Elements count of field _combatSkillAttainmentPanels is not equal to declaration");
			}
			for (int l = 0; l < 126; l++)
			{
				this._combatSkillAttainmentPanels[l] = *(short*)(pCurrData + (IntPtr)l * 2);
			}
			pCurrData += 252;
			pCurrData += this._preexistenceCharIds.Deserialize(pCurrData);
			this._xiangshuInfection = *pCurrData;
			pCurrData++;
			this._currAge = *(short*)pCurrData;
			pCurrData += 2;
			this._exp = *(int*)pCurrData;
			pCurrData += 4;
			this._externalRelationState = *pCurrData;
			pCurrData++;
			this._kidnapperId = *(int*)pCurrData;
			pCurrData += 4;
			this._leaderId = *(int*)pCurrData;
			pCurrData += 4;
			this._factionId = *(int*)pCurrData;
			pCurrData += 4;
			pCurrData += this._actionEnergies.Deserialize(pCurrData);
			pCurrData += this._prioritizedActionCooldowns.Deserialize(pCurrData);
			pCurrData += 2;
			ushort elementsCount = *(ushort*)pCurrData;
			pCurrData += 2;
			this._featureIds.Clear();
			for (int m = 0; m < (int)elementsCount; m++)
			{
				this._featureIds.Add(*(short*)(pCurrData + (IntPtr)m * 2));
			}
			pCurrData += 2 * elementsCount;
			pCurrData += 2;
			ushort elementsCount2 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._learnedLifeSkills.Clear();
			for (int n = 0; n < (int)elementsCount2; n++)
			{
				LifeSkillItem element2 = default(LifeSkillItem);
				pCurrData += element2.Deserialize(pCurrData);
				this._learnedLifeSkills.Add(element2);
			}
			pCurrData += 2;
			ushort elementsCount3 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._potentialFeatureIds.Clear();
			for (int i2 = 0; i2 < (int)elementsCount3; i2++)
			{
				this._potentialFeatureIds.Add(*(short*)(pCurrData + (IntPtr)i2 * 2));
			}
			pCurrData += 2 * elementsCount3;
			pCurrData += 2;
			ushort elementsCount4 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._fameActionRecords.Clear();
			for (int i3 = 0; i3 < (int)elementsCount4; i3++)
			{
				FameActionRecord element3 = default(FameActionRecord);
				pCurrData += element3.Deserialize(pCurrData);
				this._fameActionRecords.Add(element3);
			}
			pCurrData += 2;
			pCurrData += this._inventory.Deserialize(pCurrData);
			pCurrData += 2;
			ushort elementsCount5 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._learnedCombatSkills.Clear();
			for (int i4 = 0; i4 < (int)elementsCount5; i4++)
			{
				this._learnedCombatSkills.Add(*(short*)(pCurrData + (IntPtr)i4 * 2));
			}
			pCurrData += 2 * elementsCount5;
			pCurrData += 2;
			ushort elementsCount6 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._skillQualificationBonuses.Clear();
			for (int i5 = 0; i5 < (int)elementsCount6; i5++)
			{
				SkillQualificationBonus element4 = default(SkillQualificationBonus);
				pCurrData += element4.Deserialize(pCurrData);
				this._skillQualificationBonuses.Add(element4);
			}
			pCurrData += 2;
			ushort elementsCount7 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._personalNeeds.Clear();
			for (int i6 = 0; i6 < (int)elementsCount7; i6++)
			{
				GameData.Domains.Character.Ai.PersonalNeed element5 = default(GameData.Domains.Character.Ai.PersonalNeed);
				pCurrData += element5.Deserialize(pCurrData);
				this._personalNeeds.Add(element5);
			}
			pCurrData += 2;
			ushort elementsCount8 = *(ushort*)pCurrData;
			pCurrData += 2;
			this._npcTravelTargets.Clear();
			for (int i7 = 0; i7 < (int)elementsCount8; i7++)
			{
				NpcTravelTarget element6 = default(NpcTravelTarget);
				pCurrData += element6.Deserialize(pCurrData);
				this._npcTravelTargets.Add(element6);
			}
			return (int)((long)(pCurrData - pData));
		}

		// Token: 0x06006F85 RID: 28549 RVA: 0x003F720C File Offset: 0x003F540C
		public unsafe Character.ProtagonistFeatureRelatedStatus OfflineCreateProtagonist(short templateId, short orgMemberId, ProtagonistCreationInfo info, DataContext context)
		{
			IRandomSource random = context.Random;
			CharacterItem template = Character.Instance[templateId];
			bool flag = (string.IsNullOrEmpty(info.Surname) || string.IsNullOrEmpty(info.GivenName)) && info.InscribedChar == null;
			if (flag)
			{
				throw new Exception("Surname and given name can neither be null nor empty");
			}
			int customSurnameId = (info.Surname != null) ? DomainManager.World.RegisterCustomText(context, info.Surname) : -1;
			int customGivenNameId = (info.GivenName != null) ? DomainManager.World.RegisterCustomText(context, info.GivenName) : -1;
			this._fullName = ((customSurnameId >= 0 && customGivenNameId >= 0) ? new FullName(customSurnameId, customGivenNameId, -1, -1, -1, -1) : new FullName((customGivenNameId >= 0) ? customGivenNameId : customSurnameId, -1, -1));
			this._monasticTitle = new MonasticTitle(-1, -1);
			this._actualAge = info.Age;
			this._currAge = this._actualAge;
			InscribedCharacter inscribedChar = info.InscribedChar;
			this._birthMonth = ((inscribedChar != null) ? inscribedChar.BirthMonth : info.BirthMonth);
			this._health = short.MaxValue;
			InscribedCharacter inscribedChar2 = info.InscribedChar;
			this._baseMaxHealth = ((inscribedChar2 != null) ? inscribedChar2.BaseMaxHealth : Character.GenerateProtagonistMaxHealth(context.Random));
			this._happiness = 0;
			InscribedCharacter inscribedChar3 = info.InscribedChar;
			this._baseMorality = ((inscribedChar3 != null) ? inscribedChar3.Morality : info.Morality);
			this._location = Location.Invalid;
			sbyte orgTemplateId = this._organizationInfo.OrgTemplateId;
			short settlementId = DomainManager.Organization.GetSettlementIdByOrgTemplateId(orgTemplateId);
			this._organizationInfo = new OrganizationInfo(orgTemplateId, this._organizationInfo.Grade, true, settlementId);
			InscribedCharacter inscribedChar4 = info.InscribedChar;
			this._avatar = (((inscribedChar4 != null) ? inscribedChar4.Avatar : null) ?? info.Avatar);
			bool flag2 = this._gender != this._avatar.GetGender();
			if (flag2)
			{
				this._transgender = true;
			}
			bool flag3 = random.CheckPercentProb(20);
			if (flag3)
			{
				this._bisexual = true;
			}
			this._loopingNeigong = -1;
			this.OfflineInitializeBaseNeiliProportionOfFiveElements();
			this._resources.Initialize();
			this._resources.Items.FixedElementField = 50;
			*(ref this._resources.Items.FixedElementField + (IntPtr)6 * 4) = 990;
			this.OfflineCreateEquipmentAndInventoryItems(context, template, AgeGroup.GetAgeGroup(this._actualAge));
			this.OfflineReplaceProtagonistClothing(context, info.ClothingTemplateId);
			foreach (ValueTuple<TemplateKey, int> initialItem in Character.ProtagonistInitialItems)
			{
				this.OfflineCreateInventoryOnCharacterCreation(context, initialItem.Item1.ItemType, initialItem.Item1.TemplateId, initialItem.Item2);
			}
			this._eatingItems.Initialize();
			CombatSkillHelper.InitializeEquippedSkills(this._equippedCombatSkills);
			CombatSkillAttainmentPanelsHelper.Initialize(this._combatSkillAttainmentPanels);
			List<GameData.Domains.CombatSkill.CombatSkill> combatSkills = this.OfflineCreateCombatSkills(random, template.PresetCombatSkills);
			bool flag4 = info.InscribedChar != null;
			if (flag4)
			{
				this._baseMainAttributes = info.InscribedChar.BaseMainAttributes;
				this._baseLifeSkillQualifications = info.InscribedChar.BaseLifeSkillQualifications;
				this._baseCombatSkillQualifications = info.InscribedChar.BaseCombatSkillQualifications;
				this._lifeSkillQualificationGrowthType = info.InscribedChar.LifeSkillQualificationGrowthType;
				this._combatSkillQualificationGrowthType = info.InscribedChar.CombatSkillQualificationGrowthType;
				this._skillQualificationBonuses.Add(info.InscribedChar.InnateSkillQualificationBonuses[0]);
				this._skillQualificationBonuses.Add(info.InscribedChar.InnateSkillQualificationBonuses[1]);
			}
			else
			{
				OrganizationMemberItem orgMemberCfg = OrganizationMember.Instance[orgMemberId];
				this._baseMainAttributes = CharacterCreation.CreateMainAttributes(random, orgMemberCfg.Grade, orgMemberCfg.MainAttributesAdjust);
				this._baseLifeSkillQualifications = CharacterCreation.CreateLifeSkillQualifications(random, orgMemberCfg.Grade, orgMemberCfg.LifeSkillsAdjust);
				this._baseCombatSkillQualifications = CharacterCreation.CreateCombatSkillQualifications(random, orgMemberCfg.Grade, orgMemberCfg.CombatSkillsAdjust);
				this._lifeSkillQualificationGrowthType = (sbyte)random.Next(3);
				this._combatSkillQualificationGrowthType = (sbyte)random.Next(3);
				this._skillQualificationBonuses.Add(Character.GenerateRandomInnateSkillQualificationBonus(context));
				this._skillQualificationBonuses.Add(Character.GenerateRandomInnateSkillQualificationBonus(context));
			}
			short value = (short)(40 + random.Next(21));
			bool flag5 = *(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)7 * 2) < value;
			if (flag5)
			{
				*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)7 * 2) = value;
			}
			ValueTuple<short, short> valueTuple = Character.GenerateRandomHobby(random);
			this._lovingItemSubType = valueTuple.Item1;
			this._hatingItemSubType = valueTuple.Item2;
			this.OfflineGenerateRandomIdealSect(random);
			Character.ProtagonistFeatureRelatedStatus protagonistFeatureRelatedStatus = this.OfflineApplyProtagonistFeaturesAndGenome(context, info, combatSkills);
			this._actionEnergies.Initialize();
			this._prioritizedActionCooldowns.Initialize();
			this._kidnapperId = -1;
			this._leaderId = -1;
			this._factionId = -1;
			this._srcCharId = -1;
			return protagonistFeatureRelatedStatus;
		}

		// Token: 0x06006F86 RID: 28550 RVA: 0x003F76F8 File Offset: 0x003F58F8
		public void OfflineCreateCharacterFromInscription(DataContext context, CreateIntelligentCharacterModification mod, InscribedCharacter inscribedChar, OrganizationInfo targetOrgInfo)
		{
			OrganizationMemberItem orgMemberConfig = OrganizationDomain.GetOrgMemberConfig(targetOrgInfo);
			OrganizationItem orgConfig = Organization.Instance[targetOrgInfo.OrgTemplateId];
			CharacterItem template = this.Template;
			int customSurnameId = (inscribedChar.Surname != null) ? DomainManager.World.RegisterCustomText(context, inscribedChar.Surname) : -1;
			int customGivenNameId = (inscribedChar.GivenName != null) ? DomainManager.World.RegisterCustomText(context, inscribedChar.GivenName) : -1;
			this._fullName = ((customSurnameId >= 0 && customGivenNameId >= 0) ? new FullName(customSurnameId, customGivenNameId, -1, -1, -1, -1) : new FullName((customGivenNameId >= 0) ? customGivenNameId : customSurnameId, -1, -1));
			this._monasticTitle = new MonasticTitle(-1, -1);
			this._organizationInfo = targetOrgInfo;
			this._avatar = new AvatarData(inscribedChar.Avatar);
			this._currAge = inscribedChar.CurrAge;
			this._actualAge = inscribedChar.ActualAge;
			this._birthMonth = inscribedChar.BirthMonth;
			this._gender = inscribedChar.Gender;
			this._baseMorality = inscribedChar.Morality;
			this._baseMaxHealth = inscribedChar.BaseMaxHealth;
			this._health = short.MaxValue;
			this._baseMainAttributes = inscribedChar.BaseMainAttributes;
			this._baseCombatSkillQualifications = inscribedChar.BaseCombatSkillQualifications;
			this._baseLifeSkillQualifications = inscribedChar.BaseLifeSkillQualifications;
			this._combatSkillQualificationGrowthType = inscribedChar.CombatSkillQualificationGrowthType;
			this._lifeSkillQualificationGrowthType = inscribedChar.LifeSkillQualificationGrowthType;
			this._skillQualificationBonuses.AddRange(inscribedChar.InnateSkillQualificationBonuses);
			this._featureIds.Add(CharacterDomain.GetBirthdayFeatureId(this._birthMonth));
			this._featureIds.Add(216);
			this._featureIds.Add(195);
			bool flag = inscribedChar.FeatureIds != null;
			if (flag)
			{
				this._featureIds.AddRange(inscribedChar.FeatureIds);
			}
			this._featureIds.Sort(CharacterFeatureHelper.FeatureComparer);
			IRandomSource random = context.Random;
			this.OfflineCreateGenome(random, null, null, null);
			ValueTuple<short, short> valueTuple = Character.GenerateRandomHobby(random);
			this._lovingItemSubType = valueTuple.Item1;
			this._hatingItemSubType = valueTuple.Item2;
			this.OfflineGenerateRandomIdealSect(random);
			this._loopingNeigong = -1;
			this.OfflineInitializeBaseNeiliProportionOfFiveElements();
			int ageInfluence = Character.CalcAgeInfluence(random, this, orgMemberConfig);
			this._extraNeili = (int)orgMemberConfig.Neili * ageInfluence / 100;
			this._consummateLevel = (sbyte)((int)orgMemberConfig.ConsummateLevel * ageInfluence / 100);
			sbyte ageGroup = AgeGroup.GetAgeGroup(this._actualAge);
			this.OfflineCreateEquipmentAndInventoryItems(mod, this.Template, ageGroup);
			this.OfflineAddPresetOrgMemberEquipmentAndInventoryItems(context, mod, orgMemberConfig, ageGroup);
			this.OfflineCreateResources(random, orgMemberConfig.TemplateId, 20);
			this._eatingItems.Initialize();
			CombatSkillHelper.InitializeEquippedSkills(this._equippedCombatSkills);
			CombatSkillAttainmentPanelsHelper.Initialize(this._combatSkillAttainmentPanels);
			this.OfflineCreateCombatSkills(random, template.PresetCombatSkills, mod);
			this.OfflineAddPresetOrgMemberCombatSkills(context, mod, orgConfig, orgMemberConfig, ageInfluence);
			this.OfflineCreateInitialLifeSkills(random, orgMemberConfig);
			this._prioritizedActionCooldowns.Initialize();
			this._actionEnergies.Initialize();
			this.OfflineGenerateRandomActionEnergies(random);
			this._kidnapperId = -1;
			this._leaderId = -1;
			this._factionId = -1;
			this._srcCharId = -1;
		}

		// Token: 0x06006F87 RID: 28551 RVA: 0x003F7A04 File Offset: 0x003F5C04
		public List<GameData.Domains.CombatSkill.CombatSkill> OfflineCreatePresetCharacter(short templateId, DataContext context)
		{
			IRandomSource random = context.Random;
			CharacterItem template = Character.Instance[templateId];
			bool flag = template.CreatingType != 0 && template.CreatingType != 3;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(52, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to create preset character by templateId: ");
				defaultInterpolatedStringHandler.AppendFormatted<short>(templateId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			this._monasticTitle = new MonasticTitle(-1, -1);
			this._actualAge = template.ActualAge;
			this._currAge = ((template.InitCurrAge >= 0) ? template.InitCurrAge : this._actualAge);
			this._birthMonth = ((template.BirthMonth >= 0) ? template.BirthMonth : ((sbyte)random.Next(12)));
			bool flag2 = this._gender == -1;
			if (flag2)
			{
				this._gender = Gender.GetRandom(random);
			}
			sbyte orgTemplateId = this._organizationInfo.OrgTemplateId;
			short settlementId = DomainManager.Organization.GetSettlementIdByOrgTemplateId(orgTemplateId);
			this._organizationInfo = new OrganizationInfo(orgTemplateId, this._organizationInfo.Grade, true, settlementId);
			this._avatar = AvatarManager.Instance.GetRandomAvatar(random, this._gender, this._transgender, template.PresetBodyType, template.BaseAttraction);
			CharacterCreation.CreateFeatures(context.Random, this);
			this.OfflineCreateGenome(context.Random, null, null, null);
			this._loopingNeigong = -1;
			NeiliProportionOfFiveElements presetProportion = template.PresetNeiliProportionOfFiveElements;
			bool flag3 = presetProportion.SumCheck() > 0;
			if (flag3)
			{
				this._baseNeiliProportionOfFiveElements = presetProportion;
			}
			else
			{
				this.OfflineInitializeBaseNeiliProportionOfFiveElements();
			}
			CombatSkillHelper.InitializeEquippedSkills(this._equippedCombatSkills);
			CombatSkillAttainmentPanelsHelper.Initialize(this._combatSkillAttainmentPanels);
			this.OfflineCreateEquipmentAndInventoryItems(context, template, AgeGroup.GetAgeGroup(this._actualAge));
			List<GameData.Domains.CombatSkill.CombatSkill> combatSkills = this.OfflineCreateCombatSkills(random, template.PresetCombatSkills);
			this.OfflineCreatePresetLifeSkillsByGradeConfig();
			this._eatingItems.Initialize();
			bool flag4 = this._idealSect <= 0;
			if (flag4)
			{
				this.OfflineGenerateRandomIdealSect(random);
			}
			bool flag5 = this._lifeSkillTypeInterest < 0;
			if (flag5)
			{
				this._lifeSkillTypeInterest = (sbyte)random.Next(16);
			}
			bool flag6 = this._combatSkillTypeInterest < 0;
			if (flag6)
			{
				this._combatSkillTypeInterest = (sbyte)random.Next(14);
			}
			bool flag7 = this._mainAttributeInterest < 0;
			if (flag7)
			{
				this._mainAttributeInterest = (sbyte)random.Next(6);
			}
			this._birthLocation = Location.Invalid;
			this._location = Location.Invalid;
			this._skillQualificationBonuses.Add(Character.GenerateRandomInnateSkillQualificationBonus(context));
			this._skillQualificationBonuses.Add(Character.GenerateRandomInnateSkillQualificationBonus(context));
			this._actionEnergies.Initialize();
			this._prioritizedActionCooldowns.Initialize();
			this._kidnapperId = -1;
			this._leaderId = -1;
			this._factionId = -1;
			this._srcCharId = -1;
			return combatSkills;
		}

		// Token: 0x06006F88 RID: 28552 RVA: 0x003F7CBE File Offset: 0x003F5EBE
		public void OfflineSetSrcCharId(int charId)
		{
			Tester.Assert(DomainManager.Character.IsTemporaryIntelligentCharacter(this._id), "");
			this._srcCharId = charId;
		}

		// Token: 0x06006F89 RID: 28553 RVA: 0x003F7CE4 File Offset: 0x003F5EE4
		public void OfflineSetCopySource(int charId)
		{
			this._eatingItems.Initialize();
			this._injuries.Initialize();
			this._poisoned.Initialize();
			this._inventory.Items.Clear();
			this._equipment = new ItemKey[12];
			for (int i = 0; i < 12; i++)
			{
				this._equipment[i] = ItemKey.Invalid;
			}
			this._kidnapperId = -1;
			this._leaderId = -1;
			this._factionId = -1;
			this._srcCharId = charId;
		}

		// Token: 0x06006F8A RID: 28554 RVA: 0x003F7D74 File Offset: 0x003F5F74
		public void OfflineCreateIntelligentCharacter(DataContext context, CreateIntelligentCharacterModification mod, ref IntelligentCharacterCreationInfo info)
		{
			IRandomSource random = context.Random;
			CharacterItem template = Character.Instance[info.CharTemplateId];
			bool flag = template.CreatingType != 1;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(57, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to create intelligent character by templateId: ");
				defaultInterpolatedStringHandler.AppendFormatted<short>(info.CharTemplateId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			sbyte orgTemplateId = info.OrgInfo.OrgTemplateId;
			bool isWangliuStronghold = info.Location.AreaId == 138 && orgTemplateId == 38;
			bool flag2 = isWangliuStronghold;
			if (flag2)
			{
				sbyte stateTemplateId = DomainManager.World.GetTaiwuVillageStateTemplateId();
				orgTemplateId = MapState.Instance[stateTemplateId].SectID;
			}
			short orgMemberId = OrganizationDomain.GetMemberId(orgTemplateId, info.OrgInfo.Grade);
			OrganizationItem orgConfig = Organization.Instance[orgTemplateId];
			OrganizationMemberItem orgMemberConfig = OrganizationMember.Instance[orgMemberId];
			this._organizationInfo = info.OrgInfo;
			this._monasticTitle = new MonasticTitle(-1, -1);
			this.OfflineCreateRandomName(context, ref info, mod, (info.Race >= 0) ? info.Race : template.Race);
			this._actualAge = ((info.Age >= 0) ? info.Age : Character.GenerateRandomAge(random));
			this._currAge = this._actualAge;
			this._birthMonth = ((info.BirthMonth >= 0) ? info.BirthMonth : ((template.BirthMonth >= 0) ? template.BirthMonth : ((sbyte)random.Next(12))));
			this._health = short.MaxValue;
			this._baseMaxHealth = Character.GenerateRandomMaxHealth(random);
			int ageInfluence = Character.CalcAgeInfluence(random, this, orgMemberConfig);
			this._happiness = (sbyte)random.Next(-59, 60);
			this._birthLocation = info.Location;
			this._location = info.Location;
			bool flag3 = info.DestinyType >= 0;
			if (flag3)
			{
				DestinyTypeItem destinyTypeCfg = DestinyType.Instance[info.DestinyType];
				this._baseMorality = (short)random.Next((int)destinyTypeCfg.MoralityRange[0], (int)destinyTypeCfg.MoralityRange[1]);
				info.GrowingSectGrade = (sbyte)random.Next((int)destinyTypeCfg.OrganizationGradeRange[0], (int)destinyTypeCfg.OrganizationGradeRange[1]);
			}
			else
			{
				bool flag4 = orgConfig.MainMorality != short.MinValue && random.CheckPercentProb(60);
				if (flag4)
				{
					int morality = (int)orgConfig.MainMorality + random.Next(301) - 150;
					this._baseMorality = (short)Math.Clamp(morality, -500, 500);
				}
				else
				{
					this._baseMorality = (short)(random.Next(1001) - 500);
				}
			}
			bool flag5 = info.Gender != -1;
			if (flag5)
			{
				this._gender = info.Gender;
				this._transgender = info.Transgender;
			}
			else
			{
				bool flag6 = random.CheckPercentProb(3);
				if (flag6)
				{
					this._transgender = true;
				}
			}
			bool flag7 = random.CheckPercentProb(10);
			if (flag7)
			{
				this._bisexual = true;
			}
			bool flag8 = ProfessionSkillHandle.BuddhistMonkSkill_IsDirectedSamsaraCharacter(mod.ReincarnationCharId);
			if (flag8)
			{
				DeadCharacter reincarnatedDeadChar;
				bool flag9 = DomainManager.Character.TryGetDeadCharacter(mod.ReincarnationCharId, out reincarnatedDeadChar);
				if (flag9)
				{
					this._gender = reincarnatedDeadChar.Gender;
					this._transgender = (this._gender != reincarnatedDeadChar.Avatar.Gender);
				}
				else
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(68, 1);
					defaultInterpolatedStringHandler.AppendLiteral("[Debug] Creation Intelligent Character ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(mod.ReincarnationCharId);
					defaultInterpolatedStringHandler.AppendLiteral(". Cannot find dead character.");
					AdaptableLog.Warning(defaultInterpolatedStringHandler.ToStringAndClear(), false);
				}
			}
			this.OfflineCreateAttractionAndAvatar(context, template.PresetBodyType, ref info, false);
			CharacterCreation.CreateFeatures(random, this, ref info);
			bool specifyGenome = info.SpecifyGenome;
			if (specifyGenome)
			{
				this._genome = info.Genome;
			}
			else
			{
				this.OfflineCreateGenome(random, info.Mother, info.PregnantState, info.ActualFather);
			}
			bool flag10 = this._lifeSkillTypeInterest < 0;
			if (flag10)
			{
				this._lifeSkillTypeInterest = (sbyte)random.Next(16);
			}
			bool flag11 = this._combatSkillTypeInterest < 0;
			if (flag11)
			{
				this._combatSkillTypeInterest = (sbyte)random.Next(14);
			}
			bool flag12 = this._mainAttributeInterest < 0;
			if (flag12)
			{
				this._mainAttributeInterest = (sbyte)random.Next(6);
			}
			bool flag13 = this._idealSect <= 0;
			if (flag13)
			{
				this.OfflineGenerateRandomIdealSect(random);
			}
			ValueTuple<short, short> valueTuple = Character.GenerateRandomHobby(random);
			this._lovingItemSubType = valueTuple.Item1;
			this._hatingItemSubType = valueTuple.Item2;
			sbyte growingGrade = CharacterCreation.CalcGrowingSectGradeAndAssignWeights(context.Random, ref info, this._idealSect);
			bool flag14 = info.GrowingSectGrade < 0;
			if (flag14)
			{
				info.GrowingSectGrade = growingGrade;
			}
			mod.GrowingSectGrade = info.GrowingSectGrade;
			this._baseMainAttributes = CharacterCreation.CreateMainAttributes(random, ref info, 2, 20);
			this._baseLifeSkillQualifications = CharacterCreation.CreateLifeSkillQualifications(random, ref info, 4, 20);
			this._baseCombatSkillQualifications = CharacterCreation.CreateCombatSkillQualifications(random, ref info, 3, 20);
			this._lifeSkillQualificationGrowthType = ((info.LifeSkillQualificationGrowthType < 0) ? ((sbyte)random.Next(3)) : info.LifeSkillQualificationGrowthType);
			this._combatSkillQualificationGrowthType = ((info.CombatSkillQualificationGrowthType < 0) ? ((sbyte)random.Next(3)) : info.CombatSkillQualificationGrowthType);
			this._skillQualificationBonuses.Add(Character.GenerateRandomInnateSkillQualificationBonus(context));
			this._skillQualificationBonuses.Add(Character.GenerateRandomInnateSkillQualificationBonus(context));
			this._loopingNeigong = -1;
			this.OfflineInitializeBaseNeiliProportionOfFiveElements();
			this._extraNeili = (int)orgMemberConfig.Neili * ageInfluence / 100;
			this._consummateLevel = (sbyte)((int)orgMemberConfig.ConsummateLevel * ageInfluence / 100);
			sbyte ageGroup = AgeGroup.GetAgeGroup(this._actualAge);
			this.OfflineCreateEquipmentAndInventoryItems(mod, template, ageGroup);
			bool flag15 = isWangliuStronghold;
			if (flag15)
			{
				this.OfflineAddPresetOrgMemberEquipmentAndInventoryItems(context, mod, OrganizationDomain.GetOrgMemberConfig(orgTemplateId, this._organizationInfo.Grade / 2), ageGroup);
			}
			else
			{
				this.OfflineAddPresetOrgMemberEquipmentAndInventoryItems(context, mod, orgMemberConfig, ageGroup);
			}
			this.OfflineCreateResources(random, orgMemberId, 20);
			this._eatingItems.Initialize();
			CombatSkillHelper.InitializeEquippedSkills(this._equippedCombatSkills);
			CombatSkillAttainmentPanelsHelper.Initialize(this._combatSkillAttainmentPanels);
			this.OfflineCreateCombatSkills(random, template.PresetCombatSkills, mod);
			bool initializeSectSkills = info.InitializeSectSkills;
			if (initializeSectSkills)
			{
				this.OfflineAddPresetOrgMemberCombatSkills(context, mod, orgConfig, orgMemberConfig, ageInfluence);
			}
			bool flag16 = ageGroup != 0 && info.InitializeSectSkills;
			if (flag16)
			{
				this.OfflineCreateInitialLifeSkills(random, orgMemberConfig);
			}
			this._prioritizedActionCooldowns.Initialize();
			this._actionEnergies.Initialize();
			this.OfflineGenerateRandomActionEnergies(random);
			this._kidnapperId = -1;
			this._leaderId = -1;
			this._factionId = -1;
			this._srcCharId = -1;
		}

		// Token: 0x06006F8B RID: 28555 RVA: 0x003F83E4 File Offset: 0x003F65E4
		public void OfflineCreateTemporaryIntelligentCharacter(DataContext context, CreateIntelligentCharacterModification mod, ref IntelligentCharacterCreationInfo info, ref TemporaryIntelligentCharacterCreationInfo tmpInfo)
		{
			IRandomSource random = context.Random;
			CharacterItem template = Character.Instance[info.CharTemplateId];
			bool flag = template.CreatingType != 1;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(57, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to create intelligent character by templateId: ");
				defaultInterpolatedStringHandler.AppendFormatted<short>(info.CharTemplateId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			sbyte orgTemplateId = info.OrgInfo.OrgTemplateId;
			short orgMemberId = OrganizationDomain.GetMemberId(orgTemplateId, info.OrgInfo.Grade);
			OrganizationItem orgConfig = Organization.Instance[orgTemplateId];
			OrganizationMemberItem orgMemberConfig = OrganizationMember.Instance[orgMemberId];
			this._organizationInfo = info.OrgInfo;
			this._monasticTitle = new MonasticTitle(-1, -1);
			this.OfflineCreateRandomName(context, ref info, mod, template.Race);
			this._actualAge = ((info.Age >= 0) ? info.Age : Character.GenerateRandomAge(random));
			this._currAge = this._actualAge;
			this._birthMonth = ((template.BirthMonth >= 0) ? template.BirthMonth : ((sbyte)random.Next(12)));
			this._happiness = (tmpInfo.Happiness ?? ((sbyte)random.Next(-59, 60)));
			this._health = short.MaxValue;
			this._baseMaxHealth = Character.GenerateRandomMaxHealth(random);
			this._location = info.Location;
			bool flag2 = tmpInfo.Morality != null;
			if (flag2)
			{
				this._baseMorality = tmpInfo.Morality.Value;
			}
			else
			{
				bool flag3 = orgConfig.MainMorality != short.MinValue && random.CheckPercentProb(60);
				if (flag3)
				{
					int morality = (int)orgConfig.MainMorality + random.Next(301) - 150;
					this._baseMorality = (short)Math.Clamp(morality, -500, 500);
				}
				else
				{
					this._baseMorality = (short)(random.Next(1001) - 500);
				}
			}
			bool flag4 = random.CheckPercentProb(3);
			if (flag4)
			{
				this._transgender = true;
			}
			bool flag5 = random.CheckPercentProb(20);
			if (flag5)
			{
				this._bisexual = true;
			}
			this.OfflineCreateAttractionAndAvatar(context, template.PresetBodyType, ref info, tmpInfo.HairNoSkinHead);
			CharacterCreation.CreateFeatures(random, this, ref info);
			bool flag6 = tmpInfo.IsCompletelyInfected != null && tmpInfo.IsCompletelyInfected.Value;
			if (flag6)
			{
				this.OfflineAddFeature(218, true, false);
				this._xiangshuInfection = 200;
				this._organizationInfo = new OrganizationInfo(20, this._organizationInfo.Grade, true, -1);
			}
			bool specifyGenome = info.SpecifyGenome;
			if (specifyGenome)
			{
				this._genome = info.Genome;
			}
			else
			{
				this.OfflineCreateGenome(random, info.Mother, info.PregnantState, info.ActualFather);
			}
			int ageInfluence = Math.Clamp(Character.CalcAgeInfluence(random, this, orgMemberConfig), 75, 100);
			bool flag7 = this._lifeSkillTypeInterest < 0;
			if (flag7)
			{
				this._lifeSkillTypeInterest = (sbyte)random.Next(16);
			}
			bool flag8 = this._combatSkillTypeInterest < 0;
			if (flag8)
			{
				this._combatSkillTypeInterest = (sbyte)random.Next(14);
			}
			bool flag9 = this._mainAttributeInterest < 0;
			if (flag9)
			{
				this._mainAttributeInterest = (sbyte)random.Next(6);
			}
			bool flag10 = this._idealSect <= 0;
			if (flag10)
			{
				this.OfflineGenerateRandomIdealSect(random);
			}
			ValueTuple<short, short> valueTuple = Character.GenerateRandomHobby(random);
			this._lovingItemSubType = valueTuple.Item1;
			this._hatingItemSubType = valueTuple.Item2;
			sbyte growingGrade = CharacterCreation.CalcGrowingSectGradeAndAssignWeights(context.Random, ref info, this._idealSect);
			bool flag11 = info.GrowingSectGrade < 0;
			if (flag11)
			{
				info.GrowingSectGrade = growingGrade;
			}
			mod.GrowingSectGrade = info.GrowingSectGrade;
			this._baseMainAttributes = CharacterCreation.CreateMainAttributes(random, ref info, 2, 20);
			this._baseLifeSkillQualifications = CharacterCreation.CreateLifeSkillQualifications(random, ref info, 4, 20);
			this._baseCombatSkillQualifications = CharacterCreation.CreateCombatSkillQualifications(random, ref info, 3, 20);
			this._lifeSkillQualificationGrowthType = ((info.LifeSkillQualificationGrowthType < 0) ? ((sbyte)random.Next(3)) : info.LifeSkillQualificationGrowthType);
			this._combatSkillQualificationGrowthType = ((info.CombatSkillQualificationGrowthType < 0) ? ((sbyte)random.Next(3)) : info.CombatSkillQualificationGrowthType);
			this._skillQualificationBonuses.Add(Character.GenerateRandomInnateSkillQualificationBonus(context));
			this._skillQualificationBonuses.Add(Character.GenerateRandomInnateSkillQualificationBonus(context));
			this._loopingNeigong = -1;
			this.OfflineInitializeBaseNeiliProportionOfFiveElements();
			this._extraNeili = (int)orgMemberConfig.Neili * ageInfluence / 100;
			this._consummateLevel = (tmpInfo.ConsummateLevel ?? ((sbyte)((int)orgMemberConfig.ConsummateLevel * ageInfluence / 100)));
			sbyte ageGroup = AgeGroup.GetAgeGroup(this._actualAge);
			this.OfflineCreateEquipmentAndInventoryItems(mod, template, ageGroup);
			this.OfflineAddPresetOrgMemberEquipmentAndInventoryItems(context, mod, orgMemberConfig, ageGroup);
			this.OfflineCreateResources(random, orgMemberId, 20);
			this._eatingItems.Initialize();
			CombatSkillHelper.InitializeEquippedSkills(this._equippedCombatSkills);
			CombatSkillAttainmentPanelsHelper.Initialize(this._combatSkillAttainmentPanels);
			this.OfflineCreateCombatSkills(random, template.PresetCombatSkills, mod);
			bool initializeSectSkills = info.InitializeSectSkills;
			if (initializeSectSkills)
			{
				this.OfflineAddPresetOrgMemberCombatSkills(context, mod, orgConfig, orgMemberConfig, ageInfluence);
			}
			bool flag12 = ageGroup != 0 && info.InitializeSectSkills;
			if (flag12)
			{
				this.OfflineCreateInitialLifeSkills(random, orgMemberConfig);
			}
			this._prioritizedActionCooldowns.Initialize();
			this._actionEnergies.Initialize();
			this.OfflineGenerateRandomActionEnergies(random);
			this._kidnapperId = -1;
			this._leaderId = -1;
			this._factionId = -1;
			this._srcCharId = -1;
		}

		// Token: 0x06006F8C RID: 28556 RVA: 0x003F8948 File Offset: 0x003F6B48
		public List<GameData.Domains.CombatSkill.CombatSkill> OfflineCreateRandomEnemy(short templateId, DataContext context)
		{
			IRandomSource random = context.Random;
			CharacterItem template = Character.Instance[templateId];
			bool flag = template.CreatingType != 2;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to create random enemy by templateId: ");
				defaultInterpolatedStringHandler.AppendFormatted<short>(templateId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			bool flag2 = this._gender == -1;
			if (flag2)
			{
				this._gender = Gender.GetRandom(random);
			}
			this._monasticTitle = new MonasticTitle(-1, -1);
			this._actualAge = Character.GenerateRandomAge(random, template.ActualAge);
			this._currAge = ((template.InitCurrAge >= 0) ? template.InitCurrAge : this._actualAge);
			this._birthMonth = ((template.BirthMonth >= 0) ? template.BirthMonth : ((sbyte)random.Next(12)));
			this._health = short.MaxValue;
			this._baseMaxHealth = Character.GenerateRandomMaxHealth(random);
			sbyte orgTemplateId = this._organizationInfo.OrgTemplateId;
			short settlementId = DomainManager.Organization.GetSettlementIdByOrgTemplateId(orgTemplateId);
			this._organizationInfo = new OrganizationInfo(orgTemplateId, this._organizationInfo.Grade, true, settlementId);
			sbyte bodyType = template.PresetBodyType;
			bool flag3 = bodyType < 0;
			if (flag3)
			{
				bodyType = BodyType.GetRandom(random);
			}
			short baseAttraction = template.BaseAttraction;
			bool flag4 = baseAttraction < 0;
			if (flag4)
			{
				baseAttraction = Character.GenerateRandomAttraction(random);
			}
			this._avatar = AvatarManager.Instance.GetRandomAvatar(random, this._gender, this._transgender, bodyType, baseAttraction);
			CharacterCreation.CreateFeatures(random, this);
			this.OfflineCreateGenome(context.Random, null, null, null);
			RandomEnemyItem randomEnemy = RandomEnemy.Instance[template.RandomEnemyId];
			List<ValueTuple<OrganizationItem, OrganizationMemberItem>> relatedSectAndMembers = Character.GetRelatedSectAndMembers(random, randomEnemy, this._organizationInfo.Grade);
			short[] mainAttributesAdjust = CharacterCreation.GetRandomEnemyMainAttributesAdjust(random, relatedSectAndMembers);
			short[] lifeSkillsAdjust = CharacterCreation.GetRandomEnemyLifeSkillsAdjust(random, relatedSectAndMembers);
			short[] combatSkillsAdjust = CharacterCreation.GetRandomEnemyCombatSkillsAdjust(random, relatedSectAndMembers);
			this._baseMainAttributes = CharacterCreation.CreateMainAttributes(random, this._organizationInfo.Grade, mainAttributesAdjust);
			this._baseLifeSkillQualifications = CharacterCreation.CreateLifeSkillQualifications(random, this._organizationInfo.Grade, lifeSkillsAdjust);
			this._baseCombatSkillQualifications = CharacterCreation.CreateCombatSkillQualifications(random, this._organizationInfo.Grade, combatSkillsAdjust);
			this._lifeSkillQualificationGrowthType = (sbyte)random.Next(3);
			this._combatSkillQualificationGrowthType = (sbyte)random.Next(3);
			this._skillQualificationBonuses.Add(Character.GenerateRandomInnateSkillQualificationBonus(context));
			this._skillQualificationBonuses.Add(Character.GenerateRandomInnateSkillQualificationBonus(context));
			this._loopingNeigong = -1;
			this.OfflineInitializeBaseNeiliProportionOfFiveElements();
			sbyte ageGroup = AgeGroup.GetAgeGroup(this._actualAge);
			this.OfflineCreateEquipmentAndInventoryItems(context, template, ageGroup);
			this.OfflineAddRandomEnemyPresetOrgMemberEquipmentAndInventoryItems(context, randomEnemy, relatedSectAndMembers);
			this._eatingItems.Initialize();
			CombatSkillHelper.InitializeEquippedSkills(this._equippedCombatSkills);
			CombatSkillAttainmentPanelsHelper.Initialize(this._combatSkillAttainmentPanels);
			List<GameData.Domains.CombatSkill.CombatSkill> combatSkills = this.OfflineCreateRandomEnemyCombatSkills(random, randomEnemy, template.PresetCombatSkills);
			this.OfflineAddRandomEnemyOrgMemberCombatSkills(context, randomEnemy, relatedSectAndMembers, combatSkills);
			bool flag5 = relatedSectAndMembers.Count > 0;
			if (flag5)
			{
				int sum = 0;
				for (int i = 0; i < relatedSectAndMembers.Count; i++)
				{
					sum += (int)relatedSectAndMembers[i].Item2.LifeSkillGradeLimit;
				}
				sbyte grade = (sbyte)(sum / relatedSectAndMembers.Count);
				this.OfflineCreateInitialLifeSkills(random, lifeSkillsAdjust, grade);
			}
			this._location = Location.Invalid;
			bool flag6 = this._idealSect <= 0;
			if (flag6)
			{
				this.OfflineGenerateRandomIdealSect(random);
			}
			bool flag7 = this._lifeSkillTypeInterest < 0;
			if (flag7)
			{
				this._lifeSkillTypeInterest = (sbyte)random.Next(16);
			}
			bool flag8 = this._combatSkillTypeInterest < 0;
			if (flag8)
			{
				this._combatSkillTypeInterest = (sbyte)random.Next(14);
			}
			bool flag9 = this._mainAttributeInterest < 0;
			if (flag9)
			{
				this._mainAttributeInterest = (sbyte)random.Next(6);
			}
			this._actionEnergies.Initialize();
			this._prioritizedActionCooldowns.Initialize();
			this._kidnapperId = -1;
			this._leaderId = -1;
			this._factionId = -1;
			return combatSkills;
		}

		// Token: 0x06006F8D RID: 28557 RVA: 0x003F8D30 File Offset: 0x003F6F30
		public void OfflineSetCloseFriendFields(DataContext context, short morality)
		{
			this._organizationInfo.Grade = 0;
			this._featureIds.Clear();
			this._potentialFeatureIds.Clear();
			this._featureIds.Add(164);
			this._featureIds.Add(554);
			this._bisexual = false;
			Genome.EraseAffectedRecessiveTraits(ref this._genome);
			this._baseMorality = morality;
		}

		// Token: 0x06006F8E RID: 28558 RVA: 0x003F8DA0 File Offset: 0x003F6FA0
		public void RemoveUnequippedCombatSkills(DataContext context, sbyte retainingProb = 25)
		{
			HashSet<short> equippedCombatSkills = new HashSet<short>();
			CombatSkillEquipment combatSkillEquipment = this.GetCombatSkillEquipment();
			combatSkillEquipment.GetValidSkills(equippedCombatSkills);
			List<short> retainedCombatSkillIds = new List<short>(this._learnedCombatSkills.Count);
			int i = 0;
			int count = this._learnedCombatSkills.Count;
			while (i < count)
			{
				short skillTemplateId = this._learnedCombatSkills[i];
				bool flag = equippedCombatSkills.Contains(skillTemplateId);
				if (flag)
				{
					retainedCombatSkillIds.Add(skillTemplateId);
				}
				else
				{
					bool flag2 = CollectionUtils.Contains<short>(this._combatSkillAttainmentPanels, skillTemplateId);
					if (flag2)
					{
						retainedCombatSkillIds.Add(skillTemplateId);
					}
					else
					{
						CombatSkillKey skillKey = new CombatSkillKey(this._id, skillTemplateId);
						GameData.Domains.CombatSkill.CombatSkill skill = DomainManager.CombatSkill.GetElement_CombatSkills(skillKey);
						bool flag3 = skill.GetObtainedNeili() > 0 || context.Random.CheckPercentProb((int)retainingProb);
						if (flag3)
						{
							retainedCombatSkillIds.Add(skillTemplateId);
						}
						else
						{
							DomainManager.CombatSkill.RemoveCombatSkill(this._id, skillTemplateId);
						}
					}
				}
				i++;
			}
			this._learnedCombatSkills.Clear();
			this._learnedCombatSkills.AddRange(retainedCombatSkillIds);
			this.SetLearnedCombatSkills(this._learnedCombatSkills, context);
		}

		// Token: 0x06006F8F RID: 28559 RVA: 0x003F8EC4 File Offset: 0x003F70C4
		public void AddEquipmentAndInventoryItems(DataContext context, PresetEquipmentItem[] equipment, List<PresetInventoryItem> inventory)
		{
			this.OfflineAddEquipmentAndInventoryItems(context, equipment, inventory);
			this.SetEquipment(this._equipment, context);
			this.SetInventory(this._inventory, context);
		}

		// Token: 0x06006F90 RID: 28560 RVA: 0x003F8EED File Offset: 0x003F70ED
		public void AddSkillBooksAndWeapons(DataContext context, List<InventoryCombatSkillBookParams> skillBooks, HashSet<short> skillWeaponIds)
		{
			this.OfflineAddSkillBooksAndWeapons(context, skillBooks, skillWeaponIds);
			this.SetInventory(this._inventory, context);
		}

		// Token: 0x06006F91 RID: 28561 RVA: 0x003F8F08 File Offset: 0x003F7108
		public void RemoveUnequippedEquipment(DataContext context)
		{
			this._itemsToBeDeleted.Clear();
			foreach (KeyValuePair<ItemKey, int> keyValuePair in this._inventory.Items)
			{
				ItemKey itemKey3;
				int num;
				keyValuePair.Deconstruct(out itemKey3, out num);
				ItemKey itemKey = itemKey3;
				EquipmentBase item = DomainManager.Item.TryGetBaseEquipment(itemKey);
				bool flag = item != null;
				if (flag)
				{
					this._itemsToBeDeleted.Add(itemKey);
				}
			}
			int i = 0;
			int count = this._itemsToBeDeleted.Count;
			while (i < count)
			{
				ItemKey itemKey2 = this._itemsToBeDeleted[i];
				this._inventory.OfflineRemove(itemKey2);
				DomainManager.Item.RemoveItem(context, itemKey2);
				i++;
			}
			this.SetInventory(this._inventory, context);
		}

		// Token: 0x06006F92 RID: 28562 RVA: 0x003F8FFC File Offset: 0x003F71FC
		public void OfflineSetId(int id)
		{
			this._id = id;
		}

		// Token: 0x06006F93 RID: 28563 RVA: 0x003F9006 File Offset: 0x003F7206
		public void OfflineSetGenderInfo(sbyte gender, bool transgender)
		{
			this._gender = gender;
			this._transgender = transgender;
		}

		// Token: 0x06006F94 RID: 28564 RVA: 0x003F9017 File Offset: 0x003F7217
		public void OfflineSetAvatar(AvatarData avatar)
		{
			this._avatar = avatar;
		}

		// Token: 0x06006F95 RID: 28565 RVA: 0x003F9021 File Offset: 0x003F7221
		public void OfflineSetTemplateId(short templateId)
		{
			this._templateId = templateId;
		}

		// Token: 0x06006F96 RID: 28566 RVA: 0x003F902B File Offset: 0x003F722B
		public void OfflineSetCreatingType(byte creatingType)
		{
			this._creatingType = creatingType;
		}

		// Token: 0x06006F97 RID: 28567 RVA: 0x003F9035 File Offset: 0x003F7235
		public void OfflineSetXiangshuType(sbyte xiangshuType)
		{
			this._xiangshuType = xiangshuType;
		}

		// Token: 0x06006F98 RID: 28568 RVA: 0x003F903F File Offset: 0x003F723F
		public void OfflineSetBirthLocation(Location location)
		{
			this._birthLocation = location;
		}

		// Token: 0x06006F99 RID: 28569 RVA: 0x003F904C File Offset: 0x003F724C
		public unsafe void OfflineSetPreexistenceCharId(DataContext context, int reincarnationCharId)
		{
			DeadCharacter reincarnationChar = DomainManager.Character.GetDeadCharacter(reincarnationCharId);
			ref PreexistenceCharIds preexistenceCharIds = ref reincarnationChar.PreexistenceCharIds;
			int bonusIndex = reincarnationChar.FeatureIds.FindIndex(new Predicate<short>(Character.IsReincarnationBonusFeature));
			bool flag = bonusIndex >= 0;
			if (flag)
			{
				this.OfflineAddFeature(reincarnationChar.FeatureIds[bonusIndex], true, false);
			}
			this.OfflineInheritPreexistenceCharFeatures(context.Random, reincarnationChar.FeatureIds);
			bool flag2 = preexistenceCharIds.Count < 9;
			if (flag2)
			{
				PreexistenceCharIds copiedPreexistenceCharIds = preexistenceCharIds;
				copiedPreexistenceCharIds.Add(context.Random, reincarnationCharId);
				this._preexistenceCharIds = copiedPreexistenceCharIds;
			}
			else
			{
				int diff = 0;
				for (int i = 0; i < preexistenceCharIds.Count; i++)
				{
					int charId = *(ref preexistenceCharIds.CharIds.FixedElementField + (IntPtr)i * 4);
					bool flag3 = charId < 0;
					if (!flag3)
					{
						DeadCharacter deadChar = DomainManager.Character.TryGetDeadCharacter(charId);
						bool flag4 = deadChar == null;
						if (!flag4)
						{
							bool flag5 = deadChar.FameType == 3 || deadChar.FameType == -2;
							if (flag5)
							{
								diff += (context.Random.NextBool() ? 1 : -1);
							}
							else
							{
								diff += ((deadChar.FameType > 3) ? 1 : -1);
							}
						}
					}
				}
				short featureId = (diff >= 0) ? ((short)context.Random.Next(257, 262)) : ((short)context.Random.Next(394, 399));
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(62, 3);
				defaultInterpolatedStringHandler.AppendLiteral("Reincarnation bonus feature ");
				defaultInterpolatedStringHandler.AppendFormatted(CharacterFeature.Instance[featureId].Name);
				defaultInterpolatedStringHandler.AppendLiteral(" is added to character ");
				defaultInterpolatedStringHandler.AppendFormatted<Character>(this);
				defaultInterpolatedStringHandler.AppendLiteral(" with diff ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(diff);
				AdaptableLog.Info(defaultInterpolatedStringHandler.ToStringAndClear());
				this.OfflineAddFeature(featureId, true, false);
				DomainManager.Character.RecordDeletedFromOthersPreexistence(context, ref preexistenceCharIds);
				this._preexistenceCharIds.Reset();
				this._preexistenceCharIds.Add(context.Random, reincarnationCharId);
			}
		}

		// Token: 0x06006F9A RID: 28570 RVA: 0x003F9274 File Offset: 0x003F7474
		public unsafe void OfflineInheritPreexistenceCharFeatures(IRandomSource randomSource, List<short> featureIds)
		{
			int count = featureIds.Count;
			Span<short> span = new Span<short>(stackalloc byte[checked(unchecked((UIntPtr)count) * 2)], count);
			SpanList<short> inheritableFeatures = span;
			foreach (short featureId in featureIds)
			{
				bool inheritableThroughSamsara = CharacterFeature.Instance[featureId].InheritableThroughSamsara;
				if (inheritableThroughSamsara)
				{
					inheritableFeatures.Add(featureId);
				}
			}
			bool flag = inheritableFeatures.Count <= 0;
			if (!flag)
			{
				int inheritCount = randomSource.Next(3) + 1;
				int i = 0;
				while (i < inheritCount && inheritableFeatures.Count > 0)
				{
					int index = randomSource.Next(inheritableFeatures.Count);
					short featureId2 = *inheritableFeatures[index];
					inheritableFeatures.SwapRemove(index);
					this.OfflineAddFeature(featureId2, true, true);
					i++;
				}
			}
		}

		// Token: 0x06006F9B RID: 28571 RVA: 0x003F9374 File Offset: 0x003F7574
		internal unsafe void ClearPreexistenceCharIds(DataContext context)
		{
			this._preexistenceCharIds.Reset();
			base.SetModifiedAndInvalidateInfluencedCache(64, context);
			bool isArchive = this.CollectionHelperData.IsArchive;
			if (isArchive)
			{
				byte* pData = OperationAdder.DynamicObjectCollection_SetFixedField<int>(this.CollectionHelperData.DomainId, this.CollectionHelperData.DataId, this._id, 954U, 52);
				pData += this._preexistenceCharIds.Serialize(pData);
			}
		}

		// Token: 0x06006F9C RID: 28572 RVA: 0x003F93E4 File Offset: 0x003F75E4
		public void OfflineCreateRandomName(IRandomSource random, int customSurnameId = -1, int customGivenNameId = -1)
		{
			sbyte race = Character.Instance[this._templateId].Race;
			bool flag = race == 0;
			if (flag)
			{
				bool flag2 = this._gender == 0;
				if (flag2)
				{
					this._fullName = CharacterDomain.GenerateRandomHanName(random, customSurnameId, -1, this._gender, -1);
				}
				else
				{
					this._fullName = CharacterDomain.GenerateRandomHanName(random, customSurnameId, -1, this._gender, 0);
				}
			}
			else
			{
				this._fullName = CharacterDomain.GenerateRandomZangName(random, this._gender);
			}
		}

		// Token: 0x06006F9D RID: 28573 RVA: 0x003F9460 File Offset: 0x003F7660
		internal void SetCharacterUnamedStatus(DataContext context, bool unamed)
		{
			if (unamed)
			{
				this._fullName.Type = (this._fullName.Type | 16);
			}
			else
			{
				this._fullName.Type = (this._fullName.Type & -17);
			}
			this.SetFullName(this._fullName, context);
		}

		// Token: 0x06006F9E RID: 28574 RVA: 0x003F94A8 File Offset: 0x003F76A8
		public void OfflineRecreateByGrowingSect(IRandomSource random, sbyte growingOrgTemplateId, sbyte growingGrade)
		{
			OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(growingOrgTemplateId, growingGrade);
			this._baseMainAttributes = CharacterCreation.CreateMainAttributes(random, growingGrade, orgMemberCfg.MainAttributesAdjust);
			this._baseLifeSkillQualifications = CharacterCreation.CreateLifeSkillQualifications(random, growingGrade, orgMemberCfg.LifeSkillsAdjust);
			this._baseCombatSkillQualifications = CharacterCreation.CreateCombatSkillQualifications(random, growingGrade, orgMemberCfg.CombatSkillsAdjust);
			this._lifeSkillQualificationGrowthType = (sbyte)random.Next(3);
			this._combatSkillQualificationGrowthType = (sbyte)random.Next(3);
		}

		// Token: 0x06006F9F RID: 28575 RVA: 0x003F9514 File Offset: 0x003F7714
		public void RecreateMainAttributes(DataContext context, sbyte growingOrgTemplateId, sbyte growingGrade)
		{
			IRandomSource random = context.Random;
			short orgMemberId = this.ChooseGrowingSectMember(random, growingOrgTemplateId, growingGrade);
			OrganizationMemberItem orgMemberCfg = OrganizationMember.Instance[orgMemberId];
			this._baseMainAttributes = CharacterCreation.CreateMainAttributes(random, growingGrade, orgMemberCfg.MainAttributesAdjust);
			this.SetBaseMainAttributes(this._baseMainAttributes, context);
		}

		// Token: 0x06006FA0 RID: 28576 RVA: 0x003F9560 File Offset: 0x003F7760
		public void RecreateCombatSkillQualifications(DataContext context, sbyte growingOrgTemplateId, sbyte growingGrade)
		{
			IRandomSource random = context.Random;
			short orgMemberId = this.ChooseGrowingSectMember(random, growingOrgTemplateId, growingGrade);
			OrganizationMemberItem orgMemberCfg = OrganizationMember.Instance[orgMemberId];
			this._baseCombatSkillQualifications = CharacterCreation.CreateCombatSkillQualifications(random, growingGrade, orgMemberCfg.CombatSkillsAdjust);
			this.SetBaseCombatSkillQualifications(ref this._baseCombatSkillQualifications, context);
		}

		// Token: 0x06006FA1 RID: 28577 RVA: 0x003F95AC File Offset: 0x003F77AC
		public void RecreateLifeSkillQualifications(DataContext context, sbyte growingOrgTemplateId, sbyte growingGrade)
		{
			IRandomSource random = context.Random;
			short orgMemberId = this.ChooseGrowingSectMember(random, growingOrgTemplateId, growingGrade);
			OrganizationMemberItem orgMemberCfg = OrganizationMember.Instance[orgMemberId];
			this._baseLifeSkillQualifications = CharacterCreation.CreateLifeSkillQualifications(random, growingGrade, orgMemberCfg.LifeSkillsAdjust);
			this.SetBaseLifeSkillQualifications(ref this._baseLifeSkillQualifications, context);
		}

		// Token: 0x06006FA2 RID: 28578 RVA: 0x003F95F8 File Offset: 0x003F77F8
		public void RecreateFeatures(DataContext context, int positiveFeatureRate, sbyte featureMedalType)
		{
			for (int i = this._featureIds.Count - 1; i >= 0; i--)
			{
				short featureId = this._featureIds[i];
				CharacterFeatureItem featureCfg = CharacterFeature.Instance[featureId];
				bool flag = !featureCfg.Basic;
				if (!flag)
				{
					bool flag2 = featureCfg.MutexGroupId == 168;
					if (!flag2)
					{
						this._featureIds.Remove(featureId);
					}
				}
			}
			this._potentialFeatureIds.Clear();
			int basicFeaturesCount = CharacterCreation.GenerateRandomBasicFeaturesCount(context.Random);
			bool flag3 = basicFeaturesCount <= 0;
			if (!flag3)
			{
				bool isProtagonist = this._id == DomainManager.Taiwu.GetTaiwuCharId();
				Dictionary<short, short> featureGroup2Id = new Dictionary<short, short>(16);
				IRandomSource random = context.Random;
				int goodFeaturesPotential = positiveFeatureRate;
				featureGroup2Id.Add(168, -1);
				int j = 0;
				while (j < basicFeaturesCount)
				{
					bool flag4 = random.CheckPercentProb(goodFeaturesPotential);
					if (flag4)
					{
						sbyte currFeatureMedalType = featureMedalType;
						bool flag5 = featureMedalType != 3 && !context.Random.CheckPercentProb(60);
						if (flag5)
						{
							currFeatureMedalType = 3;
						}
						ValueTuple<short, short> randomBasicFeature = CharacterDomain.GetRandomBasicFeature(random, isProtagonist, this._gender, true, currFeatureMedalType, featureGroup2Id, 3);
						short groupId = randomBasicFeature.Item1;
						short featureId2 = randomBasicFeature.Item2;
						bool flag6 = featureId2 < 0;
						if (!flag6)
						{
							featureGroup2Id.Add(groupId, featureId2);
							goodFeaturesPotential -= 20;
						}
					}
					else
					{
						ValueTuple<short, short> randomBasicFeature2 = CharacterDomain.GetRandomBasicFeature(random, isProtagonist, this._gender, false, featureGroup2Id);
						short groupId2 = randomBasicFeature2.Item1;
						short featureId3 = randomBasicFeature2.Item2;
						bool flag7 = featureId3 < 0;
						if (!flag7)
						{
							featureGroup2Id.Add(groupId2, featureId3);
							goodFeaturesPotential += 20;
						}
					}
					IL_195:
					j++;
					continue;
					goto IL_195;
				}
				int potentialFeaturesAge = (int)((this.GetAgeGroup() == 2) ? -1 : this._actualAge);
				foreach (KeyValuePair<short, short> entry in featureGroup2Id)
				{
					short featureId4 = entry.Value;
					bool flag8 = featureId4 < 0;
					if (!flag8)
					{
						bool flag9 = potentialFeaturesAge >= 0 && CharacterFeature.Instance[featureId4].Mergeable;
						if (flag9)
						{
							this._potentialFeatureIds.Add(featureId4);
						}
						else
						{
							this._featureIds.Add(featureId4);
						}
					}
				}
				bool flag10 = potentialFeaturesAge >= 0;
				if (flag10)
				{
					int affectedFeaturesCount = this._potentialFeatureIds.Count * potentialFeaturesAge / 16;
					for (int k = 0; k < affectedFeaturesCount; k++)
					{
						this._featureIds.Add(this._potentialFeatureIds[k]);
					}
				}
				this.SetFeatureIds(this._featureIds, context);
				this.SetPotentialFeatureIds(this._potentialFeatureIds, context);
			}
		}

		// Token: 0x06006FA3 RID: 28579 RVA: 0x003F98C4 File Offset: 0x003F7AC4
		public void RecreateFeaturesByUpgradeCount(DataContext context, int upgradeCount, sbyte featureMedalType)
		{
			Dictionary<short, short> featureGroup2Id = ObjectPool<Dictionary<short, short>>.Instance.Get();
			List<short> matchedFeatures = ObjectPool<List<short>>.Instance.Get();
			List<short> mismatchedFeatures = ObjectPool<List<short>>.Instance.Get();
			bool isProtagonist = this._id == DomainManager.Taiwu.GetTaiwuCharId();
			for (int i = 0; i < upgradeCount; i++)
			{
				featureGroup2Id.Clear();
				matchedFeatures.Clear();
				mismatchedFeatures.Clear();
				bool flag = featureMedalType != 3;
				List<short> targetFeatures;
				if (flag)
				{
					foreach (short id in this._featureIds)
					{
						CharacterFeatureItem featureCfg = CharacterFeature.Instance[id];
						bool flag2 = !featureCfg.Basic;
						if (!flag2)
						{
							bool flag3 = featureCfg.MutexGroupId == 168;
							if (!flag3)
							{
								bool flag4 = GameData.Domains.Character.SharedMethods.CalcFeatureMedalValue(new short[]
								{
									id
								}, featureMedalType) > 0;
								if (flag4)
								{
									bool flag5 = (featureCfg.IsGood() && !featureCfg.IsHighest()) || featureCfg.IsBad();
									if (flag5)
									{
										matchedFeatures.Add(id);
									}
								}
								else
								{
									bool flag6 = (featureCfg.IsGood() && !featureCfg.IsHighest()) || featureCfg.IsBad();
									if (flag6)
									{
										mismatchedFeatures.Add(id);
									}
								}
							}
						}
					}
					targetFeatures = ((matchedFeatures.Count == 0) ? mismatchedFeatures : ((mismatchedFeatures.Count == 0) ? matchedFeatures : (context.Random.CheckPercentProb(60) ? matchedFeatures : mismatchedFeatures)));
				}
				else
				{
					foreach (short id2 in this._featureIds)
					{
						CharacterFeatureItem featureCfg2 = CharacterFeature.Instance[id2];
						bool flag7 = !featureCfg2.Basic;
						if (!flag7)
						{
							bool flag8 = featureCfg2.MutexGroupId == 168;
							if (!flag8)
							{
								bool flag9 = (featureCfg2.IsGood() && !featureCfg2.IsHighest()) || featureCfg2.IsBad();
								if (flag9)
								{
									matchedFeatures.Add(id2);
								}
							}
						}
					}
					targetFeatures = matchedFeatures;
				}
				bool flag10 = targetFeatures.Count == 0;
				if (flag10)
				{
					sbyte currFeatureMedalType = featureMedalType;
					bool flag11 = featureMedalType == 3;
					if (flag11)
					{
						currFeatureMedalType = (sbyte)context.Random.Next(0, 3);
					}
					foreach (short id3 in this._featureIds)
					{
						CharacterFeatureItem featureConfig = CharacterFeature.Instance[id3];
						short mutexGroupId = featureConfig.MutexGroupId;
						featureGroup2Id.Add(mutexGroupId, id3);
					}
					ValueTuple<short, short> randomBasicFeature = CharacterDomain.GetRandomBasicFeature(context.Random, isProtagonist, this._gender, true, currFeatureMedalType, featureGroup2Id, 1);
					short groupId = randomBasicFeature.Item1;
					short featureId = randomBasicFeature.Item2;
					bool flag12 = featureId < 0;
					if (!flag12)
					{
						this._featureIds.Add(featureId);
					}
				}
				else
				{
					short id4 = context.Random.GetRandomElement(targetFeatures);
					CharacterFeatureItem featureConfig2 = CharacterFeature.Instance[id4];
					int index = this._featureIds.IndexOf(id4);
					bool flag13 = featureConfig2.IsGood();
					if (flag13)
					{
						CharacterFeatureItem characterFeatureItem = featureConfig2.Upgrade();
						bool flag14 = characterFeatureItem != null;
						if (flag14)
						{
							this._featureIds[index] = characterFeatureItem.TemplateId;
						}
					}
					else
					{
						CharacterFeatureItem characterFeatureItem = featureConfig2.Degrade();
						bool flag15 = characterFeatureItem != null;
						if (flag15)
						{
							this._featureIds[index] = characterFeatureItem.TemplateId;
						}
						else
						{
							this._featureIds.RemoveAt(index);
						}
					}
				}
			}
			this.SetFeatureIds(this._featureIds, context);
			ObjectPool<Dictionary<short, short>>.Instance.Return(featureGroup2Id);
			ObjectPool<List<short>>.Instance.Return(matchedFeatures);
			ObjectPool<List<short>>.Instance.Return(mismatchedFeatures);
		}

		// Token: 0x06006FA4 RID: 28580 RVA: 0x003F9CD0 File Offset: 0x003F7ED0
		public static short GenerateRandomAge(IRandomSource random)
		{
			return (short)RedzenHelper.NormalDistribute(random, 30f, 6.667f, 10, 50);
		}

		// Token: 0x06006FA5 RID: 28581 RVA: 0x003F9CF8 File Offset: 0x003F7EF8
		public static short GenerateRandomAge(IRandomSource random, short baseAge)
		{
			return (short)Math.Max(16, random.Next((int)(baseAge - 5), (int)(baseAge + 6)));
		}

		// Token: 0x06006FA6 RID: 28582 RVA: 0x003F9D20 File Offset: 0x003F7F20
		public static bool IsXiangshuMinion(short templateId)
		{
			return templateId >= 298 && templateId <= 306;
		}

		// Token: 0x06006FA7 RID: 28583 RVA: 0x003F9D48 File Offset: 0x003F7F48
		public static bool IsRighteous(short templateId)
		{
			CharacterItem config = Character.Instance.GetItem(templateId);
			return config != null && config.OrganizationInfo.OrgTemplateId == 18;
		}

		// Token: 0x06006FA8 RID: 28584 RVA: 0x003F9D7C File Offset: 0x003F7F7C
		public static bool IsReincarnationBonusFeature(short featureId)
		{
			if (featureId >= 394)
			{
				if (featureId > 398)
				{
					goto IL_29;
				}
			}
			else
			{
				if (featureId < 257)
				{
					goto IL_29;
				}
				if (featureId > 261)
				{
					goto IL_29;
				}
			}
			return true;
			IL_29:
			return false;
		}

		// Token: 0x06006FA9 RID: 28585 RVA: 0x003F9DBC File Offset: 0x003F7FBC
		public static bool IsPositiveReincarnationBonusFeature(short featureId)
		{
			return featureId >= 257 && featureId <= 261;
		}

		// Token: 0x06006FAA RID: 28586 RVA: 0x003F9DE4 File Offset: 0x003F7FE4
		public static bool IsNegativeReincarnationBonusFeature(short featureId)
		{
			return featureId >= 394 && featureId <= 398;
		}

		// Token: 0x06006FAB RID: 28587 RVA: 0x003F9E0C File Offset: 0x003F800C
		public static bool IsProfessionReincarnationBonusFeature(short featureId)
		{
			return featureId >= 605 && featureId <= 625;
		}

		// Token: 0x06006FAC RID: 28588 RVA: 0x003F9E34 File Offset: 0x003F8034
		public static bool IsProfessionPositiveReincarnationBonusFeature(short featureId)
		{
			if (featureId >= 616)
			{
				if (featureId > 620)
				{
					goto IL_29;
				}
			}
			else
			{
				if (featureId < 605)
				{
					goto IL_29;
				}
				if (featureId > 609)
				{
					goto IL_29;
				}
			}
			return true;
			IL_29:
			return false;
		}

		// Token: 0x06006FAD RID: 28589 RVA: 0x003F9E74 File Offset: 0x003F8074
		public static bool IsProfessionNegativeReincarnationBonusFeature(short featureId)
		{
			if (featureId >= 621)
			{
				if (featureId > 625)
				{
					goto IL_29;
				}
			}
			else
			{
				if (featureId < 610)
				{
					goto IL_29;
				}
				if (featureId > 614)
				{
					goto IL_29;
				}
			}
			return true;
			IL_29:
			return false;
		}

		// Token: 0x06006FAE RID: 28590 RVA: 0x003F9EB4 File Offset: 0x003F80B4
		private void OfflineCreateRandomName(DataContext context, ref IntelligentCharacterCreationInfo info, CreateIntelligentCharacterModification mod, sbyte race)
		{
			bool flag = race == 0;
			if (flag)
			{
				bool flag2 = info.ReferenceFullName.Type != 0;
				if (flag2)
				{
					this._fullName = CharacterDomain.GenerateRandomHanName(context.Random, info.ReferenceFullName.GetCustomSurnameId(), info.ReferenceFullName.GetSurnameId(), this._gender, -1);
				}
				else
				{
					FullName fullname = Character.GetMainParentFullName(ref info, mod.CreateMotherRelation, mod.CreateFatherRelation);
					int customSurnameId = fullname.GetCustomSurnameId();
					short surnameId = fullname.GetSurnameId();
					bool flag3 = this._gender == 0;
					if (flag3)
					{
						this._fullName = CharacterDomain.GenerateRandomHanName(context.Random, customSurnameId, surnameId, this._gender, -1);
					}
					else
					{
						int elderBrothersCount = Character.GetElderBrothersCount(ref info, mod);
						this._fullName = CharacterDomain.GenerateRandomHanName(context.Random, customSurnameId, surnameId, this._gender, elderBrothersCount);
						bool flag4 = elderBrothersCount >= 0;
						if (flag4)
						{
							bool flag5 = elderBrothersCount == 0;
							if (flag5)
							{
								bool flag6 = this._fullName.GivenNameGroupId == 0;
								if (flag6)
								{
									mod.Father = info.Father;
									mod.FathersLegitimateBoysCount = 1;
								}
								else
								{
									mod.Father = info.Father;
									mod.FathersLegitimateBoysCount = -1;
								}
							}
							else
							{
								mod.Father = info.Father;
								mod.FathersLegitimateBoysCount = (sbyte)(elderBrothersCount + 1);
							}
						}
					}
				}
			}
			else
			{
				this._fullName = CharacterDomain.GenerateRandomZangName(context.Random, this._gender);
			}
		}

		// Token: 0x06006FAF RID: 28591 RVA: 0x003FA020 File Offset: 0x003F8220
		private static FullName GetMainParentFullName(ref IntelligentCharacterCreationInfo info, bool createMotherRelation, bool createFatherRelation)
		{
			bool flag = createMotherRelation && !createFatherRelation;
			FullName result;
			if (flag)
			{
				result = info.Mother.GetFullName();
			}
			else
			{
				bool flag2 = info.Father != null;
				if (flag2)
				{
					result = info.Father.GetFullName();
				}
				else
				{
					bool flag3 = info.DeadFather != null;
					if (flag3)
					{
						result = info.DeadFather.FullName;
					}
					else
					{
						result = default(FullName);
					}
				}
			}
			return result;
		}

		// Token: 0x06006FB0 RID: 28592 RVA: 0x003FA090 File Offset: 0x003F8290
		private static int GetElderBrothersCount(ref IntelligentCharacterCreationInfo info, CreateIntelligentCharacterModification mod)
		{
			bool flag = info.Father == null || info.Mother == null;
			int result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				HashSet<int> wives = DomainManager.Character.GetRelatedCharIds(info.FatherCharId, 1024);
				bool flag2 = !wives.Contains(info.MotherCharId);
				if (flag2)
				{
					result = -1;
				}
				else
				{
					bool flag3 = info.MultipleBirthCount > 1;
					if (flag3)
					{
						mod.Father = info.Father;
						mod.FathersLegitimateBoysCount = -1;
						result = -1;
					}
					else
					{
						sbyte legitimateBoysCount = info.Father.GetLegitimateBoysCount();
						bool flag4 = legitimateBoysCount >= 5;
						if (flag4)
						{
							mod.Father = info.Father;
							mod.FathersLegitimateBoysCount = -1;
							result = -1;
						}
						else
						{
							result = (int)legitimateBoysCount;
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06006FB1 RID: 28593 RVA: 0x003FA14C File Offset: 0x003F834C
		private void OfflineCreateAttractionAndAvatar(DataContext context, sbyte bodyType, ref IntelligentCharacterCreationInfo info, bool haveHair)
		{
			bool flag = bodyType < 0;
			if (flag)
			{
				bodyType = BodyType.GetRandom(context.Random);
			}
			bool flag2 = info.BaseAttraction >= 0;
			if (flag2)
			{
				bool flag3 = info.Avatar != null;
				if (flag3)
				{
					this._avatar = info.Avatar;
					bool transgender = this._transgender;
					if (transgender)
					{
						this._avatar.ChangeGender(Gender.Flip(this._gender));
					}
				}
				else
				{
					this._avatar = AvatarManager.Instance.GetRandomAvatar(context.Random, this._gender, this._transgender, bodyType, info.BaseAttraction);
				}
				if (haveHair)
				{
					AvatarGroup avatarGroup = AvatarManager.Instance.GetAvatarGroup((int)this._avatar.AvatarId);
					ValueTuple<short, short> randomHairsNoSkinHead = avatarGroup.GetRandomHairsNoSkinHead(context.Random);
					short frontHairId = randomHairsNoSkinHead.Item1;
					short backHairId = randomHairsNoSkinHead.Item2;
					this._avatar.FrontHairId = frontHairId;
					this._avatar.BackHairId = backHairId;
				}
			}
			else
			{
				bool flag4 = info.MotherCharId >= 0 || info.ActualFatherCharId >= 0;
				if (flag4)
				{
					Character mother = info.Mother;
					AvatarData motherAvatar = (mother != null) ? mother.GetAvatar() : null;
					Character actualFather = info.ActualFather;
					AvatarData avatarData;
					if ((avatarData = ((actualFather != null) ? actualFather.GetAvatar() : null)) == null)
					{
						DeadCharacter actualDeadFather = info.ActualDeadFather;
						avatarData = ((actualDeadFather != null) ? actualDeadFather.Avatar : null);
					}
					AvatarData fatherAvatar = avatarData;
					this._avatar = AvatarManager.Instance.GetRandomAvatar(context.Random, this._gender, this._transgender, bodyType, fatherAvatar, motherAvatar);
				}
				else
				{
					short baseAttraction = Character.GenerateRandomAttraction(context.Random);
					this._avatar = AvatarManager.Instance.GetRandomAvatar(context.Random, this._gender, this._transgender, bodyType, baseAttraction);
				}
			}
		}

		// Token: 0x06006FB2 RID: 28594 RVA: 0x003FA302 File Offset: 0x003F8502
		private void OfflineCreateInitialLifeSkills(IRandomSource random, OrganizationMemberItem orgMemberCfg)
		{
			this.OfflineCreateInitialLifeSkills(random, orgMemberCfg.LifeSkillsAdjust, orgMemberCfg.LifeSkillGradeLimit);
		}

		// Token: 0x06006FB3 RID: 28595 RVA: 0x003FA31C File Offset: 0x003F851C
		private unsafe void OfflineCreateInitialLifeSkills(IRandomSource random, short[] lifeSkillsAdjust, sbyte skillGradeLimit)
		{
			sbyte lifeSkillType = 0;
			while ((int)lifeSkillType < lifeSkillsAdjust.Length)
			{
				short adjust = lifeSkillsAdjust[(int)lifeSkillType];
				bool flag = adjust <= 0;
				if (!flag)
				{
					int attainmentPercentage = 0;
					short qualification = *(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)lifeSkillType * 2);
					int baseChance = (int)(adjust + 100);
					for (int grade = 0; grade < (int)skillGradeLimit; grade++)
					{
						short lifeSkillTemplateId = LifeSkillType.Instance[lifeSkillType].SkillList[grade];
						short attainmentReq = SkillGradeData.Instance[grade].ReadingAttainmentRequirement;
						attainmentPercentage += 5 * (grade + 1);
						int percentageBonus = (grade > 8) ? (attainmentPercentage * 2) : ((grade > 5) ? (attainmentPercentage / 2) : ((grade > 2) ? (attainmentPercentage / 4) : 0));
						int attainment = (int)qualification * (100 + percentageBonus) / 100;
						bool flag2 = !random.CheckPercentProb(attainment * baseChance / (int)attainmentReq);
						if (flag2)
						{
							break;
						}
						LifeSkillItem learnedLifeSkill = new LifeSkillItem(lifeSkillTemplateId);
						learnedLifeSkill.SetRandomPagesRead(random, 5);
						this._learnedLifeSkills.Add(learnedLifeSkill);
					}
				}
				lifeSkillType += 1;
			}
		}

		// Token: 0x06006FB4 RID: 28596 RVA: 0x003FA434 File Offset: 0x003F8634
		private void OfflineCreatePresetLifeSkillsByGradeConfig()
		{
			sbyte[] grades = Character.Instance[this._templateId].LearnedLifeSkillGrades;
			List<LifeSkillItem> prevLearnedLifeSkills = (this._learnedLifeSkills.Count > 0) ? this._learnedLifeSkills : null;
			bool flag = prevLearnedLifeSkills != null;
			if (flag)
			{
				this._learnedLifeSkills = new List<LifeSkillItem>();
			}
			for (sbyte lifeSkillType = 0; lifeSkillType < 16; lifeSkillType += 1)
			{
				sbyte maxGrade = grades[(int)lifeSkillType];
				bool flag2 = maxGrade < 0;
				if (!flag2)
				{
					for (sbyte grade = 0; grade <= maxGrade; grade += 1)
					{
						short lifeSkillTemplateId = LifeSkillType.Instance[lifeSkillType].SkillList[(int)grade];
						this._learnedLifeSkills.Add(new LifeSkillItem(lifeSkillTemplateId)
						{
							ReadingState = 31
						});
					}
				}
			}
			bool flag3 = prevLearnedLifeSkills == null;
			if (!flag3)
			{
				bool flag4 = this._learnedLifeSkills.Count != 0;
				if (flag4)
				{
					foreach (LifeSkillItem prevLearnedSkill in prevLearnedLifeSkills)
					{
						bool flag5 = this.FindLearnedLifeSkillIndex(prevLearnedSkill.SkillTemplateId) < 0;
						if (flag5)
						{
							this._learnedLifeSkills.Add(prevLearnedSkill);
						}
					}
				}
				else
				{
					this._learnedLifeSkills.AddRange(prevLearnedLifeSkills);
				}
			}
		}

		// Token: 0x06006FB5 RID: 28597 RVA: 0x003FA590 File Offset: 0x003F8790
		private static int GetCurrAdjust(IRandomSource random, short[] adjusts, sbyte index, sbyte abnormalProb)
		{
			bool flag = adjusts == null;
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				bool flag2 = abnormalProb > 0 && random.CheckPercentProb((int)abnormalProb);
				if (flag2)
				{
					result = 0;
				}
				else
				{
					result = (int)adjusts[(int)index];
				}
			}
			return result;
		}

		// Token: 0x06006FB6 RID: 28598 RVA: 0x003FA5C8 File Offset: 0x003F87C8
		private unsafe void OfflineCreateResources(IRandomSource random, short orgMemberId, sbyte abnormalOrgAttributesProb)
		{
			short[] resourcesAdjust = (orgMemberId >= 0) ? OrganizationDomain.GetMemberResourcesAdjust(orgMemberId) : null;
			sbyte abnormalProb = (sbyte)(random.CheckPercentProb((int)abnormalOrgAttributesProb) ? random.Next(101) : 0);
			int percent = DomainManager.World.GetGainResourcePercent(8);
			for (sbyte i = 0; i < 8; i += 1)
			{
				int unit = (i == 7) ? 100 : 200;
				int currValue = RedzenHelper.GetNormalDistributedRangedValue(random, unit, unit * 2);
				int currAdjust = Character.GetCurrAdjust(random, resourcesAdjust, i, abnormalProb);
				currValue = currValue * (100 + currAdjust) / 100;
				currValue = currValue * percent / 100;
				*(ref this._resources.Items.FixedElementField + (IntPtr)i * 4) = ((currValue > 0) ? currValue : 0);
			}
		}

		// Token: 0x06006FB7 RID: 28599 RVA: 0x003FA67C File Offset: 0x003F887C
		private static SkillQualificationBonus GenerateRandomInnateSkillQualificationBonus(DataContext context)
		{
			IRandomSource random = context.Random;
			int skillGroup = random.Next(2);
			int skillType = (skillGroup == 0) ? random.Next(16) : random.Next(14);
			int value = RedzenHelper.SkewDistribute(context.Random, 7f, 1.5f, 2f, 3, 15);
			return new SkillQualificationBonus((sbyte)skillGroup, (sbyte)skillType, (sbyte)value, -1);
		}

		// Token: 0x06006FB8 RID: 28600 RVA: 0x003FA6E0 File Offset: 0x003F88E0
		private static short GenerateRandomMaxHealth(IRandomSource random)
		{
			int factor = DomainManager.World.GetCharacterLifeSpanFactor();
			int min = factor / 2 * 12;
			int max = factor * 12;
			float mean = (float)(min + max) / 2f;
			float stdDev = (float)(max - min) / 6f;
			return (short)RedzenHelper.NormalDistribute(random, mean, stdDev, min, max);
		}

		// Token: 0x06006FB9 RID: 28601 RVA: 0x003FA730 File Offset: 0x003F8930
		private static short GenerateProtagonistMaxHealth(IRandomSource random)
		{
			int factor = DomainManager.World.GetCharacterLifeSpanFactor();
			int baseMaxAge = factor * 3 / 4;
			int maxAge = baseMaxAge + random.Next(5, 15) * factor / 100;
			return (short)(maxAge * 12 + random.Next(12));
		}

		// Token: 0x06006FBA RID: 28602 RVA: 0x003FA774 File Offset: 0x003F8974
		private static short GenerateRandomAttraction(IRandomSource random)
		{
			return (short)RedzenHelper.SkewDistribute(random, 350f, 152.2f, 1.5714285f, 0, 900);
		}

		// Token: 0x06006FBB RID: 28603 RVA: 0x003FA7A4 File Offset: 0x003F89A4
		[return: TupleElementNames(new string[]
		{
			"lovingItemSubType",
			"hatingItemSubType"
		})]
		private static ValueTuple<short, short> GenerateRandomHobby(IRandomSource random)
		{
			short lovingSubType = ItemSubType.GetRandom(random);
			short hatingSubType = ItemSubType.GetRandom(random);
			bool flag = !ItemSubType.IsHobbyType(lovingSubType);
			if (flag)
			{
				lovingSubType = -1;
			}
			bool flag2 = !ItemSubType.IsHobbyType(hatingSubType);
			if (flag2)
			{
				hatingSubType = -1;
			}
			bool flag3 = lovingSubType == hatingSubType && lovingSubType != -1;
			if (flag3)
			{
				bool flag4 = random.CheckPercentProb(50);
				if (flag4)
				{
					lovingSubType = -1;
				}
				else
				{
					hatingSubType = -1;
				}
			}
			return new ValueTuple<short, short>(lovingSubType, hatingSubType);
		}

		// Token: 0x06006FBC RID: 28604 RVA: 0x003FA818 File Offset: 0x003F8A18
		private void OfflineGenerateRandomIdealSect(IRandomSource random)
		{
			bool flag = this.Template.IdealSect == 0;
			if (flag)
			{
				this._idealSect = -1;
			}
			else
			{
				List<sbyte> randomIdealSectsPool = this.Template.RandomIdealSects;
				this._idealSect = ((randomIdealSectsPool != null && randomIdealSectsPool.Count > 0) ? randomIdealSectsPool.GetRandom(random) : ((this.Template.IdealSect > 0) ? this.Template.IdealSect : -1));
			}
		}

		// Token: 0x06006FBD RID: 28605 RVA: 0x003FA888 File Offset: 0x003F8A88
		private void OfflineCreateProtagonistRandomFeatures(DataContext context, List<short> inscribedFeatureIds, bool addFeatureDreamLover, bool addFeatureLifeSkillLearning, bool addFeatureCombatSkillLearning, bool addFeatureWhiteSnake, bool addFeatureLongevity)
		{
			bool flag = inscribedFeatureIds != null;
			if (flag)
			{
				int i = 0;
				int featuresCount = inscribedFeatureIds.Count;
				while (i < featuresCount)
				{
					this._featureIds.Add(inscribedFeatureIds[i]);
					i++;
				}
			}
			this._featureIds.Add(CharacterDomain.GetBirthdayFeatureId(this._birthMonth));
			if (addFeatureDreamLover)
			{
				this._featureIds.Add(203);
			}
			if (addFeatureLifeSkillLearning)
			{
				this._featureIds.Add(201);
			}
			if (addFeatureCombatSkillLearning)
			{
				this._featureIds.Add(202);
			}
			if (addFeatureWhiteSnake)
			{
				this._featureIds.Add(256);
			}
			if (addFeatureLongevity)
			{
				this._featureIds.Add(335);
			}
			bool flag2 = inscribedFeatureIds != null;
			if (flag2)
			{
				this._featureIds.Add(195);
				this._featureIds.Add(216);
				this._featureIds.Sort(CharacterFeatureHelper.FeatureComparer);
			}
			else
			{
				FeatureCreationContext creationContext = new FeatureCreationContext(this)
				{
					IsProtagonist = true
				};
				CharacterCreation.CreateFeatures(context.Random, ref creationContext);
			}
		}

		// Token: 0x06006FBE RID: 28606 RVA: 0x003FA9C0 File Offset: 0x003F8BC0
		private void OfflineCreateGenome(IRandomSource randomSource, Character mother, PregnantState pregnantState, Character father)
		{
			bool flag = pregnantState != null;
			if (flag)
			{
				bool flag2 = pregnantState.FatherId >= 0;
				if (flag2)
				{
					Genome.Inherit(randomSource, mother.GetGenome(), ref pregnantState.FatherGenome, ref this._genome);
				}
				else
				{
					Genome virtualFatherGenome;
					Genome.CreateRandom(randomSource, ref virtualFatherGenome);
					Genome.Inherit(randomSource, mother.GetGenome(), ref virtualFatherGenome, ref this._genome);
				}
			}
			else
			{
				GenomeHelper.Inherit(randomSource, mother, father, ref this._genome);
			}
		}

		// Token: 0x06006FBF RID: 28607 RVA: 0x003FAA38 File Offset: 0x003F8C38
		private List<GameData.Domains.CombatSkill.CombatSkill> OfflineCreateCombatSkills(IRandomSource random, List<PresetCombatSkill> presetCombatSkills)
		{
			int combatSkillsCount = presetCombatSkills.Count;
			List<GameData.Domains.CombatSkill.CombatSkill> combatSkills = new List<GameData.Domains.CombatSkill.CombatSkill>(combatSkillsCount);
			for (int i = 0; i < combatSkillsCount; i++)
			{
				PresetCombatSkill presetSkill = presetCombatSkills[i];
				combatSkills.Add(new GameData.Domains.CombatSkill.CombatSkill(random, presetSkill));
				this._learnedCombatSkills.Add(presetSkill.SkillTemplateId);
			}
			return combatSkills;
		}

		// Token: 0x06006FC0 RID: 28608 RVA: 0x003FAA98 File Offset: 0x003F8C98
		private List<GameData.Domains.CombatSkill.CombatSkill> OfflineCreateRandomEnemyCombatSkills(IRandomSource random, RandomEnemyItem randomEnemyCfg, List<PresetCombatSkill> presetCombatSkills)
		{
			int combatSkillsCount = presetCombatSkills.Count;
			List<GameData.Domains.CombatSkill.CombatSkill> combatSkills = new List<GameData.Domains.CombatSkill.CombatSkill>(combatSkillsCount);
			WorldCreationItem enemyPracticeLevelCfg = WorldCreation.Instance[11];
			sbyte behaviorType = BehaviorType.GetBehaviorType(this._baseMorality);
			for (int i = 0; i < combatSkillsCount; i++)
			{
				PresetCombatSkill presetSkill = presetCombatSkills[i];
				GameData.Domains.CombatSkill.CombatSkill combatSkill = this.OfflineCreateRandomEnemyCombatSkill(random, presetSkill.SkillTemplateId, behaviorType, randomEnemyCfg, enemyPracticeLevelCfg);
				combatSkills.Add(combatSkill);
				this._learnedCombatSkills.Add(presetSkill.SkillTemplateId);
			}
			return combatSkills;
		}

		// Token: 0x06006FC1 RID: 28609 RVA: 0x003FAB28 File Offset: 0x003F8D28
		private void OfflineAddRandomEnemyOrgMemberCombatSkills(DataContext context, RandomEnemyItem randomEnemyCfg, [TupleElementNames(new string[]
		{
			"Org",
			"Member"
		})] List<ValueTuple<OrganizationItem, OrganizationMemberItem>> relatedSectAndMembers, List<GameData.Domains.CombatSkill.CombatSkill> charCombatSkills)
		{
			IRandomSource random = context.Random;
			sbyte behaviorType = BehaviorType.GetBehaviorType(this._baseMorality);
			List<InventoryCombatSkillBookParams> skillBooks = new List<InventoryCombatSkillBookParams>();
			HashSet<short> suitableWeaponIds = new HashSet<short>();
			WorldCreationItem enemyPracticeLevelCfg = WorldCreation.Instance[11];
			int i = 0;
			int count = relatedSectAndMembers.Count;
			while (i < count)
			{
				OrganizationMemberItem orgMember = relatedSectAndMembers[i].Item2;
				foreach (PresetOrgMemberCombatSkill presetSkill in orgMember.CombatSkills)
				{
					CombatSkillItem presetSkillCfg = Config.CombatSkill.Instance[presetSkill.SkillGroupId];
					IReadOnlyList<CombatSkillItem> group = CombatSkillDomain.GetLearnableCombatSkills(presetSkillCfg.SectId, presetSkillCfg.Type);
					int maxGrade = Math.Min((int)presetSkill.MaxGrade, group.Count - 1);
					for (int skillGrade = 0; skillGrade <= maxGrade; skillGrade++)
					{
						bool flag = skillGrade != (int)presetSkill.MaxGrade && !random.CheckPercentProb(50);
						if (!flag)
						{
							CombatSkillItem skillConfig = group[skillGrade];
							GameData.Domains.CombatSkill.CombatSkill combatSkill = this.OfflineCreateRandomEnemyCombatSkill(random, skillConfig.TemplateId, behaviorType, randomEnemyCfg, enemyPracticeLevelCfg);
							byte bookPageTypes = CombatSkillStateHelper.GeneratePageTypesFromReadingState(random, combatSkill.GetReadingState());
							charCombatSkills.Add(combatSkill);
							this._learnedCombatSkills.Add(skillConfig.TemplateId);
							bool flag2 = random.CheckPercentProb(11 - skillGrade * 2);
							if (flag2)
							{
								skillBooks.Add(new InventoryCombatSkillBookParams(skillConfig.BookId, bookPageTypes));
							}
							short suitableWeaponId = skillConfig.MostFittingWeaponID;
							sbyte grade = ItemDomain.GenerateRandomItemGrade(random, this._organizationInfo.Grade);
							bool flag3 = suitableWeaponId >= 0;
							if (flag3)
							{
								suitableWeaponIds.Add(suitableWeaponId + (short)grade);
							}
						}
					}
				}
				i++;
			}
			this.OfflineAddSkillBooksAndWeapons(context, skillBooks, suitableWeaponIds);
		}

		// Token: 0x06006FC2 RID: 28610 RVA: 0x003FAD2C File Offset: 0x003F8F2C
		private GameData.Domains.CombatSkill.CombatSkill OfflineCreateRandomEnemyCombatSkill(IRandomSource random, short skillTemplateId, sbyte behaviorType, RandomEnemyItem randomEnemyCfg, WorldCreationItem enemyPracticeLevelCfg)
		{
			byte difficulty = DomainManager.Extra.GetEnemyPracticeLevel();
			short pageBuff = enemyPracticeLevelCfg.InfluenceFactors[(int)difficulty];
			int directBuff = random.Next(0, (int)(pageBuff + 1));
			ValueTuple<int, int>[] pageRanges = randomEnemyCfg.PageCountRandomRange;
			sbyte directCount = (sbyte)Math.Clamp(random.Next(pageRanges[0].Item1, pageRanges[0].Item2 + 1) + directBuff, 0, 5);
			sbyte indirectCount = (sbyte)Math.Clamp(random.Next(pageRanges[1].Item1, pageRanges[1].Item2 + 1) + (int)pageBuff - directBuff, 0, 5);
			return new GameData.Domains.CombatSkill.CombatSkill(random, this._id, skillTemplateId, behaviorType, directCount, indirectCount);
		}

		// Token: 0x06006FC3 RID: 28611 RVA: 0x003FADD4 File Offset: 0x003F8FD4
		private void OfflineCreateCombatSkills(IRandomSource random, List<PresetCombatSkill> presetCombatSkills, CreateIntelligentCharacterModification mod)
		{
			List<GameData.Domains.CombatSkill.CombatSkill> combatSkills = this.OfflineCreateCombatSkills(random, presetCombatSkills);
			mod.CombatSkills = combatSkills;
		}

		// Token: 0x06006FC4 RID: 28612 RVA: 0x003FADF4 File Offset: 0x003F8FF4
		private void OfflineAddPresetOrgMemberCombatSkills(DataContext context, CreateIntelligentCharacterModification mod, OrganizationItem orgConfig, OrganizationMemberItem orgMemberConfig, int ageInfluence)
		{
			sbyte selfBehaviorType = BehaviorType.GetBehaviorType(this._baseMorality);
			sbyte teacherBehaviorType = (orgConfig.MainMorality == short.MinValue) ? -1 : BehaviorType.GetBehaviorType(orgConfig.MainMorality);
			List<InventoryCombatSkillBookParams> inventorySkillBooks = new List<InventoryCombatSkillBookParams>();
			HashSet<short> suitableWeaponIds = new HashSet<short>();
			this.OfflineAddPresetOrgMemberCombatSkillsInternal(context.Random, orgConfig.Goodness, teacherBehaviorType, selfBehaviorType, ageInfluence, orgMemberConfig.CombatSkills, mod.CombatSkills, inventorySkillBooks, suitableWeaponIds);
			mod.InventorySkillBooks = inventorySkillBooks;
			mod.SkillWeaponIds = suitableWeaponIds;
		}

		// Token: 0x06006FC5 RID: 28613 RVA: 0x003FAE6C File Offset: 0x003F906C
		private void OfflineAddSkillBooksAndWeapons(DataContext context, List<InventoryCombatSkillBookParams> skillBooks, HashSet<short> skillWeaponIds)
		{
			int i = 0;
			int skillBooksCount = skillBooks.Count;
			while (i < skillBooksCount)
			{
				InventoryCombatSkillBookParams book = skillBooks[i];
				ItemKey itemKey = DomainManager.Item.CreateSkillBook(context, book.TemplateId, book.PageTypes, -1, -1, true);
				this._inventory.OfflineAdd(itemKey, 1);
				i++;
			}
			foreach (short weaponId in skillWeaponIds)
			{
				ItemKey itemKey2 = DomainManager.Item.CreateWeapon(context, weaponId, 1);
				this._inventory.OfflineAdd(itemKey2, 1);
			}
		}

		// Token: 0x06006FC6 RID: 28614 RVA: 0x003FAF28 File Offset: 0x003F9128
		private void OfflineAddPresetOrgMemberCombatSkillsInternal(IRandomSource random, sbyte orgGoodness, sbyte teacherBehaviorType, sbyte selfBehaviorType, int ageInfluence, List<PresetOrgMemberCombatSkill> presetSkills, List<GameData.Domains.CombatSkill.CombatSkill> charCombatSkills, List<InventoryCombatSkillBookParams> inventorySkillBooks, HashSet<short> suitableWeaponIds)
		{
			sbyte baseGrade = (this._location.AreaId == 138 && this._organizationInfo.OrgTemplateId == 38) ? (this._organizationInfo.Grade / 2) : this._organizationInfo.Grade;
			int i = 0;
			int count = presetSkills.Count;
			while (i < count)
			{
				PresetOrgMemberCombatSkill presetSkill = presetSkills[i];
				CombatSkillItem presetSkillCfg = Config.CombatSkill.Instance[presetSkill.SkillGroupId];
				IReadOnlyList<CombatSkillItem> group = CombatSkillDomain.GetLearnableCombatSkills(presetSkillCfg.SectId, presetSkillCfg.Type);
				int maxGrade = Math.Clamp((int)presetSkill.MaxGrade * ageInfluence / 100, 0, group.Count - 1);
				for (int skillGrade = 0; skillGrade <= maxGrade; skillGrade++)
				{
					CombatSkillItem skillConfig = group[skillGrade];
					int gradeDiff = (int)this._organizationInfo.Grade - skillGrade;
					ValueTuple<byte, ushort> valueTuple = Character.GenerateCombatSkillBookReadingInfo(random, teacherBehaviorType, selfBehaviorType, orgGoodness, gradeDiff, ageInfluence, 0);
					byte bookPageTypes = valueTuple.Item1;
					ushort readingState = valueTuple.Item2;
					charCombatSkills.Add(new GameData.Domains.CombatSkill.CombatSkill(-1, skillConfig.TemplateId, readingState));
					this._learnedCombatSkills.Add(skillConfig.TemplateId);
					bool flag = random.CheckPercentProb(11 - skillGrade * 2);
					if (flag)
					{
						inventorySkillBooks.Add(new InventoryCombatSkillBookParams(skillConfig.BookId, bookPageTypes));
					}
					short suitableWeaponId = skillConfig.MostFittingWeaponID;
					sbyte grade = ItemDomain.GenerateRandomItemGrade(random, baseGrade);
					bool flag2 = suitableWeaponId >= 0;
					if (flag2)
					{
						suitableWeaponIds.Add(suitableWeaponId + (short)grade);
					}
				}
				i++;
			}
		}

		// Token: 0x06006FC7 RID: 28615 RVA: 0x003FB0C8 File Offset: 0x003F92C8
		[return: TupleElementNames(new string[]
		{
			"bookPageTypes",
			"readingState"
		})]
		private static ValueTuple<byte, ushort> GenerateCombatSkillBookReadingInfo(IRandomSource random, sbyte teacherBehaviorType, sbyte selfBehaviorType, sbyte orgGoodness, int gradeDiff, int ageInfluence = 100, short pageBuff = 0)
		{
			sbyte behaviorType = (teacherBehaviorType == -1) ? selfBehaviorType : (random.CheckPercentProb(70) ? teacherBehaviorType : selfBehaviorType);
			if (!true)
			{
			}
			sbyte b;
			switch (orgGoodness)
			{
			case -1:
				b = 30;
				break;
			case 0:
				b = 50;
				break;
			case 1:
				b = 70;
				break;
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(21, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported goodness ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(orgGoodness);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
			if (!true)
			{
			}
			sbyte directProb = b;
			int readPagesCount = 3 + gradeDiff + random.Next(4) + (int)pageBuff;
			readPagesCount = Math.Clamp(readPagesCount * ageInfluence / 100, 0, 6);
			byte bookPageTypes = GameData.Domains.Item.SkillBook.GenerateCombatPageTypes(random, behaviorType, directProb);
			ushort readingState = GameData.Domains.CombatSkill.CombatSkill.GenerateRandomReadingState(random, bookPageTypes, readPagesCount);
			return new ValueTuple<byte, ushort>(bookPageTypes, readingState);
		}

		// Token: 0x06006FC8 RID: 28616 RVA: 0x003FB18C File Offset: 0x003F938C
		private void OfflineCreateEquipmentAndInventoryItems(DataContext context, CharacterItem template, sbyte ageGroup)
		{
			PresetEquipmentItem[] equipment;
			List<PresetInventoryItem> inventory;
			Character.OfflineCreateEquipmentAndInventoryItemsInternal(template, ageGroup, out equipment, out inventory);
			this.OfflineAddEquipmentAndInventoryItems(context, equipment, inventory);
		}

		// Token: 0x06006FC9 RID: 28617 RVA: 0x003FB1B0 File Offset: 0x003F93B0
		private void OfflineAddEquipmentAndInventoryItems(DataContext context, PresetEquipmentItem[] equipment, List<PresetInventoryItem> inventory)
		{
			for (int i = 0; i < 12; i++)
			{
				PresetEquipmentItem presetItem = equipment[i];
				this._equipment[i] = ((presetItem.TemplateId < 0) ? ItemKey.Invalid : ((i != 4) ? DomainManager.Item.CreateItem(context, presetItem.Type, presetItem.TemplateId) : DomainManager.Item.CreateClothing(context, presetItem.TemplateId, this._gender)));
				bool flag = this._equipment[i].IsValid() && ItemTemplateHelper.HasCarrierTame(presetItem.Type, presetItem.TemplateId);
				if (flag)
				{
					ExtraDomain extraDomain = DomainManager.Extra;
					int maxTamePoint = extraDomain.GetCarrierMaxTamePoint(this._equipment[i].Id);
					extraDomain.SetCarrierTamePoint(context, this._equipment[i].Id, maxTamePoint);
				}
			}
			int j = 0;
			int count = inventory.Count;
			while (j < count)
			{
				PresetInventoryItem presetItem2 = inventory[j];
				bool flag2 = presetItem2.SpawnChance < 100 && !context.Random.CheckPercentProb((int)presetItem2.SpawnChance);
				if (!flag2)
				{
					this.OfflineCreateInventoryOnCharacterCreation(context, presetItem2.Type, presetItem2.TemplateId, presetItem2.Amount);
				}
				j++;
			}
		}

		// Token: 0x06006FCA RID: 28618 RVA: 0x003FB30C File Offset: 0x003F950C
		private void OfflineCreateEquipmentAndInventoryItems(CreateIntelligentCharacterModification mod, CharacterItem template, sbyte ageGroup)
		{
			PresetEquipmentItem[] equipment;
			List<PresetInventoryItem> inventory;
			Character.OfflineCreateEquipmentAndInventoryItemsInternal(template, ageGroup, out equipment, out inventory);
			mod.Equipment = equipment;
			mod.Inventory = inventory;
		}

		// Token: 0x06006FCB RID: 28619 RVA: 0x003FB334 File Offset: 0x003F9534
		private static void OfflineCreateEquipmentAndInventoryItemsInternal(CharacterItem template, sbyte ageGroup, out PresetEquipmentItem[] equipment, out List<PresetInventoryItem> inventory)
		{
			equipment = new PresetEquipmentItem[12];
			for (int i = 0; i < 12; i++)
			{
				equipment[i] = template.PresetEquipment[i];
			}
			bool flag = ageGroup != 2;
			if (flag)
			{
				equipment[4] = new PresetEquipmentItem(3, (ageGroup == 1) ? 65 : 64);
			}
			inventory = new List<PresetInventoryItem>(template.PresetInventory);
		}

		// Token: 0x06006FCC RID: 28620 RVA: 0x003FB3A0 File Offset: 0x003F95A0
		private void OfflineAddPresetOrgMemberEquipmentAndInventoryItems(DataContext context, CreateIntelligentCharacterModification mod, OrganizationMemberItem orgMemberConfig, sbyte ageGroup)
		{
			bool flag = ageGroup == 2;
			if (flag)
			{
				short clothingTemplateId = OrganizationDomain.GetRandomOrgMemberClothing(context.Random, orgMemberConfig);
				bool flag2 = mod.Self._location.AreaId == 138 && mod.Self._organizationInfo.OrgTemplateId == 38;
				if (flag2)
				{
					clothingTemplateId = OrganizationDomain.GetRandomOrgMemberClothing(context.Random, OrganizationDomain.GetOrgMemberConfig(mod.Self._organizationInfo));
				}
				mod.Equipment[4] = new PresetEquipmentItem(3, clothingTemplateId);
			}
			this.OfflineAddPresetOrgMemberEquipmentsWithProb(context, orgMemberConfig.Equipment, orgMemberConfig.Grade, mod.Inventory);
			this.OfflineAddPresetOrgMemberInventoryItems(context, orgMemberConfig.Inventory, orgMemberConfig.Grade, mod.Inventory);
		}

		// Token: 0x06006FCD RID: 28621 RVA: 0x003FB45C File Offset: 0x003F965C
		private void OfflineAddRandomEnemyPresetOrgMemberEquipmentAndInventoryItems(DataContext context, RandomEnemyItem randomEnemyCfg, [TupleElementNames(new string[]
		{
			"Sect",
			"Member"
		})] List<ValueTuple<OrganizationItem, OrganizationMemberItem>> relatedSectAndMembers)
		{
			List<PresetInventoryItem> itemsToBeCreated = new List<PresetInventoryItem>();
			int i = 0;
			int count = relatedSectAndMembers.Count;
			while (i < count)
			{
				OrganizationMemberItem sectMember = relatedSectAndMembers[i].Item2;
				this.OfflineAddPresetOrgMemberEquipmentsWithProb(context, sectMember.Equipment, randomEnemyCfg.ItemGrade, itemsToBeCreated);
				this.OfflineAddRandomEnemyPresetOrgMemberInventoryItems(context, sectMember.Inventory, randomEnemyCfg.ItemGrade, itemsToBeCreated);
				i++;
			}
			bool allowPoisoning = DomainManager.Global.GetLoadedAllArchiveData();
			int j = 0;
			int itemsCount = itemsToBeCreated.Count;
			while (j < itemsCount)
			{
				PresetInventoryItem presetItem = itemsToBeCreated[j];
				bool flag = allowPoisoning;
				if (flag)
				{
					for (int k = 0; k < presetItem.Amount; k++)
					{
						this.OfflineCreateRandomEnemyInventoryItem(context, randomEnemyCfg, presetItem.Type, presetItem.TemplateId);
					}
				}
				else
				{
					this.OfflineCreateInventoryOnCharacterCreation(context, presetItem.Type, presetItem.TemplateId, presetItem.Amount);
				}
				j++;
			}
		}

		// Token: 0x06006FCE RID: 28622 RVA: 0x003FB554 File Offset: 0x003F9754
		private unsafe void OfflineCreateRandomEnemyInventoryItem(DataContext context, RandomEnemyItem randomEnemyCfg, sbyte itemType, short itemTemplateId)
		{
			ItemKey itemKey = DomainManager.Item.CreateItem(context, itemType, itemTemplateId);
			bool flag = randomEnemyCfg.PoisonsToAdd != null && ItemTemplateHelper.IsPoisonable(itemKey.ItemType, itemKey.TemplateId) && context.Random.CheckPercentProb((int)randomEnemyCfg.AddPoisonRate);
			if (flag)
			{
				Span<short> span = new Span<short>(stackalloc byte[(UIntPtr)12], 6);
				SpanList<short> spanList = span;
				spanList.Clear();
				spanList.AddRange(randomEnemyCfg.PoisonsToAdd);
				spanList.Shuffle(context.Random);
				int poisonCount = context.Random.Next((int)randomEnemyCfg.MaxAddPoisonCount) + 1;
				bool flag2 = poisonCount > spanList.Count;
				if (flag2)
				{
					poisonCount = spanList.Count;
				}
				bool flag3 = poisonCount > 3;
				if (flag3)
				{
					poisonCount = 3;
				}
				ItemBase itemBase = DomainManager.Item.GetBaseItem(itemKey);
				for (int i = 0; i < poisonCount; i++)
				{
					short poisonTemplateId = *spanList[i];
					ValueTuple<ItemBase, bool> valueTuple = DomainManager.Item.SetAttachedPoisons(context, itemBase, poisonTemplateId, true, null);
					ItemBase newItem = valueTuple.Item1;
					bool hasChange = valueTuple.Item2;
					itemBase = newItem;
				}
				itemKey = itemBase.GetItemKey();
			}
			this._inventory.OfflineAdd(itemKey, 1);
		}

		// Token: 0x06006FCF RID: 28623 RVA: 0x003FB688 File Offset: 0x003F9888
		private void OfflineAddPresetOrgMemberEquipmentsWithProb(DataContext context, PresetEquipmentItemWithProb[] items, sbyte itemGrade, List<PresetInventoryItem> itemsToBeCreated)
		{
			int i = 0;
			int itemsCount = items.Length;
			while (i < itemsCount)
			{
				PresetEquipmentItemWithProb presetItem = items[i];
				bool flag = presetItem.TemplateId >= 0 && context.Random.CheckPercentProb((int)presetItem.Prob);
				if (flag)
				{
					sbyte randomItemGrade = ItemDomain.GenerateRandomItemGrade(context.Random, itemGrade);
					short templateId = presetItem.TemplateId + (short)randomItemGrade;
					itemsToBeCreated.Add(new PresetInventoryItem(presetItem.Type, templateId, 1, 100));
				}
				i++;
			}
		}

		// Token: 0x06006FD0 RID: 28624 RVA: 0x003FB70C File Offset: 0x003F990C
		private void OfflineAddPresetOrgMemberInventoryItems(DataContext context, List<PresetInventoryItem> items, sbyte itemGrade, List<PresetInventoryItem> itemsToBeCreated)
		{
			IRandomSource random = context.Random;
			int i = 0;
			int itemsCount = items.Count;
			while (i < itemsCount)
			{
				PresetInventoryItem presetItem = items[i];
				bool flag = !random.CheckPercentProb((int)presetItem.SpawnChance);
				if (!flag)
				{
					short templateId = ItemDomain.GenerateRandomItemTemplateId(random, presetItem.Type, presetItem.TemplateId, itemGrade);
					int amount = 1 + context.Random.Next(presetItem.Amount);
					itemsToBeCreated.Add(new PresetInventoryItem(presetItem.Type, templateId, amount, 100));
				}
				i++;
			}
		}

		// Token: 0x06006FD1 RID: 28625 RVA: 0x003FB7A0 File Offset: 0x003F99A0
		private void OfflineAddRandomEnemyPresetOrgMemberInventoryItems(DataContext context, List<PresetInventoryItem> items, sbyte itemGrade, List<PresetInventoryItem> itemsToBeCreated)
		{
			int i = 0;
			int itemsCount = items.Count;
			while (i < itemsCount)
			{
				PresetInventoryItem presetItem = items[i];
				bool flag = context.Random.CheckPercentProb((int)presetItem.SpawnChance);
				if (flag)
				{
					short templateId = ItemDomain.GenerateRandomItemTemplateId(context.Random, presetItem.Type, presetItem.TemplateId, itemGrade);
					int amount = 1 + context.Random.Next(presetItem.Amount);
					itemsToBeCreated.Add(new PresetInventoryItem(presetItem.Type, templateId, amount, 100));
				}
				i++;
			}
		}

		// Token: 0x06006FD2 RID: 28626 RVA: 0x003FB830 File Offset: 0x003F9A30
		private void OfflineReplaceProtagonistClothing(DataContext context, short clothingTemplateId)
		{
			ItemKey oriClothingKey = this._equipment[4];
			bool flag = oriClothingKey.IsValid();
			if (flag)
			{
				DomainManager.Item.RemoveItem(context, oriClothingKey);
			}
			ItemKey newClothingKey = DomainManager.Item.CreateClothing(context, clothingTemplateId, this._gender);
			this._equipment[4] = newClothingKey;
		}

		// Token: 0x06006FD3 RID: 28627 RVA: 0x003FB884 File Offset: 0x003F9A84
		[return: TupleElementNames(new string[]
		{
			"Sect",
			"Member"
		})]
		private unsafe static List<ValueTuple<OrganizationItem, OrganizationMemberItem>> GetRelatedSectAndMembers(IRandomSource random, RandomEnemyItem randomEnemy, sbyte grade)
		{
			int candidateSectsCount = randomEnemy.SectIds.Count;
			Span<short> span = new Span<short>(stackalloc byte[(UIntPtr)30], 15);
			SpanList<short> relatedSectIds = span;
			relatedSectIds.AddRange(randomEnemy.SectIds);
			bool flag = candidateSectsCount > randomEnemy.SelectSectCount;
			if (flag)
			{
				relatedSectIds.Shuffle(random);
				relatedSectIds.RemoveRange(randomEnemy.SelectSectCount, candidateSectsCount - randomEnemy.SelectSectCount);
			}
			List<ValueTuple<OrganizationItem, OrganizationMemberItem>> relatedSectsAndMembers = new List<ValueTuple<OrganizationItem, OrganizationMemberItem>>();
			int i = 0;
			int count = relatedSectIds.Count;
			while (i < count)
			{
				short sectId = *relatedSectIds[i];
				OrganizationItem sect = Organization.Instance[(int)sectId];
				short orgMemberId = sect.Members[(int)grade];
				OrganizationMemberItem member = OrganizationMember.Instance[orgMemberId];
				relatedSectsAndMembers.Add(new ValueTuple<OrganizationItem, OrganizationMemberItem>(sect, member));
				i++;
			}
			return relatedSectsAndMembers;
		}

		// Token: 0x06006FD4 RID: 28628 RVA: 0x003FB964 File Offset: 0x003F9B64
		private short ChooseGrowingSectMember(IRandomSource random, sbyte orgTemplateId, sbyte growingSectGrade)
		{
			bool flag = orgTemplateId < 0;
			if (flag)
			{
				orgTemplateId = this._organizationInfo.OrgTemplateId;
			}
			sbyte growingSectOrgTemplateId = -1;
			bool flag2 = OrganizationDomain.IsSect(orgTemplateId);
			if (flag2)
			{
				growingSectOrgTemplateId = orgTemplateId;
			}
			else
			{
				sbyte idealSect = this.GetIdealSect();
				bool flag3 = idealSect >= 0 && OrganizationDomain.MeetGenderRestriction(idealSect, this._gender);
				if (flag3)
				{
					growingSectOrgTemplateId = idealSect;
				}
			}
			bool flag4 = growingSectOrgTemplateId < 0;
			if (flag4)
			{
				growingSectOrgTemplateId = OrganizationDomain.GetRandomSectOrgTemplateId(random, this._gender);
			}
			bool flag5 = growingSectGrade < 0;
			if (flag5)
			{
				growingSectGrade = this._organizationInfo.Grade;
			}
			return OrganizationDomain.GetMemberId(growingSectOrgTemplateId, growingSectGrade);
		}

		// Token: 0x06006FD5 RID: 28629 RVA: 0x003FB9F8 File Offset: 0x003F9BF8
		private unsafe void OfflineInitializeBaseNeiliProportionOfFiveElements()
		{
			for (int i = 0; i < 5; i++)
			{
				*(ref this._baseNeiliProportionOfFiveElements.Items.FixedElementField + i) = 15;
			}
			sbyte innateFiveElementsType = this.GetInnateFiveElementsType();
			ref sbyte ptr = ref this._baseNeiliProportionOfFiveElements.Items.FixedElementField + innateFiveElementsType;
			ptr += 25;
		}

		// Token: 0x06006FD6 RID: 28630 RVA: 0x003FBA4C File Offset: 0x003F9C4C
		private unsafe void OfflineGenerateRandomActionEnergies(IRandomSource random)
		{
			for (sbyte actionEnergyType = 0; actionEnergyType < 5; actionEnergyType += 1)
			{
				*(ref this._actionEnergies.Items.FixedElementField + actionEnergyType) = (byte)random.Next(0, 201);
			}
		}

		// Token: 0x06006FD7 RID: 28631 RVA: 0x003FBA90 File Offset: 0x003F9C90
		private static int CalcAgeInfluence(IRandomSource random, Character character, OrganizationMemberItem orgMemberConfig)
		{
			short initialAge = OrganizationDomain.GetInitialAge(orgMemberConfig);
			return (character._actualAge < initialAge) ? Math.Clamp((int)(character._actualAge * 100 / initialAge) + RedzenHelper.NormalDistribute(random, 0f, 10f), 25, 100) : 100;
		}

		// Token: 0x06006FD8 RID: 28632 RVA: 0x003FBADC File Offset: 0x003F9CDC
		[Obsolete]
		private static int GenerateRandomAttributeValue(IRandomSource random, int adjustPercent)
		{
			float currMean = 40f + 25f * ((float)adjustPercent / 100f);
			return RedzenHelper.NormalDistribute(random, currMean, 10.746457f, 0, 100);
		}

		// Token: 0x06006FD9 RID: 28633 RVA: 0x003FBB14 File Offset: 0x003F9D14
		[Obsolete]
		private unsafe void OfflineGenerateRandomMainAttributes(IRandomSource random, short[] mainAttributesAdjust, bool abnormalOrgAttributes)
		{
			sbyte abnormalProb = (sbyte)(abnormalOrgAttributes ? random.Next(101) : 0);
			for (sbyte i = 0; i < 6; i += 1)
			{
				int currAdjust = Character.GetCurrAdjust(random, mainAttributesAdjust, i, abnormalProb);
				int currValue = Character.GenerateRandomAttributeValue(random, currAdjust);
				*(ref this._baseMainAttributes.Items.FixedElementField + (IntPtr)i * 2) = (short)currValue;
			}
		}

		// Token: 0x06006FDA RID: 28634 RVA: 0x003FBB71 File Offset: 0x003F9D71
		[Obsolete]
		public void RecreateMainAttributesAndQualificationsByGrowingSect(DataContext context, sbyte growingOrgTemplateId, sbyte growingGrade)
		{
			this.OfflineRecreateByGrowingSect(context.Random, growingOrgTemplateId, growingGrade);
		}

		// Token: 0x06006FDB RID: 28635 RVA: 0x003FBB84 File Offset: 0x003F9D84
		[Obsolete]
		private void OfflineCreateMainAttributes(IRandomSource random, ref IntelligentCharacterCreationInfo info, short orgMemberId, sbyte abnormalOrgAttributesProb)
		{
			bool flag = info.MotherCharId >= 0 || info.ActualFatherCharId >= 0;
			if (flag)
			{
				this.OfflineInheritMainAttributes(random, ref info);
			}
			else
			{
				bool flag2 = orgMemberId >= 0;
				if (flag2)
				{
					this.OfflineGenerateRandomMainAttributes(random, OrganizationDomain.GetMemberMainAttributesAdjust(orgMemberId), random.CheckPercentProb((int)abnormalOrgAttributesProb));
				}
				else
				{
					this.OfflineGenerateRandomMainAttributes(random, null, false);
				}
			}
		}

		// Token: 0x06006FDC RID: 28636 RVA: 0x003FBBE8 File Offset: 0x003F9DE8
		[Obsolete]
		private unsafe void OfflineInheritMainAttributes(IRandomSource random, ref IntelligentCharacterCreationInfo info)
		{
			bool flag = info.MotherCharId >= 0 && info.ActualFatherCharId >= 0;
			if (flag)
			{
				int* pAttrPairs = stackalloc int[(UIntPtr)24];
				MainAttributes motherAttributes = info.Mother.GetBaseMainAttributes();
				Character actualFather = info.ActualFather;
				MainAttributes fatherAttributes = (actualFather != null) ? actualFather.GetBaseMainAttributes() : info.ActualDeadFather.BaseMainAttributes;
				for (sbyte i = 0; i < 6; i += 1)
				{
					*(short*)(pAttrPairs + i) = *(ref motherAttributes.Items.FixedElementField + (IntPtr)i * 2);
					*(short*)((byte*)(pAttrPairs + i) + 2) = *(ref fatherAttributes.Items.FixedElementField + (IntPtr)i * 2);
				}
				Character.InheritAttributes_SortAttributePairs(pAttrPairs, 6);
				fixed (short* ptr = &this._baseMainAttributes.Items.FixedElementField)
				{
					short* pResult = ptr;
					Character.InheritAttributes_CalcAttributes(random, pAttrPairs, pResult, 6);
				}
			}
			else
			{
				Character mother = info.Mother;
				MainAttributes mainAttributes;
				if (mother == null)
				{
					Character actualFather2 = info.ActualFather;
					mainAttributes = ((actualFather2 != null) ? actualFather2.GetBaseMainAttributes() : info.ActualDeadFather.BaseMainAttributes);
				}
				else
				{
					mainAttributes = mother.GetBaseMainAttributes();
				}
				MainAttributes attributes = mainAttributes;
				for (sbyte j = 0; j < 6; j += 1)
				{
					int value = (int)(*(ref attributes.Items.FixedElementField + (IntPtr)j * 2));
					value += random.Next(21) - 10;
					bool flag2 = value < 0;
					if (flag2)
					{
						value = 0;
					}
					*(ref this._baseMainAttributes.Items.FixedElementField + (IntPtr)j * 2) = (short)value;
				}
			}
		}

		// Token: 0x06006FDD RID: 28637 RVA: 0x003FBD64 File Offset: 0x003F9F64
		[Obsolete]
		private unsafe static void InheritAttributes_SortAttributePairs(int* pAttrPairs, int count)
		{
			short* pAttrL = (short*)pAttrPairs;
			short* pAttrR = (short*)((byte*)pAttrPairs + 2);
			for (int i = 0; i < count; i++)
			{
				bool flag = pAttrL < pAttrR;
				if (flag)
				{
					short tmp = *pAttrL;
					*pAttrL = *pAttrR;
					*pAttrR = tmp;
				}
				pAttrL += 2;
				pAttrR += 2;
			}
		}

		// Token: 0x06006FDE RID: 28638 RVA: 0x003FBDB0 File Offset: 0x003F9FB0
		[Obsolete]
		private unsafe static void InheritAttributes_CalcAttributes(IRandomSource random, int* pAttrPairs, short* pResultAttributes, int count)
		{
			int mainRuleRandomValue = random.Next(100);
			short* pAttrBig = (short*)pAttrPairs;
			short* pAttrSmall = (short*)((byte*)pAttrPairs + 2);
			for (int i = 0; i < count; i++)
			{
				int randomValue = random.CheckPercentProb(50) ? mainRuleRandomValue : random.Next(100);
				bool flag = randomValue < 20;
				int value;
				if (flag)
				{
					value = (int)(*pAttrBig + *pAttrSmall / 10);
				}
				else
				{
					bool flag2 = randomValue < 50;
					if (flag2)
					{
						value = (int)(*pAttrBig);
					}
					else
					{
						value = (int)((*pAttrBig + *pAttrSmall) / 2);
					}
				}
				value += random.Next(21) - 10;
				bool flag3 = value < 0;
				if (flag3)
				{
					value = 0;
				}
				pResultAttributes[i] = (short)value;
				pAttrBig += 2;
				pAttrSmall += 2;
			}
		}

		// Token: 0x06006FDF RID: 28639 RVA: 0x003FBE68 File Offset: 0x003FA068
		[Obsolete]
		private void OfflineCreateRandomEnemyMainAttributes(IRandomSource random, [TupleElementNames(new string[]
		{
			"Sect",
			"Member"
		})] List<ValueTuple<OrganizationItem, OrganizationMemberItem>> relatedSectsAndMembers, sbyte abnormalOrgAttributesProb)
		{
			short relatedSectsCount = (short)relatedSectsAndMembers.Count;
			bool flag = relatedSectsCount > 1;
			short[] mainAttributesAdjust;
			if (flag)
			{
				mainAttributesAdjust = new short[6];
				for (int i = 0; i < (int)relatedSectsCount; i++)
				{
					short[] currAdjust = relatedSectsAndMembers[i].Item2.MainAttributesAdjust;
					for (sbyte j = 0; j < 6; j += 1)
					{
						short[] array = mainAttributesAdjust;
						sbyte b = j;
						array[(int)b] = array[(int)b] + currAdjust[(int)j];
					}
				}
				for (sbyte k = 0; k < 6; k += 1)
				{
					short[] array2 = mainAttributesAdjust;
					sbyte b2 = k;
					array2[(int)b2] = array2[(int)b2] / relatedSectsCount;
				}
			}
			else
			{
				mainAttributesAdjust = relatedSectsAndMembers[0].Item2.MainAttributesAdjust;
			}
			this.OfflineGenerateRandomMainAttributes(random, mainAttributesAdjust, random.CheckPercentProb((int)abnormalOrgAttributesProb));
		}

		// Token: 0x06006FE0 RID: 28640 RVA: 0x003FBF2C File Offset: 0x003FA12C
		[Obsolete]
		private unsafe void OfflineCreateProtagonistMainAttributes(IRandomSource random, short orgMemberId)
		{
			short[] mainAttributesAdjust = OrganizationDomain.GetMemberMainAttributesAdjust(orgMemberId);
			for (sbyte i = 0; i < 6; i += 1)
			{
				int adjust = (int)mainAttributesAdjust[(int)i];
				int baseValue = (adjust > 0) ? 50 : ((adjust == 0) ? 35 : 20);
				int currValue = baseValue + random.Next(16);
				*(ref this._baseMainAttributes.Items.FixedElementField + (IntPtr)i * 2) = (short)currValue;
			}
		}

		// Token: 0x06006FE1 RID: 28641 RVA: 0x003FBF94 File Offset: 0x003FA194
		[Obsolete]
		private void OfflineCreateLifeSkillsQualifications(IRandomSource random, short orgMemberId, sbyte abnormalOrgAttributesProb, short[] lifeSkillsAdjustBonus)
		{
			bool flag = orgMemberId >= 0;
			if (flag)
			{
				this.OfflineGenerateRandomLifeSkillsQualifications(random, OrganizationDomain.GetMemberLifeSkillsAdjust(orgMemberId), lifeSkillsAdjustBonus, random.CheckPercentProb((int)abnormalOrgAttributesProb));
			}
			else
			{
				this.OfflineGenerateRandomLifeSkillsQualifications(random, null, lifeSkillsAdjustBonus, false);
			}
		}

		// Token: 0x06006FE2 RID: 28642 RVA: 0x003FBFD4 File Offset: 0x003FA1D4
		[Obsolete]
		private unsafe void OfflineGenerateRandomLifeSkillsQualifications(IRandomSource random, short[] lifeSkillsAdjust, short[] lifeSkillsAdjustBonus, bool abnormalOrgAttributes)
		{
			sbyte abnormalProb = (sbyte)(abnormalOrgAttributes ? random.Next(101) : 0);
			for (sbyte i = 0; i < 16; i += 1)
			{
				int currAdjust = Character.GetCurrAdjust(random, lifeSkillsAdjust, i, abnormalProb);
				bool flag = lifeSkillsAdjustBonus != null;
				if (flag)
				{
					currAdjust += (int)lifeSkillsAdjustBonus[(int)i];
				}
				int currValue = Character.GenerateRandomAttributeValue(random, currAdjust);
				*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)i * 2) = (short)currValue;
			}
		}

		// Token: 0x06006FE3 RID: 28643 RVA: 0x003FC044 File Offset: 0x003FA244
		[Obsolete]
		private void OfflineCreateLifeSkillsQualifications(IRandomSource random, ref IntelligentCharacterCreationInfo info, short orgMemberId, sbyte abnormalOrgAttributesProb)
		{
			bool flag = info.MotherCharId >= 0 || info.ActualFatherCharId >= 0;
			if (flag)
			{
				this.OfflineInheritLifeSkillsQualifications(random, ref info);
			}
			else
			{
				this.OfflineCreateLifeSkillsQualifications(random, orgMemberId, abnormalOrgAttributesProb, info.LifeSkillsLowerBound);
			}
		}

		// Token: 0x06006FE4 RID: 28644 RVA: 0x003FC08C File Offset: 0x003FA28C
		[Obsolete]
		private unsafe void OfflineInheritLifeSkillsQualifications(IRandomSource random, ref IntelligentCharacterCreationInfo info)
		{
			bool flag = info.MotherCharId >= 0 && info.ActualFatherCharId >= 0;
			if (flag)
			{
				int* pAttrPairs = stackalloc int[(UIntPtr)64];
				ref LifeSkillShorts motherQualifications = ref info.Mother.GetBaseLifeSkillQualifications();
				Character actualFather = info.ActualFather;
				LifeSkillShorts fatherQualifications = (actualFather != null) ? (*actualFather.GetBaseLifeSkillQualifications()) : info.ActualDeadFather.BaseLifeSkillQualifications;
				for (sbyte i = 0; i < 16; i += 1)
				{
					*(short*)(pAttrPairs + i) = *(ref motherQualifications.Items.FixedElementField + (IntPtr)i * 2);
					*(short*)((byte*)(pAttrPairs + i) + 2) = *(ref fatherQualifications.Items.FixedElementField + (IntPtr)i * 2);
				}
				Character.InheritAttributes_SortAttributePairs(pAttrPairs, 16);
				fixed (short* ptr = &this._baseLifeSkillQualifications.Items.FixedElementField)
				{
					short* pResult = ptr;
					Character.InheritAttributes_CalcAttributes(random, pAttrPairs, pResult, 16);
				}
			}
			else
			{
				Character mother = info.Mother;
				LifeSkillShorts lifeSkillShorts;
				if (mother == null)
				{
					Character actualFather2 = info.ActualFather;
					lifeSkillShorts = ((actualFather2 != null) ? (*actualFather2.GetBaseLifeSkillQualifications()) : info.ActualDeadFather.BaseLifeSkillQualifications);
				}
				else
				{
					lifeSkillShorts = *mother.GetBaseLifeSkillQualifications();
				}
				LifeSkillShorts qualifications = lifeSkillShorts;
				for (sbyte j = 0; j < 16; j += 1)
				{
					int value = (int)(*(ref qualifications.Items.FixedElementField + (IntPtr)j * 2));
					value += random.Next(21) - 10;
					bool flag2 = value < 0;
					if (flag2)
					{
						value = 0;
					}
					*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)j * 2) = (short)value;
				}
			}
		}

		// Token: 0x06006FE5 RID: 28645 RVA: 0x003FC218 File Offset: 0x003FA418
		[Obsolete]
		private unsafe void OfflineCreateRandomEnemyLifeSkillsQualifications(IRandomSource random, RandomEnemyItem randomEnemy, [TupleElementNames(new string[]
		{
			"Sect",
			"Member"
		})] List<ValueTuple<OrganizationItem, OrganizationMemberItem>> relatedSectsAndMembers, sbyte abnormalOrgAttributesProb)
		{
			short relatedSectsCount = (short)relatedSectsAndMembers.Count;
			bool flag = relatedSectsCount > 1;
			short[] lifeSkillsAdjust;
			if (flag)
			{
				lifeSkillsAdjust = new short[16];
				for (int i = 0; i < (int)relatedSectsCount; i++)
				{
					short[] currAdjust = relatedSectsAndMembers[i].Item2.LifeSkillsAdjust;
					for (sbyte j = 0; j < 16; j += 1)
					{
						short[] array = lifeSkillsAdjust;
						sbyte b = j;
						array[(int)b] = array[(int)b] + currAdjust[(int)j];
					}
				}
				for (sbyte k = 0; k < 16; k += 1)
				{
					short[] array2 = lifeSkillsAdjust;
					sbyte b2 = k;
					array2[(int)b2] = array2[(int)b2] / relatedSectsCount;
				}
			}
			else
			{
				lifeSkillsAdjust = relatedSectsAndMembers[0].Item2.LifeSkillsAdjust;
			}
			this.OfflineGenerateRandomLifeSkillsQualifications(random, lifeSkillsAdjust, null, random.CheckPercentProb((int)abnormalOrgAttributesProb));
			for (sbyte l = 0; l < 16; l += 1)
			{
				int value = (int)(*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)l * 2));
				value = value * (int)(100 + randomEnemy.LifeSkillQualificationAdjust) / 100;
				bool flag2 = value < 0;
				if (flag2)
				{
					value = 0;
				}
				*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)l * 2) = (short)value;
			}
		}

		// Token: 0x06006FE6 RID: 28646 RVA: 0x003FC34C File Offset: 0x003FA54C
		[Obsolete]
		private unsafe void OfflineGenerateRandomCombatSkillsQualifications(IRandomSource random, short[] combatSkillsAdjust, short[] combatSkillsAdjustBonus, bool abnormalOrgAttributes)
		{
			sbyte abnormalProb = (sbyte)(abnormalOrgAttributes ? random.Next(101) : 0);
			for (sbyte i = 0; i < 14; i += 1)
			{
				int currAdjust = Character.GetCurrAdjust(random, combatSkillsAdjust, i, abnormalProb);
				bool flag = combatSkillsAdjustBonus != null;
				if (flag)
				{
					currAdjust += (int)combatSkillsAdjustBonus[(int)i];
				}
				int currValue = Character.GenerateRandomAttributeValue(random, currAdjust);
				*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)i * 2) = (short)currValue;
			}
		}

		// Token: 0x06006FE7 RID: 28647 RVA: 0x003FC3BC File Offset: 0x003FA5BC
		[Obsolete]
		private void OfflineCreateCombatSkillsQualifications(IRandomSource random, short orgMemberId, sbyte abnormalOrgAttributesProb, short[] combatSkillsAdjustBonus)
		{
			bool flag = orgMemberId >= 0;
			if (flag)
			{
				this.OfflineGenerateRandomCombatSkillsQualifications(random, OrganizationDomain.GetMemberCombatSkillsAdjust(orgMemberId), combatSkillsAdjustBonus, random.CheckPercentProb((int)abnormalOrgAttributesProb));
			}
			else
			{
				this.OfflineGenerateRandomCombatSkillsQualifications(random, null, combatSkillsAdjustBonus, false);
			}
		}

		// Token: 0x06006FE8 RID: 28648 RVA: 0x003FC3FC File Offset: 0x003FA5FC
		[Obsolete]
		private void OfflineCreateCombatSkillsQualifications(IRandomSource random, ref IntelligentCharacterCreationInfo info, short orgMemberId, sbyte abnormalOrgAttributesProb)
		{
			bool flag = info.MotherCharId >= 0 || info.ActualFatherCharId >= 0;
			if (flag)
			{
				this.OfflineInheritCombatSkillsQualifications(random, ref info);
			}
			else
			{
				this.OfflineCreateCombatSkillsQualifications(random, orgMemberId, abnormalOrgAttributesProb, info.CombatSkillsLowerBound);
			}
		}

		// Token: 0x06006FE9 RID: 28649 RVA: 0x003FC444 File Offset: 0x003FA644
		[Obsolete]
		private unsafe void OfflineInheritCombatSkillsQualifications(IRandomSource random, ref IntelligentCharacterCreationInfo info)
		{
			bool flag = info.MotherCharId >= 0 && info.ActualFatherCharId >= 0;
			if (flag)
			{
				int* pAttrPairs = stackalloc int[(UIntPtr)56];
				ref CombatSkillShorts motherQualifications = ref info.Mother.GetBaseCombatSkillQualifications();
				Character actualFather = info.ActualFather;
				CombatSkillShorts fatherQualifications = (actualFather != null) ? (*actualFather.GetBaseCombatSkillQualifications()) : info.ActualDeadFather.BaseCombatSkillQualifications;
				for (sbyte i = 0; i < 14; i += 1)
				{
					*(short*)(pAttrPairs + i) = *(ref motherQualifications.Items.FixedElementField + (IntPtr)i * 2);
					*(short*)((byte*)(pAttrPairs + i) + 2) = *(ref fatherQualifications.Items.FixedElementField + (IntPtr)i * 2);
				}
				Character.InheritAttributes_SortAttributePairs(pAttrPairs, 14);
				fixed (short* ptr = &this._baseCombatSkillQualifications.Items.FixedElementField)
				{
					short* pResult = ptr;
					Character.InheritAttributes_CalcAttributes(random, pAttrPairs, pResult, 14);
				}
			}
			else
			{
				Character mother = info.Mother;
				CombatSkillShorts combatSkillShorts;
				if (mother == null)
				{
					Character actualFather2 = info.ActualFather;
					combatSkillShorts = ((actualFather2 != null) ? (*actualFather2.GetBaseCombatSkillQualifications()) : info.ActualDeadFather.BaseCombatSkillQualifications);
				}
				else
				{
					combatSkillShorts = *mother.GetBaseCombatSkillQualifications();
				}
				CombatSkillShorts qualifications = combatSkillShorts;
				for (sbyte j = 0; j < 14; j += 1)
				{
					int value = (int)(*(ref qualifications.Items.FixedElementField + (IntPtr)j * 2));
					value += random.Next(21) - 10;
					bool flag2 = value < 0;
					if (flag2)
					{
						value = 0;
					}
					*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)j * 2) = (short)value;
				}
			}
		}

		// Token: 0x06006FEA RID: 28650 RVA: 0x003FC5D0 File Offset: 0x003FA7D0
		[Obsolete]
		private unsafe void OfflineCreateRandomEnemyCombatSkillsQualifications(IRandomSource random, RandomEnemyItem randomEnemy, [TupleElementNames(new string[]
		{
			"Sect",
			"Member"
		})] List<ValueTuple<OrganizationItem, OrganizationMemberItem>> relatedSectsAndMembers, sbyte abnormalOrgAttributesProb)
		{
			short relatedSectsCount = (short)relatedSectsAndMembers.Count;
			bool flag = relatedSectsCount > 1;
			short[] combatSkillsAdjust;
			if (flag)
			{
				combatSkillsAdjust = new short[14];
				for (int i = 0; i < (int)relatedSectsCount; i++)
				{
					short[] currAdjust = relatedSectsAndMembers[i].Item2.CombatSkillsAdjust;
					for (int j = 0; j < 14; j++)
					{
						short[] array = combatSkillsAdjust;
						int num = j;
						array[num] += currAdjust[j];
					}
				}
				for (int k = 0; k < 14; k++)
				{
					short[] array2 = combatSkillsAdjust;
					int num2 = k;
					array2[num2] /= relatedSectsCount;
				}
			}
			else
			{
				combatSkillsAdjust = relatedSectsAndMembers[0].Item2.CombatSkillsAdjust;
			}
			this.OfflineGenerateRandomCombatSkillsQualifications(random, combatSkillsAdjust, null, random.CheckPercentProb((int)abnormalOrgAttributesProb));
			for (sbyte l = 0; l < 14; l += 1)
			{
				int value = (int)(*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)l * 2));
				value = value * (int)(100 + randomEnemy.CombatSkillQualificationAdjust) / 100;
				bool flag2 = value < 0;
				if (flag2)
				{
					value = 0;
				}
				*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)l * 2) = (short)value;
			}
		}

		// Token: 0x06006FEB RID: 28651 RVA: 0x003FC704 File Offset: 0x003FA904
		[Obsolete("replaced with GameData.Domains.Character.Character.OfflineAddRandomEnemyOrgMemberCombatSkills")]
		private void OfflineAddRandomEnemyPresetOrgMemberCombatSkills(DataContext context, [TupleElementNames(new string[]
		{
			"Org",
			"Member"
		})] List<ValueTuple<OrganizationItem, OrganizationMemberItem>> relatedSectAndMembers, List<GameData.Domains.CombatSkill.CombatSkill> charCombatSkills)
		{
			sbyte selfBehaviorType = BehaviorType.GetBehaviorType(this._baseMorality);
			List<InventoryCombatSkillBookParams> skillBooks = new List<InventoryCombatSkillBookParams>();
			HashSet<short> suitableWeaponIds = new HashSet<short>();
			int i = 0;
			int count = relatedSectAndMembers.Count;
			while (i < count)
			{
				OrganizationItem org = relatedSectAndMembers[i].Item1;
				OrganizationMemberItem orgMember = relatedSectAndMembers[i].Item2;
				sbyte teacherBehaviorType = (org.MainMorality == short.MinValue) ? -1 : BehaviorType.GetBehaviorType(org.MainMorality);
				this.OfflineAddRandomEnemyPresetOrgMemberCombatSkillsInternal(context.Random, org.Goodness, teacherBehaviorType, selfBehaviorType, orgMember.CombatSkills, charCombatSkills, skillBooks, suitableWeaponIds);
				i++;
			}
			this.OfflineAddSkillBooksAndWeapons(context, skillBooks, suitableWeaponIds);
		}

		// Token: 0x06006FEC RID: 28652 RVA: 0x003FC7B0 File Offset: 0x003FA9B0
		[Obsolete("replaced with GameData.Domains.Character.Character.OfflineAddRandomEnemyOrgMemberCombatSkills")]
		private void OfflineAddRandomEnemyPresetOrgMemberCombatSkillsInternal(IRandomSource random, sbyte orgGoodness, sbyte teacherBehaviorType, sbyte selfBehaviorType, List<PresetOrgMemberCombatSkill> presetSkills, List<GameData.Domains.CombatSkill.CombatSkill> charCombatSkills, List<InventoryCombatSkillBookParams> skillBooks, HashSet<short> suitableWeaponIds)
		{
			byte difficulty = DomainManager.Extra.GetEnemyPracticeLevel();
			short pageBuff = WorldCreation.Instance[11].InfluenceFactors[(int)difficulty];
			short practiceBuff = WorldCreation.Instance[11].SecondaryInfluenceFactors[(int)difficulty];
			int i = 0;
			int count = presetSkills.Count;
			while (i < count)
			{
				PresetOrgMemberCombatSkill presetSkill = presetSkills[i];
				for (int skillGrade = 0; skillGrade <= (int)presetSkill.MaxGrade; skillGrade++)
				{
					bool flag = skillGrade != (int)presetSkill.MaxGrade && !random.CheckPercentProb(50);
					if (!flag)
					{
						short templateId = (short)((int)presetSkill.SkillGroupId + skillGrade);
						int gradeDiff = (int)this._organizationInfo.Grade - skillGrade;
						ValueTuple<byte, ushort> valueTuple = Character.GenerateCombatSkillBookReadingInfo(random, teacherBehaviorType, selfBehaviorType, orgGoodness, gradeDiff, 100, pageBuff);
						byte bookPageTypes = valueTuple.Item1;
						ushort readingState = valueTuple.Item2;
						charCombatSkills.Add(new GameData.Domains.CombatSkill.CombatSkill(-1, templateId, readingState));
						this._learnedCombatSkills.Add(templateId);
						CombatSkillItem skillConfig = Config.CombatSkill.Instance[templateId];
						bool flag2 = random.CheckPercentProb(11 - skillGrade * 2);
						if (flag2)
						{
							skillBooks.Add(new InventoryCombatSkillBookParams(skillConfig.BookId, bookPageTypes));
						}
						short suitableWeaponId = skillConfig.MostFittingWeaponID;
						sbyte grade = ItemDomain.GenerateRandomItemGrade(random, this._organizationInfo.Grade);
						bool flag3 = suitableWeaponId >= 0;
						if (flag3)
						{
							suitableWeaponIds.Add(suitableWeaponId + (short)grade);
						}
					}
				}
				i++;
			}
		}

		// Token: 0x06006FED RID: 28653 RVA: 0x003FC934 File Offset: 0x003FAB34
		[Obsolete]
		private void OfflineCreateFeatures(DataContext context, Character mother, PregnantState pregnantState, Character father, DeadCharacter deadFather, bool randomFeaturesAtCreating, short potentialFeaturesAge = -1, int destinyType = -1)
		{
			IRandomSource random = context.Random;
			Dictionary<short, short> featureGroup2Id = new Dictionary<short, short>(16);
			this.GenerateFixedFeatures(featureGroup2Id);
			bool flag = destinyType >= 0;
			if (flag)
			{
				Character.AddFeature(featureGroup2Id, DestinyType.Instance[destinyType].Feature);
			}
			if (randomFeaturesAtCreating)
			{
				this.GenerateGeneticFeatures(random, featureGroup2Id, mother, pregnantState, father, deadFather);
				Character.AddFeature(featureGroup2Id, CharacterDomain.GetBirthdayFeatureId(this._birthMonth));
				bool flag2 = this._currAge >= 1 && random.CheckPercentProb(50);
				if (flag2)
				{
					Character.AddFeature(featureGroup2Id, CharacterDomain.GenerateOneYearOldCatchFeature(random));
				}
				this.GenerateRandomBasicFeatures(context, featureGroup2Id, false, false);
			}
			this.OfflineApplyFeatureIds(featureGroup2Id, potentialFeaturesAge);
		}

		// Token: 0x06006FEE RID: 28654 RVA: 0x003FC9E4 File Offset: 0x003FABE4
		[Obsolete]
		private void OfflineCreateCloseFriendRandomFeatures(DataContext context)
		{
			IRandomSource random = context.Random;
			Dictionary<short, short> featureGroup2Id = new Dictionary<short, short>(16);
			this.GenerateFixedFeatures(featureGroup2Id);
			Character.AddFeature(featureGroup2Id, CharacterDomain.GetBirthdayFeatureId(this._birthMonth));
			bool flag = random.CheckPercentProb(50);
			if (flag)
			{
				Character.AddFeature(featureGroup2Id, CharacterDomain.GenerateOneYearOldCatchFeature(random));
			}
			Character.AddFeature(featureGroup2Id, 164);
			this.GenerateRandomBasicFeatures(context, featureGroup2Id, true, true);
			this.OfflineApplyFeatureIds(featureGroup2Id, -1);
		}

		// Token: 0x06006FEF RID: 28655 RVA: 0x003FCA54 File Offset: 0x003FAC54
		[Obsolete]
		private static void AddFeature(Dictionary<short, short> featureGroup2Id, short featureId)
		{
			short groupId = CharacterFeature.Instance[featureId].MutexGroupId;
			featureGroup2Id.TryAdd(groupId, featureId);
		}

		// Token: 0x06006FF0 RID: 28656 RVA: 0x003FCA7C File Offset: 0x003FAC7C
		[Obsolete]
		private static void ApplyFeatureGroup(Dictionary<short, short> featureGroup2Id, List<short> featureIds, short groupId)
		{
			short featureId;
			bool flag = featureGroup2Id.TryGetValue(groupId, out featureId);
			if (flag)
			{
				featureIds.Add(featureId);
				featureGroup2Id.Remove(groupId);
			}
		}

		// Token: 0x06006FF1 RID: 28657 RVA: 0x003FCAAC File Offset: 0x003FACAC
		[Obsolete]
		private void OfflineApplyFeatureIds(Dictionary<short, short> featureGroup2Id, short potentialFeaturesAge = -1)
		{
			this._featureIds.Clear();
			this._potentialFeatureIds.Clear();
			Character.ApplyFeatureGroup(featureGroup2Id, this._featureIds, 216);
			Character.ApplyFeatureGroup(featureGroup2Id, this._featureIds, 195);
			Character.ApplyFeatureGroup(featureGroup2Id, this._featureIds, 183);
			Character.ApplyFeatureGroup(featureGroup2Id, this._featureIds, 171);
			foreach (KeyValuePair<short, short> entry in featureGroup2Id)
			{
				short featureId = entry.Value;
				bool flag = potentialFeaturesAge >= 0 && CharacterFeature.Instance[featureId].Mergeable;
				if (flag)
				{
					this._potentialFeatureIds.Add(featureId);
				}
				else
				{
					this._featureIds.Add(featureId);
				}
			}
			bool flag2 = potentialFeaturesAge >= 0;
			if (flag2)
			{
				int affectedFeaturesCount = this._potentialFeatureIds.Count * (int)potentialFeaturesAge / 16;
				for (int i = 0; i < affectedFeaturesCount; i++)
				{
					this._featureIds.Add(this._potentialFeatureIds[i]);
				}
			}
		}

		// Token: 0x06006FF2 RID: 28658 RVA: 0x003FCBE8 File Offset: 0x003FADE8
		[Obsolete]
		private void GenerateFixedFeatures(Dictionary<short, short> featureGroup2Id)
		{
			short virginityFeatureId = 195;
			short xiangshuStateFeatureId = 216;
			int featureIdsCount = this._featureIds.Count;
			for (int i = 0; i < featureIdsCount; i++)
			{
				short featureId = this._featureIds[i];
				short groupId = CharacterFeature.Instance[featureId].MutexGroupId;
				bool flag = groupId == 195;
				if (flag)
				{
					virginityFeatureId = featureId;
				}
				else
				{
					bool flag2 = groupId == 216;
					if (flag2)
					{
						xiangshuStateFeatureId = featureId;
					}
				}
			}
			Character.AddFeature(featureGroup2Id, virginityFeatureId);
			Character.AddFeature(featureGroup2Id, xiangshuStateFeatureId);
			for (int j = 0; j < featureIdsCount; j++)
			{
				Character.AddFeature(featureGroup2Id, this._featureIds[j]);
			}
		}

		// Token: 0x06006FF3 RID: 28659 RVA: 0x003FCCA4 File Offset: 0x003FAEA4
		[Obsolete]
		private void GenerateGeneticFeatures(IRandomSource random, Dictionary<short, short> featureGroup2Id, Character mother, PregnantState pregnantState, Character father, DeadCharacter deadFather)
		{
			bool flag = mother == null && father == null && deadFather == null;
			if (!flag)
			{
				List<short> motherFeatureIds = null;
				List<short> fatherFeatureIds = null;
				bool flag2 = pregnantState != null;
				if (flag2)
				{
					motherFeatureIds = pregnantState.MotherFeatureIds;
					fatherFeatureIds = pregnantState.FatherFeatureIds;
				}
				else
				{
					bool flag3 = mother != null;
					if (flag3)
					{
						motherFeatureIds = mother.GetFeatureIds();
					}
					bool flag4 = father != null;
					if (flag4)
					{
						fatherFeatureIds = father.GetFeatureIds();
					}
					else
					{
						bool flag5 = deadFather != null;
						if (flag5)
						{
							fatherFeatureIds = deadFather.FeatureIds;
						}
					}
				}
				Dictionary<short, ValueTuple<short, short>> mergeableFeaturePairs = new Dictionary<short, ValueTuple<short, short>>();
				bool flag6 = fatherFeatureIds != null;
				if (flag6)
				{
					int fatherFeatureIdsCount = fatherFeatureIds.Count;
					for (int i = 0; i < fatherFeatureIdsCount; i++)
					{
						short featureId = fatherFeatureIds[i];
						CharacterFeatureItem template = CharacterFeature.Instance[featureId];
						short groupId = template.MutexGroupId;
						sbyte geneticProb = template.GeneticProb;
						bool mergeable = template.Mergeable;
						if (mergeable)
						{
							mergeableFeaturePairs[groupId] = new ValueTuple<short, short>(-1, featureId);
						}
						else
						{
							bool flag7 = geneticProb > 0;
							if (flag7)
							{
								bool flag8 = !featureGroup2Id.ContainsKey(groupId) && random.CheckPercentProb((int)geneticProb);
								if (flag8)
								{
									featureGroup2Id.Add(groupId, featureId);
								}
							}
						}
					}
				}
				bool flag9 = motherFeatureIds != null;
				if (flag9)
				{
					int motherFeatureIdsCount = motherFeatureIds.Count;
					for (int j = 0; j < motherFeatureIdsCount; j++)
					{
						short featureId2 = motherFeatureIds[j];
						CharacterFeatureItem template2 = CharacterFeature.Instance[featureId2];
						short groupId2 = template2.MutexGroupId;
						sbyte geneticProb2 = template2.GeneticProb;
						bool mergeable2 = template2.Mergeable;
						if (mergeable2)
						{
							ValueTuple<short, short> pair;
							bool flag10 = mergeableFeaturePairs.TryGetValue(groupId2, out pair);
							if (flag10)
							{
								mergeableFeaturePairs[groupId2] = new ValueTuple<short, short>(featureId2, pair.Item2);
							}
						}
						else
						{
							bool flag11 = geneticProb2 > 0;
							if (flag11)
							{
								bool flag12 = !featureGroup2Id.ContainsKey(groupId2) && random.CheckPercentProb((int)geneticProb2);
								if (flag12)
								{
									featureGroup2Id.Add(groupId2, featureId2);
								}
							}
						}
					}
				}
				foreach (KeyValuePair<short, ValueTuple<short, short>> entry in mergeableFeaturePairs)
				{
					short groupId3 = entry.Key;
					ValueTuple<short, short> value = entry.Value;
					short motherFeatureId = value.Item1;
					short fatherFeatureId = value.Item2;
					bool flag13 = motherFeatureId < 0 || fatherFeatureId < 0;
					if (!flag13)
					{
						bool flag14 = featureGroup2Id.ContainsKey(groupId3);
						if (!flag14)
						{
							sbyte motherLevel = CharacterFeature.Instance[motherFeatureId].Level;
							sbyte fatherLevel = CharacterFeature.Instance[fatherFeatureId].Level;
							sbyte mergedLevel = (motherLevel + fatherLevel) / 2;
							bool flag15 = motherLevel > 0 && fatherLevel > 0;
							if (flag15)
							{
								int upgradeProb = (int)((3 - mergedLevel) * 40);
								bool flag16 = random.CheckPercentProb(upgradeProb);
								if (flag16)
								{
									mergedLevel += 1;
								}
							}
							else
							{
								bool flag17 = motherLevel < 0 && fatherLevel < 0;
								if (flag17)
								{
									int downgradeProb = (int)((3 + mergedLevel) * 40);
									bool flag18 = random.CheckPercentProb(downgradeProb);
									if (flag18)
									{
										mergedLevel -= 1;
									}
								}
							}
							bool flag19 = mergedLevel == 0;
							if (!flag19)
							{
								short mergedFeatureId = CharacterDomain.GetMergeableFeatureIdByLevel(groupId3, mergedLevel);
								featureGroup2Id.Add(groupId3, mergedFeatureId);
							}
						}
					}
				}
			}
		}

		// Token: 0x06006FF4 RID: 28660 RVA: 0x003FD008 File Offset: 0x003FB208
		[Obsolete]
		private void GenerateRandomBasicFeatures(DataContext context, Dictionary<short, short> featureGroup2Id, bool isProtagonist = false, bool allGoodBasicFeatures = false)
		{
			IRandomSource random = context.Random;
			int basicFeaturesCount = allGoodBasicFeatures ? 5 : Character.GenerateRandomBasicFeaturesCount(context.Random);
			foreach (KeyValuePair<short, short> entry in featureGroup2Id)
			{
				short featureId = entry.Value;
				bool basic = CharacterFeature.Instance[featureId].Basic;
				if (basic)
				{
					basicFeaturesCount--;
				}
			}
			bool flag = basicFeaturesCount <= 0;
			if (!flag)
			{
				int goodFeaturesPotential = random.Next(101);
				int i = 0;
				while (i < basicFeaturesCount)
				{
					bool flag2 = allGoodBasicFeatures || random.CheckPercentProb(goodFeaturesPotential);
					if (flag2)
					{
						ValueTuple<short, short> randomBasicFeature = CharacterDomain.GetRandomBasicFeature(random, isProtagonist, this._gender, true, featureGroup2Id);
						short groupId = randomBasicFeature.Item1;
						short featureId2 = randomBasicFeature.Item2;
						bool flag3 = featureId2 < 0;
						if (!flag3)
						{
							featureGroup2Id.Add(groupId, featureId2);
							goodFeaturesPotential -= 20;
						}
					}
					else
					{
						ValueTuple<short, short> randomBasicFeature2 = CharacterDomain.GetRandomBasicFeature(random, isProtagonist, this._gender, false, featureGroup2Id);
						short groupId2 = randomBasicFeature2.Item1;
						short featureId3 = randomBasicFeature2.Item2;
						bool flag4 = featureId3 < 0;
						if (!flag4)
						{
							featureGroup2Id.Add(groupId2, featureId3);
							goodFeaturesPotential += 20;
						}
					}
					IL_123:
					i++;
					continue;
					goto IL_123;
				}
			}
		}

		// Token: 0x06006FF5 RID: 28661 RVA: 0x003FD15C File Offset: 0x003FB35C
		[Obsolete]
		private static int GenerateRandomBasicFeaturesCount(IRandomSource random)
		{
			return RedzenHelper.SkewDistribute(random, 4f, 0.333f, 3f, 3, 7);
		}

		// Token: 0x06006FF6 RID: 28662 RVA: 0x003FD188 File Offset: 0x003FB388
		[Obsolete("Use GameData.Domains.Organization.OrganizationDomain.GetRandomOrgMemberClothing instead.")]
		private static short GetOrgClothing(IRandomSource random, OrganizationMemberItem orgMemberConfig)
		{
			return OrganizationDomain.GetRandomOrgMemberClothing(random, orgMemberConfig);
		}

		// Token: 0x06006FF7 RID: 28663 RVA: 0x003FD1A4 File Offset: 0x003FB3A4
		private Character.ProtagonistFeatureRelatedStatus OfflineApplyProtagonistFeaturesAndGenome(DataContext context, ProtagonistCreationInfo info, List<GameData.Domains.CombatSkill.CombatSkill> combatSkills)
		{
			Character.ProtagonistFeatureRelatedStatus status = new Character.ProtagonistFeatureRelatedStatus(combatSkills);
			int i = 0;
			int count = info.ProtagonistFeatureIds.Count;
			while (i < count)
			{
				short featureId = info.ProtagonistFeatureIds[i];
				this.OfflineApplyProtagonistFeature(context, featureId, info, status);
				i++;
			}
			InscribedCharacter inscribedChar = info.InscribedChar;
			this.OfflineCreateProtagonistRandomFeatures(context, (inscribedChar != null) ? inscribedChar.FeatureIds : null, status.AddFeatureDreamLover, status.AddFeatureLifeSkillLearning, status.AddFeatureCombatSkillLearning, status.AddFeatureWhiteSnake, status.AddFeatureLongevity);
			Tester.Assert(!this.IsCompletelyInfected(), "");
			Genome.CreateRandom(context.Random, ref this._genome);
			return status;
		}

		// Token: 0x06006FF8 RID: 28664 RVA: 0x003FD258 File Offset: 0x003FB458
		private unsafe void OfflineApplyProtagonistFeature(DataContext context, short protagonistFeatureId, ProtagonistCreationInfo info, Character.ProtagonistFeatureRelatedStatus status)
		{
			IRandomSource random = context.Random;
			switch (protagonistFeatureId)
			{
			case 0:
				this.OfflineApplyProtagonistFeature_MainAttribute(random, 0);
				break;
			case 1:
				this.OfflineApplyProtagonistFeature_MainAttribute(random, 1);
				break;
			case 2:
				this.OfflineApplyProtagonistFeature_MainAttribute(random, 2);
				break;
			case 3:
				this.OfflineApplyProtagonistFeature_MainAttribute(random, 3);
				break;
			case 4:
				this.OfflineApplyProtagonistFeature_MainAttribute(random, 4);
				break;
			case 5:
				this.OfflineApplyProtagonistFeature_MainAttribute(random, 5);
				break;
			case 6:
				status.CreateCloseFriend = true;
				break;
			case 7:
				status.AddFeatureDreamLover = true;
				break;
			case 8:
				status.AddFeatureWhiteSnake = true;
				break;
			case 9:
				status.AddFeatureLongevity = true;
				break;
			case 10:
				this.OfflineApplyProtagonistFeature_MaterialResources();
				break;
			case 11:
				*(ref this._resources.Items.FixedElementField + (IntPtr)6 * 4) += 10000;
				break;
			case 12:
				this.OfflineApplyProtagonistFeature_Clothing(context);
				break;
			case 13:
				this.OfflineApplyProtagonistFeature_Wines(context);
				break;
			case 14:
				this.OfflineApplyProtagonistFeature_Horse(context);
				break;
			case 15:
				this.OfflineApplyProtagonistFeature_CricketJar(context);
				break;
			case 16:
				this.OfflineApplyProtagonistFeature_PoisonMaterials(context);
				break;
			case 17:
				this.OfflineApplyProtagonistFeature_Medicines(context);
				break;
			case 18:
				this.OfflineApplyProtagonistFeature_Accessory(context);
				break;
			case 19:
				DomainManager.Taiwu.SetProsperousConstruction(true, context);
				break;
			case 20:
				this.OfflineApplyProtagonistFeature_Literature(random);
				break;
			case 21:
				this.OfflineApplyProtagonistFeature_Religion(random);
				break;
			case 22:
				this.OfflineApplyProtagonistFeature_WitchDoctor(random);
				break;
			case 23:
				this.OfflineApplyProtagonistFeature_Artisan(random);
				break;
			case 24:
				status.AddFeatureLifeSkillLearning = true;
				break;
			case 25:
				status.AddFeatureCombatSkillLearning = true;
				break;
			case 26:
				this.OfflineApplyProtagonistFeature_CraftMaterials(context);
				break;
			case 27:
				this.OfflineApplyProtagonistFeature_CraftTools(context);
				break;
			case 28:
				this.OfflineApplyProtagonistFeature_MartialArtist(random);
				break;
			case 29:
				this.OfflineApplyProtagonistFeature_SkillBooks(context, info, status);
				break;
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported ProtagonistFeatureId: ");
				defaultInterpolatedStringHandler.AppendFormatted<short>(protagonistFeatureId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
		}

		// Token: 0x06006FF9 RID: 28665 RVA: 0x003FD4B4 File Offset: 0x003FB6B4
		private unsafe void OfflineApplyProtagonistFeature_MainAttribute(IRandomSource random, sbyte mainAttributeType)
		{
			short newValue = (short)(70 + random.Next(11));
			bool flag = newValue > *(ref this._baseMainAttributes.Items.FixedElementField + (IntPtr)mainAttributeType * 2);
			if (flag)
			{
				*(ref this._baseMainAttributes.Items.FixedElementField + (IntPtr)mainAttributeType * 2) = newValue;
			}
		}

		// Token: 0x06006FFA RID: 28666 RVA: 0x003FD504 File Offset: 0x003FB704
		private unsafe void OfflineApplyProtagonistFeature_MaterialResources()
		{
			for (int i = 0; i < 6; i++)
			{
				*(ref this._resources.Items.FixedElementField + (IntPtr)i * 4) += 1000;
			}
		}

		// Token: 0x06006FFB RID: 28667 RVA: 0x003FD540 File Offset: 0x003FB740
		private void OfflineApplyProtagonistFeature_Clothing(DataContext context)
		{
			ItemKey itemKey = DomainManager.Item.CreateClothing(context, 4, this._gender);
			this._inventory.OfflineAdd(itemKey, 1);
			itemKey = DomainManager.Item.CreateClothing(context, 13, this._gender);
			this._inventory.OfflineAdd(itemKey, 1);
		}

		// Token: 0x06006FFC RID: 28668 RVA: 0x003FD594 File Offset: 0x003FB794
		private void OfflineApplyProtagonistFeature_Wines(DataContext context)
		{
			IRandomSource random = context.Random;
			ItemKey itemKey = DomainManager.Item.CreateItem(context, 9, 3);
			int amount = 1 + random.Next(2);
			this._inventory.OfflineAdd(itemKey, amount);
			amount = random.Next(2);
			bool flag = amount > 0;
			if (flag)
			{
				itemKey = DomainManager.Item.CreateItem(context, 9, 4);
				this._inventory.OfflineAdd(itemKey, amount);
			}
			itemKey = DomainManager.Item.CreateItem(context, 9, 12);
			amount = 1 + random.Next(2);
			this._inventory.OfflineAdd(itemKey, amount);
			amount = random.Next(2);
			bool flag2 = amount > 0;
			if (flag2)
			{
				itemKey = DomainManager.Item.CreateItem(context, 9, 13);
				this._inventory.OfflineAdd(itemKey, amount);
			}
		}

		// Token: 0x06006FFD RID: 28669 RVA: 0x003FD65C File Offset: 0x003FB85C
		private void OfflineApplyProtagonistFeature_Horse(DataContext context)
		{
			ItemKey itemKey = DomainManager.Item.CreateCarrier(context, 22);
			this._inventory.OfflineAdd(itemKey, 1);
		}

		// Token: 0x06006FFE RID: 28670 RVA: 0x003FD688 File Offset: 0x003FB888
		private void OfflineApplyProtagonistFeature_CricketJar(DataContext context)
		{
			ItemKey itemKey = DomainManager.Item.CreateMisc(context, 87);
			this._inventory.OfflineAdd(itemKey, 1);
		}

		// Token: 0x06006FFF RID: 28671 RVA: 0x003FD6B4 File Offset: 0x003FB8B4
		private void OfflineApplyProtagonistFeature_PoisonMaterials(DataContext context)
		{
			IRandomSource random = context.Random;
			int definitelyObtainableItemIndex = random.Next(6);
			int amount = random.Next((definitelyObtainableItemIndex == 0) ? 1 : 0, 3);
			bool flag = amount > 0;
			if (flag)
			{
				ItemKey itemKey = DomainManager.Item.CreateMaterial(context, 240);
				this._inventory.OfflineAdd(itemKey, amount);
			}
			amount = random.Next((definitelyObtainableItemIndex == 1) ? 1 : 0, 3);
			bool flag2 = amount > 0;
			if (flag2)
			{
				ItemKey itemKey2 = DomainManager.Item.CreateMaterial(context, 247);
				this._inventory.OfflineAdd(itemKey2, amount);
			}
			amount = random.Next((definitelyObtainableItemIndex == 2) ? 1 : 0, 3);
			bool flag3 = amount > 0;
			if (flag3)
			{
				ItemKey itemKey3 = DomainManager.Item.CreateMaterial(context, 254);
				this._inventory.OfflineAdd(itemKey3, amount);
			}
			amount = random.Next((definitelyObtainableItemIndex == 3) ? 1 : 0, 3);
			bool flag4 = amount > 0;
			if (flag4)
			{
				ItemKey itemKey4 = DomainManager.Item.CreateMaterial(context, 261);
				this._inventory.OfflineAdd(itemKey4, amount);
			}
			amount = random.Next((definitelyObtainableItemIndex == 4) ? 1 : 0, 3);
			bool flag5 = amount > 0;
			if (flag5)
			{
				ItemKey itemKey5 = DomainManager.Item.CreateMaterial(context, 268);
				this._inventory.OfflineAdd(itemKey5, amount);
			}
			amount = random.Next((definitelyObtainableItemIndex == 5) ? 1 : 0, 3);
			bool flag6 = amount > 0;
			if (flag6)
			{
				ItemKey itemKey6 = DomainManager.Item.CreateMaterial(context, 275);
				this._inventory.OfflineAdd(itemKey6, amount);
			}
		}

		// Token: 0x06007000 RID: 28672 RVA: 0x003FD83C File Offset: 0x003FBA3C
		private void OfflineApplyProtagonistFeature_Medicines(DataContext context)
		{
			ItemKey itemKey = DomainManager.Item.CreateItem(context, 8, 59);
			this._inventory.OfflineAdd(itemKey, 1);
			itemKey = DomainManager.Item.CreateItem(context, 8, 71);
			this._inventory.OfflineAdd(itemKey, 1);
			itemKey = DomainManager.Item.CreateItem(context, 8, 87);
			this._inventory.OfflineAdd(itemKey, 1);
			itemKey = DomainManager.Item.CreateItem(context, 8, 99);
			this._inventory.OfflineAdd(itemKey, 1);
		}

		// Token: 0x06007001 RID: 28673 RVA: 0x003FD8C0 File Offset: 0x003FBAC0
		private void OfflineApplyProtagonistFeature_Accessory(DataContext context)
		{
			short templateId = (short)context.Random.Next(225, 250);
			ItemKey itemKey = DomainManager.Item.CreateAccessory(context, templateId, 1);
			this._inventory.OfflineAdd(itemKey, 1);
		}

		// Token: 0x06007002 RID: 28674 RVA: 0x003FD904 File Offset: 0x003FBB04
		private unsafe void OfflineApplyProtagonistFeature_Literature(IRandomSource random)
		{
			IntPtr intPtr = stackalloc byte[(UIntPtr)4];
			cpblk(intPtr, ref <PrivateImplementationDetails>.054EDEC1D0211F624FED0CBCA9D4F9400B0E491C43742AF2C5B0ABEBF0C990D8, 4);
			sbyte* pLifeSkillTypes = intPtr;
			this.OfflineBuffLifeSkills(random, pLifeSkillTypes, 4);
		}

		// Token: 0x06007003 RID: 28675 RVA: 0x003FD930 File Offset: 0x003FBB30
		private unsafe void OfflineApplyProtagonistFeature_Religion(IRandomSource random)
		{
			IntPtr intPtr = stackalloc byte[(UIntPtr)4];
			cpblk(intPtr, ref <PrivateImplementationDetails>.35D66ACDC568ED938D9735BE1E6ED61A84D7AD664BADD24B6C19BD034E73568B, 4);
			sbyte* pLifeSkillTypes = intPtr;
			this.OfflineBuffLifeSkills(random, pLifeSkillTypes, 4);
		}

		// Token: 0x06007004 RID: 28676 RVA: 0x003FD95C File Offset: 0x003FBB5C
		private unsafe void OfflineApplyProtagonistFeature_WitchDoctor(IRandomSource random)
		{
			IntPtr intPtr = stackalloc byte[(UIntPtr)4];
			cpblk(intPtr, ref <PrivateImplementationDetails>.2B3068CCF7A89BDC2AF0D1164F058E4A9856F0749AAA7486F3B0AE74CEA15EE1, 4);
			sbyte* pLifeSkillTypes = intPtr;
			this.OfflineBuffLifeSkills(random, pLifeSkillTypes, 4);
		}

		// Token: 0x06007005 RID: 28677 RVA: 0x003FD988 File Offset: 0x003FBB88
		private unsafe void OfflineApplyProtagonistFeature_Artisan(IRandomSource random)
		{
			IntPtr intPtr = stackalloc byte[(UIntPtr)4];
			cpblk(intPtr, ref <PrivateImplementationDetails>.9DF8B22A69A64CAF3441415379C5757BAD303A7443DE783AA897D0B2F352E6F9, 4);
			sbyte* pLifeSkillTypes = intPtr;
			this.OfflineBuffLifeSkills(random, pLifeSkillTypes, 4);
		}

		// Token: 0x06007006 RID: 28678 RVA: 0x003FD9B4 File Offset: 0x003FBBB4
		private unsafe void OfflineBuffLifeSkills(IRandomSource random, sbyte* pLifeSkillTypes, int count)
		{
			CollectionUtils.Shuffle<sbyte>(random, pLifeSkillTypes, count);
			ref LifeSkillShorts qualifications = ref this.GetBaseLifeSkillQualifications();
			for (int i = 0; i < count; i++)
			{
				sbyte lifeSkillType = pLifeSkillTypes[i];
				short value = (short)(70 + i * 5 + random.Next(11));
				bool flag = value > *(ref qualifications.Items.FixedElementField + (IntPtr)lifeSkillType * 2);
				if (flag)
				{
					*(ref qualifications.Items.FixedElementField + (IntPtr)lifeSkillType * 2) = value;
				}
			}
		}

		// Token: 0x06007007 RID: 28679 RVA: 0x003FDA28 File Offset: 0x003FBC28
		private void OfflineApplyProtagonistFeature_CraftMaterials(DataContext context)
		{
			IRandomSource random = context.Random;
			ItemKey itemKey = DomainManager.Item.CreateItem(context, 5, 5);
			int amount = 1 + random.Next(2);
			this._inventory.OfflineAdd(itemKey, amount);
			itemKey = DomainManager.Item.CreateItem(context, 5, 12);
			amount = 1 + random.Next(2);
			this._inventory.OfflineAdd(itemKey, amount);
			itemKey = DomainManager.Item.CreateItem(context, 5, 19);
			amount = 1 + random.Next(2);
			this._inventory.OfflineAdd(itemKey, amount);
			itemKey = DomainManager.Item.CreateItem(context, 5, 26);
			amount = 1 + random.Next(2);
			this._inventory.OfflineAdd(itemKey, amount);
			itemKey = DomainManager.Item.CreateItem(context, 5, 33);
			amount = 1 + random.Next(2);
			this._inventory.OfflineAdd(itemKey, amount);
			itemKey = DomainManager.Item.CreateItem(context, 5, 40);
			amount = 1 + random.Next(2);
			this._inventory.OfflineAdd(itemKey, amount);
			itemKey = DomainManager.Item.CreateItem(context, 5, 47);
			amount = 1 + random.Next(2);
			this._inventory.OfflineAdd(itemKey, amount);
			itemKey = DomainManager.Item.CreateItem(context, 5, 54);
			amount = 1 + random.Next(2);
			this._inventory.OfflineAdd(itemKey, amount);
		}

		// Token: 0x06007008 RID: 28680 RVA: 0x003FDB74 File Offset: 0x003FBD74
		private unsafe void OfflineApplyProtagonistFeature_CraftTools(DataContext context)
		{
			IRandomSource random = context.Random;
			IntPtr intPtr = stackalloc byte[(UIntPtr)12];
			*intPtr = 5;
			*(intPtr + 2) = 14;
			*(intPtr + (IntPtr)2 * 2) = 23;
			*(intPtr + (IntPtr)3 * 2) = 32;
			*(intPtr + (IntPtr)4 * 2) = 41;
			*(intPtr + (IntPtr)5 * 2) = 50;
			short* pCraftToolIds = intPtr;
			IntPtr intPtr2 = stackalloc byte[(UIntPtr)12];
			*intPtr2 = 2;
			*(intPtr2 + 2) = 16;
			*(intPtr2 + (IntPtr)2 * 2) = 30;
			*(intPtr2 + (IntPtr)3 * 2) = 44;
			*(intPtr2 + (IntPtr)4 * 2) = 79;
			*(intPtr2 + (IntPtr)5 * 2) = 142;
			short* pMaterialIds = intPtr2;
			pCraftToolIds = CollectionUtils.Shuffle<short>(random, pCraftToolIds, 6, 3);
			pMaterialIds = CollectionUtils.Shuffle<short>(random, pMaterialIds, 6, 3);
			for (int i = 0; i < 3; i++)
			{
				ItemKey tool = DomainManager.Item.CreateItem(context, 6, pCraftToolIds[i]);
				ItemKey material = DomainManager.Item.CreateItem(context, 5, pMaterialIds[i]);
				this._inventory.OfflineAdd(tool, 1);
				this._inventory.OfflineAdd(material, 1);
			}
		}

		// Token: 0x06007009 RID: 28681 RVA: 0x003FDC64 File Offset: 0x003FBE64
		private unsafe void OfflineApplyProtagonistFeature_MartialArtist(IRandomSource random)
		{
			this._baseCombatSkillQualifications.Items.FixedElementField = (short)(90 + random.Next(11));
			*(ref this._baseCombatSkillQualifications.Items.FixedElementField + 2) = (short)(90 + random.Next(11));
			*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)2 * 2) = (short)(90 + random.Next(11));
		}

		// Token: 0x0600700A RID: 28682 RVA: 0x003FDCD0 File Offset: 0x003FBED0
		private unsafe void OfflineApplyProtagonistFeature_SkillBooks(DataContext context, ProtagonistCreationInfo info, Character.ProtagonistFeatureRelatedStatus status)
		{
			IRandomSource random = context.Random;
			short lifeSkillBookId = Character.ProtagonistLifeSkillBookIds[random.Next(Character.ProtagonistLifeSkillBookIds.Length)];
			ItemKey itemKey = DomainManager.Item.CreateSkillBook(context, lifeSkillBookId, 5, 0, -1, 50, true);
			this._inventory.OfflineAdd(itemKey, 1);
			short lifeSkillTemplateId = ItemTemplateHelper.GetLifeSkillTemplateIdFromSkillBook((int)lifeSkillBookId);
			LifeSkillItem lifeSkillConfig = LifeSkill.Instance[lifeSkillTemplateId];
			LifeSkillItem lifeSkill = new LifeSkillItem(lifeSkillTemplateId);
			this._learnedLifeSkills.Add(lifeSkill);
			status.ReadLifeSkillTemplateId = lifeSkillTemplateId;
			int lifeSkillQualificationValue = 90 + random.Next(10);
			bool flag = (int)(*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)lifeSkillConfig.Type * 2)) < lifeSkillQualificationValue;
			if (flag)
			{
				*(ref this._baseLifeSkillQualifications.Items.FixedElementField + (IntPtr)lifeSkillConfig.Type * 2) = (short)lifeSkillQualificationValue;
			}
			sbyte orgTemplateId = MapDomain.GetSectOrgTemplateIdByStateTemplateId(info.TaiwuVillageStateTemplateId);
			sbyte largeSectIndex = OrganizationDomain.GetLargeSectIndex(orgTemplateId);
			short[] combatSkillBookIds = Character.ProtagonistCombatSkillBookIds[(int)largeSectIndex];
			short combatSkillBookId = combatSkillBookIds[random.Next(combatSkillBookIds.Length)];
			itemKey = DomainManager.Item.CreateSkillBook(context, combatSkillBookId, 5, 0, -1, 50, true);
			this._inventory.OfflineAdd(itemKey, 1);
			short combatSkillTemplateId = ItemTemplateHelper.GetCombatSkillTemplateIdFromSkillBook((int)combatSkillBookId);
			CombatSkillItem combatSkillConfig = Config.CombatSkill.Instance[combatSkillTemplateId];
			GameData.Domains.CombatSkill.CombatSkill combatSkill = new GameData.Domains.CombatSkill.CombatSkill(-1, combatSkillTemplateId, 0);
			status.CombatSkills.Add(combatSkill);
			this._learnedCombatSkills.Add(combatSkillTemplateId);
			status.ReadCombatSkillTemplateId = combatSkillTemplateId;
			GameData.Domains.Item.SkillBook item = DomainManager.Item.GetElement_SkillBooks(itemKey.Id);
			status.CombatSkillBookPageTypes = item.GetPageTypes();
			int combatSkillQualificationValue = 90 + random.Next(10);
			bool flag2 = (int)(*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)combatSkillConfig.Type * 2)) < combatSkillQualificationValue;
			if (flag2)
			{
				*(ref this._baseCombatSkillQualifications.Items.FixedElementField + (IntPtr)combatSkillConfig.Type * 2) = (short)combatSkillQualificationValue;
			}
		}

		// Token: 0x0600700B RID: 28683 RVA: 0x003FDEA8 File Offset: 0x003FC0A8
		ValueInfo IValueSelector.SelectValue(Evaluator evaluator, string identifier)
		{
			if (!true)
			{
			}
			ValueInfo result;
			if (!(identifier == "MapBlock"))
			{
				result = ValueInfo.Void;
			}
			else
			{
				result = evaluator.PushEvaluationResult(DomainManager.Map.GetBlock(this.GetValidLocation()));
			}
			if (!true)
			{
			}
			return result;
		}

		// Token: 0x0600700C RID: 28684 RVA: 0x003FDEF4 File Offset: 0x003FC0F4
		// Note: this type is marked as 'beforefieldinit'.
		static Character()
		{
			EHealActionType[] array = new EHealActionType[4];
			RuntimeHelpers.InitializeArray(array, fieldof(<PrivateImplementationDetails>.BAED642339816AFFB3FE8719792D0E4CE82F12DB72B7373D244EAA65445800FE).FieldHandle);
			Character.AllHealActions = array;
			Character.ProtagonistInitialItems = new ValueTuple<TemplateKey, int>[]
			{
				new ValueTuple<TemplateKey, int>(new TemplateKey(8, 54), 3),
				new ValueTuple<TemplateKey, int>(new TemplateKey(8, 60), 2),
				new ValueTuple<TemplateKey, int>(new TemplateKey(8, 58), 1),
				new ValueTuple<TemplateKey, int>(new TemplateKey(8, 66), 3),
				new ValueTuple<TemplateKey, int>(new TemplateKey(8, 72), 2),
				new ValueTuple<TemplateKey, int>(new TemplateKey(8, 70), 1),
				new ValueTuple<TemplateKey, int>(new TemplateKey(8, 88), 3),
				new ValueTuple<TemplateKey, int>(new TemplateKey(8, 94), 3),
				new ValueTuple<TemplateKey, int>(new TemplateKey(6, 0), 1)
			};
			Character.LovingAndHatingSectsCandidates = new sbyte[][]
			{
				new sbyte[]
				{
					5,
					8,
					14
				},
				new sbyte[]
				{
					1,
					2,
					3,
					5,
					8
				},
				new sbyte[]
				{
					1,
					2,
					3,
					4,
					6,
					7,
					9,
					12,
					13
				},
				new sbyte[]
				{
					6,
					10,
					11,
					12,
					13,
					15
				},
				new sbyte[]
				{
					10,
					11,
					15
				}
			};
			Character.ProtagonistLifeSkillBookIds = new short[]
			{
				6,
				15,
				24,
				33,
				42,
				51,
				60,
				69,
				78,
				87,
				96,
				105,
				114,
				123,
				132,
				141
			};
			Character.ProtagonistCombatSkillBookIds = new short[][]
			{
				new short[]
				{
					351,
					471,
					773
				},
				new short[]
				{
					360,
					479,
					556,
					675
				},
				new short[]
				{
					369,
					564
				},
				new short[]
				{
					378,
					486,
					682
				},
				new short[]
				{
					386,
					619,
					691,
					731
				},
				new short[]
				{
					495,
					739,
					782
				},
				new short[]
				{
					399,
					573,
					699
				},
				new short[]
				{
					407,
					504,
					580
				},
				new short[]
				{
					414,
					708,
					748,
					790
				},
				new short[]
				{
					421,
					628
				},
				new short[]
				{
					430,
					517,
					756
				},
				new short[]
				{
					438,
					525,
					594,
					716
				},
				new short[]
				{
					603,
					653,
					723
				},
				new short[]
				{
					454,
					533,
					765
				},
				new short[]
				{
					542,
					612,
					636
				}
			};
		}

		// Token: 0x0600700D RID: 28685 RVA: 0x003FE434 File Offset: 0x003FC634
		[CompilerGenerated]
		internal static sbyte <GetMaxGradeItemToLose>g__AddItemToLose|505_0(ItemKey itemKey, sbyte currMaxGrade, List<ItemKey> itemsToLose)
		{
			sbyte grade = ItemTemplateHelper.GetGrade(itemKey.ItemType, itemKey.TemplateId);
			bool flag = grade < currMaxGrade;
			sbyte result;
			if (flag)
			{
				result = currMaxGrade;
			}
			else
			{
				bool flag2 = grade > currMaxGrade;
				if (flag2)
				{
					currMaxGrade = grade;
					itemsToLose.Clear();
				}
				itemsToLose.Add(itemKey);
				result = currMaxGrade;
			}
			return result;
		}

		// Token: 0x0600700E RID: 28686 RVA: 0x003FE484 File Offset: 0x003FC684
		[CompilerGenerated]
		internal static int <OfflineFeedAnimalCarrier>g__GetNeedTamePoint|587_0(ItemKey itemKey)
		{
			bool flag = !ItemTemplateHelper.HasCarrierTame(itemKey.ItemType, itemKey.TemplateId);
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				int tamePoint = DomainManager.Extra.GetCarrierTamePoint(itemKey.Id);
				bool flag2 = tamePoint < 0;
				if (flag2)
				{
					result = 0;
				}
				else
				{
					int maxTamePoint = DomainManager.Extra.GetCarrierMaxTamePoint(itemKey.Id);
					bool flag3 = tamePoint >= maxTamePoint;
					if (flag3)
					{
						result = 0;
					}
					else
					{
						result = maxTamePoint - tamePoint;
					}
				}
			}
			return result;
		}

		// Token: 0x0600700F RID: 28687 RVA: 0x003FE4F8 File Offset: 0x003FC6F8
		[CompilerGenerated]
		internal static int <OfflineFeedAnimalCarrier>g__GetFeedTamePoint|587_1(ItemKey carrierKey, ItemKey foodKey)
		{
			bool flag = !ItemTemplateHelper.IsFeedingAble(foodKey.ItemType, foodKey.TemplateId);
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				result = GameData.Domains.Extra.SharedMethods.GetFoodAddCarrierTamePoint(carrierKey.TemplateId, foodKey.TemplateId, 1);
			}
			return result;
		}

		// Token: 0x06007013 RID: 28691 RVA: 0x003FE740 File Offset: 0x003FC940
		[CompilerGenerated]
		private bool <OfflineCalcGeneralAction_TeachSkill>g__IsValidTargetForTeachSkill|677_0(Character character)
		{
			return this.CanTeachCombatSkill(character) || this.CanTeachLifeSkill(character);
		}

		// Token: 0x06007014 RID: 28692 RVA: 0x003FE758 File Offset: 0x003FC958
		[CompilerGenerated]
		internal static int <OfflineCalcGeneralAction_Crafting>g__GetMakeItemRequiredResourceWorth|691_0(MaterialItem materialCfg, MakeItemSubTypeItem makeItemSubTypeCfg)
		{
			return (int)((short)GlobalConfig.ResourcesWorth[(int)materialCfg.ResourceType] * makeItemSubTypeCfg.ResourceTotalCount * materialCfg.RequiredResourceAmount);
		}

		// Token: 0x04001DBF RID: 7615
		[CollectionObjectField(false, true, false, true, false)]
		private int _id;

		// Token: 0x04001DC0 RID: 7616
		[CollectionObjectField(true, true, false, true, false)]
		private short _templateId;

		// Token: 0x04001DC1 RID: 7617
		[CollectionObjectField(true, true, false, true, false)]
		private byte _creatingType;

		// Token: 0x04001DC2 RID: 7618
		[CollectionObjectField(true, true, false, true, false)]
		private sbyte _gender;

		// Token: 0x04001DC3 RID: 7619
		[CollectionObjectField(true, true, false, false, false)]
		private short _actualAge;

		// Token: 0x04001DC4 RID: 7620
		[CollectionObjectField(true, true, false, true, false)]
		private sbyte _birthMonth;

		// Token: 0x04001DC5 RID: 7621
		[CollectionObjectField(true, true, false, false, false)]
		private sbyte _happiness;

		// Token: 0x04001DC6 RID: 7622
		[CollectionObjectField(true, true, false, false, false)]
		private short _baseMorality;

		// Token: 0x04001DC7 RID: 7623
		[CollectionObjectField(true, true, false, false, false)]
		private OrganizationInfo _organizationInfo;

		// Token: 0x04001DC8 RID: 7624
		[CollectionObjectField(true, true, false, false, false)]
		private sbyte _idealSect;

		// Token: 0x04001DC9 RID: 7625
		[CollectionObjectField(true, true, false, false, false)]
		private sbyte _lifeSkillTypeInterest;

		// Token: 0x04001DCA RID: 7626
		[CollectionObjectField(true, true, false, false, false)]
		private sbyte _combatSkillTypeInterest;

		// Token: 0x04001DCB RID: 7627
		[CollectionObjectField(true, true, false, false, false)]
		private sbyte _mainAttributeInterest;

		// Token: 0x04001DCC RID: 7628
		[CollectionObjectField(true, true, false, true, false)]
		private bool _transgender;

		// Token: 0x04001DCD RID: 7629
		[CollectionObjectField(true, true, false, true, false)]
		private bool _bisexual;

		// Token: 0x04001DCE RID: 7630
		[CollectionObjectField(true, true, false, true, false)]
		private sbyte _xiangshuType;

		// Token: 0x04001DCF RID: 7631
		[CollectionObjectField(true, true, false, false, false)]
		private byte _monkType;

		// Token: 0x04001DD0 RID: 7632
		[CollectionObjectField(true, true, false, false, false)]
		private List<short> _featureIds;

		// Token: 0x04001DD1 RID: 7633
		[CollectionObjectField(true, true, false, false, false)]
		private MainAttributes _baseMainAttributes;

		// Token: 0x04001DD2 RID: 7634
		[CollectionObjectField(true, true, false, false, false)]
		private short _health;

		// Token: 0x04001DD3 RID: 7635
		[CollectionObjectField(true, true, false, false, false)]
		private short _baseMaxHealth;

		// Token: 0x04001DD4 RID: 7636
		[CollectionObjectField(true, true, false, false, false)]
		private short _disorderOfQi;

		// Token: 0x04001DD5 RID: 7637
		[CollectionObjectField(true, true, false, false, false)]
		private bool _haveLeftArm;

		// Token: 0x04001DD6 RID: 7638
		[CollectionObjectField(true, true, false, false, false)]
		private bool _haveRightArm;

		// Token: 0x04001DD7 RID: 7639
		[CollectionObjectField(true, true, false, false, false)]
		private bool _haveLeftLeg;

		// Token: 0x04001DD8 RID: 7640
		[CollectionObjectField(true, true, false, false, false)]
		private bool _haveRightLeg;

		// Token: 0x04001DD9 RID: 7641
		[CollectionObjectField(true, true, false, false, false)]
		private Injuries _injuries;

		// Token: 0x04001DDA RID: 7642
		[CollectionObjectField(true, true, false, false, false)]
		private int _extraNeili;

		// Token: 0x04001DDB RID: 7643
		[CollectionObjectField(true, true, false, false, false)]
		private sbyte _consummateLevel;

		// Token: 0x04001DDC RID: 7644
		[CollectionObjectField(true, true, false, false, false)]
		private List<LifeSkillItem> _learnedLifeSkills;

		// Token: 0x04001DDD RID: 7645
		[CollectionObjectField(true, true, false, false, false)]
		private LifeSkillShorts _baseLifeSkillQualifications;

		// Token: 0x04001DDE RID: 7646
		[CollectionObjectField(true, true, false, false, false)]
		private sbyte _lifeSkillQualificationGrowthType;

		// Token: 0x04001DDF RID: 7647
		[CollectionObjectField(true, true, false, false, false)]
		private CombatSkillShorts _baseCombatSkillQualifications;

		// Token: 0x04001DE0 RID: 7648
		[CollectionObjectField(true, true, false, false, false)]
		private sbyte _combatSkillQualificationGrowthType;

		// Token: 0x04001DE1 RID: 7649
		[CollectionObjectField(true, true, false, false, false)]
		private ResourceInts _resources;

		// Token: 0x04001DE2 RID: 7650
		[CollectionObjectField(true, true, false, false, false)]
		private short _lovingItemSubType;

		// Token: 0x04001DE3 RID: 7651
		[CollectionObjectField(true, true, false, false, false)]
		private short _hatingItemSubType;

		// Token: 0x04001DE4 RID: 7652
		[CollectionObjectField(false, true, false, false, false)]
		private FullName _fullName;

		// Token: 0x04001DE5 RID: 7653
		[CollectionObjectField(false, true, false, false, false)]
		private MonasticTitle _monasticTitle;

		// Token: 0x04001DE6 RID: 7654
		[CollectionObjectField(false, true, false, false, false)]
		private AvatarData _avatar;

		// Token: 0x04001DE7 RID: 7655
		[CollectionObjectField(false, true, false, false, false)]
		private List<short> _potentialFeatureIds;

		// Token: 0x04001DE8 RID: 7656
		[CollectionObjectField(false, true, false, false, false)]
		private List<FameActionRecord> _fameActionRecords;

		// Token: 0x04001DE9 RID: 7657
		[CollectionObjectField(false, true, false, true, false)]
		private Genome _genome;

		// Token: 0x04001DEA RID: 7658
		[CollectionObjectField(false, true, false, false, false)]
		private MainAttributes _currMainAttributes;

		// Token: 0x04001DEB RID: 7659
		[CollectionObjectField(false, true, false, false, false)]
		private PoisonInts _poisoned;

		// Token: 0x04001DEC RID: 7660
		[CollectionObjectField(false, true, false, false, false, ArrayElementsCount = 14)]
		private byte[] _injuriesRecoveryProgress;

		// Token: 0x04001DED RID: 7661
		[CollectionObjectField(false, true, false, false, false)]
		private int _currNeili;

		// Token: 0x04001DEE RID: 7662
		[CollectionObjectField(false, true, false, false, false)]
		private short _loopingNeigong;

		// Token: 0x04001DEF RID: 7663
		[CollectionObjectField(false, true, false, false, false)]
		private NeiliAllocation _baseNeiliAllocation;

		// Token: 0x04001DF0 RID: 7664
		[CollectionObjectField(false, true, false, false, false)]
		private NeiliAllocation _extraNeiliAllocation;

		// Token: 0x04001DF1 RID: 7665
		[CollectionObjectField(false, true, false, false, false)]
		private NeiliProportionOfFiveElements _baseNeiliProportionOfFiveElements;

		// Token: 0x04001DF2 RID: 7666
		[CollectionObjectField(false, true, false, false, false)]
		private int _hobbyExpirationDate;

		// Token: 0x04001DF3 RID: 7667
		[CollectionObjectField(false, true, false, false, false)]
		private bool _lovingItemRevealed;

		// Token: 0x04001DF4 RID: 7668
		[CollectionObjectField(false, true, false, false, false)]
		private bool _hatingItemRevealed;

		// Token: 0x04001DF5 RID: 7669
		[CollectionObjectField(false, true, false, false, false)]
		private sbyte _legitimateBoysCount;

		// Token: 0x04001DF6 RID: 7670
		[CollectionObjectField(false, true, false, true, false)]
		private Location _birthLocation;

		// Token: 0x04001DF7 RID: 7671
		[CollectionObjectField(false, true, false, false, false)]
		private Location _location;

		// Token: 0x04001DF8 RID: 7672
		[CollectionObjectField(false, true, false, false, false, ArrayElementsCount = 12)]
		private ItemKey[] _equipment;

		// Token: 0x04001DF9 RID: 7673
		[CollectionObjectField(false, true, false, false, false)]
		private Inventory _inventory;

		// Token: 0x04001DFA RID: 7674
		[CollectionObjectField(false, true, false, false, false)]
		private EatingItems _eatingItems;

		// Token: 0x04001DFB RID: 7675
		[CollectionObjectField(false, true, false, false, false)]
		private List<short> _learnedCombatSkills;

		// Token: 0x04001DFC RID: 7676
		[CollectionObjectField(false, true, false, false, false, ArrayElementsCount = 48)]
		private short[] _equippedCombatSkills;

		// Token: 0x04001DFD RID: 7677
		[CollectionObjectField(false, true, false, false, false, ArrayElementsCount = 126)]
		private short[] _combatSkillAttainmentPanels;

		// Token: 0x04001DFE RID: 7678
		[CollectionObjectField(false, true, false, false, false)]
		private List<SkillQualificationBonus> _skillQualificationBonuses;

		// Token: 0x04001DFF RID: 7679
		[CollectionObjectField(false, true, false, true, false)]
		private PreexistenceCharIds _preexistenceCharIds;

		// Token: 0x04001E00 RID: 7680
		[CollectionObjectField(false, true, false, false, false)]
		private byte _xiangshuInfection;

		// Token: 0x04001E01 RID: 7681
		[CollectionObjectField(false, true, false, false, false)]
		private short _currAge;

		// Token: 0x04001E02 RID: 7682
		[CollectionObjectField(false, true, false, false, false)]
		private int _exp;

		// Token: 0x04001E03 RID: 7683
		[CollectionObjectField(false, true, false, false, false)]
		private byte _externalRelationState;

		// Token: 0x04001E04 RID: 7684
		[CollectionObjectField(false, true, false, false, false)]
		private int _kidnapperId;

		// Token: 0x04001E05 RID: 7685
		[CollectionObjectField(false, true, false, false, false)]
		private int _leaderId;

		// Token: 0x04001E06 RID: 7686
		[CollectionObjectField(false, true, false, false, false)]
		private int _factionId;

		// Token: 0x04001E07 RID: 7687
		[CollectionObjectField(false, true, false, false, false)]
		private List<GameData.Domains.Character.Ai.PersonalNeed> _personalNeeds;

		// Token: 0x04001E08 RID: 7688
		[CollectionObjectField(false, true, false, false, false)]
		private ActionEnergySbytes _actionEnergies;

		// Token: 0x04001E09 RID: 7689
		[CollectionObjectField(false, true, false, false, false)]
		private List<NpcTravelTarget> _npcTravelTargets;

		// Token: 0x04001E0A RID: 7690
		[CollectionObjectField(false, true, false, false, false)]
		private PrioritizedActionCooldownSbytes _prioritizedActionCooldowns;

		// Token: 0x04001E0B RID: 7691
		[CollectionObjectField(false, false, true, false, false)]
		private short _physiologicalAge;

		// Token: 0x04001E0C RID: 7692
		[CollectionObjectField(false, false, true, false, false)]
		private sbyte _fame;

		// Token: 0x04001E0D RID: 7693
		[CollectionObjectField(false, false, true, false, false)]
		private short _morality;

		// Token: 0x04001E0E RID: 7694
		[CollectionObjectField(false, false, true, false, false)]
		private short _attraction;

		// Token: 0x04001E0F RID: 7695
		[CollectionObjectField(false, false, true, false, false)]
		private MainAttributes _maxMainAttributes;

		// Token: 0x04001E10 RID: 7696
		[CollectionObjectField(false, false, true, false, false)]
		private HitOrAvoidInts _hitValues;

		// Token: 0x04001E11 RID: 7697
		[CollectionObjectField(false, false, true, false, false)]
		private OuterAndInnerInts _penetrations;

		// Token: 0x04001E12 RID: 7698
		[CollectionObjectField(false, false, true, false, false)]
		private HitOrAvoidInts _avoidValues;

		// Token: 0x04001E13 RID: 7699
		[CollectionObjectField(false, false, true, false, false)]
		private OuterAndInnerInts _penetrationResists;

		// Token: 0x04001E14 RID: 7700
		[CollectionObjectField(false, false, true, false, false)]
		private OuterAndInnerShorts _recoveryOfStanceAndBreath;

		// Token: 0x04001E15 RID: 7701
		[CollectionObjectField(false, false, true, false, false)]
		private short _moveSpeed;

		// Token: 0x04001E16 RID: 7702
		[CollectionObjectField(false, false, true, false, false)]
		private short _recoveryOfFlaw;

		// Token: 0x04001E17 RID: 7703
		[CollectionObjectField(false, false, true, false, false)]
		private short _castSpeed;

		// Token: 0x04001E18 RID: 7704
		[CollectionObjectField(false, false, true, false, false)]
		private short _recoveryOfBlockedAcupoint;

		// Token: 0x04001E19 RID: 7705
		[CollectionObjectField(false, false, true, false, false)]
		private short _weaponSwitchSpeed;

		// Token: 0x04001E1A RID: 7706
		[CollectionObjectField(false, false, true, false, false)]
		private short _attackSpeed;

		// Token: 0x04001E1B RID: 7707
		[CollectionObjectField(false, false, true, false, false)]
		private short _innerRatio;

		// Token: 0x04001E1C RID: 7708
		[CollectionObjectField(false, false, true, false, false)]
		private short _recoveryOfQiDisorder;

		// Token: 0x04001E1D RID: 7709
		[CollectionObjectField(false, false, true, false, false)]
		private PoisonInts _poisonResists;

		// Token: 0x04001E1E RID: 7710
		[CollectionObjectField(false, false, true, false, false)]
		private short _maxHealth;

		// Token: 0x04001E1F RID: 7711
		[CollectionObjectField(false, false, true, false, false)]
		private short _fertility;

		// Token: 0x04001E20 RID: 7712
		[CollectionObjectField(false, false, true, false, false)]
		private LifeSkillShorts _lifeSkillQualifications;

		// Token: 0x04001E21 RID: 7713
		[CollectionObjectField(false, false, true, false, false)]
		private LifeSkillShorts _lifeSkillAttainments;

		// Token: 0x04001E22 RID: 7714
		[CollectionObjectField(false, false, true, false, false)]
		private CombatSkillShorts _combatSkillQualifications;

		// Token: 0x04001E23 RID: 7715
		[CollectionObjectField(false, false, true, false, false)]
		private CombatSkillShorts _combatSkillAttainments;

		// Token: 0x04001E24 RID: 7716
		[CollectionObjectField(false, false, true, false, false)]
		private Personalities _personalities;

		// Token: 0x04001E25 RID: 7717
		[CollectionObjectField(false, false, true, false, false)]
		private sbyte _hobbyChangingPeriod;

		// Token: 0x04001E26 RID: 7718
		[CollectionObjectField(false, false, true, false, false)]
		private OuterAndInnerShorts _favorabilityChangingFactor;

		// Token: 0x04001E27 RID: 7719
		[CollectionObjectField(false, false, true, false, false)]
		private int _maxInventoryLoad;

		// Token: 0x04001E28 RID: 7720
		[CollectionObjectField(false, false, true, false, false)]
		private int _currInventoryLoad;

		// Token: 0x04001E29 RID: 7721
		[CollectionObjectField(false, false, true, false, false)]
		private int _maxEquipmentLoad;

		// Token: 0x04001E2A RID: 7722
		[CollectionObjectField(false, false, true, false, false)]
		private int _currEquipmentLoad;

		// Token: 0x04001E2B RID: 7723
		[CollectionObjectField(false, false, true, false, false)]
		private int _inventoryTotalValue;

		// Token: 0x04001E2C RID: 7724
		[CollectionObjectField(false, false, true, false, false)]
		private int _maxNeili;

		// Token: 0x04001E2D RID: 7725
		[CollectionObjectField(false, false, true, false, false)]
		private NeiliAllocation _neiliAllocation;

		// Token: 0x04001E2E RID: 7726
		[CollectionObjectField(false, false, true, false, false)]
		private NeiliProportionOfFiveElements _neiliProportionOfFiveElements;

		// Token: 0x04001E2F RID: 7727
		[CollectionObjectField(false, false, true, false, false)]
		private sbyte _neiliType;

		// Token: 0x04001E30 RID: 7728
		[CollectionObjectField(false, false, true, false, false)]
		private int _combatPower;

		// Token: 0x04001E31 RID: 7729
		[CollectionObjectField(false, false, true, false, false)]
		private sbyte _attackTendencyOfInnerAndOuter;

		// Token: 0x04001E32 RID: 7730
		[CollectionObjectField(false, false, true, false, false)]
		private NeiliAllocation _allocatedNeiliEffects;

		// Token: 0x04001E33 RID: 7731
		[CollectionObjectField(false, false, true, false, false)]
		private sbyte _maxConsummateLevel;

		// Token: 0x04001E34 RID: 7732
		[CollectionObjectField(false, false, true, false, false)]
		private CombatSkillEquipment _combatSkillEquipment;

		// Token: 0x04001E35 RID: 7733
		[CollectionObjectField(false, false, true, false, false)]
		private uint _darkAshProtector;

		// Token: 0x04001E36 RID: 7734
		private const int BasePersonality = 10;

		// Token: 0x04001E37 RID: 7735
		private const int PreexistenceAttributeBonusDivisor = 10;

		// Token: 0x04001E38 RID: 7736
		private const int BaseFertility = 100;

		// Token: 0x04001E39 RID: 7737
		[TupleElementNames(new string[]
		{
			"min",
			"max"
		})]
		private static readonly List<ValueTuple<short, short>> RandomFavorabilityRanges = new List<ValueTuple<short, short>>
		{
			new ValueTuple<short, short>(-30000, -18000),
			new ValueTuple<short, short>(-17999, 0),
			new ValueTuple<short, short>(1, 17999),
			new ValueTuple<short, short>(18000, 30000)
		};

		// Token: 0x04001E3A RID: 7738
		public const int InnateSkillQualificationBonusesCount = 2;

		// Token: 0x04001E3B RID: 7739
		public const int AcquiredSkillQualificationBonusesMaxCount = 9;

		// Token: 0x04001E3C RID: 7740
		public static readonly List<ECharacterPropertyReferencedType> HitAvoidAttackDefendPropertyTypes = new List<ECharacterPropertyReferencedType>
		{
			ECharacterPropertyReferencedType.HitRateStrength,
			ECharacterPropertyReferencedType.HitRateTechnique,
			ECharacterPropertyReferencedType.HitRateSpeed,
			ECharacterPropertyReferencedType.HitRateMind,
			ECharacterPropertyReferencedType.AvoidRateStrength,
			ECharacterPropertyReferencedType.AvoidRateTechnique,
			ECharacterPropertyReferencedType.AvoidRateSpeed,
			ECharacterPropertyReferencedType.AvoidRateMind,
			ECharacterPropertyReferencedType.PenetrateOfOuter,
			ECharacterPropertyReferencedType.PenetrateOfInner,
			ECharacterPropertyReferencedType.PenetrateResistOfOuter,
			ECharacterPropertyReferencedType.PenetrateResistOfInner
		};

		// Token: 0x04001E3D RID: 7741
		public static readonly List<ECharacterPropertyReferencedType> CombatPropertyTypes = new List<ECharacterPropertyReferencedType>(Character.HitAvoidAttackDefendPropertyTypes)
		{
			ECharacterPropertyReferencedType.Strength,
			ECharacterPropertyReferencedType.Dexterity,
			ECharacterPropertyReferencedType.Concentration,
			ECharacterPropertyReferencedType.Vitality,
			ECharacterPropertyReferencedType.Energy,
			ECharacterPropertyReferencedType.Intelligence,
			ECharacterPropertyReferencedType.RecoveryOfStance,
			ECharacterPropertyReferencedType.RecoveryOfBreath,
			ECharacterPropertyReferencedType.RecoveryOfFlaw,
			ECharacterPropertyReferencedType.RecoveryOfBlockedAcupoint,
			ECharacterPropertyReferencedType.RecoveryOfQiDisorder,
			ECharacterPropertyReferencedType.MoveSpeed,
			ECharacterPropertyReferencedType.CastSpeed,
			ECharacterPropertyReferencedType.AttackSpeed,
			ECharacterPropertyReferencedType.WeaponSwitchSpeed,
			ECharacterPropertyReferencedType.InnerRatio
		};

		// Token: 0x04001E3E RID: 7742
		public static readonly List<ECharacterPropertyReferencedType> BonusPropertyTypes = new List<ECharacterPropertyReferencedType>(Character.CombatPropertyTypes)
		{
			ECharacterPropertyReferencedType.QualificationAppraisal,
			ECharacterPropertyReferencedType.QualificationBlade,
			ECharacterPropertyReferencedType.QualificationBuddhism,
			ECharacterPropertyReferencedType.QualificationChess,
			ECharacterPropertyReferencedType.QualificationCooking,
			ECharacterPropertyReferencedType.QualificationEclectic,
			ECharacterPropertyReferencedType.QualificationFinger,
			ECharacterPropertyReferencedType.QualificationForging,
			ECharacterPropertyReferencedType.QualificationJade,
			ECharacterPropertyReferencedType.QualificationLeg,
			ECharacterPropertyReferencedType.QualificationMath,
			ECharacterPropertyReferencedType.QualificationMedicine,
			ECharacterPropertyReferencedType.QualificationMusic,
			ECharacterPropertyReferencedType.QualificationNeigong,
			ECharacterPropertyReferencedType.QualificationPainting,
			ECharacterPropertyReferencedType.QualificationPoem,
			ECharacterPropertyReferencedType.QualificationPolearm,
			ECharacterPropertyReferencedType.QualificationPosing,
			ECharacterPropertyReferencedType.QualificationSpecial,
			ECharacterPropertyReferencedType.QualificationStunt,
			ECharacterPropertyReferencedType.QualificationSword,
			ECharacterPropertyReferencedType.QualificationTaoism,
			ECharacterPropertyReferencedType.QualificationThrow,
			ECharacterPropertyReferencedType.QualificationToxicology,
			ECharacterPropertyReferencedType.QualificationWeaving,
			ECharacterPropertyReferencedType.QualificationWhip,
			ECharacterPropertyReferencedType.QualificationWoodworking,
			ECharacterPropertyReferencedType.QualificationCombatMusic,
			ECharacterPropertyReferencedType.QualificationControllableShot,
			ECharacterPropertyReferencedType.QualificationFistAndPalm
		};

		// Token: 0x04001E3F RID: 7743
		public static readonly IReadOnlyList<EHealActionType> AllHealActions;

		// Token: 0x04001E40 RID: 7744
		private byte _advanceMonthStatus;

		// Token: 0x04001E41 RID: 7745
		private const sbyte SearchRandomDestinationMaxCount = 10;

		// Token: 0x04001E42 RID: 7746
		public const int FixedSize = 1040;

		// Token: 0x04001E43 RID: 7747
		public const int DynamicCount = 9;

		// Token: 0x04001E44 RID: 7748
		private SpinLock _spinLock = new SpinLock(false);

		// Token: 0x04001E45 RID: 7749
		private int _srcCharId = -1;

		// Token: 0x04001E46 RID: 7750
		[TupleElementNames(new string[]
		{
			"templateKey",
			"amount"
		})]
		private static readonly ValueTuple<TemplateKey, int>[] ProtagonistInitialItems;

		// Token: 0x04001E47 RID: 7751
		private static readonly sbyte[][] LovingAndHatingSectsCandidates;

		// Token: 0x04001E48 RID: 7752
		private readonly List<ItemKey> _itemsToBeDeleted = new List<ItemKey>();

		// Token: 0x04001E49 RID: 7753
		private static readonly short[] ProtagonistLifeSkillBookIds;

		// Token: 0x04001E4A RID: 7754
		private static readonly short[][] ProtagonistCombatSkillBookIds;

		// Token: 0x02000BBD RID: 3005
		internal class FixedFieldInfos
		{
			// Token: 0x04003294 RID: 12948
			public const uint Id_Offset = 0U;

			// Token: 0x04003295 RID: 12949
			public const int Id_Size = 4;

			// Token: 0x04003296 RID: 12950
			public const uint TemplateId_Offset = 4U;

			// Token: 0x04003297 RID: 12951
			public const int TemplateId_Size = 2;

			// Token: 0x04003298 RID: 12952
			public const uint CreatingType_Offset = 6U;

			// Token: 0x04003299 RID: 12953
			public const int CreatingType_Size = 1;

			// Token: 0x0400329A RID: 12954
			public const uint Gender_Offset = 7U;

			// Token: 0x0400329B RID: 12955
			public const int Gender_Size = 1;

			// Token: 0x0400329C RID: 12956
			public const uint ActualAge_Offset = 8U;

			// Token: 0x0400329D RID: 12957
			public const int ActualAge_Size = 2;

			// Token: 0x0400329E RID: 12958
			public const uint BirthMonth_Offset = 10U;

			// Token: 0x0400329F RID: 12959
			public const int BirthMonth_Size = 1;

			// Token: 0x040032A0 RID: 12960
			public const uint Happiness_Offset = 11U;

			// Token: 0x040032A1 RID: 12961
			public const int Happiness_Size = 1;

			// Token: 0x040032A2 RID: 12962
			public const uint BaseMorality_Offset = 12U;

			// Token: 0x040032A3 RID: 12963
			public const int BaseMorality_Size = 2;

			// Token: 0x040032A4 RID: 12964
			public const uint OrganizationInfo_Offset = 14U;

			// Token: 0x040032A5 RID: 12965
			public const int OrganizationInfo_Size = 8;

			// Token: 0x040032A6 RID: 12966
			public const uint IdealSect_Offset = 22U;

			// Token: 0x040032A7 RID: 12967
			public const int IdealSect_Size = 1;

			// Token: 0x040032A8 RID: 12968
			public const uint LifeSkillTypeInterest_Offset = 23U;

			// Token: 0x040032A9 RID: 12969
			public const int LifeSkillTypeInterest_Size = 1;

			// Token: 0x040032AA RID: 12970
			public const uint CombatSkillTypeInterest_Offset = 24U;

			// Token: 0x040032AB RID: 12971
			public const int CombatSkillTypeInterest_Size = 1;

			// Token: 0x040032AC RID: 12972
			public const uint MainAttributeInterest_Offset = 25U;

			// Token: 0x040032AD RID: 12973
			public const int MainAttributeInterest_Size = 1;

			// Token: 0x040032AE RID: 12974
			public const uint Transgender_Offset = 26U;

			// Token: 0x040032AF RID: 12975
			public const int Transgender_Size = 1;

			// Token: 0x040032B0 RID: 12976
			public const uint Bisexual_Offset = 27U;

			// Token: 0x040032B1 RID: 12977
			public const int Bisexual_Size = 1;

			// Token: 0x040032B2 RID: 12978
			public const uint XiangshuType_Offset = 28U;

			// Token: 0x040032B3 RID: 12979
			public const int XiangshuType_Size = 1;

			// Token: 0x040032B4 RID: 12980
			public const uint MonkType_Offset = 29U;

			// Token: 0x040032B5 RID: 12981
			public const int MonkType_Size = 1;

			// Token: 0x040032B6 RID: 12982
			public const uint BaseMainAttributes_Offset = 30U;

			// Token: 0x040032B7 RID: 12983
			public const int BaseMainAttributes_Size = 12;

			// Token: 0x040032B8 RID: 12984
			public const uint Health_Offset = 42U;

			// Token: 0x040032B9 RID: 12985
			public const int Health_Size = 2;

			// Token: 0x040032BA RID: 12986
			public const uint BaseMaxHealth_Offset = 44U;

			// Token: 0x040032BB RID: 12987
			public const int BaseMaxHealth_Size = 2;

			// Token: 0x040032BC RID: 12988
			public const uint DisorderOfQi_Offset = 46U;

			// Token: 0x040032BD RID: 12989
			public const int DisorderOfQi_Size = 2;

			// Token: 0x040032BE RID: 12990
			public const uint HaveLeftArm_Offset = 48U;

			// Token: 0x040032BF RID: 12991
			public const int HaveLeftArm_Size = 1;

			// Token: 0x040032C0 RID: 12992
			public const uint HaveRightArm_Offset = 49U;

			// Token: 0x040032C1 RID: 12993
			public const int HaveRightArm_Size = 1;

			// Token: 0x040032C2 RID: 12994
			public const uint HaveLeftLeg_Offset = 50U;

			// Token: 0x040032C3 RID: 12995
			public const int HaveLeftLeg_Size = 1;

			// Token: 0x040032C4 RID: 12996
			public const uint HaveRightLeg_Offset = 51U;

			// Token: 0x040032C5 RID: 12997
			public const int HaveRightLeg_Size = 1;

			// Token: 0x040032C6 RID: 12998
			public const uint Injuries_Offset = 52U;

			// Token: 0x040032C7 RID: 12999
			public const int Injuries_Size = 16;

			// Token: 0x040032C8 RID: 13000
			public const uint ExtraNeili_Offset = 68U;

			// Token: 0x040032C9 RID: 13001
			public const int ExtraNeili_Size = 4;

			// Token: 0x040032CA RID: 13002
			public const uint ConsummateLevel_Offset = 72U;

			// Token: 0x040032CB RID: 13003
			public const int ConsummateLevel_Size = 1;

			// Token: 0x040032CC RID: 13004
			public const uint BaseLifeSkillQualifications_Offset = 73U;

			// Token: 0x040032CD RID: 13005
			public const int BaseLifeSkillQualifications_Size = 32;

			// Token: 0x040032CE RID: 13006
			public const uint LifeSkillQualificationGrowthType_Offset = 105U;

			// Token: 0x040032CF RID: 13007
			public const int LifeSkillQualificationGrowthType_Size = 1;

			// Token: 0x040032D0 RID: 13008
			public const uint BaseCombatSkillQualifications_Offset = 106U;

			// Token: 0x040032D1 RID: 13009
			public const int BaseCombatSkillQualifications_Size = 28;

			// Token: 0x040032D2 RID: 13010
			public const uint CombatSkillQualificationGrowthType_Offset = 134U;

			// Token: 0x040032D3 RID: 13011
			public const int CombatSkillQualificationGrowthType_Size = 1;

			// Token: 0x040032D4 RID: 13012
			public const uint Resources_Offset = 135U;

			// Token: 0x040032D5 RID: 13013
			public const int Resources_Size = 32;

			// Token: 0x040032D6 RID: 13014
			public const uint LovingItemSubType_Offset = 167U;

			// Token: 0x040032D7 RID: 13015
			public const int LovingItemSubType_Size = 2;

			// Token: 0x040032D8 RID: 13016
			public const uint HatingItemSubType_Offset = 169U;

			// Token: 0x040032D9 RID: 13017
			public const int HatingItemSubType_Size = 2;

			// Token: 0x040032DA RID: 13018
			public const uint FullName_Offset = 171U;

			// Token: 0x040032DB RID: 13019
			public const int FullName_Size = 10;

			// Token: 0x040032DC RID: 13020
			public const uint MonasticTitle_Offset = 181U;

			// Token: 0x040032DD RID: 13021
			public const int MonasticTitle_Size = 4;

			// Token: 0x040032DE RID: 13022
			public const uint Avatar_Offset = 185U;

			// Token: 0x040032DF RID: 13023
			public const int Avatar_Size = 76;

			// Token: 0x040032E0 RID: 13024
			public const uint Genome_Offset = 261U;

			// Token: 0x040032E1 RID: 13025
			public const int Genome_Size = 64;

			// Token: 0x040032E2 RID: 13026
			public const uint CurrMainAttributes_Offset = 325U;

			// Token: 0x040032E3 RID: 13027
			public const int CurrMainAttributes_Size = 12;

			// Token: 0x040032E4 RID: 13028
			public const uint Poisoned_Offset = 337U;

			// Token: 0x040032E5 RID: 13029
			public const int Poisoned_Size = 24;

			// Token: 0x040032E6 RID: 13030
			public const uint InjuriesRecoveryProgress_Offset = 361U;

			// Token: 0x040032E7 RID: 13031
			public const int InjuriesRecoveryProgress_Size = 14;

			// Token: 0x040032E8 RID: 13032
			public const uint CurrNeili_Offset = 375U;

			// Token: 0x040032E9 RID: 13033
			public const int CurrNeili_Size = 4;

			// Token: 0x040032EA RID: 13034
			public const uint LoopingNeigong_Offset = 379U;

			// Token: 0x040032EB RID: 13035
			public const int LoopingNeigong_Size = 2;

			// Token: 0x040032EC RID: 13036
			public const uint BaseNeiliAllocation_Offset = 381U;

			// Token: 0x040032ED RID: 13037
			public const int BaseNeiliAllocation_Size = 8;

			// Token: 0x040032EE RID: 13038
			public const uint ExtraNeiliAllocation_Offset = 389U;

			// Token: 0x040032EF RID: 13039
			public const int ExtraNeiliAllocation_Size = 8;

			// Token: 0x040032F0 RID: 13040
			public const uint BaseNeiliProportionOfFiveElements_Offset = 397U;

			// Token: 0x040032F1 RID: 13041
			public const int BaseNeiliProportionOfFiveElements_Size = 8;

			// Token: 0x040032F2 RID: 13042
			public const uint HobbyExpirationDate_Offset = 405U;

			// Token: 0x040032F3 RID: 13043
			public const int HobbyExpirationDate_Size = 4;

			// Token: 0x040032F4 RID: 13044
			public const uint LovingItemRevealed_Offset = 409U;

			// Token: 0x040032F5 RID: 13045
			public const int LovingItemRevealed_Size = 1;

			// Token: 0x040032F6 RID: 13046
			public const uint HatingItemRevealed_Offset = 410U;

			// Token: 0x040032F7 RID: 13047
			public const int HatingItemRevealed_Size = 1;

			// Token: 0x040032F8 RID: 13048
			public const uint LegitimateBoysCount_Offset = 411U;

			// Token: 0x040032F9 RID: 13049
			public const int LegitimateBoysCount_Size = 1;

			// Token: 0x040032FA RID: 13050
			public const uint BirthLocation_Offset = 412U;

			// Token: 0x040032FB RID: 13051
			public const int BirthLocation_Size = 4;

			// Token: 0x040032FC RID: 13052
			public const uint Location_Offset = 416U;

			// Token: 0x040032FD RID: 13053
			public const int Location_Size = 4;

			// Token: 0x040032FE RID: 13054
			public const uint Equipment_Offset = 420U;

			// Token: 0x040032FF RID: 13055
			public const int Equipment_Size = 96;

			// Token: 0x04003300 RID: 13056
			public const uint EatingItems_Offset = 516U;

			// Token: 0x04003301 RID: 13057
			public const int EatingItems_Size = 90;

			// Token: 0x04003302 RID: 13058
			public const uint EquippedCombatSkills_Offset = 606U;

			// Token: 0x04003303 RID: 13059
			public const int EquippedCombatSkills_Size = 96;

			// Token: 0x04003304 RID: 13060
			public const uint CombatSkillAttainmentPanels_Offset = 702U;

			// Token: 0x04003305 RID: 13061
			public const int CombatSkillAttainmentPanels_Size = 252;

			// Token: 0x04003306 RID: 13062
			public const uint PreexistenceCharIds_Offset = 954U;

			// Token: 0x04003307 RID: 13063
			public const int PreexistenceCharIds_Size = 52;

			// Token: 0x04003308 RID: 13064
			public const uint XiangshuInfection_Offset = 1006U;

			// Token: 0x04003309 RID: 13065
			public const int XiangshuInfection_Size = 1;

			// Token: 0x0400330A RID: 13066
			public const uint CurrAge_Offset = 1007U;

			// Token: 0x0400330B RID: 13067
			public const int CurrAge_Size = 2;

			// Token: 0x0400330C RID: 13068
			public const uint Exp_Offset = 1009U;

			// Token: 0x0400330D RID: 13069
			public const int Exp_Size = 4;

			// Token: 0x0400330E RID: 13070
			public const uint ExternalRelationState_Offset = 1013U;

			// Token: 0x0400330F RID: 13071
			public const int ExternalRelationState_Size = 1;

			// Token: 0x04003310 RID: 13072
			public const uint KidnapperId_Offset = 1014U;

			// Token: 0x04003311 RID: 13073
			public const int KidnapperId_Size = 4;

			// Token: 0x04003312 RID: 13074
			public const uint LeaderId_Offset = 1018U;

			// Token: 0x04003313 RID: 13075
			public const int LeaderId_Size = 4;

			// Token: 0x04003314 RID: 13076
			public const uint FactionId_Offset = 1022U;

			// Token: 0x04003315 RID: 13077
			public const int FactionId_Size = 4;

			// Token: 0x04003316 RID: 13078
			public const uint ActionEnergies_Offset = 1026U;

			// Token: 0x04003317 RID: 13079
			public const int ActionEnergies_Size = 5;

			// Token: 0x04003318 RID: 13080
			public const uint PrioritizedActionCooldowns_Offset = 1031U;

			// Token: 0x04003319 RID: 13081
			public const int PrioritizedActionCooldowns_Size = 9;
		}

		// Token: 0x02000BBE RID: 3006
		public class ProtagonistFeatureRelatedStatus
		{
			// Token: 0x06008D0A RID: 36106 RVA: 0x004F850C File Offset: 0x004F670C
			public ProtagonistFeatureRelatedStatus(List<GameData.Domains.CombatSkill.CombatSkill> combatSkills)
			{
				this.CombatSkills = combatSkills;
				this.AddFeatureDreamLover = false;
				this.AddFeatureLifeSkillLearning = false;
				this.AddFeatureCombatSkillLearning = false;
				this.AddFeatureWhiteSnake = false;
				this.CreateCloseFriend = false;
				this.ReadLifeSkillTemplateId = -1;
				this.ReadCombatSkillTemplateId = -1;
				this.CombatSkillBookPageTypes = 0;
			}

			// Token: 0x0400331A RID: 13082
			public List<GameData.Domains.CombatSkill.CombatSkill> CombatSkills;

			// Token: 0x0400331B RID: 13083
			public bool AddFeatureDreamLover;

			// Token: 0x0400331C RID: 13084
			public bool AddFeatureLifeSkillLearning;

			// Token: 0x0400331D RID: 13085
			public bool AddFeatureCombatSkillLearning;

			// Token: 0x0400331E RID: 13086
			public bool AddFeatureWhiteSnake;

			// Token: 0x0400331F RID: 13087
			public bool AddFeatureLongevity;

			// Token: 0x04003320 RID: 13088
			public bool CreateCloseFriend;

			// Token: 0x04003321 RID: 13089
			public short ReadLifeSkillTemplateId;

			// Token: 0x04003322 RID: 13090
			public short ReadCombatSkillTemplateId;

			// Token: 0x04003323 RID: 13091
			public byte CombatSkillBookPageTypes;
		}
	}
}
