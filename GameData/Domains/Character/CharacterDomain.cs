using System;
using System.Collections;
using System.Collections.Concurrent;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Text;
using System.Threading.Tasks;
using Config;
using Config.ConfigCells;
using Config.ConfigCells.Character;
using GameData.ArchiveData;
using GameData.Combat.Math;
using GameData.Common;
using GameData.Common.SingleValueCollection;
using GameData.Dependencies;
using GameData.DLC;
using GameData.DLC.FiveLoong;
using GameData.DomainEvents;
using GameData.Domains.Adventure;
using GameData.Domains.Building;
using GameData.Domains.Character.Ai;
using GameData.Domains.Character.Ai.PrioritizedAction;
using GameData.Domains.Character.AvatarSystem;
using GameData.Domains.Character.AvatarSystem.AvatarRes;
using GameData.Domains.Character.Creation;
using GameData.Domains.Character.Display;
using GameData.Domains.Character.Filters;
using GameData.Domains.Character.ParallelModifications;
using GameData.Domains.Character.Relation;
using GameData.Domains.Character.Relation.RelationTree;
using GameData.Domains.Character.SortFilter;
using GameData.Domains.Character.TemporaryModification;
using GameData.Domains.Combat;
using GameData.Domains.CombatSkill;
using GameData.Domains.Extra;
using GameData.Domains.Global;
using GameData.Domains.Global.Inscription;
using GameData.Domains.Information;
using GameData.Domains.Information.Collection;
using GameData.Domains.Item;
using GameData.Domains.Item.Display;
using GameData.Domains.Item.Filters;
using GameData.Domains.LifeRecord;
using GameData.Domains.Map;
using GameData.Domains.Map.Filters;
using GameData.Domains.Merchant;
using GameData.Domains.Organization;
using GameData.Domains.Taiwu;
using GameData.Domains.Taiwu.Profession;
using GameData.Domains.Taiwu.Profession.SkillsData;
using GameData.Domains.Taiwu.VillagerRole;
using GameData.Domains.TaiwuEvent;
using GameData.Domains.TaiwuEvent.EventHelper;
using GameData.Domains.World;
using GameData.Domains.World.MonthlyEvent;
using GameData.Domains.World.Notification;
using GameData.GameDataBridge;
using GameData.Serializer;
using GameData.Utilities;
using NLog;
using Redzen.Random;
using TaiwuModdingLib.Core.Utils;

namespace GameData.Domains.Character
{
	// Token: 0x02000808 RID: 2056
	[GameDataDomain(4)]
	public class CharacterDomain : BaseGameDataDomain
	{
		// Token: 0x0600701C RID: 28700 RVA: 0x003FEA72 File Offset: 0x003FCC72
		private void OnInitializedDomainData()
		{
			this.InitializeGraveItemsRelatedData();
			this.ResetLuckEventPrediction();
		}

		// Token: 0x0600701D RID: 28701 RVA: 0x003FEA83 File Offset: 0x003FCC83
		private void InitializeOnInitializeGameDataModule()
		{
			CharacterDomain.InitializeRandomHanNameInfo();
			CharacterDomain.InitializeBasicFeaturesPools();
			CharacterDomain.InitializeRandomEnemyCharTemplateCache();
			AvatarManager.Instance = new AvatarManager();
			AvatarManager.Instance.InitAvatarCore(false, null, false);
		}

		// Token: 0x0600701E RID: 28702 RVA: 0x003FEAB0 File Offset: 0x003FCCB0
		private void InitializeOnEnterNewWorld()
		{
			this._nextObjectId = 0;
			this._avoidDeathCharId = -1;
			this.InitializeRelations();
			this.InitializeNominalBloodParentRelations();
			this.InitializeInfectedCharSet();
			this.InitializeInfantMap();
			this.InitializeFixedCharactersCache();
			this.InitializeSkeletonCharacterCache();
			this.InitializeXiangshuLocations();
			Events.RegisterHandler_AdvanceMonthFinish(new Events.OnAdvanceMonthFinish(this.RecoverCombatResources));
		}

		// Token: 0x0600701F RID: 28703 RVA: 0x003FEB10 File Offset: 0x003FCD10
		private void OnLoadedArchiveData()
		{
			this.InitializeRelations();
			this.InitializeNominalBloodParentRelations();
			this.InitializeInfectedCharSet();
			this.InitializeInfantMap();
			this.InitializeFixedCharactersCache();
			this.InitializeSkeletonCharacterCache();
			this.InitializeXiangshuLocations();
			DataUid uid = new DataUid(0, 1, ulong.MaxValue, uint.MaxValue);
			GameDataBridge.AddPostDataModificationHandler(uid, "RegisterPrevBookOwnerCopiesAsTemporaryCharacters", new Action<DataContext, DataUid>(this.RegisterPrevBookOwnerCopiesAsTemporaryCharacters));
			GameDataBridge.AddPostDataModificationHandler(uid, "ComplementPregeneratedRandomEnemies", new Action<DataContext, DataUid>(this.ComplementPregeneratedRandomEnemies));
			Events.RegisterHandler_AdvanceMonthFinish(new Events.OnAdvanceMonthFinish(this.RecoverCombatResources));
			DomainManager.World.UpdatePopulationRelatedData();
		}

		// Token: 0x06007020 RID: 28704 RVA: 0x003FEBA8 File Offset: 0x003FCDA8
		public unsafe override void FixAbnormalDomainArchiveData(DataContext context)
		{
			bool fixInsect = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 50, 0);
			bool resortFeatures = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 70, 36);
			bool addMemberFeatures = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 71, 0);
			bool upgradeCombatSkillEquipment = !DomainManager.World.IsCurrWorldAfterVersion(0, 0, 74, 10);
			bool initCharacterProfession = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 74, 14);
			this.ClearObsoleteRelationData(context);
			this.FixIncompleteRelation(context);
			this.FixAbnormalDebts(context);
			this.FixDuplicateLifeSkills(context);
			this.FixAbnormalExtraNeiliAllocationByProgress(context);
			bool flag = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 74, 39);
			if (flag)
			{
				this.FixAbnormalInfectedCharacterInPrisonAndBlock(context);
			}
			this.RemoveAbnormalInfectedCharacterGroup(context);
			this.RemoveDuplicateCharacterLocationAtBlocks(context);
			this.RemoveDuplicateKidnappedCharacters(context);
			this.RemoveAbnormalSkeletonCharacters(context);
			this.RemoveAbnormalCrossAreaTravelingCharacters(context);
			bool flag2 = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 69, 0);
			if (flag2)
			{
				this.MigratePrioritizedActionCooldown(context);
			}
			bool flag3 = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 71, 82);
			if (flag3)
			{
				this.FixAbnormalPrioritizedAction71(context);
			}
			bool flag4 = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 73, 42) && DomainManager.World.IsCurrWorldAfterVersion(0, 0, 73, 0);
			if (flag4)
			{
				this.FixAbnormalPrioritizedAction73(context);
			}
			bool flag5 = upgradeCombatSkillEquipment;
			if (flag5)
			{
				this.UpgradeCombatSkillEquipmentData(context);
			}
			bool flag6 = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 79, 0);
			if (flag6)
			{
				this.InitializeCombatSkillProficiencies(context);
			}
			HashSet<ItemKey> worldCharacterItems = new HashSet<ItemKey>(1048576);
			worldCharacterItems.UnionWith(DomainManager.Taiwu.WarehouseItems.Keys);
			worldCharacterItems.UnionWith(DomainManager.Extra.TreasuryItems.Keys);
			HashSet<int> unreleasedCalledCharacters = new HashSet<int>();
			DomainManager.TaiwuEvent.CollectUnreleasedCalledCharacters(unreleasedCalledCharacters);
			HashSet<int> ignoreCharIds = new HashSet<int>();
			DomainManager.Extra.GetAllPrevLegendaryBookOwnerCopies(context, ignoreCharIds, false);
			foreach (int charId in ignoreCharIds)
			{
				Character character;
				bool flag7 = !DomainManager.Character.TryGetElement_Objects(charId, out character);
				if (!flag7)
				{
					Location charLocation = character.GetLocation();
					bool flag8 = charLocation.IsValid();
					if (flag8)
					{
						MapBlockData block = DomainManager.Map.GetBlock(charLocation);
						bool flag9 = block.CharacterSet != null && block.CharacterSet.Contains(charId);
						if (flag9)
						{
							Events.RaiseCharacterLocationChanged(context, charId, charLocation, Location.Invalid);
							Logger logger = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(39, 1);
							defaultInterpolatedStringHandler.AppendLiteral("Removing temporary character ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
							defaultInterpolatedStringHandler.AppendLiteral(" from map.");
							logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						bool flag10 = block.InfectedCharacterSet != null && block.InfectedCharacterSet.Contains(charId);
						if (flag10)
						{
							Events.RaiseInfectedCharacterLocationChanged(context, charId, charLocation, Location.Invalid);
							Logger logger2 = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(39, 1);
							defaultInterpolatedStringHandler.AppendLiteral("Removing temporary character ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
							defaultInterpolatedStringHandler.AppendLiteral(" from map.");
							logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						}
					}
					else
					{
						character.SetLocation(DomainManager.Taiwu.GetTaiwuVillageLocation(), context);
					}
				}
			}
			Dictionary<int, Character> allPreexistingCharIds = new Dictionary<int, Character>();
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character4;
				keyValuePair.Deconstruct(out num, out character4);
				int charId2 = num;
				Character character2 = character4;
				this.FixCharacterConsummateLevel(context, character2);
				bool flag11 = ignoreCharIds.Contains(charId2);
				if (!flag11)
				{
					PreexistenceCharIds preexistingCharIds = *character2.GetPreexistenceCharIds();
					bool flag12 = preexistingCharIds.Count > 0 && preexistingCharIds.CharIds.FixedElementField >= 0;
					if (flag12)
					{
						int preexistingCharId = preexistingCharIds.CharIds.FixedElementField;
						Character otherChar;
						bool flag13 = allPreexistingCharIds.TryGetValue(preexistingCharId, out otherChar);
						if (flag13)
						{
							Logger logger3 = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(72, 3);
							defaultInterpolatedStringHandler.AppendLiteral("Removing duplicate preexisting character ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(preexistingCharId);
							defaultInterpolatedStringHandler.AppendLiteral(" of ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(character2);
							defaultInterpolatedStringHandler.AppendLiteral(" (already reincarnated as ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(otherChar);
							defaultInterpolatedStringHandler.AppendLiteral(")");
							logger3.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
							character2.ClearPreexistenceCharIds(context);
						}
						else
						{
							allPreexistingCharIds.Add(preexistingCharId, character2);
						}
					}
					bool flag14 = character2.IsActiveExternalRelationState(4) && !unreleasedCalledCharacters.Contains(charId2);
					if (flag14)
					{
						character2.DeactivateExternalRelationState(context, 4);
						Logger logger4 = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(40, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Canceling called by adventure state for ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(charId2);
						logger4.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					bool flag15 = fixInsect;
					if (flag15)
					{
						this.FixAbnormalInsectFeature(context, character2);
					}
					bool flag16 = addMemberFeatures;
					if (flag16)
					{
						DomainManager.Organization.TryAddSectMemberFeature(context, character2, character2.GetOrganizationInfo());
					}
					bool flag17 = resortFeatures;
					if (flag17)
					{
						List<short> featureIds = character2.GetFeatureIds();
						featureIds.Sort(CharacterFeatureHelper.FeatureComparer);
						character2.SetFeatureIds(featureIds, context);
					}
					this.FixAbnormalFeature(context, character2);
					this.FixAbnormalGroupState(context, character2);
					this.FixAbnormalCharacterLocation(context, character2);
					bool flag18 = initCharacterProfession && character2.GetCreatingType() == 1 && character2.GetAgeGroup() == 2;
					if (flag18)
					{
						this.GenerateCharacterProfession(context, character2);
					}
					this.FixAbnormalPregnantState(context, character2);
					this.FixAbnormalCharacterOrganization(context, character2);
					this.FixAbnormalCharacterCombatSkillBreakoutCount(context, character2);
					this.FixInventoryAndEquippedItem(context, character2, worldCharacterItems);
					this.FixCharacterMaxNeili(context, character2);
					this.FixCharacterCurrNeili(context, character2);
					this.FixMerchantCharToType(context, character2);
					this.FixErrorEatItems(context, character2);
					this.FixQualifications(context, character2);
					this.FixAbnormalAvatar(context, character2);
					this.FixAbnormalExtraNeiliAllocationByProgressForNonEvolutionaryType(context, character2);
					this.FixSpecialIdentityCharacterOrganizationAndIdentity(context, character2);
					this.FixAbnormalConsumedOwner(context, character2);
					this.FixAbnormalIdealSect(context, character2);
					this.FixAbnormalGuardFeature(context, character2);
					int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
					bool flag19 = charId2 == taiwuCharId;
					if (flag19)
					{
						this.FixAbnormalTaiwuExtraNeiliAllocation(context, character2);
					}
					this.FixAbnormalCombatSkillPageActivation(context, character2);
				}
			}
			this.FixAbnormalChickenFeatures(context);
			List<ItemKey> itemKeys = context.AdvanceMonthRelatedData.ItemKeys.Occupy();
			foreach (KeyValuePair<int, Grave> keyValuePair2 in this._graves)
			{
				int num;
				Grave grave2;
				keyValuePair2.Deconstruct(out num, out grave2);
				int charId3 = num;
				Grave grave = grave2;
				Inventory inventory = grave.GetInventory();
				itemKeys.Clear();
				itemKeys.AddRange(inventory.Items.Keys);
				bool inventoryChanged = false;
				foreach (ItemKey itemKey in itemKeys)
				{
					bool flag20 = ItemTemplateHelper.IsPureStackable(itemKey);
					if (!flag20)
					{
						bool flag21 = DomainManager.Item.ItemExists(itemKey);
						if (flag21)
						{
							bool flag22 = worldCharacterItems.Add(itemKey);
							if (!flag22)
							{
								Logger logger5 = CharacterDomain.Logger;
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 2);
								defaultInterpolatedStringHandler.AppendLiteral("Removing duplicate item ");
								defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(itemKey);
								defaultInterpolatedStringHandler.AppendLiteral(" in grave ");
								defaultInterpolatedStringHandler.AppendFormatted<int>(charId3);
								logger5.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								inventory.OfflineRemove(itemKey, inventory.Items[itemKey]);
								inventoryChanged = true;
							}
						}
						else
						{
							Logger logger6 = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(30, 2);
							defaultInterpolatedStringHandler.AppendLiteral("Removing ghost item ");
							defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(itemKey);
							defaultInterpolatedStringHandler.AppendLiteral(" in grave ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(charId3);
							logger6.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
							inventory.OfflineRemove(itemKey, inventory.Items[itemKey]);
							inventoryChanged = true;
						}
					}
				}
				bool flag23 = inventoryChanged;
				if (flag23)
				{
					grave.SetInventory(inventory, context);
				}
			}
			context.AdvanceMonthRelatedData.ItemKeys.Release(ref itemKeys);
			foreach (int charId4 in this._fixedCharactersCache.Values)
			{
				Character character3 = this._objects[charId4];
				bool flag24 = character3.GetLeaderId() == DomainManager.Taiwu.GetTaiwuCharId();
				if (!flag24)
				{
					context.Equipping.SelectEquipments(context, this._objects[charId4], true, false);
					foreach (ItemKey itemKey2 in character3.GetEquipment())
					{
						bool flag25 = !itemKey2.IsValid();
						if (!flag25)
						{
							bool flag26 = ItemTemplateHelper.GetItemSubType(itemKey2.ItemType, itemKey2.TemplateId) != 16;
							if (!flag26)
							{
								EquipmentBase equipmentBase = DomainManager.Item.GetBaseEquipment(itemKey2);
								short equipmentEffectId = equipmentBase.GetEquipmentEffectId();
								bool flag27 = equipmentEffectId >= 0;
								if (flag27)
								{
									equipmentBase.SetEquipmentEffectId(-1, context);
								}
							}
						}
					}
				}
			}
			this.FixInteractedCharacters(context);
			this.FixElopeWithLoveWrongState(context);
			this.FixKidnappedCharResistance(context);
		}

		// Token: 0x06007021 RID: 28705 RVA: 0x003FF5A8 File Offset: 0x003FD7A8
		private unsafe void FixAbnormalTaiwuExtraNeiliAllocation(DataContext context, Character character)
		{
			short maxNeiliAllocation = GlobalConfig.Instance.MaxExtraNeiliAllocation;
			int maxProgress = CombatSkillDomain.GetNeiliAllocationMaxProgress();
			IntList progress;
			bool flag = DomainManager.Extra.TryGetExtraNeiliAllocationProgress(character.GetId(), out progress);
			if (flag)
			{
				NeiliAllocation extraNeiliAllocation = character.GetExtraNeiliAllocation();
				for (int i = 0; i < 4; i++)
				{
					bool flag2 = progress.Items[i] >= maxProgress && *extraNeiliAllocation[i] < maxNeiliAllocation;
					if (flag2)
					{
						*extraNeiliAllocation[i] = maxNeiliAllocation;
					}
				}
				character.SetExtraNeiliAllocation(extraNeiliAllocation, context);
			}
		}

		// Token: 0x06007022 RID: 28706 RVA: 0x003FF63C File Offset: 0x003FD83C
		private void FixAbnormalCombatSkillPageActivation(DataContext context, Character character)
		{
			CharacterDomain.<>c__DisplayClass31_0 CS$<>8__locals1 = new CharacterDomain.<>c__DisplayClass31_0();
			bool flag = !DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 79, 21);
			if (!flag)
			{
				CS$<>8__locals1.learnedCombatSkillIds = character.GetLearnedCombatSkills();
				CS$<>8__locals1.charId = character.GetId();
				DomainManager.Character.AutoActivateReadCombatSkillNormalPages(context, CS$<>8__locals1.<FixAbnormalCombatSkillPageActivation>g__IterLearnedCombatSkills|0(), CS$<>8__locals1.charId);
			}
		}

		// Token: 0x06007023 RID: 28707 RVA: 0x003FF69C File Offset: 0x003FD89C
		private void FixSpecialIdentityCharacterOrganizationAndIdentity(DataContext context, Character character)
		{
			bool isVersionOk = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 74, 0);
			bool flag = !isVersionOk;
			if (!flag)
			{
				short templateId = character.GetTemplateId();
				CharacterItem config = Character.Instance[templateId];
				bool hasNoSpecialGradeName = string.IsNullOrEmpty(config.SpecialGradeName);
				bool flag2 = hasNoSpecialGradeName;
				if (!flag2)
				{
					OrganizationInfo orgInfo = character.GetOrganizationInfo();
					bool flag3 = orgInfo.OrgTemplateId == 0 && config.OrganizationInfo.OrgTemplateId != 0;
					if (flag3)
					{
						orgInfo.OrgTemplateId = config.OrganizationInfo.OrgTemplateId;
						orgInfo.Grade = config.OrganizationInfo.Grade;
						character.SetOrganizationInfo(orgInfo, context);
					}
				}
			}
		}

		// Token: 0x06007024 RID: 28708 RVA: 0x003FF74C File Offset: 0x003FD94C
		private void FixAbnormalConsumedOwner(DataContext context, Character character)
		{
			bool flag = !DomainManager.Extra.IsLegendaryBookConsumed(character.GetId());
			if (!flag)
			{
				DomainManager.Organization.ChangeOrganization(context, character, OrganizationInfo.None);
				Location location = character.GetLocation();
				bool flag2 = !location.IsValid() || location.AreaId >= 45;
				if (!flag2)
				{
					List<short> brokenAreas = ObjectPool<List<short>>.Instance.Get();
					DomainManager.Map.GetAllBrokenAreaInState(DomainManager.Map.GetStateIdByAreaId(location.AreaId), brokenAreas);
					bool flag3 = brokenAreas.Count > 0;
					if (flag3)
					{
						CollectionUtils.Shuffle<short>(context.Random, brokenAreas);
						List<MapBlockData> validBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
						short areaId = brokenAreas[0];
						DomainManager.Adventure.GetValidBlocksForRandomEnemy(areaId, -1, -1, true, true, true, validBlocks);
						bool flag4 = validBlocks.Count > 0;
						if (flag4)
						{
							CollectionUtils.Shuffle<MapBlockData>(context.Random, validBlocks);
							Location destLocation = validBlocks[0].GetLocation();
							DomainManager.Character.LeaveGroup(context, character, false);
							character.SetLocation(destLocation, context);
							Events.RaiseCharacterLocationChanged(context, character.GetId(), location, destLocation);
						}
						ObjectPool<List<MapBlockData>>.Instance.Return(validBlocks);
					}
					ObjectPool<List<short>>.Instance.Return(brokenAreas);
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Fix Abnormal Consumed Character: ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
					logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
		}

		// Token: 0x06007025 RID: 28709 RVA: 0x003FF8C4 File Offset: 0x003FDAC4
		private void FixAbnormalIdealSect(DataContext context, Character character)
		{
			sbyte orig = character.GetIdealSect();
			bool flag = orig > 0;
			if (!flag)
			{
				List<sbyte> randomIdealSectsPool = character.Template.RandomIdealSects;
				sbyte idealSect = (randomIdealSectsPool != null && randomIdealSectsPool.Count > 0) ? randomIdealSectsPool.GetRandom(context.Random) : ((character.Template.IdealSect > 0) ? character.Template.IdealSect : -1);
				bool flag2 = orig != idealSect;
				if (flag2)
				{
					character.SetIdealSect(idealSect, context);
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(41, 3);
					defaultInterpolatedStringHandler.AppendLiteral("Fix Abnormal Character Ideal Sect: ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
					defaultInterpolatedStringHandler.AppendLiteral(", ");
					defaultInterpolatedStringHandler.AppendFormatted<sbyte>(orig);
					defaultInterpolatedStringHandler.AppendLiteral(" -> ");
					defaultInterpolatedStringHandler.AppendFormatted<sbyte>(idealSect);
					logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
		}

		// Token: 0x06007026 RID: 28710 RVA: 0x003FF9A0 File Offset: 0x003FDBA0
		private void FixAbnormalGuardFeature(DataContext context, Character character)
		{
			bool flag = character.GetCreatingType() == 1 && DomainManager.Organization.CharacterTreasuryGuardInfo(character.GetId()) == 0;
			if (flag)
			{
				bool flag2 = character.RemoveFeatureGroup(context, 536);
				if (flag2)
				{
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Fix Abnormal Character Guard Feature: ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
					logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
		}

		// Token: 0x06007027 RID: 28711 RVA: 0x003FFA14 File Offset: 0x003FDC14
		private void ClearObsoleteRelationData(DataContext context)
		{
			int countBefore = this._relations.Count;
			foreach (KeyValuePair<int, DeadCharacter> keyValuePair in this._deadCharacters)
			{
				int num;
				DeadCharacter deadCharacter;
				keyValuePair.Deconstruct(out num, out deadCharacter);
				int charId = num;
				this.RemoveAllGeneralRelations(context, charId);
			}
			int countAfter = this._relations.Count;
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 2);
			defaultInterpolatedStringHandler.AppendLiteral("Clearing obsolete relations: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(countBefore);
			defaultInterpolatedStringHandler.AppendLiteral(" => ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(countAfter);
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
			int expectedCapacity = countAfter + this._objects.Count * 64;
			bool flag = countBefore > expectedCapacity;
			if (flag)
			{
				this._relations.TrimExcess(expectedCapacity);
				Logger logger2 = CharacterDomain.Logger;
				defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Trimming relation dict capacity to ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(expectedCapacity);
				logger2.Info(defaultInterpolatedStringHandler.ToStringAndClear());
			}
		}

		// Token: 0x06007028 RID: 28712 RVA: 0x003FFB40 File Offset: 0x003FDD40
		private void RemoveAbnormalSkeletonCharacters(DataContext context)
		{
			foreach (KeyValuePair<int, int> keyValuePair in this._skeletonCharacterCache)
			{
				int num;
				int num2;
				keyValuePair.Deconstruct(out num, out num2);
				int skeletonId = num;
				int deadCharId = num2;
				Character skeletonChar;
				DeadCharacter deadChar;
				bool flag = !this._objects.TryGetValue(skeletonId, out skeletonChar) || !this._deadCharacters.TryGetValue(deadCharId, out deadChar);
				if (!flag)
				{
					bool flag2 = skeletonChar.GetGender() != deadChar.Gender || skeletonChar.GetAgeGroup() != 2;
					if (flag2)
					{
						Logger logger = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(47, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Removing abnormal skeleton character ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(skeletonId);
						defaultInterpolatedStringHandler.AppendLiteral(" of grave ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(deadCharId);
						logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						this.RemoveNonIntelligentCharacter(context, skeletonChar);
					}
				}
			}
		}

		// Token: 0x06007029 RID: 28713 RVA: 0x003FFC50 File Offset: 0x003FDE50
		private void RemoveAbnormalCrossAreaTravelingCharacters(DataContext context)
		{
			foreach (KeyValuePair<int, CrossAreaMoveInfo> keyValuePair in this._crossAreaMoveInfos)
			{
				int num;
				CrossAreaMoveInfo crossAreaMoveInfo;
				keyValuePair.Deconstruct(out num, out crossAreaMoveInfo);
				int charId = num;
				CrossAreaMoveInfo travelInfo = crossAreaMoveInfo;
				Character character;
				bool flag = !this.TryGetElement_Objects(charId, out character);
				if (flag)
				{
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(37, 3);
					defaultInterpolatedStringHandler.AppendLiteral("Invalid travel info: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
					defaultInterpolatedStringHandler.AppendLiteral("(dead) from ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(travelInfo.FromAreaId);
					defaultInterpolatedStringHandler.AppendLiteral(" to ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(travelInfo.ToAreaId);
					logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					this.RemoveCrossAreaTravelInfo(context, charId);
				}
				else
				{
					bool flag2 = character.GetLocation().IsValid();
					if (flag2)
					{
						Logger logger2 = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(31, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Invalid travel info: ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
						defaultInterpolatedStringHandler.AppendLiteral(" from ");
						defaultInterpolatedStringHandler.AppendFormatted<short>(travelInfo.FromAreaId);
						defaultInterpolatedStringHandler.AppendLiteral(" to ");
						defaultInterpolatedStringHandler.AppendFormatted<short>(travelInfo.ToAreaId);
						logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						this.RemoveCrossAreaTravelInfo(context, charId);
					}
				}
			}
		}

		// Token: 0x0600702A RID: 28714 RVA: 0x003FFDD8 File Offset: 0x003FDFD8
		private void FixAbnormalAvatar(DataContext context, Character character)
		{
			AvatarData avatar = character.GetAvatar();
			AvatarGroup avatarGroup = AvatarManager.Instance.GetAvatarGroup((int)avatar.AvatarId);
			bool flag = avatarGroup.IsHairless(avatar.FrontHairId, avatar.BackHairId);
			if (flag)
			{
				AvatarData avatarData = avatar;
				AvatarData avatarData2 = avatar;
				ValueTuple<short, short> randomHairs = avatarGroup.GetRandomHairs(context.Random);
				avatarData.FrontHairId = randomHairs.Item1;
				avatarData2.BackHairId = randomHairs.Item2;
				character.SetAvatar(avatar, context);
				Logger logger = CharacterDomain.Logger;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(47, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Fixing abnormal hairless avatar for character ");
				defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
				defaultInterpolatedStringHandler.AppendLiteral(".");
				logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
			}
		}

		// Token: 0x0600702B RID: 28715 RVA: 0x003FFE88 File Offset: 0x003FE088
		private void FixAbnormalExtraNeiliAllocationByProgressForNonEvolutionaryType(DataContext context, Character character)
		{
			bool flag = !DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 71, 78);
			if (!flag)
			{
				bool flag2 = !CreatingType.IsNonEvolutionaryType(character.GetCreatingType());
				if (!flag2)
				{
					IntList progress = DomainManager.Extra.GetOrInitExtraNeiliAllocationProgress(context, character.GetId());
					CharacterItem characterTemplate = character.Template;
					sbyte[] configExtraNeiliAllocation = characterTemplate.ExtraNeiliAllocationProgress;
					for (int i = 0; i < 4; i++)
					{
						int targetProgress = CombatSkillDomain.GetExtraNeiliAllocationProgressByExtraNeiliAllocation((int)configExtraNeiliAllocation[i]);
						progress.Items[i] = targetProgress;
					}
					DomainManager.CombatSkill.SetCharacterExtraNeiliAllocationAndProgress(context, character, progress, true);
				}
			}
		}

		// Token: 0x0600702C RID: 28716 RVA: 0x003FFF28 File Offset: 0x003FE128
		private void FixAbnormalChickenFeatures(DataContext context)
		{
			Stopwatch stopWatch = Stopwatch.StartNew();
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				List<short> chickenFeatures = character.GetChickenFeatures();
				ChickenBlessingInfoData chickenBlessingInfoData;
				bool hasChickenData = DomainManager.Building.TryGetElement_ChickenBlessingInfoData(charId, out chickenBlessingInfoData);
				foreach (short chickenFeature in chickenFeatures)
				{
					int expireDate = DomainManager.Extra.GetCharacterTemporaryFeaturesExpireDate(new IntPair(charId, (int)chickenFeature));
					bool flag = expireDate != -1;
					if (!flag)
					{
						sbyte remainingMonths;
						bool flag2 = hasChickenData && chickenBlessingInfoData.RemainingMonths.TryGetValue(chickenFeature, out remainingMonths);
						if (flag2)
						{
							expireDate = DomainManager.World.GetCurrDate() + (int)remainingMonths;
							DomainManager.Extra.RegisterCharacterTemporaryFeature(context, charId, chickenFeature, expireDate);
						}
						else
						{
							expireDate = DomainManager.World.GetCurrDate() + (int)CharacterFeature.Instance[chickenFeature].Duration;
							DomainManager.Extra.RegisterCharacterTemporaryFeature(context, charId, chickenFeature, expireDate);
						}
					}
				}
			}
			DomainManager.Building.ClearChickenBlessingInfo(context);
			stopWatch.Stop();
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(40, 1);
			defaultInterpolatedStringHandler.AppendLiteral("FixAbnormalChickenFeatures cost time: ");
			defaultInterpolatedStringHandler.AppendFormatted<long>(stopWatch.ElapsedMilliseconds);
			defaultInterpolatedStringHandler.AppendLiteral("ms");
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x0600702D RID: 28717 RVA: 0x004000F8 File Offset: 0x003FE2F8
		private void FixIncompleteRelation(DataContext context)
		{
			List<RelationKey> relationsToAdd = null;
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character;
				keyValuePair.Deconstruct(out num, out character);
				int charId = num;
				RelatedCharacters relatedCharIds;
				bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedCharIds);
				if (!flag)
				{
					foreach (int relatedCharId in relatedCharIds.General.GetCollection())
					{
						RelationKey reverseKey = new RelationKey(relatedCharId, charId);
						bool flag2 = this._objects.ContainsKey(relatedCharId) && !this._relations.ContainsKey(reverseKey);
						if (flag2)
						{
							if (relationsToAdd == null)
							{
								relationsToAdd = new List<RelationKey>();
							}
							relationsToAdd.Add(reverseKey);
						}
					}
				}
			}
			bool flag3 = relationsToAdd != null;
			if (flag3)
			{
				foreach (RelationKey relationKey in relationsToAdd)
				{
					RelationKey srcKey = new RelationKey(relationKey.RelatedCharId, relationKey.CharId);
					RelatedCharacter srcRelation = this._relations[srcKey];
					this.AddRelationInternal(context, relationKey.CharId, relationKey.RelatedCharId, 0, srcRelation.EstablishmentDate);
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 2);
					defaultInterpolatedStringHandler.AppendLiteral("Add missing relation between ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(this._objects[relationKey.CharId]);
					defaultInterpolatedStringHandler.AppendLiteral(" and ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(this._objects[relationKey.RelatedCharId]);
					logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
		}

		// Token: 0x0600702E RID: 28718 RVA: 0x0040030C File Offset: 0x003FE50C
		private unsafe void FixErrorEatItems(DataContext context, Character character)
		{
			EatingItems eatItems = *character.GetEatingItems();
			bool flag = character.GetCreatingType() != 1;
			if (flag)
			{
				bool modified = false;
				for (int i = 0; i < 9; i++)
				{
					ItemKey itemKey = (ItemKey)(*(ref eatItems.ItemKeys.FixedElementField + (IntPtr)i * 8));
					bool flag2 = EatingItems.IsValid(itemKey);
					if (flag2)
					{
						Logger logger = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(51, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Removing non-intelligent character ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
						defaultInterpolatedStringHandler.AppendLiteral("'s eating item: ");
						defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(itemKey);
						logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						modified = true;
					}
				}
				bool flag3 = modified;
				if (flag3)
				{
					character.ClearEatingItems(context);
				}
			}
			else
			{
				for (int j = 0; j < 9; j++)
				{
					ItemKey itemKey2 = (ItemKey)(*(ref eatItems.ItemKeys.FixedElementField + (IntPtr)j * 8));
					bool flag4 = EatingItems.IsValid(itemKey2) && ItemTemplateHelper.GetItemSubType(itemKey2.ItemType, itemKey2.TemplateId) != 802 && !DomainManager.Item.ItemExists(itemKey2);
					if (flag4)
					{
						*(ref eatItems.ItemKeys.FixedElementField + (IntPtr)j * 8) = (ulong)ItemKey.Invalid;
						character.SetEatingItems(ref eatItems, context);
						Logger logger2 = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(52, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Removing character ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
						defaultInterpolatedStringHandler.AppendLiteral(" eatItems,ItemType: ");
						defaultInterpolatedStringHandler.AppendFormatted<sbyte>(itemKey2.ItemType);
						defaultInterpolatedStringHandler.AppendLiteral(",TemplateId： ");
						defaultInterpolatedStringHandler.AppendFormatted<short>(itemKey2.TemplateId);
						logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					}
				}
			}
		}

		// Token: 0x0600702F RID: 28719 RVA: 0x004004E8 File Offset: 0x003FE6E8
		private unsafe void FixQualifications(DataContext context, Character character)
		{
			CharacterDomain.<>c__DisplayClass44_0 CS$<>8__locals1;
			CS$<>8__locals1.character = character;
			bool flag = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 79, 0);
			if (flag)
			{
				CombatSkillShorts k = *CS$<>8__locals1.character.GetBaseCombatSkillQualifications();
				bool flag2 = CharacterDomain.<FixQualifications>g__FixSegment|44_0(&k.Items.FixedElementField, 14, ref CS$<>8__locals1);
				if (flag2)
				{
					CS$<>8__locals1.character.SetBaseCombatSkillQualifications(ref k, context);
				}
				LifeSkillShorts k2 = *CS$<>8__locals1.character.GetBaseLifeSkillQualifications();
				bool flag3 = CharacterDomain.<FixQualifications>g__FixSegment|44_0(&k2.Items.FixedElementField, 16, ref CS$<>8__locals1);
				if (flag3)
				{
					CS$<>8__locals1.character.SetBaseLifeSkillQualifications(ref k2, context);
				}
			}
		}

		// Token: 0x06007030 RID: 28720 RVA: 0x00400590 File Offset: 0x003FE790
		private void FixAbnormalDebts(DataContext context)
		{
			int[] debtsCharIds = this._debtsToTaiwu.Keys.ToArray<int>();
			foreach (int charId in debtsCharIds)
			{
				bool flag = this._debtsToTaiwu[charId] != null;
				if (!flag)
				{
					this.RemoveElement_DebtsToTaiwu(charId, context);
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Removing invalid debt to taiwu (");
					defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
					defaultInterpolatedStringHandler.AppendLiteral(").");
					logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
		}

		// Token: 0x06007031 RID: 28721 RVA: 0x00400628 File Offset: 0x003FE828
		private void FixDuplicateLifeSkills(DataContext context)
		{
			HashSet<short> lifeSkillIdSet = new HashSet<short>();
			HashSet<int> taiwuGroup = DomainManager.Taiwu.GetGroupCharIds().GetCollection();
			foreach (int charId in taiwuGroup)
			{
				Character character = this._objects[charId];
				List<LifeSkillItem> learnedLifeSkills = character.GetLearnedLifeSkills();
				lifeSkillIdSet.Clear();
				int index = 0;
				bool isChanged = false;
				while (index < learnedLifeSkills.Count)
				{
					LifeSkillItem lifeSkillItem = learnedLifeSkills[index];
					bool flag = !lifeSkillIdSet.Add(lifeSkillItem.SkillTemplateId);
					if (flag)
					{
						learnedLifeSkills.RemoveAt(index);
						Logger logger = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(37, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Removing ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
						defaultInterpolatedStringHandler.AppendLiteral("'s duplicate life skill ");
						defaultInterpolatedStringHandler.AppendFormatted(LifeSkill.Instance[lifeSkillItem.SkillTemplateId].Name);
						defaultInterpolatedStringHandler.AppendLiteral(" (");
						defaultInterpolatedStringHandler.AppendFormatted<short>(lifeSkillItem.SkillTemplateId);
						defaultInterpolatedStringHandler.AppendLiteral(").");
						logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						isChanged = true;
					}
					else
					{
						index++;
					}
				}
				bool flag2 = isChanged;
				if (flag2)
				{
					character.SetLearnedLifeSkills(learnedLifeSkills, context);
				}
			}
		}

		// Token: 0x06007032 RID: 28722 RVA: 0x004007B8 File Offset: 0x003FE9B8
		private unsafe void FixAbnormalExtraNeiliAllocationByProgress(DataContext context)
		{
			bool flag = !DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 71, 71);
			if (!flag)
			{
				Character taiwu = DomainManager.Taiwu.GetTaiwu();
				int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
				IntList extraNeiliAllocationProgress = DomainManager.Extra.GetOrInitExtraNeiliAllocationProgress(context, taiwuCharId);
				int maxProgress = CombatSkillDomain.GetNeiliAllocationMaxProgress();
				NeiliAllocation extraNeiliAllocation = default(NeiliAllocation);
				extraNeiliAllocation.Initialize();
				for (int i = 0; i < 4; i++)
				{
					*(ref extraNeiliAllocation.Items.FixedElementField + (IntPtr)i * 2) = (short)CombatSkillDomain.GetExtraNeiliAllocationByProgress(Math.Clamp(extraNeiliAllocationProgress.Items[i], 0, maxProgress));
				}
				taiwu.SetExtraNeiliAllocation(extraNeiliAllocation, context);
			}
		}

		// Token: 0x06007033 RID: 28723 RVA: 0x00400870 File Offset: 0x003FEA70
		private void RemoveDuplicateCharacterLocationAtBlocks(DataContext context)
		{
			ConcurrentBag<ValueTuple<MapBlockData, Character>> duplicateCharacterBlocks = new ConcurrentBag<ValueTuple<MapBlockData, Character>>();
			Parallel.For(0, 139, delegate(int i)
			{
				this.CollectDuplicateCharacterLocationBlocksInArea(i, duplicateCharacterBlocks);
			});
			bool flag = duplicateCharacterBlocks.Count > 0;
			if (flag)
			{
				Logger logger = CharacterDomain.Logger;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(28, 1);
				defaultInterpolatedStringHandler.AppendFormatted<int>(duplicateCharacterBlocks.Count);
				defaultInterpolatedStringHandler.AppendLiteral(" duplicate characters found.");
				logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
				foreach (ValueTuple<MapBlockData, Character> valueTuple in duplicateCharacterBlocks)
				{
					MapBlockData block = valueTuple.Item1;
					Character character = valueTuple.Item2;
					Logger logger2 = CharacterDomain.Logger;
					defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(27, 3);
					defaultInterpolatedStringHandler.AppendLiteral("Removing character ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
					defaultInterpolatedStringHandler.AppendLiteral(" at (");
					defaultInterpolatedStringHandler.AppendFormatted<short>(block.AreaId);
					defaultInterpolatedStringHandler.AppendLiteral(", ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(block.BlockId);
					defaultInterpolatedStringHandler.AppendLiteral(")");
					logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					block.RemoveCharacter(character.GetId());
					block.RemoveInfectedCharacter(character.GetId());
					DomainManager.Map.SetBlockData(context, block);
				}
			}
		}

		// Token: 0x06007034 RID: 28724 RVA: 0x004009F8 File Offset: 0x003FEBF8
		private void FixAbnormalInfectedCharacterInPrisonAndBlock(DataContext context)
		{
			foreach (int infectedCharId in this._infectedCharSet)
			{
				Character character = this._objects[infectedCharId];
				bool flag = !character.IsActiveExternalRelationState(32);
				if (!flag)
				{
					Location validLocation = character.GetValidLocation();
					MapBlockData blockData = DomainManager.Map.GetBlock(validLocation);
					bool flag2 = blockData.InfectedCharacterSet != null && blockData.InfectedCharacterSet.Contains(infectedCharId);
					if (flag2)
					{
						Logger logger = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(40, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Removing infected prisoner ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
						defaultInterpolatedStringHandler.AppendLiteral(" from block ");
						defaultInterpolatedStringHandler.AppendFormatted<Location>(validLocation);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						Events.RaiseInfectedCharacterLocationChanged(context, infectedCharId, validLocation, Location.Invalid);
					}
				}
			}
		}

		// Token: 0x06007035 RID: 28725 RVA: 0x00400B0C File Offset: 0x003FED0C
		private void RemoveAbnormalInfectedCharacterGroup(DataContext context)
		{
			foreach (int infectedCharId in this._infectedCharSet)
			{
				Character character = this._objects[infectedCharId];
				int leaderId = character.GetLeaderId();
				Location location = character.GetLocation();
				bool flag = character.GetLeaderId() >= 0;
				if (flag)
				{
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(56, 3);
					defaultInterpolatedStringHandler.AppendLiteral("Removing infected character ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
					defaultInterpolatedStringHandler.AppendLiteral(" from group with leader ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(leaderId);
					defaultInterpolatedStringHandler.AppendLiteral(" at ");
					defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
					logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					this.LeaveGroup(context, character, false);
					location = character.GetLocation();
					bool flag2 = location.IsValid();
					if (flag2)
					{
						MapBlockData block = DomainManager.Map.GetBlock(location);
						bool flag3 = block.CharacterSet.Contains(infectedCharId);
						if (flag3)
						{
							block.RemoveCharacter(infectedCharId);
							block.AddInfectedCharacter(infectedCharId);
							DomainManager.Map.SetBlockData(context, block);
							Logger logger2 = CharacterDomain.Logger;
							defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 2);
							defaultInterpolatedStringHandler.AppendLiteral("Re-adjusting infected character ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
							defaultInterpolatedStringHandler.AppendLiteral("'s location at ");
							defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
							defaultInterpolatedStringHandler.AppendLiteral(".");
							logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						}
					}
				}
			}
		}

		// Token: 0x06007036 RID: 28726 RVA: 0x00400CC0 File Offset: 0x003FEEC0
		private void RemoveDuplicateKidnappedCharacters(DataContext context)
		{
			Dictionary<int, int> toRemoveKidnappedCharDict = ObjectPool<Dictionary<int, int>>.Instance.Get();
			toRemoveKidnappedCharDict.Clear();
			foreach (KeyValuePair<int, KidnappedCharacterList> keyValuePair in this._kidnappedChars)
			{
				int num;
				KidnappedCharacterList kidnappedCharacterList2;
				keyValuePair.Deconstruct(out num, out kidnappedCharacterList2);
				int charId = num;
				KidnappedCharacterList kidnappedCharacterList = kidnappedCharacterList2;
				foreach (KidnappedCharacter kidnappedChar in kidnappedCharacterList.GetCollection())
				{
					int kidnappedCharId = kidnappedChar.CharId;
					Character character;
					bool flag = !this._objects.TryGetValue(kidnappedCharId, out character);
					if (flag)
					{
						toRemoveKidnappedCharDict[kidnappedCharId] = charId;
					}
					else
					{
						bool flag2 = character.GetKidnapperId() != charId;
						if (flag2)
						{
							toRemoveKidnappedCharDict[kidnappedCharId] = charId;
						}
						else
						{
							Location charLocation = character.GetLocation();
							bool flag3 = !charLocation.IsValid();
							if (!flag3)
							{
								MapBlockData blockData = DomainManager.Map.GetBlock(charLocation);
								bool flag4 = blockData.RemoveCharacter(kidnappedCharId) || blockData.RemoveInfectedCharacter(kidnappedCharId);
								if (flag4)
								{
									Logger logger = CharacterDomain.Logger;
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(51, 4);
									defaultInterpolatedStringHandler.AppendLiteral("Removing duplicated kidnapped character ");
									defaultInterpolatedStringHandler.AppendFormatted<int>(kidnappedCharId);
									defaultInterpolatedStringHandler.AppendLiteral(" by ");
									defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
									defaultInterpolatedStringHandler.AppendLiteral(" at (");
									defaultInterpolatedStringHandler.AppendFormatted<short>(blockData.AreaId);
									defaultInterpolatedStringHandler.AppendLiteral(",");
									defaultInterpolatedStringHandler.AppendFormatted<short>(blockData.BlockId);
									defaultInterpolatedStringHandler.AppendLiteral(")");
									logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
									DomainManager.Map.SetBlockData(context, blockData);
									character.SetLocation(Location.Invalid, context);
								}
							}
						}
					}
				}
			}
			foreach (KeyValuePair<int, int> keyValuePair2 in toRemoveKidnappedCharDict)
			{
				int num;
				int num2;
				keyValuePair2.Deconstruct(out num, out num2);
				int kidnappedCharId2 = num;
				int kidnapperCharId = num2;
				KidnappedCharacterList kidnappedCharList = this._kidnappedChars[kidnapperCharId];
				kidnappedCharList.Remove(kidnappedCharId2);
				bool flag5 = kidnappedCharList.GetCount() > 0;
				if (flag5)
				{
					this.SetElement_KidnappedChars(kidnapperCharId, kidnappedCharList, context);
				}
				else
				{
					this.RemoveElement_KidnappedChars(kidnappedCharId2, context);
					Character kidnapper = this._objects[kidnapperCharId];
					kidnapper.DeactivateExternalRelationState(context, 2);
				}
				Logger logger2 = CharacterDomain.Logger;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Removing kidnap relation: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(kidnapperCharId);
				defaultInterpolatedStringHandler.AppendLiteral(" kidnapped ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(kidnappedCharId2);
				defaultInterpolatedStringHandler.AppendLiteral(".");
				logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			ObjectPool<Dictionary<int, int>>.Instance.Return(toRemoveKidnappedCharDict);
		}

		// Token: 0x06007037 RID: 28727 RVA: 0x00401008 File Offset: 0x003FF208
		private unsafe void CollectDuplicateCharacterLocationBlocksInArea(int areaId, [TupleElementNames(new string[]
		{
			"block",
			"character"
		})] ConcurrentBag<ValueTuple<MapBlockData, Character>> duplicateCharacterBlocks)
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			Span<MapBlockData> blocks = DomainManager.Map.GetAreaBlocks((short)areaId);
			int i = 0;
			int blocksCount = blocks.Length;
			while (i < blocksCount)
			{
				Location blockLocation = new Location((short)areaId, (short)i);
				HashSet<int> charIds = blocks[i]->CharacterSet;
				bool flag = charIds != null;
				if (flag)
				{
					foreach (int charId in charIds)
					{
						Character character = DomainManager.Character.GetElement_Objects(charId);
						bool flag2 = !character.GetLocation().Equals(blockLocation);
						if (flag2)
						{
							duplicateCharacterBlocks.Add(new ValueTuple<MapBlockData, Character>(*blocks[i], character));
						}
						else
						{
							bool flag3 = character.GetLeaderId() == taiwuCharId;
							if (flag3)
							{
								duplicateCharacterBlocks.Add(new ValueTuple<MapBlockData, Character>(*blocks[i], character));
							}
						}
					}
				}
				else
				{
					charIds = CharacterDomain.EmptyCharacterSet;
				}
				HashSet<int> infectedCharIds = blocks[i]->InfectedCharacterSet;
				bool flag4 = infectedCharIds == null;
				if (!flag4)
				{
					foreach (int charId2 in infectedCharIds)
					{
						Character character2 = DomainManager.Character.GetElement_Objects(charId2);
						bool flag5 = !character2.GetLocation().Equals(blockLocation);
						if (flag5)
						{
							duplicateCharacterBlocks.Add(new ValueTuple<MapBlockData, Character>(*blocks[i], character2));
						}
						else
						{
							bool flag6 = character2.GetLeaderId() == taiwuCharId;
							if (flag6)
							{
								duplicateCharacterBlocks.Add(new ValueTuple<MapBlockData, Character>(*blocks[i], character2));
							}
							else
							{
								bool flag7 = charIds.Contains(charId2);
								if (flag7)
								{
									duplicateCharacterBlocks.Add(new ValueTuple<MapBlockData, Character>(*blocks[i], character2));
								}
							}
						}
					}
				}
				i++;
			}
		}

		// Token: 0x06007038 RID: 28728 RVA: 0x00401224 File Offset: 0x003FF424
		private void FixInventoryAndEquippedItem(DataContext context, Character character, HashSet<ItemKey> worldCharacterItems)
		{
			bool versionNeedRepairPoisonData = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 74, 23);
			bool versionNeedRepairExtraGoodsData = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 74, 23);
			bool versionNeedRepairSectAccessory = DomainManager.Item.VersionNeedRepairSectAccessory;
			int charId = character.GetId();
			Inventory inventory = character.GetInventory();
			List<ItemKey> inventoryList = context.AdvanceMonthRelatedData.ItemKeys.Occupy();
			inventoryList.AddRange(inventory.Items.Keys);
			bool changed = false;
			for (int i = 0; i < inventoryList.Count; i++)
			{
				ItemKey key = inventoryList[i];
				int amount = inventory.Items[key];
				bool flag = !ItemTemplateHelper.CheckTemplateValid(key.ItemType, key.TemplateId);
				if (flag)
				{
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(73, 4);
					defaultInterpolatedStringHandler.AppendLiteral("Removing ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
					defaultInterpolatedStringHandler.AppendLiteral("'s inventory item ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(key.Id);
					defaultInterpolatedStringHandler.AppendLiteral(" with invalid template: ItemType ");
					defaultInterpolatedStringHandler.AppendFormatted<sbyte>(key.ItemType);
					defaultInterpolatedStringHandler.AppendLiteral(", TemplateId ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(key.TemplateId);
					logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					inventory.OfflineRemove(key, amount);
					bool flag2 = DomainManager.Item.ItemExists(key);
					if (flag2)
					{
						DomainManager.Item.ForceRemoveItem(context, key);
					}
					changed = true;
				}
				else
				{
					bool flag3 = DomainManager.Item.ItemExists(key);
					if (flag3)
					{
						ItemBase baseItem = DomainManager.Item.GetBaseItem(key);
						ItemKey baseKey = baseItem.GetItemKey();
						bool flag4 = !key.Equals(baseKey);
						if (flag4)
						{
							Logger logger2 = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 2);
							defaultInterpolatedStringHandler.AppendLiteral("Fixing ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
							defaultInterpolatedStringHandler.AppendLiteral("'s inventory item ");
							defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(key);
							defaultInterpolatedStringHandler.AppendLiteral("'s refine effect.");
							logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
							inventory.OfflineRemove(key, amount);
							inventory.OfflineAdd(baseKey, amount);
							changed = true;
						}
						bool flag5 = ItemTemplateHelper.IsPureStackable(baseKey);
						if (!flag5)
						{
							bool flag6 = amount > 1;
							if (flag6)
							{
								Logger logger3 = CharacterDomain.Logger;
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(47, 2);
								defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
								defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
								defaultInterpolatedStringHandler.AppendLiteral("'s stacked non-stackable item ");
								defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(baseKey);
								logger3.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								inventory.Items[baseKey] = 1;
								changed = true;
							}
							bool flag7 = !worldCharacterItems.Add(baseKey);
							if (flag7)
							{
								Logger logger4 = CharacterDomain.Logger;
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(37, 2);
								defaultInterpolatedStringHandler.AppendLiteral("Removing character ");
								defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
								defaultInterpolatedStringHandler.AppendLiteral("'s duplicate item ");
								defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(baseKey);
								logger4.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								inventory.OfflineRemove(baseKey, 1);
								changed = true;
							}
							bool flag8 = versionNeedRepairPoisonData && ModificationStateHelper.IsActive(key.ModificationState, 1);
							if (flag8)
							{
								ItemKey newItemKey = ItemKey.Invalid;
								bool flag9 = DomainManager.Item.HasOldPoisonEffects(key);
								if (flag9)
								{
									bool flag10 = !DomainManager.Item.GetOldPoisonEffects(key).HasPoison;
									if (flag10)
									{
										newItemKey = DomainManager.Item.RemoveOldPoisonEffect(context, baseKey);
									}
								}
								else
								{
									FullPoisonEffects poisonEffects;
									bool flag11 = !DomainManager.Item.PoisonEffects.TryGetValue(key.Id, out poisonEffects) || !poisonEffects.IsValid;
									if (flag11)
									{
										newItemKey = DomainManager.Item.RemovePoisonEffect(context, baseKey);
									}
								}
								bool flag12 = newItemKey.IsValid();
								if (flag12)
								{
									inventory.OfflineRemove(baseKey, 1);
									inventory.OfflineAdd(newItemKey, 1);
									changed = true;
									Logger logger5 = CharacterDomain.Logger;
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(56, 3);
									defaultInterpolatedStringHandler.AppendLiteral("Fixing abnormal item poison effect in ");
									defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
									defaultInterpolatedStringHandler.AppendLiteral("'s inventory: ");
									defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(baseKey);
									defaultInterpolatedStringHandler.AppendLiteral(" => ");
									defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(newItemKey);
									logger5.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								}
							}
							bool flag13 = versionNeedRepairExtraGoodsData && ModificationStateHelper.IsActive(key.ModificationState, 8);
							if (flag13)
							{
								inventory.OfflineRemove(baseKey, 1);
								DomainManager.Item.RemoveItem(context, baseKey);
								ItemKey newItemKey2 = DomainManager.Item.CreateItem(context, baseKey.ItemType, baseKey.TemplateId);
								inventory.OfflineAdd(newItemKey2, 1);
								ItemBase newItemBase = DomainManager.Item.GetBaseItem(newItemKey2);
								newItemBase.SetOwner(ItemOwnerType.CharacterInventory, character.GetId());
								changed = true;
								Logger logger6 = CharacterDomain.Logger;
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(59, 3);
								defaultInterpolatedStringHandler.AppendLiteral("Fixing abnormal item extra goods data in ");
								defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
								defaultInterpolatedStringHandler.AppendLiteral("'s inventory: ");
								defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(baseKey);
								defaultInterpolatedStringHandler.AppendLiteral(" => ");
								defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(newItemKey2);
								logger6.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
							}
							bool flag14 = versionNeedRepairSectAccessory;
							if (flag14)
							{
								Inventory targetInventory = (character.GetId() == DomainManager.Taiwu.GetTaiwuCharId()) ? null : inventory;
								ItemBase resultItem;
								changed = DomainManager.Item.RemoveRefinedEffectsAndReturnMaterial(context, baseKey, targetInventory, out resultItem);
								bool flag15 = changed;
								if (flag15)
								{
									inventory.OfflineRemove(baseKey);
									inventory.OfflineAdd(resultItem.GetItemKey(), 1);
									Logger logger7 = CharacterDomain.Logger;
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(60, 3);
									defaultInterpolatedStringHandler.AppendLiteral("Fixing sect accessory item refine data in ");
									defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
									defaultInterpolatedStringHandler.AppendLiteral("'s inventory: ");
									defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(baseKey);
									defaultInterpolatedStringHandler.AppendLiteral(" => ");
									defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(resultItem.GetItemKey());
									logger7.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								}
							}
						}
					}
					else
					{
						Logger logger8 = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(39, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Removing ghost item ");
						defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(key);
						defaultInterpolatedStringHandler.AppendLiteral(" from ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
						defaultInterpolatedStringHandler.AppendLiteral("'s inventory.");
						logger8.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						inventory.OfflineRemove(key, amount);
						changed = true;
					}
				}
			}
			context.AdvanceMonthRelatedData.ItemKeys.Release(ref inventoryList);
			bool flag16 = changed;
			if (flag16)
			{
				character.SetInventory(inventory, context);
			}
			ItemKey[] equipArray = character.GetEquipment();
			for (int j = 0; j < equipArray.Length; j++)
			{
				ItemKey key2 = equipArray[j];
				bool flag17 = !key2.IsValid();
				if (!flag17)
				{
					bool flag18 = !ItemTemplateHelper.CheckTemplateValid(key2.ItemType, key2.TemplateId);
					if (flag18)
					{
						Logger logger9 = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(72, 4);
						defaultInterpolatedStringHandler.AppendLiteral("Removing ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
						defaultInterpolatedStringHandler.AppendLiteral("'s equipped item ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(key2.Id);
						defaultInterpolatedStringHandler.AppendLiteral(" with invalid template: ItemType ");
						defaultInterpolatedStringHandler.AppendFormatted<sbyte>(key2.ItemType);
						defaultInterpolatedStringHandler.AppendLiteral(", TemplateId ");
						defaultInterpolatedStringHandler.AppendFormatted<short>(key2.TemplateId);
						logger9.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						equipArray[j] = ItemKey.Invalid;
						character.SetEquipment(equipArray, context);
						bool flag19 = DomainManager.Item.ItemExists(key2);
						if (flag19)
						{
							DomainManager.Item.ForceRemoveItem(context, key2);
						}
					}
					else
					{
						bool flag20 = DomainManager.Item.ItemExists(key2);
						if (flag20)
						{
							EquipmentBase baseEquipment = DomainManager.Item.GetBaseEquipment(key2);
							bool flag21 = baseEquipment.GetTemplateId() != key2.TemplateId || baseEquipment.GetId() != key2.Id;
							if (flag21)
							{
								equipArray[j] = ItemKey.Invalid;
								character.SetEquipment(equipArray, context);
								DomainManager.Item.ForceRemoveItem(context, key2);
								Logger logger10 = CharacterDomain.Logger;
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(64, 5);
								defaultInterpolatedStringHandler.AppendLiteral("Removing ");
								defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
								defaultInterpolatedStringHandler.AppendLiteral("'s equipped item ");
								defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(key2);
								defaultInterpolatedStringHandler.AppendLiteral(" whose key differs from object (");
								defaultInterpolatedStringHandler.AppendFormatted(baseEquipment.GetType().Name);
								defaultInterpolatedStringHandler.AppendLiteral(", ");
								defaultInterpolatedStringHandler.AppendFormatted<short>(baseEquipment.GetTemplateId());
								defaultInterpolatedStringHandler.AppendLiteral(", ");
								defaultInterpolatedStringHandler.AppendFormatted<int>(baseEquipment.GetId());
								defaultInterpolatedStringHandler.AppendLiteral(").");
								logger10.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
							}
							else
							{
								ItemKey baseKey2 = baseEquipment.GetItemKey();
								bool flag22 = !key2.Equals(baseKey2);
								if (flag22)
								{
									Logger logger11 = CharacterDomain.Logger;
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(37, 2);
									defaultInterpolatedStringHandler.AppendLiteral("Fixing ");
									defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
									defaultInterpolatedStringHandler.AppendLiteral("'s equipment ");
									defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(key2);
									defaultInterpolatedStringHandler.AppendLiteral("'s refine effect.");
									logger11.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
									equipArray[j] = baseKey2;
									character.SetEquipment(equipArray, context);
								}
								bool flag23 = inventory.Items.ContainsKey(key2);
								if (flag23)
								{
									inventory.OfflineRemove(key2);
									character.SetInventory(inventory, context);
									Logger logger12 = CharacterDomain.Logger;
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(68, 2);
									defaultInterpolatedStringHandler.AppendLiteral("Removing ");
									defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(key2);
									defaultInterpolatedStringHandler.AppendLiteral(" from ");
									defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
									defaultInterpolatedStringHandler.AppendLiteral("'s inventory because it already exists in equipments.");
									logger12.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								}
								else
								{
									bool flag24 = !worldCharacterItems.Add(baseKey2);
									if (flag24)
									{
										Logger logger13 = CharacterDomain.Logger;
										DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(37, 2);
										defaultInterpolatedStringHandler.AppendLiteral("Removing character ");
										defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
										defaultInterpolatedStringHandler.AppendLiteral("'s duplicate item ");
										defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(baseKey2);
										logger13.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
										bool flag25 = baseEquipment.GetEquippedCharId() == charId;
										if (flag25)
										{
											baseEquipment.SetEquippedCharId(-1, context);
										}
										equipArray[j] = ItemKey.Invalid;
										character.SetEquipment(equipArray, context);
									}
									else
									{
										bool flag26 = baseEquipment.GetEquippedCharId() != charId && character.GetCreatingType() == 1;
										if (flag26)
										{
											Logger logger14 = CharacterDomain.Logger;
											DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(40, 2);
											defaultInterpolatedStringHandler.AppendLiteral("Fixing ");
											defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
											defaultInterpolatedStringHandler.AppendLiteral("'s equipment ");
											defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(key2);
											defaultInterpolatedStringHandler.AppendLiteral("'s equipped char id.");
											logger14.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
											baseEquipment.SetEquippedCharId(charId, context);
										}
									}
								}
								bool flag27 = versionNeedRepairPoisonData && ModificationStateHelper.IsActive(key2.ModificationState, 1);
								if (flag27)
								{
									ItemKey newItemKey3 = ItemKey.Invalid;
									bool flag28 = DomainManager.Item.HasOldPoisonEffects(key2);
									if (flag28)
									{
										bool flag29 = !DomainManager.Item.GetOldPoisonEffects(key2).HasPoison;
										if (flag29)
										{
											newItemKey3 = DomainManager.Item.RemoveOldPoisonEffect(context, baseKey2);
										}
									}
									else
									{
										FullPoisonEffects poisonEffects2;
										bool flag30 = !DomainManager.Item.PoisonEffects.TryGetValue(key2.Id, out poisonEffects2) || !poisonEffects2.IsValid;
										if (flag30)
										{
											newItemKey3 = DomainManager.Item.RemovePoisonEffect(context, baseKey2);
										}
									}
									bool flag31 = newItemKey3.IsValid();
									if (flag31)
									{
										equipArray[j] = newItemKey3;
										character.SetEquipment(equipArray, context);
										Logger logger15 = CharacterDomain.Logger;
										DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(57, 3);
										defaultInterpolatedStringHandler.AppendLiteral("Fixing abnormal item poison effect in ");
										defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
										defaultInterpolatedStringHandler.AppendLiteral("'s equipments: ");
										defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(baseKey2);
										defaultInterpolatedStringHandler.AppendLiteral(" => ");
										defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(newItemKey3);
										logger15.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
									}
								}
								bool flag32 = versionNeedRepairExtraGoodsData && ModificationStateHelper.IsActive(key2.ModificationState, 8);
								if (flag32)
								{
									DomainManager.Item.RemoveItem(context, baseKey2);
									ItemKey newItemKey4 = DomainManager.Item.CreateItem(context, key2.ItemType, key2.TemplateId);
									ItemBase newItemBase2 = DomainManager.Item.GetBaseItem(newItemKey4);
									newItemBase2.SetOwner(ItemOwnerType.CharacterEquipment, character.GetId());
									equipArray[j] = newItemKey4;
									character.SetEquipment(equipArray, context);
									Logger logger16 = CharacterDomain.Logger;
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(60, 3);
									defaultInterpolatedStringHandler.AppendLiteral("Fixing abnormal item extra goods data in ");
									defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
									defaultInterpolatedStringHandler.AppendLiteral("'s equipments: ");
									defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(baseKey2);
									defaultInterpolatedStringHandler.AppendLiteral(" => ");
									defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(newItemKey4);
									logger16.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								}
								bool flag33 = versionNeedRepairSectAccessory;
								if (flag33)
								{
									Inventory targetInventory2 = (character.GetId() == DomainManager.Taiwu.GetTaiwuCharId()) ? null : inventory;
									ItemBase resultItem2;
									bool removeRefinedEffects = DomainManager.Item.RemoveRefinedEffectsAndReturnMaterial(context, baseKey2, targetInventory2, out resultItem2);
									bool flag34 = removeRefinedEffects;
									if (flag34)
									{
										equipArray[j] = resultItem2.GetItemKey();
										character.SetEquipment(equipArray, context);
										Logger logger17 = CharacterDomain.Logger;
										DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(61, 3);
										defaultInterpolatedStringHandler.AppendLiteral("Fixing sect accessory item refine data in ");
										defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
										defaultInterpolatedStringHandler.AppendLiteral("'s equipments: ");
										defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(baseKey2);
										defaultInterpolatedStringHandler.AppendLiteral(" => ");
										defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(resultItem2.GetItemKey());
										logger17.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
									}
								}
							}
						}
						else
						{
							equipArray[j] = ItemKey.Invalid;
							character.SetEquipment(equipArray, context);
							Logger logger18 = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(39, 2);
							defaultInterpolatedStringHandler.AppendLiteral("Removing ghost item ");
							defaultInterpolatedStringHandler.AppendFormatted<ItemKey>(key2);
							defaultInterpolatedStringHandler.AppendLiteral(" from ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
							defaultInterpolatedStringHandler.AppendLiteral("'s equipment.");
							logger18.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						}
					}
				}
			}
		}

		// Token: 0x06007039 RID: 28729 RVA: 0x00402054 File Offset: 0x00400254
		private void FixAbnormalPregnantState(DataContext context, Character character)
		{
			bool flag = character.GetFeatureIds().Contains(197) && !this._pregnantStates.ContainsKey(character.GetId());
			if (flag)
			{
				ValueTuple<string, string> realName = CharacterDomain.GetRealName(character);
				string surname = realName.Item1;
				string givenName = realName.Item2;
				character.RemoveFeature(context, 197);
				Logger logger = CharacterDomain.Logger;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(39, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetId());
				defaultInterpolatedStringHandler.AppendLiteral(" (");
				defaultInterpolatedStringHandler.AppendFormatted(surname + givenName);
				defaultInterpolatedStringHandler.AppendLiteral(")'s pregnant state. ");
				logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
			}
		}

		// Token: 0x0600703A RID: 28730 RVA: 0x00402114 File Offset: 0x00400314
		private void FixAbnormalCharacterOrganization(DataContext context, Character character)
		{
			bool flag = character.GetCreatingType() != 1;
			if (!flag)
			{
				int charId = character.GetId();
				OrganizationInfo orgInfo = character.GetOrganizationInfo();
				bool flag2 = orgInfo.SettlementId < 0;
				if (flag2)
				{
					bool flag3 = orgInfo.OrgTemplateId == 20 && !character.GetFeatureIds().Contains(218);
					if (flag3)
					{
						DomainManager.Organization.JoinNearbyVillageTownAsBeggar(context, character, -1);
						ValueTuple<string, string> realName = CharacterDomain.GetRealName(character);
						string surname = realName.Item1;
						string givenName = realName.Item2;
						OrganizationItem oldOrgCfg = Organization.Instance[orgInfo.OrgTemplateId];
						OrganizationItem newOrgCfg = Organization.Instance[character.GetOrganizationInfo().OrgTemplateId];
						Logger logger = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 4);
						defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
						defaultInterpolatedStringHandler.AppendLiteral(" (");
						defaultInterpolatedStringHandler.AppendFormatted(surname + givenName);
						defaultInterpolatedStringHandler.AppendLiteral(")'s organization - ");
						defaultInterpolatedStringHandler.AppendFormatted(oldOrgCfg.Name);
						defaultInterpolatedStringHandler.AppendLiteral(" => ");
						defaultInterpolatedStringHandler.AppendFormatted(newOrgCfg.Name);
						logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					else
					{
						bool flag4 = OrganizationDomain.IsLargeSect((short)orgInfo.OrgTemplateId);
						if (flag4)
						{
							orgInfo.SettlementId = DomainManager.Organization.GetSettlementIdByOrgTemplateId(orgInfo.OrgTemplateId);
							SettlementCharacter settlementChar;
							bool flag5 = !DomainManager.Organization.TryGetSettlementCharacter(charId, out settlementChar);
							if (flag5)
							{
								ValueTuple<string, string> realName2 = CharacterDomain.GetRealName(character);
								string surname2 = realName2.Item1;
								string givenName2 = realName2.Item2;
								Logger logger2 = CharacterDomain.Logger;
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 3);
								defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
								defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
								defaultInterpolatedStringHandler.AppendLiteral(" (");
								defaultInterpolatedStringHandler.AppendFormatted(surname2 + givenName2);
								defaultInterpolatedStringHandler.AppendLiteral(")'s organization - ");
								defaultInterpolatedStringHandler.AppendFormatted(Organization.Instance[orgInfo.OrgTemplateId].Name);
								logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								DomainManager.Organization.JoinOrganization(context, character, orgInfo);
							}
							character.SetOrganizationInfo(orgInfo, context);
						}
					}
				}
				else
				{
					SettlementCharacter settlementChar2;
					bool flag6 = !DomainManager.Organization.TryGetSettlementCharacter(charId, out settlementChar2);
					if (flag6)
					{
						ValueTuple<string, string> realName3 = CharacterDomain.GetRealName(character);
						string surname3 = realName3.Item1;
						string givenName3 = realName3.Item2;
						Logger logger3 = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
						defaultInterpolatedStringHandler.AppendLiteral(" (");
						defaultInterpolatedStringHandler.AppendFormatted(surname3 + givenName3);
						defaultInterpolatedStringHandler.AppendLiteral(")'s organization - ");
						defaultInterpolatedStringHandler.AppendFormatted(Organization.Instance[orgInfo.OrgTemplateId].Name);
						logger3.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						DomainManager.Organization.JoinOrganization(context, character, orgInfo);
					}
				}
			}
		}

		// Token: 0x0600703B RID: 28731 RVA: 0x00402408 File Offset: 0x00400608
		private void FixAbnormalCharacterCombatSkillBreakoutCount(DataContext context, Character character)
		{
			bool flag = Character.Instance[character.GetTemplateId()].CreatingType > 0;
			if (!flag)
			{
				Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> charCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(character.GetId());
				foreach (KeyValuePair<short, GameData.Domains.CombatSkill.CombatSkill> keyValuePair in charCombatSkills)
				{
					short num;
					GameData.Domains.CombatSkill.CombatSkill combatSkill2;
					keyValuePair.Deconstruct(out num, out combatSkill2);
					short skillTemplateId = num;
					GameData.Domains.CombatSkill.CombatSkill combatSkill = combatSkill2;
					bool flag2 = combatSkill.GetBreakoutStepsCount() > GlobalConfig.Instance.BreakoutMaxAvailableStepsCount;
					if (flag2)
					{
						Logger logger = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(44, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetId());
						defaultInterpolatedStringHandler.AppendLiteral(" (");
						defaultInterpolatedStringHandler.AppendFormatted(character.GetSurname() + character.GetGivenName());
						defaultInterpolatedStringHandler.AppendLiteral(")'s skill ");
						defaultInterpolatedStringHandler.AppendFormatted<CombatSkillItem>(Config.CombatSkill.Instance[skillTemplateId]);
						defaultInterpolatedStringHandler.AppendLiteral(" breakout step.");
						logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						combatSkill.SetBreakoutStepsCount(GlobalConfig.Instance.BreakoutMaxAvailableStepsCount, context);
					}
				}
			}
		}

		// Token: 0x0600703C RID: 28732 RVA: 0x0040255C File Offset: 0x0040075C
		private void FixCharacterConsummateLevel(DataContext context, Character character)
		{
			sbyte consummateLevel = character.GetConsummateLevel();
			bool flag = consummateLevel >= 0 && (int)consummateLevel < ConsummateLevel.Instance.Count;
			if (!flag)
			{
				sbyte fixedConsummateLevel = (sbyte)Math.Clamp((int)consummateLevel, 0, ConsummateLevel.Instance.Count - 1);
				character.SetConsummateLevel(fixedConsummateLevel, context);
				Logger logger = CharacterDomain.Logger;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(41, 3);
				defaultInterpolatedStringHandler.AppendLiteral("Fixing ");
				defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
				defaultInterpolatedStringHandler.AppendLiteral("'s abnormal consummate level: ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(consummateLevel);
				defaultInterpolatedStringHandler.AppendLiteral(" => ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(fixedConsummateLevel);
				logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
			}
		}

		// Token: 0x0600703D RID: 28733 RVA: 0x00402608 File Offset: 0x00400808
		private unsafe void FixCharacterMaxNeili(DataContext context, Character character)
		{
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> combatSkills = DomainManager.CombatSkill.GetCharCombatSkills(character.GetId());
			foreach (KeyValuePair<short, GameData.Domains.CombatSkill.CombatSkill> keyValuePair in combatSkills)
			{
				short num;
				GameData.Domains.CombatSkill.CombatSkill combatSkill2;
				keyValuePair.Deconstruct(out num, out combatSkill2);
				short combatSkillTemplateId = num;
				GameData.Domains.CombatSkill.CombatSkill combatSkill = combatSkill2;
				short obtainedNeili = combatSkill.GetObtainedNeili();
				bool flag = obtainedNeili < 0;
				if (flag)
				{
					short obtainableNeili = combatSkill.GetTotalObtainableNeili();
					combatSkill.SetObtainedNeili(obtainableNeili, context);
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(54, 4);
					defaultInterpolatedStringHandler.AppendLiteral("Fixing ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
					defaultInterpolatedStringHandler.AppendLiteral("'s abnormal combat skill ");
					defaultInterpolatedStringHandler.AppendFormatted(Config.CombatSkill.Instance[combatSkillTemplateId].Name);
					defaultInterpolatedStringHandler.AppendLiteral("'s obtained neili ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(obtainedNeili);
					defaultInterpolatedStringHandler.AppendLiteral(" => ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(obtainableNeili);
					logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
			NeiliAllocation baseNeiliAllocation = character.GetBaseNeiliAllocation();
			bool flag2 = baseNeiliAllocation.GetTotal() < 0;
			if (flag2)
			{
				character.ResetBaseNeiliAllocation(context);
				Logger logger2 = CharacterDomain.Logger;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(46, 3);
				defaultInterpolatedStringHandler.AppendLiteral("Fixing ");
				defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
				defaultInterpolatedStringHandler.AppendLiteral("'s abnormal base neili allocation: ");
				defaultInterpolatedStringHandler.AppendFormatted<NeiliAllocation>(baseNeiliAllocation);
				defaultInterpolatedStringHandler.AppendLiteral(" => ");
				defaultInterpolatedStringHandler.AppendFormatted<NeiliAllocation>(character.GetBaseNeiliAllocation());
				logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			else
			{
				int maxNeili = character.GetMaxNeili();
				sbyte consummateLevel = character.GetConsummateLevel();
				short maxTotalNeiliAllocation = CombatHelper.GetMaxTotalNeiliAllocationConsideringFeature(consummateLevel, character.GetFeatureIds());
				bool flag3 = maxNeili < 0;
				if (flag3)
				{
					NeiliAllocation newAllocation = baseNeiliAllocation;
					for (int type = 0; type < 4; type++)
					{
						bool flag4 = *(ref newAllocation.Items.FixedElementField + (IntPtr)type * 2) > 100;
						if (flag4)
						{
							*(ref newAllocation.Items.FixedElementField + (IntPtr)type * 2) = 100;
						}
					}
					character.SetBaseNeiliAllocation(newAllocation, context);
					while (character.GetMaxNeili() < 0 || newAllocation.GetTotal() > maxTotalNeiliAllocation)
					{
						sbyte maxType = -1;
						int maxTypeValue = 0;
						for (sbyte type2 = 0; type2 < 4; type2 += 1)
						{
							bool flag5 = (int)(*(ref newAllocation.Items.FixedElementField + (IntPtr)type2 * 2)) <= maxTypeValue;
							if (!flag5)
							{
								maxTypeValue = (int)(*(ref newAllocation.Items.FixedElementField + (IntPtr)type2 * 2));
								maxType = type2;
							}
						}
						bool flag6 = maxType >= 0;
						if (flag6)
						{
							*(ref newAllocation.Items.FixedElementField + (IntPtr)maxType * 2) = (short)(maxTypeValue - 1);
							character.SetBaseNeiliAllocation(newAllocation, context);
						}
					}
					Logger logger3 = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(46, 3);
					defaultInterpolatedStringHandler.AppendLiteral("Fixing ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
					defaultInterpolatedStringHandler.AppendLiteral("'s abnormal base neili allocation: ");
					defaultInterpolatedStringHandler.AppendFormatted<NeiliAllocation>(baseNeiliAllocation);
					defaultInterpolatedStringHandler.AppendLiteral(" => ");
					defaultInterpolatedStringHandler.AppendFormatted<NeiliAllocation>(newAllocation);
					logger3.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					Logger logger4 = CharacterDomain.Logger;
					defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 3);
					defaultInterpolatedStringHandler.AppendLiteral("Fixing ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
					defaultInterpolatedStringHandler.AppendLiteral("'s abnormal max neili: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(maxNeili);
					defaultInterpolatedStringHandler.AppendLiteral(" => ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetMaxNeili());
					logger4.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
		}

		// Token: 0x0600703E RID: 28734 RVA: 0x004029B8 File Offset: 0x00400BB8
		private void FixCharacterCurrNeili(DataContext context, Character character)
		{
			int currNeili = character.GetCurrNeili();
			bool flag = currNeili >= 0;
			if (!flag)
			{
				int maxNeili = character.GetMaxNeili();
				character.SetCurrNeili(maxNeili, context);
				Logger logger = CharacterDomain.Logger;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 3);
				defaultInterpolatedStringHandler.AppendLiteral("Fix abnormal currNeili for ");
				defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
				defaultInterpolatedStringHandler.AppendLiteral(": ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(currNeili);
				defaultInterpolatedStringHandler.AppendLiteral(" => ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(maxNeili);
				logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
			}
		}

		// Token: 0x0600703F RID: 28735 RVA: 0x00402A48 File Offset: 0x00400C48
		private void FixAbnormalGroupState(DataContext context, Character character)
		{
			int charId = character.GetId();
			int leaderId = character.GetLeaderId();
			bool flag = leaderId < 0;
			if (!flag)
			{
				bool flag2 = leaderId == DomainManager.Taiwu.GetTaiwuCharId() && DomainManager.Taiwu.IsInGroup(charId);
				if (!flag2)
				{
					bool flag3 = this._joinGroupDates.ContainsKey(charId);
					if (!flag3)
					{
						IReadOnlySet<int> specialGroup = DomainManager.Extra.GetSpecialGroup(leaderId);
						bool flag4 = specialGroup.Contains(charId);
						if (!flag4)
						{
							character.SetLeaderId(-1, context);
							Logger logger = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(53, 2);
							defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
							defaultInterpolatedStringHandler.AppendLiteral("'s invalid group state with leader ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(leaderId);
							defaultInterpolatedStringHandler.AppendLiteral(".");
							logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						}
					}
				}
			}
		}

		// Token: 0x06007040 RID: 28736 RVA: 0x00402B24 File Offset: 0x00400D24
		private unsafe void FixAbnormalInsectFeature(DataContext context, Character character)
		{
			List<short> featureIds = character.GetFeatureIds();
			bool flag = !featureIds.Contains(339);
			if (!flag)
			{
				int charId = character.GetId();
				RelatedCharacters relatedChars = this.GetRelatedCharacters(charId);
				int* actualBloodParents = stackalloc int[(UIntPtr)8];
				this.GetActualBloodParents(charId, relatedChars, actualBloodParents);
				int fatherId = actualBloodParents[1];
				int motherId = *actualBloodParents;
				bool flag2 = fatherId < 0 || motherId < 0 || fatherId == motherId;
				if (!flag2)
				{
					bool flag3 = !this.IsInsect(fatherId, motherId);
					if (flag3)
					{
						character.RemoveFeature(context, 339);
						Logger logger = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(46, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Removing character ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
						defaultInterpolatedStringHandler.AppendLiteral("'s abnormal insect feature.");
						logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					}
				}
			}
		}

		// Token: 0x06007041 RID: 28737 RVA: 0x00402BF8 File Offset: 0x00400DF8
		private void FixAbnormalFeature(DataContext context, Character character)
		{
			bool featureChanged = false;
			int charId = character.GetId();
			List<short> featureIds = character.GetFeatureIds();
			for (int i = featureIds.Count - 1; i >= 0; i--)
			{
				short featureId = featureIds[i];
				CharacterFeatureItem config = CharacterFeature.Instance[featureId];
				bool flag = config == null;
				if (flag)
				{
					featureIds.RemoveAt(i);
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(39, 2);
					defaultInterpolatedStringHandler.AppendLiteral("Removing character ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
					defaultInterpolatedStringHandler.AppendLiteral("'s invalid feature ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(featureId);
					defaultInterpolatedStringHandler.AppendLiteral(".");
					logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					featureChanged = true;
				}
				else
				{
					bool flag2 = config.Duration > 0;
					if (flag2)
					{
						int num;
						bool flag3 = !DomainManager.Extra.TryGetTemporaryFeatureExpireDate(charId, featureId, out num) && character.GetCreatingType() == 1;
						if (flag3)
						{
							DomainManager.Extra.RegisterCharacterTemporaryFeature(context, charId, featureId, -1);
							Logger logger2 = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(45, 2);
							defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
							defaultInterpolatedStringHandler.AppendLiteral("'s feature ");
							defaultInterpolatedStringHandler.AppendFormatted(config.Name);
							defaultInterpolatedStringHandler.AppendLiteral("'s expiring date.");
							logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
							featureChanged = true;
						}
					}
				}
			}
			bool flag4 = featureChanged;
			if (flag4)
			{
				character.SetFeatureIds(featureIds, context);
			}
		}

		// Token: 0x06007042 RID: 28738 RVA: 0x00402D7C File Offset: 0x00400F7C
		private void FixAbnormalCharacterLocation(DataContext context, Character character)
		{
			int charId = character.GetId();
			Location location = character.GetLocation();
			int leaderId = character.GetLeaderId();
			bool flag = character.GetCreatingType() != 1;
			if (!flag)
			{
				bool flag2 = character.IsActiveExternalRelationState(60);
				if (!flag2)
				{
					int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
					bool flag3 = taiwuCharId == charId;
					if (!flag3)
					{
						bool flag4 = character.GetKidnapperId() >= 0;
						if (!flag4)
						{
							bool flag5 = location.IsValid();
							if (flag5)
							{
								MapBlockData block = DomainManager.Map.GetBlock(location);
								bool flag6 = character.IsCompletelyInfected();
								if (flag6)
								{
									bool flag7 = block.InfectedCharacterSet != null && block.InfectedCharacterSet.Contains(charId);
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler;
									if (flag7)
									{
										bool flag8 = !block.IsPassable();
										if (flag8)
										{
											short edgeBlockId = DomainManager.Map.GetRandomEdgeBlock(context.Random, block.AreaId, (sbyte)context.Random.Next(4));
											this.GroupMove(context, character, new Location(location.AreaId, edgeBlockId));
											Logger logger = CharacterDomain.Logger;
											defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 2);
											defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
											defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
											defaultInterpolatedStringHandler.AppendLiteral("'s not passable location ");
											defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
											logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
										}
										return;
									}
									bool flag9 = DomainManager.Taiwu.IsInGroup(charId);
									if (flag9)
									{
										return;
									}
									block.AddInfectedCharacter(charId);
									DomainManager.Map.SetBlockData(context, block);
									Logger logger2 = CharacterDomain.Logger;
									defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(36, 2);
									defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
									defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
									defaultInterpolatedStringHandler.AppendLiteral("'s hidden state at ");
									defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
									logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								}
								else
								{
									bool flag10 = block.CharacterSet != null && block.CharacterSet.Contains(charId);
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler;
									if (flag10)
									{
										bool flag11 = !block.IsPassable();
										if (flag11)
										{
											short edgeBlockId2 = DomainManager.Map.GetRandomEdgeBlock(context.Random, block.AreaId, (sbyte)context.Random.Next(4));
											this.GroupMove(context, character, new Location(location.AreaId, edgeBlockId2));
											Logger logger3 = CharacterDomain.Logger;
											defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 2);
											defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
											defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
											defaultInterpolatedStringHandler.AppendLiteral("'s not passable location ");
											defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
											logger3.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
										}
										return;
									}
									bool flag12 = DomainManager.Taiwu.IsInGroup(charId);
									if (flag12)
									{
										return;
									}
									block.AddCharacter(charId);
									DomainManager.Map.SetBlockData(context, block);
									Logger logger4 = CharacterDomain.Logger;
									defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(36, 2);
									defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
									defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
									defaultInterpolatedStringHandler.AppendLiteral("'s hidden state at ");
									defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
									logger4.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								}
							}
							else
							{
								bool flag13 = character.IsCrossAreaTraveling() || leaderId == taiwuCharId;
								if (flag13)
								{
									return;
								}
							}
							bool flag14 = leaderId >= 0;
							if (flag14)
							{
								Location leaderLocation = this._objects[leaderId].GetLocation();
								bool flag15 = !leaderLocation.Equals(location);
								if (flag15)
								{
									Events.RaiseCharacterLocationChanged(context, charId, location, leaderLocation);
									character.SetLocation(leaderLocation, context);
									Logger logger5 = CharacterDomain.Logger;
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 3);
									defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
									defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
									defaultInterpolatedStringHandler.AppendLiteral("'s location from ");
									defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
									defaultInterpolatedStringHandler.AppendLiteral(" to ");
									defaultInterpolatedStringHandler.AppendFormatted<Location>(character.GetLocation());
									logger5.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								}
								else
								{
									bool flag16 = !leaderLocation.IsValid();
									if (flag16)
									{
										Location birthLocation = character.GetBirthLocation();
										Location targetLocation = birthLocation.IsValid() ? birthLocation : DomainManager.Taiwu.GetTaiwuVillageLocation();
										this.GroupMove(context, character, targetLocation);
										Logger logger6 = CharacterDomain.Logger;
										DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 3);
										defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
										defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
										defaultInterpolatedStringHandler.AppendLiteral("'s location from ");
										defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
										defaultInterpolatedStringHandler.AppendLiteral(" to ");
										defaultInterpolatedStringHandler.AppendFormatted<Location>(character.GetLocation());
										logger6.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
									}
								}
							}
							else
							{
								bool flag17 = !location.IsValid();
								if (flag17)
								{
									Location birthLocation2 = character.GetBirthLocation();
									Location targetLocation2 = birthLocation2.IsValid() ? birthLocation2 : DomainManager.Taiwu.GetTaiwuVillageLocation();
									bool flag18 = character.IsCompletelyInfected();
									if (flag18)
									{
										Events.RaiseInfectedCharacterLocationChanged(context, charId, location, targetLocation2);
									}
									else
									{
										Events.RaiseCharacterLocationChanged(context, charId, location, targetLocation2);
									}
									character.SetLocation(targetLocation2, context);
									Logger logger7 = CharacterDomain.Logger;
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 3);
									defaultInterpolatedStringHandler.AppendLiteral("Fixing character ");
									defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
									defaultInterpolatedStringHandler.AppendLiteral("'s location from ");
									defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
									defaultInterpolatedStringHandler.AppendLiteral(" to ");
									defaultInterpolatedStringHandler.AppendFormatted<Location>(character.GetLocation());
									logger7.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06007043 RID: 28739 RVA: 0x004032E0 File Offset: 0x004014E0
		private void FixMerchantCharToType(DataContext context, Character character)
		{
			int charId = character.GetId();
			OrganizationInfo organizationInfo = character.GetOrganizationInfo();
			OrganizationItem organizationConfig = Organization.Instance[organizationInfo.OrgTemplateId];
			OrganizationMemberItem organizationMemberConfig = OrganizationDomain.GetOrgMemberConfig(organizationInfo);
			List<sbyte> identityInteractConfig = organizationMemberConfig.IdentityInteractConfig;
			bool flag = organizationConfig.IsCivilian && organizationInfo.Grade == 4 && identityInteractConfig != null && identityInteractConfig.Contains(4);
			if (flag)
			{
				sbyte b;
				bool flag2 = !DomainManager.Extra.TryGetMerchantCharToType(charId, out b);
				if (flag2)
				{
					MerchantData merchantData;
					bool flag3 = DomainManager.Merchant.TryGetMerchantData(charId, out merchantData);
					sbyte type;
					if (flag3)
					{
						type = merchantData.MerchantType;
					}
					else
					{
						type = (sbyte)context.Random.Next(7);
					}
					DomainManager.Extra.AddMerchantCharToType(charId, type, context);
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(39, 2);
					defaultInterpolatedStringHandler.AppendLiteral("Fix abnormal merchant type for ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
					defaultInterpolatedStringHandler.AppendLiteral(": _ => ");
					defaultInterpolatedStringHandler.AppendFormatted<sbyte>(type);
					defaultInterpolatedStringHandler.AppendLiteral(".");
					logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
			else
			{
				sbyte type2;
				bool flag4 = DomainManager.Extra.TryGetMerchantCharToType(charId, out type2);
				if (flag4)
				{
					VillagerRoleBase villagerRole = DomainManager.Extra.GetVillagerRole(charId);
					bool flag5 = !(villagerRole is VillagerRoleMerchant);
					if (flag5)
					{
						DomainManager.Extra.RemoveMerchantCharToType(charId, context);
						Logger logger2 = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Fix abnormal merchant type for ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
						defaultInterpolatedStringHandler.AppendLiteral(": ");
						defaultInterpolatedStringHandler.AppendFormatted<sbyte>(type2);
						defaultInterpolatedStringHandler.AppendLiteral(" => _");
						logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					}
				}
			}
		}

		// Token: 0x06007044 RID: 28740 RVA: 0x00403498 File Offset: 0x00401698
		private unsafe void MigratePrioritizedActionCooldown(DataContext context)
		{
			int currDate = DomainManager.World.GetCurrDate();
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				int date;
				bool flag = DomainManager.Extra.TryPopAiActionCooldownData(context, charId, 0, 9, out date);
				if (flag)
				{
					DomainManager.Extra.SetPrioritizedActionCooldown(context, charId, 9, (short)(date - currDate));
				}
				PrioritizedActionCooldownSbytes data = character.GetPrioritizedActionCooldowns();
				for (sbyte actionType = 0; actionType < 9; actionType += 1)
				{
					bool flag2 = *(ref data.Items.FixedElementField + actionType) > 0;
					if (flag2)
					{
						DomainManager.Extra.SetPrioritizedActionCooldown(context, charId, (short)actionType, (short)(*(ref data.Items.FixedElementField + actionType)));
					}
				}
				data.SetAllActionCooldown(0);
				character.SetPrioritizedActionCooldowns(data, context);
			}
		}

		// Token: 0x06007045 RID: 28741 RVA: 0x004035AC File Offset: 0x004017AC
		private void FixAbnormalPrioritizedAction73(DataContext context)
		{
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				BasePrioritizedAction action;
				bool flag = !this.TryGetCharacterPrioritizedAction(charId, out action);
				if (!flag)
				{
					bool flag2 = action.ActionType != 18;
					if (!flag2)
					{
						Logger logger = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(52, 2);
						defaultInterpolatedStringHandler.AppendLiteral("fix abnormal prioritized action target location: ");
						defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
						defaultInterpolatedStringHandler.AppendLiteral(", ");
						defaultInterpolatedStringHandler.AppendFormatted<Location>(action.Target.GetRealTargetLocation());
						defaultInterpolatedStringHandler.AppendLiteral(" ");
						logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						Location targetLocation = character.CalcFurthestEscapeDestination(context.Random);
						action.Target = new NpcTravelTarget(targetLocation, action.Target.RemainingMonth);
						this.SetCharacterPrioritizedAction(context, charId);
					}
				}
			}
		}

		// Token: 0x06007046 RID: 28742 RVA: 0x004036D8 File Offset: 0x004018D8
		private void FixAbnormalPrioritizedAction71(DataContext context)
		{
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character;
				keyValuePair.Deconstruct(out num, out character);
				int charId = num;
				BasePrioritizedAction prevAction;
				bool flag = this.TryGetCharacterPrioritizedAction(charId, out prevAction);
				if (flag)
				{
					bool flag2 = prevAction.ActionType == 11;
					if (flag2)
					{
						SectStoryShixiangToFightEnemyAction newAction = new SectStoryShixiangToFightEnemyAction
						{
							Target = prevAction.Target
						};
						DomainManager.Character.RemoveCharacterPrioritizedAction(context, charId);
						DomainManager.Character.AddCharacterPrioritizedAction(context, charId, newAction);
						Logger logger = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(36, 2);
						defaultInterpolatedStringHandler.AppendLiteral("fix abnormal prioritized action: ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
						defaultInterpolatedStringHandler.AppendLiteral(", ");
						defaultInterpolatedStringHandler.AppendFormatted<short>(newAction.ActionType);
						defaultInterpolatedStringHandler.AppendLiteral(" ");
						logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					else
					{
						bool flag3 = prevAction.ActionType == 12;
						if (flag3)
						{
							AdoptInfantAction newAction2 = new AdoptInfantAction
							{
								Target = prevAction.Target
							};
							DomainManager.Character.RemoveCharacterPrioritizedAction(context, charId);
							DomainManager.Character.AddCharacterPrioritizedAction(context, charId, newAction2);
							Logger logger2 = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(36, 2);
							defaultInterpolatedStringHandler.AppendLiteral("fix abnormal prioritized action: ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
							defaultInterpolatedStringHandler.AppendLiteral(", ");
							defaultInterpolatedStringHandler.AppendFormatted<short>(newAction2.ActionType);
							defaultInterpolatedStringHandler.AppendLiteral(" ");
							logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						}
					}
				}
			}
		}

		// Token: 0x06007047 RID: 28743 RVA: 0x004038A8 File Offset: 0x00401AA8
		private void FixInteractedCharacters(DataContext context)
		{
			bool needFix = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 74, 11);
			bool flag = !needFix;
			if (!flag)
			{
				int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
				foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
				{
					int num;
					Character character;
					keyValuePair.Deconstruct(out num, out character);
					int charId = num;
					RelatedCharacter relation;
					bool flag2 = this.TryGetRelation(taiwuCharId, charId, out relation);
					if (flag2)
					{
						DomainManager.Extra.AddInteractedCharacter(context, charId);
					}
				}
			}
		}

		// Token: 0x06007048 RID: 28744 RVA: 0x00403958 File Offset: 0x00401B58
		public void FixElopeWithLoveWrongState(DataContext context)
		{
			bool needFix = DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 75, 0);
			bool flag = !needFix;
			if (!flag)
			{
				foreach (KeyValuePair<int, Character> pair in this._objects)
				{
					bool flag2 = pair.Value.IsActiveExternalRelationState(32) && pair.Value.GetLocation().IsValid() && !pair.Value.IsActiveExternalRelationState(16);
					if (flag2)
					{
						sbyte sectTemplateId = DomainManager.Organization.GetPrisonerSect(pair.Key);
						bool flag3 = sectTemplateId == -1;
						if (!flag3)
						{
							Settlement targetSettlement = DomainManager.Organization.GetSettlementByOrgTemplateId(sectTemplateId);
							bool flag4 = targetSettlement == null;
							if (!flag4)
							{
								Sect sect = targetSettlement as Sect;
								bool flag5 = sect != null;
								if (flag5)
								{
									sect.RemovePrisoner(context, pair.Key);
									Logger logger = CharacterDomain.Logger;
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(46, 1);
									defaultInterpolatedStringHandler.AppendLiteral("Remove prison state beacuse ");
									defaultInterpolatedStringHandler.AppendFormatted<int>(pair.Key);
									defaultInterpolatedStringHandler.AppendLiteral(" location is valid");
									logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								}
							}
						}
					}
				}
				EventArgBox globalEventArgBox = DomainManager.TaiwuEvent.GetGlobalEventArgumentBox();
				for (short areaId = 0; areaId < 45; areaId += 1)
				{
					AreaAdventureData adventureData = DomainManager.Adventure.GetAdventuresInArea(areaId);
					foreach (KeyValuePair<short, AdventureSiteData> pair2 in adventureData.AdventureSites)
					{
						bool flag6 = pair2.Value.TemplateId == 28;
						if (flag6)
						{
							int charId = globalEventArgBox.GetInt("StoryForeverLoverId");
							Character character;
							bool flag7 = this.TryGetElement_Objects(charId, out character);
							if (flag7)
							{
								bool flag8 = character.IsActiveExternalRelationState(32);
								if (flag8)
								{
									DomainManager.Adventure.RemoveAdventureSite(context, areaId, pair2.Key, false, false);
									globalEventArgBox.Remove<int>("StoryForeverLoverId");
									Logger logger2 = CharacterDomain.Logger;
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(53, 1);
									defaultInterpolatedStringHandler.AppendLiteral("Remove ElopeWithLove Adventure beacuse ");
									defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
									defaultInterpolatedStringHandler.AppendLiteral(" is hide state");
									logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
									return;
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06007049 RID: 28745 RVA: 0x00403C04 File Offset: 0x00401E04
		private void InitializeCombatSkillProficiencies(DataContext context)
		{
			int taiwuId = DomainManager.Taiwu.GetTaiwuCharId();
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				bool flag = charId != taiwuId;
				if (flag)
				{
					DomainManager.Extra.InitCombatSkillProficiency(context, character);
				}
			}
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(50, 1);
			defaultInterpolatedStringHandler.AppendFormatted<int>(this._objects.Count - 1);
			defaultInterpolatedStringHandler.AppendLiteral(" characters' proficiency data has been initialized");
			logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x0600704A RID: 28746 RVA: 0x00403CCC File Offset: 0x00401ECC
		public void SortCharacterListByLifeSkill(List<int> managerList, sbyte lifeSkillType)
		{
			managerList.Sort((int l, int r) => this._objects[l].GetLifeSkillAttainment(lifeSkillType).CompareTo(this._objects[r].GetLifeSkillAttainment(lifeSkillType)));
		}

		// Token: 0x0600704B RID: 28747 RVA: 0x00403D04 File Offset: 0x00401F04
		[DomainMethod]
		public List<IntPair> SortCharacterListByMaxCombatSkill(List<int> managerList)
		{
			managerList.Sort((int l, int r) => this._objects[l].GetMaxCombatSkillAttainment().CompareTo(this._objects[r].GetMaxCombatSkillAttainment()));
			List<IntPair> managerCombatSkill = new List<IntPair>();
			for (int i = 0; i < managerList.Count; i++)
			{
				managerCombatSkill.Add(new IntPair(managerList[i], (int)this._objects[managerList[i]].GetMaxCombatSkillAttainment()));
			}
			return managerCombatSkill;
		}

		// Token: 0x0600704C RID: 28748 RVA: 0x00403D74 File Offset: 0x00401F74
		[DomainMethod]
		public ValueTuple<sbyte, short> GetCharacterMaxCombatSkillAttainment(int charId)
		{
			return this._objects[charId].GetMaxCombatSkillAttainmentType();
		}

		// Token: 0x0600704D RID: 28749 RVA: 0x00403D98 File Offset: 0x00401F98
		private void FixKidnappedCharResistance(DataContext context)
		{
			bool flag = DomainManager.World.GetCurrWorldGameVersion() != null && !DomainManager.World.IsCurrWorldBeforeVersion(0, 0, 79, 0);
			if (!flag)
			{
				List<int> keyList = this._kidnappedChars.Keys.ToList<int>();
				foreach (int key in keyList)
				{
					KidnappedCharacterList kidnappedCharacterList = this._kidnappedChars[key];
					bool flag2 = kidnappedCharacterList == null || kidnappedCharacterList.GetCount() == 0;
					if (!flag2)
					{
						foreach (KidnappedCharacter kidnappedCharacter in kidnappedCharacterList.GetCollection())
						{
							kidnappedCharacter.ExtraResistance = 0;
						}
						this.SetElement_KidnappedChars(key, kidnappedCharacterList, context);
					}
				}
			}
		}

		// Token: 0x0600704E RID: 28750 RVA: 0x00403E9C File Offset: 0x0040209C
		public bool HandleAttackAction(DataContext context, Character selfChar, Character targetChar)
		{
			Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
			int selfCharId = selfChar.GetId();
			int targetCharId = targetChar.GetId();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int selfLeaderId = selfChar.GetLeaderId();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			Location location = selfChar.GetLocation();
			bool flag = selfCharId == taiwuCharId;
			bool result3;
			if (flag)
			{
				AiHelper.NpcCombatResultType resultType = this.SimulateCharacterCombat(context, selfChar, targetChar, CombatType.Beat, false, 1);
				bool flag2 = resultType <= AiHelper.NpcCombatResultType.MinorVictory;
				bool isVictory = flag2;
				bool flag3 = isVictory;
				if (flag3)
				{
					this.SimulateCharacterCombatResult(context, selfChar, targetChar, -2147483647, -2147483647, 100);
				}
				else
				{
					this.SimulateCharacterCombatResult(context, targetChar, selfChar, -2147483647, -2147483647, 100);
				}
				result3 = isVictory;
			}
			else
			{
				bool flag4 = selfLeaderId >= 0 && selfLeaderId == targetChar.GetLeaderId();
				if (flag4)
				{
					this.LeaveGroup(context, selfChar, true);
				}
				bool flag5 = taiwuCharId == targetCharId;
				if (flag5)
				{
					CharacterDomain.AddLockMovementCharSet(selfCharId);
					MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
					bool flag6 = selfChar.IsCompletelyInfected();
					if (flag6)
					{
						bool flag7 = DomainManager.Extra.IsAiActionInCooldown(selfCharId, 3, 1);
						if (flag7)
						{
							return false;
						}
						monthlyEventCollection.AddInfectedCharacterAttack(location, selfCharId);
						DomainManager.Extra.AddAiActionCooldown(context, selfCharId, 3, 1, 3);
					}
					else
					{
						bool flag8 = DomainManager.LegendaryBook.IsCharacterActingCrazy(selfChar);
						if (flag8)
						{
							bool flag9 = DomainManager.Extra.IsAiActionInCooldown(selfCharId, 3, 2);
							if (flag9)
							{
								return false;
							}
							switch (selfChar.GetLegendaryBookOwnerState())
							{
							case 1:
								monthlyEventCollection.AddLegendaryBookShockedAttack(taiwuCharId, location, selfCharId);
								break;
							case 2:
								monthlyEventCollection.AddLegendaryBookInsaneAttack(taiwuCharId, location, selfCharId);
								break;
							case 3:
								monthlyEventCollection.AddLegendaryBookConsumedAttack(taiwuCharId, location, selfCharId);
								break;
							}
							DomainManager.Extra.AddAiActionCooldown(context, selfCharId, 3, 2, 3);
						}
						else
						{
							bool flag10 = DomainManager.Extra.IsAiActionInCooldown(selfCharId, 3, 0);
							if (flag10)
							{
								return false;
							}
							monthlyEventCollection.AddRevengeAttack(targetCharId, location, selfCharId);
							DomainManager.Extra.AddAiActionCooldown(context, selfCharId, 3, 0, 3);
						}
					}
					result3 = true;
				}
				else
				{
					bool flag11 = location.Equals(taiwuChar.GetLocation()) && (targetChar.GetLeaderId() == taiwuCharId || (this.CheckRequestHelpFromTaiwu(context.Random, targetCharId, taiwuCharId) && this.CheckNeedProtection(targetChar, selfChar))) && !selfChar.IsCompletelyInfected() && !DomainManager.LegendaryBook.IsCharacterActingCrazy(selfChar);
					if (flag11)
					{
						MonthlyEventCollection monthlyEventCollection2 = DomainManager.World.GetMonthlyEventCollection();
						monthlyEventCollection2.AddAskProtectByRevengeAttack(targetCharId, location, selfCharId, taiwuCharId);
						result3 = true;
					}
					else
					{
						MapBlockData blockData = DomainManager.Map.GetBlock(location);
						bool flag12 = blockData.CharacterSet != null;
						bool flag2;
						if (flag12)
						{
							foreach (int charId in blockData.CharacterSet)
							{
								bool flag13 = charId == selfCharId;
								if (!flag13)
								{
									BasePrioritizedAction protectorAction;
									bool flag14 = !this.TryGetCharacterPrioritizedAction(charId, out protectorAction) || protectorAction.ActionType != 2 || protectorAction.Target.TargetCharId != targetCharId;
									if (!flag14)
									{
										Character protector = this.GetElement_Objects(charId);
										bool flag15 = protector.NeedToAvoidCombat(CombatType.Die) || DomainManager.LegendaryBook.IsCharacterActingCrazy(protector);
										if (!flag15)
										{
											SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
											int secretInfoOffset = secretInformationCollection.AddOfferProtection(charId, targetCharId, selfCharId);
											int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
											bool flag16 = this.IsTaiwuPeople(charId) || this.IsTaiwuPeople(targetCharId);
											if (flag16)
											{
												MonthlyNotificationCollection monthlyNotifications = DomainManager.World.GetMonthlyNotificationCollection();
												monthlyNotifications.AddProtectRelativeOrFriend(charId, targetCharId, selfCharId);
											}
											lifeRecordCollection.AddOfferProtection(charId, currDate, targetCharId, location);
											AiHelper.NpcCombatResultType result = this.SimulateCharacterCombat(context, selfChar, protector, CombatType.Die, true, 1);
											flag2 = (result <= AiHelper.NpcCombatResultType.MinorVictory);
											bool flag17 = flag2;
											if (flag17)
											{
												this.SimulateCharacterCombatResult(context, selfChar, protector, 60, 60, 60);
												return true;
											}
											this.SimulateCharacterCombatResult(context, protector, selfChar, 60, 60, 60);
											return false;
										}
									}
								}
							}
						}
						AiHelper.NpcCombatResultType result2 = this.SimulateCharacterCombat(context, selfChar, targetChar, CombatType.Die, true, 1);
						flag2 = (result2 <= AiHelper.NpcCombatResultType.MinorVictory);
						bool flag18 = flag2;
						if (flag18)
						{
							this.SimulateCharacterCombatResult(context, selfChar, targetChar, 60, 60, 60);
							result3 = true;
						}
						else
						{
							this.SimulateCharacterCombatResult(context, targetChar, selfChar, 60, 60, 60);
							result3 = false;
						}
					}
				}
			}
			return result3;
		}

		// Token: 0x0600704F RID: 28751 RVA: 0x0040433C File Offset: 0x0040253C
		public void ApplyPlotHarmActionEffect(DataContext context, Character selfChar, Character targetChar, ItemKey itemKey)
		{
			short attainment = selfChar.GetLifeSkillAttainment(8);
			int damage = CharacterDomain.CalcPlotHarmActionBaseDamage(attainment);
			targetChar.TakeRandomDamage(context, damage);
			bool flag = itemKey.IsValid();
			if (flag)
			{
				selfChar.RemoveInventoryItem(context, itemKey, 1, false, false);
				CharacterDomain.ApplyMedicineEffectForPlotHarm(context, selfChar, itemKey);
			}
		}

		// Token: 0x06007050 RID: 28752 RVA: 0x00404388 File Offset: 0x00402588
		public bool HandlePlotHarmAction(DataContext context, Character selfChar, Character targetChar, ItemKey itemKey, sbyte actionPhase = -1)
		{
			int selfCharId = selfChar.GetId();
			int targetCharId = targetChar.GetId();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			Location location = selfChar.GetLocation();
			selfChar.ChangeCurrMainAttribute(context, 4, (int)(-(int)GlobalConfig.Instance.HarmfulActionCost));
			bool flag = actionPhase < 0;
			if (flag)
			{
				actionPhase = selfChar.GetPlotHarmActionPhase(context.Random, targetChar, 100, false);
			}
			bool flag2 = actionPhase >= 4;
			if (flag2)
			{
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddPlotHarmEnemy(selfCharId, targetCharId);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				this.ApplyPlotHarmActionEffect(context, selfChar, targetChar, itemKey);
			}
			switch (actionPhase)
			{
			case 0:
			{
				bool flag3 = itemKey.IsValid();
				if (flag3)
				{
					lifeRecordCollection.AddPlotHarmEnemyFail12(selfCharId, currDate, targetCharId, location, itemKey.ItemType, itemKey.TemplateId);
				}
				else
				{
					lifeRecordCollection.AddPlotHarmEnemyFail1(selfCharId, currDate, targetCharId, location);
				}
				break;
			}
			case 1:
			{
				bool flag4 = itemKey.IsValid();
				if (flag4)
				{
					lifeRecordCollection.AddPlotHarmEnemyFail22(selfCharId, currDate, targetCharId, location, itemKey.ItemType, itemKey.TemplateId);
				}
				else
				{
					lifeRecordCollection.AddPlotHarmEnemyFail2(selfCharId, currDate, targetCharId, location);
				}
				break;
			}
			case 2:
			{
				bool flag5 = itemKey.IsValid();
				if (flag5)
				{
					lifeRecordCollection.AddPlotHarmEnemyFail32(selfCharId, currDate, targetCharId, location, itemKey.ItemType, itemKey.TemplateId);
				}
				else
				{
					lifeRecordCollection.AddPlotHarmEnemyFail3(selfCharId, currDate, targetCharId, location);
				}
				break;
			}
			case 3:
			{
				bool flag6 = itemKey.IsValid();
				if (flag6)
				{
					lifeRecordCollection.AddPlotHarmEnemyFail42(selfCharId, currDate, targetCharId, location, itemKey.ItemType, itemKey.TemplateId);
				}
				else
				{
					lifeRecordCollection.AddPlotHarmEnemyFail4(selfCharId, currDate, targetCharId, location);
				}
				break;
			}
			case 4:
			{
				bool flag7 = itemKey.IsValid();
				if (flag7)
				{
					lifeRecordCollection.AddPlotHarmEnemySucceed2(selfCharId, currDate, targetCharId, location, itemKey.ItemType, itemKey.TemplateId);
				}
				else
				{
					lifeRecordCollection.AddPlotHarmEnemySucceed(selfCharId, currDate, targetCharId, location);
				}
				bool flag8 = selfCharId != taiwuCharId && targetCharId != taiwuCharId;
				if (flag8)
				{
					AiHelper.NpcCombatResultType result = this.SimulateCharacterCombat(context, selfChar, targetChar, CombatType.Die, true, 1);
					bool flag9 = result <= AiHelper.NpcCombatResultType.MinorVictory;
					bool flag10 = flag9;
					if (flag10)
					{
						this.SimulateCharacterCombatResult(context, selfChar, targetChar, 30, 50, 60);
					}
					else
					{
						this.SimulateCharacterCombatResult(context, targetChar, selfChar, 30, 50, 60);
					}
				}
				else
				{
					bool flag11 = DomainManager.World.GetAdvancingMonthState() != 0 && DomainManager.World.GetAdvancingMonthState() != 20;
					if (flag11)
					{
						bool flag12 = targetCharId == taiwuCharId;
						if (flag12)
						{
							MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
							monthlyEventCollection.AddCatchEnemyPlotHarm(targetCharId, location, selfCharId);
						}
						else
						{
							bool flag13 = selfCharId == taiwuCharId;
							if (flag13)
							{
								AiHelper.NpcCombatResultType resultType = this.SimulateCharacterCombat(context, selfChar, targetChar, CombatType.Beat, false, 1);
								bool flag9 = resultType <= AiHelper.NpcCombatResultType.MinorVictory;
								bool isVictory = flag9;
								bool flag14 = isVictory;
								if (flag14)
								{
									this.SimulateCharacterCombatResult(context, selfChar, targetChar, -2147483647, -2147483647, 100);
								}
								else
								{
									this.SimulateCharacterCombatResult(context, targetChar, selfChar, -2147483647, -2147483647, 100);
								}
							}
						}
					}
				}
				return true;
			}
			default:
			{
				bool flag15 = itemKey.IsValid();
				if (flag15)
				{
					lifeRecordCollection.AddPlotHarmEnemySucceedAndEscaped2(selfCharId, currDate, targetCharId, location, itemKey.ItemType, itemKey.TemplateId);
				}
				else
				{
					lifeRecordCollection.AddPlotHarmEnemySucceedAndEscaped(selfCharId, currDate, targetCharId, location);
				}
				bool flag16 = targetCharId == taiwuCharId && DomainManager.World.GetAdvancingMonthState() != 0 && DomainManager.World.GetAdvancingMonthState() != 20;
				if (flag16)
				{
					MonthlyEventCollection monthlyEventCollection2 = DomainManager.World.GetMonthlyEventCollection();
					monthlyEventCollection2.AddEnemyPlotHarmAndEscape(targetCharId, location);
				}
				return true;
			}
			}
			return false;
		}

		// Token: 0x06007051 RID: 28753 RVA: 0x00404738 File Offset: 0x00402938
		public void ApplyPoisonActionEffect(DataContext context, Character selfChar, Character targetChar, ItemKey itemKey)
		{
			short attainment = selfChar.GetLifeSkillAttainment(9);
			ValueTuple<sbyte, int> valueTuple = CharacterDomain.CalcPoisonActionBaseLevelAndAmount(attainment);
			sbyte level = valueTuple.Item1;
			int amount = valueTuple.Item2;
			sbyte poisonType = (sbyte)context.Random.Next(6);
			targetChar.ChangePoisoned(context, poisonType, level, amount);
			bool flag = itemKey.IsValid();
			if (flag)
			{
				selfChar.RemoveInventoryItem(context, itemKey, 1, false, false);
				targetChar.AddEatingItem(context, itemKey, null);
			}
		}

		// Token: 0x06007052 RID: 28754 RVA: 0x004047A4 File Offset: 0x004029A4
		public bool HandlePoisonAction(DataContext context, Character selfChar, Character targetChar, ItemKey itemKey, sbyte actionPhase = -1)
		{
			int selfCharId = selfChar.GetId();
			int targetCharId = targetChar.GetId();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			Location location = selfChar.GetLocation();
			selfChar.ChangeCurrMainAttribute(context, 4, (int)(-(int)GlobalConfig.Instance.HarmfulActionCost));
			bool flag = actionPhase < 0;
			if (flag)
			{
				actionPhase = selfChar.GetPoisonActionPhase(context.Random, targetChar, 100, false);
			}
			bool flag2 = actionPhase >= 4;
			if (flag2)
			{
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddPoisonEnemy(selfCharId, targetCharId);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				this.ApplyPoisonActionEffect(context, selfChar, targetChar, itemKey);
			}
			switch (actionPhase)
			{
			case 0:
			{
				bool flag3 = itemKey.IsValid();
				if (flag3)
				{
					lifeRecordCollection.AddPoisonEnemyFail1(selfCharId, currDate, targetCharId, location, itemKey.ItemType, itemKey.TemplateId);
				}
				else
				{
					lifeRecordCollection.AddPoisonEnemyFail12(selfCharId, currDate, targetCharId, location);
				}
				break;
			}
			case 1:
			{
				bool flag4 = itemKey.IsValid();
				if (flag4)
				{
					lifeRecordCollection.AddPoisonEnemyFail2(selfCharId, currDate, targetCharId, location, itemKey.ItemType, itemKey.TemplateId);
				}
				else
				{
					lifeRecordCollection.AddPoisonEnemyFail22(selfCharId, currDate, targetCharId, location);
				}
				break;
			}
			case 2:
			{
				bool flag5 = itemKey.IsValid();
				if (flag5)
				{
					lifeRecordCollection.AddPoisonEnemyFail3(selfCharId, currDate, targetCharId, location, itemKey.ItemType, itemKey.TemplateId);
				}
				else
				{
					lifeRecordCollection.AddPoisonEnemyFail32(selfCharId, currDate, targetCharId, location);
				}
				break;
			}
			case 3:
			{
				bool flag6 = itemKey.IsValid();
				if (flag6)
				{
					lifeRecordCollection.AddPoisonEnemyFail4(selfCharId, currDate, targetCharId, location, itemKey.ItemType, itemKey.TemplateId);
				}
				else
				{
					lifeRecordCollection.AddPoisonEnemyFail42(selfCharId, currDate, targetCharId, location);
				}
				break;
			}
			case 4:
			{
				bool flag7 = itemKey.IsValid();
				if (flag7)
				{
					lifeRecordCollection.AddPoisonEnemySucceed(selfCharId, currDate, targetCharId, location, itemKey.ItemType, itemKey.TemplateId);
				}
				else
				{
					lifeRecordCollection.AddPoisonEnemySucceed2(selfCharId, currDate, targetCharId, location);
				}
				bool flag8 = selfCharId != taiwuCharId && targetCharId != taiwuCharId;
				if (flag8)
				{
					AiHelper.NpcCombatResultType result = this.SimulateCharacterCombat(context, selfChar, targetChar, CombatType.Die, true, 1);
					bool flag9 = result <= AiHelper.NpcCombatResultType.MinorVictory;
					bool flag10 = flag9;
					if (flag10)
					{
						this.SimulateCharacterCombatResult(context, selfChar, targetChar, 30, 50, 60);
					}
					else
					{
						this.SimulateCharacterCombatResult(context, targetChar, selfChar, 30, 50, 60);
					}
				}
				else
				{
					bool flag11 = DomainManager.World.GetAdvancingMonthState() != 0 && DomainManager.World.GetAdvancingMonthState() != 20;
					if (flag11)
					{
						bool flag12 = targetCharId == taiwuCharId;
						if (flag12)
						{
							MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
							monthlyEventCollection.AddCatchEnemyPoison(targetCharId, location, selfCharId);
						}
						else
						{
							bool flag13 = selfCharId == taiwuCharId;
							if (flag13)
							{
								AiHelper.NpcCombatResultType resultType = this.SimulateCharacterCombat(context, selfChar, targetChar, CombatType.Beat, false, 1);
								bool flag9 = resultType <= AiHelper.NpcCombatResultType.MinorVictory;
								bool isVictory = flag9;
								bool flag14 = isVictory;
								if (flag14)
								{
									this.SimulateCharacterCombatResult(context, selfChar, targetChar, -2147483647, -2147483647, 100);
								}
								else
								{
									this.SimulateCharacterCombatResult(context, targetChar, selfChar, -2147483647, -2147483647, 100);
								}
							}
						}
					}
				}
				return true;
			}
			default:
			{
				bool flag15 = itemKey.IsValid();
				if (flag15)
				{
					lifeRecordCollection.AddPoisonEnemySucceedAndEscaped(selfCharId, currDate, targetCharId, location, itemKey.ItemType, itemKey.TemplateId);
				}
				else
				{
					lifeRecordCollection.AddPoisonEnemySucceedAndEscaped2(selfCharId, currDate, targetCharId, location);
				}
				bool flag16 = targetCharId == taiwuCharId && DomainManager.World.GetAdvancingMonthState() != 0 && DomainManager.World.GetAdvancingMonthState() != 20;
				if (flag16)
				{
					MonthlyEventCollection monthlyEventCollection2 = DomainManager.World.GetMonthlyEventCollection();
					monthlyEventCollection2.AddEnemyPoisonAndEscape(targetCharId, location);
				}
				return true;
			}
			}
			return false;
		}

		// Token: 0x06007053 RID: 28755 RVA: 0x00404B54 File Offset: 0x00402D54
		public bool HandleRapeAction(DataContext context, Character selfChar, Character targetChar)
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int selfCharId = selfChar.GetId();
			int targetCharId = targetChar.GetId();
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			Location location = selfChar.GetLocation();
			int currDate = DomainManager.World.GetCurrDate();
			short fertility = selfChar.GetFertility();
			bool succeed = targetCharId != DomainManager.Taiwu.GetTaiwuCharId() && selfChar.GetCombatPower() > targetChar.GetCombatPower() && fertility > 50;
			bool flag = succeed;
			if (flag)
			{
				selfChar.MakeLove(context, targetChar, true);
			}
			bool flag2 = succeed;
			if (flag2)
			{
				lifeRecordCollection.AddRapeSucceed(selfCharId, currDate, targetCharId, location);
				DomainManager.Character.AddRelation(context, targetCharId, selfCharId, 32768, currDate);
				DomainManager.Character.ChangeFavorabilityOptionalMonthlyEvolution(context, targetChar, selfChar, -30000);
				int secretInfoOffset = secretInformationCollection.AddRape(selfCharId, targetCharId);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
			}
			else
			{
				bool flag3 = targetCharId == taiwuCharId;
				if (flag3)
				{
					monthlyNotificationCollection.AddRapeFailure(selfCharId, location, targetCharId);
				}
				lifeRecordCollection.AddRapeFail(selfCharId, currDate, targetCharId, location);
				DomainManager.Character.AddRelation(context, targetCharId, selfCharId, 32768, currDate);
				DomainManager.Character.ChangeFavorabilityOptionalMonthlyEvolution(context, targetChar, selfChar, -30000);
			}
			return succeed;
		}

		// Token: 0x06007054 RID: 28756 RVA: 0x00404CA4 File Offset: 0x00402EA4
		public unsafe ItemKey SelectMostEffectivePoisonToUse(Character selfChar, Character targetChar)
		{
			EatingItems eatingItems = *targetChar.GetEatingItems();
			int availableSlotCount = eatingItems.GetAvailableEatingSlotsCount(targetChar.GetCurrMaxEatingSlotsCount());
			bool flag = availableSlotCount <= 0;
			ItemKey result;
			if (flag)
			{
				result = ItemKey.Invalid;
			}
			else
			{
				int currPoisonGrade = -1;
				ItemKey selectedPoison = ItemKey.Invalid;
				foreach (ItemKey itemKey in selfChar.GetInventory().Items.Keys)
				{
					bool flag2 = itemKey.ItemType != 8;
					if (!flag2)
					{
						MedicineItem medicineCfg = Config.Medicine.Instance[itemKey.TemplateId];
						bool flag3 = medicineCfg.EffectType != EMedicineEffectType.ApplyPoison;
						if (!flag3)
						{
							bool flag4 = (int)medicineCfg.Grade <= currPoisonGrade;
							if (!flag4)
							{
								currPoisonGrade = (int)medicineCfg.Grade;
								selectedPoison = itemKey;
							}
						}
					}
				}
				result = selectedPoison;
			}
			return result;
		}

		// Token: 0x06007055 RID: 28757 RVA: 0x00404DA0 File Offset: 0x00402FA0
		private bool CheckRequestHelpFromTaiwu(IRandomSource random, int targetCharId, int taiwuCharId)
		{
			RelatedCharacter relation;
			bool flag = !this.TryGetRelation(targetCharId, taiwuCharId, out relation);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				sbyte favorabilityType = FavorabilityType.GetFavorabilityType(relation.Favorability);
				result = (favorabilityType >= 4 && random.CheckPercentProb((int)(50 + (favorabilityType - 4) * 20)));
			}
			return result;
		}

		// Token: 0x06007056 RID: 28758 RVA: 0x00404DEC File Offset: 0x00402FEC
		private bool CheckNeedProtection(Character defender, Character attacker)
		{
			return defender.GetCombatPower() <= attacker.GetCombatPower() * 75 / 100;
		}

		// Token: 0x06007057 RID: 28759 RVA: 0x00404E18 File Offset: 0x00403018
		private static int CalcPlotHarmActionBaseDamage(short attainment)
		{
			short[] thresholds = GlobalConfig.Instance.PlotHarmActionAttainmentThresholds;
			for (int i = thresholds.Length - 1; i >= 0; i--)
			{
				short threshold = thresholds[i];
				bool flag = attainment >= threshold;
				if (flag)
				{
					return i + 1;
				}
			}
			return 1;
		}

		// Token: 0x06007058 RID: 28760 RVA: 0x00404E6C File Offset: 0x0040306C
		[return: TupleElementNames(new string[]
		{
			"level",
			"amount"
		})]
		private static ValueTuple<sbyte, int> CalcPoisonActionBaseLevelAndAmount(short attainment)
		{
			short[] thresholds = GlobalConfig.Instance.PoisonActionAttainmentThresholds;
			int baseValue = (int)(attainment / 5);
			bool flag = baseValue <= 0;
			if (flag)
			{
				baseValue = 1;
			}
			for (int i = thresholds.Length - 1; i >= 0; i--)
			{
				short threshold = thresholds[i];
				int level = i + 1;
				bool flag2 = attainment >= threshold;
				if (flag2)
				{
					return new ValueTuple<sbyte, int>((sbyte)level, baseValue * level * 10);
				}
			}
			return new ValueTuple<sbyte, int>(1, baseValue * 10);
		}

		// Token: 0x06007059 RID: 28761 RVA: 0x00404EEC File Offset: 0x004030EC
		private static void ApplyMedicineEffectForPlotHarm(DataContext context, Character character, ItemKey itemKey)
		{
			Tester.Assert(itemKey.ItemType == 8, "");
			MedicineItem medicineCfg = Config.Medicine.Instance[itemKey.TemplateId];
			Injuries injuries = character.GetInjuries();
			bool flag = medicineCfg.EffectType == EMedicineEffectType.RecoverInnerInjury || medicineCfg.EffectType == EMedicineEffectType.RecoverOuterInjury;
			if (flag)
			{
				bool isInner = medicineCfg.EffectType == EMedicineEffectType.RecoverInnerInjury;
				sbyte delta = (sbyte)medicineCfg.EffectValue;
				for (int i = 0; i < (int)medicineCfg.InjuryRecoveryTimes; i++)
				{
					sbyte bodyPartType = (sbyte)context.Random.Next(7);
					injuries.Change(bodyPartType, isInner, (int)delta);
				}
			}
			character.AddEatingItemWithoutInstantEffects(context, itemKey);
		}

		// Token: 0x0600705A RID: 28762 RVA: 0x00404F98 File Offset: 0x00403198
		public void SetSubscriberOrder(DataContext context, int oldId, int newId, int artisanId)
		{
			bool flag = oldId >= 0;
			if (flag)
			{
				CharacterList oldList;
				bool flag2 = this.TryGetElement_SubscriberOrders(oldId, out oldList);
				if (flag2)
				{
					oldList.Remove(artisanId);
					this.SetElement_SubscriberOrders(oldId, oldList, context);
				}
			}
			CharacterList list;
			bool flag3 = this.TryGetElement_SubscriberOrders(newId, out list);
			if (flag3)
			{
				bool flag4 = !list.Contains(artisanId);
				if (flag4)
				{
					list.Add(artisanId);
					this.SetElement_SubscriberOrders(newId, list, context);
				}
			}
			else
			{
				list = default(CharacterList);
				list.Add(artisanId);
				this.AddElement_SubscriberOrders(newId, list, context);
			}
		}

		// Token: 0x0600705B RID: 28763 RVA: 0x00405030 File Offset: 0x00403230
		public void RemoveSubscriberOrder(DataContext context, int subscriberId, int artisanId)
		{
			bool flag = subscriberId >= 0;
			if (flag)
			{
				CharacterList list;
				bool flag2 = this.TryGetElement_SubscriberOrders(subscriberId, out list);
				if (flag2)
				{
					list.Remove(artisanId);
					this.SetElement_SubscriberOrders(subscriberId, list, context);
				}
			}
		}

		// Token: 0x0600705C RID: 28764 RVA: 0x00405070 File Offset: 0x00403270
		public void AssassinationByJieqing(DataContext context)
		{
			MonthlyNotificationCollection monthlyNotification = DomainManager.World.GetMonthlyNotificationCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			bool flag = !string.IsNullOrEmpty(this._targetedForAssassination);
			if (flag)
			{
				foreach (Character character in this._objects.Values)
				{
					bool flag2 = character.GetCreatingType() != 1;
					if (!flag2)
					{
						bool flag3 = this.IsTemporaryIntelligentCharacter(character.GetId());
						if (!flag3)
						{
							bool flag4 = AgeGroup.GetAgeGroup(character.GetActualAge()) != 2;
							if (!flag4)
							{
								ValueTuple<string, string> realName = CharacterDomain.GetRealName(character);
								string surname = realName.Item1;
								string givenName = realName.Item2;
								string fullName = surname + givenName;
								bool flag5 = this._targetedForAssassination != fullName;
								if (!flag5)
								{
									bool flag6 = !context.Random.CheckPercentProb((int)(45 - character.GetOrganizationInfo().Grade * 5));
									if (!flag6)
									{
										bool flag7 = character.GetId() == taiwuCharId;
										if (flag7)
										{
											DomainManager.World.SetTaiwuDying(false);
										}
										else
										{
											DomainManager.Character.MakeCharacterDead(context, character, 7);
										}
										this.SetTargetedForAssassination(string.Empty, context);
										break;
									}
								}
							}
						}
					}
				}
			}
			bool flag8 = DomainManager.World.GetMainStoryLineProgress() < 6;
			if (!flag8)
			{
				bool flag9 = DomainManager.Item.HasTrackedSpecialItems(12, 225);
				if (flag9)
				{
					foreach (Character character2 in this._objects.Values)
					{
						bool flag10 = character2.GetCreatingType() != 1;
						if (!flag10)
						{
							bool flag11 = character2.GetId() == taiwuCharId;
							if (!flag11)
							{
								bool flag12 = this.IsTemporaryIntelligentCharacter(character2.GetId());
								if (!flag12)
								{
									ItemKey wuyingItemKey = DomainManager.Item.GetWuYingFromCharacterInventory(character2);
									bool flag13 = !wuyingItemKey.IsValid();
									if (!flag13)
									{
										bool flag14 = !context.Random.CheckPercentProb((int)(90 - character2.GetOrganizationInfo().Grade * 10));
										if (!flag14)
										{
											ItemBase item = DomainManager.Item.GetBaseItem(wuyingItemKey);
											item.SetCurrDurability(item.GetCurrDurability() - 1, context);
											bool flag15 = item.GetCurrDurability() <= 0;
											if (flag15)
											{
												character2.RemoveInventoryItem(context, wuyingItemKey, 1, true, false);
											}
											DomainManager.Character.MakeCharacterDead(context, character2, 8);
										}
									}
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x0600705D RID: 28765 RVA: 0x00405364 File Offset: 0x00403564
		public void Test_AssassinationImplementations()
		{
			List<string> targets = new List<string>
			{
				"任我行",
				"古三通",
				"张无忌",
				"云襄"
			};
			List<Character> results = new List<Character>();
			Stopwatch stopwatch = new Stopwatch();
			results.Clear();
			stopwatch.Restart();
			foreach (Character character2 in this._objects.Values)
			{
				ValueTuple<string, string> realName = CharacterDomain.GetRealName(character2);
				string surname = realName.Item1;
				string givenName = realName.Item2;
				bool flag = targets.Contains(surname + givenName);
				if (flag)
				{
					results.Add(character2);
				}
			}
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
			defaultInterpolatedStringHandler.AppendLiteral("Time Cost with implementation 2 in ticks: ");
			defaultInterpolatedStringHandler.AppendFormatted<long>(stopwatch.ElapsedTicks);
			logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
			results.Clear();
			stopwatch.Restart();
			using (List<string>.Enumerator enumerator2 = targets.GetEnumerator())
			{
				while (enumerator2.MoveNext())
				{
					string target = enumerator2.Current;
					this.FindIntelligentCharacters((Character character) => CharacterMatchers.MatchRealName(character, target), results);
				}
			}
			Logger logger2 = CharacterDomain.Logger;
			defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
			defaultInterpolatedStringHandler.AppendLiteral("Time Cost with implementation 1 in ticks: ");
			defaultInterpolatedStringHandler.AppendFormatted<long>(stopwatch.ElapsedTicks);
			logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
			results.Clear();
			stopwatch.Restart();
			using (List<string>.Enumerator enumerator3 = targets.GetEnumerator())
			{
				while (enumerator3.MoveNext())
				{
					string target = enumerator3.Current;
					MapCharacterFilter.ParallelFind((Character character) => CharacterMatchers.MatchRealName(character, target), results, 0, 135, false);
				}
			}
			Logger logger3 = CharacterDomain.Logger;
			defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
			defaultInterpolatedStringHandler.AppendLiteral("Time Cost with implementation 3 in ticks: ");
			defaultInterpolatedStringHandler.AppendFormatted<long>(stopwatch.ElapsedTicks);
			logger3.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x0600705E RID: 28766 RVA: 0x004055C0 File Offset: 0x004037C0
		[DomainMethod]
		public bool CharacterShaveAvatar(DataContext context, int cutterCharId, int shaveCharId, AvatarData shaveResult)
		{
			Character hairCutter;
			Character shavedCharacter;
			bool flag = this.TryGetElement_Objects(cutterCharId, out hairCutter) && this.TryGetElement_Objects(shaveCharId, out shavedCharacter);
			bool result;
			if (flag)
			{
				AvatarData srcData = shavedCharacter.GetAvatar();
				bool hairInfoChanged = srcData.FrontHairId != shaveResult.FrontHairId || srcData.BackHairId != shaveResult.BackHairId || srcData.ColorFrontHairId != shaveResult.ColorFrontHairId || srcData.ColorBackHairId != shaveResult.ColorBackHairId;
				bool hairShaveBald = srcData.GetGrowableElementShowingState(0) != shaveResult.GetGrowableElementShowingState(0);
				bool beard1InfoChanged = srcData.Beard1Id != shaveResult.Beard1Id || srcData.ColorBeard1Id != shaveResult.ColorBeard1Id;
				bool beard1ShaveBald = srcData.GetGrowableElementShowingState(1) != shaveResult.GetGrowableElementShowingState(1);
				bool beard2InfoChanged = srcData.Beard2Id != shaveResult.Beard2Id || srcData.ColorBeard2Id != shaveResult.ColorBeard2Id;
				bool beard2ShaveBald = srcData.GetGrowableElementShowingState(2) != shaveResult.GetGrowableElementShowingState(2);
				bool eyebrowInfoChanged = srcData.EyebrowId != shaveResult.EyebrowId || srcData.EyebrowDistancePercent != shaveResult.EyebrowDistancePercent || srcData.EyebrowAngle != shaveResult.EyebrowAngle || srcData.EyebrowHeight != shaveResult.EyebrowHeight || srcData.EyebrowScale != shaveResult.EyebrowScale || srcData.ColorEyebrowId != shaveResult.ColorEyebrowId;
				bool eyebrowShaveBald = srcData.GetGrowableElementShowingState(6) != shaveResult.GetGrowableElementShowingState(6);
				int obb = (int)(40 + hairCutter.GetLifeSkillAttainment(5) / 5);
				bool success = context.Random.CheckPercentProb(obb);
				bool flag2 = !success;
				if (flag2)
				{
					bool hairSuccessState = hairShaveBald || !hairInfoChanged;
					bool beard1SuccessState = beard1ShaveBald || !beard1InfoChanged;
					bool beard2SuccessState = beard2ShaveBald || !beard2InfoChanged;
					bool eyebrowSuccessState = eyebrowShaveBald || !eyebrowInfoChanged;
					success = (hairSuccessState && beard1SuccessState && beard2SuccessState && eyebrowSuccessState);
				}
				bool hairFailed = false;
				bool beardFailed = false;
				bool eyebrowFailed = false;
				bool flag3 = success;
				if (flag3)
				{
					AvatarGroup avatarGroup = AvatarManager.Instance.GetAvatarGroup((int)srcData.AvatarId);
					bool flag4 = beard1ShaveBald;
					if (flag4)
					{
						shaveResult.SetGrowableElementShowingState(1, false);
						DomainManager.Character.InitializeAvatarElementGrowthProgress(context, shaveCharId, 1);
					}
					bool flag5 = beard2ShaveBald;
					if (flag5)
					{
						shaveResult.SetGrowableElementShowingState(2, false);
						DomainManager.Character.InitializeAvatarElementGrowthProgress(context, shaveCharId, 2);
					}
					bool flag6 = eyebrowShaveBald;
					if (flag6)
					{
						shaveResult.SetGrowableElementShowingState(6, false);
						DomainManager.Character.InitializeAvatarElementGrowthProgress(context, shaveCharId, 6);
					}
					short prevAttraction = shavedCharacter.GetAttraction();
					avatarGroup = AvatarManager.Instance.GetAvatarGroup((int)shaveResult.AvatarId);
					this.CheckShaveResult(avatarGroup, shaveResult, hairInfoChanged, beard1InfoChanged, beard2InfoChanged, eyebrowInfoChanged);
					shavedCharacter.SetAvatar(shaveResult, context);
					short attraction = shavedCharacter.GetAttraction();
					bool flag7 = attraction >= prevAttraction;
					if (flag7)
					{
						shavedCharacter.AddFeature(context, 496, true);
					}
					else
					{
						shavedCharacter.AddFeature(context, 497, true);
					}
				}
				else
				{
					shavedCharacter.AddFeature(context, 498, true);
					bool flag8 = hairInfoChanged;
					if (flag8)
					{
						srcData.ResetGrowableElementShowingState(0);
						DomainManager.Character.InitializeAvatarElementGrowthProgress(context, shaveCharId, 0);
						hairFailed = true;
					}
					bool flag9 = beard1InfoChanged || beard2InfoChanged;
					if (flag9)
					{
						srcData.ResetGrowableElementShowingState(1);
						srcData.ResetGrowableElementShowingState(2);
						DomainManager.Character.InitializeAvatarElementGrowthProgress(context, shaveCharId, 1);
						DomainManager.Character.InitializeAvatarElementGrowthProgress(context, shaveCharId, 2);
						beardFailed = true;
					}
					bool flag10 = eyebrowInfoChanged;
					if (flag10)
					{
						srcData.ResetGrowableElementShowingState(6);
						DomainManager.Character.InitializeAvatarElementGrowthProgress(context, shaveCharId, 6);
						eyebrowFailed = true;
					}
					shavedCharacter.SetAvatar(srcData, context);
				}
				DomainManager.TaiwuEvent.SetListenerEventActionBoolArg("CharacterShaveComplete", "ShaveSuccess", success);
				bool flag11 = !success;
				if (flag11)
				{
					bool flag12 = hairFailed;
					if (flag12)
					{
						DomainManager.TaiwuEvent.SetListenerEventActionBoolArg("CharacterShaveComplete", "ShaveHairFailFlag", true);
					}
					bool flag13 = beardFailed;
					if (flag13)
					{
						DomainManager.TaiwuEvent.SetListenerEventActionBoolArg("CharacterShaveComplete", "ShaveBeardFailFlag", true);
					}
					bool flag14 = eyebrowFailed;
					if (flag14)
					{
						DomainManager.TaiwuEvent.SetListenerEventActionBoolArg("CharacterShaveComplete", "ShaveEyebrowFailFlag", true);
					}
					DomainManager.TaiwuEvent.TriggerListener("CharacterShaveComplete", true);
				}
				result = success;
			}
			else
			{
				result = false;
			}
			return result;
		}

		// Token: 0x0600705F RID: 28767 RVA: 0x004059E8 File Offset: 0x00403BE8
		[DomainMethod]
		public AvatarData GetAvatarData(DataContext context, int charId)
		{
			Character shavedCharacter;
			this.TryGetElement_Objects(charId, out shavedCharacter);
			return shavedCharacter.GetAvatar();
		}

		// Token: 0x06007060 RID: 28768 RVA: 0x00405A0C File Offset: 0x00403C0C
		private bool CheckShaveResult(AvatarGroup avatarGroup, AvatarData shaveResult, bool hairInfoChanged, bool beard1InfoChanged, bool beard2InfoChanged, bool eyebrowInfoChanged)
		{
			bool flag = true;
			bool flag2 = hairInfoChanged && shaveResult.FrontHairId == avatarGroup.Hair1Res[0].Id;
			if (flag2)
			{
				flag = false;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(43, 1);
				defaultInterpolatedStringHandler.AppendLiteral("front hair can not set to id ");
				defaultInterpolatedStringHandler.AppendFormatted<short>(avatarGroup.Hair1Res[0].Id);
				defaultInterpolatedStringHandler.AppendLiteral(" through shave");
				AdaptableLog.Warning(defaultInterpolatedStringHandler.ToStringAndClear(), false);
			}
			bool flag3 = hairInfoChanged && shaveResult.BackHairId == avatarGroup.Hair2Res[0].Id && shaveResult.FrontHairId == avatarGroup.Hair1Res[0].Id;
			if (flag3)
			{
				flag = false;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("back hair can not set to id ");
				defaultInterpolatedStringHandler.AppendFormatted<short>(avatarGroup.Hair2Res[0].Id);
				defaultInterpolatedStringHandler.AppendLiteral(" through shave");
				AdaptableLog.Warning(defaultInterpolatedStringHandler.ToStringAndClear(), false);
			}
			bool flag4 = beard1InfoChanged && avatarGroup.Beard1Res.CheckIndex(0) && shaveResult.Beard1Id == avatarGroup.Beard1Res[0].Id;
			if (flag4)
			{
				flag = false;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(39, 1);
				defaultInterpolatedStringHandler.AppendLiteral("beard1 can not set to id ");
				defaultInterpolatedStringHandler.AppendFormatted<short>(avatarGroup.Hair2Res[0].Id);
				defaultInterpolatedStringHandler.AppendLiteral(" through shave");
				AdaptableLog.Warning(defaultInterpolatedStringHandler.ToStringAndClear(), false);
			}
			bool flag5 = beard2InfoChanged && avatarGroup.Beard2Res.CheckIndex(0) && shaveResult.Beard2Id == avatarGroup.Beard2Res[0].Id;
			if (flag5)
			{
				flag = false;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(39, 1);
				defaultInterpolatedStringHandler.AppendLiteral("beard2 can not set to id ");
				defaultInterpolatedStringHandler.AppendFormatted<short>(avatarGroup.Hair2Res[0].Id);
				defaultInterpolatedStringHandler.AppendLiteral(" through shave");
				AdaptableLog.Warning(defaultInterpolatedStringHandler.ToStringAndClear(), false);
			}
			bool flag6 = eyebrowInfoChanged && shaveResult.EyebrowId == avatarGroup.EyeBrowRes[0].Id;
			if (flag6)
			{
				flag = false;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(40, 1);
				defaultInterpolatedStringHandler.AppendLiteral("eyebrow can not set to id ");
				defaultInterpolatedStringHandler.AppendFormatted<short>(avatarGroup.EyeBrowRes[0].Id);
				defaultInterpolatedStringHandler.AppendLiteral(" through shave");
				AdaptableLog.Warning(defaultInterpolatedStringHandler.ToStringAndClear(), false);
			}
			return flag;
		}

		// Token: 0x06007061 RID: 28769 RVA: 0x00405C9C File Offset: 0x00403E9C
		public AvatarElementsGrownDates GetAvatarElementGrowthProgress(int charId)
		{
			return this._avatarElementGrowthProgress[charId];
		}

		// Token: 0x06007062 RID: 28770 RVA: 0x00405CBC File Offset: 0x00403EBC
		public bool TryGetAvatarElementGrowthProgress(int charId, out AvatarElementsGrownDates growthDates)
		{
			return this._avatarElementGrowthProgress.TryGetValue(charId, out growthDates);
		}

		// Token: 0x06007063 RID: 28771 RVA: 0x00405CDB File Offset: 0x00403EDB
		public void SetAvatarElementGrowthProgress(DataContext context, int charId, ref AvatarElementsGrownDates dates)
		{
			this.SetElement_AvatarElementGrowthProgress(charId, ref dates, context);
		}

		// Token: 0x06007064 RID: 28772 RVA: 0x00405CE8 File Offset: 0x00403EE8
		public unsafe void InitializeAvatarElementGrowthProgress(DataContext context, int charId, sbyte elementType)
		{
			AvatarElementsGrownDates dates;
			bool existed = this._avatarElementGrowthProgress.TryGetValue(charId, out dates);
			bool flag = !existed;
			if (flag)
			{
				dates.Initialize();
			}
			sbyte duration = GlobalConfig.Instance.AvatarElementGrowthDurations[(int)elementType];
			*(ref dates.Items.FixedElementField + (IntPtr)elementType * 4) = DomainManager.World.GetCurrDate() + (int)duration;
			bool flag2 = existed;
			if (flag2)
			{
				this.SetElement_AvatarElementGrowthProgress(charId, ref dates, context);
			}
			else
			{
				this.AddElement_AvatarElementGrowthProgress(charId, ref dates, context);
			}
		}

		// Token: 0x06007065 RID: 28773 RVA: 0x00405D60 File Offset: 0x00403F60
		public int GetTopThousandCharacterRanking(int charId)
		{
			int index = this._topThousandCharDescendingRanking.IndexOfValue(charId);
			bool flag = index == -1;
			int result;
			if (flag)
			{
				result = int.MaxValue;
			}
			else
			{
				result = index + 1;
			}
			return result;
		}

		// Token: 0x06007066 RID: 28774 RVA: 0x00405D94 File Offset: 0x00403F94
		public void UpdateTopThousandCharRanking()
		{
			this._topThousandCharDescendingRanking.Clear();
			List<Settlement> settlements = new List<Settlement>();
			DomainManager.Organization.GetAllSettlements(settlements);
			foreach (Settlement settlement in settlements)
			{
				for (int ranking = 1; ranking <= 1000; ranking++)
				{
					long rankingInfo = settlement.GetRankingInfo(ranking);
					bool flag = rankingInfo == 0L;
					if (flag)
					{
						break;
					}
					int charId = (int)(rankingInfo & (long)((ulong)-1));
					this._topThousandCharDescendingRanking.Add(rankingInfo, charId);
					bool flag2 = this._topThousandCharDescendingRanking.Count <= 1000;
					if (!flag2)
					{
						long last = this._topThousandCharDescendingRanking.Keys[1000];
						this._topThousandCharDescendingRanking.RemoveAt(1000);
						bool flag3 = last == rankingInfo;
						if (flag3)
						{
							break;
						}
					}
				}
			}
		}

		// Token: 0x06007067 RID: 28775 RVA: 0x00405EAC File Offset: 0x004040AC
		public static bool TryRemoveCombatSkillFromAttainmentPanel(DataContext context, Character character, short targetSkillTemplateId)
		{
			short[] panels = character.GetCombatSkillAttainmentPanels();
			CombatSkillItem targetCfg = Config.CombatSkill.Instance[targetSkillTemplateId];
			sbyte targetType = targetCfg.Type;
			sbyte targetGrade = targetCfg.Grade;
			bool flag = CombatSkillAttainmentPanelsHelper.Get(panels, targetType, targetGrade) != targetSkillTemplateId;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				short currSkillTemplateId = CharacterDomain.GetEligibleCombatSkillOfAttainmentPanel(character.GetId(), targetType, targetGrade);
				CombatSkillAttainmentPanelsHelper.Set(panels, targetType, targetGrade, currSkillTemplateId);
				character.SetCombatSkillAttainmentPanels(panels, context);
				result = true;
			}
			return result;
		}

		// Token: 0x06007068 RID: 28776 RVA: 0x00405F20 File Offset: 0x00404120
		private static short GetEligibleCombatSkillOfAttainmentPanel(int charId, sbyte combatSkillType, sbyte grade)
		{
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> charCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(charId);
			foreach (KeyValuePair<short, GameData.Domains.CombatSkill.CombatSkill> keyValuePair in charCombatSkills)
			{
				short num;
				GameData.Domains.CombatSkill.CombatSkill combatSkill;
				keyValuePair.Deconstruct(out num, out combatSkill);
				short skillTemplateId = num;
				GameData.Domains.CombatSkill.CombatSkill skill = combatSkill;
				CombatSkillItem skillConfig = Config.CombatSkill.Instance[skillTemplateId];
				bool flag = skillConfig.Type != combatSkillType || skillConfig.Grade != grade;
				if (!flag)
				{
					ushort activationState = skill.GetActivationState();
					bool flag2 = !CombatSkillStateHelper.IsBrokenOut(activationState);
					if (!flag2)
					{
						bool revoked = skill.GetRevoked();
						if (!revoked)
						{
							return skillTemplateId;
						}
					}
				}
			}
			return -1;
		}

		// Token: 0x06007069 RID: 28777 RVA: 0x00405FF0 File Offset: 0x004041F0
		[DomainMethod]
		public void AllocateNeili(DataContext context, int charId, byte neiliAllocationType)
		{
			Character character = this.GetElement_Objects(charId);
			character.AllocateNeili(context, neiliAllocationType);
			bool flag = charId == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				DomainManager.Extra.SetTaiwuMaxNeiliAllocation(character.GetBaseNeiliAllocation(), context);
			}
		}

		// Token: 0x0600706A RID: 28778 RVA: 0x00406034 File Offset: 0x00404234
		[DomainMethod]
		public void DeallocateNeili(DataContext context, int charId, byte neiliAllocationType)
		{
			Character character = this._objects[charId];
			character.DeallocateNeili(context, neiliAllocationType);
			bool flag = charId == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				DomainManager.Extra.SetTaiwuMaxNeiliAllocation(character.GetBaseNeiliAllocation(), context);
			}
		}

		// Token: 0x0600706B RID: 28779 RVA: 0x0040607C File Offset: 0x0040427C
		[DomainMethod]
		public short GetChangeOfQiDisorder(int charId)
		{
			Character character;
			bool flag = this.TryGetElement_Objects(charId, out character);
			short result;
			if (flag)
			{
				result = character.GetChangeOfQiDisorder();
			}
			else
			{
				result = 0;
			}
			return result;
		}

		// Token: 0x0600706C RID: 28780 RVA: 0x004060A8 File Offset: 0x004042A8
		[DomainMethod]
		public int GetAddConsummateLevelRequiredMonth(int charId)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			int result;
			if (flag)
			{
				result = int.MaxValue;
			}
			else
			{
				sbyte consummateLevel = character.GetConsummateLevel();
				bool flag2 = consummateLevel >= character.GetMaxConsummateLevel();
				if (flag2)
				{
					result = int.MaxValue;
				}
				else
				{
					int progress = DomainManager.Extra.GetCharacterConsummateLevelProgress(charId);
					int speed = GlobalConfig.Instance.ConsummateLevelProgressSpeed[(int)character.GetOrganizationInfo().Grade];
					int threshold = GlobalConfig.Instance.ConsummateLevelProgressThreshold[(int)consummateLevel];
					int i = 0;
					do
					{
						progress += speed;
						i++;
					}
					while (progress < threshold);
					result = i;
				}
			}
			return result;
		}

		// Token: 0x0600706D RID: 28781 RVA: 0x00406148 File Offset: 0x00404348
		public unsafe void SimulateCharacterCombatResult(DataContext context, Character winner, Character loser, int killBaseChance, int kidnapBaseChance, int releaseBaseChance)
		{
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			Location winnerLocation = winner.GetLocation();
			bool flag = !winnerLocation.IsValid();
			if (flag)
			{
				winnerLocation = winner.GetValidLocation();
			}
			int defeatMarks = CombatDomain.GetDefeatMarksCountOutOfCombat(loser);
			int escapeChance = (30 - defeatMarks) * 100 / 30;
			bool isCompletelyInfected = loser.IsCompletelyInfected();
			bool loserAvoidDeath = loser.GetId() == this._avoidDeathCharId;
			bool flag2 = loserAvoidDeath;
			if (flag2)
			{
				loserAvoidDeath = this.TransferAvoidDeathCharInjuries(context);
			}
			int winnerLeaderId = winner.GetLeaderId();
			int loserLeaderId = loser.GetLeaderId();
			bool flag3 = winnerLeaderId >= 0 && winnerLeaderId == loserLeaderId;
			if (flag3)
			{
				bool flag4 = loserLeaderId == loser.GetId();
				if (flag4)
				{
					DomainManager.Character.LeaveGroup(context, winner, true);
				}
				else
				{
					DomainManager.Character.LeaveGroup(context, loser, true);
				}
			}
			bool flag5 = isCompletelyInfected || context.Random.CheckPercentProb(escapeChance);
			if (flag5)
			{
				lifeRecordCollection.AddEnemyEscape(winner.GetId(), currDate, loser.GetId(), winnerLocation);
				bool flag6 = loser.GetLocation().IsValid();
				if (flag6)
				{
					this.EscapeToRandomNearbyBlock(context, loser, 3);
				}
			}
			else
			{
				bool flag7 = loser.GetAgeGroup() == 2;
				if (flag7)
				{
					Personalities personalities = winner.GetPersonalities();
					sbyte behaviorType = winner.GetBehaviorType();
					AiHelper.CombatResultHandleType[] priorities = AiHelper.NpcCombat.ResultHandleTypePriorities[(int)behaviorType];
					int i = 0;
					while (i < 3)
					{
						switch (priorities[i])
						{
						case AiHelper.CombatResultHandleType.Kill:
						{
							bool flag8 = context.Random.CheckPercentProb(killBaseChance + (int)(*(ref personalities.Items.FixedElementField + 3)));
							if (flag8)
							{
								bool flag9 = loserAvoidDeath;
								if (!flag9)
								{
									short privateRateAdjust = DomainManager.Extra.GetAiActionRateAdjust(winner.GetId(), 7, -1);
									int publicChance = (int)((short)AiHelper.NpcCombat.HandleEnemyInPublicChance[(int)behaviorType] - privateRateAdjust);
									this.CombatResultHandle_KillEnemy(context, winner, loser, context.Random.CheckPercentProb(publicChance));
									return;
								}
							}
							break;
						}
						case AiHelper.CombatResultHandleType.Kidnap:
						{
							bool flag10 = context.Random.CheckPercentProb(kidnapBaseChance + (int)(*(ref personalities.Items.FixedElementField + 1)));
							if (flag10)
							{
								short privateRateAdjust2 = DomainManager.Extra.GetAiActionRateAdjust(winner.GetId(), 8, -1);
								int publicChance2 = (int)((short)AiHelper.NpcCombat.HandleEnemyInPublicChance[(int)behaviorType] - privateRateAdjust2);
								this.CombatResultHandle_KidnapEnemy(context, winner, loser, context.Random.CheckPercentProb(publicChance2));
								return;
							}
							break;
						}
						case AiHelper.CombatResultHandleType.Release:
						{
							bool flag11 = context.Random.CheckPercentProb(releaseBaseChance + (int)personalities.Items.FixedElementField);
							if (flag11)
							{
								this.CombatResultHandle_ReleaseEnemy(context, winner, loser);
								return;
							}
							break;
						}
						}
						IL_276:
						i++;
						continue;
						goto IL_276;
					}
				}
				this.CombatResultHandle_ReleaseEnemy(context, winner, loser);
			}
		}

		// Token: 0x0600706E RID: 28782 RVA: 0x004063EC File Offset: 0x004045EC
		public void CombatResultHandle_KillEnemy(DataContext context, Character winner, Character loser, bool isInPublic)
		{
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			int winnerId = winner.GetId();
			int loserId = loser.GetId();
			CharacterDeathInfo deathInfo = new CharacterDeathInfo(loser.GetValidLocation())
			{
				KillerId = winnerId
			};
			if (isInPublic)
			{
				this.MakeCharacterDead(context, loser, 4, deathInfo);
				lifeRecordCollection.AddKillInPublic(winnerId, currDate, loserId, deathInfo.Location);
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = secretInformationCollection.AddKillInPublic(winnerId, loserId);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
			}
			else
			{
				this.MakeCharacterDead(context, loser, 3, deathInfo);
				lifeRecordCollection.AddKillInPrivate(winnerId, currDate, loserId, deathInfo.Location);
				SecretInformationCollection secretInformationCollection2 = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset2 = secretInformationCollection2.AddKillInPrivate(winnerId, loserId);
				int secretInfoId2 = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset2, true);
			}
		}

		// Token: 0x0600706F RID: 28783 RVA: 0x004064D0 File Offset: 0x004046D0
		public void CombatResultHandle_KidnapEnemy(DataContext context, Character winner, Character loser, bool isInPublic)
		{
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			Location location = winner.GetLocation();
			int winnerId = winner.GetId();
			int loserId = loser.GetId();
			bool flag = this.IsTaiwuPeople(winnerId);
			if (flag)
			{
				MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
				monthlyNotificationCollection.AddDisappear(loserId, location);
			}
			ItemKey rope = winner.GetInventoryRope(context, winner.GetOrganizationInfo().Grade);
			this.AddKidnappedCharacter(context, winner, loser, rope);
			if (isInPublic)
			{
				SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset = (DomainManager.Organization.GetFugitiveBountySect(loserId) >= 0) ? secretInformationCollection.AddKidnapForPunishment(winnerId, loserId) : secretInformationCollection.AddKidnapInPublic(winnerId, loserId);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				lifeRecordCollection.AddKidnapInPublic(winnerId, currDate, loserId, location, rope.ItemType, rope.TemplateId);
			}
			else
			{
				SecretInformationCollection secretInformationCollection2 = DomainManager.Information.GetSecretInformationCollection();
				int secretInfoOffset2 = secretInformationCollection2.AddKidnapInPrivate(winnerId, loserId);
				int secretInfoId2 = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset2, true);
				lifeRecordCollection.AddKidnapInPrivate(winnerId, currDate, loserId, location, rope.ItemType, rope.TemplateId);
			}
		}

		// Token: 0x06007070 RID: 28784 RVA: 0x00406600 File Offset: 0x00404800
		public void CombatResultHandle_ReleaseEnemy(DataContext context, Character winner, Character loser)
		{
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			Location location = winner.GetLocation();
			bool flag = !location.IsValid();
			if (flag)
			{
				location = winner.GetValidLocation();
			}
			this.EscapeToRandomNearbyBlock(context, loser, 3);
			lifeRecordCollection.AddReleaseLoser(winner.GetId(), currDate, loser.GetId(), location);
		}

		// Token: 0x06007071 RID: 28785 RVA: 0x00406660 File Offset: 0x00404860
		public int CalcExpGain(sbyte targetGrade, int expGainRatio)
		{
			return (int)AiHelper.CombatRelatedConstants.ExpGainLevels[(int)targetGrade] * expGainRatio / 100;
		}

		// Token: 0x06007072 RID: 28786 RVA: 0x00406680 File Offset: 0x00404880
		public void GetTaiwuCombatEnemyTeam(DataContext context, Character targetChar, CombatType combatType, List<int> enemyList)
		{
			List<Character> enemyTeam = ObjectPool<List<Character>>.Instance.Get();
			enemyTeam.Clear();
			bool flag = combatType == CombatType.Beat || combatType == CombatType.Die;
			if (flag)
			{
				int targetLeader = targetChar.GetLeaderId();
				bool flag2 = targetLeader >= 0;
				if (flag2)
				{
					this.AddGroupCharactersToCombatTeam(targetChar.GetId(), targetLeader, enemyTeam, combatType);
				}
				this.AddGuardsToCombatTeam(context, targetChar, enemyTeam, true);
				this.GetStrongestThreeAndSelf(targetChar, enemyTeam);
				enemyTeam.Sort((Character a, Character b) => -a.GetCombatPower().CompareTo(b.GetCombatPower()));
			}
			else
			{
				enemyTeam.Add(targetChar);
			}
			foreach (Character character in enemyTeam)
			{
				enemyList.Add(character.GetId());
			}
			ObjectPool<List<Character>>.Instance.Return(enemyTeam);
		}

		// Token: 0x06007073 RID: 28787 RVA: 0x00406770 File Offset: 0x00404970
		public void SimulateRandomEnemyAttackNpc(DataContext context, Character attackerChar, Character defenderChar, int attackCount, int maxDefendCount, CombatType combatType)
		{
			this._attackerTeamsCache.Clear();
			this._defenderTeamsCache.Clear();
			this._attackerTeamsCache.Add(attackerChar);
			this._defenderTeamsCache.Add(defenderChar);
			this.SimulateAttacks(context, this._attackerTeamsCache, this._defenderTeamsCache, attackCount, maxDefendCount, combatType);
		}

		// Token: 0x06007074 RID: 28788 RVA: 0x004067CA File Offset: 0x004049CA
		[Obsolete]
		public AiHelper.NpcCombatResultType SimulateRandomEnemyAttack(DataContext context, MapTemplateEnemyInfo mapTemplateEnemyInfo, Character attackedChar)
		{
			return this.SimulateEnemyAttack(context, mapTemplateEnemyInfo.TemplateId, attackedChar);
		}

		// Token: 0x06007075 RID: 28789 RVA: 0x004067DC File Offset: 0x004049DC
		internal AiHelper.NpcCombatResultType SimulateEnemyAttackWithEnemyChar(DataContext context, short enemyTemplateId, Character attackedChar, out Character enemyChar)
		{
			CharacterItem enemyConfig = Character.Instance[enemyTemplateId];
			byte creatingType = enemyConfig.CreatingType;
			if (!true)
			{
			}
			Character character;
			if (creatingType != 2)
			{
				if (creatingType != 3)
				{
					character = null;
				}
				else
				{
					character = DomainManager.Extra.GetPregeneratedFixedEnemy(enemyConfig.TemplateId);
				}
			}
			else
			{
				character = ((enemyConfig.RandomEnemyId < 0) ? null : this.GetPregeneratedRandomEnemy(enemyConfig.RandomEnemyId));
			}
			if (!true)
			{
			}
			enemyChar = character;
			bool flag = enemyChar == null;
			AiHelper.NpcCombatResultType result;
			if (flag)
			{
				Logger logger = CharacterDomain.Logger;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(46, 4);
				defaultInterpolatedStringHandler.AppendFormatted<int>(attackedChar.GetId());
				defaultInterpolatedStringHandler.AppendLiteral(" is attacked by enemy ");
				defaultInterpolatedStringHandler.AppendFormatted(enemyConfig.Surname);
				defaultInterpolatedStringHandler.AppendFormatted(enemyConfig.GivenName);
				defaultInterpolatedStringHandler.AppendLiteral("(");
				defaultInterpolatedStringHandler.AppendFormatted<short>(enemyConfig.TemplateId);
				defaultInterpolatedStringHandler.AppendLiteral(") without valid config.");
				logger.AppendWarning(defaultInterpolatedStringHandler.ToStringAndClear());
				result = AiHelper.NpcCombatResultType.MajorDefeat;
			}
			else
			{
				result = this.SimulateCharacterCombat(context, enemyChar, attackedChar, CombatType.Beat, true, 1);
			}
			return result;
		}

		// Token: 0x06007076 RID: 28790 RVA: 0x004068EC File Offset: 0x00404AEC
		public AiHelper.NpcCombatResultType SimulateEnemyAttack(DataContext context, short enemyTemplateId, Character attackedChar)
		{
			Character character;
			return this.SimulateEnemyAttackWithEnemyChar(context, enemyTemplateId, attackedChar, out character);
		}

		// Token: 0x06007077 RID: 28791 RVA: 0x00406904 File Offset: 0x00404B04
		public int GetSimulateCharacterCombatWinRate(DataContext context, Character charA, Character charB, int minPowerA = 1, int minPowerB = 1, bool needCalcPower = true)
		{
			int powerA = needCalcPower ? Math.Max(minPowerA, charA.GetCombatPower()) : minPowerA;
			int powerB = needCalcPower ? Math.Max(minPowerB, charB.GetCombatPower()) : minPowerB;
			bool charAInvincible = charA.IsInvincibleInNpcCombat();
			bool charBInvincible = charB.IsInvincibleInNpcCombat();
			return this.GetSimulateCharacterCombatWinRate(powerA, powerB, charAInvincible, charBInvincible, context.Random.NextBool());
		}

		// Token: 0x06007078 RID: 28792 RVA: 0x00406968 File Offset: 0x00404B68
		public int GetSimulateCharacterCombatWinRate(int powerA, int powerB, bool charAInvincible, bool charBInvincible, bool forceResult)
		{
			return (charAInvincible != charBInvincible && forceResult) ? (charAInvincible ? 100 : 0) : (powerA * 50 / Math.Max(1, powerB));
		}

		// Token: 0x06007079 RID: 28793 RVA: 0x004069A0 File Offset: 0x00404BA0
		public AiHelper.NpcCombatResultType SimulateCharacterCombat(DataContext context, Character charA, Character charB, CombatType combatType, bool isGroupCombat = true, int expMultiplier = 1)
		{
			int charIdA = charA.GetId();
			int charIdB = charB.GetId();
			List<Character> teamA = ObjectPool<List<Character>>.Instance.Get();
			List<Character> teamB = ObjectPool<List<Character>>.Instance.Get();
			teamA.Clear();
			teamB.Clear();
			if (isGroupCombat)
			{
				int leaderIdA = charA.GetLeaderId();
				int leaderIdB = charB.GetLeaderId();
				bool flag = leaderIdA != leaderIdB;
				if (flag)
				{
					bool flag2 = leaderIdA >= 0;
					if (flag2)
					{
						this.AddGroupCharactersToCombatTeam(charIdA, leaderIdA, teamA, combatType);
					}
					bool flag3 = leaderIdB >= 0;
					if (flag3)
					{
						this.AddGroupCharactersToCombatTeam(charIdB, leaderIdB, teamB, combatType);
					}
				}
				this.AddGuardsToCombatTeam(context, charA, teamA, false);
				this.AddGuardsToCombatTeam(context, charB, teamB, false);
			}
			this.GetStrongestThreeAndSelf(charA, teamA);
			this.GetStrongestThreeAndSelf(charB, teamB);
			int teamARawPower = Math.Max(1, teamA.Sum((Character character) => character.GetCombatPower()));
			int teamBRawPower = Math.Max(1, teamB.Sum((Character character) => character.GetCombatPower()));
			bool charAInvincible = charA.IsInvincibleInNpcCombat();
			bool charBInvincible = charB.IsInvincibleInNpcCombat();
			CharacterDomain.SimulateCombatContext npcCombatContext = new CharacterDomain.SimulateCombatContext
			{
				CharA = charA,
				TeamA = teamA,
				CharB = charB,
				TeamB = teamB,
				CombatType = combatType,
				ExpMultiplier = expMultiplier,
				ForceResult = (charAInvincible != charBInvincible && context.Random.NextBool())
			};
			int teamAWinRate = this.GetSimulateCharacterCombatWinRate(teamARawPower, Math.Max(1, teamBRawPower), charAInvincible, charBInvincible, npcCombatContext.ForceResult);
			bool flag4 = teamAWinRate >= 100;
			if (flag4)
			{
				npcCombatContext.CombatResultType = AiHelper.NpcCombatResultType.MajorVictory;
				this.ApplyMajorVictoryResult(context, ref npcCombatContext);
			}
			else
			{
				bool flag5 = context.Random.CheckPercentProb(teamAWinRate);
				if (flag5)
				{
					npcCombatContext.CombatResultType = AiHelper.NpcCombatResultType.MinorVictory;
					this.ApplyMinorVictoryResult(context, ref npcCombatContext);
				}
				else
				{
					bool flag6 = teamAWinRate > 50;
					if (flag6)
					{
						npcCombatContext.CombatResultType = AiHelper.NpcCombatResultType.MinorDefeat;
						this.ApplyMinorVictoryResult(context, ref npcCombatContext);
					}
					else
					{
						npcCombatContext.CombatResultType = AiHelper.NpcCombatResultType.MajorDefeat;
						this.ApplyMajorVictoryResult(context, ref npcCombatContext);
					}
				}
			}
			ObjectPool<List<Character>>.Instance.Return(teamA);
			ObjectPool<List<Character>>.Instance.Return(teamB);
			return npcCombatContext.CombatResultType;
		}

		// Token: 0x0600707A RID: 28794 RVA: 0x00406BF4 File Offset: 0x00404DF4
		private void ApplyMajorVictoryResult(DataContext context, ref CharacterDomain.SimulateCombatContext combatContext)
		{
			HashSet<int> closeCharIds = ObjectPool<HashSet<int>>.Instance.Get();
			Character winnerChar = combatContext.WinnerChar;
			List<Character> winnerTeam = combatContext.WinnerTeam;
			Character loserChar = combatContext.LoserChar;
			List<Character> loserTeam = combatContext.LoserTeam;
			this.SimulateAttacks(context, winnerTeam, loserTeam, 4, 0, combatContext.CombatType);
			int expGain = this.CalcExpGain(loserChar.GetOrganizationInfo().Grade, 100) * combatContext.ExpMultiplier;
			winnerChar.ChangeExp(context, expGain);
			loserChar.ChangeExp(context, expGain);
			this.AddCombatResultRecords(context, ref combatContext);
			ObjectPool<HashSet<int>>.Instance.Return(closeCharIds);
		}

		// Token: 0x0600707B RID: 28795 RVA: 0x00406C84 File Offset: 0x00404E84
		private void ApplyMinorVictoryResult(DataContext context, ref CharacterDomain.SimulateCombatContext combatContext)
		{
			HashSet<int> closeCharIds = ObjectPool<HashSet<int>>.Instance.Get();
			Character winnerChar = combatContext.WinnerChar;
			List<Character> winnerTeam = combatContext.WinnerTeam;
			Character loserChar = combatContext.LoserChar;
			List<Character> loserTeam = combatContext.LoserTeam;
			this.SimulateAttacks(context, winnerTeam, loserTeam, 2, 0, combatContext.CombatType);
			this.SimulateAttacks(context, loserTeam, winnerTeam, 1, 0, combatContext.CombatType);
			int expGain = this.CalcExpGain(loserChar.GetOrganizationInfo().Grade, 100) * combatContext.ExpMultiplier;
			winnerChar.ChangeExp(context, expGain);
			loserChar.ChangeExp(context, expGain);
			this.AddCombatResultRecords(context, ref combatContext);
			ObjectPool<HashSet<int>>.Instance.Return(closeCharIds);
		}

		// Token: 0x0600707C RID: 28796 RVA: 0x00406D28 File Offset: 0x00404F28
		private void AddCombatResultRecords(DataContext context, ref CharacterDomain.SimulateCombatContext combatContext)
		{
			Character winnerChar = combatContext.WinnerChar;
			Character loserChar = combatContext.LoserChar;
			int currDate = DomainManager.World.GetCurrDate();
			int winnerCharId = winnerChar.GetId();
			int loserCharId = loserChar.GetId();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			MonthlyNotificationCollection monthlyNotifications = DomainManager.World.GetMonthlyNotificationCollection();
			bool flag = winnerChar.GetCreatingType() != 1;
			if (flag)
			{
				Location location = loserChar.GetLocation();
				sbyte winnerCharOrgTemplateId = winnerChar.GetOrganizationInfo().OrgTemplateId;
				short winnerCharTemplateId = winnerChar.GetTemplateId();
				bool flag2 = winnerCharOrgTemplateId == 18;
				if (flag2)
				{
					lifeRecordCollection.AddDefeatedByRighteousRandomEnemy(loserCharId, currDate, location, winnerCharTemplateId);
					bool flag3 = this.IsTaiwuPeople(loserCharId);
					if (flag3)
					{
						monthlyNotifications.AddDefeatedByRighteousRandomEnemy(loserCharId, location, winnerCharTemplateId);
					}
				}
				else
				{
					bool flag4 = winnerCharOrgTemplateId == 17 || winnerCharOrgTemplateId == 19;
					if (flag4)
					{
						lifeRecordCollection.AddDefeatedByHereticRandomEnemy(loserCharId, currDate, location, winnerCharTemplateId);
						bool flag5 = this.IsTaiwuPeople(loserCharId);
						if (flag5)
						{
							monthlyNotifications.AddDefeatedByHereticRandomEnemy(loserCharId, location, winnerCharTemplateId);
						}
					}
					else
					{
						bool flag6 = winnerCharTemplateId >= 210 && winnerCharTemplateId <= 227;
						if (flag6)
						{
							lifeRecordCollection.AddDefeatedByAnimal(loserCharId, currDate, location, winnerCharTemplateId);
							bool flag7 = this.IsTaiwuPeople(loserCharId);
							if (flag7)
							{
								monthlyNotifications.AddDefeatedByAnimal(loserCharId, location, winnerCharTemplateId);
							}
						}
					}
				}
			}
			else
			{
				bool flag8 = loserChar.GetCreatingType() != 1;
				if (flag8)
				{
					Location location2 = winnerChar.GetLocation();
					sbyte loserCharOrgTemplateId = loserChar.GetOrganizationInfo().OrgTemplateId;
					short loserCharTemplateId = loserChar.GetTemplateId();
					bool flag9 = loserCharOrgTemplateId == 18;
					if (flag9)
					{
						bool forceResult = combatContext.ForceResult;
						if (forceResult)
						{
							List<short> featureIds = winnerChar.GetFeatureIds();
							bool flag10 = featureIds.Contains(484);
							if (flag10)
							{
								lifeRecordCollection.AddCleanBodyDefeatRighteousRandomEnemy(winnerCharId, currDate, location2, loserCharTemplateId);
							}
							else
							{
								bool flag11 = featureIds.Contains(485);
								if (flag11)
								{
									lifeRecordCollection.AddEvilBodyDefeatRighteousRandomEnemy(winnerCharId, currDate, location2, loserCharTemplateId);
								}
								else
								{
									lifeRecordCollection.AddKillRighteousRandomEnemy(winnerCharId, currDate, location2, loserCharTemplateId);
								}
							}
						}
						else
						{
							lifeRecordCollection.AddKillRighteousRandomEnemy(winnerCharId, currDate, location2, loserCharTemplateId);
						}
						bool flag12 = this.IsTaiwuPeople(winnerCharId);
						if (flag12)
						{
							monthlyNotifications.AddKillRighteousRandomEnemy(winnerCharId, location2, loserCharTemplateId);
						}
					}
					else
					{
						bool flag13 = loserCharOrgTemplateId == 17 || loserCharOrgTemplateId == 19;
						if (flag13)
						{
							bool forceResult2 = combatContext.ForceResult;
							if (forceResult2)
							{
								List<short> featureIds2 = winnerChar.GetFeatureIds();
								bool flag14 = featureIds2.Contains(484);
								if (flag14)
								{
									lifeRecordCollection.AddCleanBodyDefeatHereticRandomEnemy(winnerCharId, currDate, location2, loserCharTemplateId);
								}
								else
								{
									bool flag15 = featureIds2.Contains(485);
									if (flag15)
									{
										lifeRecordCollection.AddEvilBodyDefeatHereticRandomEnemy(winnerCharId, currDate, location2, loserCharTemplateId);
									}
									else
									{
										lifeRecordCollection.AddKillHereticRandomEnemy(winnerCharId, currDate, location2, loserCharTemplateId);
									}
								}
							}
							else
							{
								lifeRecordCollection.AddKillHereticRandomEnemy(winnerCharId, currDate, location2, loserCharTemplateId);
							}
							bool flag16 = this.IsTaiwuPeople(winnerCharId);
							if (flag16)
							{
								monthlyNotifications.AddKillHereticRandomEnemy(winnerCharId, location2, loserCharTemplateId);
							}
						}
						else
						{
							bool flag17 = loserCharTemplateId >= 210 && loserCharTemplateId <= 227;
							if (flag17)
							{
								bool forceResult3 = combatContext.ForceResult;
								if (forceResult3)
								{
									List<short> featureIds3 = winnerChar.GetFeatureIds();
									bool flag18 = featureIds3.Contains(484);
									if (flag18)
									{
										lifeRecordCollection.AddEvilBodyDefeatAnimal(winnerCharId, currDate, location2, loserCharTemplateId);
									}
									else
									{
										bool flag19 = featureIds3.Contains(485);
										if (flag19)
										{
											lifeRecordCollection.AddEvilBodyDefeatAnimal(winnerCharId, currDate, location2, loserCharTemplateId);
										}
										else
										{
											lifeRecordCollection.AddKillAnimal(winnerCharId, currDate, location2, loserCharTemplateId);
										}
									}
								}
								else
								{
									lifeRecordCollection.AddKillAnimal(winnerCharId, currDate, location2, loserCharTemplateId);
								}
								bool flag20 = this.IsTaiwuPeople(winnerCharId);
								if (flag20)
								{
									monthlyNotifications.AddKillAnimal(winnerCharId, location2, loserCharTemplateId);
								}
							}
						}
					}
				}
				else
				{
					Location location3 = winnerChar.GetLocation();
					bool flag21 = combatContext.IsMajor();
					if (flag21)
					{
						bool forceResult4 = combatContext.ForceResult;
						if (forceResult4)
						{
							List<short> featureIds4 = winnerChar.GetFeatureIds();
							bool flag22 = featureIds4.Contains(484);
							if (flag22)
							{
								lifeRecordCollection.AddCleanBodyReincarnationSuccess(winnerCharId, currDate, loserCharId, location3, (sbyte)combatContext.CombatType);
							}
							else
							{
								bool flag23 = featureIds4.Contains(485);
								if (flag23)
								{
									lifeRecordCollection.AddEvilBodyReincarnationSuccess(winnerCharId, currDate, loserCharId, location3, (sbyte)combatContext.CombatType);
								}
								else
								{
									lifeRecordCollection.AddMajorVictoryInCombat(winnerCharId, currDate, loserCharId, location3, (sbyte)combatContext.CombatType);
								}
							}
						}
						else
						{
							lifeRecordCollection.AddMajorVictoryInCombat(winnerCharId, currDate, loserCharId, location3, (sbyte)combatContext.CombatType);
						}
						SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
						int secretInfoOffset = secretInformationCollection.AddMajorVictoryInCombat(winnerCharId, loserCharId);
						int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
					}
					else
					{
						lifeRecordCollection.AddVictoryInCombat(winnerCharId, currDate, loserCharId, location3, (sbyte)combatContext.CombatType);
						SecretInformationCollection secretInformationCollection2 = DomainManager.Information.GetSecretInformationCollection();
						int secretInfoOffset2 = secretInformationCollection2.AddMinorVictoryInCombat(winnerCharId, loserCharId);
						int secretInfoId2 = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset2, true);
					}
				}
			}
		}

		// Token: 0x0600707D RID: 28797 RVA: 0x004071D8 File Offset: 0x004053D8
		private void SimulateAttacks(DataContext context, List<Character> attackerTeam, List<Character> defenderTeam, int attackCount, int maxDefendCount, CombatType combatType)
		{
			List<GameData.Domains.CombatSkill.CombatSkill> combatSkills = ObjectPool<List<GameData.Domains.CombatSkill.CombatSkill>>.Instance.Get();
			this.SelectBestScoreCombatSkillsInTeam(attackerTeam, combatSkills, attackCount);
			Character strongestChar = attackerTeam.Max((Character a, Character b) => a.GetCombatPower().CompareTo(b.GetCombatPower()));
			ItemKey defaultWeapon = DomainManager.Item.GetDefaultWeaponItemKey(context, 0);
			for (int i = 0; i < attackCount; i++)
			{
				Character defender = defenderTeam.GetRandom(context.Random);
				bool flag = defender.GetCreatingType() != 1;
				if (!flag)
				{
					bool flag2 = i < combatSkills.Count;
					if (flag2)
					{
						GameData.Domains.CombatSkill.CombatSkill combatSkill = combatSkills[i];
						int attackerId = combatSkill.GetId().CharId;
						Character attacker = this.GetElement_Objects(attackerId);
						short attackSkillId = combatSkill.GetId().SkillTemplateId;
						ItemKey weaponKey = this.SelectWeapon(context.Random, attacker, attackSkillId);
						bool flag3 = !weaponKey.IsValid();
						if (flag3)
						{
							weaponKey = defaultWeapon;
						}
						DomainManager.Combat.NpcSimplifiedAttack(context, attacker, defender, combatSkill, weaponKey, combatType);
					}
					else
					{
						Character attacker2 = strongestChar;
						ItemKey weaponKey2 = this.SelectWeapon(context.Random, attacker2, -1);
						bool flag4 = !weaponKey2.IsValid();
						if (flag4)
						{
							weaponKey2 = defaultWeapon;
						}
						DomainManager.Combat.NpcSimplifiedAttack(context, attacker2, defender, null, weaponKey2, combatType);
					}
				}
			}
			combatSkills.Clear();
			ObjectPool<List<GameData.Domains.CombatSkill.CombatSkill>>.Instance.Return(combatSkills);
		}

		// Token: 0x0600707E RID: 28798 RVA: 0x00407340 File Offset: 0x00405540
		private void AddGroupCharactersToCombatTeam(int charId, int leaderId, List<Character> team, CombatType combatType)
		{
			bool flag = leaderId == DomainManager.Taiwu.GetTaiwuCharId();
			if (!flag)
			{
				foreach (int groupCharId in this.GetGroup(leaderId).GetCollection())
				{
					bool flag2 = groupCharId == charId;
					if (!flag2)
					{
						Character groupChar;
						bool flag3 = !this.TryGetElement_Objects(groupCharId, out groupChar);
						if (flag3)
						{
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(59, 2);
							defaultInterpolatedStringHandler.AppendLiteral("Trying to find ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(groupCharId);
							defaultInterpolatedStringHandler.AppendLiteral(" in ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(leaderId);
							defaultInterpolatedStringHandler.AppendLiteral("'s group, but target is no longer alive.");
							throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						bool flag4 = groupChar.GetAgeGroup() == 0 || groupChar.NeedToAvoidCombat(combatType);
						if (!flag4)
						{
							team.Add(groupChar);
						}
					}
				}
				this.AddSpecialGroupCharactersToCombatTeam(charId, team, combatType);
			}
		}

		// Token: 0x0600707F RID: 28799 RVA: 0x00407458 File Offset: 0x00405658
		private void AddSpecialGroupCharactersToCombatTeam(int charId, List<Character> team, CombatType combatType)
		{
			IReadOnlySet<int> group = DomainManager.Extra.GetSpecialGroup(charId);
			foreach (int groupCharId in group)
			{
				Character groupChar;
				bool flag = !this.TryGetElement_Objects(groupCharId, out groupChar);
				if (flag)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(59, 2);
					defaultInterpolatedStringHandler.AppendLiteral("Trying to find ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(groupCharId);
					defaultInterpolatedStringHandler.AppendLiteral(" in ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
					defaultInterpolatedStringHandler.AppendLiteral("'s group, but target is no longer alive.");
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				bool flag2 = groupChar.NeedToAvoidCombat(combatType);
				if (!flag2)
				{
					team.Add(groupChar);
				}
			}
		}

		// Token: 0x06007080 RID: 28800 RVA: 0x0040752C File Offset: 0x0040572C
		private void AddCharactersToCombatTeam(int charId, int leaderId, IEnumerable<int> group, List<Character> team, CombatType combatType)
		{
			foreach (int groupCharId in group)
			{
				bool flag = groupCharId == charId;
				if (!flag)
				{
					Character groupChar;
					bool flag2 = !this.TryGetElement_Objects(groupCharId, out groupChar);
					if (flag2)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(59, 2);
						defaultInterpolatedStringHandler.AppendLiteral("Trying to find ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(groupCharId);
						defaultInterpolatedStringHandler.AppendLiteral(" in ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(leaderId);
						defaultInterpolatedStringHandler.AppendLiteral("'s group, but target is no longer alive.");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					bool flag3 = groupChar.GetAgeGroup() == 0 || groupChar.NeedToAvoidCombat(combatType);
					if (!flag3)
					{
						team.Add(groupChar);
					}
				}
			}
		}

		// Token: 0x06007081 RID: 28801 RVA: 0x0040760C File Offset: 0x0040580C
		private unsafe void AddGuardsToCombatTeam(DataContext context, Character character, List<Character> team, bool createRealGuard = false)
		{
			bool flag = !this.HasGuard(character.GetId(), character);
			if (!flag)
			{
				Span<short> span = new Span<short>(stackalloc byte[(UIntPtr)6], 3);
				SpanList<short> guardTemplateIds = span;
				this.GetGuards(context, character, ref guardTemplateIds);
				if (createRealGuard)
				{
					foreach (short ptr in guardTemplateIds)
					{
						short templateId = ptr;
						Character randomEnemy = this.CreateRandomEnemy(context, templateId, null);
						this.CompleteCreatingCharacter(randomEnemy.GetId());
						DomainManager.Adventure.AddTemporaryEnemyId(randomEnemy.GetId());
						team.Add(randomEnemy);
					}
				}
				else
				{
					foreach (short ptr2 in guardTemplateIds)
					{
						short templateId2 = ptr2;
						short randomEnemyTemplateId = Character.Instance[templateId2].RandomEnemyId;
						team.Add(this.GetPregeneratedRandomEnemy(randomEnemyTemplateId));
					}
				}
			}
		}

		// Token: 0x06007082 RID: 28802 RVA: 0x004076F4 File Offset: 0x004058F4
		private void GetStrongestThreeAndSelf(Character character, List<Character> team)
		{
			team.Sort((Character a, Character b) => -a.GetCombatPower().CompareTo(b.GetCombatPower()));
			bool flag = team.Count > 3;
			if (flag)
			{
				team.RemoveRange(3, team.Count - 3);
			}
			team.Add(character);
		}

		// Token: 0x06007083 RID: 28803 RVA: 0x00407750 File Offset: 0x00405950
		private void SelectBestScoreCombatSkillsInTeam(List<Character> team, List<GameData.Domains.CombatSkill.CombatSkill> combatSkills, int amountToSelect)
		{
			combatSkills.Clear();
			foreach (Character character in team)
			{
				ArraySegmentList<short> attackSkills = character.GetCombatSkillEquipment().Attack;
				Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> charCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(character.GetId());
				foreach (short ptr in attackSkills)
				{
					short combatSkillTemplateId = ptr;
					bool flag = combatSkillTemplateId < 0;
					if (!flag)
					{
						combatSkills.Add(charCombatSkills[combatSkillTemplateId]);
					}
				}
			}
			combatSkills.Sort((GameData.Domains.CombatSkill.CombatSkill a, GameData.Domains.CombatSkill.CombatSkill b) => -a.GetBaseScore().CompareTo(b.GetBaseScore()));
			bool flag2 = combatSkills.Count > amountToSelect;
			if (flag2)
			{
				combatSkills.RemoveRange(amountToSelect, combatSkills.Count - amountToSelect);
			}
		}

		// Token: 0x06007084 RID: 28804 RVA: 0x00407844 File Offset: 0x00405A44
		private short SelectBestDefendSkill(GameData.Domains.CombatSkill.CombatSkill attackSkill, Character defender)
		{
			return -1;
		}

		// Token: 0x06007085 RID: 28805 RVA: 0x00407858 File Offset: 0x00405A58
		private unsafe ItemKey SelectWeapon(IRandomSource random, Character character, short skillTemplateId)
		{
			ItemKey[] equipments = character.GetEquipment();
			sbyte[] weaponSlots = EquipmentSlot.EquipmentType2Slots[0];
			sbyte* selectableWeaponIndices = stackalloc sbyte[(UIntPtr)weaponSlots.Length];
			int selectableCount = 0;
			foreach (sbyte index in weaponSlots)
			{
				ItemKey weaponKey = equipments[(int)index];
				bool flag = !weaponKey.IsValid();
				if (!flag)
				{
					GameData.Domains.Item.Weapon weapon = DomainManager.Item.GetElement_Weapons(weaponKey.Id);
					bool flag2 = skillTemplateId >= 0;
					if (flag2)
					{
						List<sbyte> weaponTricks = weapon.GetTricks();
						bool flag3 = !this.WeaponHasNeedTrick(skillTemplateId, weaponTricks);
						if (!flag3)
						{
							selectableWeaponIndices[selectableCount] = index;
							selectableCount++;
						}
					}
					else
					{
						selectableWeaponIndices[selectableCount] = index;
						selectableCount++;
					}
				}
			}
			bool flag4 = selectableCount == 0;
			ItemKey result;
			if (flag4)
			{
				result = ItemKey.Invalid;
			}
			else
			{
				result = equipments[(int)selectableWeaponIndices[random.Next(selectableCount)]];
			}
			return result;
		}

		// Token: 0x06007086 RID: 28806 RVA: 0x00407940 File Offset: 0x00405B40
		private bool WeaponHasNeedTrick(short skillTemplateId, List<sbyte> weaponTricks)
		{
			List<NeedTrick> templateCostTricks = Config.CombatSkill.Instance[skillTemplateId].TrickCost;
			for (int i = 0; i < templateCostTricks.Count; i++)
			{
				NeedTrick needTrick = templateCostTricks[i];
				bool flag = !weaponTricks.Contains(needTrick.TrickType);
				if (flag)
				{
					return false;
				}
			}
			return true;
		}

		// Token: 0x06007087 RID: 28807 RVA: 0x004079A0 File Offset: 0x00405BA0
		[DomainMethod]
		public bool IsCarrierDurabilityRunningOut(int charId)
		{
			Character character;
			bool flag = !DomainManager.Character.TryGetElement_Objects(charId, out character);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				ItemKey itemKey = character.GetEquipment()[11];
				bool flag2 = !itemKey.IsValid();
				if (flag2)
				{
					result = false;
				}
				else
				{
					ItemBase itemBase = DomainManager.Item.GetBaseItem(itemKey);
					result = itemBase.IsDurabilityRunningOut();
				}
			}
			return result;
		}

		// Token: 0x06007088 RID: 28808 RVA: 0x00407A04 File Offset: 0x00405C04
		[DomainMethod]
		public CombatResources GetUsableCombatResources(int charId)
		{
			CombatResources maxResources = CombatResourcesHelper.GetMax(this.GetElement_Objects(charId));
			CombatResources usedResources;
			this._usedCombatResources.TryGetValue(charId, out usedResources);
			return maxResources.Sub(usedResources);
		}

		// Token: 0x06007089 RID: 28809 RVA: 0x00407A3C File Offset: 0x00405C3C
		public CombatResources GetUsedCombatResources(int charId)
		{
			CombatResources usedCombatResources;
			this._usedCombatResources.TryGetValue(charId, out usedCombatResources);
			return usedCombatResources;
		}

		// Token: 0x0600708A RID: 28810 RVA: 0x00407A60 File Offset: 0x00405C60
		public void UseCombatResources(DataContext context, int charId, EHealActionType type, sbyte delta = 1)
		{
			CombatResources usedResources = this._usedCombatResources.GetOrDefault(charId);
			usedResources.Change(type, (int)delta);
			this._usedCombatResources[charId] = usedResources;
		}

		// Token: 0x0600708B RID: 28811 RVA: 0x00407A94 File Offset: 0x00405C94
		public void RecoverCombatResources(DataContext context)
		{
			this._usedCombatResources.Clear();
		}

		// Token: 0x0600708C RID: 28812 RVA: 0x00407AA4 File Offset: 0x00405CA4
		public void RecoverHealCombatResources(DataContext context, int charId)
		{
			CombatResources usedResources = this._usedCombatResources.GetOrDefault(charId);
			usedResources.Set(EHealActionType.Healing, 0);
			this._usedCombatResources[charId] = usedResources;
		}

		// Token: 0x0600708D RID: 28813 RVA: 0x00407AD8 File Offset: 0x00405CD8
		public void RecoverDetoxCombatResources(DataContext context, int charId)
		{
			CombatResources usedResources = this._usedCombatResources.GetOrDefault(charId);
			usedResources.Set(EHealActionType.Detox, 0);
			this._usedCombatResources[charId] = usedResources;
		}

		// Token: 0x0600708E RID: 28814 RVA: 0x00407B0C File Offset: 0x00405D0C
		private unsafe void UpgradeCombatSkillEquipmentData(DataContext context)
		{
			CharacterDomain.Logger.Warn("Upgrading combat skill equipment data.");
			Span<short> span = new Span<short>(stackalloc byte[(UIntPtr)96], 48);
			SpanList<short> validSkills = span;
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				validSkills.Clear();
				CombatSkillPlan skillPlan;
				bool flag = DomainManager.Extra.TryGetCharacterEquippedCombatSkills(charId, out skillPlan);
				if (!flag)
				{
					short[] equippedCombatSkills = character.GetEquippedCombatSkills();
					Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> charCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(charId);
					foreach (short skillId in equippedCombatSkills)
					{
						bool flag2 = skillId < 0 || validSkills.Contains(skillId);
						if (!flag2)
						{
							bool flag3 = !charCombatSkills.ContainsKey(skillId);
							if (!flag3)
							{
								validSkills.Add(skillId);
							}
						}
					}
					bool flag4 = validSkills.Count == 0;
					if (!flag4)
					{
						CombatSkillHelper.InitializeEquippedSkills(equippedCombatSkills);
						CombatSkillEquipment equipment = character.GetCombatSkillEquipment();
						equipment.OfflineClear();
						foreach (short ptr in validSkills)
						{
							short skillId2 = ptr;
							equipment.OfflineAddSkill(skillId2);
						}
						character.ApplyCombatSkillEquipmentModification(context, equipment);
					}
				}
			}
		}

		// Token: 0x0600708F RID: 28815 RVA: 0x00407C94 File Offset: 0x00405E94
		[DomainMethod]
		public sbyte[] GetCombatSkillSlotCounts(int charId)
		{
			sbyte[] slotCounts = new sbyte[6];
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			sbyte[] result;
			if (flag)
			{
				result = slotCounts;
			}
			else
			{
				sbyte genericSlotCount = character.GetCombatSkillSlotCounts(slotCounts);
				slotCounts[5] = genericSlotCount;
				result = slotCounts;
			}
			return result;
		}

		// Token: 0x06007090 RID: 28816 RVA: 0x00407CD8 File Offset: 0x00405ED8
		[DomainMethod]
		public sbyte[] GetCombatSkillExtraSlotCounts(int charId)
		{
			sbyte[] slotCounts = new sbyte[5];
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			sbyte[] result;
			if (flag)
			{
				result = slotCounts;
			}
			else
			{
				character.GetCombatSkillExtraSlotCounts(slotCounts);
				result = slotCounts;
			}
			return result;
		}

		// Token: 0x06007091 RID: 28817 RVA: 0x00407D14 File Offset: 0x00405F14
		[DomainMethod]
		public void AddEquippedCombatSkill(DataContext context, int charId, short skillTemplateId)
		{
			Character character = DomainManager.Character.GetElement_Objects(charId);
			character.AddEquippedCombatSkill(context, skillTemplateId);
		}

		// Token: 0x06007092 RID: 28818 RVA: 0x00407D38 File Offset: 0x00405F38
		[DomainMethod]
		public void RemoveEquippedCombatSkill(DataContext context, int charId, short skillTemplateId)
		{
			Character character = DomainManager.Character.GetElement_Objects(charId);
			character.RemoveEquippedCombatSkill(context, skillTemplateId);
		}

		// Token: 0x06007093 RID: 28819 RVA: 0x00407D5C File Offset: 0x00405F5C
		[DomainMethod]
		public void UnequipAllCombatSkills(DataContext context, int charId)
		{
			Character character;
			bool flag = !this._objects.TryGetValue(charId, out character);
			if (!flag)
			{
				character.ClearCombatSkillEquipment(context);
			}
		}

		// Token: 0x06007094 RID: 28820 RVA: 0x00407D8C File Offset: 0x00405F8C
		[DomainMethod]
		public void AutoEquipCombatSkills(DataContext context, int charId, short combatConfigTemplateId = -1)
		{
			Character character;
			bool flag = !this._objects.TryGetValue(charId, out character);
			if (!flag)
			{
				context.Equipping.EquipCombatSkills(context, character, combatConfigTemplateId);
			}
		}

		// Token: 0x06007095 RID: 28821 RVA: 0x00407DC0 File Offset: 0x00405FC0
		[DomainMethod]
		public void AutoEquipItems(DataContext context, int charId)
		{
			Character character = this._objects[charId];
			context.Equipping.EquipItems(context, character);
		}

		// Token: 0x06007096 RID: 28822 RVA: 0x00407DEC File Offset: 0x00405FEC
		[DomainMethod]
		public void AutoSetCombatSkillAttainmentPanels(DataContext context, int charId)
		{
			Character character = this._objects[charId];
			context.Equipping.SetInitialCombatSkillAttainmentPanels(context, character);
		}

		// Token: 0x06007097 RID: 28823 RVA: 0x00407E18 File Offset: 0x00406018
		[DomainMethod]
		public void AutoAllocateNeili(DataContext context, int charId)
		{
			Character character = this._objects[charId];
			context.Equipping.AllocateNeili(context, character);
		}

		// Token: 0x06007098 RID: 28824 RVA: 0x00407E44 File Offset: 0x00406044
		[DomainMethod]
		public void UpdateCombatSkillPlan(DataContext context, int charId, int planId)
		{
			bool flag = charId == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				DomainManager.Taiwu.UpdateCombatSkillPlan(context, planId);
			}
			else
			{
				Character character = this._objects[charId];
				CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId) ?? new CharacterCombatSkillConfiguration(character);
				bool flag2 = planId != configuration.CurrentPlanId;
				if (flag2)
				{
					configuration.OfflineRecordCombatSkillPlan(character, configuration.CurrentPlanId);
				}
				configuration.CurrentPlanId = planId;
				DomainManager.Extra.SetCharacterMasteredCombatSkills(context, charId, new GameData.Utilities.ShortList(configuration.CombatSkillMasterPlans[planId]));
				DomainManager.Character.ApplyCombatSkillPlan(context, character, configuration.CombatSkillEquipPlans[planId]);
				DomainManager.Extra.SetCharacterCombatSkillConfiguration(context, charId, configuration);
			}
		}

		// Token: 0x06007099 RID: 28825 RVA: 0x00407F08 File Offset: 0x00406108
		[DomainMethod]
		public void DuplicateCurrentCombatSkillPlan(DataContext context, int charId)
		{
			bool flag = charId == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				DomainManager.Taiwu.CopyCombatSkillPlan(context);
			}
			else
			{
				Character character = this._objects[charId];
				CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId);
				if (configuration == null)
				{
					configuration = new CharacterCombatSkillConfiguration(character);
				}
				int planCount = configuration.PlanCount;
				bool flag2 = planCount == 9;
				if (!flag2)
				{
					configuration.OfflineRecordCombatSkillPlan(character, configuration.CurrentPlanId);
					configuration.OfflineRecordCombatSkillPlan(character, planCount);
					configuration.CurrentPlanId = planCount;
					DomainManager.Extra.SetCharacterCombatSkillConfiguration(context, charId, configuration);
				}
			}
		}

		// Token: 0x0600709A RID: 28826 RVA: 0x00407F9C File Offset: 0x0040619C
		[DomainMethod]
		public void AppendCombatSkillPlan(DataContext context, int charId)
		{
			bool flag = charId == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				DomainManager.Taiwu.AppendCombatSkillPlan(context);
			}
			else
			{
				CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId);
				Character character = this.GetElement_Objects(charId);
				if (configuration == null)
				{
					configuration = new CharacterCombatSkillConfiguration(character);
				}
				int planCount = configuration.PlanCount;
				bool flag2 = planCount == 9;
				if (!flag2)
				{
					configuration.OfflineUpdateMaxPlanCount(planCount + 1);
					DomainManager.Extra.SetCharacterCombatSkillConfiguration(context, charId, configuration);
					this.UpdateCombatSkillPlan(context, charId, planCount);
				}
			}
		}

		// Token: 0x0600709B RID: 28827 RVA: 0x00408020 File Offset: 0x00406220
		[DomainMethod]
		public void DeleteCombatSkillPlan(DataContext context, int charId, int planId)
		{
			bool flag = charId == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				DomainManager.Taiwu.DeleteCombatSkillPlan(context);
			}
			else
			{
				CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId);
				Character character = this.GetElement_Objects(charId);
				if (configuration == null)
				{
					configuration = new CharacterCombatSkillConfiguration(character);
				}
				int planCount = configuration.PlanCount;
				bool flag2 = planCount == 1;
				if (!flag2)
				{
					configuration.OfflineDeleteCombatSkillPlan(planId);
					DomainManager.Extra.SetCharacterCombatSkillConfiguration(context, charId, configuration);
					this.UpdateCombatSkillPlan(context, charId, configuration.CurrentPlanId);
				}
			}
		}

		// Token: 0x0600709C RID: 28828 RVA: 0x004080A4 File Offset: 0x004062A4
		[DomainMethod]
		public ValueTuple<int, int> GetCurrentPlanIdAndPlanCount(int charId)
		{
			bool flag = charId == DomainManager.Taiwu.GetTaiwuCharId();
			ValueTuple<int, int> result;
			if (flag)
			{
				result = new ValueTuple<int, int>(DomainManager.Taiwu.GetCurrCombatSkillPlanId(), (int)DomainManager.Extra.GetUnlockedCombatSkillPlanCount());
			}
			else
			{
				CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId);
				bool flag2 = configuration == null;
				if (flag2)
				{
					result = new ValueTuple<int, int>(0, 1);
				}
				else
				{
					result = new ValueTuple<int, int>(configuration.CurrentPlanId, configuration.PlanCount);
				}
			}
			return result;
		}

		// Token: 0x0600709D RID: 28829 RVA: 0x00408114 File Offset: 0x00406314
		[DomainMethod]
		public byte[] GetGenericGridAllocation(int charId)
		{
			bool flag = charId == DomainManager.Taiwu.GetTaiwuCharId();
			byte[] result;
			if (flag)
			{
				result = DomainManager.Taiwu.GetGenericGridAllocation();
			}
			else
			{
				CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId);
				bool flag2 = configuration == null;
				if (flag2)
				{
					result = new byte[4];
				}
				else
				{
					result = configuration.CurrentEquipPlan.GenericGridAllocation;
				}
			}
			return result;
		}

		// Token: 0x0600709E RID: 28830 RVA: 0x0040816C File Offset: 0x0040636C
		[DomainMethod]
		public unsafe void AllocateGenericGrid(DataContext context, int charId, sbyte equipType)
		{
			bool flag = charId == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				DomainManager.Taiwu.AllocateGenericGrid(context, equipType);
			}
			else
			{
				bool flag2 = equipType < 1;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(26, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Invalid generic grid type:");
					defaultInterpolatedStringHandler.AppendFormatted<sbyte>(equipType);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				sbyte* pGridCounts = stackalloc sbyte[(UIntPtr)5];
				Span<sbyte> gridCounts = new Span<sbyte>((void*)pGridCounts, 5);
				Character character = this.GetElement_Objects(charId);
				sbyte genericSlotCount = character.GetCombatSkillSlotCounts(gridCounts);
				CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId) ?? new CharacterCombatSkillConfiguration(character);
				CombatSkillPlan plan = configuration.CurrentEquipPlan;
				int index = (int)(equipType - 1);
				int cost = CombatSkillHelper.GetGenericAllocationNextCost(equipType, (int)plan.GenericGridAllocation[index]);
				int remaining = character.ApplyGenericCombatSkillSlotAllocations(gridCounts, (int)genericSlotCount);
				bool flag3 = cost > remaining;
				if (flag3)
				{
					throw new InvalidOperationException("No more available generic grid");
				}
				byte[] genericGridAllocation = plan.GenericGridAllocation;
				sbyte b = equipType - 1;
				genericGridAllocation[(int)b] = genericGridAllocation[(int)b] + 1;
				DomainManager.Extra.SetCharacterCombatSkillConfiguration(context, charId, configuration);
			}
		}

		// Token: 0x0600709F RID: 28831 RVA: 0x00408274 File Offset: 0x00406474
		[DomainMethod]
		public void DeallocateGenericGrid(DataContext context, int charId, sbyte equipType)
		{
			bool flag = charId == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				DomainManager.Taiwu.DeallocateGenericGrid(context, equipType);
			}
			else
			{
				bool flag2 = equipType < 1;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(26, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Invalid generic grid type:");
					defaultInterpolatedStringHandler.AppendFormatted<sbyte>(equipType);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				Character character = this.GetElement_Objects(charId);
				CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId) ?? new CharacterCombatSkillConfiguration(character);
				CombatSkillPlan plan = configuration.CurrentEquipPlan;
				byte allocatedCount = plan.GenericGridAllocation[(int)(equipType - 1)];
				bool flag3 = allocatedCount == 0;
				if (flag3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
					defaultInterpolatedStringHandler.AppendLiteral("No generic grid allocated in type:");
					defaultInterpolatedStringHandler.AppendFormatted<sbyte>(equipType);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				byte[] genericGridAllocation = plan.GenericGridAllocation;
				sbyte b = equipType - 1;
				genericGridAllocation[(int)b] = genericGridAllocation[(int)b] - 1;
				DomainManager.Extra.SetCharacterCombatSkillConfiguration(context, charId, configuration);
			}
		}

		// Token: 0x060070A0 RID: 28832 RVA: 0x00408368 File Offset: 0x00406568
		[DomainMethod]
		public void SetCombatSkillPlanLock(DataContext context, int charId, bool isLocked)
		{
			Character character;
			bool flag = !DomainManager.Character.TryGetElement_Objects(charId, out character);
			if (!flag)
			{
				int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
				Tester.Assert(character.GetId() != taiwuCharId, "");
				Tester.Assert(character.GetLeaderId() == taiwuCharId, "");
				CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId) ?? new CharacterCombatSkillConfiguration(character);
				bool flag2 = configuration.IsCombatSkillLocked == isLocked;
				if (!flag2)
				{
					configuration.IsCombatSkillLocked = isLocked;
					DomainManager.Extra.SetCharacterCombatSkillConfiguration(context, charId, configuration);
				}
			}
		}

		// Token: 0x060070A1 RID: 28833 RVA: 0x00408400 File Offset: 0x00406600
		[DomainMethod]
		public bool IsCombatSkillEquipmentLocked(int charId)
		{
			CharacterCombatSkillConfiguration characterCombatSkillConfiguration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId);
			return characterCombatSkillConfiguration != null && characterCombatSkillConfiguration.IsCombatSkillLocked;
		}

		// Token: 0x060070A2 RID: 28834 RVA: 0x0040842C File Offset: 0x0040662C
		[DomainMethod]
		public void SetCombatSkillAttainmentLock(DataContext context, int charId, bool isLocked)
		{
			Character character;
			bool flag = !DomainManager.Character.TryGetElement_Objects(charId, out character);
			if (!flag)
			{
				int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
				Tester.Assert(character.GetId() != taiwuCharId, "");
				Tester.Assert(character.GetLeaderId() == taiwuCharId, "");
				CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId) ?? new CharacterCombatSkillConfiguration(character);
				bool flag2 = configuration.IsCombatSkillAttainmentLocked == isLocked;
				if (!flag2)
				{
					configuration.IsCombatSkillAttainmentLocked = isLocked;
					DomainManager.Extra.SetCharacterCombatSkillConfiguration(context, charId, configuration);
				}
			}
		}

		// Token: 0x060070A3 RID: 28835 RVA: 0x004084C4 File Offset: 0x004066C4
		[DomainMethod]
		public bool IsCombatSkillAttainmentLocked(int charId)
		{
			CharacterCombatSkillConfiguration characterCombatSkillConfiguration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId);
			return characterCombatSkillConfiguration != null && characterCombatSkillConfiguration.IsCombatSkillAttainmentLocked;
		}

		// Token: 0x060070A4 RID: 28836 RVA: 0x004084F0 File Offset: 0x004066F0
		[DomainMethod]
		public void SetNeiliAllocationLock(DataContext context, int charId, bool isLocked)
		{
			Character character;
			bool flag = !DomainManager.Character.TryGetElement_Objects(charId, out character);
			if (!flag)
			{
				int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
				Tester.Assert(character.GetId() != taiwuCharId, "");
				Tester.Assert(character.GetLeaderId() == taiwuCharId, "");
				CharacterCombatSkillConfiguration configuration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId) ?? new CharacterCombatSkillConfiguration(character);
				bool flag2 = configuration.IsNeiliAllocationLocked == isLocked;
				if (!flag2)
				{
					configuration.IsNeiliAllocationLocked = isLocked;
					DomainManager.Extra.SetCharacterCombatSkillConfiguration(context, charId, configuration);
				}
			}
		}

		// Token: 0x060070A5 RID: 28837 RVA: 0x00408588 File Offset: 0x00406788
		[DomainMethod]
		public bool IsNeiliAllocationLocked(int charId)
		{
			CharacterCombatSkillConfiguration characterCombatSkillConfiguration = DomainManager.Extra.TryGetCharacterCombatSkillConfiguration(charId);
			return characterCombatSkillConfiguration != null && characterCombatSkillConfiguration.IsNeiliAllocationLocked;
		}

		// Token: 0x060070A6 RID: 28838 RVA: 0x004085B4 File Offset: 0x004067B4
		public void ApplyCombatSkillAttainmentPanels(DataContext context, Character character, short[] panels)
		{
			short[] charPanels = character.GetCombatSkillAttainmentPanels();
			CombatSkillAttainmentPanelsHelper.CopyAll(panels, charPanels);
			character.SetCombatSkillAttainmentPanels(charPanels, context);
			int charId = character.GetId();
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> charCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(charId);
			foreach (short combatSkillId in charPanels)
			{
				bool flag = combatSkillId < 0;
				if (!flag)
				{
					GameData.Domains.CombatSkill.CombatSkill combatSkill;
					bool flag2 = !charCombatSkills.TryGetValue(combatSkillId, out combatSkill) || combatSkill.GetRevoked();
					if (flag2)
					{
						CharacterDomain.TryRemoveCombatSkillFromAttainmentPanel(context, character, combatSkillId);
					}
				}
			}
		}

		// Token: 0x060070A7 RID: 28839 RVA: 0x0040863C File Offset: 0x0040683C
		public void ApplyNeiliAllocation(DataContext context, Character character, NeiliAllocation targetAllocation)
		{
			character.ResetBaseNeiliAllocation(context);
			NeiliAllocation currAllocation = character.GetBaseNeiliAllocation();
			int maxNeili = character.GetMaxNeili();
			int currNeili = character.GetCurrNeili();
			CombatHelper.TryAllocateToTargetAllocation(targetAllocation, ref currAllocation, maxNeili, ref currNeili, 400, 100);
			character.SetBaseNeiliAllocation(currAllocation, context);
			character.SpecifyCurrNeili(context, currNeili);
		}

		// Token: 0x060070A8 RID: 28840 RVA: 0x0040868C File Offset: 0x0040688C
		public unsafe void ApplyCombatSkillPlan(DataContext context, Character character, CombatSkillPlan plan)
		{
			int charId = character.GetId();
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> learnedCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(charId);
			CombatSkillEquipment combatSkillEquipment = character.GetCombatSkillEquipment();
			for (sbyte type = 0; type < 5; type += 1)
			{
				short[] skillList = plan.GetSkillList(type);
				combatSkillEquipment.OfflineEnsureCapacity(type, skillList.Length);
				ArraySegmentList<short> equipTypeSlots = *combatSkillEquipment[type];
				equipTypeSlots.Clear();
				foreach (short skillId in skillList)
				{
					GameData.Domains.CombatSkill.CombatSkill skill;
					bool flag = skillId >= 0 && learnedCombatSkills.TryGetValue(skillId, out skill) && !skill.GetRevoked() && equipTypeSlots.IndexOf(skillId) < 0;
					if (flag)
					{
						equipTypeSlots.Add(skillId);
					}
				}
			}
			character.ApplyCombatSkillEquipmentModification(context, combatSkillEquipment);
		}

		// Token: 0x060070A9 RID: 28841 RVA: 0x00408760 File Offset: 0x00406960
		[Obsolete("Use CombatSkillEquipment.IsCombatSkillEquipped instead.")]
		public static bool IsCombatSkillsEquipped(short skillId, short[] equippedCombatSkills, sbyte equipType)
		{
			int startIndex = (int)CombatSkillHelper.SlotBeginIndexes[(int)equipType];
			int endIndex = (int)CombatSkillHelper.SlotEndIndexes[(int)equipType];
			for (int i = startIndex; i < endIndex; i++)
			{
				bool flag = equippedCombatSkills[i] == skillId;
				if (flag)
				{
					return true;
				}
			}
			return false;
		}

		// Token: 0x060070AA RID: 28842 RVA: 0x004087A8 File Offset: 0x004069A8
		public unsafe static sbyte GetCombatSkillsCostedGrid(int charId, CombatSkillEquipment skillEquipment, sbyte equipType)
		{
			ArraySegmentList<short> skillList = *skillEquipment[equipType];
			sbyte totalCost = 0;
			foreach (short ptr in skillList)
			{
				short skillTemplateId = ptr;
				bool flag = skillTemplateId < 0;
				if (!flag)
				{
					totalCost += DomainManager.CombatSkill.GetCombatSkillGridCost(charId, skillTemplateId);
				}
			}
			return totalCost;
		}

		// Token: 0x060070AB RID: 28843 RVA: 0x00408808 File Offset: 0x00406A08
		[Obsolete]
		public unsafe static bool ClearExceedCombatSkills(int charId, short[] equippedCombatSkills, sbyte equipType)
		{
			sbyte maxGridCount = CombatSkillHelper.MaxSlotCounts[(int)equipType];
			int startIndex = (int)CombatSkillHelper.SlotBeginIndexes[(int)equipType];
			int endIndex = (int)CombatSkillHelper.SlotEndIndexes[(int)equipType];
			int totalCount = 0;
			int num = equippedCombatSkills.Length;
			Span<short> span = new Span<short>(stackalloc byte[checked(unchecked((UIntPtr)num) * 2)], num);
			SpanList<short> equippedSkillIds = span;
			for (int i = startIndex; i < endIndex; i++)
			{
				short skillId = equippedCombatSkills[i];
				bool flag = skillId < 0;
				if (!flag)
				{
					equippedSkillIds.Add(skillId);
					equippedCombatSkills[i] = -1;
					totalCount++;
				}
			}
			int equipCount = 0;
			int currentIndex = startIndex;
			for (int j = 0; j < equippedSkillIds.Count; j++)
			{
				short skillId2 = *equippedSkillIds[j];
				sbyte gridCount = DomainManager.CombatSkill.GetCombatSkillGridCost(charId, skillId2);
				bool flag2 = currentIndex - startIndex + (int)gridCount > (int)maxGridCount;
				if (!flag2)
				{
					equippedCombatSkills[currentIndex] = skillId2;
					currentIndex += (int)gridCount;
					equipCount++;
				}
			}
			return totalCount > equipCount;
		}

		// Token: 0x060070AC RID: 28844 RVA: 0x004088FC File Offset: 0x00406AFC
		[DomainMethod]
		public ValueTuple<int, int> GetCombatSkillAttainment(int charId, sbyte type)
		{
			return new ValueTuple<int, int>(charId, (int)this.GetElement_Objects(charId).GetCombatSkillAttainment(type));
		}

		// Token: 0x060070AD RID: 28845 RVA: 0x00408924 File Offset: 0x00406B24
		[DomainMethod]
		public int[] GetAllCombatSkillAttainment(int charId)
		{
			int[] attainments = new int[14];
			for (sbyte type = 0; type < 14; type += 1)
			{
				attainments[(int)type] = (int)this.GetElement_Objects(charId).GetCombatSkillAttainment(type);
			}
			return attainments;
		}

		// Token: 0x060070AE RID: 28846 RVA: 0x00408964 File Offset: 0x00406B64
		[DomainMethod]
		public ValueTuple<int, int> GetLifeSkillAttainment(int charId, sbyte type)
		{
			Character obj;
			bool flag = this.TryGetElement_Objects(charId, out obj);
			ValueTuple<int, int> result;
			if (flag)
			{
				result = new ValueTuple<int, int>(charId, (int)obj.GetLifeSkillAttainment(type));
			}
			else
			{
				result = new ValueTuple<int, int>(-1, -1);
			}
			return result;
		}

		// Token: 0x060070AF RID: 28847 RVA: 0x0040899C File Offset: 0x00406B9C
		[DomainMethod]
		public int[] GetAllLifeSkillAttainment(int charId)
		{
			int[] attainments = new int[16];
			for (sbyte type = 0; type < 16; type += 1)
			{
				attainments[(int)type] = (int)this.GetElement_Objects(charId).GetLifeSkillAttainment(type);
			}
			return attainments;
		}

		// Token: 0x060070B0 RID: 28848 RVA: 0x004089DC File Offset: 0x00406BDC
		[DomainMethod]
		public void LearnCombatSkill(DataContext context, int charId, short skillTemplateId, ushort readingState = 0)
		{
			Character character = this.GetElement_Objects(charId);
			List<short> learnedSkillIds = character.GetLearnedCombatSkills();
			bool flag = learnedSkillIds.Contains(skillTemplateId);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(41, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Combat skill already learned. TemplateId:");
				defaultInterpolatedStringHandler.AppendFormatted<short>(skillTemplateId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			character.LearnNewCombatSkill(context, skillTemplateId, readingState);
		}

		// Token: 0x060070B1 RID: 28849 RVA: 0x00408A3C File Offset: 0x00406C3C
		[DomainMethod]
		public void LearnLifeSkill(DataContext context, int charId, short skillTemplateId, byte readingState = 0)
		{
			Character character = this.GetElement_Objects(charId);
			bool flag = character.FindLearnedLifeSkillIndex(skillTemplateId) >= 0;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(28, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Life skill ");
				defaultInterpolatedStringHandler.AppendFormatted<LifeSkillItem>(LifeSkill.Instance[skillTemplateId]);
				defaultInterpolatedStringHandler.AppendLiteral(" already learned.");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			character.LearnNewLifeSkill(context, skillTemplateId, readingState);
		}

		// Token: 0x060070B2 RID: 28850 RVA: 0x00408AB4 File Offset: 0x00406CB4
		public bool HasUnlearnedSectCombatSkills(int charId, sbyte orgTemplateId, sbyte combatSkillType)
		{
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> learnedCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(charId);
			IReadOnlyList<CombatSkillItem> learnableCombatSkills = CombatSkillDomain.GetLearnableCombatSkills(orgTemplateId, combatSkillType);
			foreach (CombatSkillItem skillCfg in learnableCombatSkills)
			{
				bool flag = learnedCombatSkills.ContainsKey(skillCfg.TemplateId);
				if (flag)
				{
					return true;
				}
			}
			return false;
		}

		// Token: 0x060070B3 RID: 28851 RVA: 0x00408B2C File Offset: 0x00406D2C
		public void RevokeCombatSkill(DataContext context, Character character, short skillTemplateId)
		{
			int charId = character.GetId();
			CombatSkillKey skillKey = new CombatSkillKey(charId, skillTemplateId);
			GameData.Domains.CombatSkill.CombatSkill skill = DomainManager.CombatSkill.GetElement_CombatSkills(skillKey);
			this.RemoveEquippedCombatSkill(context, charId, skillTemplateId);
			CharacterDomain.TryRemoveCombatSkillFromAttainmentPanel(context, character, skillTemplateId);
			bool flag = character.GetLoopingNeigong() == skillTemplateId;
			if (flag)
			{
				character.SetLoopingNeigong(-1, context);
			}
			character.ResetBaseNeiliAllocation(context);
			int currNeili = character.GetCurrNeili() - (int)skill.GetObtainedNeili();
			bool flag2 = currNeili < 0;
			if (flag2)
			{
				currNeili = 0;
			}
			character.SetCurrNeili(currNeili, context);
			skill.SetRevoked(true, context);
		}

		// Token: 0x060070B4 RID: 28852 RVA: 0x00408BB8 File Offset: 0x00406DB8
		public static bool IsLoopable(GameData.Domains.CombatSkill.CombatSkill skill)
		{
			CombatSkillItem skillConfig = Config.CombatSkill.Instance[skill.GetId().SkillTemplateId];
			bool flag = skillConfig.EquipType != 0;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				ushort activationState = skill.GetActivationState();
				bool flag2 = !CombatSkillStateHelper.IsBrokenOut(activationState);
				result = (!flag2 && !skill.GetRevoked());
			}
			return result;
		}

		// Token: 0x060070B5 RID: 28853 RVA: 0x00408C14 File Offset: 0x00406E14
		[Obsolete("Use AddEquippedCombatSkill, RemoveEquippedCombatSkill instead.")]
		[DomainMethod]
		public void SetCombatSkillSlot(DataContext context, int charId, sbyte equipType, int index, short skillTemplateId)
		{
		}

		// Token: 0x060070B6 RID: 28854 RVA: 0x00408C18 File Offset: 0x00406E18
		public void RemoveNonIntelligentCharacter(DataContext context, Character character)
		{
			Tester.Assert(character.GetCreatingType() != 1, "");
			int charId = character.GetId();
			Events.RaiseNonIntelligentCharacterRemoved(context, character);
			this.RemoveElement_Objects(charId);
			this.RemoveAllRelations(context, charId, true);
			byte creatingType = character.GetCreatingType();
			byte b = creatingType;
			byte b2 = b;
			if (b2 != 0)
			{
				if (b2 == 2)
				{
					int graveId;
					bool flag = this._skeletonCharacterCache.TryGetValue(charId, out graveId);
					if (flag)
					{
						this._skeletonCharacterCache.Remove(charId);
						this._graves[graveId].SetSkeletonCharId(-1, context);
					}
				}
			}
			else
			{
				short charTemplateId = character.GetTemplateId();
				DomainManager.Extra.RemoveInteractedCharacter(context, charId);
				this._fixedCharactersCache.Remove(charTemplateId);
				short num = charTemplateId;
				short num2 = num;
				if (num2 >= 183)
				{
					if (num2 <= 191)
					{
						this.SetForceRebelLocation(Location.Invalid, context);
					}
				}
				else if (num2 >= 165)
				{
					if (num2 <= 173)
					{
						this._tripleHateLocation = Location.Invalid;
					}
				}
				else if (num2 != 43)
				{
					if (num2 == 45)
					{
						this.SetForceKindLocation(Location.Invalid, context);
					}
				}
				else
				{
					this._tripleAdoreLocation = Location.Invalid;
				}
			}
			this.RemoveAllItemsBeforeRemovingCharacter(context, character);
		}

		// Token: 0x060070B7 RID: 28855 RVA: 0x00408D5C File Offset: 0x00406F5C
		public void RemoveTemporaryIntelligentCharacter(DataContext context, Character character)
		{
			Tester.Assert(character.GetCreatingType() == 1, "");
			Tester.Assert(this.IsTemporaryIntelligentCharacter(character.GetId()), "");
			int charId = character.GetId();
			this.RemoveElement_Objects(charId);
			Tester.Assert(!this._pregnantStates.ContainsKey(charId), "");
			Tester.Assert(character.GetKidnapperId() < 0, "");
			Tester.Assert(!this._kidnappedChars.ContainsKey(charId), "");
			this.RemoveAllRelations(context, charId, true);
			DomainManager.Extra.RemoveInteractedCharacter(context, charId);
			Tester.Assert(!this._debtsToTaiwu.ContainsKey(charId), "");
			bool flag = this._avatarElementGrowthProgress.ContainsKey(charId);
			if (flag)
			{
				this.RemoveElement_AvatarElementGrowthProgress(charId, context);
			}
			Events.RaiseTemporaryIntelligentCharacterRemoved(context, character);
			this.RemoveAllItemsBeforeRemovingCharacter(context, character);
			this.UnregisterTemporaryIntelligentCharacter(charId);
		}

		// Token: 0x060070B8 RID: 28856 RVA: 0x00408E4F File Offset: 0x0040704F
		public void RemoveXiangshuInfection(DataContext context, Character character, byte targetInfectionValue)
		{
			character.AddFeature(context, 216, true);
			character.SetXiangshuInfection(targetInfectionValue, context);
			Events.RaiseXiangshuInfectionFeatureChanged(context, character, 216);
		}

		// Token: 0x060070B9 RID: 28857 RVA: 0x00408E78 File Offset: 0x00407078
		[DomainMethod]
		public DeadCharacter TryGetDeadCharacter(int charId)
		{
			DeadCharacter deadChar;
			return this._deadCharacters.TryGetValue(charId, out deadChar) ? deadChar : null;
		}

		// Token: 0x060070BA RID: 28858 RVA: 0x00408EA0 File Offset: 0x004070A0
		public bool TryGetDeadCharacter(int charId, out DeadCharacter character)
		{
			return this._deadCharacters.TryGetValue(charId, out character);
		}

		// Token: 0x060070BB RID: 28859 RVA: 0x00408EC0 File Offset: 0x004070C0
		public DeadCharacter GetDeadCharacter(int charId)
		{
			return this._deadCharacters[charId];
		}

		// Token: 0x060070BC RID: 28860 RVA: 0x00408EE0 File Offset: 0x004070E0
		public DeadCharacter TryGetDeadCharacterByTemplateId(short templateId)
		{
			foreach (KeyValuePair<int, DeadCharacter> pair in this._deadCharacters)
			{
				bool flag = pair.Value.TemplateId == templateId;
				if (flag)
				{
					return pair.Value;
				}
			}
			return null;
		}

		// Token: 0x060070BD RID: 28861 RVA: 0x00408F54 File Offset: 0x00407154
		public int TryGetDeadCharacterIdByTemplateId(short templateId)
		{
			foreach (KeyValuePair<int, DeadCharacter> pair in this._deadCharacters)
			{
				bool flag = pair.Value.TemplateId == templateId;
				if (flag)
				{
					return pair.Key;
				}
			}
			return -1;
		}

		// Token: 0x060070BE RID: 28862 RVA: 0x00408FC8 File Offset: 0x004071C8
		public bool IsCharacterAlive(int charId)
		{
			return this._objects.ContainsKey(charId);
		}

		// Token: 0x060070BF RID: 28863 RVA: 0x00408FE8 File Offset: 0x004071E8
		public bool IsCharacterDeadAndRemoved(int charId)
		{
			return !this._objects.ContainsKey(charId) && !this._deadCharacters.ContainsKey(charId);
		}

		// Token: 0x060070C0 RID: 28864 RVA: 0x0040901C File Offset: 0x0040721C
		public sbyte GetAliveOrDeadCharacterGender(int charId)
		{
			Character character;
			bool flag = this._objects.TryGetValue(charId, out character);
			sbyte result;
			if (flag)
			{
				result = character.GetGender();
			}
			else
			{
				DeadCharacter deadChar;
				bool flag2 = this._deadCharacters.TryGetValue(charId, out deadChar);
				if (flag2)
				{
					result = deadChar.Gender;
				}
				else
				{
					result = -1;
				}
			}
			return result;
		}

		// Token: 0x060070C1 RID: 28865 RVA: 0x00409068 File Offset: 0x00407268
		public OrganizationInfo GetAliveOrgDeadCharacterOrgInfo(int charId)
		{
			Character character;
			bool flag = this._objects.TryGetValue(charId, out character);
			OrganizationInfo result;
			if (flag)
			{
				result = character.GetOrganizationInfo();
			}
			else
			{
				DeadCharacter deadChar;
				bool flag2 = this._deadCharacters.TryGetValue(charId, out deadChar);
				if (flag2)
				{
					result = deadChar.OrganizationInfo;
				}
				else
				{
					result = new OrganizationInfo(-1, -1, true, -1);
				}
			}
			return result;
		}

		// Token: 0x060070C2 RID: 28866 RVA: 0x004090BC File Offset: 0x004072BC
		public bool OrgAndMonkTypeAllowMarriage(int charId)
		{
			Character character;
			bool flag = this._objects.TryGetValue(charId, out character);
			bool result;
			if (flag)
			{
				result = character.OrgAndMonkTypeAllowMarriage();
			}
			else
			{
				DeadCharacter deadCharacter;
				bool flag2 = this._deadCharacters.TryGetValue(charId, out deadCharacter);
				result = (flag2 && deadCharacter.OrgAndMonkTypeAllowMarriage());
			}
			return result;
		}

		// Token: 0x060070C3 RID: 28867 RVA: 0x00409108 File Offset: 0x00407308
		public bool TryGetCharacterPrioritizedAction(int charId, out BasePrioritizedAction action)
		{
			PrioritizedActionWrapper actionWrapper;
			action = (this._prioritizedActions.TryGetValue(charId, out actionWrapper) ? actionWrapper.Action : null);
			return action != null;
		}

		// Token: 0x060070C4 RID: 28868 RVA: 0x0040913C File Offset: 0x0040733C
		public void SetCharacterPrioritizedAction(DataContext context, int charId)
		{
			PrioritizedActionWrapper actionWrapper;
			bool flag = this._prioritizedActions.TryGetValue(charId, out actionWrapper);
			if (flag)
			{
				this.SetElement_PrioritizedActions(charId, actionWrapper, context);
			}
		}

		// Token: 0x060070C5 RID: 28869 RVA: 0x00409168 File Offset: 0x00407368
		public PrioritizedActionWrapper AddCharacterPrioritizedAction(DataContext context, int charId, BasePrioritizedAction action)
		{
			PrioritizedActionWrapper actionWrapper = new PrioritizedActionWrapper
			{
				ActionType = action.ActionType,
				Action = action
			};
			this.AddElement_PrioritizedActions(charId, actionWrapper, context);
			return actionWrapper;
		}

		// Token: 0x060070C6 RID: 28870 RVA: 0x004091A0 File Offset: 0x004073A0
		public void StartCharacterPrioritizedAction(DataContext context, Character character, BasePrioritizedAction action)
		{
			int charId = character.GetId();
			BasePrioritizedAction previousAction;
			bool flag = this.TryGetCharacterPrioritizedAction(charId, out previousAction);
			if (flag)
			{
				previousAction.OnInterrupt(context, character);
				this.RemoveElement_PrioritizedActions(charId, context);
				character.ResetPrioritizedActionCooldown(context, action.ActionType, false);
			}
			this.AddCharacterPrioritizedAction(context, charId, action);
			action.OnStart(context, character);
		}

		// Token: 0x060070C7 RID: 28871 RVA: 0x004091F8 File Offset: 0x004073F8
		public void RemoveCharacterPrioritizedAction(DataContext context, int charId)
		{
			this.RemoveElement_PrioritizedActions(charId, context);
		}

		// Token: 0x060070C8 RID: 28872 RVA: 0x00409204 File Offset: 0x00407404
		public void AddOngoingVengeance(DataContext context, int avengerId, int targetCharId)
		{
			CharacterSet avengers;
			bool flag = this._ongoingVengeances.TryGetValue(targetCharId, out avengers);
			if (flag)
			{
				avengers.Add(avengerId);
				this.SetElement_OngoingVengeances(targetCharId, avengers, context);
			}
			else
			{
				avengers = default(CharacterSet);
				avengers.Add(avengerId);
				this.AddElement_OngoingVengeances(targetCharId, avengers, context);
			}
		}

		// Token: 0x060070C9 RID: 28873 RVA: 0x00409258 File Offset: 0x00407458
		public bool IsTargetForVengeance(int targetCharId)
		{
			return this._ongoingVengeances.ContainsKey(targetCharId);
		}

		// Token: 0x060070CA RID: 28874 RVA: 0x00409278 File Offset: 0x00407478
		public void FinishOngoingVengeance(DataContext context, int avengerId, int targetCharId)
		{
			CharacterSet avengers;
			bool flag = this._ongoingVengeances.TryGetValue(targetCharId, out avengers);
			if (flag)
			{
				avengers.Remove(avengerId);
				bool flag2 = avengers.GetCount() <= 0;
				if (flag2)
				{
					this.RemoveElement_OngoingVengeances(targetCharId, context);
				}
				else
				{
					this.SetElement_OngoingVengeances(targetCharId, avengers, context);
				}
			}
		}

		// Token: 0x060070CB RID: 28875 RVA: 0x004092C9 File Offset: 0x004074C9
		[Obsolete]
		public void AddMournedOthers(DataContext context, int charId)
		{
			this._mournedOthersChars.Add(charId);
			this.SetMournedOthersChars(this._mournedOthersChars, context);
		}

		// Token: 0x060070CC RID: 28876 RVA: 0x004092E7 File Offset: 0x004074E7
		[Obsolete]
		public void ClearMournedOthersChars(DataContext context)
		{
			this._mournedOthersChars.Clear();
			this.SetMournedOthersChars(this._mournedOthersChars, context);
		}

		// Token: 0x060070CD RID: 28877 RVA: 0x00409304 File Offset: 0x00407504
		[DomainMethod]
		public List<short> GetTitles(int charId)
		{
			Character character;
			bool flag = this._objects.TryGetValue(charId, out character);
			List<short> result;
			if (flag)
			{
				List<short> titles = new List<short>();
				character.GetTitles(titles);
				result = titles;
			}
			else
			{
				DeadCharacter deadChar;
				bool flag2 = this._deadCharacters.TryGetValue(charId, out deadChar);
				if (flag2)
				{
					result = deadChar.TitleIds;
				}
				else
				{
					result = new List<short>();
				}
			}
			return result;
		}

		// Token: 0x060070CE RID: 28878 RVA: 0x00409364 File Offset: 0x00407564
		[DomainMethod]
		public sbyte GetFameType(int charId)
		{
			Character character;
			bool flag = this._objects.TryGetValue(charId, out character);
			sbyte result;
			if (flag)
			{
				result = character.GetFameType();
			}
			else
			{
				DeadCharacter deadCharacter;
				bool flag2 = this._deadCharacters.TryGetValue(charId, out deadCharacter);
				if (flag2)
				{
					result = deadCharacter.FameType;
				}
				else
				{
					result = 3;
				}
			}
			return result;
		}

		// Token: 0x060070CF RID: 28879 RVA: 0x004093B0 File Offset: 0x004075B0
		[DomainMethod]
		public bool IsReclusive(int charId)
		{
			Character character;
			bool flag = !this._objects.TryGetValue(charId, out character);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = !this.IsTemporaryIntelligentCharacter(charId);
				if (flag2)
				{
					result = false;
				}
				else
				{
					bool flag3 = character.GetSrcCharId() >= 0;
					if (flag3)
					{
						result = false;
					}
					else
					{
						OrganizationInfo orgInfo = character.GetOrganizationInfo();
						OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(orgInfo);
						result = orgMemberCfg.RestrictPrincipalAmount;
					}
				}
			}
			return result;
		}

		// Token: 0x060070D0 RID: 28880 RVA: 0x00409420 File Offset: 0x00407620
		[DomainMethod]
		public sbyte GetHighestGradeCombatSkillById(int charId)
		{
			CharacterDisplayData characterDisplayData = this.GetCharacterDisplayData(charId);
			bool flag = characterDisplayData.OrgInfo.SettlementId < 0;
			sbyte result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				Settlement settlement = DomainManager.Organization.GetSettlement(characterDisplayData.OrgInfo.SettlementId);
				short approvingRate = settlement.CalcApprovingRate();
				result = OrganizationDomain.GetHighestGradeOfTeachableCombatSkill(approvingRate);
			}
			return result;
		}

		// Token: 0x060070D1 RID: 28881 RVA: 0x00409478 File Offset: 0x00407678
		[DomainMethod]
		public short GetLeftMaxHealth(int charId)
		{
			Character character;
			bool flag = !this._objects.TryGetValue(charId, out character);
			short result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				result = character.GetLeftMaxHealth(false);
			}
			return result;
		}

		// Token: 0x060070D2 RID: 28882 RVA: 0x004094AC File Offset: 0x004076AC
		[DomainMethod]
		public sbyte GetHealthType(int charId)
		{
			Character character;
			bool flag = !this._objects.TryGetValue(charId, out character);
			sbyte result;
			if (flag)
			{
				result = 5;
			}
			else
			{
				result = (sbyte)character.GetHealthType();
			}
			return result;
		}

		// Token: 0x060070D3 RID: 28883 RVA: 0x004094E0 File Offset: 0x004076E0
		[DomainMethod]
		public short GetHealthRecovery(int charId)
		{
			Character character;
			return this.TryGetElement_Objects(charId, out character) ? character.GetHealthRecovery(character.IsCompletelyInfected()) : 0;
		}

		// Token: 0x060070D4 RID: 28884 RVA: 0x0040950C File Offset: 0x0040770C
		[DomainMethod]
		public short GetDisplayingAge(int charId)
		{
			Character character;
			bool flag = this.TryGetElement_Objects(charId, out character);
			short result;
			if (flag)
			{
				result = character.GetCurrAge();
			}
			else
			{
				PredefinedLog.Show(34, charId);
				result = -1;
			}
			return result;
		}

		// Token: 0x060070D5 RID: 28885 RVA: 0x00409544 File Offset: 0x00407744
		[DomainMethod]
		public short GetPhysiologicalAge(int charId)
		{
			Character character;
			bool flag = this.TryGetElement_Objects(charId, out character);
			short result;
			if (flag)
			{
				result = character.GetPhysiologicalAge();
			}
			else
			{
				PredefinedLog.Show(34, charId);
				result = -1;
			}
			return result;
		}

		// Token: 0x060070D6 RID: 28886 RVA: 0x0040957C File Offset: 0x0040777C
		[DomainMethod]
		public byte GetPhysiologicalAgeAffector(int charId)
		{
			Character character;
			bool flag = this.TryGetElement_Objects(charId, out character);
			byte result;
			if (flag)
			{
				AgeAffector ret = AgeAffector.None;
				bool flag2 = character.GetCurrAge() != character.GetPhysiologicalAge();
				if (flag2)
				{
					ret |= ((character.GetGender() == 0) ? AgeAffector.FemaleKeepYoung : AgeAffector.MaleKeepYoung);
				}
				bool flag3 = character.IsTaiwu();
				if (flag3)
				{
					bool flag4 = DomainManager.Extra.IsProfessionalSkillUnlockedAndEquipped(48);
					if (flag4)
					{
						ret |= AgeAffector.TaoismActive;
					}
					else
					{
						bool flag5 = ProfessionSkillHandle.TaoistMonkSkill_HasSurvivedAllTribulation();
						if (flag5)
						{
							ret |= AgeAffector.TaoismPassive;
						}
					}
				}
				result = (byte)ret;
			}
			else
			{
				PredefinedLog.Show(34, charId);
				result = 0;
			}
			return result;
		}

		// Token: 0x060070D7 RID: 28887 RVA: 0x00409614 File Offset: 0x00407814
		public static short GetCharacterTemplateIdInGroup(short groupId, sbyte consummateLevel)
		{
			Tester.Assert(groupId >= 0, "");
			CharacterItem groupBeginTemplate = Character.Instance[groupId];
			CharacterItem groupSecondTemplate = Character.Instance[(int)(groupId + 1)];
			bool flag = groupSecondTemplate.GroupId != groupId;
			short result;
			if (flag)
			{
				result = groupId;
			}
			else
			{
				bool consummateLevelIncrease = groupSecondTemplate.ConsummateLevel > groupBeginTemplate.ConsummateLevel;
				bool flag2 = consummateLevelIncrease;
				if (flag2)
				{
					CharacterItem currTemplate = groupBeginTemplate;
					CharacterItem prevTemplate = currTemplate;
					while (currTemplate != null && currTemplate.GroupId == groupId)
					{
						bool flag3 = currTemplate.ConsummateLevel >= consummateLevel;
						if (flag3)
						{
							return currTemplate.TemplateId;
						}
						prevTemplate = currTemplate;
						currTemplate = Character.Instance[(int)(prevTemplate.TemplateId + 1)];
					}
					result = prevTemplate.TemplateId;
				}
				else
				{
					CharacterItem currTemplate2 = groupBeginTemplate;
					CharacterItem prevTemplate2 = currTemplate2;
					while (currTemplate2 != null && currTemplate2.GroupId == groupId)
					{
						bool flag4 = currTemplate2.ConsummateLevel < consummateLevel;
						if (flag4)
						{
							return prevTemplate2.TemplateId;
						}
						prevTemplate2 = currTemplate2;
						currTemplate2 = Character.Instance[(int)(prevTemplate2.TemplateId + 1)];
					}
					result = prevTemplate2.TemplateId;
				}
			}
			return result;
		}

		// Token: 0x060070D8 RID: 28888 RVA: 0x00409748 File Offset: 0x00407948
		public static int GetLivedMonths(short age, sbyte birthMonth)
		{
			int monthsAfterBirthday = (int)(DomainManager.World.GetCurrMonthInYear() - birthMonth);
			bool flag = monthsAfterBirthday < 0;
			if (flag)
			{
				monthsAfterBirthday += 12;
			}
			return (int)(age * 12) + monthsAfterBirthday;
		}

		// Token: 0x060070D9 RID: 28889 RVA: 0x0040977C File Offset: 0x0040797C
		public static int CalcEscapeSuccessRate(sbyte consummateLevelA, sbyte consummateLevelB)
		{
			return Math.Clamp((int)((consummateLevelA - consummateLevelB + 2) * 25), 0, 100);
		}

		// Token: 0x060070DA RID: 28890 RVA: 0x004097A0 File Offset: 0x004079A0
		public static int CalcBirthDate(short age, sbyte birthMonth)
		{
			bool flag = age >= 0;
			int result;
			if (flag)
			{
				result = DomainManager.World.GetCurrDate() - CharacterDomain.GetLivedMonths(age, birthMonth);
			}
			else
			{
				result = -393216 + (int)birthMonth;
			}
			return result;
		}

		// Token: 0x060070DB RID: 28891 RVA: 0x004097DC File Offset: 0x004079DC
		[return: TupleElementNames(new string[]
		{
			"year",
			"month"
		})]
		public static ValueTuple<short, sbyte> CalcBirthYearAndMonth(int birthDate)
		{
			int birthYear = (birthDate >= 0) ? (birthDate / 12) : ((birthDate - 11) / 12);
			int birthMonth = birthDate - birthYear * 12;
			return new ValueTuple<short, sbyte>((short)birthYear, (sbyte)birthMonth);
		}

		// Token: 0x060070DC RID: 28892 RVA: 0x00409810 File Offset: 0x00407A10
		public static short CalcAge(int birthDate)
		{
			int currDate = DomainManager.World.GetCurrDate();
			int age = (currDate - birthDate) / 12;
			return (age >= 32767) ? -1 : ((short)age);
		}

		// Token: 0x060070DD RID: 28893 RVA: 0x00409844 File Offset: 0x00407A44
		public void FindIntelligentCharacters(Predicate<Character> predicate, List<Character> results)
		{
			foreach (KeyValuePair<int, Character> entry in this._objects)
			{
				Character character = entry.Value;
				bool flag = character.GetCreatingType() != 1;
				if (!flag)
				{
					bool flag2 = DomainManager.Extra.IsPrevLegendaryBookOwnerCopy(entry.Key);
					if (!flag2)
					{
						bool flag3 = predicate(character);
						if (flag3)
						{
							results.Add(character);
						}
					}
				}
			}
		}

		// Token: 0x060070DE RID: 28894 RVA: 0x004098E0 File Offset: 0x00407AE0
		public void FindGrave(Predicate<Grave> predicate, List<Grave> results)
		{
			foreach (KeyValuePair<int, Grave> entry in this._graves)
			{
				Grave grave = entry.Value;
				bool flag = predicate(grave);
				if (flag)
				{
					results.Add(grave);
				}
			}
		}

		// Token: 0x060070DF RID: 28895 RVA: 0x0040994C File Offset: 0x00407B4C
		public void FindIntelligentCharacters(List<Predicate<Character>> predicates, List<Character> results)
		{
			foreach (KeyValuePair<int, Character> entry in this._objects)
			{
				Character character = entry.Value;
				short templateId = character.GetTemplateId();
				bool flag = Character.Instance[templateId].CreatingType != 1;
				if (!flag)
				{
					bool flag2 = DomainManager.Extra.IsPrevLegendaryBookOwnerCopy(entry.Key);
					if (!flag2)
					{
						bool flag3 = CharacterMatchers.MatchAll(character, predicates);
						if (flag3)
						{
							results.Add(character);
						}
					}
				}
			}
		}

		// Token: 0x060070E0 RID: 28896 RVA: 0x004099F8 File Offset: 0x00407BF8
		[DomainMethod]
		public MainAttributes GetMainAttributesRecoveries(int charId)
		{
			Character character;
			bool flag = this.TryGetElement_Objects(charId, out character);
			MainAttributes result;
			if (flag)
			{
				result = character.GetMainAttributesRecoveries();
			}
			else
			{
				result = default(MainAttributes);
			}
			return result;
		}

		// Token: 0x060070E1 RID: 28897 RVA: 0x00409A2C File Offset: 0x00407C2C
		[DomainMethod]
		public sbyte GetInscriptionStatus(int charId)
		{
			sbyte res = 0;
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			bool flag = charId == taiwuCharId;
			sbyte result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				Character character = this._objects[charId];
				bool flag2 = DomainManager.World.GetMainStoryLineProgress() < 8;
				if (flag2)
				{
					result = -3;
				}
				else
				{
					bool flag3 = character.GetTemplateId() == 836;
					if (flag3)
					{
						result = -1;
					}
					else
					{
						bool flag4 = DomainManager.Global.IsCharacterInscribed(new InscribedCharacterKey(DomainManager.World.GetWorldId(), charId));
						if (flag4)
						{
							res |= 2;
						}
						bool flag5 = DomainManager.Extra.SectXuannvIsCharacterMirrorImage(charId);
						if (flag5)
						{
							res |= 4;
						}
						int leaderId = character.GetLeaderId();
						IReadOnlySet<int> specialGroup = DomainManager.Extra.GetSpecialGroup(leaderId);
						bool isSpecialGroupMember = specialGroup != null && specialGroup.Contains(charId);
						bool flag6 = !DomainManager.Taiwu.IsInGroup(charId) && !isSpecialGroupMember;
						if (flag6)
						{
							res |= 8;
						}
						bool flag7 = character.GetAgeGroup() != 2;
						if (flag7)
						{
							res |= 16;
						}
						short favorability = this.GetFavorability(charId, taiwuCharId);
						bool flag8 = favorability == short.MinValue;
						if (flag8)
						{
							res |= 32;
						}
						bool flag9 = character.GetCreatingType() != 1;
						if (flag9)
						{
							bool flag10 = isSpecialGroupMember;
							if (!flag10)
							{
								return -2;
							}
							res |= 64;
						}
						sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
						bool flag11 = favorabilityType < 6;
						if (flag11)
						{
							res |= 32;
						}
						result = res;
					}
				}
			}
			return result;
		}

		// Token: 0x060070E2 RID: 28898 RVA: 0x00409BA0 File Offset: 0x00407DA0
		[DomainMethod]
		public int[] GetCharacterBirthDate(int charId)
		{
			int[] retArray = new int[]
			{
				charId,
				int.MinValue
			};
			Character character;
			bool flag = this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				retArray[1] = character.GetBirthDate();
			}
			DeadCharacter deadCharacter = this.TryGetDeadCharacter(charId);
			bool flag2 = deadCharacter != null;
			if (flag2)
			{
				retArray[1] = deadCharacter.BirthDate;
			}
			bool flag3 = retArray[1] <= int.MinValue;
			if (flag3)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(61, 1);
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				defaultInterpolatedStringHandler.AppendLiteral(" get birthDate failed exception: character has not exist ever");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			return retArray;
		}

		// Token: 0x060070E3 RID: 28899 RVA: 0x00409C3C File Offset: 0x00407E3C
		public static void UnionWithInteractableCharacters(HashSet<int> result, HashSet<int> charIds)
		{
			foreach (int charId in charIds)
			{
				Character character = DomainManager.Character.GetElement_Objects(charId);
				bool flag = character.IsActiveExternalRelationState(60);
				if (!flag)
				{
					bool flag2 = character.GetLegendaryBookOwnerState() > 1;
					if (!flag2)
					{
						result.Add(charId);
					}
				}
			}
		}

		// Token: 0x060070E4 RID: 28900 RVA: 0x00409CBC File Offset: 0x00407EBC
		public void ResetAllAdvanceMonthStatus()
		{
			foreach (Character character in this._objects.Values)
			{
				character.ResetAdvanceMonthStatus();
			}
		}

		// Token: 0x060070E5 RID: 28901 RVA: 0x00409D18 File Offset: 0x00407F18
		[DomainMethod]
		public void GmCmd_SetCharBaseNeiliProportionOfFiveElements(DataContext context, int charId, NeiliProportionOfFiveElements fiveElements)
		{
			Character character;
			bool flag = !this._objects.TryGetValue(charId, out character);
			if (!flag)
			{
				bool flag2 = fiveElements.SumCheck() != 100;
				if (!flag2)
				{
					character.SetBaseNeiliProportionOfFiveElements(fiveElements, context);
					CombatCharacter combatChar;
					bool flag3 = DomainManager.Combat.TryGetElement_CombatCharacterDict(charId, out combatChar);
					if (flag3)
					{
						combatChar.SetNeiliType(character.GetNeiliType(), context);
					}
				}
			}
		}

		// Token: 0x060070E6 RID: 28902 RVA: 0x00409D7C File Offset: 0x00407F7C
		[DomainMethod]
		public void GmCmd_ChangeCharDisorderOfQi(DataContext context, int charId, int delta)
		{
			Character character;
			bool flag = !this._objects.TryGetValue(charId, out character);
			if (!flag)
			{
				int realDelta = character.CalcDisorderOfQiDelta(delta);
				short curValue = character.GetDisorderOfQi();
				short value = (short)Math.Clamp((int)curValue + realDelta, (int)DisorderLevelOfQi.MinValue, (int)DisorderLevelOfQi.MaxValue);
				character.SetDisorderOfQi(value, context);
			}
		}

		// Token: 0x060070E7 RID: 28903 RVA: 0x00409DD0 File Offset: 0x00407FD0
		public void ParallelCreateNewbornChildren(DataContext context, Character mother, bool isDystocia, bool isMotherDead)
		{
			IRandomSource random = context.Random;
			CreateNewBornChildrenModification mod = new CreateNewBornChildrenModification();
			mod.IsDystocia = isDystocia;
			mod.IsMotherDead = isMotherDead;
			int motherId = mother.GetId();
			PregnantState pregnantState = this.GetElement_PregnantStates(motherId);
			int fatherId = pregnantState.FatherId;
			Character father = null;
			DeadCharacter deadFather = null;
			bool flag = fatherId >= 0;
			Genome virtualFatherGenome;
			if (flag)
			{
				bool flag2 = !this.TryGetElement_Objects(fatherId, out father);
				if (flag2)
				{
					this.TryGetElement_DeadCharacters(fatherId, out deadFather);
				}
			}
			else
			{
				Genome.CreateRandom(random, ref virtualFatherGenome);
			}
			Location motherLocation = mother.GetLocation();
			bool flag3 = !motherLocation.IsValid();
			if (flag3)
			{
				motherLocation = mother.GetValidLocation();
			}
			sbyte stateId = DomainManager.Map.GetStateIdByAreaId(motherLocation.AreaId);
			pregnantState.CreateMotherRelation = (pregnantState.CreateMotherRelation && mother.OrgAndMonkTypeAllowMarriage());
			bool createNominalMotherRelation = pregnantState.CreateMotherRelation;
			bool flag4 = pregnantState.CreateFatherRelation && fatherId >= 0;
			bool createNominalFatherRelation;
			if (flag4)
			{
				bool orgAndMonkTypeAllowMarriage = (father != null) ? father.OrgAndMonkTypeAllowMarriage() : deadFather.OrgAndMonkTypeAllowMarriage();
				int spouseId = DomainManager.Character.GetAliveSpouse(fatherId);
				int motherSpouseId = DomainManager.Character.GetAliveSpouse(motherId);
				bool hasHusbandOrWifeRelation = DomainManager.Character.HasRelation(fatherId, motherId, 1024);
				pregnantState.CreateFatherRelation = (pregnantState.CreateFatherRelation && (spouseId < 0 || hasHusbandOrWifeRelation) && (motherSpouseId < 0 || hasHusbandOrWifeRelation) && orgAndMonkTypeAllowMarriage);
				createNominalFatherRelation = pregnantState.CreateFatherRelation;
			}
			else
			{
				pregnantState.CreateFatherRelation = false;
				createNominalFatherRelation = false;
			}
			Character nominalFather = father;
			DeadCharacter nominalDeadFather = deadFather;
			int nominalFatherId = fatherId;
			bool flag5 = !createNominalFatherRelation && createNominalMotherRelation;
			if (flag5)
			{
				int motherSpouseId2 = this.GetAliveSpouse(motherId);
				bool flag6 = motherSpouseId2 >= 0 && motherSpouseId2 != fatherId;
				if (flag6)
				{
					Character motherSpouse;
					bool flag7 = this.TryGetElement_Objects(motherSpouseId2, out motherSpouse);
					if (flag7)
					{
						bool flag8 = motherSpouse.OrgAndMonkTypeAllowMarriage();
						if (flag8)
						{
							createNominalFatherRelation = true;
							nominalFatherId = motherSpouseId2;
							nominalFather = motherSpouse;
						}
					}
					else
					{
						DeadCharacter deadMotherSpouse;
						bool flag9 = this.TryGetElement_DeadCharacters(motherSpouseId2, out deadMotherSpouse);
						if (flag9)
						{
							bool flag10 = deadMotherSpouse.OrgAndMonkTypeAllowMarriage();
							if (flag10)
							{
								createNominalFatherRelation = true;
								nominalFatherId = motherSpouseId2;
								nominalDeadFather = deadMotherSpouse;
							}
						}
					}
				}
			}
			ValueTuple<OrganizationInfo, short, bool> mainParentInfo = CharacterDomain.GetMainParentInfo(mother, nominalFather, createNominalMotherRelation, createNominalFatherRelation, isMotherDead);
			OrganizationInfo parentOrgInfo = mainParentInfo.Item1;
			short baseTemplateId = mainParentInfo.Item2;
			bool isAbandoned = mainParentInfo.Item3;
			bool flag11 = baseTemplateId < 0;
			if (flag11)
			{
				baseTemplateId = ((stateId >= 0) ? MapState.Instance[(int)(stateId + 1)].TemplateCharacterIds[0] : MapState.Instance[DomainManager.World.GetTaiwuVillageStateTemplateId()].TemplateCharacterIds[0]);
			}
			bool flag12 = isAbandoned;
			if (flag12)
			{
				pregnantState.CreateMotherRelation = false;
				pregnantState.CreateFatherRelation = false;
			}
			sbyte mainChildGender = Gender.GetRandom(random);
			ValueTuple<short, AvatarData> valueTuple = CharacterDomain.GenerateMainChildAvatar(random, mother, father, deadFather, mainChildGender);
			short baseAttraction = valueTuple.Item1;
			AvatarData avatar = valueTuple.Item2;
			OrganizationItem orgConfig = Organization.Instance[parentOrgInfo.OrgTemplateId];
			short parentMemberId = orgConfig.Members[(int)parentOrgInfo.Grade];
			OrganizationMemberItem parentMemberConfig = OrganizationMember.Instance[parentMemberId];
			bool flag13 = parentMemberConfig.ChildGrade >= 0;
			OrganizationMemberItem orgMemberConfig;
			if (flag13)
			{
				short orgMemberId = orgConfig.Members[(int)parentMemberConfig.ChildGrade];
				orgMemberConfig = OrganizationMember.Instance[orgMemberId];
			}
			else
			{
				orgMemberConfig = OrganizationMember.Instance[0];
				orgConfig = Organization.Instance[0];
				bool flag14 = !isAbandoned;
				if (flag14)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(77, 4);
					defaultInterpolatedStringHandler.AppendLiteral("Main parent ");
					defaultInterpolatedStringHandler.AppendFormatted(orgConfig.Name);
					defaultInterpolatedStringHandler.AppendFormatted(parentMemberConfig.GradeName);
					defaultInterpolatedStringHandler.AppendLiteral(" cannot have child but child is not abandoned (mother:");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(mother);
					defaultInterpolatedStringHandler.AppendLiteral(", father:");
					defaultInterpolatedStringHandler.AppendFormatted((father == null) ? deadFather : father, 0, null);
					defaultInterpolatedStringHandler.AppendLiteral(").");
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
			mod.AdoptedByKidnapper = false;
			int kidnapperId = mother.GetKidnapperId();
			bool flag15 = kidnapperId >= 0 && kidnapperId != DomainManager.Taiwu.GetTaiwuCharId();
			if (flag15)
			{
				Character kidnapper = DomainManager.Character.GetElement_Objects(mother.GetKidnapperId());
				OrganizationMemberItem kidnapperOrgMemberCfg = OrganizationDomain.GetOrgMemberConfig(kidnapper.GetOrganizationInfo());
				sbyte behaviorType = kidnapper.GetBehaviorType();
				sbyte b = behaviorType;
				if (b > 1)
				{
					if (b == 2)
					{
						bool flag16 = isAbandoned && random.CheckPercentProb(50) && kidnapper.GetMonkType() == 0 && kidnapperOrgMemberCfg.ChildGrade >= 0;
						if (flag16)
						{
							mod.AdoptedByKidnapper = true;
						}
						mod.IsBabyFree = true;
					}
				}
				else
				{
					bool flag17 = isAbandoned && random.CheckPercentProb(50) && kidnapper.GetMonkType() == 0 && kidnapperOrgMemberCfg.ChildGrade >= 0;
					if (flag17)
					{
						mod.AdoptedByKidnapper = true;
					}
					mod.IsMotherFree = true;
					mod.IsBabyFree = true;
				}
			}
			int multipleBirthCount = 1;
			IntPair samsaraInfo = this.GetDirectedSamsaraInfo(motherId);
			bool flag18 = samsaraInfo.First < 0;
			if (flag18)
			{
				int randomValue = random.Next(100);
				multipleBirthCount = ((randomValue < 3) ? 3 : ((randomValue < 8) ? 2 : 1));
			}
			mod.ChildrenMods = new CreateIntelligentCharacterModification[multipleBirthCount];
			RelatedCharacter parentRelation;
			mod.IsInsect = (fatherId >= 0 && random.CheckPercentProb(GlobalConfig.Instance.CongenitalMalformationProbability) && this.TryGetRelation(motherId, fatherId, out parentRelation) && this.IsInsect(motherId, fatherId));
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			sbyte birthMonth = DomainManager.World.GetCurrMonthInYear();
			for (int i = 0; i < mod.ChildrenMods.Length; i++)
			{
				sbyte gender = (i > 0 && random.CheckPercentProb(25)) ? Gender.Flip(mainChildGender) : mainChildGender;
				Location location = motherLocation;
				sbyte grade = (orgMemberConfig.Gender >= 0 && orgMemberConfig.Gender != gender) ? 0 : orgMemberConfig.Grade;
				short settlementId = (parentOrgInfo.OrgTemplateId == orgConfig.TemplateId) ? parentOrgInfo.SettlementId : -1;
				OrganizationInfo orgInfo = new OrganizationInfo(orgConfig.TemplateId, grade, true, settlementId);
				short charTemplateId = CharacterDomain.GenerateTemplateId(baseTemplateId, gender);
				AvatarData currAvatar = (avatar != null) ? avatar.GenerateMultipleBirthChildAvatar(random, gender) : null;
				sbyte growingGrade = 8;
				bool flag19 = samsaraInfo.First < 0;
				if (flag19)
				{
					growingGrade = DomainManager.Taiwu.OfflinePopStateNewCharacterLegacyGrowingGrade(stateId);
					bool flag20 = growingGrade >= 0;
					if (flag20)
					{
						mod.LegacyGrowingGradeState = stateId;
					}
				}
				IntelligentCharacterCreationInfo info = new IntelligentCharacterCreationInfo(location, orgInfo, charTemplateId)
				{
					GrowingSectGrade = growingGrade,
					MotherCharId = motherId,
					Mother = mother,
					PregnantState = pregnantState,
					FatherCharId = nominalFatherId,
					Father = nominalFather,
					DeadFather = nominalDeadFather,
					ActualFatherCharId = fatherId,
					ActualFather = father,
					ActualDeadFather = deadFather,
					MultipleBirthCount = (sbyte)multipleBirthCount,
					Age = 0,
					BirthMonth = birthMonth,
					BaseAttraction = baseAttraction,
					Avatar = currAvatar,
					ReincarnationCharId = samsaraInfo.First,
					DestinyType = samsaraInfo.Second,
					AllowRandomGrowingGradeAdjust = (fatherId != taiwuCharId && motherId != taiwuCharId)
				};
				bool flag21 = fatherId < 0;
				if (flag21)
				{
					info.SpecifyGenome = true;
					Genome.Inherit(random, mother.GetGenome(), ref virtualFatherGenome, ref info.Genome);
				}
				mod.ChildrenMods[i] = CharacterDomain.ParallelCreateIntelligentCharacter(context, ref info, false);
			}
			ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
			recorder.RecordType(ParallelModificationType.CreateNewbornChildren);
			recorder.RecordParameterClass<CreateNewBornChildrenModification>(mod);
		}

		// Token: 0x060070E8 RID: 28904 RVA: 0x0040A534 File Offset: 0x00408734
		public IntPair GetDirectedSamsaraInfo(int motherId)
		{
			BuddhistMonkSkillsData buddhistSkillsData = DomainManager.Extra.GetProfessionData(6).GetSkillsData<BuddhistMonkSkillsData>();
			int directedSamsaraCharId = buddhistSkillsData.GetDirectedSamsara(motherId);
			bool flag = directedSamsaraCharId >= 0;
			IntPair result;
			if (flag)
			{
				result = new IntPair(directedSamsaraCharId, -1);
			}
			else
			{
				IntPair samsaraInfo;
				bool flag2 = DomainManager.Building.TryGetElement_SamsaraPlatformBornDict(motherId, out samsaraInfo);
				if (flag2)
				{
					result = samsaraInfo;
				}
				else
				{
					result = new IntPair(-1, -1);
				}
			}
			return result;
		}

		// Token: 0x060070E9 RID: 28905 RVA: 0x0040A598 File Offset: 0x00408798
		private Character PartialComplementCreateNewbornChild(DataContext context, CreateIntelligentCharacterModification mod)
		{
			int charId = this.GenerateNextObjectId(context);
			Character character = mod.Self;
			character.OfflineSetId(charId);
			mod.ReincarnationCharId = this.PickReincarnationChar(context, character.GetBirthDate(), mod.ReincarnationCharId, false);
			bool flag = mod.ReincarnationCharId >= 0;
			if (flag)
			{
				character.OfflineSetPreexistenceCharId(context, mod.ReincarnationCharId);
			}
			this.ModifySavedSoulCharacter(context, mod, character);
			this.AddElement_Objects(charId, character);
			this.StartCreatingCharacter(charId);
			bool flag2 = character.GetAgeGroup() == 0;
			if (flag2)
			{
				this.AddInfant(charId);
			}
			DomainManager.CombatSkill.RegisterCombatSkills(charId, mod.CombatSkills);
			this.AutoActivateReadCombatSkillNormalPages(context, mod.CombatSkills, charId);
			character.AddEquipmentAndInventoryItems(context, mod.Equipment, mod.Inventory);
			character.AddSkillBooksAndWeapons(context, mod.InventorySkillBooks, mod.SkillWeaponIds);
			character.UpdateHobbyExpirationDate(context);
			DomainManager.Information.RegisterInformation(charId, context);
			bool flag3 = mod.ReincarnationCharId >= 0;
			if (flag3)
			{
				Events.RaiseCharacterReincarnated(context, character, mod.ReincarnationCharId);
			}
			Events.RaiseCharacterCreated(context, character);
			this.CompleteCreatingCharacter(charId);
			return character;
		}

		// Token: 0x060070EA RID: 28906 RVA: 0x0040A6BC File Offset: 0x004088BC
		public void ComplementCreateNewbornChildren(DataContext context, CreateNewBornChildrenModification mod)
		{
			CreateIntelligentCharacterModification[] childrenMods = mod.ChildrenMods;
			bool isDystocia = mod.IsDystocia;
			bool isMotherDead = mod.IsMotherDead;
			bool isMotherFree = mod.IsMotherFree;
			int currDate = DomainManager.World.GetCurrDate();
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int motherCharId = childrenMods[0].MotherCharId;
			int fatherCharId = childrenMods[0].FatherCharId;
			Character mother = DomainManager.Character.GetElement_Objects(motherCharId);
			Location motherLocation = mother.GetLocation();
			bool flag = !motherLocation.IsValid();
			if (flag)
			{
				motherLocation = mother.GetValidLocation();
			}
			bool showMonthlyInfo = DomainManager.Taiwu.IsInGroup(motherCharId) || fatherCharId == taiwuCharId;
			Character father;
			bool isFatherAlive = this.TryGetElement_Objects(fatherCharId, out father);
			bool motherAvailable = childrenMods[0].CreateMotherRelation && !isMotherDead && (isMotherFree || mother.GetKidnapperId() < 0) && !mother.IsCompletelyInfected() && !mother.IsActiveExternalRelationState(32);
			bool fatherAvailable = childrenMods[0].CreateFatherRelation && isFatherAlive && father.GetKidnapperId() < 0 && !father.IsCompletelyInfected() && !father.IsActiveExternalRelationState(32);
			bool abandonChildren = !motherAvailable && !fatherAvailable;
			PregnantState pregnantState = this.GetElement_PregnantStates(motherCharId);
			int actualFatherId = (pregnantState.FatherId == fatherCharId) ? -1 : pregnantState.FatherId;
			int kidnapperId = mother.GetKidnapperId();
			bool flag2 = kidnapperId >= 0 && isMotherFree;
			if (flag2)
			{
				lifeRecordCollection.AddReleaseKidnappedCharacter(kidnapperId, currDate, motherCharId, motherLocation);
				this.RemoveKidnappedCharacter(context, motherCharId, kidnapperId, false);
			}
			bool flag3 = mod.LegacyGrowingGradeState >= 0;
			if (flag3)
			{
				SByteList intList = DomainManager.Taiwu.GetElement_StateNewCharacterLegacyGrowingGrades((int)mod.LegacyGrowingGradeState);
				DomainManager.Taiwu.SetElement_StateNewCharacterLegacyGrowingGrades((int)mod.LegacyGrowingGradeState, intList, context);
			}
			CreateIntelligentCharacterModification[] array = childrenMods;
			for (int i = 0; i < array.Length; i++)
			{
				CreateIntelligentCharacterModification childrenMod = array[i];
				bool flag4 = !isFatherAlive;
				if (flag4)
				{
					childrenMod.Father = null;
				}
				this.PartialComplementCreateNewbornChild(context, childrenMod);
				int childCharId = childrenMod.Self.GetId();
				sbyte childGender = childrenMod.Self.GetGender();
				bool isInsect = mod.IsInsect;
				if (isInsect)
				{
					childrenMod.Self.AddFeature(context, 339, false);
				}
				bool flag5 = childrenMod.Self.GetGender() == 1;
				if (flag5)
				{
					bool flag6 = showMonthlyInfo;
					if (flag6)
					{
						monthlyNotificationCollection.AddMotherGiveBirthToBoy(motherCharId, motherLocation);
					}
					lifeRecordCollection.AddGiveBirthToBoy(motherCharId, currDate, childCharId, motherLocation);
					bool flag7 = childrenMod.CreateFatherRelation && isFatherAlive;
					if (flag7)
					{
						lifeRecordCollection.AddBecomeFatherToNewBornBoy(fatherCharId, currDate, motherCharId, motherLocation, childrenMod.Self.GetId());
						GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(20, motherCharId);
						father.AddPersonalNeed(context, need);
					}
				}
				else
				{
					bool flag8 = showMonthlyInfo;
					if (flag8)
					{
						monthlyNotificationCollection.AddMotherGiveBirthToGirl(motherCharId, mother.GetLocation());
					}
					lifeRecordCollection.AddGiveBirthToGirl(motherCharId, currDate, childCharId, motherLocation);
					bool flag9 = childrenMod.CreateFatherRelation && isFatherAlive;
					if (flag9)
					{
						lifeRecordCollection.AddBecomeFatherToNewBornGirl(fatherCharId, currDate, motherCharId, motherLocation, childrenMod.Self.GetId());
						GameData.Domains.Character.Ai.PersonalNeed need2 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(20, motherCharId);
						father.AddPersonalNeed(context, need2);
					}
				}
				int secretInfoOffset = (fatherCharId >= 0) ? secretInformationCollection.AddGiveBirthToChild2(motherCharId, childCharId, fatherCharId) : secretInformationCollection.AddGiveBirthToChild(motherCharId, childCharId);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				bool flag10 = isDystocia;
				if (flag10)
				{
					bool flag11 = isMotherDead;
					if (flag11)
					{
						bool flag12 = motherCharId == taiwuCharId;
						if (flag12)
						{
							bool flag13 = childGender == 1;
							if (flag13)
							{
								monthlyEventCollection.AddDystociaButHaveChildBoyTaiwu(taiwuCharId, motherLocation, childCharId);
							}
							else
							{
								monthlyEventCollection.AddDystociaButHaveChildGirlTaiwu(taiwuCharId, motherLocation, childCharId);
							}
						}
						else
						{
							bool flag14 = fatherCharId == taiwuCharId && childrenMod.CreateFatherRelation;
							if (flag14)
							{
								bool flag15 = childGender == 1;
								if (flag15)
								{
									monthlyEventCollection.AddDystociaButHaveChildBoyWife(motherCharId, motherLocation, childCharId);
								}
								else
								{
									monthlyEventCollection.AddDystociaButHaveChildGirlWife(motherCharId, motherLocation, childCharId);
								}
							}
						}
					}
					else
					{
						bool flag16 = motherCharId == taiwuCharId;
						if (flag16)
						{
							bool flag17 = childGender == 1;
							if (flag17)
							{
								monthlyEventCollection.AddDystociaAndHaveChildBoyTaiwu(taiwuCharId, motherLocation, childCharId);
							}
							else
							{
								monthlyEventCollection.AddDystociaAndHaveChildGirlTaiwu(taiwuCharId, motherLocation, childCharId);
							}
						}
						else
						{
							bool flag18 = fatherCharId == taiwuCharId && childrenMod.CreateFatherRelation;
							if (flag18)
							{
								bool flag19 = childGender == 1;
								if (flag19)
								{
									monthlyEventCollection.AddDystociaAndHaveChildBoyWife(motherCharId, motherLocation, childCharId);
								}
								else
								{
									monthlyEventCollection.AddDystociaAndHaveChildGirlWife(motherCharId, motherLocation, childCharId);
								}
							}
						}
					}
				}
				else
				{
					bool flag20 = motherCharId == taiwuCharId;
					if (flag20)
					{
						bool flag21 = childGender == 1;
						if (flag21)
						{
							monthlyEventCollection.AddHaveChildBoyTaiwu(motherCharId, motherLocation, childCharId);
						}
						else
						{
							monthlyEventCollection.AddHaveChildGirlTaiwu(motherCharId, motherLocation, childCharId);
						}
					}
					else
					{
						bool flag22 = fatherCharId == taiwuCharId && childrenMod.CreateFatherRelation;
						if (flag22)
						{
							bool flag23 = childGender == 1;
							if (flag23)
							{
								monthlyEventCollection.AddHaveChildBoyWife(motherCharId, motherLocation, childCharId);
							}
							else
							{
								monthlyEventCollection.AddHaveChildGirlWife(motherCharId, motherLocation, childCharId);
							}
						}
					}
				}
				bool flag24 = kidnapperId == taiwuCharId;
				if (flag24)
				{
					Events.RegisterHandler_PassingLegacyWhileAdvancingMonth(delegate(DataContext threadContext)
					{
						bool motherAlive = this.IsCharacterAlive(motherCharId);
						bool fatherAlive = this.IsCharacterAlive(fatherCharId);
						bool flag29 = abandonChildren || (!motherAlive && !fatherAlive);
						if (flag29)
						{
							this.AbandonNewbornChild(threadContext, childrenMod.Self, null, motherCharId, (actualFatherId >= 0) ? actualFatherId : fatherCharId);
						}
						else
						{
							this.HandleNotAbandonedNewbornChildRelationsAndGroup(context, childrenMod.Self, motherCharId, fatherCharId, actualFatherId, childrenMod.CreateMotherRelation, childrenMod.CreateFatherRelation, motherAlive, fatherAlive);
						}
					});
				}
				else
				{
					bool isBabyFree = mod.IsBabyFree;
					if (isBabyFree)
					{
						lifeRecordCollection.AddReleaseKidnappedCharacter(kidnapperId, currDate, childCharId, motherLocation);
					}
					bool abandonChildren2 = abandonChildren;
					if (abandonChildren2)
					{
						Character adopter = null;
						bool adoptedByKidnapper = mod.AdoptedByKidnapper;
						if (adoptedByKidnapper)
						{
							this.TryGetElement_Objects(kidnapperId, out adopter);
						}
						this.AbandonNewbornChild(context, childrenMod.Self, adopter, motherCharId, fatherCharId);
					}
					else
					{
						this.HandleNotAbandonedNewbornChildRelationsAndGroup(context, childrenMod.Self, motherCharId, fatherCharId, actualFatherId, childrenMod.CreateMotherRelation, childrenMod.CreateFatherRelation, !isMotherDead, isFatherAlive);
					}
				}
			}
			bool flag25 = kidnapperId == taiwuCharId;
			if (flag25)
			{
				int childCharId2 = childrenMods[0].Self.GetId();
				int childCharId3 = (childrenMods.Length > 1) ? childrenMods[1].Self.GetId() : -1;
				int childCharId4 = (childrenMods.Length > 2) ? childrenMods[2].Self.GetId() : -1;
				monthlyEventCollection.AddCaptiveHaveChild(taiwuCharId, motherCharId, childCharId2, childCharId3, childCharId4, fatherCharId, actualFatherId);
				CharacterDomain.AddLockMovementCharSet(motherCharId);
			}
			bool flag26 = motherCharId == taiwuCharId;
			if (flag26)
			{
				foreach (CreateIntelligentCharacterModification childrenMod2 in childrenMods)
				{
					DomainManager.Taiwu.ApplyPrenatalEducationBonus(context, childrenMod2.Self);
				}
				DomainManager.Taiwu.ClearPrenatalEducationBonus(context);
			}
			bool flag27 = motherCharId == taiwuCharId || fatherCharId == taiwuCharId;
			if (flag27)
			{
				bool flag28 = this.HasRelation(motherCharId, fatherCharId, 1024);
				if (flag28)
				{
					DomainManager.Taiwu.AddLegacyPoint(context, 4, 100);
				}
			}
		}

		// Token: 0x060070EB RID: 28907 RVA: 0x0040AFFC File Offset: 0x004091FC
		public void HandleNotAbandonedNewbornChildRelationsAndGroup(DataContext context, Character baby, int motherCharId, int fatherCharId, int actualFatherId, bool createMotherRelation, bool createFatherRelation, bool isMotherAlive, bool isFatherAlive)
		{
			int childCharId = baby.GetId();
			Location childLocation = baby.GetLocation();
			this.SetBloodRelatedRelations(context, childCharId, motherCharId, fatherCharId, actualFatherId, createMotherRelation, createFatherRelation);
			DomainManager.Organization.JoinOrganization(context, baby, baby.GetOrganizationInfo());
			Character mother;
			bool flag = createMotherRelation && isMotherAlive && this._objects.TryGetValue(motherCharId, out mother) && mother.GetKidnapperId() < 0 && !mother.IsCompletelyInfected() && !mother.IsActiveExternalRelationState(32);
			if (flag)
			{
				Location targetLocation = mother.GetLocation();
				bool flag2 = !childLocation.Equals(targetLocation);
				if (flag2)
				{
					Events.RaiseCharacterLocationChanged(context, childCharId, childLocation, targetLocation);
					baby.SetLocation(targetLocation, context);
				}
				else
				{
					Events.RaiseCharacterLocationChanged(context, childCharId, Location.Invalid, targetLocation);
				}
				bool flag3 = DomainManager.Taiwu.IsInGroup(mother.GetId());
				if (flag3)
				{
					DomainManager.Taiwu.JoinGroup(context, childCharId, false);
				}
				else
				{
					this.JoinGroup(context, baby, mother);
				}
			}
			else
			{
				Character father;
				bool flag4 = createFatherRelation && isFatherAlive && this._objects.TryGetValue(fatherCharId, out father) && father.GetKidnapperId() < 0 && !father.IsCompletelyInfected() && !father.IsActiveExternalRelationState(32);
				if (flag4)
				{
					Location targetLocation2 = father.GetLocation();
					bool flag5 = !childLocation.Equals(targetLocation2);
					if (flag5)
					{
						Events.RaiseCharacterLocationChanged(context, childCharId, childLocation, targetLocation2);
						baby.SetLocation(targetLocation2, context);
					}
					else
					{
						Events.RaiseCharacterLocationChanged(context, childCharId, Location.Invalid, targetLocation2);
					}
					bool flag6 = DomainManager.Taiwu.IsInGroup(father.GetId());
					if (flag6)
					{
						DomainManager.Taiwu.JoinGroup(context, childCharId, false);
					}
					else
					{
						this.JoinGroup(context, baby, father);
					}
				}
				else
				{
					int aliveMentorId = this.GetAliveMentor(childCharId);
					bool flag7 = aliveMentorId < 0;
					if (flag7)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(70, 3);
						defaultInterpolatedStringHandler.AppendLiteral("newborn child ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(childCharId);
						defaultInterpolatedStringHandler.AppendLiteral("(child of ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(motherCharId);
						defaultInterpolatedStringHandler.AppendLiteral(" and ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(fatherCharId);
						defaultInterpolatedStringHandler.AppendLiteral(") is not abandoned but has nowhere to go.");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					Character aliveMentor = this._objects[aliveMentorId];
					Location targetLocation3 = aliveMentor.GetLocation();
					bool flag8 = !childLocation.Equals(targetLocation3);
					if (flag8)
					{
						Events.RaiseCharacterLocationChanged(context, childCharId, childLocation, targetLocation3);
						baby.SetLocation(targetLocation3, context);
					}
					else
					{
						Events.RaiseCharacterLocationChanged(context, childCharId, Location.Invalid, targetLocation3);
					}
					bool flag9 = DomainManager.Taiwu.IsInGroup(aliveMentorId);
					if (flag9)
					{
						DomainManager.Taiwu.JoinGroup(context, childCharId, true);
					}
					else
					{
						this.JoinGroup(context, baby, aliveMentor);
					}
				}
			}
		}

		// Token: 0x060070EC RID: 28908 RVA: 0x0040B2B0 File Offset: 0x004094B0
		public void AbandonNewbornChild(DataContext context, Character baby, Character assignedAdopter, int motherCharId, int fatherCharId)
		{
			int childCharId = baby.GetId();
			Character mother;
			bool flag = this._objects.TryGetValue(motherCharId, out mother);
			if (flag)
			{
				mother.ChangeHappiness(context, (int)AiHelper.UpdateStatusConstants.LostChildHappinessChange[(int)mother.GetBehaviorType()]);
				GameData.Domains.Character.Ai.PersonalNeed motherNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(19, childCharId);
				mother.AddPersonalNeed(context, motherNeed);
				GameData.Domains.Character.Ai.PersonalNeed childNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(25, 64);
				baby.AddPersonalNeed(context, childNeed);
			}
			this.SetBloodRelatedRelations(context, childCharId, motherCharId, fatherCharId, -1, false, false);
			bool flag2 = assignedAdopter != null;
			if (flag2)
			{
				bool flag3 = assignedAdopter.GetId() != DomainManager.Taiwu.GetTaiwuCharId() && assignedAdopter.GetOrganizationInfo().OrgTemplateId == 16;
				if (flag3)
				{
					this.AddPotentialAdopterToInfant(childCharId, assignedAdopter.GetId());
					DomainManager.World.GetMonthlyEventCollection().AddTaiwuVillagerAdoptOrphan(assignedAdopter.GetId(), childCharId, motherCharId);
				}
				else
				{
					this.AssignChildToAdopter(context, assignedAdopter, baby, motherCharId);
				}
			}
			else
			{
				int aliveMentorId = DomainManager.Character.GetAliveMentor(childCharId);
				bool flag4 = aliveMentorId >= 0;
				if (flag4)
				{
					Character mentor = DomainManager.Character.GetElement_Objects(aliveMentorId);
					DomainManager.Character.AssignChildToMentor(context, mentor, baby, motherCharId);
				}
				else
				{
					OrganizationInfo orgInfo = DomainManager.Character.GetAliveOrgDeadCharacterOrgInfo(motherCharId);
					int adopterId = DomainManager.Character.SelectRandomAdopter(context.Random, baby, orgInfo.OrgTemplateId);
					this.TryGetElement_Objects(adopterId, out assignedAdopter);
					bool flag5 = assignedAdopter == null;
					if (flag5)
					{
						this.AbandonToNearbySettlement(context, baby, motherCharId, false);
					}
					else
					{
						bool flag6 = assignedAdopter.GetOrganizationInfo().OrgTemplateId == 16;
						if (flag6)
						{
							this.AddPotentialAdopterToInfant(childCharId, assignedAdopter.GetId());
							DomainManager.World.GetMonthlyEventCollection().AddTaiwuVillagerAdoptOrphan(assignedAdopter.GetId(), childCharId, motherCharId);
						}
						else
						{
							this.AssignChildToAdopter(context, assignedAdopter, baby, motherCharId);
						}
					}
				}
			}
		}

		// Token: 0x060070ED RID: 28909 RVA: 0x0040B470 File Offset: 0x00409670
		internal void AbandonToNearbySettlement(DataContext context, Character baby, int motherCharId, bool nearTaiwuVillage = false)
		{
			sbyte stateId = DomainManager.Map.GetStateIdByAreaId((nearTaiwuVillage ? DomainManager.Taiwu.GetTaiwuVillageLocation() : baby.GetLocation()).AreaId);
			List<short> settlementIds = ObjectPool<List<short>>.Instance.Get();
			DomainManager.Map.GetStateSettlementIds(stateId, settlementIds, false, false);
			settlementIds.RemoveAll((short x) => x == DomainManager.Taiwu.GetTaiwuVillageSettlementId());
			short randomSettlementId = (settlementIds.Count == 0) ? -1 : settlementIds.GetRandom(context.Random);
			ObjectPool<List<short>>.Instance.Return(settlementIds);
			this.AbandonToNearbySettlement(context, baby, motherCharId, randomSettlementId);
		}

		// Token: 0x060070EE RID: 28910 RVA: 0x0040B514 File Offset: 0x00409714
		internal void AbandonToNearbySettlement(DataContext context, Character baby, int motherCharId, short settlementId)
		{
			this.AddInfant(baby.GetId());
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			Settlement settlement = DomainManager.Organization.GetSettlement(settlementId);
			OrganizationInfo destOrgInfo = new OrganizationInfo(settlement.GetOrgTemplateId(), 0, true, settlementId);
			baby.SetOrganizationInfo(destOrgInfo, context);
			Events.RaiseCharacterLocationChanged(context, baby.GetId(), baby.GetLocation(), settlement.GetLocation());
			baby.SetLocation(settlement.GetLocation(), context);
			DomainManager.Organization.JoinOrganization(context, baby, destOrgInfo);
			lifeRecordCollection.AddAbandonChild(motherCharId, currDate, baby.GetId(), settlementId);
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int secretInfoOffset = secretInformationCollection.AddAbandonChild(motherCharId, baby.GetId());
			DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
		}

		// Token: 0x060070EF RID: 28911 RVA: 0x0040B5E0 File Offset: 0x004097E0
		private int SelectRandomAdopter(IRandomSource random, Character abandonedChild, sbyte motherOrgTemplateId)
		{
			List<sbyte> orgTemplateIds = Organization.Instance[motherOrgTemplateId].AbandonedBabyOrganizations;
			sbyte orgTemplateId = (orgTemplateIds.Count > 0) ? orgTemplateIds[random.Next(orgTemplateIds.Count)] : (random.NextBool() ? 16 : OrganizationDomain.GetRandomSectOrgTemplateId(random, abandonedChild.GetGender()));
			Settlement settlement = DomainManager.Organization.GetSettlementByOrgTemplateId(orgTemplateId);
			int adopterId = this.GetRandomValidAdopterInSettlement(random, settlement);
			bool flag = adopterId < 0;
			if (flag)
			{
				settlement = DomainManager.Organization.GetSettlement(DomainManager.Taiwu.GetTaiwuVillageSettlementId());
				adopterId = this.GetRandomValidAdopterInSettlement(random, settlement);
			}
			return adopterId;
		}

		// Token: 0x060070F0 RID: 28912 RVA: 0x0040B67C File Offset: 0x0040987C
		internal void AssignChildToAdopter(DataContext context, Character adopter, Character adoptedChild, int motherCharId)
		{
			int currDate = DomainManager.World.GetCurrDate();
			int adopterId = adopter.GetId();
			OrganizationInfo adopterOrgInfo = adopter.GetOrganizationInfo();
			int childCharId = adoptedChild.GetId();
			bool flag = adopterOrgInfo.SettlementId != adoptedChild.GetOrganizationInfo().SettlementId;
			if (flag)
			{
				sbyte childGrade = OrganizationDomain.GetOrgMemberConfig(adopterOrgInfo).ChildGrade;
				OrganizationInfo childOrgInfo = new OrganizationInfo(adopterOrgInfo.OrgTemplateId, childGrade, true, adopterOrgInfo.SettlementId);
				adoptedChild.SetOrganizationInfo(childOrgInfo, context);
				DomainManager.Organization.JoinOrganization(context, adoptedChild, childOrgInfo);
			}
			else
			{
				DomainManager.Organization.JoinOrganization(context, adoptedChild, adoptedChild.GetOrganizationInfo());
			}
			FullName newName = this.GenerateRandomChildName(context, adoptedChild.GetGender(), adopter.GetFullName());
			adoptedChild.SetFullName(newName, context);
			Location adopterLocation = adopter.GetLocation();
			bool flag2 = !adopterLocation.Equals(adoptedChild.GetLocation());
			if (flag2)
			{
				Events.RaiseCharacterLocationChanged(context, childCharId, adoptedChild.GetLocation(), adopterLocation);
				adoptedChild.SetLocation(adopterLocation, context);
			}
			else
			{
				Events.RaiseCharacterLocationChanged(context, childCharId, Location.Invalid, adopterLocation);
			}
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			lifeRecordCollection.AddAbandonChild(motherCharId, currDate, childCharId, adoptedChild.GetOrganizationInfo().SettlementId);
			sbyte? b = (adopter != null) ? new sbyte?(adopter.GetGender()) : null;
			int? num = (b != null) ? new int?((int)b.GetValueOrDefault()) : null;
			int num2 = 1;
			short relatedId = (num.GetValueOrDefault() == num2 & num != null) ? 46 : 47;
			bool flag3 = adoptedChild.GetGender() == 1;
			if (flag3)
			{
				lifeRecordCollection.AddAdoptSon(adopterId, currDate, childCharId, adopterLocation, relatedId);
			}
			else
			{
				lifeRecordCollection.AddAdoptDaughter(adopterId, currDate, childCharId, adopterLocation, relatedId);
			}
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int secretInfoOffset = secretInformationCollection.AddAbandonChild(motherCharId, childCharId);
			DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
			this.AddAdoptiveParentRelations(context, childCharId, adopterId, currDate);
			int spouseId = DomainManager.Character.GetAliveSpouse(adopterId);
			bool flag4 = spouseId >= 0;
			if (flag4)
			{
				DomainManager.Character.AddAdoptiveParentRelations(context, childCharId, spouseId, currDate);
			}
			bool flag5 = DomainManager.Taiwu.IsInGroup(adopter.GetId());
			if (flag5)
			{
				DomainManager.Taiwu.JoinGroup(context, childCharId, true);
			}
			else
			{
				this.JoinGroup(context, adoptedChild, adopter);
			}
		}

		// Token: 0x060070F1 RID: 28913 RVA: 0x0040B8C8 File Offset: 0x00409AC8
		private void AssignChildToMentor(DataContext context, Character mentor, Character child, int motherCharId)
		{
			int currDate = DomainManager.World.GetCurrDate();
			int childCharId = child.GetId();
			Location mentorLocation = mentor.GetLocation();
			Location selfLocation = child.GetLocation();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			lifeRecordCollection.AddAbandonChild(motherCharId, currDate, childCharId, child.GetOrganizationInfo().SettlementId);
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int secretInfoOffset = secretInformationCollection.AddAbandonChild(motherCharId, childCharId);
			DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
			bool flag = !mentorLocation.Equals(selfLocation);
			if (flag)
			{
				Events.RaiseCharacterLocationChanged(context, childCharId, selfLocation, mentorLocation);
				child.SetLocation(mentorLocation, context);
			}
			else
			{
				Events.RaiseCharacterLocationChanged(context, childCharId, Location.Invalid, mentorLocation);
			}
			DomainManager.Organization.JoinOrganization(context, child, child.GetOrganizationInfo());
			this.JoinGroup(context, child, mentor);
		}

		// Token: 0x060070F2 RID: 28914 RVA: 0x0040B998 File Offset: 0x00409B98
		public unsafe override void PackCrossArchiveGameData(CrossArchiveGameData crossArchiveGameData)
		{
			CharacterDomain.<>c__DisplayClass245_0 CS$<>8__locals1;
			CS$<>8__locals1.<>4__this = this;
			CS$<>8__locals1.crossArchiveGameData = crossArchiveGameData;
			CS$<>8__locals1.crossArchiveGameData.NextObjectId = this._nextObjectId;
			Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
			int taiwuCharId = taiwuChar.GetId();
			CS$<>8__locals1.crossArchiveGameData.TaiwuChar = taiwuChar;
			CS$<>8__locals1.crossArchiveGameData.DreamBackTaiwuAbridged = this.GetAbridgeCharacter(taiwuCharId);
			CS$<>8__locals1.crossArchiveGameData.TaiwuResources = *taiwuChar.GetResources();
			CS$<>8__locals1.crossArchiveGameData.TaiwuExp = taiwuChar.GetExp();
			CS$<>8__locals1.crossArchiveGameData.FuyuFaith = DomainManager.Extra.GetFuyuFaith();
			HashSet<int> relatedCharIds = new HashSet<int>();
			this.GetAllRelatedCharIds(taiwuCharId, relatedCharIds, true);
			CS$<>8__locals1.crossArchiveGameData.AbridgedCharacters = new Dictionary<int, AbridgedCharacter>();
			foreach (int relatedCharId in relatedCharIds)
			{
				this.PackAbridgedCharacter(CS$<>8__locals1.crossArchiveGameData, relatedCharId);
			}
			Genealogy genealogy = this.GetGenealogy(taiwuCharId);
			this.PackAbridgedCharacter(CS$<>8__locals1.crossArchiveGameData, genealogy.GrandfatherId);
			this.PackAbridgedCharacter(CS$<>8__locals1.crossArchiveGameData, genealogy.GrandmotherId);
			this.PackAbridgedCharacter(CS$<>8__locals1.crossArchiveGameData, genealogy.MaternalGrandfatherId);
			this.PackAbridgedCharacter(CS$<>8__locals1.crossArchiveGameData, genealogy.MaternalGrandmotherId);
			foreach (SpouseAndChildren spouse in genealogy.Spouses)
			{
				this.<PackCrossArchiveGameData>g__PackSpouseAndChildren|245_1(spouse, ref CS$<>8__locals1);
			}
			CS$<>8__locals1.crossArchiveGameData.Genealogy = genealogy;
			CS$<>8__locals1.crossArchiveGameData.PreexistenceDeadCharacters = new Dictionary<int, DeadCharacter>();
			PreexistenceCharIds preexistenceCharIds = *taiwuChar.GetPreexistenceCharIds();
			int i = 0;
			int count = preexistenceCharIds.Count;
			while (i < count)
			{
				int preCharId = *(ref preexistenceCharIds.CharIds.FixedElementField + (IntPtr)i * 4);
				DeadCharacter preChar = DomainManager.Character.TryGetDeadCharacter(preCharId);
				bool flag = preChar != null;
				if (flag)
				{
					CS$<>8__locals1.crossArchiveGameData.PreexistenceDeadCharacters.Add(preCharId, preChar);
				}
				i++;
			}
			ItemKey[] equipments = taiwuChar.GetEquipment();
			foreach (ItemKey equipmentKey in equipments)
			{
				bool flag2 = !equipmentKey.IsValid();
				if (!flag2)
				{
					DomainManager.Item.PackCrossArchiveItem(CS$<>8__locals1.crossArchiveGameData, equipmentKey);
				}
			}
			Inventory inventory = taiwuChar.GetInventory();
			foreach (ItemKey itemKey in inventory.Items.Keys)
			{
				DomainManager.Item.PackCrossArchiveItem(CS$<>8__locals1.crossArchiveGameData, itemKey);
			}
		}

		// Token: 0x060070F3 RID: 28915 RVA: 0x0040BC8C File Offset: 0x00409E8C
		public unsafe override void UnpackCrossArchiveGameData(DataContext context, CrossArchiveGameData crossArchiveGameData)
		{
			this._nextObjectId = Math.Max(crossArchiveGameData.NextObjectId, this._nextObjectId);
			this.SetNextObjectId(this._nextObjectId, context);
			DomainManager.Extra.SetFuyuFaith(crossArchiveGameData.FuyuFaith, context);
			DomainManager.Extra.SaveOverwrittenTaiwu(context);
			int charId = DomainManager.Taiwu.GetTaiwuCharId();
			Character character = DomainManager.Taiwu.GetTaiwu();
			this.RemoveElement_Objects(charId);
			Dictionary<int, int> preexistenceCharIdMap = new Dictionary<int, int>();
			ref PreexistenceCharIds preexistenceCharIds = ref crossArchiveGameData.TaiwuChar.GetPreexistenceCharIds();
			int i = 0;
			int count = preexistenceCharIds.Count;
			while (i < count)
			{
				int preCharId = *(ref preexistenceCharIds.CharIds.FixedElementField + (IntPtr)i * 4);
				DeadCharacter preChar;
				bool flag = !crossArchiveGameData.PreexistenceDeadCharacters.TryGetValue(preCharId, out preChar);
				if (flag)
				{
					*(ref preexistenceCharIds.CharIds.FixedElementField + (IntPtr)i * 4) = -1;
				}
				else
				{
					int objId = this.GenerateNextObjectId(context);
					preexistenceCharIdMap.Add(preCharId, objId);
					*(ref preexistenceCharIds.CharIds.FixedElementField + (IntPtr)i * 4) = objId;
				}
				i++;
			}
			foreach (KeyValuePair<int, DeadCharacter> keyValuePair in crossArchiveGameData.PreexistenceDeadCharacters)
			{
				int num;
				DeadCharacter deadCharacter;
				keyValuePair.Deconstruct(out num, out deadCharacter);
				int preexistenceCharId = num;
				DeadCharacter deadChar = deadCharacter;
				int convertedCharId = preexistenceCharIdMap[preexistenceCharId];
				PreexistenceCharIds deadCharPreexistenceCharIds = deadChar.PreexistenceCharIds;
				int j = 0;
				int count2 = deadCharPreexistenceCharIds.Count;
				while (j < count2)
				{
					int preCharId2 = *(ref deadCharPreexistenceCharIds.CharIds.FixedElementField + (IntPtr)j * 4);
					DeadCharacter preChar2;
					bool flag2 = !crossArchiveGameData.PreexistenceDeadCharacters.TryGetValue(preCharId2, out preChar2);
					if (flag2)
					{
						*(ref deadCharPreexistenceCharIds.CharIds.FixedElementField + (IntPtr)j * 4) = -1;
					}
					else
					{
						int targetId;
						bool flag3 = !preexistenceCharIdMap.TryGetValue(preCharId2, out targetId);
						if (flag3)
						{
							Logger logger = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
							defaultInterpolatedStringHandler.AppendLiteral("Invalid character id as preexistence char ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(targetId);
							logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
							targetId = -1;
						}
						*(ref deadCharPreexistenceCharIds.CharIds.FixedElementField + (IntPtr)j * 4) = targetId;
					}
					j++;
				}
				deadChar.PreexistenceCharIds = deadCharPreexistenceCharIds;
				this.AddElement_DeadCharacters(convertedCharId, deadChar, context);
			}
			character.OfflineInheritCrossArchiveCharacter(crossArchiveGameData.TaiwuChar);
			List<short> featureIds = character.GetFeatureIds();
			bool flag4 = this._pregnantStates.ContainsKey(charId);
			if (flag4)
			{
				featureIds.Add(197);
			}
			this.AddElement_Objects(charId, character);
			bool flag5 = character.GetAgeGroup() == 1;
			if (flag5)
			{
				character.ReAdjustClothingByAge(context);
			}
			MainAttributes maxMainAttributes = character.GetMaxMainAttributes();
			MainAttributes currMainAttributes = character.GetCurrMainAttributes();
			for (sbyte mainAttrType = 0; mainAttrType < 6; mainAttrType += 1)
			{
				*(ref currMainAttributes.Items.FixedElementField + (IntPtr)mainAttrType * 2) = Math.Min(*(ref currMainAttributes.Items.FixedElementField + (IntPtr)mainAttrType * 2), *(ref maxMainAttributes.Items.FixedElementField + (IntPtr)mainAttrType * 2));
			}
			character.SetCurrMainAttributes(currMainAttributes, context);
		}

		// Token: 0x060070F4 RID: 28916 RVA: 0x0040BFC8 File Offset: 0x0040A1C8
		public void UnpackCrossArchiveGameData_Items(DataContext context, CrossArchiveGameData crossArchiveGameData, bool overwriteEquipments)
		{
			Character character = DomainManager.Taiwu.GetTaiwu();
			Inventory inventory = character.GetInventory();
			ItemKey[] equipment = character.GetEquipment();
			int charId = character.GetId();
			ItemKey[] dreamBackEquipment = crossArchiveGameData.TaiwuChar.GetEquipment();
			for (int index = 0; index < dreamBackEquipment.Length; index++)
			{
				ItemKey equipmentKey = dreamBackEquipment[index];
				bool flag = !equipmentKey.IsValid();
				if (!flag)
				{
					ItemKey newKey = DomainManager.Item.UnpackCrossArchiveItem(context, crossArchiveGameData, equipmentKey.Id);
					bool flag2 = equipmentKey.ItemType == 3 && (Config.Clothing.Instance[equipmentKey.TemplateId].AgeGroup != 2 || character.GetAgeGroup() != 2);
					if (flag2)
					{
						bool flag3 = newKey.IsValid();
						if (flag3)
						{
							DomainManager.Item.RemoveItem(context, newKey);
							crossArchiveGameData.UnpackedItems.Remove(newKey.Id);
						}
						dreamBackEquipment[index] = equipment[index];
					}
					else
					{
						dreamBackEquipment[index] = newKey;
						bool flag4 = newKey.IsValid();
						if (flag4)
						{
							DomainManager.Item.SetOwner(newKey, ItemOwnerType.CharacterInventory, charId);
							inventory.OfflineAdd(newKey, 1);
						}
					}
				}
			}
			if (overwriteEquipments)
			{
				character.ChangeEquipment(context, dreamBackEquipment);
			}
			Inventory dreamBackInventory = crossArchiveGameData.TaiwuChar.GetInventory();
			foreach (KeyValuePair<ItemKey, int> keyValuePair in dreamBackInventory.Items)
			{
				ItemKey itemKey2;
				int num;
				keyValuePair.Deconstruct(out itemKey2, out num);
				ItemKey itemKey = itemKey2;
				int amount = num;
				bool flag5 = !ItemTemplateHelper.IsInheritable(itemKey.ItemType, itemKey.TemplateId);
				if (!flag5)
				{
					ItemKey newItemKey = DomainManager.Item.UnpackCrossArchiveItem(context, crossArchiveGameData, itemKey.Id);
					bool flag6 = !newItemKey.IsValid();
					if (!flag6)
					{
						bool flag7 = itemKey.ItemType == 12;
						if (flag7)
						{
							bool flag8 = Config.Misc.Instance[itemKey.TemplateId].ItemSubType == 1202;
							if (flag8)
							{
								int bookCombatSkillType = (int)(itemKey.TemplateId - 211);
								DomainManager.LegendaryBook.RegisterOwner(context, character, (sbyte)bookCombatSkillType);
							}
							else
							{
								bool flag9 = itemKey.TemplateId == 199;
								if (flag9)
								{
									bool flag10 = inventory.GetInventoryItemCount(itemKey.ItemType, itemKey.TemplateId) > 0;
									if (flag10)
									{
										continue;
									}
									bool flag11 = DomainManager.Building.IsTaiwuVillageHaveSpecifyBuilding(50, false);
									if (flag11)
									{
										continue;
									}
								}
								else
								{
									bool flag12 = itemKey.TemplateId == 198;
									if (flag12)
									{
										bool flag13 = inventory.GetInventoryItemCount(itemKey.ItemType, itemKey.TemplateId) > 0;
										if (flag13)
										{
											continue;
										}
										bool flag14 = DomainManager.Building.IsTaiwuVillageHaveSpecifyBuilding(51, false);
										if (flag14)
										{
											continue;
										}
									}
								}
							}
						}
						ItemBase item = DomainManager.Item.GetBaseItem(newItemKey);
						item.ResetOwner();
						item.SetOwner(ItemOwnerType.CharacterInventory, charId);
						inventory.OfflineAdd(newItemKey, amount);
					}
				}
			}
			character.SetInventory(inventory, context);
			dreamBackInventory.Items.Clear();
			this.RemoveDlcDuplicateClothing(context, false);
		}

		// Token: 0x060070F5 RID: 28917 RVA: 0x0040C324 File Offset: 0x0040A524
		public void RemoveDlcDuplicateClothing(DataContext context, bool fixArchiveData)
		{
			foreach (ClothingItem config in ((IEnumerable<ClothingItem>)Config.Clothing.Instance))
			{
				bool flag = !string.IsNullOrEmpty(config.DlcName);
				if (flag)
				{
					this.RemoveDuplicateClothing(context, config.TemplateId, fixArchiveData);
				}
			}
		}

		// Token: 0x060070F6 RID: 28918 RVA: 0x0040C394 File Offset: 0x0040A594
		private void RemoveDuplicateClothing(DataContext context, short templateId, bool fixArchiveData)
		{
			Character character = DomainManager.Taiwu.GetTaiwu();
			Inventory inventory = character.GetInventory();
			ItemKey[] equipment = character.GetEquipment();
			int inventoryItemCount = inventory.GetInventoryItemCount(3, templateId);
			int deleteCount = 0;
			bool flag = equipment[4].TemplateId == templateId && inventoryItemCount >= 1;
			if (flag)
			{
				deleteCount = inventoryItemCount;
			}
			else
			{
				bool flag2 = inventoryItemCount >= 2;
				if (flag2)
				{
					deleteCount = inventoryItemCount - 1;
				}
			}
			for (int i = 0; i < deleteCount; i++)
			{
				ItemKey inventoryItemKey = inventory.GetInventoryItemKey(3, templateId);
				bool flag3 = inventoryItemKey.IsValid();
				if (flag3)
				{
					character.RemoveInventoryItem(context, inventoryItemKey, 1, true, false);
					if (fixArchiveData)
					{
						Logger logger = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(81, 2);
						defaultInterpolatedStringHandler.AppendLiteral("FixArchiveData with RemoveDuplicateClothing Func,Clothing templateId:");
						defaultInterpolatedStringHandler.AppendFormatted<short>(inventoryItemKey.TemplateId);
						defaultInterpolatedStringHandler.AppendLiteral(",itemKey.Id:");
						defaultInterpolatedStringHandler.AppendFormatted<int>(inventoryItemKey.Id);
						logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
					}
				}
			}
		}

		// Token: 0x060070F7 RID: 28919 RVA: 0x0040C4A4 File Offset: 0x0040A6A4
		public void UnpackCrossArchiveGameData_LifeSkills(DataContext context, CrossArchiveGameData crossArchiveGameData)
		{
			Character taiwu = DomainManager.Taiwu.GetTaiwu();
			List<LifeSkillItem> dreamBackLifeSkills = crossArchiveGameData.TaiwuChar.GetLearnedLifeSkills();
			List<LifeSkillItem> currLifeSkills = taiwu.GetLearnedLifeSkills();
			List<LifeSkillItem> mergedLifeSkills = new List<LifeSkillItem>();
			foreach (LifeSkillItem dreamBackLifeSkill in dreamBackLifeSkills)
			{
				int index = taiwu.FindLearnedLifeSkillIndex(dreamBackLifeSkill.SkillTemplateId);
				bool flag = index >= 0;
				if (flag)
				{
					LifeSkillItem currLifeSkill = currLifeSkills[index];
					currLifeSkill.ReadingState |= dreamBackLifeSkill.ReadingState;
					mergedLifeSkills.Add(currLifeSkill);
				}
				else
				{
					mergedLifeSkills.Add(dreamBackLifeSkill);
				}
			}
			taiwu.SetLearnedLifeSkills(mergedLifeSkills, context);
			dreamBackLifeSkills.Clear();
		}

		// Token: 0x060070F8 RID: 28920 RVA: 0x0040C57C File Offset: 0x0040A77C
		private void PackAbridgedCharacter(CrossArchiveGameData crossArchiveGameData, int charId)
		{
			bool flag = crossArchiveGameData.AbridgedCharacters.ContainsKey(charId) || charId < 0;
			if (!flag)
			{
				AbridgedCharacter abridgedChar = this.GetAbridgeCharacter(charId);
				bool flag2 = abridgedChar != null;
				if (flag2)
				{
					crossArchiveGameData.AbridgedCharacters.Add(charId, abridgedChar);
				}
			}
		}

		// Token: 0x060070F9 RID: 28921 RVA: 0x0040C5C4 File Offset: 0x0040A7C4
		public AbridgedCharacter GetAbridgeCharacter(int charId)
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			RelationKey selfToTaiwuKey = new RelationKey(charId, taiwuCharId);
			RelationKey taiwuToSelfKey = new RelationKey(taiwuCharId, charId);
			ushort selfRelationToTaiwu = ushort.MaxValue;
			ushort taiwuRelationToSelf = ushort.MaxValue;
			bool flag = charId != taiwuCharId;
			if (flag)
			{
				RelatedCharacter selfToTaiwu;
				bool flag2 = this._relations.TryGetValue(selfToTaiwuKey, out selfToTaiwu);
				if (flag2)
				{
					selfRelationToTaiwu = selfToTaiwu.RelationType;
				}
				RelatedCharacter taiwuToSelf;
				bool flag3 = this._relations.TryGetValue(taiwuToSelfKey, out taiwuToSelf);
				if (flag3)
				{
					taiwuRelationToSelf = taiwuToSelf.RelationType;
				}
			}
			Character character;
			bool flag4 = this._objects.TryGetValue(charId, out character);
			AbridgedCharacter result;
			if (flag4)
			{
				result = new AbridgedCharacter
				{
					Id = character.GetId(),
					CharTemplateId = character.GetTemplateId(),
					Gender = character.GetGender(),
					ActualAge = character.GetActualAge(),
					CurrAge = character.GetCurrAge(),
					MonkType = character.GetMonkType(),
					Avatar = character.GetAvatar(),
					ClothingDisplayId = character.GetClothingDisplayId(),
					FullName = character.GetFullName(),
					OrganizationInfo = character.GetOrganizationInfo(),
					MonasticTitle = character.GetMonasticTitle(),
					CustomDisplayNameId = DomainManager.Extra.GetCharacterCustomDisplayName(charId),
					SelfRelationToTaiwu = selfRelationToTaiwu,
					TaiwuRelationToSelf = taiwuRelationToSelf,
					AliveState = 0,
					Location = character.GetLocation(),
					BirthDate = character.GetBirthDate()
				};
			}
			else
			{
				DeadCharacter deadCharacter;
				bool flag5 = this._deadCharacters.TryGetValue(charId, out deadCharacter);
				if (flag5)
				{
					Grave grave;
					result = new AbridgedCharacter
					{
						Id = charId,
						CharTemplateId = deadCharacter.TemplateId,
						Gender = deadCharacter.Gender,
						ActualAge = deadCharacter.GetActualAge(),
						CurrAge = deadCharacter.CurrAge,
						MonkType = deadCharacter.MonkType,
						Avatar = deadCharacter.Avatar,
						ClothingDisplayId = deadCharacter.ClothingDisplayId,
						FullName = deadCharacter.FullName,
						OrganizationInfo = deadCharacter.OrganizationInfo,
						MonasticTitle = deadCharacter.MonasticTitle,
						CustomDisplayNameId = DomainManager.Extra.GetCharacterCustomDisplayName(charId),
						SelfRelationToTaiwu = selfRelationToTaiwu,
						TaiwuRelationToSelf = taiwuRelationToSelf,
						AliveState = 1,
						Location = (this._graves.TryGetValue(charId, out grave) ? grave.GetLocation() : Location.Invalid),
						BirthDate = deadCharacter.BirthDate
					};
				}
				else
				{
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(53, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unable to find character ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
					defaultInterpolatedStringHandler.AppendLiteral(" for creating abridged data.");
					logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
					result = null;
				}
			}
			return result;
		}

		// Token: 0x060070FA RID: 28922 RVA: 0x0040C880 File Offset: 0x0040AA80
		[return: TupleElementNames(new string[]
		{
			"Total",
			"Child",
			"Adult",
			"Semi",
			"Old"
		})]
		public ValueTuple<Dictionary<short, int>, Dictionary<short, int>, Dictionary<short, int>, Dictionary<short, int>, Dictionary<short, int>> CalcCharacterBelongStatDict()
		{
			Dictionary<short, int> all = new Dictionary<short, int>();
			Dictionary<short, int> child = new Dictionary<short, int>();
			Dictionary<short, int> adult = new Dictionary<short, int>();
			Dictionary<short, int> semi = new Dictionary<short, int>();
			Dictionary<short, int> old = new Dictionary<short, int>();
			foreach (Character character in this._objects.Values)
			{
				bool flag = character.GetCreatingType() != 1 || character.GetDarkAshProtector() > 0U;
				if (!flag)
				{
					short belong = character.GetOrganizationInfo().SettlementId;
					bool flag2 = !all.TryAdd(belong, 1);
					if (flag2)
					{
						Dictionary<short, int> dictionary = all;
						short key = belong;
						int num = dictionary[key];
						dictionary[key] = num + 1;
					}
					short actualAge = character.GetActualAge();
					short num2 = actualAge;
					if (num2 < 40)
					{
						if (num2 >= 16)
						{
							bool flag3 = !adult.TryAdd(belong, 1);
							if (flag3)
							{
								Dictionary<short, int> dictionary2 = adult;
								short key = belong;
								int num = dictionary2[key];
								dictionary2[key] = num + 1;
							}
						}
						else
						{
							bool flag4 = !child.TryAdd(belong, 1);
							if (flag4)
							{
								Dictionary<short, int> dictionary3 = child;
								short key = belong;
								int num = dictionary3[key];
								dictionary3[key] = num + 1;
							}
						}
					}
					else if (num2 >= 70)
					{
						bool flag5 = !old.TryAdd(belong, 1);
						if (flag5)
						{
							Dictionary<short, int> dictionary4 = old;
							short key = belong;
							int num = dictionary4[key];
							dictionary4[key] = num + 1;
						}
					}
					else
					{
						bool flag6 = !semi.TryAdd(belong, 1);
						if (flag6)
						{
							Dictionary<short, int> dictionary5 = semi;
							short key = belong;
							int num = dictionary5[key];
							dictionary5[key] = num + 1;
						}
					}
				}
			}
			return new ValueTuple<Dictionary<short, int>, Dictionary<short, int>, Dictionary<short, int>, Dictionary<short, int>, Dictionary<short, int>>(all, child, adult, semi, old);
		}

		// Token: 0x060070FB RID: 28923 RVA: 0x0040CA60 File Offset: 0x0040AC60
		[return: TupleElementNames(new string[]
		{
			"Adult",
			"Semi",
			"Old",
			"Exceed",
			"Total",
			"Exceed",
			"Total",
			"Exceed",
			"Total"
		})]
		public Dictionary<short, ValueTuple<ValueTuple<int, int>, ValueTuple<int, int>, ValueTuple<int, int>>> CalcExceedPopulations(IRandomSource random, IEnumerable<short> settlementIds, Dictionary<short, int> childs, Dictionary<short, int> adults, Dictionary<short, int> semis, Dictionary<short, int> olds)
		{
			short factor = WorldCreation.DefValue.WorldPopulation.InfluenceFactors[(int)DomainManager.World.GetWorldPopulationType()];
			Dictionary<short, ValueTuple<ValueTuple<int, int>, ValueTuple<int, int>, ValueTuple<int, int>>> dict = new Dictionary<short, ValueTuple<ValueTuple<int, int>, ValueTuple<int, int>, ValueTuple<int, int>>>();
			foreach (short settlementId in settlementIds)
			{
				int childCount;
				childs.TryGetValue(settlementId, out childCount);
				int adultCount;
				adults.TryGetValue(settlementId, out adultCount);
				int semiCount;
				semis.TryGetValue(settlementId, out semiCount);
				int oldCount;
				olds.TryGetValue(settlementId, out oldCount);
				Settlement settlement = (settlementId >= 0) ? DomainManager.Organization.GetSettlement(settlementId) : null;
				bool flag = settlement == null;
				if (!flag)
				{
					int total = settlement.OrganizationConfig.PopulationThreshold * random.Next(100, GlobalConfig.Instance.PopulationLimitRandomRateMax) / 100;
					int exceed = oldCount + semiCount + adultCount - total * (int)factor / 100;
					int semiDelta = semiCount - adultCount / 2;
					int oldDelta = oldCount - adultCount / 3;
					bool flag2 = exceed <= 0 && semiDelta <= 0 && oldDelta <= 0;
					if (!flag2)
					{
						int adult = adultCount;
						int semi = semiCount * 3;
						int old = oldCount * 6;
						int totalWeight = adult + semi + old;
						bool flag3 = totalWeight > 0;
						if (flag3)
						{
							adult = adult * exceed / totalWeight;
							semi = semi * exceed / totalWeight;
							old = old * exceed / totalWeight;
						}
						adult = Math.Min(adult, adultCount);
						semi = Math.Min(Math.Max(semiDelta, semi), semiCount);
						old = Math.Min(Math.Max(oldDelta, old), oldCount);
						bool flag4 = (adult | semi | old) == 0;
						if (!flag4)
						{
							short? num = (settlement != null) ? new short?(settlement.GetLocation().AreaId) : null;
							if (num == null)
							{
								goto IL_1B9;
							}
							short valueOrDefault = num.GetValueOrDefault();
							if (valueOrDefault < 0)
							{
								goto IL_1B9;
							}
							bool flag5 = valueOrDefault <= 135;
							IL_1BA:
							bool flag6 = flag5;
							if (flag6)
							{
								dict[settlementId] = new ValueTuple<ValueTuple<int, int>, ValueTuple<int, int>, ValueTuple<int, int>>(new ValueTuple<int, int>(adult, adultCount), new ValueTuple<int, int>(semi, semiCount), new ValueTuple<int, int>(old, oldCount));
							}
							continue;
							IL_1B9:
							flag5 = false;
							goto IL_1BA;
						}
					}
				}
			}
			return dict;
		}

		// Token: 0x060070FC RID: 28924 RVA: 0x0040CC94 File Offset: 0x0040AE94
		public void MarkExceedPopulations(DataContext context, [TupleElementNames(new string[]
		{
			"Adult",
			"Semi",
			"Old",
			"Exceed",
			"Total",
			"Exceed",
			"Total",
			"Exceed",
			"Total"
		})] Dictionary<short, ValueTuple<ValueTuple<int, int>, ValueTuple<int, int>, ValueTuple<int, int>>> plan)
		{
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			int currDate = DomainManager.World.GetCurrDate();
			foreach (Character character in this._objects.Values)
			{
				bool flag = character.GetCreatingType() != 1 || character.GetDarkAshProtector() > 0U;
				if (!flag)
				{
					short belong = character.GetOrganizationInfo().SettlementId;
					ValueTuple<ValueTuple<int, int>, ValueTuple<int, int>, ValueTuple<int, int>> markPlan;
					bool flag2 = !plan.TryGetValue(belong, out markPlan);
					if (!flag2)
					{
						short actualAge = character.GetActualAge();
						short num = actualAge;
						bool infected;
						if (num < 40)
						{
							if (num < 16)
							{
								continue;
							}
							IRandomSource random = context.Random;
							int item = markPlan.Item1.Item2;
							markPlan.Item1.Item2 = item - 1;
							bool flag3;
							infected = (flag3 = (random.Next(item) < markPlan.Item1.Item1));
							if (flag3)
							{
								markPlan.Item1.Item1 = markPlan.Item1.Item1 - 1;
							}
						}
						else if (num >= 70)
						{
							IRandomSource random2 = context.Random;
							int item = markPlan.Item3.Item2;
							markPlan.Item3.Item2 = item - 1;
							bool flag4;
							infected = (flag4 = (random2.Next(item) < markPlan.Item3.Item1));
							if (flag4)
							{
								markPlan.Item3.Item1 = markPlan.Item3.Item1 - 1;
							}
						}
						else
						{
							IRandomSource random3 = context.Random;
							int item = markPlan.Item2.Item2;
							markPlan.Item2.Item2 = item - 1;
							bool flag5;
							infected = (flag5 = (random3.Next(item) < markPlan.Item2.Item1));
							if (flag5)
							{
								markPlan.Item2.Item1 = markPlan.Item2.Item1 - 1;
							}
						}
						bool flag6 = infected;
						if (flag6)
						{
							character.AddDarkAsh(context, lifeRecordCollection, int.MinValue);
						}
						plan[belong] = markPlan;
					}
				}
			}
		}

		// Token: 0x060070FD RID: 28925 RVA: 0x0040CE8C File Offset: 0x0040B08C
		public void AddDarkAshNotifications()
		{
			MonthlyNotificationCollection mc = DomainManager.World.GetMonthlyNotificationCollection();
			HashSet<int> checks = new HashSet<int>();
			this.GetTaiwuPeople(checks);
			foreach (int id in checks)
			{
				Character character;
				int duration;
				bool flag = this.TryGetElement_Objects(id, out character) && character.ShouldNotifyDarkAshInfected(out duration);
				if (flag)
				{
					mc.AddFamilyGetInfected(id, duration);
				}
			}
			foreach (int id2 in DomainManager.Extra.GetFollowingNpcList())
			{
				Character character2;
				int duration2;
				bool flag2 = this.TryGetElement_Objects(id2, out character2) && character2.ShouldNotifyDarkAshInfected(out duration2);
				if (flag2)
				{
					mc.AddFocusedGetInfected(id2, duration2);
				}
			}
		}

		// Token: 0x060070FE RID: 28926 RVA: 0x0040CF84 File Offset: 0x0040B184
		public void PostAdvanceMonthCalcDarkAsh(DataContext context)
		{
			ValueTuple<Dictionary<short, int>, Dictionary<short, int>, Dictionary<short, int>, Dictionary<short, int>, Dictionary<short, int>> belongDict = DomainManager.Character.CalcCharacterBelongStatDict();
			Dictionary<short, ValueTuple<ValueTuple<int, int>, ValueTuple<int, int>, ValueTuple<int, int>>> markPlan = DomainManager.Character.CalcExceedPopulations(context.Random, belongDict.Item1.Keys, belongDict.Item2, belongDict.Item3, belongDict.Item4, belongDict.Item5);
			DomainManager.Character.MarkExceedPopulations(context, markPlan);
			this.AddDarkAshNotifications();
			int currDate = DomainManager.World.GetCurrDate();
			foreach (int id in DomainManager.Extra.GetAllDarkAshCounterData().ToArray<int>())
			{
				DarkAshCounterData data;
				bool flag = DomainManager.Extra.TryGetDarkAshCounterData(id, out data);
				if (flag)
				{
					Character character;
					bool flag2 = data.ExpiredDate2 - currDate <= 0 || !this.TryGetElement_Objects(id, out character);
					if (flag2)
					{
						DomainManager.Extra.RemoveDarkAshCounterData(context, id);
					}
					else
					{
						bool flag3 = (character.GetDarkAshProtector() & 4294966537U) > 0U;
						if (flag3)
						{
							DomainManager.Extra.SetDarkAshCounterData(context, id, data.OfflineApplyFaithChangeToExtraData(currDate - 1, 1));
						}
					}
				}
			}
		}

		// Token: 0x060070FF RID: 28927 RVA: 0x0040D094 File Offset: 0x0040B294
		public void MakeCharacterDead(DataContext context, Character character, short deathType)
		{
			CharacterDeathInfo deathInfo = new CharacterDeathInfo(character.GetValidLocation());
			this.MakeCharacterDead(context, character, deathType, deathInfo);
		}

		// Token: 0x06007100 RID: 28928 RVA: 0x0040D0BC File Offset: 0x0040B2BC
		public void MakeCharacterDead(DataContext context, Character character, short deathType, CharacterDeathInfo deathInfo)
		{
			Tester.Assert(character.GetCreatingType() == 1, "");
			Tester.Assert(!this.IsTemporaryIntelligentCharacter(character.GetId()), "");
			CharacterDeathTypeItem deathTypeCfg = CharacterDeathType.Instance[deathType];
			int charId = character.GetId();
			int deathDate = (deathInfo.DeathDate == int.MinValue) ? DomainManager.World.GetCurrDate() : deathInfo.DeathDate;
			DeadCharacter deadChar = DeadCharacterHelper.CreateDeadCharacter(character, deathDate);
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(20, 4);
			defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
			defaultInterpolatedStringHandler.AppendLiteral(" is dead at age ");
			defaultInterpolatedStringHandler.AppendFormatted<short>(character.GetCurrAge());
			defaultInterpolatedStringHandler.AppendLiteral(".(");
			defaultInterpolatedStringHandler.AppendFormatted(deathTypeCfg.Name);
			defaultInterpolatedStringHandler.AppendLiteral(":");
			defaultInterpolatedStringHandler.AppendFormatted<CharacterDeathInfo>(deathInfo);
			defaultInterpolatedStringHandler.AppendLiteral(")");
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
			bool flag = character.GetHealth() > 0;
			if (flag)
			{
				character.SetHealth(0, context);
			}
			int leaderId = character.GetLeaderId();
			Location charLocation = character.GetLocation();
			bool flag2 = !charLocation.IsValid();
			if (flag2)
			{
				CrossAreaMoveInfo crossAreaMoveInfo;
				bool flag3 = (leaderId < 0 || charId == leaderId) && this._crossAreaMoveInfos.TryGetValue(leaderId, out crossAreaMoveInfo);
				if (flag3)
				{
					charLocation = DomainManager.Map.CrossAreaTravelInfoToLocation(crossAreaMoveInfo);
					this.GroupMove(context, character, charLocation);
				}
				else
				{
					charLocation = character.GetValidLocation();
					character.SetLocation(charLocation, context);
				}
			}
			MonthlyNotificationCollection monthlyNotifications = DomainManager.World.GetMonthlyNotificationCollection();
			bool flag4 = DomainManager.Taiwu.IsCharacterFollowedByTaiwu(charId);
			if (flag4)
			{
				bool flag5 = deathType == 16;
				if (flag5)
				{
					monthlyNotifications.AddFocusedDieByInfected(charId, deathInfo.Location);
				}
				else
				{
					monthlyNotifications.AddDieNotice(charId, deathInfo.Location);
				}
			}
			bool flag6 = deathTypeCfg.DefaultMonthlyNotification >= 0 && (!deathTypeCfg.NotifyTaiwuPeopleOnly || character.GetOrganizationInfo().OrgTemplateId == 16 || DomainManager.Character.IsTaiwuPeople(charId));
			if (flag6)
			{
				monthlyNotifications.AddDeathNotification(charId, deathTypeCfg, ref deathInfo);
			}
			this.RemoveCrossAreaTravelInfo(context, charId);
			bool flag7 = charId == DomainManager.Extra.GetKidnappedTravelData().HunterCharId;
			if (flag7)
			{
				bool flag8 = DomainManager.World.GetAdvancingMonthState() == 0;
				if (flag8)
				{
					DomainManager.TaiwuEvent.OnEvent_TaiwuBeHuntedHunterDie(charId);
				}
				else
				{
					MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
					monthlyEventCollection.AddTaiwuBeHuntedHunterDie(charId, DomainManager.Taiwu.GetTaiwuCharId());
					DomainManager.World.IsTaiwuHunterDie = true;
				}
			}
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int secretInfoOffset = secretInformationCollection.AddDie(charId, charLocation);
			DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
			this.RemoveAllKidnappedChars(context, character, true);
			this.HandleLoveToken(context, character);
			this.RemoveElement_Objects(charId);
			this._infectedCharSet.Remove(charId);
			bool flag9 = this._pregnantStates.ContainsKey(charId);
			if (flag9)
			{
				this.RemoveElement_PregnantStates(charId, context);
			}
			bool flag10 = this._pregnancyLockEndDates.ContainsKey(charId);
			if (flag10)
			{
				this.RemoveElement_PregnancyLockEndDates(charId, context);
			}
			BasePrioritizedAction action;
			bool flag11 = this.TryGetCharacterPrioritizedAction(charId, out action);
			if (flag11)
			{
				action.OnCharacterDead(context, character);
				this.RemoveElement_PrioritizedActions(charId, context);
			}
			CharacterSet revengingCharSet;
			bool flag12 = this._ongoingVengeances.TryGetValue(charId, out revengingCharSet);
			if (flag12)
			{
				revengingCharSet.Clear();
				this.RemoveElement_OngoingVengeances(charId, context);
			}
			int kidnapperId = character.GetKidnapperId();
			bool flag13 = kidnapperId >= 0;
			if (flag13)
			{
				this.RemoveKidnappedCharacter(context, charId, kidnapperId, true);
			}
			bool flag14 = this._debtsToTaiwu.ContainsKey(charId);
			if (flag14)
			{
				this.RemoveElement_DebtsToTaiwu(charId, context);
			}
			bool flag15 = this._avatarElementGrowthProgress.ContainsKey(charId);
			if (flag15)
			{
				this.RemoveElement_AvatarElementGrowthProgress(charId, context);
			}
			HashSet<int> closeCharIds = ObjectPool<HashSet<int>>.Instance.Get();
			this.GetClosePeople(context.Random, character, closeCharIds, 100);
			closeCharIds.Remove(charId);
			foreach (int closeCharId in closeCharIds)
			{
				RelatedCharacter relation;
				bool flag16 = !this.TryGetRelation(closeCharId, charId, out relation) || relation.RelationType == 0;
				if (!flag16)
				{
					Character closeChar = this._objects[closeCharId];
					for (sbyte typeId = 1; typeId < 17; typeId += 1)
					{
						ushort relationType = RelationType.GetRelationType(typeId);
						bool flag17 = !RelationType.HasRelation(relation.RelationType, relationType);
						if (!flag17)
						{
							GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(25, relationType);
							closeChar.AddPersonalNeed(context, personalNeed);
						}
					}
				}
			}
			bool flag18 = leaderId >= 0;
			if (flag18)
			{
				DomainManager.Character.LeaveGroup(context, character, false);
			}
			Events.RaiseIntelligentCharacterDead(context, character, deathTypeCfg, ref deathInfo);
			character.OnDeathTransferWugKings(context, charLocation);
			this.ResetEquippedItemCharId(context, character);
			this.RemoveNonBuryableItemsInInventory(context, character, charLocation);
			this.RemoveInfant(charId);
			this.AddElement_DeadCharacters(charId, deadChar, context);
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			sbyte advancingMonthState = DomainManager.World.GetAdvancingMonthState();
			bool flag19 = advancingMonthState == 0 || advancingMonthState == 20;
			bool flag20 = flag19;
			if (flag20)
			{
				closeCharIds.Remove(taiwuCharId);
			}
			Character undertaker = deathTypeCfg.FindUndertaker ? this.SelectUndertaker(context, character, closeCharIds) : null;
			ObjectPool<HashSet<int>>.Instance.Return(closeCharIds);
			Location graveLocation = DomainManager.Map.GetRandomGraveBlock(context.Random, charLocation);
			bool flag21 = undertaker != null;
			if (flag21)
			{
				bool flag22 = undertaker.GetId() == taiwuCharId;
				if (flag22)
				{
					MonthlyEventCollection monthlyEventCollection2 = DomainManager.World.GetMonthlyEventCollection();
					monthlyEventCollection2.AddDie(charId, charLocation);
					Grave grave = new Grave(context, character, graveLocation, 0);
					this.AddElement_Graves(charId, grave);
					Events.RaiseGraveLocationChanged(context, charId, Location.Invalid, grave.GetLocation());
				}
				else
				{
					int underTakerMoney = undertaker.GetResource(6);
					sbyte level = Grave.CalcGraveLevel(underTakerMoney);
					bool flag23 = level == 0;
					if (flag23)
					{
						sbyte templateId = 8;
						sbyte itemType = 6;
						short[] graveLevelMoneyCosts = GlobalConfig.Instance.GraveLevelMoneyCosts;
						GameData.Domains.Character.Ai.PersonalNeed personalNeed2 = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(templateId, itemType, graveLevelMoneyCosts[graveLevelMoneyCosts.Length - 1]);
						undertaker.AddPersonalNeed(context, personalNeed2);
					}
					else
					{
						undertaker.ChangeResource(context, 6, (int)(-(int)GlobalConfig.Instance.GraveLevelMoneyCosts[(int)level]));
					}
					Grave grave2 = new Grave(context, character, graveLocation, level);
					this.AddElement_Graves(charId, grave2);
					Events.RaiseGraveLocationChanged(context, charId, Location.Invalid, grave2.GetLocation());
					secretInfoOffset = secretInformationCollection.AddBuildGrave(undertaker.GetId(), charId);
					int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
					LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
					lifeRecordCollection.AddBuildGrave(undertaker.GetId(), deathDate, charId, grave2.GetLocation());
				}
			}
			else
			{
				Grave grave3 = new Grave(context, character, graveLocation, 0);
				this.AddElement_Graves(charId, grave3);
				Events.RaiseGraveLocationChanged(context, charId, Location.Invalid, grave3.GetLocation());
			}
			IntPair deathDateAndCharId = new IntPair(deathDate, charId);
			this.AddElement_RecentDeadCharacters(deathDateAndCharId, default(VoidValue), context);
			this.AddElement_WaitingReincarnationChars(deathDateAndCharId, default(VoidValue), context);
			character.RemoveMerchantType(context);
			this.RemoveAllGeneralRelations(context, charId);
			DomainManager.Extra.RemoveDyingCharacters(context, charId);
		}

		// Token: 0x06007101 RID: 28929 RVA: 0x0040D7DC File Offset: 0x0040B9DC
		[Obsolete]
		public void Die(DataContext context, Character character, bool findUndertaker, int deathDate = -2147483648)
		{
			this.MakeCharacterDead(context, character, 0);
		}

		// Token: 0x06007102 RID: 28930 RVA: 0x0040D7EC File Offset: 0x0040B9EC
		public Character SelectUndertaker(DataContext context, Character character, HashSet<int> closeCharIds)
		{
			bool flag = closeCharIds.Count == 0;
			Character result;
			if (flag)
			{
				result = null;
			}
			else
			{
				int charId = character.GetId();
				int factionId = character.GetFactionId();
				sbyte selfFameType = character.GetFameType();
				bool flag2 = selfFameType == -2;
				if (flag2)
				{
					selfFameType = (context.Random.NextBool() ? 4 : 2);
				}
				int maxScore = 0;
				Character maxScoreChar = null;
				CharacterMatcherItem matcher = CharacterMatcher.DefValue.CanBeUndertaker;
				foreach (int closeCharId in closeCharIds)
				{
					Character closeChar = this._objects[closeCharId];
					bool flag3 = !matcher.Match(closeChar);
					if (!flag3)
					{
						int score = (int)Grave.CalcGraveLevel(closeChar.GetResource(6));
						RelatedCharacter relation;
						bool flag4 = this.TryGetRelation(closeCharId, charId, out relation);
						if (flag4)
						{
							sbyte favorabilityType = FavorabilityType.GetFavorabilityType(relation.Favorability);
							score += (int)((favorabilityType >= 2) ? (favorabilityType - 2) : 0);
							ushort relationType = relation.RelationType;
							bool flag5 = RelationType.HasRelation(relationType, 1024) || RelationType.ContainParentRelations(relationType) || RelationType.ContainChildRelations(relationType);
							if (flag5)
							{
								score += 5;
							}
							else
							{
								bool flag6 = RelationType.ContainBrotherOrSisterRelations(relationType) || RelationType.HasRelation(relationType, 16384) || RelationType.HasRelation(relationType, 512);
								if (flag6)
								{
									score += 4;
								}
								else
								{
									bool flag7 = RelationType.HasRelation(relationType, 2048);
									if (flag7)
									{
										score += 3;
									}
									else
									{
										bool flag8 = RelationType.HasRelation(relationType, 8192);
										if (flag8)
										{
											score += 2;
										}
										else
										{
											bool flag9 = factionId >= 0 && closeChar.GetFactionId() == factionId;
											if (flag9)
											{
												score++;
											}
										}
									}
								}
							}
						}
						else
						{
							bool flag10 = factionId >= 0 && closeChar.GetFactionId() == factionId;
							if (flag10)
							{
								score++;
							}
						}
						switch (closeChar.GetBehaviorType())
						{
						case 0:
						{
							sbyte closeCharFameType = closeChar.GetFameType();
							bool flag11 = closeCharFameType == -2;
							if (flag11)
							{
								closeCharFameType = (context.Random.NextBool() ? 4 : 2);
							}
							bool flag12 = FameType.IsSameSide(selfFameType, closeCharFameType);
							if (flag12)
							{
								score += 2;
							}
							else
							{
								score -= 2;
							}
							break;
						}
						case 1:
							score += 4;
							break;
						case 3:
							score += context.Random.Next(-5, 6);
							break;
						case 4:
							score -= 4;
							break;
						}
						bool flag13 = score > maxScore;
						if (flag13)
						{
							maxScore = score;
							maxScoreChar = closeChar;
						}
						else
						{
							bool flag14 = score == maxScore && maxScoreChar != null && closeCharId > maxScoreChar.GetId();
							if (flag14)
							{
								maxScore = score;
								maxScoreChar = closeChar;
							}
						}
					}
				}
				result = maxScoreChar;
			}
			return result;
		}

		// Token: 0x06007103 RID: 28931 RVA: 0x0040DAC8 File Offset: 0x0040BCC8
		public void TryRemoveRecentDeadCharacters(DataContext context)
		{
			int thresholdDate = DomainManager.World.GetCurrDate() - 12;
			List<IntPair> keysToBeRemoved = new List<IntPair>();
			foreach (KeyValuePair<IntPair, VoidValue> entry in this._recentDeadCharacters)
			{
				IntPair key = entry.Key;
				int deathDate = key.First;
				bool flag = deathDate >= thresholdDate;
				if (!flag)
				{
					int charId = key.Second;
					DomainManager.LifeRecord.Remove(charId);
					keysToBeRemoved.Add(key);
				}
			}
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(46, 2);
			defaultInterpolatedStringHandler.AppendLiteral("Removing recent dead characters life records ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(keysToBeRemoved.Count);
			defaultInterpolatedStringHandler.AppendLiteral("/");
			defaultInterpolatedStringHandler.AppendFormatted<int>(this._recentDeadCharacters.Count);
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
			int i = 0;
			int count = keysToBeRemoved.Count;
			while (i < count)
			{
				this.RemoveElement_RecentDeadCharacters(keysToBeRemoved[i], context);
				i++;
			}
		}

		// Token: 0x06007104 RID: 28932 RVA: 0x0040DBF4 File Offset: 0x0040BDF4
		public void TryRemoveDeadCharacters(DataContext context)
		{
			int thresholdDate = DomainManager.World.GetCurrDate() - 120;
			List<int> charIdsToBeRemoved = new List<int>();
			List<int> prevTaiwuIds = DomainManager.Taiwu.GetPreviousTaiwuIds();
			foreach (KeyValuePair<int, DeadCharacter> entry in this._deadCharacters)
			{
				int charId = entry.Key;
				DeadCharacter deadChar = entry.Value;
				bool flag = deadChar.DeathDate >= thresholdDate;
				if (!flag)
				{
					DeadCharDeletionState state;
					bool flag2 = !this._deadCharDeletionStates.TryGetValue(charId, out state);
					if (!flag2)
					{
						bool flag3 = !state.GraveRemoved || !state.DeletedFromOthersPreexistence;
						if (!flag3)
						{
							bool flag4 = prevTaiwuIds.Contains(charId);
							if (!flag4)
							{
								charIdsToBeRemoved.Add(charId);
							}
						}
					}
				}
			}
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(27, 2);
			defaultInterpolatedStringHandler.AppendLiteral("Removing dead characters: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(charIdsToBeRemoved.Count);
			defaultInterpolatedStringHandler.AppendLiteral("/");
			defaultInterpolatedStringHandler.AppendFormatted<int>(this._deadCharacters.Count);
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
			int i = 0;
			int count = charIdsToBeRemoved.Count;
			while (i < count)
			{
				int charId2 = charIdsToBeRemoved[i];
				DomainManager.Extra.RemoveCharacterCustomDisplayName(context, charId2);
				DomainManager.Extra.RemoveSecretInformationShopCharacterData(context, charId2);
				this.RemoveElement_DeadCharacters(charId2, context);
				this.RemoveElement_DeadCharDeletionStates(charId2, context);
				this.RemoveAllRelations(context, charId2, false);
				DomainManager.Extra.RemoveInteractedCharacter(context, charId2);
				i++;
			}
		}

		// Token: 0x06007105 RID: 28933 RVA: 0x0040DDB0 File Offset: 0x0040BFB0
		public unsafe void RecordDeletedFromOthersPreexistence(DataContext context, ref PreexistenceCharIds preexistenceCharIds)
		{
			int i = 0;
			int count = preexistenceCharIds.Count;
			while (i < count)
			{
				int charId = *(ref preexistenceCharIds.CharIds.FixedElementField + (IntPtr)i * 4);
				DeadCharDeletionState state;
				bool flag = this._deadCharDeletionStates.TryGetValue(charId, out state);
				if (flag)
				{
					state.DeletedFromOthersPreexistence = true;
					this.SetElement_DeadCharDeletionStates(charId, state, context);
				}
				else
				{
					state.DeletedFromOthersPreexistence = true;
					this.AddElement_DeadCharDeletionStates(charId, state, context);
				}
				i++;
			}
		}

		// Token: 0x06007106 RID: 28934 RVA: 0x0040DE2C File Offset: 0x0040C02C
		public void UpdateIntelligentCharacterAliveStates(DataContext context)
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			List<Character> deadCharacters = ObjectPool<List<Character>>.Instance.Get();
			List<MapBlockData> loc = ObjectPool<List<MapBlockData>>.Instance.Get();
			loc.Add(null);
			int currDate = DomainManager.World.GetCurrDate();
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character3;
				keyValuePair.Deconstruct(out num, out character3);
				int charId = num;
				Character character = character3;
				bool flag = character.GetDarkAshProtector() == 32U && DomainManager.Extra.GetCharacterTemporaryFeaturesExpireDate(new IntPair(charId, 758)) <= currDate;
				if (flag)
				{
					bool flag2 = character.GetCreatingType() != 1;
					if (!flag2)
					{
						deadCharacters.Add(character);
						DomainManager.Extra.AddDyingCharacters(context, character.GetId(), 16);
						continue;
					}
					AdaptableLog.TagWarning("DarkAsh", "character {character} is not IntelligentCharacter thus won't die with DarkAsh", false);
				}
				bool flag3 = character.GetHealth() > 0;
				if (flag3)
				{
					DomainManager.Extra.RemoveDyingCharacters(context, charId);
				}
				else
				{
					bool flag4 = character.GetCreatingType() != 1;
					if (!flag4)
					{
						bool flag5 = this._temporaryIntelligentCharIds.Contains(charId);
						if (!flag5)
						{
							bool flag6 = character.GetFeatureIds().Contains(337);
							if (!flag6)
							{
								bool flag7 = character.GetLocation().AreaId == 137 && character.Template.CreatingType == 0;
								if (!flag7)
								{
									bool flag8 = DomainManager.Extra.IsCharacterDying(charId);
									if (flag8)
									{
										bool flag9 = charId == taiwuCharId;
										if (flag9)
										{
											DomainManager.World.SetTaiwuDying(false);
										}
										else
										{
											deadCharacters.Add(character);
										}
									}
									else
									{
										DomainManager.Extra.AddDyingCharacters(context, charId, -1);
									}
								}
							}
						}
					}
				}
			}
			foreach (Character character2 in deadCharacters)
			{
				int charId2 = character2.GetId();
				short xiangshuMinionId = (short)Math.Clamp(298 + (int)(character2.GetConsummateLevel() / 2), 298, 306);
				short type;
				bool flag10 = DomainManager.Extra.TryGetCharacterDyingType(charId2, out type);
				if (flag10)
				{
					DomainManager.Character.MakeCharacterDead(context, character2, type);
					bool flag11 = type == 16;
					if (flag11)
					{
						Grave grave;
						bool flag12 = DomainManager.Character.TryGetElement_Graves(charId2, out grave) && grave.GetLocation().IsValid();
						if (flag12)
						{
							loc[0] = DomainManager.Map.GetBlock(grave.GetLocation());
							DomainManager.Adventure.CreateTemporaryEnemiesOnValidBlocks(context, Location.Invalid, xiangshuMinionId, 1, loc, sbyte.MinValue);
						}
					}
				}
				else
				{
					short enemyNestAdventureId = character2.GetKidnappingEnemyNestAdventure();
					bool flag13 = enemyNestAdventureId < 0;
					if (flag13)
					{
						DomainManager.Character.MakeCharacterDead(context, character2, (character2.GetLeftMaxHealth(false) > 0) ? 2 : 1);
					}
					else
					{
						DomainManager.Character.MakeCharacterDead(context, character2, 5, new CharacterDeathInfo(character2.GetValidLocation())
						{
							AdventureId = enemyNestAdventureId
						});
					}
				}
			}
			ObjectPool<List<Character>>.Instance.Return(deadCharacters);
			ObjectPool<List<MapBlockData>>.Instance.Return(loc);
		}

		// Token: 0x06007107 RID: 28935 RVA: 0x0040E1B4 File Offset: 0x0040C3B4
		public void PrepareTaiwuInheritor(DataContext context, Character inheritor, Character taiwu)
		{
			int inheritorCharId = inheritor.GetId();
			List<LifeSkillItem> lifeSkills = inheritor.GetLearnedLifeSkills();
			lifeSkills.Clear();
			inheritor.SetLearnedLifeSkills(lifeSkills, context);
			DomainManager.SpecialEffect.RemoveAllEquippedSkillEffects(context, inheritor);
			DomainManager.SpecialEffect.RemoveAllBrokenSkillEffects(context, inheritor);
			DomainManager.Character.UnequipAllCombatSkills(context, inheritorCharId);
			inheritor.SetLoopingNeigong(-1, context);
			inheritor.ResetBaseNeiliAllocation(context);
			short[] attainmentPanels = inheritor.GetCombatSkillAttainmentPanels();
			CombatSkillAttainmentPanelsHelper.Initialize(attainmentPanels);
			inheritor.SetCombatSkillAttainmentPanels(attainmentPanels, context);
			List<short> combatSkills = inheritor.GetLearnedCombatSkills();
			combatSkills.Clear();
			inheritor.SetLearnedCombatSkills(combatSkills, context);
			DomainManager.Extra.RemoveCharacterEquippedCombatSkills(context, inheritorCharId);
			DomainManager.Extra.RemoveCharacterCombatSkillConfiguration(context, inheritorCharId);
			DomainManager.CombatSkill.RemoveAllCombatSkills(inheritorCharId);
			inheritor.SetLovingItemRevealed(true, context);
			inheritor.SetHatingItemRevealed(true, context);
			inheritor.RemoveFeatureGroup(context, 204);
			List<short> featureIds = inheritor.GetFeatureIds();
			for (sbyte combatSkillType = 0; combatSkillType < 14; combatSkillType += 1)
			{
				CombatSkillTypeItem combatSkillTypeCfg = Config.CombatSkillType.Instance[combatSkillType];
				featureIds.Remove(combatSkillTypeCfg.LegendaryBookFeature);
			}
			inheritor.SetFeatureIds(featureIds, context);
			this.ClearDebtsToTaiwu(context);
			int kidnapperId = inheritor.GetKidnapperId();
			bool flag = kidnapperId >= 0;
			if (flag)
			{
				this.RemoveKidnappedCharacter(context, inheritorCharId, kidnapperId, true);
			}
			bool flag2 = taiwu != null;
			if (flag2)
			{
				DomainManager.Character.DirectlySetFavorabilities(context, taiwu.GetId(), inheritorCharId, 30000, 30000);
			}
		}

		// Token: 0x06007108 RID: 28936 RVA: 0x0040E328 File Offset: 0x0040C528
		public void TestAddPregnantState(DataContext context, Character mother, Character father)
		{
			PregnantState state = new PregnantState(mother, father, false);
			this.AddElement_PregnantStates(mother.GetId(), state, context);
		}

		// Token: 0x06007109 RID: 28937 RVA: 0x0040E350 File Offset: 0x0040C550
		public void GetTaiwuVillageDeadCharacter(HashSet<int> resultSet)
		{
			foreach (KeyValuePair<int, DeadCharacter> keyValuePair in this._deadCharacters)
			{
				int num;
				DeadCharacter deadCharacter;
				keyValuePair.Deconstruct(out num, out deadCharacter);
				int charId = num;
				DeadCharacter deadChar = deadCharacter;
				bool flag = deadChar.OrganizationInfo.OrgTemplateId == 16;
				if (flag)
				{
					resultSet.Add(charId);
				}
			}
		}

		// Token: 0x0600710A RID: 28938 RVA: 0x0040E3D4 File Offset: 0x0040C5D4
		private void RemoveNonBuryableItemsInInventory(DataContext context, Character character, Location location)
		{
			List<ItemKey> itemsToRemove = ObjectPool<List<ItemKey>>.Instance.Get();
			List<MapBlockData> nearbyBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
			DomainManager.Map.GetRealNeighborBlocks(location.AreaId, location.BlockId, nearbyBlocks, 2, true);
			itemsToRemove.Clear();
			Inventory inventory = character.GetInventory();
			int charId = character.GetId();
			foreach (KeyValuePair<ItemKey, int> keyValuePair in inventory.Items)
			{
				ItemKey itemKey3;
				int num;
				keyValuePair.Deconstruct(out itemKey3, out num);
				ItemKey itemKey = itemKey3;
				bool flag = itemKey.ItemType == 11;
				if (flag)
				{
					MapBlockData block = nearbyBlocks[context.Random.Next(nearbyBlocks.Count)];
					DomainManager.Item.RemoveOwner(itemKey, ItemOwnerType.CharacterInventory, charId);
					DomainManager.Map.AddBlockItem(context, block, itemKey, 1);
					itemsToRemove.Add(itemKey);
				}
				else
				{
					bool flag2 = itemKey.ItemType == 4 && ItemTemplateHelper.GetResourceType(itemKey.ItemType, itemKey.TemplateId) == 0;
					if (flag2)
					{
						MapBlockData block2 = nearbyBlocks[context.Random.Next(nearbyBlocks.Count)];
						DomainManager.Item.RemoveOwner(itemKey, ItemOwnerType.CharacterInventory, charId);
						DomainManager.Map.AddBlockItem(context, block2, itemKey, 1);
						itemsToRemove.Add(itemKey);
					}
					else
					{
						bool flag3 = !ItemDomain.CanItemBeLost(itemKey);
						if (flag3)
						{
							DomainManager.Item.RemoveItem(context, itemKey);
							itemsToRemove.Add(itemKey);
						}
					}
				}
			}
			foreach (ItemKey itemKey2 in itemsToRemove)
			{
				inventory.OfflineRemove(itemKey2);
			}
			ObjectPool<List<ItemKey>>.Instance.Return(itemsToRemove);
			ObjectPool<List<MapBlockData>>.Instance.Return(nearbyBlocks);
		}

		// Token: 0x0600710B RID: 28939 RVA: 0x0040E5E8 File Offset: 0x0040C7E8
		private void ResetEquippedItemCharId(DataContext context, Character character)
		{
			foreach (ItemKey itemKey in character.GetEquipment())
			{
				bool flag = !itemKey.IsValid();
				if (!flag)
				{
					EquipmentBase item = DomainManager.Item.GetBaseEquipment(itemKey);
					item.SetEquippedCharId(-1, context);
				}
			}
		}

		// Token: 0x0600710C RID: 28940 RVA: 0x0040E644 File Offset: 0x0040C844
		private void HandleLoveToken(DataContext context, Character character)
		{
			bool flag = !InteractOfLove.IsInstalled();
			if (!flag)
			{
				int charId = character.GetId();
				bool isInGroup = DomainManager.Taiwu.IsInGroup(charId);
				bool isLover = DomainManager.Extra.IsTaiwuLover(charId);
				Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
				bool isKidnappedByTaiwu = character.GetKidnapperId() == taiwuChar.GetId();
				List<ItemKey> loveTokenList = ObjectPool<List<ItemKey>>.Instance.Get();
				foreach (KeyValuePair<ItemKey, int> keyValuePair in character.GetInventory().Items)
				{
					ItemKey itemKey4;
					int num;
					keyValuePair.Deconstruct(out itemKey4, out num);
					ItemKey itemKey = itemKey4;
					bool flag2 = ModificationStateHelper.IsActive(itemKey.ModificationState, 4);
					if (flag2)
					{
						loveTokenList.Add(itemKey);
					}
				}
				bool flag3 = isLover && (isInGroup || isKidnappedByTaiwu);
				if (flag3)
				{
					foreach (ItemKey itemKey2 in loveTokenList)
					{
						DomainManager.Character.TransferInventoryItem(context, character, taiwuChar, itemKey2, 1);
						InteractOfLove.SetLoveTokenHolder(context, itemKey2, taiwuChar.GetId());
					}
				}
				else
				{
					foreach (ItemKey itemKey3 in loveTokenList)
					{
						DomainManager.Extra.RemoveLoveTokenData(context, itemKey3, false);
					}
				}
				ObjectPool<List<ItemKey>>.Instance.Return(loveTokenList);
			}
		}

		// Token: 0x0600710D RID: 28941 RVA: 0x0040E7EC File Offset: 0x0040C9EC
		private void RecordGraveRemoved(DataContext context, int charId)
		{
			DeadCharDeletionState state;
			bool flag = this._deadCharDeletionStates.TryGetValue(charId, out state);
			if (flag)
			{
				state.GraveRemoved = true;
				this.SetElement_DeadCharDeletionStates(charId, state, context);
			}
			else
			{
				state.GraveRemoved = true;
				this.AddElement_DeadCharDeletionStates(charId, state, context);
			}
		}

		// Token: 0x0600710E RID: 28942 RVA: 0x0040E838 File Offset: 0x0040CA38
		public void GetAllWaitingReincarnationCharIds(HashSet<int> charIds)
		{
			charIds.Clear();
			foreach (IntPair pair in this._waitingReincarnationChars.Collection)
			{
				charIds.Add(pair.Second);
			}
		}

		// Token: 0x0600710F RID: 28943 RVA: 0x0040E8A0 File Offset: 0x0040CAA0
		private int PickReincarnationChar(DataContext context, int birthDate, int presetReincarnationCharId = -1, bool disableSavedSoul = false)
		{
			bool flag = presetReincarnationCharId == -2;
			int result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				SortedSet<IntPair> waitingReincarnationChars = this._waitingReincarnationChars.Collection;
				bool flag2 = waitingReincarnationChars.Count <= 0;
				if (flag2)
				{
					bool flag3 = context.Random.CheckPercentProb((int)GlobalConfig.Instance.AnimalSamsaraChance);
					if (flag3)
					{
						result = this.CreateDeadAnimal(context, birthDate - 7);
					}
					else
					{
						result = -1;
					}
				}
				else
				{
					IntPair min = waitingReincarnationChars.Min;
					int charId = -1;
					ProfessionData buddhistProfessionData = DomainManager.Extra.GetProfessionData(6);
					BuddhistMonkSkillsData buddhistSkillsData = buddhistProfessionData.GetSkillsData<BuddhistMonkSkillsData>();
					bool flag4 = presetReincarnationCharId >= 0;
					if (flag4)
					{
						foreach (IntPair pair in waitingReincarnationChars)
						{
							bool flag5 = pair.Second != presetReincarnationCharId;
							if (!flag5)
							{
								min = pair;
								charId = pair.Second;
								break;
							}
						}
					}
					else
					{
						bool flag6 = context.Random.CheckPercentProb((int)GlobalConfig.Instance.AnimalSamsaraChance);
						if (flag6)
						{
							return this.CreateDeadAnimal(context, birthDate - 7);
						}
						foreach (IntPair pair2 in waitingReincarnationChars)
						{
							int waitingCharId = pair2.Second;
							bool flag7 = pair2.First + 7 > birthDate;
							if (flag7)
							{
								return -1;
							}
							bool flag8 = DomainManager.Building.IsCharOnSamsaraPlatform(waitingCharId, true);
							if (!flag8)
							{
								bool flag9 = buddhistSkillsData.IsDirectedSamsaraCharacter(waitingCharId);
								if (!flag9)
								{
									bool flag10 = DomainManager.Extra.IsSavedSoul(waitingCharId) && disableSavedSoul;
									if (!flag10)
									{
										min = pair2;
										charId = waitingCharId;
										break;
									}
								}
							}
						}
					}
					bool flag11 = charId < 0;
					if (flag11)
					{
						result = -1;
					}
					else
					{
						this.RemoveElement_WaitingReincarnationChars(min, context);
						result = charId;
					}
				}
			}
			return result;
		}

		// Token: 0x06007110 RID: 28944 RVA: 0x0040EA94 File Offset: 0x0040CC94
		private int CreateDeadAnimal(DataContext context, int deathDate)
		{
			int charId = this.GenerateNextObjectId(context);
			short animalTemplateId = GameData.Domains.Map.SharedConstValue.AnimalCharIdGroups.GetRandom(context.Random).GetRandom(context.Random);
			DeadCharacter deadChar = DeadCharacterHelper.CreateDeadCharacter(context.Random, animalTemplateId, deathDate);
			deadChar.FeatureIds.Clear();
			deadChar.FeatureIds.AddRange(Character.Instance[animalTemplateId].FeatureIds);
			this.AddElement_DeadCharacters(charId, deadChar, context);
			return charId;
		}

		// Token: 0x06007111 RID: 28945 RVA: 0x0040EB0C File Offset: 0x0040CD0C
		[DomainMethod]
		public Debts GetDebts(int targetCharId)
		{
			Debts debts;
			return this._debtsToTaiwu.TryGetValue(targetCharId, out debts) ? debts : null;
		}

		// Token: 0x06007112 RID: 28946 RVA: 0x0040EB34 File Offset: 0x0040CD34
		public void DirectlyAddDebt(DataContext context, int targetCharId, long worth, bool isEquivalent)
		{
			Debts debts = DomainManager.Character.GetDebts(targetCharId);
			bool flag = debts == null;
			if (flag)
			{
				debts = new Debts();
				if (isEquivalent)
				{
					debts.LendEquivalentToTaiwu(worth);
				}
				else
				{
					debts.LendNonequivalentToTaiwu(worth, 1);
				}
				DomainManager.Character.AddElement_DebtsToTaiwu(targetCharId, debts, context);
			}
			else
			{
				if (isEquivalent)
				{
					debts.LendEquivalentToTaiwu(worth);
				}
				else
				{
					debts.LendNonequivalentToTaiwu(worth, 1);
				}
				this.SetElement_DebtsToTaiwu(targetCharId, debts, context);
			}
		}

		// Token: 0x06007113 RID: 28947 RVA: 0x0040EBAC File Offset: 0x0040CDAC
		public void DirectlyReduceDebt(DataContext context, int targetCharId, long worth, bool isEquivalent)
		{
			Debts debts = DomainManager.Character.GetDebts(targetCharId);
			bool flag = debts == null;
			if (!flag)
			{
				if (isEquivalent)
				{
					debts.BorrowEquivalentFromTaiwu(worth);
				}
				else
				{
					debts.BorrowNonequivalentFromTaiwu(worth, 1);
				}
				this.SetElement_DebtsToTaiwu(targetCharId, debts, context);
			}
		}

		// Token: 0x06007114 RID: 28948 RVA: 0x0040EBF4 File Offset: 0x0040CDF4
		public void LendResourceToTaiwu(DataContext context, Character character, long worth)
		{
			int charId = character.GetId();
			Debts debts;
			bool flag = !this._debtsToTaiwu.TryGetValue(charId, out debts);
			if (flag)
			{
				debts = new Debts();
				debts.LendEquivalentToTaiwu(worth);
				this.AddElement_DebtsToTaiwu(charId, debts, context);
			}
			else
			{
				debts.LendEquivalentToTaiwu(worth);
				this.SetElement_DebtsToTaiwu(charId, debts, context);
			}
		}

		// Token: 0x06007115 RID: 28949 RVA: 0x0040EC50 File Offset: 0x0040CE50
		public void BorrowResourceFromTaiwu(DataContext context, Character character, long worth)
		{
			int charId = character.GetId();
			Debts debts;
			bool flag = !this._debtsToTaiwu.TryGetValue(charId, out debts);
			if (flag)
			{
				debts = new Debts();
				debts.BorrowEquivalentFromTaiwu(worth);
				this.AddElement_DebtsToTaiwu(charId, debts, context);
			}
			else
			{
				debts.BorrowEquivalentFromTaiwu(worth);
				this.SetElement_DebtsToTaiwu(charId, debts, context);
			}
		}

		// Token: 0x06007116 RID: 28950 RVA: 0x0040ECAC File Offset: 0x0040CEAC
		public void LendItemToTaiwu(DataContext context, Character character, ItemKey itemKey, int amount)
		{
			int charId = character.GetId();
			long worth = Debts.ItemToWorth(itemKey.ItemType, itemKey.TemplateId);
			bool flag = worth == 0L;
			if (!flag)
			{
				Debts debts;
				bool flag2 = !this._debtsToTaiwu.TryGetValue(charId, out debts);
				if (flag2)
				{
					debts = new Debts();
					debts.LendNonequivalentToTaiwu(worth, amount);
					this.AddElement_DebtsToTaiwu(charId, debts, context);
				}
				else
				{
					debts.LendNonequivalentToTaiwu(worth, amount);
					this.SetElement_DebtsToTaiwu(charId, debts, context);
				}
			}
		}

		// Token: 0x06007117 RID: 28951 RVA: 0x0040ED2C File Offset: 0x0040CF2C
		public void LendItemListToTaiwu(DataContext context, Character character, List<ItemKey> keyList)
		{
			Tester.Assert(keyList != null, "");
			foreach (ItemKey key in keyList)
			{
				this.LendItemToTaiwu(context, character, key, 1);
			}
		}

		// Token: 0x06007118 RID: 28952 RVA: 0x0040ED90 File Offset: 0x0040CF90
		public void BorrowItemFromTaiwu(DataContext context, Character character, ItemKey itemKey, int amount)
		{
			int charId = character.GetId();
			ItemBase item = DomainManager.Item.GetBaseItem(itemKey);
			long worth = Debts.ItemToWorth(itemKey.ItemType, itemKey.TemplateId);
			bool flag = worth == 0L;
			if (!flag)
			{
				Debts debts;
				bool flag2 = !this._debtsToTaiwu.TryGetValue(charId, out debts);
				if (flag2)
				{
					debts = new Debts();
					debts.BorrowNonequivalentFromTaiwu(worth, amount);
					this.AddElement_DebtsToTaiwu(charId, debts, context);
				}
				else
				{
					debts.BorrowNonequivalentFromTaiwu(worth, amount);
					this.SetElement_DebtsToTaiwu(charId, debts, context);
				}
			}
		}

		// Token: 0x06007119 RID: 28953 RVA: 0x0040EE1C File Offset: 0x0040D01C
		public void BorrowItemListFromTaiwu(DataContext context, Character character, List<ItemKey> keyList)
		{
			Tester.Assert(keyList != null, "");
			Tester.Assert(keyList.Count > 0, "");
			foreach (ItemKey key in keyList)
			{
				this.BorrowItemFromTaiwu(context, character, key, 1);
			}
		}

		// Token: 0x0600711A RID: 28954 RVA: 0x0040EE94 File Offset: 0x0040D094
		public short CalcMaxFavorabilityToTaiwu(Character character)
		{
			Debts debts;
			bool flag = !this._debtsToTaiwu.TryGetValue(character.GetId(), out debts);
			short result;
			if (flag)
			{
				result = 30000;
			}
			else
			{
				int decrement = CharacterDomain.CalcMaxFavorabilityDecrementToTaiwu(character, debts);
				result = (short)Math.Max(30000 - decrement, -30000);
			}
			return result;
		}

		// Token: 0x0600711B RID: 28955 RVA: 0x0040EEE4 File Offset: 0x0040D0E4
		[DomainMethod]
		public short CalcMaxFavorabilityToTaiwuById(int charId)
		{
			Character character;
			bool flag = this.TryGetElement_Objects(charId, out character);
			short result;
			if (flag)
			{
				Debts debts;
				bool flag2 = !this._debtsToTaiwu.TryGetValue(character.GetId(), out debts);
				if (flag2)
				{
					result = 30000;
				}
				else
				{
					result = debts.GetMaxFavorabilityWithDebt();
				}
			}
			else
			{
				result = 30000;
			}
			return result;
		}

		// Token: 0x0600711C RID: 28956 RVA: 0x0040EF38 File Offset: 0x0040D138
		[DomainMethod]
		public long GetMaxWorthCanBeLentToTaiwu(int charId)
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			bool flag = charId == taiwuCharId;
			long result;
			if (flag)
			{
				result = 0L;
			}
			else
			{
				RelationKey relationKey = new RelationKey(charId, taiwuCharId);
				RelatedCharacter relation;
				bool flag2 = !this._relations.TryGetValue(relationKey, out relation);
				if (flag2)
				{
					result = 0L;
				}
				else
				{
					short favor = relation.Favorability;
					int consumableFavor = (int)(favor - GlobalConfig.Instance.MinFavorabilityAfterTransferring);
					bool flag3 = consumableFavor <= 0;
					if (flag3)
					{
						result = 0L;
					}
					else
					{
						Character character = this._objects[charId];
						short maxFavor = this.CalcMaxFavorabilityToTaiwu(character);
						int consumableMaxFavor = (int)(maxFavor - GlobalConfig.Instance.MinFavorabilityAfterTransferring);
						bool flag4 = consumableMaxFavor <= 0;
						if (flag4)
						{
							result = 0L;
						}
						else
						{
							long maxWorthForFavor = (long)consumableFavor * 10L;
							long maxWorthForMaxFavor = (long)consumableMaxFavor * 10L;
							result = Math.Min(maxWorthForFavor, maxWorthForMaxFavor);
						}
					}
				}
			}
			return result;
		}

		// Token: 0x0600711D RID: 28957 RVA: 0x0040F014 File Offset: 0x0040D214
		[DomainMethod]
		[return: TupleElementNames(new string[]
		{
			"debtChangeType",
			"favorLevelChangeType"
		})]
		public ValueTuple<sbyte, short> CheckDebtChange(int charId, ResourceInts resources)
		{
			Debts debts = this.GetDebts(charId);
			bool flag = debts != null;
			if (flag)
			{
				Serializer.CopyTo<Debts>(ref debts, ref CharacterDomain._tmpDebts);
			}
			else
			{
				CharacterDomain._tmpDebts.Clear();
			}
			for (sbyte resourceType = 0; resourceType < 8; resourceType += 1)
			{
				int resourceAmount = resources.Get((int)resourceType);
				long worth = Debts.ResourceAmountToWorth((short)resourceType, Math.Abs(resourceAmount));
				bool flag2 = worth <= 0L;
				if (!flag2)
				{
					bool flag3 = resourceAmount > 0;
					if (flag3)
					{
						CharacterDomain._tmpDebts.BorrowEquivalentFromTaiwu(worth);
					}
					else
					{
						CharacterDomain._tmpDebts.LendEquivalentToTaiwu(worth);
					}
				}
			}
			long totalWorthBefore = (debts != null) ? debts.Equivalent : 0L;
			long totalWorthAfter = CharacterDomain._tmpDebts.Equivalent;
			int favorChange = 0;
			ValueTuple<long, long> resourcesWorth = CharacterDomain.GetResourcesWorth(ref resources);
			long borrowedWorth = resourcesWorth.Item1;
			long lentWorth = resourcesWorth.Item2;
			bool isAdd = borrowedWorth > lentWorth;
			long diff = Math.Abs(borrowedWorth - lentWorth);
			int resourceFavorChange = (int)AiHelper.GeneralActionConstants.GetResourceFavorabilityChange(6, (int)Math.Clamp(diff, 0L, 2147483647L));
			bool flag4 = !isAdd;
			if (flag4)
			{
				resourceFavorChange = -resourceFavorChange;
			}
			favorChange += resourceFavorChange;
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			short srcFavor = this.GetFavorability(charId, taiwuCharId);
			short dstFavor = (short)Math.Clamp((int)srcFavor + favorChange, -30000, (int)CharacterDomain._tmpDebts.GetMaxFavorabilityWithDebt());
			bool flag5 = totalWorthAfter > totalWorthBefore;
			ValueTuple<sbyte, short> result;
			if (flag5)
			{
				result = new ValueTuple<sbyte, short>(0, dstFavor);
			}
			else
			{
				bool flag6 = totalWorthAfter < totalWorthBefore && totalWorthAfter < 0L;
				if (flag6)
				{
					result = new ValueTuple<sbyte, short>(4, dstFavor);
				}
				else
				{
					bool flag7 = totalWorthAfter == totalWorthBefore;
					if (flag7)
					{
						result = new ValueTuple<sbyte, short>(1, dstFavor);
					}
					else
					{
						bool flag8 = totalWorthAfter == 0L;
						if (flag8)
						{
							result = new ValueTuple<sbyte, short>(3, dstFavor);
						}
						else
						{
							result = new ValueTuple<sbyte, short>(2, dstFavor);
						}
					}
				}
			}
			return result;
		}

		// Token: 0x0600711E RID: 28958 RVA: 0x0040F1D0 File Offset: 0x0040D3D0
		[DomainMethod]
		public bool CheckFavorabilityBeforeTransferring(int charId, ResourceInts resources)
		{
			Character character = this._objects[charId];
			sbyte grade = character.GetOrganizationInfo().Grade;
			short gradeFactor = GlobalConfig.Instance.WorthFactorsOfGrade[(int)grade];
			sbyte behaviorType = character.GetBehaviorType();
			short behaviorTypeFactorOfIncrement = CharacterDomain.FavorIncrementPercentsOfDebt[(int)behaviorType];
			short behaviorTypeFactorOfDecrement = CharacterDomain.FavorDecrementPercentsOfDebt[(int)behaviorType];
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			RelationKey relationKey = new RelationKey(charId, taiwuCharId);
			RelatedCharacter relation = this._relations[relationKey];
			int oriFavor = (int)relation.Favorability;
			Debts debts;
			bool flag = this._debtsToTaiwu.TryGetValue(character.GetId(), out debts);
			long totalWorthLentToTaiwu;
			int oriMaxFavor;
			if (flag)
			{
				totalWorthLentToTaiwu = debts.GetTotalWorthLentToTaiwu();
				int decrement = (int)Math.Clamp(totalWorthLentToTaiwu / (long)gradeFactor, -2147483648L, 2147483647L);
				oriMaxFavor = Math.Max(30000 - decrement, -30000);
			}
			else
			{
				totalWorthLentToTaiwu = 0L;
				oriMaxFavor = 30000;
			}
			ValueTuple<long, long> resourcesWorth = CharacterDomain.GetResourcesWorth(ref resources);
			long borrowedWorth = resourcesWorth.Item1;
			long lentWorth = resourcesWorth.Item2;
			long favorIncrement = borrowedWorth / (long)gradeFactor * (long)behaviorTypeFactorOfIncrement / 100L;
			long favorDecrement = lentWorth / (long)gradeFactor * (long)behaviorTypeFactorOfDecrement / 100L;
			short currFavor = (short)Math.Clamp((long)oriFavor + favorIncrement - favorDecrement, -30000L, 30000L);
			bool flag2 = (int)currFavor < oriFavor && currFavor < GlobalConfig.Instance.MinFavorabilityAfterTransferring;
			bool result;
			if (flag2)
			{
				result = false;
			}
			else
			{
				totalWorthLentToTaiwu += lentWorth - borrowedWorth;
				bool flag3 = totalWorthLentToTaiwu > 0L;
				if (flag3)
				{
					int decrement2 = (int)Math.Clamp(totalWorthLentToTaiwu / (long)gradeFactor, -2147483648L, 2147483647L);
					int currMaxFavor = Math.Max(30000 - decrement2, -30000);
					bool flag4 = currMaxFavor < oriMaxFavor && currMaxFavor < (int)GlobalConfig.Instance.MinFavorabilityAfterTransferring;
					if (flag4)
					{
						return false;
					}
				}
				result = true;
			}
			return result;
		}

		// Token: 0x0600711F RID: 28959 RVA: 0x0040F38C File Offset: 0x0040D58C
		public bool CheckFavorabilityAfterTransferring(Character character, short oriFavor, short oriMaxFavor)
		{
			ValueTuple<short, short> favorAndMaxFavorToTaiwu = this.GetFavorAndMaxFavorToTaiwu(character);
			short currFavor = favorAndMaxFavorToTaiwu.Item1;
			short currMaxFavor = favorAndMaxFavorToTaiwu.Item2;
			bool flag = currFavor < oriFavor && currFavor < GlobalConfig.Instance.MinFavorabilityAfterTransferring;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = currMaxFavor < oriMaxFavor && currMaxFavor < GlobalConfig.Instance.MinFavorabilityAfterTransferring;
				result = !flag2;
			}
			return result;
		}

		// Token: 0x06007120 RID: 28960 RVA: 0x0040F3F0 File Offset: 0x0040D5F0
		private static int CalcMaxFavorabilityDecrementToTaiwu(Character character, Debts debts)
		{
			long worth = debts.GetTotalWorthLentToTaiwu();
			long favor = worth / 10L;
			return (int)Math.Clamp(favor, -2147483648L, 2147483647L);
		}

		// Token: 0x06007121 RID: 28961 RVA: 0x0040F424 File Offset: 0x0040D624
		[return: TupleElementNames(new string[]
		{
			"favor",
			"maxFavor"
		})]
		private ValueTuple<short, short> GetFavorAndMaxFavorToTaiwu(Character character)
		{
			int charId = character.GetId();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			RelationKey relationKey = new RelationKey(charId, taiwuCharId);
			RelatedCharacter relation = this._relations[relationKey];
			short favor = relation.Favorability;
			short maxFavor = this.CalcMaxFavorabilityToTaiwu(character);
			return new ValueTuple<short, short>(favor, maxFavor);
		}

		// Token: 0x06007122 RID: 28962 RVA: 0x0040F47C File Offset: 0x0040D67C
		[DomainMethod]
		public short GetClothingDisplayId(int charId)
		{
			Character character;
			bool flag = this._objects.TryGetValue(charId, out character);
			short result;
			if (flag)
			{
				result = character.GetClothingDisplayId();
			}
			else
			{
				DeadCharacter deadChar;
				bool flag2 = this._deadCharacters.TryGetValue(charId, out deadChar);
				if (flag2)
				{
					result = deadChar.ClothingDisplayId;
				}
				else
				{
					result = 0;
				}
			}
			return result;
		}

		// Token: 0x06007123 RID: 28963 RVA: 0x0040F4C8 File Offset: 0x0040D6C8
		[DomainMethod]
		public List<CharacterDisplayData> GetCharacterDisplayDataList(List<int> charIdList)
		{
			List<CharacterDisplayData> dataList = new List<CharacterDisplayData>();
			bool flag = charIdList == null;
			List<CharacterDisplayData> result;
			if (flag)
			{
				result = dataList;
			}
			else
			{
				foreach (int charId in charIdList)
				{
					CharacterDisplayData data = this.GetCharacterDisplayData(charId);
					dataList.Add(data);
				}
				result = dataList;
			}
			return result;
		}

		// Token: 0x06007124 RID: 28964 RVA: 0x0040F540 File Offset: 0x0040D740
		[DomainMethod]
		public List<AvatarRelatedData> GetAvatarRelatedDataList(List<int> charIdList)
		{
			List<AvatarRelatedData> dataList = new List<AvatarRelatedData>();
			for (int i = 0; i < charIdList.Count; i++)
			{
				dataList.Add(this.GetElement_Objects(charIdList[i]).GenerateAvatarRelatedData());
			}
			return dataList;
		}

		// Token: 0x06007125 RID: 28965 RVA: 0x0040F588 File Offset: 0x0040D788
		[DomainMethod]
		public AvatarRelatedData GetAvatarRelatedData(int charId)
		{
			return this.GetElement_Objects(charId).GenerateAvatarRelatedData();
		}

		// Token: 0x06007126 RID: 28966 RVA: 0x0040F5A8 File Offset: 0x0040D7A8
		[DomainMethod]
		public List<short> GetCharacterLifeSkillAttainmentList(List<int> charIdList, sbyte lifeSkillType)
		{
			List<short> lifeSkillAttainmentList = new List<short>();
			bool flag = charIdList != null;
			if (flag)
			{
				foreach (int charId in charIdList)
				{
					lifeSkillAttainmentList.Add(this._objects[charId].GetLifeSkillAttainment(lifeSkillType));
				}
			}
			return lifeSkillAttainmentList;
		}

		// Token: 0x06007127 RID: 28967 RVA: 0x0040F620 File Offset: 0x0040D820
		private CharacterDisplayData GetCharacterDisplayDataWithPotentialSuccessor(int charId, bool calcSuccessor)
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			bool flag = this._objects.ContainsKey(charId);
			CharacterDisplayData data;
			if (flag)
			{
				Character character = this.GetElement_Objects(charId);
				OrganizationInfo orgInfo = character.GetOrganizationInfo();
				bool isCompletelyInfected = character.IsCompletelyInfected();
				data = new CharacterDisplayData
				{
					CharacterId = charId,
					TemplateId = character.GetTemplateId(),
					CreatingType = character.GetCreatingType(),
					Gender = character.GetGender(),
					FullName = character.GetFullName(),
					MonkType = character.GetMonkType(),
					MonasticTitle = character.GetMonasticTitle(),
					AvatarRelatedData = character.GenerateAvatarRelatedData(),
					PhysiologicalAge = character.GetPhysiologicalAge(),
					CurrAge = character.GetCurrAge(),
					OrgInfo = orgInfo,
					BehaviorType = character.GetBehaviorType(),
					FameType = character.GetFameType(),
					FavorabilityToTaiwu = this.GetFavorability(charId, taiwuCharId),
					TitleIds = new List<short>(),
					CompletelyInfected = isCompletelyInfected,
					ValidKidnapSlotCount = (byte)character.GetKidnapMaxSlotCount(),
					AliveState = 0,
					Location = character.GetLocation(),
					BirthDate = character.GetBirthDate(),
					ExternalRelationState = character.GetExternalRelationState(),
					LegendaryBookOwnerState = character.GetLegendaryBookOwnerState(),
					CustomDisplayNameId = DomainManager.Extra.GetCharacterCustomDisplayName(charId),
					CanNotSpeak = character.CanNotSpeak,
					IsFollowedByTaiwu = DomainManager.Taiwu.IsCharacterFollowedByTaiwu(charId),
					NickNameId = DomainManager.Taiwu.GetFollowingNpcNickNameId(charId),
					ExtraNameTextTemplateId = character.GetExtraNameTextTemplateId(),
					IdealSect = character.GetIdealSect(),
					DarkAshProtector = character.GetDarkAshProtector(),
					DarkAshCounter = character.GetDarkAshCounter(),
					Happiness = character.GetHappiness()
				};
				SettlementCharacter settlementChar;
				bool flag2 = calcSuccessor && character.GetOrganizationInfo().SettlementId >= 0 && DomainManager.Organization.TryGetSettlementCharacter(charId, out settlementChar);
				if (flag2)
				{
					data.IsApproveTaiwu = settlementChar.GetApprovedTaiwu();
					data.ApproveTaiwu = settlementChar.GetApprovingRate();
					data.InfluencePower = settlementChar.GetInfluencePower();
					short settlementId = settlementChar.GetSettlementId();
					SettlementTreasury settlementTreasury = DomainManager.Organization.GetTreasury(character.GetOrganizationInfo());
					data.Contribution = settlementTreasury.GetMemberContribution(character);
					data.ContributionPerMonth = character.GetContributionPerMonth();
					data.SettlementTreasuryGuardInfo = DomainManager.Organization.CharacterTreasuryGuardInfo(charId);
					bool flag3 = settlementId >= 0;
					if (flag3)
					{
						Settlement settlement = DomainManager.Organization.GetSettlement(settlementId);
						ObjectPool<List<int>> pool = ObjectPool<List<int>>.Instance;
						List<int> successors = pool.Get();
						OrganizationInfo actualOrgInfo = orgInfo;
						actualOrgInfo.SettlementId = settlementId;
						successors.Clear();
						settlement.GetOrganizationMemberPotentialSuccessorsForDisplay(charId, actualOrgInfo, successors);
						bool flag4 = successors.Count > 0;
						if (flag4)
						{
							data.OrganizationMemberPotentialSuccessor = this.GetCharacterDisplayDataWithPotentialSuccessor(successors[0], false);
						}
						pool.Return(successors);
					}
				}
				character.GetTitles(data.TitleIds);
				data.BountyPunishmentSeverity = -1;
				sbyte sectOrgTemplateId;
				SettlementBounty settlementBounty = DomainManager.Organization.GetBounty(charId, out sectOrgTemplateId);
				bool flag5 = settlementBounty != null;
				if (flag5)
				{
					data.BountyPunishmentSeverity = settlementBounty.PunishmentSeverity;
					data.BountyOrgTemplate = sectOrgTemplateId;
				}
			}
			else
			{
				bool flag6 = this._deadCharacters.ContainsKey(charId);
				if (flag6)
				{
					DeadCharacter charData = this._deadCharacters[charId];
					Grave grave;
					data = new CharacterDisplayData
					{
						CharacterId = charId,
						TemplateId = charData.TemplateId,
						Gender = charData.Gender,
						CurrAge = charData.CurrAge,
						FullName = charData.FullName,
						MonkType = charData.MonkType,
						MonasticTitle = charData.MonasticTitle,
						AvatarRelatedData = charData.GenerateAvatarRelatedData(),
						OrgInfo = charData.OrganizationInfo,
						BehaviorType = BehaviorType.GetBehaviorType(charData.Morality),
						FameType = charData.FameType,
						FavorabilityToTaiwu = this.GetFavorability(charId, taiwuCharId),
						AliveState = 1,
						Location = (this._graves.TryGetValue(charId, out grave) ? grave.GetLocation() : Location.Invalid),
						BirthDate = charData.BirthDate,
						CustomDisplayNameId = DomainManager.Extra.GetCharacterCustomDisplayName(charId),
						IsFollowedByTaiwu = DomainManager.Taiwu.IsCharacterFollowedByTaiwu(charId),
						NickNameId = DomainManager.Taiwu.GetFollowingNpcNickNameId(charId),
						ExtraNameTextTemplateId = -1,
						IdealSect = -1
					};
				}
				else
				{
					data = new CharacterDisplayData
					{
						CharacterId = charId,
						AliveState = 2,
						Location = Location.Invalid,
						AvatarRelatedData = new AvatarRelatedData(),
						IsFollowedByTaiwu = DomainManager.Taiwu.IsCharacterFollowedByTaiwu(charId),
						NickNameId = DomainManager.Taiwu.GetFollowingNpcNickNameId(charId),
						IdealSect = -1
					};
					data.AvatarRelatedData.AvatarData = new AvatarData();
				}
			}
			return data;
		}

		// Token: 0x06007128 RID: 28968 RVA: 0x0040FAF1 File Offset: 0x0040DCF1
		[DomainMethod]
		public CharacterDisplayData GetCharacterDisplayData(int charId)
		{
			return this.GetCharacterDisplayDataWithPotentialSuccessor(charId, true);
		}

		// Token: 0x06007129 RID: 28969 RVA: 0x0040FAFC File Offset: 0x0040DCFC
		[DomainMethod]
		public CharacterLocationDisplayData GetCharacterLocationDisplayData(int charId)
		{
			CharacterDomain.<>c__DisplayClass306_0 CS$<>8__locals1;
			CS$<>8__locals1.result = new CharacterLocationDisplayData();
			CS$<>8__locals1.result.CharacterId = charId;
			CS$<>8__locals1.result.IsCapturedInStoneRoom = false;
			bool flag = this._objects.ContainsKey(charId);
			if (flag)
			{
				CS$<>8__locals1.result.DisplayType = 0;
				Character character = this.GetElement_Objects(charId);
				Location location = character.GetLocation();
				CS$<>8__locals1.result.Location = location;
				int kidnapperId = character.GetKidnapperId();
				bool flag2 = kidnapperId >= 0;
				if (flag2)
				{
					CS$<>8__locals1.result.DisplayType = 1;
					CS$<>8__locals1.result.Kidnapper = this.GetCharacterDisplayData(kidnapperId);
					CS$<>8__locals1.result.Location = CS$<>8__locals1.result.Kidnapper.Location;
				}
				bool flag3 = character.IsActiveExternalRelationState(4);
				if (flag3)
				{
					AdventureSiteData adventureSite = DomainManager.Adventure.GetAdventureSite(location.AreaId, location.BlockId);
					CS$<>8__locals1.result.AdventureSite = adventureSite;
				}
				else
				{
					bool flag4 = character.IsActiveExternalRelationState(32);
					if (flag4)
					{
						sbyte orgTemplateId = DomainManager.Organization.GetPrisonerSect(character.GetId());
						Settlement settlement = DomainManager.Organization.GetSettlementByOrgTemplateId(orgTemplateId);
						CS$<>8__locals1.result.Location = settlement.GetLocation();
					}
				}
				byte externRelation = character.GetExternalRelationState();
				CS$<>8__locals1.result.IsCapturedInStoneRoom = ExternalRelationStateHelper.IsActive(externRelation, 8);
				CharacterDomain.<GetCharacterLocationDisplayData>g__GetBlockData|306_0(ref CS$<>8__locals1);
				bool flag5 = CS$<>8__locals1.result.AdventureSite == null;
				if (flag5)
				{
					CS$<>8__locals1.result.AdventureSite = new AdventureSiteData
					{
						TemplateId = -1
					};
				}
				else
				{
					CS$<>8__locals1.result.DisplayType = 2;
				}
				CS$<>8__locals1.result.FullBlockName = DomainManager.Map.GetBlockFullName(CS$<>8__locals1.result.Location);
			}
			else
			{
				bool flag6 = this._deadCharacters.ContainsKey(charId);
				if (flag6)
				{
					CS$<>8__locals1.result.DisplayType = 3;
					Grave grave;
					CS$<>8__locals1.result.Location = (this._graves.TryGetValue(charId, out grave) ? grave.GetLocation() : Location.Invalid);
					CS$<>8__locals1.result.FullBlockName = DomainManager.Map.GetBlockFullName(CS$<>8__locals1.result.Location);
					CharacterDomain.<GetCharacterLocationDisplayData>g__GetBlockData|306_0(ref CS$<>8__locals1);
					CS$<>8__locals1.result.AdventureSite = new AdventureSiteData
					{
						TemplateId = -1
					};
				}
				else
				{
					CS$<>8__locals1.result.DisplayType = -1;
					CS$<>8__locals1.result.Location = Location.Invalid;
					CS$<>8__locals1.result.FullBlockName = DomainManager.Map.GetBlockFullName(CS$<>8__locals1.result.Location);
					CS$<>8__locals1.result.AdventureSite = new AdventureSiteData
					{
						TemplateId = -1
					};
				}
			}
			return CS$<>8__locals1.result;
		}

		// Token: 0x0600712A RID: 28970 RVA: 0x0040FDA8 File Offset: 0x0040DFA8
		[DomainMethod]
		public CharacterDisplayDataForTooltip GetCharacterDisplayDataForTooltip(int charId)
		{
			Character character;
			bool flag = this._objects.TryGetValue(charId, out character);
			CharacterDisplayDataForTooltip result;
			if (flag)
			{
				result = this.GetCharacterDisplayDataForTooltip(character);
			}
			else
			{
				Logger logger = CharacterDomain.Logger;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(46, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Trying to get display data for dead character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
				result = null;
			}
			return result;
		}

		// Token: 0x0600712B RID: 28971 RVA: 0x0040FE0C File Offset: 0x0040E00C
		public unsafe CharacterDisplayDataForTooltip GetCharacterDisplayDataForTooltip(Character character)
		{
			int charId = character.GetId();
			bool isInteractedWithTaiwu = DomainManager.Character.IsInteractedWithTaiwu(charId);
			return new CharacterDisplayDataForTooltip
			{
				Id = character.GetId(),
				TemplateId = character.GetTemplateId(),
				CreatingType = character.GetCreatingType(),
				OrganizationInfo = character.GetOrganizationInfo(),
				Age = character.GetCurrAge(),
				FullName = character.GetFullName(),
				MonkType = character.GetMonkType(),
				MonasticTitle = character.GetMonasticTitle(),
				CustomDisplayNameId = DomainManager.Extra.GetCharacterCustomDisplayName(charId),
				BehaviorType = character.GetBehaviorType(),
				Attraction = character.GetAttraction(),
				AvatarRelatedData = character.GenerateAvatarRelatedData(),
				MainAttributes = character.GetMaxMainAttributes(),
				FeatureIds = character.GetFeatureIds(),
				Gender = character.GetGender(),
				Transgender = character.GetTransgender(),
				CombatSkillQualifications = *character.GetCombatSkillQualifications(),
				CombatSkillQualificationGrowthType = character.GetCombatSkillQualificationGrowthType(),
				LifeSkillQualifications = *character.GetLifeSkillQualifications(),
				LifeSkillQualificationGrowthType = character.GetLifeSkillQualificationGrowthType(),
				Personalities = character.GetPersonalities(),
				TeammateCommands = DomainManager.Extra.GetCharTeammateCommands(DataContextManager.GetCurrentThreadDataContext(), charId),
				NickNameId = DomainManager.Taiwu.GetFollowingNpcNickNameId(charId),
				LifeSkillAttainments = *character.GetLifeSkillAttainments(),
				FavorabilityToTaiwu = (isInteractedWithTaiwu ? DomainManager.Character.GetFavorability(charId, DomainManager.Taiwu.GetTaiwuCharId()) : short.MinValue),
				IsInteractedCharacter = isInteractedWithTaiwu
			};
		}

		// Token: 0x0600712C RID: 28972 RVA: 0x0040FFA8 File Offset: 0x0040E1A8
		[DomainMethod]
		public List<GraveDisplayData> GetTaiwuRelatedGraveDisplayDataList()
		{
			int charId = DomainManager.Taiwu.GetTaiwuCharId();
			HashSet<int> relateIds = new HashSet<int>();
			this.GetAllRelatedDeadCharIds(charId, relateIds, true);
			List<int> charIds = new List<int>();
			foreach (int id in relateIds)
			{
				charIds.Add(id);
			}
			return this.GetGraveDisplayDataList(charIds);
		}

		// Token: 0x0600712D RID: 28973 RVA: 0x0041002C File Offset: 0x0040E22C
		[DomainMethod]
		public List<GraveDisplayData> GetGraveDisplayDataList(List<int> charIdList)
		{
			List<GraveDisplayData> dataList = new List<GraveDisplayData>();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			foreach (int charId in charIdList)
			{
				DeadCharacter deadChar = this.GetElement_DeadCharacters(charId);
				Grave grave = this.GetElement_Graves(charId);
				GraveDisplayData data = new GraveDisplayData
				{
					Id = charId,
					TemplateId = deadChar.TemplateId,
					OrgSettlementId = deadChar.OrganizationInfo.SettlementId,
					Principal = deadChar.OrganizationInfo.Principal,
					Level = grave.GetLevel(),
					Durability = grave.GetDurability(),
					FavorabilityToTaiwu = this.GetFavorability(charId, taiwuCharId)
				};
				CharacterDomain.GetNameRelatedData(charId, deadChar, ref data.NameData);
				dataList.Add(data);
			}
			return dataList;
		}

		// Token: 0x0600712E RID: 28974 RVA: 0x00410128 File Offset: 0x0040E328
		[DomainMethod]
		public List<CharacterDisplayDataForRelations> GetCharacterDisplayDataListForRelations(List<int> charIds)
		{
			List<CharacterDisplayDataForRelations> collection = new List<CharacterDisplayDataForRelations>();
			bool flag = charIds == null;
			List<CharacterDisplayDataForRelations> result;
			if (flag)
			{
				result = collection;
			}
			else
			{
				int i = 0;
				int count = charIds.Count;
				while (i < count)
				{
					int charId = charIds[i];
					CharacterDisplayDataForRelations displayData = new CharacterDisplayDataForRelations
					{
						CharacterId = charId,
						NameAndLifeRelatedData = this.GetNameAndLifeRelatedData(charId)
					};
					sbyte lifeState = displayData.NameAndLifeRelatedData.LifeState;
					sbyte b = lifeState;
					if (b == 0)
					{
						Character character = this.GetElement_Objects(charId);
						displayData.AvatarRelatedData = character.GenerateAvatarRelatedData();
						displayData.Location = character.GetLocation();
						displayData.CreatingType = character.GetCreatingType();
						bool flag2 = displayData.Location.IsValid();
						if (flag2)
						{
							MapBlockData block = DomainManager.Map.GetBlock(displayData.Location);
							bool flag3 = block == null || block.CharacterSet == null || !block.CharacterSet.Contains(charId);
							if (flag3)
							{
								displayData.Location = Location.Invalid;
							}
						}
						goto IL_171;
					}
					if (b == 1)
					{
						DeadCharacter deadChar = this.GetElement_DeadCharacters(charId);
						displayData.AvatarRelatedData = deadChar.GenerateAvatarRelatedData();
						displayData.CreatingType = Character.Instance[deadChar.TemplateId].CreatingType;
						Grave grave;
						bool flag4 = this.TryGetElement_Graves(charId, out grave);
						if (flag4)
						{
							displayData.Location = grave.GetLocation();
						}
						else
						{
							displayData.Location = Location.Invalid;
						}
						goto IL_171;
					}
					IL_17B:
					i++;
					continue;
					IL_171:
					collection.Add(displayData);
					goto IL_17B;
				}
				result = collection;
			}
			return result;
		}

		// Token: 0x0600712F RID: 28975 RVA: 0x004102C8 File Offset: 0x0040E4C8
		[DomainMethod]
		public List<CharacterDisplayDataForRelations> GetCharacterDisplayDataListForRelationsWithRelationType(int currCharId, List<int> charIds)
		{
			List<CharacterDisplayDataForRelations> collection = this.GetCharacterDisplayDataListForRelations(charIds);
			for (int index = 0; index < collection.Count; index++)
			{
				CharacterDisplayDataForRelations displayData = collection[index];
				int charId = displayData.CharacterId;
				ushort relationType = this.GetRelationBetweenCharacters(charId, currCharId).Item1;
				displayData.RelationType = relationType;
				collection[index] = displayData;
			}
			return collection;
		}

		// Token: 0x06007130 RID: 28976 RVA: 0x00410330 File Offset: 0x0040E530
		public int GetKidnappedCharacterCount(int charId)
		{
			KidnappedCharacterList ret;
			return this._kidnappedChars.TryGetValue(charId, out ret) ? ret.GetCount() : 0;
		}

		// Token: 0x06007131 RID: 28977 RVA: 0x0041035C File Offset: 0x0040E55C
		[DomainMethod]
		public KidnappedCharacterList GetSomeoneKidnapCharacters(int charId)
		{
			KidnappedCharacterList ret;
			this._kidnappedChars.TryGetValue(charId, out ret);
			return ret;
		}

		// Token: 0x06007132 RID: 28978 RVA: 0x00410380 File Offset: 0x0040E580
		[DomainMethod]
		public List<KidnappedCharacterDisplayData> GetKidnappedCharacterDisplayData(int charId)
		{
			KidnappedCharacterList infoList = this.GetSomeoneKidnapCharacters(charId);
			bool flag = infoList == null || infoList.GetCount() == 0;
			List<KidnappedCharacterDisplayData> result;
			if (flag)
			{
				result = null;
			}
			else
			{
				List<KidnappedCharacterDisplayData> dataList = new List<KidnappedCharacterDisplayData>();
				Character kidnapper = DomainManager.Character.GetElement_Objects(charId);
				foreach (KidnappedCharacter kidnappedCharacter in infoList.GetCollection())
				{
					KidnappedCharacterDisplayData data = new KidnappedCharacterDisplayData();
					data.KidnappedCharacter = kidnappedCharacter;
					data.CharacterDisplayData = DomainManager.Character.GetCharacterDisplayData(kidnappedCharacter.CharId);
					data.TotalResistance = this.CalcKidnappedCharacterTotalResistance(kidnapper, kidnappedCharacter);
					int exceedingAmount = Math.Max(0, infoList.GetCount() - kidnapper.GetKidnapMaxSlotCount());
					data.EscapeRate = kidnappedCharacter.CalcEscapeRate(data.TotalResistance, exceedingAmount);
					dataList.Add(data);
				}
				result = dataList;
			}
			return result;
		}

		// Token: 0x06007133 RID: 28979 RVA: 0x00410480 File Offset: 0x0040E680
		[DomainMethod]
		public CharacterAttributeDisplayData GetCharacterAttributeDisplayData(int charId)
		{
			Character character = this.GetElement_Objects(charId);
			return new CharacterAttributeDisplayData
			{
				CurMainAttributes = character.GetCurrMainAttributes(),
				MaxMainAttributes = character.GetMaxMainAttributes(),
				AtkHitAttribute = character.GetHitValues(),
				AtkPenetrability = character.GetPenetrations(),
				DefHitAttribute = character.GetAvoidValues(),
				DefPenetrability = character.GetPenetrationResists(),
				RecoveryOfStanceAndBreath = character.GetRecoveryOfStanceAndBreath(),
				MoveSpeed = character.GetMoveSpeed(),
				RecoveryOfFlaw = character.GetRecoveryOfFlaw(),
				CastSpeed = character.GetCastSpeed(),
				RecoveryOfBlockedAcupoint = character.GetRecoveryOfBlockedAcupoint(),
				WeaponSwitchSpeed = character.GetWeaponSwitchSpeed(),
				AttackSpeed = character.GetAttackSpeed(),
				InnerRatio = character.GetInnerRatio(),
				RecoveryOfQiDisorder = character.GetRecoveryOfQiDisorder()
			};
		}

		// Token: 0x06007134 RID: 28980 RVA: 0x00410558 File Offset: 0x0040E758
		[DomainMethod]
		public unsafe CharacterSamsaraData GetCharacterSamsaraData(int charId)
		{
			List<DeadCharacter> characterList = new List<DeadCharacter>();
			Character character = this.GetElement_Objects(charId);
			PreexistenceCharIds preexistenceCharIds = *character.GetPreexistenceCharIds();
			int i = 0;
			int max = preexistenceCharIds.Count;
			while (i < max)
			{
				int preCharId = *(ref preexistenceCharIds.CharIds.FixedElementField + (IntPtr)i * 4);
				DeadCharacter deadCharacter = DomainManager.Character.TryGetDeadCharacter(preCharId);
				characterList.Add(deadCharacter);
				i++;
			}
			return new CharacterSamsaraData
			{
				DeadCharacters = characterList,
				PreexistenceCharIds = preexistenceCharIds
			};
		}

		// Token: 0x06007135 RID: 28981 RVA: 0x004105E4 File Offset: 0x0040E7E4
		[DomainMethod]
		public unsafe CharacterAttributeDisplayData GetEquipmentCompareData(DataContext context, int charId, sbyte srcSlot, sbyte destSlot, ItemKey srcItemKey)
		{
			Character character = this.GetElement_Objects(charId);
			ItemKey destItemKey = (destSlot >= 0) ? character.GetEquipment()[(int)destSlot] : ItemKey.Invalid;
			bool flag = srcSlot >= 0;
			if (flag)
			{
				srcItemKey = character.GetEquipment()[(int)srcSlot];
			}
			character.ChangeEquipment(context, srcSlot, destSlot, srcItemKey);
			CharacterAttributeDisplayData data = this.GetCharacterAttributeDisplayData(charId);
			bool flag2 = srcSlot < 0 && destItemKey.IsValid();
			if (flag2)
			{
				character.ChangeEquipment(context, srcSlot, destSlot, destItemKey);
			}
			else
			{
				character.ChangeEquipment(context, destSlot, srcSlot, srcItemKey);
			}
			MainAttributes currMainAttributes = character.GetCurrMainAttributes();
			MainAttributes maxMainAttributes = character.GetMaxMainAttributes();
			HitOrAvoidInts hitValues = character.GetHitValues();
			HitOrAvoidInts avoidValues = character.GetAvoidValues();
			OuterAndInnerInts penetrations = character.GetPenetrations();
			OuterAndInnerInts penetrationResists = character.GetPenetrationResists();
			OuterAndInnerShorts recoveryOfStanceAndBreath = character.GetRecoveryOfStanceAndBreath();
			for (sbyte type = 0; type < 6; type += 1)
			{
				ref short ptr = ref data.CurMainAttributes.Items.FixedElementField + (IntPtr)type * 2;
				ptr -= *(ref currMainAttributes.Items.FixedElementField + (IntPtr)type * 2);
				ref short ptr2 = ref data.MaxMainAttributes.Items.FixedElementField + (IntPtr)type * 2;
				ptr2 -= *(ref maxMainAttributes.Items.FixedElementField + (IntPtr)type * 2);
			}
			for (sbyte type2 = 0; type2 < 4; type2 += 1)
			{
				*(ref data.AtkHitAttribute.Items.FixedElementField + (IntPtr)type2 * 4) -= *(ref hitValues.Items.FixedElementField + (IntPtr)type2 * 4);
				*(ref data.DefHitAttribute.Items.FixedElementField + (IntPtr)type2 * 4) -= *(ref avoidValues.Items.FixedElementField + (IntPtr)type2 * 4);
			}
			CharacterAttributeDisplayData characterAttributeDisplayData = data;
			characterAttributeDisplayData.AtkPenetrability.Outer = characterAttributeDisplayData.AtkPenetrability.Outer - penetrations.Outer;
			CharacterAttributeDisplayData characterAttributeDisplayData2 = data;
			characterAttributeDisplayData2.AtkPenetrability.Inner = characterAttributeDisplayData2.AtkPenetrability.Inner - penetrations.Inner;
			CharacterAttributeDisplayData characterAttributeDisplayData3 = data;
			characterAttributeDisplayData3.DefPenetrability.Outer = characterAttributeDisplayData3.DefPenetrability.Outer - penetrationResists.Outer;
			CharacterAttributeDisplayData characterAttributeDisplayData4 = data;
			characterAttributeDisplayData4.DefPenetrability.Inner = characterAttributeDisplayData4.DefPenetrability.Inner - penetrationResists.Inner;
			CharacterAttributeDisplayData characterAttributeDisplayData5 = data;
			characterAttributeDisplayData5.RecoveryOfStanceAndBreath.Outer = characterAttributeDisplayData5.RecoveryOfStanceAndBreath.Outer - recoveryOfStanceAndBreath.Outer;
			CharacterAttributeDisplayData characterAttributeDisplayData6 = data;
			characterAttributeDisplayData6.RecoveryOfStanceAndBreath.Inner = characterAttributeDisplayData6.RecoveryOfStanceAndBreath.Inner - recoveryOfStanceAndBreath.Inner;
			CharacterAttributeDisplayData characterAttributeDisplayData7 = data;
			characterAttributeDisplayData7.MoveSpeed -= character.GetMoveSpeed();
			CharacterAttributeDisplayData characterAttributeDisplayData8 = data;
			characterAttributeDisplayData8.RecoveryOfFlaw -= character.GetRecoveryOfFlaw();
			CharacterAttributeDisplayData characterAttributeDisplayData9 = data;
			characterAttributeDisplayData9.CastSpeed -= character.GetCastSpeed();
			CharacterAttributeDisplayData characterAttributeDisplayData10 = data;
			characterAttributeDisplayData10.RecoveryOfBlockedAcupoint -= character.GetRecoveryOfBlockedAcupoint();
			CharacterAttributeDisplayData characterAttributeDisplayData11 = data;
			characterAttributeDisplayData11.WeaponSwitchSpeed -= character.GetWeaponSwitchSpeed();
			CharacterAttributeDisplayData characterAttributeDisplayData12 = data;
			characterAttributeDisplayData12.AttackSpeed -= character.GetAttackSpeed();
			CharacterAttributeDisplayData characterAttributeDisplayData13 = data;
			characterAttributeDisplayData13.InnerRatio -= character.GetInnerRatio();
			CharacterAttributeDisplayData characterAttributeDisplayData14 = data;
			characterAttributeDisplayData14.RecoveryOfQiDisorder -= character.GetRecoveryOfQiDisorder();
			return data;
		}

		// Token: 0x06007136 RID: 28982 RVA: 0x004108C0 File Offset: 0x0040EAC0
		[DomainMethod]
		public unsafe List<GroupCharDisplayData> GetGroupCharDisplayDataList(DataContext context, List<int> charIdList)
		{
			List<GroupCharDisplayData> dataList = new List<GroupCharDisplayData>();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			foreach (int charId in charIdList)
			{
				bool flag = this._objects.ContainsKey(charId);
				if (flag)
				{
					Character character = this.GetElement_Objects(charId);
					AvatarData avatarData = character.GetAvatar();
					GroupCharDisplayData data = new GroupCharDisplayData
					{
						CharacterId = charId,
						CharacterTemplateId = character.GetTemplateId(),
						NameData = this.GetNameRelatedData(charId),
						CurrAge = character.GetCurrAge(),
						ActualAge = character.GetActualAge(),
						BirthDate = character.GetBirthDate(),
						Health = character.GetHealth(),
						MaxLeftHealth = character.GetLeftMaxHealth(false),
						DefeatMarkCount = (sbyte)CombatDomain.GetDefeatMarksCountOutOfCombat(character),
						Charm = character.GetAttraction(),
						BehaviorType = character.GetBehaviorType(),
						Fame = character.GetFame(),
						Happiness = ((DomainManager.Combat.IsInCombat() && DomainManager.Combat.IsCharInCombat(charId, true)) ? DomainManager.Combat.GetElement_CombatCharacterDict(charId).GetHappiness() : character.GetHappiness()),
						FavorabilityToTaiwu = this.GetFavorability(charId, taiwuCharId),
						IsInteractedWithTaiwu = DomainManager.Character.IsInteractedWithTaiwu(charId),
						PreexistenceCharCount = (short)character.GetPreexistenceCharIds().Count,
						AttackMedal = character.GetFeatureMedalValue(0),
						DefenceMedal = character.GetFeatureMedalValue(1),
						WisdomMedal = character.GetFeatureMedalValue(2),
						MaxMainAttributes = character.GetMaxMainAttributes(),
						Penetrations = character.GetPenetrations(),
						PenetrationResists = character.GetPenetrationResists(),
						HitValues = character.GetHitValues(),
						AvoidValues = character.GetAvoidValues(),
						DisorderOfQi = character.GetDisorderOfQi(),
						LifeSkillQualifications = *character.GetLifeSkillQualifications(),
						LifeSkillGrowthType = character.GetLifeSkillQualificationGrowthType(),
						CombatSkillQualifications = *character.GetCombatSkillQualifications(),
						CombatSkillGrowthType = character.GetCombatSkillQualificationGrowthType(),
						Personalities = character.GetPersonalities(),
						Resources = *character.GetResources(),
						CurrInventoryLoad = character.GetCurrInventoryLoad(),
						MaxInventoryLoad = character.GetMaxInventoryLoad(),
						KidnapCount = (sbyte)this.GetKidnappedCharacterCount(charId),
						Gender = character.GetGender(),
						PhysiologicalAge = character.GetPhysiologicalAge(),
						ClothDisplayId = character.GetClothingDisplayId(),
						FaceVisible = (!avatarData.ShowVeil && !avatarData.ShowMask(character.GetClothingDisplayId())),
						CreatingType = character.GetCreatingType(),
						Command = DomainManager.Extra.GetCharTeammateCommandsSByteList(context, charId),
						AdvancedCommand = DomainManager.Extra.GetAdvancedCharTeammateCommandsSByteList(charId),
						ConsummateLevel = character.GetConsummateLevel(),
						IsSpecialGroupMember = DomainManager.Extra.IsSpecialGroupMember(character)
					};
					dataList.Add(data);
				}
			}
			return dataList;
		}

		// Token: 0x06007137 RID: 28983 RVA: 0x00410C08 File Offset: 0x0040EE08
		[DomainMethod]
		public List<ValueTuple<int, short>> GetDefeatMarkCountList(List<int> charIdList)
		{
			List<ValueTuple<int, short>> valueList = new List<ValueTuple<int, short>>();
			foreach (int charId in charIdList)
			{
				valueList.Add(new ValueTuple<int, short>(charId, (short)CombatDomain.GetDefeatMarksCountOutOfCombat(this.GetElement_Objects(charId))));
			}
			return valueList;
		}

		// Token: 0x06007138 RID: 28984 RVA: 0x00410C78 File Offset: 0x0040EE78
		[DomainMethod]
		public List<CharacterDisplayDataForUltimateSelect> GetCharacterDisplayDataListForUltimateSelect(List<int> charIdList)
		{
			bool flag = charIdList == null || charIdList.Count <= 0;
			List<CharacterDisplayDataForUltimateSelect> result;
			if (flag)
			{
				result = null;
			}
			else
			{
				result = charIdList.ConvertAll<CharacterDisplayDataForUltimateSelect>(new Converter<int, CharacterDisplayDataForUltimateSelect>(this.GetCharacterDisplayDataForUltimateSelect));
			}
			return result;
		}

		// Token: 0x06007139 RID: 28985 RVA: 0x00410CB6 File Offset: 0x0040EEB6
		private CharacterDisplayDataForUltimateSelect GetCharacterDisplayDataForUltimateSelect(int charId)
		{
			return this.GetCharacterDisplayDataForUltimateSelect(this._objects[charId]);
		}

		// Token: 0x0600713A RID: 28986 RVA: 0x00410CCC File Offset: 0x0040EECC
		private unsafe CharacterDisplayDataForUltimateSelect GetCharacterDisplayDataForUltimateSelect(Character character)
		{
			int charId = character.GetId();
			return new CharacterDisplayDataForUltimateSelect
			{
				CharacterId = character.GetId(),
				CreatingType = character.GetCreatingType(),
				NameRelatedData = DomainManager.Character.GetNameRelatedData(charId),
				AvatarRelatedData = DomainManager.Character.GetAvatarRelatedData(charId),
				BirthDate = character.GetBirthDate(),
				CurrAge = character.GetCurrAge(),
				Charm = character.GetAttraction(),
				Gender = character.GetGender(),
				HappinessType = character.GetHappinessType(),
				BehaviorType = character.GetBehaviorType(),
				FameType = character.GetFameType(),
				OrganizationInfo = character.GetOrganizationInfo(),
				IsReclusiveChar = DomainManager.Character.IsReclusive(charId),
				LocationNameData = DomainManager.Map.GetBlockFullName(character.GetLocation()),
				Health = character.GetHealth(),
				LeftMaxHealth = character.GetLeftMaxHealth(false),
				FavorabilityToTaiwu = DomainManager.Character.GetFavorability(charId, DomainManager.Taiwu.GetTaiwuCharId()),
				PreexistenceCharCount = (short)character.GetPreexistenceCharIds().Count,
				AttackMedal = character.GetFeatureMedalValue(0),
				DefenceMedal = character.GetFeatureMedalValue(1),
				WisdomMedal = character.GetFeatureMedalValue(2),
				ConsummateLevel = (int)character.GetConsummateLevel(),
				BirthMonth = character.GetBirthMonth(),
				MaxMainAttributes = character.GetMaxMainAttributes(),
				Penetrations = character.GetPenetrations(),
				PenetrationResists = character.GetPenetrationResists(),
				HitValues = character.GetHitValues(),
				AvoidValues = character.GetAvoidValues(),
				DisorderOfQi = character.GetDisorderOfQi(),
				LifeSkillQualifications = *character.GetLifeSkillQualifications(),
				LifeSkillGrowthType = character.GetLifeSkillQualificationGrowthType(),
				CombatSkillQualifications = *character.GetCombatSkillQualifications(),
				CombatSkillGrowthType = character.GetCombatSkillQualificationGrowthType(),
				Personalities = character.GetPersonalities(),
				Resources = *character.GetResources(),
				CurrInventoryLoad = character.GetCurrInventoryLoad(),
				MaxInventoryLoad = character.GetMaxInventoryLoad(),
				KidnapCount = (sbyte)DomainManager.Character.GetKidnappedCharacterCount(charId),
				NeiliProportionOfFiveElements = character.GetNeiliProportionOfFiveElements(),
				VillagerNeedWaitTime = DomainManager.Taiwu.GetVillagerNeedWaitTime(charId, DomainManager.Character.CharacterSortFilter)
			};
		}

		// Token: 0x0600713B RID: 28987 RVA: 0x00410F20 File Offset: 0x0040F120
		[DomainMethod]
		public unsafe CharacterDisplayDataForMapBlock GetCharacterDisplayDataForMapBlock(int charId)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			CharacterDisplayDataForMapBlock result;
			if (flag)
			{
				result = null;
			}
			else
			{
				DataContext context = DataContextManager.GetCurrentThreadDataContext();
				CharacterDisplayDataForMapBlock data = new CharacterDisplayDataForMapBlock
				{
					CharacterId = character.GetId(),
					TemplateId = character.GetTemplateId(),
					CreatingType = character.GetCreatingType(),
					NameRelatedData = DomainManager.Character.GetNameRelatedData(charId),
					AvatarRelatedData = DomainManager.Character.GetAvatarRelatedData(charId),
					Age = character.GetCurrAge(),
					Charm = character.GetAttraction(),
					Gender = character.GetGender(),
					HappinessType = character.GetHappinessType(),
					BehaviorType = character.GetBehaviorType(),
					FameType = character.GetFameType(),
					OrganizationInfo = character.GetOrganizationInfo(),
					IsReclusiveChar = DomainManager.Character.IsReclusive(charId),
					Health = character.GetHealth(),
					LeftMaxHealth = character.GetLeftMaxHealth(false),
					PreexistenceCharCount = (short)character.GetPreexistenceCharIds().Count,
					AttackMedal = character.GetFeatureMedalValue(0),
					DefenceMedal = character.GetFeatureMedalValue(1),
					WisdomMedal = character.GetFeatureMedalValue(2),
					ConsummateLevel = character.GetConsummateLevel(),
					BirthMonth = character.GetBirthMonth(),
					DisorderOfQi = character.GetDisorderOfQi(),
					NeiliProportionOfFiveElements = character.GetNeiliProportionOfFiveElements(),
					Injuries = character.GetInjuries(),
					Poisons = *character.GetPoisoned(),
					TeammateCommands = DomainManager.Extra.GetCharTeammateCommands(context, charId),
					LoveAndHateItemInfo = DomainManager.Character.GetCharacterLoveAndHateItemInfo(context, charId),
					FavorabilityToTaiwu = (DomainManager.Character.IsInteractedWithTaiwu(charId) ? this.GetFavorability(charId, DomainManager.Taiwu.GetTaiwuCharId()) : short.MinValue),
					MainAttributes = character.GetMaxMainAttributes(),
					CurrMainAttributes = character.GetCurrMainAttributes(),
					LifeSkillQualifications = *character.GetLifeSkillQualifications(),
					LifeSkillAttainments = *character.GetLifeSkillAttainments(),
					LifeSkillGrowthType = character.GetLifeSkillQualificationGrowthType(),
					CombatSkillQualifications = *character.GetCombatSkillQualifications(),
					CombatSkillAttainments = *character.GetCombatSkillAttainments(),
					CombatSkillGrowthType = character.GetCombatSkillQualificationGrowthType(),
					FeatureIds = character.GetFeatureIds(),
					EquipmentArray = character.GetEquipment(),
					SkillBookCountArray = DomainManager.Character.GetSkillBookLibraryGradeCount(charId),
					LegendaryBookTypeList = DomainManager.LegendaryBook.GetCharOwnedBookTypes(charId),
					TitleIdList = new List<short>()
				};
				character.GetTitles(data.TitleIdList);
				SettlementCharacter settlementChar;
				bool flag2 = DomainManager.Organization.TryGetSettlementCharacter(charId, out settlementChar);
				if (flag2)
				{
					data.InfluencePower = (int)settlementChar.GetInfluencePower();
				}
				Dictionary<ItemKey, int>.KeyCollection itemKeys = character.GetInventory().Items.Keys;
				data.HighestGradeItemArray = (from k in itemKeys.Where(delegate(ItemKey k)
				{
					sbyte itemType = k.ItemType;
					return itemType != 0 && itemType != 10 && ItemTemplateHelper.GetItemSubType(k.ItemType, k.TemplateId) != 1202;
				})
				group k by new ValueTuple<sbyte, short>(k.ItemType, k.TemplateId) into g
				select g.First<ItemKey>() into k
				orderby ItemTemplateHelper.GetGrade(k.ItemType, k.TemplateId) descending
				select k).Take(new Range(0, 10)).ToArray<ItemKey>();
				data.HighestGradeCombatSkillBookArray = (from k in itemKeys
				where ItemTemplateHelper.GetItemSubType(k.ItemType, k.TemplateId) == 1001
				group k by new ValueTuple<sbyte, short>(k.ItemType, k.TemplateId) into g
				select g.First<ItemKey>() into k
				orderby ItemTemplateHelper.GetGrade(k.ItemType, k.TemplateId) descending
				select k).Take(new Range(0, 5)).ToArray<ItemKey>();
				data.HighestGradeLifeSkillBookArray = (from k in itemKeys
				where ItemTemplateHelper.GetItemSubType(k.ItemType, k.TemplateId) == 1000
				group k by new ValueTuple<sbyte, short>(k.ItemType, k.TemplateId) into g
				select g.First<ItemKey>() into k
				orderby ItemTemplateHelper.GetGrade(k.ItemType, k.TemplateId) descending
				select k).Take(new Range(0, 5)).ToArray<ItemKey>();
				CharacterDisplayDataForMapBlock characterDisplayDataForMapBlock = data;
				CharacterDisplayDataForMapBlock characterDisplayDataForMapBlock2 = data;
				ValueTuple<Dictionary<short, bool>, int> visibleCharacterInteractionEventOptions = DomainManager.TaiwuEvent.GetVisibleCharacterInteractionEventOptions(charId);
				characterDisplayDataForMapBlock.VisibleCharacterInteractionEventOptionDict = visibleCharacterInteractionEventOptions.Item1;
				characterDisplayDataForMapBlock2.NoInteractionReason = visibleCharacterInteractionEventOptions.Item2;
				data.RelationshipToTaiwuList = new List<short>(RelationDisplayType.Instance.Count);
				data.RelationshipCountDict = new Dictionary<short, int>(RelationDisplayType.Instance.Count);
				int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
				RelatedCharacters relatedCharacters = DomainManager.Character.GetRelatedCharacters(charId);
				RelatedCharacter relatedCharacter;
				bool hasRelation = DomainManager.Character.TryGetRelation(taiwuCharId, charId, out relatedCharacter);
				for (sbyte i = 0; i < 17; i += 1)
				{
					sbyte typeId = i;
					ushort type = RelationType.GetRelationType(typeId);
					RelationDisplayTypeItem relationDisplayTypeItem = null;
					RelationDisplayType.Instance.Iterate(delegate(RelationDisplayTypeItem r)
					{
						bool flag6 = r.RelationTypeIds.Contains(typeId);
						bool result2;
						if (flag6)
						{
							relationDisplayTypeItem = r;
							result2 = false;
						}
						else
						{
							result2 = true;
						}
						return result2;
					});
					bool flag3 = relationDisplayTypeItem == null;
					if (!flag3)
					{
						short templateId = relationDisplayTypeItem.TemplateId;
						bool flag4 = hasRelation && RelationType.HasRelation(relatedCharacter.RelationType, type);
						if (flag4)
						{
							data.RelationshipToTaiwuList.Add(templateId);
						}
						HashSet<int> collection = (relatedCharacters != null) ? relatedCharacters.GetCharacterSet(type).GetCollection() : null;
						int collectionCount = (collection != null) ? collection.Count : 0;
						int count;
						data.RelationshipCountDict.TryGetValue(templateId, out count);
						count += collectionCount;
						data.RelationshipCountDict[templateId] = count;
						bool flag5 = collectionCount > 0;
						if (flag5)
						{
							List<int> charIdList = collection.ToList<int>();
							charIdList.Sort(delegate(int a, int b)
							{
								bool aliveA = DomainManager.Character.IsCharacterAlive(a);
								return DomainManager.Character.IsCharacterAlive(b).CompareTo(aliveA);
							});
							ushort num = type;
							ushort num2 = num;
							switch (num2)
							{
							case 1:
								data.BloodParentCharDataList = DomainManager.Character.GetCharacterDisplayDataList(charIdList);
								data.BloodParentCharDataList = (from d in data.BloodParentCharDataList
								orderby d.Gender descending
								select d).ToList<CharacterDisplayData>();
								break;
							case 2:
								data.BloodChildCharDataList = DomainManager.Character.GetCharacterDisplayDataList(charIdList);
								break;
							case 3:
								break;
							case 4:
								data.BloodBrotherOrSisterCharDataList = DomainManager.Character.GetCharacterDisplayDataList(charIdList);
								break;
							default:
								if (num2 == 1024)
								{
									data.HusbandOrWifeCharDataList = DomainManager.Character.GetCharacterDisplayDataList(charIdList);
								}
								break;
							}
						}
					}
				}
				List<short> learnedCombatSkills = character.GetLearnedCombatSkills();
				data.LearnedCombatSkillCountArray = (from g in learnedCombatSkills.GroupBy((short id) => Config.CombatSkill.Instance[id].Grade, (sbyte grade, [Nullable(1)] IEnumerable<short> keys) => new
				{
					grade = grade,
					amount = (short)keys.Count<short>()
				})
				select g.amount).ToArray<short>();
				data.LearnedHighestGradeNeigongCombatSkillArray = (from id in learnedCombatSkills
				where Config.CombatSkill.Instance[id].Type == 0
				orderby Config.CombatSkill.Instance[id].Grade descending
				select id).Take(new Range(0, 6)).ToArray<short>();
				data.LearnedHighestGradePosingCombatSkillArray = (from id in learnedCombatSkills
				where Config.CombatSkill.Instance[id].Type == 1
				orderby Config.CombatSkill.Instance[id].Grade descending
				select id).Take(new Range(0, 6)).ToArray<short>();
				data.LearnedHighestGradeStuntCombatSkillArray = (from id in learnedCombatSkills
				where Config.CombatSkill.Instance[id].Type == 2
				orderby Config.CombatSkill.Instance[id].Grade descending
				select id).Take(new Range(0, 6)).ToArray<short>();
				data.LearnedHighestGradeAttackCombatSkillArray = (from id in learnedCombatSkills
				where Config.CombatSkill.Instance[id].EquipType == 1
				orderby Config.CombatSkill.Instance[id].Grade descending
				select id).Take(new Range(0, 6)).ToArray<short>();
				result = data;
			}
			return result;
		}

		// Token: 0x0600713C RID: 28988 RVA: 0x004118A0 File Offset: 0x0040FAA0
		[DomainMethod]
		public List<bool> GetCharacterAllBodyPartExists(int charId)
		{
			Character character = this._objects[charId];
			List<bool> result = new List<bool>();
			for (sbyte partType = 0; partType < 7; partType += 1)
			{
				List<bool> list = result;
				if (!true)
				{
				}
				bool item;
				switch (partType)
				{
				case 3:
					item = character.GetHaveLeftArm();
					break;
				case 4:
					item = character.GetHaveRightArm();
					break;
				case 5:
					item = character.GetHaveLeftLeg();
					break;
				case 6:
					item = character.GetHaveRightLeg();
					break;
				default:
					item = true;
					break;
				}
				if (!true)
				{
				}
				list.Add(item);
			}
			return result;
		}

		// Token: 0x0600713D RID: 28989 RVA: 0x00411938 File Offset: 0x0040FB38
		public Dictionary<short, HashSet<int>> GetAreaMerchantCharDict(int merchantType)
		{
			Dictionary<short, HashSet<int>> dict = new Dictionary<short, HashSet<int>>();
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				OrganizationInfo orgInfo = character.GetOrganizationInfo();
				OrganizationItem orgConfig = Organization.Instance[orgInfo.OrgTemplateId];
				short memberTemplateId = orgConfig.Members[(int)orgInfo.Grade];
				OrganizationMemberItem memberConfig = OrganizationMember.Instance[memberTemplateId];
				bool flag = character.GetCurrAge() < memberConfig.IdentityActiveAge;
				if (!flag)
				{
					bool flag2 = character.GetCreatingType() == 1 && (int)DomainManager.Extra.GetMerchantCharToType(charId) == merchantType;
					if (flag2)
					{
						short areaId = character.GetValidLocation().AreaId;
						MapAreaData areaData = DomainManager.Map.GetAreaByAreaId(areaId);
						short areaTemplateId = areaData.GetTemplateId();
						HashSet<int> set;
						bool flag3 = !dict.TryGetValue(areaTemplateId, out set);
						if (flag3)
						{
							set = new HashSet<int>();
							dict[areaTemplateId] = set;
						}
						set.Add(charId);
					}
				}
			}
			return dict;
		}

		// Token: 0x0600713E RID: 28990 RVA: 0x00411A78 File Offset: 0x0040FC78
		public void UpdateDistantMarriages(DataContext context)
		{
			int passConditionCount = 0;
			int passSuccessRateCheckCount = 0;
			int foundTargetCount = 0;
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				Character character = character2;
				EMarriageAgeGroup marriageAgeGroup = character.GetMarriageAgeGroup();
				bool flag = !this.CanStartDistantMarriage(character);
				if (!flag)
				{
					passConditionCount++;
					int startChance = marriageAgeGroup.GetDistantMarriageChance();
					bool flag2 = !context.Random.CheckPercentProb(startChance);
					if (!flag2)
					{
						passSuccessRateCheckCount++;
						bool flag3 = this.UpdateDistantMarriage(context, character);
						if (flag3)
						{
							foundTargetCount++;
						}
					}
				}
			}
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(84, 3);
			defaultInterpolatedStringHandler.AppendLiteral("[DistantMarriage] PassConditionCount=");
			defaultInterpolatedStringHandler.AppendFormatted<int>(passConditionCount);
			defaultInterpolatedStringHandler.AppendLiteral(", PassSuccessRateCheckCount=");
			defaultInterpolatedStringHandler.AppendFormatted<int>(passSuccessRateCheckCount);
			defaultInterpolatedStringHandler.AppendLiteral(", FoundTargetCount=");
			defaultInterpolatedStringHandler.AppendFormatted<int>(foundTargetCount);
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x0600713F RID: 28991 RVA: 0x00411B9C File Offset: 0x0040FD9C
		private bool UpdateDistantMarriage(DataContext context, Character character)
		{
			ValueTuple<Character, EDistantMarriageType> valueTuple = this.SelectDistantMarriageTarget(context, character);
			Character bestTargetChar = valueTuple.Item1;
			EDistantMarriageType marriageType = valueTuple.Item2;
			bool flag = bestTargetChar == null;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				int selfCharId = character.GetId();
				int targetCharId = bestTargetChar.GetId();
				short selfSettlementId = character.GetOrganizationInfo().SettlementId;
				short targetSettlementId = bestTargetChar.GetOrganizationInfo().SettlementId;
				int currDate = DomainManager.World.GetCurrDate();
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				MonthlyNotificationCollection monthlyNotifications = DomainManager.World.GetMonthlyNotificationCollection();
				switch (marriageType)
				{
				case EDistantMarriageType.SameArea:
				{
					lifeRecordCollection.AddSameAreaDistantMarriage(selfCharId, currDate, targetSettlementId, targetCharId);
					lifeRecordCollection.AddSameAreaDistantMarriage(targetCharId, currDate, selfSettlementId, selfCharId);
					bool flag2 = this.IsTaiwuPeople(selfCharId);
					if (flag2)
					{
						monthlyNotifications.AddNpcLongDistanceMarriage0(selfSettlementId, selfCharId, targetSettlementId, targetCharId);
					}
					else
					{
						bool flag3 = this.IsTaiwuPeople(targetCharId);
						if (flag3)
						{
							monthlyNotifications.AddNpcLongDistanceMarriage0(targetSettlementId, targetCharId, selfSettlementId, selfCharId);
						}
					}
					break;
				}
				case EDistantMarriageType.SameState:
				{
					lifeRecordCollection.AddSameStateDistantMarriage(selfCharId, currDate, targetSettlementId, targetCharId);
					lifeRecordCollection.AddSameStateDistantMarriage(targetCharId, currDate, selfSettlementId, selfCharId);
					bool flag4 = this.IsTaiwuPeople(selfCharId);
					if (flag4)
					{
						monthlyNotifications.AddNpcLongDistanceMarriage1(selfSettlementId, selfCharId, targetSettlementId, targetCharId);
					}
					else
					{
						bool flag5 = this.IsTaiwuPeople(targetCharId);
						if (flag5)
						{
							monthlyNotifications.AddNpcLongDistanceMarriage1(targetSettlementId, targetCharId, selfSettlementId, selfCharId);
						}
					}
					break;
				}
				case EDistantMarriageType.NeighborStates:
				{
					lifeRecordCollection.AddDifferentStateDistantMarriage(selfCharId, currDate, targetSettlementId, targetCharId);
					lifeRecordCollection.AddDifferentStateDistantMarriage(targetCharId, currDate, selfSettlementId, selfCharId);
					bool flag6 = this.IsTaiwuPeople(selfCharId);
					if (flag6)
					{
						monthlyNotifications.AddNpcLongDistanceMarriage2(selfSettlementId, selfCharId, targetSettlementId, targetCharId);
					}
					else
					{
						bool flag7 = this.IsTaiwuPeople(targetCharId);
						if (flag7)
						{
							monthlyNotifications.AddNpcLongDistanceMarriage2(targetSettlementId, targetCharId, selfSettlementId, selfCharId);
						}
					}
					break;
				}
				}
				character.AddPersonalNeed(context, GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(23, targetCharId));
				bestTargetChar.AddPersonalNeed(context, GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(23, selfCharId));
				DomainManager.Character.AddHusbandOrWifeRelations(context, selfCharId, targetCharId, currDate);
				DomainManager.Organization.UpdateOrganizationAfterMarriage(context, character, bestTargetChar);
				result = true;
			}
			return result;
		}

		// Token: 0x06007140 RID: 28992 RVA: 0x00411D88 File Offset: 0x0040FF88
		private Character SelectDistantMarriageTargetSameArea(DataContext context, Character selfChar, Settlement selfSettlement)
		{
			List<int> charList = context.AdvanceMonthRelatedData.TargetCharIdList.Occupy();
			MapAreaData areaData = DomainManager.Map.GetElement_Areas((int)selfSettlement.GetLocation().AreaId);
			short settlementId = selfSettlement.GetId();
			Character bestTargetChar = null;
			foreach (SettlementInfo settlementInfo in areaData.SettlementInfos)
			{
				bool flag = settlementInfo.SettlementId < 0 || settlementInfo.SettlementId == settlementId;
				if (!flag)
				{
					Settlement settlement = DomainManager.Organization.GetSettlement(settlementInfo.SettlementId);
					OrgMemberCollection members = settlement.GetMembers();
					members.GetAllMembers(charList);
					bestTargetChar = this.SelectDistantMarriageTarget(selfChar, charList, bestTargetChar);
				}
			}
			context.AdvanceMonthRelatedData.TargetCharIdList.Release(ref charList);
			return bestTargetChar;
		}

		// Token: 0x06007141 RID: 28993 RVA: 0x00411E58 File Offset: 0x00410058
		private Character SelectDistantMarriageTargetSameState(DataContext context, Character selfChar, Settlement selfSettlement)
		{
			Location location = selfSettlement.GetLocation();
			sbyte stateId = DomainManager.Map.GetStateIdByAreaId(location.AreaId);
			List<short> areaIds = ObjectPool<List<short>>.Instance.Get();
			Character bestTargetChar = null;
			DomainManager.Map.GetAllAreaInState(stateId, areaIds);
			List<int> charList = context.AdvanceMonthRelatedData.TargetCharIdList.Occupy();
			foreach (short areaId in areaIds)
			{
				bool flag = areaId == location.AreaId;
				if (!flag)
				{
					MapAreaData areaData = DomainManager.Map.GetElement_Areas((int)areaId);
					foreach (SettlementInfo settlementInfo in areaData.SettlementInfos)
					{
						bool flag2 = settlementInfo.SettlementId < 0;
						if (!flag2)
						{
							Settlement settlement = DomainManager.Organization.GetSettlement(settlementInfo.SettlementId);
							OrgMemberCollection members = settlement.GetMembers();
							members.GetAllMembers(charList);
							bestTargetChar = this.SelectDistantMarriageTarget(selfChar, charList, bestTargetChar);
						}
					}
				}
			}
			ObjectPool<List<short>>.Instance.Return(areaIds);
			context.AdvanceMonthRelatedData.TargetCharIdList.Release(ref charList);
			return bestTargetChar;
		}

		// Token: 0x06007142 RID: 28994 RVA: 0x00411FA4 File Offset: 0x004101A4
		private Character SelectDistantMarriageTargetNeighborStates(DataContext context, Character selfChar, Settlement selfSettlement)
		{
			List<short> areaIds = ObjectPool<List<short>>.Instance.Get();
			Location location = selfSettlement.GetLocation();
			sbyte stateTemplateId = DomainManager.Map.GetStateTemplateIdByAreaId(location.AreaId);
			sbyte[] neighborStateTemplateIds = MapState.Instance[stateTemplateId].NeighborStates;
			List<int> charList = context.AdvanceMonthRelatedData.TargetCharIdList.Occupy();
			Character bestTargetChar = null;
			foreach (sbyte neighborStateTemplateId in neighborStateTemplateIds)
			{
				sbyte neighborStateId = DomainManager.Map.GetStateIdByStateTemplateId((short)neighborStateTemplateId);
				DomainManager.Map.GetAllAreaInState(neighborStateId, areaIds);
				foreach (short areaId in areaIds)
				{
					MapAreaData areaData = DomainManager.Map.GetElement_Areas((int)areaId);
					foreach (SettlementInfo settlementInfo in areaData.SettlementInfos)
					{
						bool flag = settlementInfo.SettlementId < 0;
						if (!flag)
						{
							Settlement settlement = DomainManager.Organization.GetSettlement(settlementInfo.SettlementId);
							OrgMemberCollection members = settlement.GetMembers();
							members.GetAllMembers(charList);
							bestTargetChar = this.SelectDistantMarriageTarget(selfChar, charList, bestTargetChar);
						}
					}
				}
			}
			context.AdvanceMonthRelatedData.TargetCharIdList.Release(ref charList);
			ObjectPool<List<short>>.Instance.Return(areaIds);
			return bestTargetChar;
		}

		// Token: 0x06007143 RID: 28995 RVA: 0x00412128 File Offset: 0x00410328
		[return: TupleElementNames(new string[]
		{
			"targetChar",
			"type"
		})]
		private ValueTuple<Character, EDistantMarriageType> SelectDistantMarriageTarget(DataContext context, Character character)
		{
			OrganizationInfo orgInfo = character.GetOrganizationInfo();
			Settlement selfSettlement = DomainManager.Organization.GetSettlement(orgInfo.SettlementId);
			Character bestTargetChar = this.SelectDistantMarriageTargetSameArea(context, character, selfSettlement);
			bool flag = bestTargetChar != null;
			ValueTuple<Character, EDistantMarriageType> result;
			if (flag)
			{
				result = new ValueTuple<Character, EDistantMarriageType>(bestTargetChar, EDistantMarriageType.SameArea);
			}
			else
			{
				Character bestTargetChar2 = this.SelectDistantMarriageTargetSameState(context, character, selfSettlement);
				bool flag2 = bestTargetChar2 != null;
				if (flag2)
				{
					result = new ValueTuple<Character, EDistantMarriageType>(bestTargetChar2, EDistantMarriageType.SameState);
				}
				else
				{
					Character bestTargetChar3 = this.SelectDistantMarriageTargetNeighborStates(context, character, selfSettlement);
					bool flag3 = bestTargetChar3 != null;
					if (flag3)
					{
						result = new ValueTuple<Character, EDistantMarriageType>(bestTargetChar3, EDistantMarriageType.NeighborStates);
					}
					else
					{
						result = new ValueTuple<Character, EDistantMarriageType>(null, EDistantMarriageType.None);
					}
				}
			}
			return result;
		}

		// Token: 0x06007144 RID: 28996 RVA: 0x004121C4 File Offset: 0x004103C4
		private Character SelectDistantMarriageTarget(Character character, IEnumerable<int> charIds, Character defaultTargetChar = null)
		{
			Character bestTargetChar = defaultTargetChar;
			foreach (int charId in charIds)
			{
				Character targetChar = this.GetElement_Objects(charId);
				bool flag = !this.CanBeDistantMarriageTarget(character, targetChar);
				if (!flag)
				{
					bool flag2 = bestTargetChar == null;
					if (flag2)
					{
						bestTargetChar = targetChar;
					}
					else
					{
						bool flag3 = this.CompareCharacterForDistantMarriageTarget(character, targetChar, bestTargetChar) > 0;
						if (flag3)
						{
							bestTargetChar = targetChar;
						}
					}
				}
			}
			return bestTargetChar;
		}

		// Token: 0x06007145 RID: 28997 RVA: 0x00412250 File Offset: 0x00410450
		private int CompareCharacterForDistantMarriageTarget(Character selfChar, Character first, Character second)
		{
			sbyte firstGrade = first.GetOrganizationInfo().Grade;
			sbyte secondGrade = second.GetOrganizationInfo().Grade;
			bool flag = firstGrade != secondGrade;
			int result;
			if (flag)
			{
				result = firstGrade.CompareTo(secondGrade);
			}
			else
			{
				short firstAge = first.GetCurrAge();
				short secondAge = second.GetCurrAge();
				bool flag2 = firstAge != secondAge;
				if (flag2)
				{
					result = secondAge.CompareTo(firstAge);
				}
				else
				{
					int selfCharId = selfChar.GetId();
					int firstCharId = first.GetId();
					int secondCharId = second.GetId();
					RelatedCharacter selfToFirst;
					bool flag3 = !this.TryGetRelation(selfCharId, firstCharId, out selfToFirst);
					if (flag3)
					{
						selfToFirst = this.CreateFakeRelation(selfChar, first);
					}
					RelatedCharacter firstToSelf;
					bool flag4 = !this.TryGetRelation(firstCharId, selfCharId, out firstToSelf);
					if (flag4)
					{
						firstToSelf = this.CreateFakeRelation(first, selfChar);
					}
					RelatedCharacter selfToSecond;
					bool flag5 = !this.TryGetRelation(selfCharId, secondCharId, out selfToSecond);
					if (flag5)
					{
						selfToSecond = this.CreateFakeRelation(selfChar, second);
					}
					RelatedCharacter secondToSelf;
					bool flag6 = !this.TryGetRelation(secondCharId, selfCharId, out secondToSelf);
					if (flag6)
					{
						secondToSelf = this.CreateFakeRelation(second, selfChar);
					}
					int firstSuccessRate = AiHelper.Relation.GetStartRelationSuccessRate_BoyOrGirlFriend(selfChar, first, selfToFirst, firstToSelf, false);
					int secondSuccessRate = AiHelper.Relation.GetStartRelationSuccessRate_BoyOrGirlFriend(selfChar, second, selfToSecond, secondToSelf, false);
					bool flag7 = firstSuccessRate != secondSuccessRate;
					if (flag7)
					{
						result = firstSuccessRate.CompareTo(secondSuccessRate);
					}
					else
					{
						result = firstCharId.CompareTo(secondCharId);
					}
				}
			}
			return result;
		}

		// Token: 0x06007146 RID: 28998 RVA: 0x00412398 File Offset: 0x00410598
		private RelatedCharacter CreateFakeRelation(Character selfChar, Character relatedChar)
		{
			OrganizationMemberItem selfOrgMemberCfg = selfChar.GetOrganizationInfo().GetOrgMemberConfig();
			sbyte selfBehaviorType = selfChar.GetBehaviorType();
			ValueTuple<short, sbyte, sbyte, short, sbyte, sbyte, OrganizationMemberItem> targetData = CharacterDomain.GetInitialFavorabilityRelatedDataOfAliveChar(relatedChar);
			int initialFavor = CharacterDomain.CalcInitialFavorability(selfOrgMemberCfg, targetData.Item1, targetData.Item2, targetData.Item3, targetData.Item4, selfBehaviorType, targetData.Item5, false, false);
			return new RelatedCharacter(0, (short)initialFavor, -1);
		}

		// Token: 0x06007147 RID: 28999 RVA: 0x004123FC File Offset: 0x004105FC
		private bool CanStartDistantMarriage(Character character)
		{
			bool flag = !character.IsInteractableAsIntelligentCharacter();
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				OrganizationInfo orgInfo = character.GetOrganizationInfo();
				bool flag2 = orgInfo.OrgTemplateId == 16 || orgInfo.OrgTemplateId == 0 || orgInfo.SettlementId < 0 || !orgInfo.Principal || OrganizationDomain.IsSect(orgInfo.OrgTemplateId) || character.GetOrganizationInfo().GetOrgMemberConfig().ChildGrade < 0;
				if (flag2)
				{
					result = false;
				}
				else
				{
					bool flag3 = !MapAreaData.IsRegularArea(character.GetLocation().AreaId);
					result = (!flag3 && (this.GetAliveSpouse(character.GetId()) < 0 && character.GetMonkType() == 0 && !character.GetBisexual() && !character.IsInTaiwuGroup()) && !DomainManager.Character.IsTemporaryIntelligentCharacter(character.GetId()));
				}
			}
			return result;
		}

		// Token: 0x06007148 RID: 29000 RVA: 0x004124D8 File Offset: 0x004106D8
		private bool CanBeDistantMarriageTarget(Character selfChar, Character targetChar)
		{
			bool flag = selfChar.GetGender() == targetChar.GetGender();
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = !this.CanStartDistantMarriage(targetChar);
				if (flag2)
				{
					result = false;
				}
				else
				{
					EMarriageAgeGroup selfMarriageAgeGroup = selfChar.GetMarriageAgeGroup();
					bool flag3 = !selfMarriageAgeGroup.CheckMarriageTargetGradeInRange(selfChar.GetInteractionGrade(), targetChar.GetInteractionGrade());
					if (flag3)
					{
						result = false;
					}
					else
					{
						bool flag4 = !selfMarriageAgeGroup.CheckMarriageTargetAgeInRange(targetChar.GetGender(), (int)targetChar.GetCurrAge());
						if (flag4)
						{
							result = false;
						}
						else
						{
							int selfCharId = selfChar.GetId();
							int targetCharId = targetChar.GetId();
							bool flag5 = !RelationTypeHelper.AllowAddingHusbandOrWifeRelation(selfCharId, targetCharId);
							if (flag5)
							{
								result = false;
							}
							else
							{
								bool flag6 = this.HasEnemyRelationWithFamily(selfCharId, targetCharId) || this.HasEnemyRelationWithFamily(targetCharId, selfCharId);
								result = !flag6;
							}
						}
					}
				}
			}
			return result;
		}

		// Token: 0x06007149 RID: 29001 RVA: 0x004125AC File Offset: 0x004107AC
		public void UpdateAdoreRelationsInMarriage(DataContext context)
		{
			HashSet<RelationKey> marriedCouples = new HashSet<RelationKey>();
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				bool flag = !character.IsInteractableAsIntelligentCharacter();
				if (!flag)
				{
					int spouseId = this.GetAliveSpouse(charId);
					bool flag2 = spouseId < 0;
					if (!flag2)
					{
						RelationKey reverseKey = new RelationKey(spouseId, charId);
						bool flag3 = marriedCouples.Contains(reverseKey);
						if (!flag3)
						{
							bool flag4 = !context.Random.CheckPercentProb((int)GlobalConfig.Instance.HusbandAndWifeStartAdoreChance);
							if (!flag4)
							{
								bool flag5 = DomainManager.Extra.IsAiActionInCooldown(charId, 4, 0) || DomainManager.Extra.IsAiActionInCooldown(spouseId, 4, 0);
								if (!flag5)
								{
									bool flag6 = !this.HasRelation(charId, spouseId, 16384) || !this.HasRelation(charId, spouseId, 16384);
									if (flag6)
									{
										marriedCouples.Add(new RelationKey(charId, spouseId));
									}
								}
							}
						}
					}
				}
			}
			sbyte cooldown = GlobalConfig.Instance.HusbandAndWifeStartAdoreCooldown;
			int addedCount = 0;
			foreach (RelationKey coupleRelationKey in marriedCouples)
			{
				DomainManager.Extra.AddAiActionCooldown(context, coupleRelationKey.CharId, 4, 0, (int)cooldown);
				DomainManager.Extra.AddAiActionCooldown(context, coupleRelationKey.RelatedCharId, 4, 0, (int)cooldown);
				Character selfChar = this._objects[coupleRelationKey.CharId];
				Character relatedChar = this._objects[coupleRelationKey.RelatedCharId];
				RelatedCharacter selfToTarget = this.GetRelation(coupleRelationKey.CharId, coupleRelationKey.RelatedCharId);
				RelatedCharacter targetToSelf = this.GetRelation(coupleRelationKey.RelatedCharId, coupleRelationKey.CharId);
				bool selfToTargetAdded = !RelationType.HasRelation(selfToTarget.RelationType, 16384) && CharacterDomain.UpdateOneWayAdoreRelationInMarriage(context, selfChar, relatedChar, selfToTarget, targetToSelf);
				bool targetToSelfAdded = !RelationType.HasRelation(targetToSelf.RelationType, 16384) && CharacterDomain.UpdateOneWayAdoreRelationInMarriage(context, relatedChar, selfChar, targetToSelf, selfToTarget);
				bool flag7 = selfToTargetAdded || targetToSelfAdded;
				if (flag7)
				{
					addedCount++;
				}
			}
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(30, 2);
			defaultInterpolatedStringHandler.AppendLiteral("Adore Relations In Marriage: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(addedCount);
			defaultInterpolatedStringHandler.AppendLiteral("/");
			defaultInterpolatedStringHandler.AppendFormatted<int>(marriedCouples.Count);
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x0600714A RID: 29002 RVA: 0x00412880 File Offset: 0x00410A80
		private static bool UpdateOneWayAdoreRelationInMarriage(DataContext context, Character selfChar, Character targetChar, RelatedCharacter selfToTarget, RelatedCharacter targetToSelf)
		{
			int successRate = AiHelper.Relation.GetStartRelationSuccessRate_Adored(selfChar, targetChar, selfToTarget, targetToSelf);
			bool flag = !context.Random.CheckPercentProb(successRate);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				int charId = selfChar.GetId();
				int targetCharId = targetChar.GetId();
				int currDate = DomainManager.World.GetCurrDate();
				DomainManager.Character.AddRelation(context, charId, targetCharId, 16384, currDate);
				LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
				lifeRecordCollection.AddAdoreInMarriage(charId, currDate, targetCharId);
				GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(23, targetCharId);
				selfChar.AddPersonalNeed(context, personalNeed);
				result = true;
			}
			return result;
		}

		// Token: 0x0600714B RID: 29003 RVA: 0x00412912 File Offset: 0x00410B12
		public IEnumerable<int> ExcludeInfant(IEnumerable<int> members)
		{
			return members.Where(delegate(int charId)
			{
				Character ch;
				return this.TryGetElement_Objects(charId, out ch) && ch.GetAgeGroup() != 0;
			});
		}

		// Token: 0x0600714C RID: 29004 RVA: 0x00412926 File Offset: 0x00410B26
		public IEnumerable<Character> ExcludeInfant(IEnumerable<Character> members)
		{
			return from character in members
			where character.GetAgeGroup() != 0
			select character;
		}

		// Token: 0x0600714D RID: 29005 RVA: 0x00412950 File Offset: 0x00410B50
		[DomainMethod]
		public int GetFeatureMedalValue(int charId, sbyte medalType)
		{
			Character character = this.GetElement_Objects(charId);
			return character.GetFeatureMedalValue(medalType);
		}

		// Token: 0x0600714E RID: 29006 RVA: 0x00412974 File Offset: 0x00410B74
		[DomainMethod]
		public List<ValueTuple<int, short>> GetFeatureMedalValueList(List<int> charIdList, sbyte medalType)
		{
			List<ValueTuple<int, short>> valueList = new List<ValueTuple<int, short>>();
			foreach (int charId in charIdList)
			{
				valueList.Add(new ValueTuple<int, short>(charId, (short)this.GetElement_Objects(charId).GetFeatureMedalValue(medalType)));
			}
			return valueList;
		}

		// Token: 0x0600714F RID: 29007 RVA: 0x004129E4 File Offset: 0x00410BE4
		private static void InitializeBasicFeaturesPools()
		{
			CharacterDomain._normalPositiveBasicFeaturesPool = new List<short>();
			CharacterDomain._normalNegativeBasicFeaturesPool = new List<short>();
			CharacterDomain._protagonistPositiveBasicFeaturesPool = new List<short>();
			CharacterDomain._protagonistNegativeBasicFeaturesPool = new List<short>();
			foreach (CharacterFeatureItem item in ((IEnumerable<CharacterFeatureItem>)CharacterFeature.Instance))
			{
				bool flag = item == null;
				if (!flag)
				{
					bool flag2 = !item.Basic;
					if (!flag2)
					{
						bool flag3 = item.CandidateGroupId == 0;
						if (flag3)
						{
							for (int i = 0; i < (int)item.AppearProb; i++)
							{
								CharacterDomain._normalPositiveBasicFeaturesPool.Add(item.TemplateId);
							}
							for (int j = 0; j < (int)item.ProtagonistAppearProb; j++)
							{
								CharacterDomain._protagonistPositiveBasicFeaturesPool.Add(item.TemplateId);
							}
						}
						else
						{
							bool flag4 = item.CandidateGroupId == 1;
							if (flag4)
							{
								for (int k = 0; k < (int)item.AppearProb; k++)
								{
									CharacterDomain._normalNegativeBasicFeaturesPool.Add(item.TemplateId);
								}
								for (int l = 0; l < (int)item.ProtagonistAppearProb; l++)
								{
									CharacterDomain._protagonistNegativeBasicFeaturesPool.Add(item.TemplateId);
								}
							}
							else
							{
								for (int m = 0; m < (int)item.AppearProb; m++)
								{
									CharacterDomain._normalPositiveBasicFeaturesPool.Add(item.TemplateId);
									CharacterDomain._normalNegativeBasicFeaturesPool.Add(item.TemplateId);
								}
								for (int n = 0; n < (int)item.ProtagonistAppearProb; n++)
								{
									CharacterDomain._protagonistPositiveBasicFeaturesPool.Add(item.TemplateId);
									CharacterDomain._protagonistNegativeBasicFeaturesPool.Add(item.TemplateId);
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06007150 RID: 29008 RVA: 0x00412BE4 File Offset: 0x00410DE4
		public static short GetBirthdayFeatureId(sbyte month)
		{
			return (short)(183 + (int)month);
		}

		// Token: 0x06007151 RID: 29009 RVA: 0x00412C00 File Offset: 0x00410E00
		public unsafe static short GenerateOneYearOldCatchFeature(IRandomSource random)
		{
			sbyte* pProbabilities = stackalloc sbyte[(UIntPtr)12];
			int totalWeight = 0;
			for (int i = 0; i < 12; i++)
			{
				int featureId = 171 + i;
				sbyte appearProb = CharacterFeature.Instance[featureId].AppearProb;
				pProbabilities[i] = appearProb;
				totalWeight += (int)appearProb;
			}
			int index = CollectionUtils.GetRandomWeightedElement(random, pProbabilities, 12, totalWeight);
			return (short)(171 + index);
		}

		// Token: 0x06007152 RID: 29010 RVA: 0x00412C6C File Offset: 0x00410E6C
		public static short GetMergeableFeatureIdByLevel(short groupId, sbyte level)
		{
			bool flag = level > 0;
			short result;
			if (flag)
			{
				result = groupId + (short)(level - 1);
			}
			else
			{
				bool flag2 = level < 0;
				if (flag2)
				{
					result = groupId + (short)(2 - level);
				}
				else
				{
					result = -1;
				}
			}
			return result;
		}

		// Token: 0x06007153 RID: 29011 RVA: 0x00412CA4 File Offset: 0x00410EA4
		[return: TupleElementNames(new string[]
		{
			"groupId",
			"featureId"
		})]
		public static ValueTuple<short, short> GetRandomBasicFeature(IRandomSource random, bool isProtagonist, sbyte gender, bool isPositive, Dictionary<short, short> featureGroup2Id)
		{
			List<short> featuresPool = isProtagonist ? (isPositive ? CharacterDomain._protagonistPositiveBasicFeaturesPool : CharacterDomain._protagonistNegativeBasicFeaturesPool) : (isPositive ? CharacterDomain._normalPositiveBasicFeaturesPool : CharacterDomain._normalNegativeBasicFeaturesPool);
			return CharacterDomain.GetRandomFeatureFromPool(random, gender, featuresPool, featureGroup2Id);
		}

		// Token: 0x06007154 RID: 29012 RVA: 0x00412CE4 File Offset: 0x00410EE4
		[return: TupleElementNames(new string[]
		{
			"groupId",
			"featureId"
		})]
		public static ValueTuple<short, short> GetRandomBasicFeature(IRandomSource random, bool isProtagonist, sbyte gender, bool isPositive, sbyte medalType, Dictionary<short, short> featureGroup2Id, sbyte maxLevel = 3)
		{
			List<short> featuresPool = isProtagonist ? (isPositive ? CharacterDomain._protagonistPositiveBasicFeaturesPool : CharacterDomain._protagonistNegativeBasicFeaturesPool) : (isPositive ? CharacterDomain._normalPositiveBasicFeaturesPool : CharacterDomain._normalNegativeBasicFeaturesPool);
			List<short> actualPool = featuresPool;
			bool flag = medalType != 3 && isPositive;
			if (flag)
			{
				actualPool = ObjectPool<List<short>>.Instance.Get();
				actualPool.Clear();
				foreach (short featureId in featuresPool)
				{
					bool flag2 = CharacterFeature.Instance[featureId].FeatureMedals[(int)medalType].Values.Count > 0 && CharacterFeature.Instance[featureId].Level <= maxLevel;
					if (flag2)
					{
						actualPool.Add(featureId);
					}
				}
			}
			ValueTuple<short, short> result = CharacterDomain.GetRandomFeatureFromPool(random, gender, actualPool, featureGroup2Id);
			bool flag3 = actualPool != featuresPool;
			if (flag3)
			{
				ObjectPool<List<short>>.Instance.Return(actualPool);
			}
			return result;
		}

		// Token: 0x06007155 RID: 29013 RVA: 0x00412DF4 File Offset: 0x00410FF4
		[return: TupleElementNames(new string[]
		{
			"groupId",
			"featureId"
		})]
		public static ValueTuple<short, short> GetRandomFeatureFromPool(IRandomSource random, sbyte gender, List<short> featuresPool, Dictionary<short, short> featureGroup2Id)
		{
			int featuresPoolCount = featuresPool.Count;
			int maxTryCount = featuresPoolCount;
			for (int i = 0; i < maxTryCount; i++)
			{
				short featureId = featuresPool[random.Next(featuresPoolCount)];
				CharacterFeatureItem template = CharacterFeature.Instance[featureId];
				bool flag = featureGroup2Id.ContainsKey(template.MutexGroupId);
				if (!flag)
				{
					bool flag2 = template.Gender != -1 && template.Gender != gender;
					if (!flag2)
					{
						return new ValueTuple<short, short>(template.MutexGroupId, featureId);
					}
				}
			}
			CharacterDomain.Logger.Warn("GetRandomBasicFeature: give up due to exceeding maxTryCount.");
			return new ValueTuple<short, short>(-1, -1);
		}

		// Token: 0x1700047C RID: 1148
		// (get) Token: 0x06007156 RID: 29014 RVA: 0x00412E9E File Offset: 0x0041109E
		public CharacterSortFilter CharacterSortFilter
		{
			get
			{
				return this._characterSortFilter;
			}
		}

		// Token: 0x06007157 RID: 29015 RVA: 0x00412EA8 File Offset: 0x004110A8
		[DomainMethod]
		public CharacterList InitializeCharacterSortFilter(CharacterSortFilterSettings sortFilterSettings)
		{
			this._characterSortFilter = new CharacterSortFilter(sortFilterSettings, "CN");
			return this._characterSortFilter.GetCharacterList(sortFilterSettings.FilterSubId);
		}

		// Token: 0x06007158 RID: 29016 RVA: 0x00412EDC File Offset: 0x004110DC
		[DomainMethod]
		public CharacterList UpdateSortFilterSettings(CharacterSortFilterSettings sortFilterSettings)
		{
			bool flag = this._characterSortFilter == null || !this._characterSortFilter.CheckFilterSettingsMatch(sortFilterSettings);
			if (flag)
			{
				this._characterSortFilter = new CharacterSortFilter(sortFilterSettings, "CN");
			}
			this._characterSortFilter.Sort(sortFilterSettings);
			return this._characterSortFilter.GetCharacterList(sortFilterSettings.FilterSubId);
		}

		// Token: 0x06007159 RID: 29017 RVA: 0x00412F3C File Offset: 0x0041113C
		[DomainMethod]
		public CharacterList FindNameInCurrentSortFilter(string name)
		{
			CharacterSortFilter characterSortFilter = this._characterSortFilter;
			return (characterSortFilter != null) ? characterSortFilter.FindByName(name) : default(CharacterList);
		}

		// Token: 0x0600715A RID: 29018 RVA: 0x00412F69 File Offset: 0x00411169
		[DomainMethod]
		public void ClearCharacterSortFilter()
		{
			this._characterSortFilter = null;
		}

		// Token: 0x0600715B RID: 29019 RVA: 0x00412F74 File Offset: 0x00411174
		[DomainMethod]
		public List<int> GetFilteredCharacterCounts()
		{
			CharacterSortFilter characterSortFilter = this._characterSortFilter;
			return (characterSortFilter != null) ? characterSortFilter.GetCounts() : null;
		}

		// Token: 0x0600715C RID: 29020 RVA: 0x00412F98 File Offset: 0x00411198
		[DomainMethod]
		public List<int> GetMaxSortingTypeCharIds(List<int> sortingTypes, sbyte filterSubId)
		{
			CharacterSortFilter characterSortFilter = this._characterSortFilter;
			return (characterSortFilter != null) ? characterSortFilter.GetMaxSortingTypeCharIds(sortingTypes, filterSubId) : null;
		}

		// Token: 0x0600715D RID: 29021 RVA: 0x00412FC0 File Offset: 0x004111C0
		private void InitializeFixedCharactersCache()
		{
			this._fixedCharactersCache = new Dictionary<short, int>();
			this._convertedFixedCharactersCache = new Dictionary<short, int>();
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				bool flag = Character.Instance[character.GetTemplateId()].CreatingType > 0;
				if (!flag)
				{
					OrganizationInfo organizationInfo = character.GetOrganizationInfo();
					bool flag2 = organizationInfo.OrgTemplateId == 16 && organizationInfo.Grade == 8;
					if (!flag2)
					{
						bool flag3 = character.GetCreatingType() == 0;
						if (flag3)
						{
							this._fixedCharactersCache.Add(character.GetTemplateId(), charId);
						}
						else
						{
							bool flag4 = !this._convertedFixedCharactersCache.TryAdd(character.GetTemplateId(), charId);
							if (flag4)
							{
								Logger logger = CharacterDomain.Logger;
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(45, 1);
								defaultInterpolatedStringHandler.AppendLiteral("Duplicate converted fixed character detected ");
								defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
								logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
							}
						}
					}
				}
			}
		}

		// Token: 0x0600715E RID: 29022 RVA: 0x004130FC File Offset: 0x004112FC
		[DomainMethod]
		public int GetFixedCharacterIdByTemplateId(short templateId)
		{
			int charId;
			bool flag = this._fixedCharactersCache.TryGetValue(templateId, out charId);
			int result;
			if (flag)
			{
				result = charId;
			}
			else
			{
				result = -1;
			}
			return result;
		}

		// Token: 0x0600715F RID: 29023 RVA: 0x00413128 File Offset: 0x00411328
		public bool TryGetConvertedFixedCharacterByTemplateId(short templateId, out Character character)
		{
			int charId;
			bool flag = this._convertedFixedCharactersCache.TryGetValue(templateId, out charId);
			bool result;
			if (flag)
			{
				result = this._objects.TryGetValue(charId, out character);
			}
			else
			{
				character = null;
				result = false;
			}
			return result;
		}

		// Token: 0x06007160 RID: 29024 RVA: 0x00413164 File Offset: 0x00411364
		public bool TryGetFixedCharacterByTemplateId(short templateId, out Character character)
		{
			Tester.Assert(Character.Instance[templateId].CreatingType == 0, "");
			int charId;
			bool flag = this._fixedCharactersCache.TryGetValue(templateId, out charId);
			bool result;
			if (flag)
			{
				character = this._objects[charId];
				result = true;
			}
			else
			{
				character = null;
				result = false;
			}
			return result;
		}

		// Token: 0x06007161 RID: 29025 RVA: 0x004131C0 File Offset: 0x004113C0
		public Character GetOrCreateFixedCharacterByTemplateId(DataContext context, short templateId)
		{
			Tester.Assert(Character.Instance[templateId].CreatingType == 0, "");
			int charId;
			bool flag = this._fixedCharactersCache.TryGetValue(templateId, out charId);
			Character result;
			if (flag)
			{
				result = this._objects[charId];
			}
			else
			{
				Character fixedCharacter = this.CreateFixedCharacter(context, templateId);
				this.CompleteCreatingCharacter(fixedCharacter.GetId());
				result = fixedCharacter;
			}
			return result;
		}

		// Token: 0x06007162 RID: 29026 RVA: 0x00413228 File Offset: 0x00411428
		public void RegisterFeatureForAllXiangshuAvatars(DataContext context, short featureId)
		{
			foreach (KeyValuePair<short, int> keyValuePair in this._fixedCharactersCache)
			{
				short num;
				int num2;
				keyValuePair.Deconstruct(out num, out num2);
				short templateId = num;
				int fixedCharId = num2;
				CharacterItem charCfg = Character.Instance[templateId];
				bool flag = charCfg.XiangshuType == 1;
				if (flag)
				{
					Character character = this._objects[fixedCharId];
					character.AddFeature(context, featureId, false);
				}
			}
		}

		// Token: 0x06007163 RID: 29027 RVA: 0x004132C4 File Offset: 0x004114C4
		public void UnregisterFeatureForAllXiangshuAvatars(DataContext context, short featureId)
		{
			foreach (KeyValuePair<short, int> keyValuePair in this._fixedCharactersCache)
			{
				short num;
				int num2;
				keyValuePair.Deconstruct(out num, out num2);
				short templateId = num;
				int fixedCharId = num2;
				CharacterItem charCfg = Character.Instance[templateId];
				bool flag = charCfg.XiangshuType == 1;
				if (flag)
				{
					Character character = this._objects[fixedCharId];
					character.RemoveFeature(context, featureId);
				}
			}
		}

		// Token: 0x06007164 RID: 29028 RVA: 0x00413360 File Offset: 0x00411560
		public Character ReplaceFixedCharacter(DataContext context, short oldCharTemplateId, short newCharTemplateId)
		{
			Character oldChar = this.GetOrCreateFixedCharacterByTemplateId(context, oldCharTemplateId);
			Character newChar = this.GetOrCreateFixedCharacterByTemplateId(context, newCharTemplateId);
			Events.RaiseFixedCharacterLocationChanged(context, newChar.GetId(), newChar.GetLocation(), oldChar.GetLocation());
			newChar.SetLocation(oldChar.GetLocation(), context);
			int taiwuId = DomainManager.Taiwu.GetTaiwuCharId();
			short favorability = this.GetFavorability(oldChar.GetId(), taiwuId);
			bool flag = favorability != short.MinValue;
			if (flag)
			{
				this.SetFavorability(context, newChar.GetId(), taiwuId, favorability);
				this.SetFavorability(context, taiwuId, newChar.GetId(), favorability);
			}
			DomainManager.Character.RemoveNonIntelligentCharacter(context, oldChar);
			return newChar;
		}

		// Token: 0x06007165 RID: 29029 RVA: 0x00413408 File Offset: 0x00411608
		[DomainMethod]
		public void MoveFuyuHiltLocation(DataContext context, Location targetLocation, bool hide = false)
		{
			int fuyuHiltId = this.GetFixedCharacterIdByTemplateId(684);
			Character fuyuHilt = this._objects[fuyuHiltId];
			if (hide)
			{
				Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
				bool flag = !targetLocation.Equals(taiwuVillageLocation);
				if (!flag)
				{
					this.RemoveNonIntelligentCharacter(context, fuyuHilt);
					Character character = DomainManager.Character.CreateFixedCharacter(context, 685);
					DomainManager.Character.CompleteCreatingCharacter(character.GetId());
					AvatarRelatedData avatarRelatedData = DomainManager.Extra.GetOverwrittenTaiwuAvatarRelatedData();
					character.SetAvatar(avatarRelatedData.AvatarData, context);
					character.SetCurrAge(avatarRelatedData.DisplayAge, context);
					character.SetFullName(DomainManager.Extra.GetOverwrittenTaiwuName().FullName, context);
					short clothingTemplateId = DomainManager.Item.GetClothingItemByDisplayId(avatarRelatedData.ClothingDisplayId).TemplateId;
					character.ForceReplaceClothing(context, clothingTemplateId);
					Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), character.GetLocation(), targetLocation);
					character.SetLocation(targetLocation, context);
				}
			}
			else
			{
				Events.RaiseFixedCharacterLocationChanged(context, fuyuHilt.GetId(), fuyuHilt.GetLocation(), targetLocation);
				fuyuHilt.SetLocation(targetLocation, context);
			}
		}

		// Token: 0x06007166 RID: 29030 RVA: 0x0041352C File Offset: 0x0041172C
		[DomainMethod]
		public int GetOrCreateSwordTombCharacterIdForNormalInformation(DataContext context, sbyte xiangshuAvatarId)
		{
			sbyte xiangshuLevel = DomainManager.World.GetXiangshuLevel();
			short xiangshuTemplateId = XiangshuAvatarIds.GetCurrentLevelXiangshuTemplateId(xiangshuAvatarId, xiangshuLevel, false);
			Character character = this.GetOrCreateFixedCharacterByTemplateId(context, xiangshuTemplateId);
			return character.GetId();
		}

		// Token: 0x06007167 RID: 29031 RVA: 0x00413564 File Offset: 0x00411764
		[DomainMethod]
		public void GmCmd_SimulateNpcCombat(DataContext context, int charIdA, int charIdB, sbyte combatType, int killBaseChance, int kidnapBaseChance, int releaseBaseChance)
		{
			Character charA = this.GetElement_Objects(charIdA);
			Character charB = this.GetElement_Objects(charIdB);
			AiHelper.NpcCombatResultType resultType = this.SimulateCharacterCombat(context, charA, charB, (CombatType)combatType, true, 1);
			bool flag = resultType <= AiHelper.NpcCombatResultType.MinorVictory;
			bool flag2 = flag;
			if (flag2)
			{
				this.SimulateCharacterCombatResult(context, charA, charB, killBaseChance, kidnapBaseChance, releaseBaseChance);
			}
			else
			{
				this.SimulateCharacterCombatResult(context, charB, charA, killBaseChance, kidnapBaseChance, releaseBaseChance);
			}
		}

		// Token: 0x06007168 RID: 29032 RVA: 0x004135C8 File Offset: 0x004117C8
		[DomainMethod]
		public List<CharIdAndName> GmCmd_GetAllCharacterName()
		{
			List<CharIdAndName> ret = new List<CharIdAndName>();
			foreach (int charId in this._objects.Keys)
			{
				ValueTuple<string, string> realName = this.GetRealName(charId);
				string surname = realName.Item1;
				string givenName = realName.Item2;
				ret.Add(new CharIdAndName(charId, surname + givenName));
			}
			return ret;
		}

		// Token: 0x06007169 RID: 29033 RVA: 0x00413658 File Offset: 0x00411858
		[DomainMethod]
		public void GmCmd_ChangeFavorability(DataContext context, int selfCharId, int relatedCharId, short delta)
		{
			Character selfChar = this.GetElement_Objects(selfCharId);
			Character relatedChar = this.GetElement_Objects(relatedCharId);
			this.DirectlyChangeFavorabilityOptional(context, selfChar, relatedChar, (int)delta, -1);
		}

		// Token: 0x0600716A RID: 29034 RVA: 0x00413684 File Offset: 0x00411884
		[DomainMethod]
		public void GmCmd_ClearFameActionRecords(DataContext context, int charId)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			List<FameActionRecord> fameActionRecords = character.GetFameActionRecords();
			fameActionRecords.Clear();
			character.SetFameActionRecords(fameActionRecords, context);
		}

		// Token: 0x0600716B RID: 29035 RVA: 0x004136E8 File Offset: 0x004118E8
		[DomainMethod]
		public void GmCmd_RecordFameAction(DataContext context, int charId, short fameActionId, int targetCharId = -1, short fameMultiplier = 1)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			character.RecordFameAction(context, fameActionId, targetCharId, fameMultiplier, true);
		}

		// Token: 0x0600716C RID: 29036 RVA: 0x00413744 File Offset: 0x00411944
		[DomainMethod]
		public void GmCmd_AddCharacterExtraTitle(DataContext context, int charId, short titleTemplateId, int duration = -1)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			DomainManager.Extra.AddCharacterExtraTitle(context, charId, titleTemplateId, DomainManager.World.GetCurrDate() + duration);
		}

		// Token: 0x0600716D RID: 29037 RVA: 0x004137AC File Offset: 0x004119AC
		[DomainMethod]
		public void GmCmd_CreateRandomIntelligentCharacters(DataContext context, int charCount, sbyte orgTemplateId, bool createHere)
		{
			IRandomSource random = context.Random;
			CharacterDomain.<>c__DisplayClass383_0 CS$<>8__locals1;
			CS$<>8__locals1.orgConfig = Organization.Instance[orgTemplateId];
			CS$<>8__locals1.settlement = DomainManager.Organization.GetSettlementByOrgTemplateId(orgTemplateId);
			CS$<>8__locals1.gradePrincipalFullList = new BitArray(8, false);
			for (int i = 0; i < charCount; i++)
			{
				sbyte grade = (sbyte)random.Next(0, 8);
				bool flag = orgTemplateId == 16;
				if (flag)
				{
					grade = 0;
				}
				while (grade > 0 && CharacterDomain.<GmCmd_CreateRandomIntelligentCharacters>g__CheckPrincipalFull|383_0(grade, ref CS$<>8__locals1))
				{
					grade -= 1;
				}
				short orgMemberId = CS$<>8__locals1.orgConfig.Members[(int)grade];
				OrganizationMemberItem orgMemberInfo = OrganizationMember.Instance[orgMemberId];
				Location location;
				short areaId;
				if (createHere)
				{
					location = DomainManager.Taiwu.GetTaiwu().GetLocation();
					areaId = ((CS$<>8__locals1.settlement == null) ? ((short)random.Next(45)) : CS$<>8__locals1.settlement.GetLocation().AreaId);
				}
				else
				{
					bool flag2 = CS$<>8__locals1.settlement == null;
					if (flag2)
					{
						areaId = (short)random.Next(45);
						short blockId = DomainManager.Map.GetMainSettlementMainBlockId(areaId);
						location = new Location(areaId, blockId);
					}
					else
					{
						location = CS$<>8__locals1.settlement.GetLocation();
					}
					areaId = location.AreaId;
				}
				short settlementId = DomainManager.Organization.GetSettlementIdByOrgTemplateId(orgTemplateId);
				sbyte mapStateTemplateId = DomainManager.Map.GetStateTemplateIdByAreaId(areaId);
				sbyte gender = (orgMemberInfo.Gender == -1) ? Gender.GetRandom(random) : orgMemberInfo.Gender;
				short charTemplateId = Organization.Instance[orgTemplateId].CharTemplateIds[(int)gender];
				bool flag3 = charTemplateId < 0;
				if (flag3)
				{
					charTemplateId = MapDomain.GetCharacterTemplateId(mapStateTemplateId, gender);
				}
				IntelligentCharacterCreationInfo info = new IntelligentCharacterCreationInfo(location, new OrganizationInfo(orgTemplateId, grade, true, settlementId), charTemplateId);
				Character character = DomainManager.Character.CreateIntelligentCharacter(context, ref info);
				DomainManager.Character.CompleteCreatingCharacter(character.GetId());
			}
		}

		// Token: 0x0600716E RID: 29038 RVA: 0x00413990 File Offset: 0x00411B90
		[DomainMethod]
		public void GmCmd_ForceChangeOrganization(DataContext context, int charId, sbyte orgTemplateId)
		{
			short settlementId = DomainManager.Organization.GetSettlementIdByOrgTemplateId(orgTemplateId);
			OrganizationInfo orgInfo = new OrganizationInfo(orgTemplateId, 0, true, settlementId);
			this.GmCmd_ForceChangeOrganization(context, charId, orgInfo);
		}

		// Token: 0x0600716F RID: 29039 RVA: 0x004139C0 File Offset: 0x00411BC0
		[DomainMethod]
		public bool GmCmd_ForceChangeOrganizationByName(DataContext context, int charId, string settlementName)
		{
			List<Settlement> list = new List<Settlement>();
			DomainManager.Organization.GetAllSettlements(list);
			foreach (Settlement settlement in list)
			{
				bool flag = settlement.GetNameRelatedData().GetName() == settlementName;
				if (flag)
				{
					this.GmCmd_ForceChangeOrganization(context, charId, new OrganizationInfo(settlement.GetOrgTemplateId(), 0, true, settlement.GetId()));
					return true;
				}
			}
			return false;
		}

		// Token: 0x06007170 RID: 29040 RVA: 0x00413A60 File Offset: 0x00411C60
		private void GmCmd_ForceChangeOrganization(DataContext context, int charId, OrganizationInfo info)
		{
			Character character = DomainManager.Character.GetElement_Objects(charId);
			bool flag = character.GetOrganizationInfo().OrgTemplateId == info.OrgTemplateId;
			if (!flag)
			{
				bool flag2 = info.OrgTemplateId == 16;
				if (flag2)
				{
					bool flag3 = charId == DomainManager.Taiwu.GetTaiwuCharId();
					if (flag3)
					{
						OrganizationInfo groupInfo = new OrganizationInfo(info.OrgTemplateId, 0, true, info.SettlementId);
						info.Grade = 8;
						EventHelper.SetGroupOrganization(groupInfo);
					}
				}
				DomainManager.Organization.ChangeOrganization(context, character, info);
			}
		}

		// Token: 0x06007171 RID: 29041 RVA: 0x00413AEC File Offset: 0x00411CEC
		[DomainMethod]
		public bool GmCmd_ForceChangeGrade(DataContext context, int charId, sbyte grade, bool principal)
		{
			Character character = DomainManager.Character.GetElement_Objects(charId);
			OrganizationInfo oriOrgInfo = character.GetOrganizationInfo();
			bool flag = oriOrgInfo.SettlementId < 0;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = grade == 8 && principal;
				if (flag2)
				{
					sbyte orgTemplateId = character.GetOrganizationInfo().OrgTemplateId;
					OrganizationItem orgConfig = Organization.Instance[orgTemplateId];
					short orgMemberId = orgConfig.Members[8];
					OrganizationMemberItem orgMemberConfig = OrganizationMember.Instance[orgMemberId];
					int principalAmount = 0;
					Settlement settlement = DomainManager.Organization.GetSettlement(oriOrgInfo.SettlementId);
					OrgMemberCollection members = settlement.GetMembers();
					HashSet<int> gradeMembers = members.GetMembers(8);
					foreach (int memberCharId in gradeMembers)
					{
						Character member;
						bool flag3 = DomainManager.Character.TryGetElement_Objects(memberCharId, out member) && member.GetOrganizationInfo().Principal;
						if (flag3)
						{
							principalAmount++;
						}
					}
					bool flag4 = principalAmount >= (int)orgMemberConfig.Amount;
					if (flag4)
					{
						return false;
					}
				}
				DomainManager.Organization.ChangeGrade(context, character, grade, principal);
				int spouseId = DomainManager.Character.GetAliveSpouse(charId);
				bool flag5 = spouseId >= 0;
				if (flag5)
				{
					Character spouse = DomainManager.Character.GetElement_Objects(spouseId);
					DomainManager.Organization.UpdateGradeAccordingToSpouse(context, spouse, character);
				}
				result = true;
			}
			return result;
		}

		// Token: 0x06007172 RID: 29042 RVA: 0x00413C64 File Offset: 0x00411E64
		[DomainMethod]
		public void GmCmd_Die(DataContext context, int charId)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			bool flag2 = charId == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag2)
			{
				EventHelper.TriggerLegacyPassingEvent(true, "");
			}
			else
			{
				this.MakeCharacterDead(context, character, 0);
			}
			DomainManager.TaiwuEvent.GMCharacterDie(charId);
		}

		// Token: 0x06007173 RID: 29043 RVA: 0x00413CE4 File Offset: 0x00411EE4
		[DomainMethod]
		public void GmCmd_ResetHairGrowth(DataContext context, int charId)
		{
			Character shavedCharacter;
			bool flag = !this.TryGetElement_Objects(charId, out shavedCharacter);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			AvatarData srcData = shavedCharacter.GetAvatar();
			srcData.ResetGrowableElementShowingState(0);
			DomainManager.Character.InitializeAvatarElementGrowthProgress(context, charId, 0);
			shavedCharacter.SetAvatar(srcData, context);
		}

		// Token: 0x06007174 RID: 29044 RVA: 0x00413D58 File Offset: 0x00411F58
		[DomainMethod]
		public int GmCmd_GetAliveCharByPreexistenceChar(int preexistenceCharId)
		{
			Character character = CharacterDomain.GmCmd_GetAliveCharByPreexistenceCharInternal(preexistenceCharId);
			bool flag = character == null;
			int result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				result = character.GetId();
			}
			return result;
		}

		// Token: 0x06007175 RID: 29045 RVA: 0x00413D84 File Offset: 0x00411F84
		private static Character GmCmd_GetAliveCharByPreexistenceCharInternal(int preexistenceCharId)
		{
			List<Character> characters = new List<Character>();
			DomainManager.Character.FindIntelligentCharacters((Character character) => CharacterMatchers.MatchPreexistenceChar(character, preexistenceCharId), characters);
			bool flag = characters.Count > 1;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(52, 1);
				defaultInterpolatedStringHandler.AppendLiteral("More than one alive character own the preexistence: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(preexistenceCharId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			bool flag2 = characters.Count == 1;
			Character result;
			if (flag2)
			{
				result = characters[0];
			}
			else
			{
				result = null;
			}
			return result;
		}

		// Token: 0x06007176 RID: 29046 RVA: 0x00413E20 File Offset: 0x00412020
		[DomainMethod]
		public unsafe void GmCmd_LogCharacterSamsaraInfo()
		{
			foreach (KeyValuePair<int, Character> pair in this._objects)
			{
				PreexistenceCharIds preexistenceCharIds = *pair.Value.GetPreexistenceCharIds();
				bool flag = preexistenceCharIds.Count > 0;
				if (flag)
				{
					ValueTuple<string, string> realName = this.GetRealName(pair.Value.GetId());
					string surName = realName.Item1;
					string givenName = realName.Item2;
					Location location = pair.Value.GetLocation();
					MapAreaData areaData = DomainManager.Map.GetElement_Areas((int)location.AreaId);
					MapBlockData blockData = DomainManager.Map.GetBlockData(location.AreaId, location.BlockId);
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 5);
					defaultInterpolatedStringHandler.AppendFormatted(areaData.GetConfig().Name);
					defaultInterpolatedStringHandler.AppendLiteral(" ");
					defaultInterpolatedStringHandler.AppendFormatted(blockData.GetConfig().Name);
					defaultInterpolatedStringHandler.AppendLiteral(": ");
					defaultInterpolatedStringHandler.AppendFormatted(surName);
					defaultInterpolatedStringHandler.AppendFormatted(givenName);
					defaultInterpolatedStringHandler.AppendLiteral(" preexistenceCharIds.Count = ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(preexistenceCharIds.Count);
					logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
		}

		// Token: 0x06007177 RID: 29047 RVA: 0x00413F90 File Offset: 0x00412190
		public unsafe void GmCmd_KillSamsara(DataContext context)
		{
			List<int> list = new List<int>();
			foreach (KeyValuePair<int, Character> pair in this._objects)
			{
				bool flag = pair.Value.GetCreatingType() == 1;
				if (flag)
				{
					PreexistenceCharIds preexistenceCharIds = *pair.Value.GetPreexistenceCharIds();
					bool flag2 = preexistenceCharIds.Count > 0;
					if (flag2)
					{
						list.Add(pair.Value.GetId());
					}
				}
			}
			foreach (int i in list)
			{
				this.GmCmd_Die(context, i);
			}
		}

		// Token: 0x06007178 RID: 29048 RVA: 0x0041407C File Offset: 0x0041227C
		[DomainMethod]
		public unsafe void GmCmd_EditExtraNeiliAllocation(DataContext context, int characterId, NeiliAllocation allocation)
		{
			Character character = DomainManager.Character.GetElement_Objects(characterId);
			IntList progress = IntList.Create();
			for (int i = 0; i < 4; i++)
			{
				progress.Items.Add(CombatSkillDomain.GetExtraNeiliAllocationProgressByExtraNeiliAllocation((int)(*(ref allocation.Items.FixedElementField + (IntPtr)i * 2))));
			}
			DomainManager.CombatSkill.SetCharacterExtraNeiliAllocationAndProgress(context, character, progress, true);
		}

		// Token: 0x06007179 RID: 29049 RVA: 0x004140E0 File Offset: 0x004122E0
		[DomainMethod]
		public void GmCmd_MakeCharacterKidnapped(DataContext context, int characterId, int targetCharacterId)
		{
			Character character = DomainManager.Character.GetElement_Objects(characterId);
			Character targetCharacter = DomainManager.Character.GetElement_Objects(targetCharacterId);
			ItemKey itemKey = DomainManager.Item.CreateItem(context, 12, 73);
			character.AddInventoryItem(context, itemKey, 1, false);
			bool flag = DomainManager.Taiwu.IsInGroup(targetCharacterId);
			if (flag)
			{
				DomainManager.Taiwu.LeaveGroup(context, targetCharacterId, false, true, true);
			}
			this.AddKidnappedCharacter(context, character, targetCharacter, itemKey);
		}

		// Token: 0x0600717A RID: 29050 RVA: 0x0041414C File Offset: 0x0041234C
		[DomainMethod]
		public bool GmCmd_MoveIntelligentCharacter(DataContext context, int charId, Location destLocation)
		{
			Grave grave;
			bool flag = DomainManager.Character.TryGetElement_Graves(charId, out grave);
			bool result;
			if (flag)
			{
				Events.RaiseGraveLocationChanged(context, charId, grave.GetLocation(), destLocation);
				grave.SetLocation(destLocation, context);
				result = true;
			}
			else
			{
				bool flag2 = charId == DomainManager.Taiwu.GetTaiwuCharId();
				if (flag2)
				{
					result = false;
				}
				else
				{
					Character character = this.GetElement_Objects(charId);
					bool flag3 = character.GetCreatingType() == 0;
					if (flag3)
					{
						Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), character.GetLocation(), destLocation);
						character.SetLocation(destLocation, context);
						result = true;
					}
					else
					{
						Tester.Assert(character.GetCreatingType() == 1, "");
						Tester.Assert(!this.IsTemporaryIntelligentCharacter(charId), "");
						bool flag4 = !character.GetLocation().IsValid();
						if (flag4)
						{
							result = false;
						}
						else
						{
							int leaderId = character.GetLeaderId();
							bool flag5 = leaderId == DomainManager.Taiwu.GetTaiwuCharId();
							if (flag5)
							{
								result = false;
							}
							else
							{
								bool flag6 = leaderId >= 0;
								if (flag6)
								{
									this.LeaveGroup(context, character, true);
								}
								this.GroupMove(context, character, destLocation);
								result = true;
							}
						}
					}
				}
			}
			return result;
		}

		// Token: 0x0600717B RID: 29051 RVA: 0x00414274 File Offset: 0x00412474
		[DomainMethod]
		public void GmCmd_RandomizeRelationShipsInSettlement(DataContext context, sbyte orgTemplateId)
		{
			ushort[] candidateRelationTypes = new ushort[]
			{
				64,
				512,
				1024,
				2048,
				4096,
				8192,
				16384,
				32768
			};
			short settlementId = DomainManager.Organization.GetSettlementIdByOrgTemplateId(orgTemplateId);
			List<int> charIds = new List<int>();
			DomainManager.Organization.GetSettlement(settlementId).GetMembers().GetAllMembers(charIds);
			foreach (int charId in charIds)
			{
				int relatedCharId = charIds[context.Random.Next(charIds.Count)];
				bool flag = relatedCharId == charId;
				if (!flag)
				{
					int spouseCharId = this.GetLastSpouse(relatedCharId);
					bool flag2 = spouseCharId >= 0 && spouseCharId == charId;
					if (!flag2)
					{
						ushort relationType = candidateRelationTypes[context.Random.Next(candidateRelationTypes.Length)];
						bool flag3 = !RelationTypeHelper.AllowAddingRelation(charId, relatedCharId, relationType);
						if (!flag3)
						{
							ushort num = relationType;
							ushort num2 = num;
							if (num2 != 64)
							{
								if (num2 != 1024)
								{
									this.AddRelation(context, charId, relatedCharId, relationType, int.MinValue);
								}
								else
								{
									this.AddHusbandOrWifeRelations(context, charId, relatedCharId, int.MinValue);
								}
							}
							else
							{
								this.AddAdoptiveParentRelations(context, charId, relatedCharId, int.MinValue);
								bool flag4 = spouseCharId >= 0;
								if (flag4)
								{
									this.AddAdoptiveParentRelations(context, charId, spouseCharId, int.MinValue);
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x0600717C RID: 29052 RVA: 0x004143F8 File Offset: 0x004125F8
		[DomainMethod]
		public void GmCmd_MakeCharacterHaveSex(DataContext context, int selfCharId, int targetCharId, bool isRaped, int pregnantRemainTime)
		{
			Character selfCharacter;
			Character targetCharacter;
			bool flag = this.TryGetElement_Objects(selfCharId, out selfCharacter) && this.TryGetElement_Objects(targetCharId, out targetCharacter) && selfCharacter.GetGender() != targetCharacter.GetGender();
			if (flag)
			{
				Character father = (selfCharacter.GetGender() == 1) ? selfCharacter : targetCharacter;
				Character mother = (selfCharacter.GetGender() == 0) ? selfCharacter : targetCharacter;
				mother.AddFeature(context, 196, true);
				father.AddFeature(context, 196, true);
				int num;
				bool flag2 = !mother.GetFeatureIds().Contains(197) && selfCharacter.GetFertility() > 0 && targetCharacter.GetFertility() > 0 && !this.TryGetElement_PregnancyLockEndDates(mother.GetId(), out num);
				if (flag2)
				{
					this.CreatePregnantState(context, mother, father, isRaped);
					PregnantState pregnantState;
					bool flag3 = this.TryGetElement_PregnantStates(mother.GetId(), out pregnantState);
					if (flag3)
					{
						int currDate = DomainManager.World.GetCurrDate();
						pregnantState.ExpectedBirthDate = currDate + pregnantRemainTime;
						this.SetElement_PregnantStates(mother.GetId(), pregnantState, context);
					}
					mother.AddFeature(context, 197, true);
				}
			}
		}

		// Token: 0x0600717D RID: 29053 RVA: 0x00414510 File Offset: 0x00412710
		[DomainMethod]
		public int GmCmd_GetCharacterPregnancyLockEndDates(DataContext context, int charId)
		{
			int value;
			bool flag = this.TryGetElement_PregnancyLockEndDates(charId, out value);
			int result;
			if (flag)
			{
				result = value;
			}
			else
			{
				result = -1;
			}
			return result;
		}

		// Token: 0x0600717E RID: 29054 RVA: 0x00414538 File Offset: 0x00412738
		[DomainMethod]
		public List<int> GmCmd_GetCharacterActualBloodParents(DataContext context, int charId)
		{
			List<int> result = new List<int>();
			Character character;
			bool flag = this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				int fatherId = this.GetBloodParent(charId, 1);
				int motherId = this.GetBloodParent(charId, 0);
				result.Add(fatherId);
				result.Add(motherId);
				int actualFatherId;
				result.Add(this.TryGetActualBloodParent(fatherId, charId, out actualFatherId) ? actualFatherId : -1);
				int actualMotherId;
				result.Add(this.TryGetActualBloodParent(motherId, charId, out actualMotherId) ? actualMotherId : -1);
			}
			else
			{
				result.Add(-1);
				result.Add(-1);
				result.Add(-1);
				result.Add(-1);
			}
			return result;
		}

		// Token: 0x0600717F RID: 29055 RVA: 0x004145DC File Offset: 0x004127DC
		[DomainMethod]
		public List<List<CharacterDisplayData>> GmCmd_GetAllGroupMembers()
		{
			CharacterDomain characterDomain = DomainManager.Character;
			List<int> memberList = new List<int>();
			List<List<CharacterDisplayData>> result = new List<List<CharacterDisplayData>>();
			foreach (KeyValuePair<int, CharacterSet> group in this._characterGroups)
			{
				memberList.Clear();
				memberList.AddRange(group.Value.GetCollection());
				memberList.Remove(group.Key);
				memberList.Insert(0, group.Key);
				result.Add(characterDomain.GetCharacterDisplayDataList(memberList));
			}
			return result;
		}

		// Token: 0x06007180 RID: 29056 RVA: 0x00414690 File Offset: 0x00412890
		[DomainMethod]
		public void GmCmd_GenerateRandomRefinedItemToCharacter(DataContext context, int charId, sbyte itemType, int times)
		{
			Character character = this.GetElement_Objects(charId);
			IRandomSource r = context.Random;
			short[] materials = (from m in Config.Material.Instance
			where m.RefiningEffect >= 0
			select m.TemplateId).ToArray<short>();
			ItemDomain item = DomainManager.Item;
			if (!true)
			{
			}
			int num;
			switch (itemType)
			{
			case 0:
				num = r.Next(0, Config.Weapon.Instance.Count);
				break;
			case 1:
				num = r.Next(0, Config.Armor.Instance.Count);
				break;
			case 2:
				num = r.Next(0, Config.Accessory.Instance.Count);
				break;
			case 3:
				num = r.Next(0, Config.Clothing.Instance.Count);
				break;
			case 4:
				num = r.Next(0, Config.Carrier.Instance.Count);
				break;
			case 5:
				num = r.Next(0, Config.Material.Instance.Count);
				break;
			case 6:
				num = r.Next(0, Config.CraftTool.Instance.Count);
				break;
			case 7:
				num = r.Next(0, Config.Food.Instance.Count);
				break;
			case 8:
				num = r.Next(0, Config.Medicine.Instance.Count);
				break;
			case 9:
				num = r.Next(0, Config.TeaWine.Instance.Count);
				break;
			case 10:
				num = r.Next(0, Config.SkillBook.Instance.Count);
				break;
			case 11:
				num = r.Next(0, Config.Cricket.Instance.Count);
				break;
			case 12:
				num = r.Next(0, Config.Misc.Instance.Count);
				break;
			default:
				num = -1;
				break;
			}
			if (!true)
			{
			}
			ItemKey itemKey = item.CreateItem(context, itemType, (short)num);
			ItemBase itemBase = DomainManager.Item.GetBaseItem(itemKey);
			times = Math.Min(times, 5);
			for (int i = 0; i < times; i++)
			{
				itemBase = DomainManager.Item.SetRefinedEffects(context, itemBase, i, materials.GetRandom(r)).Item1;
			}
			character.AddInventoryItem(context, itemBase.GetItemKey(), 1, false);
		}

		// Token: 0x06007181 RID: 29057 RVA: 0x004148EC File Offset: 0x00412AEC
		[DomainMethod]
		public void GmCmd_ChangeInjury(DataContext context, int charId, bool isInnerInjury, sbyte bodyPartType, sbyte delta)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			character.ChangeInjury(context, bodyPartType, isInnerInjury, delta);
		}

		// Token: 0x06007182 RID: 29058 RVA: 0x00414944 File Offset: 0x00412B44
		[DomainMethod]
		public void GmCmd_SetCurReadingEvent(DataContext context, int charId)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			ItemKey book = DomainManager.Taiwu.GetCurReadingBook();
			DomainManager.Extra.AddReadingEventBookId(context, book.Id);
		}

		// Token: 0x06007183 RID: 29059 RVA: 0x004149B0 File Offset: 0x00412BB0
		[DomainMethod]
		public void GmCmd_SetCurLoopingEvent(DataContext context, int charId)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			DomainManager.Taiwu.AddLoopingEvent(context);
		}

		// Token: 0x06007184 RID: 29060 RVA: 0x00414A0C File Offset: 0x00412C0C
		[DomainMethod]
		public void GmCmd_ChangePoisonByType(DataContext context, int charId, sbyte poisonType, int changeValue)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			character.ChangePoisoned(context, poisonType, 3, changeValue);
		}

		// Token: 0x06007185 RID: 29061 RVA: 0x00414A64 File Offset: 0x00412C64
		[DomainMethod]
		public void GmCmd_AddFeature(DataContext context, int charId, short templateId)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			character.AddFeature(context, templateId, true);
		}

		// Token: 0x06007186 RID: 29062 RVA: 0x00414ABC File Offset: 0x00412CBC
		[DomainMethod]
		public void GmCmd_RemoveFeature(DataContext context, int charId, short templateId)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			character.RemoveFeature(context, templateId);
		}

		// Token: 0x06007187 RID: 29063 RVA: 0x00414B14 File Offset: 0x00412D14
		[DomainMethod]
		public void GmCmd_SetFeatures(DataContext context, int charId, List<short> features)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			character.SetFeatureIds(features, context);
		}

		// Token: 0x06007188 RID: 29064 RVA: 0x00414B68 File Offset: 0x00412D68
		[DomainMethod]
		public void GmCmd_SetAdventurePersonalities(DataContext context, int charId, int[] personalities)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			DomainManager.Adventure.SetPersonalities(personalities, context);
		}

		// Token: 0x06007189 RID: 29065 RVA: 0x00414BC4 File Offset: 0x00412DC4
		[DomainMethod]
		public void GmCmd_SetCurrNeili(DataContext context, int charId, int value)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			bool flag2 = value < 0 || value > character.GetMaxNeili();
			if (flag2)
			{
				Logger logger = CharacterDomain.Logger;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("The value must be in range : [0, ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetMaxNeili());
				defaultInterpolatedStringHandler.AppendLiteral("]");
				logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			else
			{
				character.SetCurrNeili(value, context);
			}
		}

		// Token: 0x0600718A RID: 29066 RVA: 0x00414C78 File Offset: 0x00412E78
		[DomainMethod]
		public void GmCmd_AddPoisonedInventoryItem(DataContext context, int charId, sbyte baseItemType, short baseItemId, short poisonId1, short poisonId2, short poisonId3)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			ItemKey itemKey = DomainManager.Item.CreateItem(context, baseItemType, baseItemId);
			ItemBase itemBase = DomainManager.Item.GetBaseItem(itemKey);
			ItemBase newItemObj = itemBase;
			bool flag2 = poisonId1 >= 0;
			if (flag2)
			{
				newItemObj = DomainManager.Item.SetAttachedPoisons(context, newItemObj, poisonId1, true, null).Item1;
			}
			bool flag3 = poisonId2 >= 0;
			if (flag3)
			{
				newItemObj = DomainManager.Item.SetAttachedPoisons(context, newItemObj, poisonId2, true, null).Item1;
			}
			bool flag4 = poisonId3 >= 0;
			if (flag4)
			{
				newItemObj = DomainManager.Item.SetAttachedPoisons(context, newItemObj, poisonId3, true, null).Item1;
			}
			DomainManager.Item.SetPoisonsIdentified(context, itemKey, true);
			character.AddInventoryItem(context, newItemObj.GetItemKey(), 1, false);
		}

		// Token: 0x0600718B RID: 29067 RVA: 0x00414D74 File Offset: 0x00412F74
		[DomainMethod]
		public void GmCmd_AddPoisonedEatingItem(DataContext context, int charId, sbyte baseItemType, short baseItemId, short poisonId1, short poisonId2, short poisonId3)
		{
			Character character;
			bool flag = !this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find character of id: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			ItemKey itemKey = DomainManager.Item.CreateItem(context, baseItemType, baseItemId);
			ItemBase itemBase = DomainManager.Item.GetBaseItem(itemKey);
			ItemBase newItemObj = itemBase;
			bool flag2 = poisonId1 >= 0;
			if (flag2)
			{
				newItemObj = DomainManager.Item.SetAttachedPoisons(context, newItemObj, poisonId1, true, null).Item1;
			}
			bool flag3 = poisonId2 >= 0;
			if (flag3)
			{
				newItemObj = DomainManager.Item.SetAttachedPoisons(context, newItemObj, poisonId2, true, null).Item1;
			}
			bool flag4 = poisonId3 >= 0;
			if (flag4)
			{
				newItemObj = DomainManager.Item.SetAttachedPoisons(context, newItemObj, poisonId3, true, null).Item1;
			}
			character.AddEatingItem(context, newItemObj.GetItemKey(), null);
		}

		// Token: 0x0600718C RID: 29068 RVA: 0x00414E60 File Offset: 0x00413060
		[DomainMethod]
		public void GmCmd_ForgetCombatSkill(DataContext context, int charId, short skillTemplateId)
		{
			Character character = this.GetElement_Objects(charId);
			List<short> learnedSkillTemplateIds = character.GetLearnedCombatSkills();
			bool flag = !learnedSkillTemplateIds.Contains(skillTemplateId);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(37, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Combat skill not learned. TemplateId:");
				defaultInterpolatedStringHandler.AppendFormatted<short>(skillTemplateId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			character.RemoveEquippedCombatSkill(context, skillTemplateId);
			bool flag2 = charId == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag2)
			{
				DomainManager.Taiwu.UnregisterCombatSkill(context, skillTemplateId);
				DomainManager.Taiwu.ClearBreakPlate(context, skillTemplateId, true);
			}
			DomainManager.CombatSkill.RemoveCombatSkill(charId, skillTemplateId);
			learnedSkillTemplateIds.Remove(skillTemplateId);
			character.SetLearnedCombatSkills(learnedSkillTemplateIds, context);
			CharacterDomain.TryRemoveCombatSkillFromAttainmentPanel(context, character, skillTemplateId);
		}

		// Token: 0x0600718D RID: 29069 RVA: 0x00414F18 File Offset: 0x00413118
		[DomainMethod]
		public void GmCmd_RevokeCombatSkill(DataContext context, int charId, List<short> skillTemplateIdList)
		{
			Character character;
			bool flag = DomainManager.Character.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				for (int i = 0; i < skillTemplateIdList.Count; i++)
				{
					short skillTemplateId = skillTemplateIdList[i];
					CombatSkillKey skillKey = new CombatSkillKey(charId, skillTemplateId);
					GameData.Domains.CombatSkill.CombatSkill skill = DomainManager.CombatSkill.GetElement_CombatSkills(skillKey);
					bool flag2 = !skill.GetRevoked();
					if (flag2)
					{
						DomainManager.Character.RevokeCombatSkill(context, character, skillTemplateIdList[i]);
					}
				}
			}
		}

		// Token: 0x0600718E RID: 29070 RVA: 0x00414F98 File Offset: 0x00413198
		[DomainMethod]
		public void GmCmd_SetLearnedLifeSkills(DataContext context, int charId, List<LifeSkillItem> learnedLifeSkills)
		{
			Character character = this.GetElement_Objects(charId);
			List<LifeSkillItem> prevLifeSkills = character.GetLearnedLifeSkills();
			using (List<LifeSkillItem>.Enumerator enumerator = learnedLifeSkills.GetEnumerator())
			{
				while (enumerator.MoveNext())
				{
					LifeSkillItem skill = enumerator.Current;
					bool flag = prevLifeSkills.Any((LifeSkillItem prev) => prev.SkillTemplateId == skill.SkillTemplateId);
					if (!flag)
					{
						bool flag2 = skill.IsAllPagesRead();
						if (flag2)
						{
							DomainManager.Information.GainLifeSkillInformationToCharacter(context, charId, LifeSkill.Instance[skill.SkillTemplateId].Type);
						}
					}
				}
			}
			character.SetLearnedLifeSkills(learnedLifeSkills, context);
			bool flag3 = DomainManager.Taiwu.GetTaiwuCharId() == charId;
			if (flag3)
			{
				HashSet<short> learnedSkillIds = new HashSet<short>();
				foreach (LifeSkillItem lifeSkill in learnedLifeSkills)
				{
					learnedSkillIds.Add(lifeSkill.SkillTemplateId);
					TaiwuLifeSkill taiwuLifeSkill;
					bool flag4 = DomainManager.Taiwu.TryGetTaiwuLifeSkill(lifeSkill.SkillTemplateId, out taiwuLifeSkill);
					if (flag4)
					{
						DomainManager.Taiwu.UnregisterLifeSkill(context, lifeSkill.SkillTemplateId);
					}
					DomainManager.Taiwu.RegisterLifeSkill(context, lifeSkill);
					DomainManager.Extra.CreateLifeSkillCombatCard(context, lifeSkill);
				}
				foreach (LifeSkillItem prevLifeSkill in prevLifeSkills)
				{
					TaiwuLifeSkill taiwuLifeSkill;
					bool flag5 = !learnedSkillIds.Contains(prevLifeSkill.SkillTemplateId) && DomainManager.Taiwu.TryGetTaiwuLifeSkill(prevLifeSkill.SkillTemplateId, out taiwuLifeSkill);
					if (flag5)
					{
						DomainManager.Taiwu.UnregisterLifeSkill(context, prevLifeSkill.SkillTemplateId);
					}
				}
			}
		}

		// Token: 0x0600718F RID: 29071 RVA: 0x00415188 File Offset: 0x00413388
		[DomainMethod]
		public void GmCmd_GetCricket(DataContext context, short colorId, short partId, int grade = -1, short winsCount = 0, short lossesCount = 0)
		{
			ItemKey itemKey = (grade == -1) ? DomainManager.Item.CreateCricket(context, colorId, partId) : DomainManager.Item.CreateCricket(context, (short)grade);
			GameData.Domains.Item.Cricket cricket = DomainManager.Item.GetElement_Crickets(itemKey.Id);
			cricket.SetWinsCount(winsCount, context);
			cricket.SetLossesCount(lossesCount, context);
			cricket.SetCurrDurability((short)context.Random.Next(0, (int)(cricket.GetMaxDurability() + 1)), context);
			DomainManager.Taiwu.GetTaiwu().AddInventoryItem(context, itemKey, 1, false);
		}

		// Token: 0x06007190 RID: 29072 RVA: 0x00415210 File Offset: 0x00413410
		[DomainMethod]
		public void GmCmd_AddRelation(DataContext context, int charId, int relatedCharId, ushort addingType)
		{
			if (addingType <= 8)
			{
				if (addingType == 1)
				{
					this.AddBloodParentRelations(context, charId, relatedCharId, (int)addingType);
					return;
				}
				if (addingType == 8)
				{
					this.AddStepParentRelations(context, charId, relatedCharId, (int)addingType);
					return;
				}
			}
			else
			{
				if (addingType == 64)
				{
					this.AddAdoptiveParentRelations(context, charId, relatedCharId, (int)addingType);
					return;
				}
				if (addingType == 1024)
				{
					this.AddHusbandOrWifeRelations(context, charId, relatedCharId, (int)addingType);
					return;
				}
			}
			this.AddRelation(context, charId, relatedCharId, addingType, int.MinValue);
		}

		// Token: 0x06007191 RID: 29073 RVA: 0x00415290 File Offset: 0x00413490
		[DomainMethod]
		public void GmCmd_RemoveRelation(DataContext context, int charId, int relatedCharId, ushort removeType)
		{
			DomainManager.Character.ChangeRelationType(context, charId, relatedCharId, removeType, 0);
			ushort oppositeAddingType = RelationType.GetOppositeRelationType(removeType);
			DomainManager.Character.ChangeRelationType(context, relatedCharId, charId, oppositeAddingType, 0);
		}

		// Token: 0x06007192 RID: 29074 RVA: 0x004152C8 File Offset: 0x004134C8
		private void InitializeSkeletonCharacterCache()
		{
			if (this._skeletonCharacterCache == null)
			{
				this._skeletonCharacterCache = new Dictionary<int, int>();
			}
			this._skeletonCharacterCache.Clear();
			foreach (KeyValuePair<int, Grave> keyValuePair in this._graves)
			{
				int num;
				Grave grave2;
				keyValuePair.Deconstruct(out num, out grave2);
				int graveId = num;
				Grave grave = grave2;
				int skeletonCharId = grave.GetSkeletonCharId();
				bool flag = skeletonCharId < 0;
				if (!flag)
				{
					this._skeletonCharacterCache.Add(skeletonCharId, graveId);
				}
			}
		}

		// Token: 0x06007193 RID: 29075 RVA: 0x00415370 File Offset: 0x00413570
		public int GetSkeletonSourceGraveId(int skeletonCharId)
		{
			int graveId;
			bool flag = this._skeletonCharacterCache.TryGetValue(skeletonCharId, out graveId);
			int result;
			if (flag)
			{
				result = graveId;
			}
			else
			{
				result = -1;
			}
			return result;
		}

		// Token: 0x06007194 RID: 29076 RVA: 0x0041539C File Offset: 0x0041359C
		public unsafe void GenerateSkeletons(DataContext context)
		{
			for (short areaId = 0; areaId < 45; areaId += 1)
			{
				Span<MapBlockData> blocks = DomainManager.Map.GetAreaBlocks(areaId);
				Span<MapBlockData> span = blocks;
				for (int i = 0; i < span.Length; i++)
				{
					MapBlockData block = *span[i];
					bool flag = block.GetConfig().SubType != EMapBlockSubType.Ruin;
					if (!flag)
					{
						bool flag2 = block.GraveSet == null;
						if (!flag2)
						{
							foreach (int graveId in block.GraveSet)
							{
								Grave grave = this._graves[graveId];
								int skeletonCharId = grave.GetSkeletonCharId();
								bool flag3 = skeletonCharId >= 0;
								if (!flag3)
								{
									bool flag4 = context.Random.CheckPercentProb(50);
									if (flag4)
									{
										this.CreateSkeletonCharacter(context, grave);
									}
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06007195 RID: 29077 RVA: 0x004154B8 File Offset: 0x004136B8
		public void CreateGraveForFixedCharacter(DataContext context, Character fixedCharacter, Location location, sbyte level, int deathDate = -2147483648)
		{
			Tester.Assert(fixedCharacter.GetCreatingType() == 0, "");
			int charId = fixedCharacter.GetId();
			deathDate = ((deathDate == int.MinValue) ? DomainManager.World.GetCurrDate() : deathDate);
			DeadCharacter deadChar = DeadCharacterHelper.CreateDeadCharacter(fixedCharacter, deathDate);
			FullName fullname = this.ConvertFixedCharacterName(context, fixedCharacter.GetTemplateId(), fixedCharacter.GetGender());
			deadChar.FullName = fullname;
			this.AddElement_DeadCharacters(charId, deadChar, context);
			Grave grave = new Grave(context, fixedCharacter, location, level);
			this.AddElement_Graves(charId, grave);
			grave.SetLocation(location, context);
			Events.RaiseGraveLocationChanged(context, charId, Location.Invalid, grave.GetLocation());
			this.RemoveNonIntelligentCharacter(context, fixedCharacter);
		}

		// Token: 0x06007196 RID: 29078 RVA: 0x00415564 File Offset: 0x00413764
		public DeadCharacter SectMainStoryJingangCreateDeadMonk(DataContext context, Character fixedCharacter)
		{
			Tester.Assert(fixedCharacter.GetCreatingType() == 0, "");
			int charId = fixedCharacter.GetId();
			int deathDate = DomainManager.World.GetCurrDate();
			DeadCharacter deadChar = DeadCharacterHelper.CreateDeadCharacter(fixedCharacter, deathDate);
			FullName fullname = this.ConvertFixedCharacterName(context, fixedCharacter.GetTemplateId(), fixedCharacter.GetGender());
			deadChar.FullName = fullname;
			this.AddElement_DeadCharacters(charId, deadChar, context);
			this.RemoveNonIntelligentCharacter(context, fixedCharacter);
			return deadChar;
		}

		// Token: 0x06007197 RID: 29079 RVA: 0x004155D8 File Offset: 0x004137D8
		public bool IsGraveProtected(Grave grave)
		{
			int graveId = grave.GetId();
			Location location = grave.GetLocation();
			MapBlockData block = DomainManager.Map.GetBlock(location);
			bool flag = block.CharacterSet == null;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				foreach (int charId in block.CharacterSet)
				{
					VillagerWorkData workData;
					bool flag2 = DomainManager.Taiwu.TryGetElement_VillagerWork(charId, out workData) && workData.WorkType == 12 && workData.GraveId == graveId;
					if (flag2)
					{
						return true;
					}
				}
				result = false;
			}
			return result;
		}

		// Token: 0x06007198 RID: 29080 RVA: 0x00415694 File Offset: 0x00413894
		public void DecayGraves(DataContext context)
		{
			List<Grave> gravesToBeRemoved = new List<Grave>();
			HashSet<int> keptGraveSet = ObjectPool<HashSet<int>>.Instance.Get();
			DomainManager.Taiwu.GetKeptGraves(keptGraveSet);
			foreach (KeyValuePair<int, Grave> entry in this._graves)
			{
				bool flag = keptGraveSet.Contains(entry.Key);
				if (!flag)
				{
					Grave grave = entry.Value;
					short durability = grave.GetDurability();
					bool flag2 = durability > 1;
					if (flag2)
					{
						grave.SetDurability(durability - 1, context);
					}
					else
					{
						gravesToBeRemoved.Add(grave);
					}
				}
			}
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int graveIdx = 0;
			int count = gravesToBeRemoved.Count;
			while (graveIdx < count)
			{
				Grave grave2 = gravesToBeRemoved[graveIdx];
				this.RemoveGrave(context, grave2);
				graveIdx++;
			}
			ObjectPool<HashSet<int>>.Instance.Return(keptGraveSet);
		}

		// Token: 0x06007199 RID: 29081 RVA: 0x004157A8 File Offset: 0x004139A8
		public void RemoveGrave(DataContext context, Grave grave)
		{
			int charId = grave.GetId();
			Location graveLoc = grave.GetLocation();
			int skeletonCharId = grave.GetSkeletonCharId();
			bool flag = skeletonCharId >= 0;
			if (flag)
			{
				this.RemoveNonIntelligentCharacter(context, this._objects[skeletonCharId]);
			}
			this.ClearGraveItemsRelatedData();
			bool flag2 = graveLoc.IsValid();
			if (flag2)
			{
				DomainManager.Map.GetRealNeighborBlocks(graveLoc.AreaId, graveLoc.BlockId, this._graveNeighborBlocks, 1, true);
			}
			bool flag3 = this._graveNeighborBlocks.Count > 0;
			if (flag3)
			{
				Inventory inventory = grave.GetInventory();
				int blockCount = this._graveNeighborBlocks.Count;
				foreach (KeyValuePair<ItemKey, int> keyValuePair in inventory.Items)
				{
					ItemKey itemKey2;
					int num;
					keyValuePair.Deconstruct(out itemKey2, out num);
					ItemKey itemKey = itemKey2;
					int amount = num;
					bool flag4 = ItemTemplateHelper.GetGrade(itemKey.ItemType, itemKey.TemplateId) >= 6;
					if (flag4)
					{
						int index = context.Random.Next(blockCount);
						this._graveNeighborItems[index].Add(new ValueTuple<ItemKey, int>(itemKey, amount));
						DomainManager.Item.RemoveOwner(itemKey, ItemOwnerType.Grave, charId);
					}
					else
					{
						DomainManager.Item.RemoveItem(context, itemKey);
					}
				}
				for (int i = 0; i < blockCount; i++)
				{
					List<ValueTuple<ItemKey, int>> items = this._graveNeighborItems[i];
					bool flag5 = items.Count > 0;
					if (flag5)
					{
						DomainManager.Map.AddBlockItems(context, this._graveNeighborBlocks[i], items);
					}
				}
			}
			else
			{
				DomainManager.Item.RemoveItems(context, grave.GetInventory().Items);
				Logger logger = CharacterDomain.Logger;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(55, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Grave ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(grave.GetId());
				defaultInterpolatedStringHandler.AppendLiteral(" is at invalid location; all items are destroyed.");
				logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			this.RemoveElement_Graves(charId);
			DomainManager.LifeRecord.RemoveDead(charId);
			this.RecordGraveRemoved(context, charId);
			bool flag6 = DomainManager.Character.IsTaiwuPeople(charId);
			if (flag6)
			{
				DomainManager.World.GetMonthlyNotificationCollection().AddGraveDestroyed(charId);
			}
			Events.RaiseGraveLocationChanged(context, charId, grave.GetLocation(), Location.Invalid);
		}

		// Token: 0x0600719A RID: 29082 RVA: 0x00415A14 File Offset: 0x00413C14
		private void InitializeGraveItemsRelatedData()
		{
			this._graveNeighborBlocks = new List<MapBlockData>();
			this._graveNeighborItems = new List<ValueTuple<ItemKey, int>>[9];
			for (int i = 0; i < 9; i++)
			{
				this._graveNeighborItems[i] = new List<ValueTuple<ItemKey, int>>();
			}
		}

		// Token: 0x0600719B RID: 29083 RVA: 0x00415A58 File Offset: 0x00413C58
		private void ClearGraveItemsRelatedData()
		{
			this._graveNeighborBlocks.Clear();
			for (int i = 0; i < 9; i++)
			{
				this._graveNeighborItems[i].Clear();
			}
		}

		// Token: 0x0600719C RID: 29084 RVA: 0x00415A94 File Offset: 0x00413C94
		public void UpdateGroupFavorabilities(DataContext context)
		{
			foreach (CharacterSet charSet in this._characterGroups.Values)
			{
				HashSet<int> collection = charSet.GetCollection();
				foreach (int selfCharId in collection)
				{
					Character selfChar = this._objects[selfCharId];
					ValueTuple<short, short> range = AiHelper.UpdateStatusConstants.SameGroupFavorabilityChange[(int)selfChar.GetBehaviorType()];
					foreach (int targetCharId in collection)
					{
						bool flag = selfCharId == targetCharId;
						if (!flag)
						{
							Character targetChar = this._objects[targetCharId];
							int favorDelta = context.Random.Next((int)range.Item1, (int)(range.Item2 + 1));
							this.ChangeFavorabilityOptionalMonthlyEvolution(context, selfChar, targetChar, favorDelta);
						}
					}
				}
			}
			DomainManager.Taiwu.UpdateTaiwuGroupFavorabilities(context);
		}

		// Token: 0x0600719D RID: 29085 RVA: 0x00415BEC File Offset: 0x00413DEC
		public void JoinGroup(DataContext context, Character character, Character targetLeader)
		{
			int prevLeaderId = character.GetLeaderId();
			bool flag = prevLeaderId >= 0;
			if (!flag)
			{
				int charId = character.GetId();
				int groupLeaderId = targetLeader.GetId();
				int actualLeaderId = targetLeader.GetLeaderId();
				int currDate = DomainManager.World.GetCurrDate();
				bool flag2 = charId == DomainManager.Taiwu.GetTaiwuCharId();
				if (flag2)
				{
					DomainManager.Taiwu.JoinGroup(context, charId, true);
				}
				else
				{
					bool flag3 = character.IsCreatedWithFixedTemplate();
					if (flag3)
					{
						character.SetLeaderId(groupLeaderId, context);
						DomainManager.Extra.AddSpecialGroupCharacter(context, groupLeaderId, charId);
					}
					else
					{
						bool flag4 = actualLeaderId < 0;
						CharacterSet group;
						if (flag4)
						{
							group = default(CharacterSet);
							group.Add(charId);
							character.SetLeaderId(groupLeaderId, context);
							this.AddElement_JoinGroupDates(charId, currDate, context);
							group.Add(groupLeaderId);
							targetLeader.SetLeaderId(groupLeaderId, context);
							this.AddElement_JoinGroupDates(groupLeaderId, currDate, context);
							this.AddElement_CharacterGroups(groupLeaderId, group, context);
						}
						else
						{
							group = this.GetElement_CharacterGroups(actualLeaderId);
							group.Add(charId);
							character.SetLeaderId(actualLeaderId, context);
							this.AddElement_JoinGroupDates(charId, currDate, context);
							this.SetElement_CharacterGroups(actualLeaderId, group, context);
						}
						foreach (int groupCharId in group.GetCollection())
						{
							bool flag5 = groupCharId == charId;
							if (!flag5)
							{
								this.TryCreateRelation(context, charId, groupCharId);
							}
						}
						Location srcLocation = character.GetLocation();
						Location destLocation = targetLeader.GetLocation();
						bool flag6 = !srcLocation.Equals(destLocation);
						if (flag6)
						{
							character.SetLocation(destLocation, context);
							Events.RaiseCharacterLocationChanged(context, charId, srcLocation, destLocation);
						}
					}
				}
			}
		}

		// Token: 0x0600719E RID: 29086 RVA: 0x00415DAC File Offset: 0x00413FAC
		[DomainMethod]
		public List<int> GetGroupSet(DataContext context, int charId)
		{
			Character character;
			bool flag = this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				List<int> retList = new List<int>();
				int leaderId = character.GetLeaderId();
				CharacterSet characterSet;
				bool flag2 = !this._characterGroups.TryGetValue(leaderId, out characterSet);
				if (flag2)
				{
					bool flag3 = leaderId == DomainManager.Taiwu.GetTaiwuCharId();
					if (flag3)
					{
						foreach (int taiwuCharId in DomainManager.Taiwu.GetGroupCharIds().GetCollection())
						{
							retList.Add(taiwuCharId);
						}
					}
					else
					{
						retList.Add(charId);
					}
				}
				else
				{
					retList.Add(leaderId);
					foreach (int iterateCharId in characterSet.GetCollection())
					{
						bool flag4 = !retList.Contains(iterateCharId);
						if (flag4)
						{
							retList.Add(iterateCharId);
						}
					}
				}
				int i = 0;
				int count = retList.Count;
				while (i < count)
				{
					int memberId = retList[i];
					IReadOnlySet<int> specialGroup = DomainManager.Extra.GetSpecialGroup(memberId);
					retList.AddRange(specialGroup);
					i++;
				}
				return retList;
			}
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 1);
			defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
			defaultInterpolatedStringHandler.AppendLiteral(" is not an exist alive character");
			throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x0600719F RID: 29087 RVA: 0x00415F4C File Offset: 0x0041414C
		public void LeaveGroup(DataContext context, Character character, bool bringWards = true)
		{
			int charId = character.GetId();
			int groupLeaderId = character.GetLeaderId();
			bool flag = groupLeaderId < 0;
			if (!flag)
			{
				bool flag2 = groupLeaderId == DomainManager.Taiwu.GetTaiwuCharId();
				if (flag2)
				{
					DomainManager.Taiwu.LeaveGroup(context, charId, bringWards, true, true);
				}
				else
				{
					bool flag3 = character.IsCreatedWithFixedTemplate();
					if (flag3)
					{
						character.SetLeaderId(-1, context);
						DomainManager.Extra.TryRemoveSpecialGroupCharacter(context, groupLeaderId, charId);
					}
					else
					{
						CharacterSet group = this._characterGroups[groupLeaderId];
						HashSet<int> wards = ObjectPool<HashSet<int>>.Instance.Get();
						if (bringWards)
						{
							this.GetWardsInGroup(character, group, wards);
						}
						Location validLocation = character.GetLocation();
						bool flag4 = !validLocation.IsValid();
						if (flag4)
						{
							validLocation = character.GetValidLocation();
						}
						bool flag5 = groupLeaderId == charId;
						if (flag5)
						{
							foreach (int memberId in group.GetCollection())
							{
								Character member;
								bool flag6 = this.TryGetElement_Objects(memberId, out member);
								if (flag6)
								{
									member.SetLeaderId(-1, context);
									bool flag7 = !member.GetLocation().IsValid();
									if (flag7)
									{
										member.SetLocation(validLocation, context);
									}
								}
								this.RemoveElement_JoinGroupDates(memberId, context);
							}
							group.Clear();
							this.RemoveElement_CharacterGroups(groupLeaderId, context);
							if (bringWards)
							{
								this.ChangeGroup(context, wards, character);
							}
							ObjectPool<HashSet<int>>.Instance.Return(wards);
						}
						else
						{
							group.Remove(charId);
							this.RemoveElement_JoinGroupDates(charId, context);
							bool flag8 = group.GetCount() > 1;
							if (flag8)
							{
								this.SetElement_CharacterGroups(groupLeaderId, group, context);
							}
							else
							{
								this.RemoveElement_CharacterGroups(groupLeaderId, context);
								this.RemoveElement_JoinGroupDates(groupLeaderId, context);
								Character leader;
								bool flag9 = this.TryGetElement_Objects(groupLeaderId, out leader);
								if (flag9)
								{
									leader.SetLeaderId(-1, context);
								}
							}
							bool flag10 = this._objects.ContainsKey(charId);
							if (flag10)
							{
								bool flag11 = !character.GetLocation().IsValid();
								if (flag11)
								{
									character.SetLocation(validLocation, context);
								}
								character.SetLeaderId(-1, context);
							}
							if (bringWards)
							{
								this.ChangeGroup(context, wards, character);
							}
							ObjectPool<HashSet<int>>.Instance.Return(wards);
						}
					}
				}
			}
		}

		// Token: 0x060071A0 RID: 29088 RVA: 0x004161A0 File Offset: 0x004143A0
		public void GetWardsInGroup(Character character, CharacterSet group, HashSet<int> wards)
		{
			wards.Clear();
			bool flag = character.GetAgeGroup() == 0;
			if (!flag)
			{
				RelatedCharacters relatedChars = this._relatedCharIds[character.GetId()];
				HashSet<int> groupCollection = group.GetCollection();
				int selfCharId = character.GetId();
				sbyte selfGender = character.GetGender();
				foreach (int groupCharId in groupCollection)
				{
					Character groupChar = this._objects[groupCharId];
					bool flag2 = groupChar.GetAgeGroup() != 0;
					if (!flag2)
					{
						bool flag3 = groupCharId == selfCharId;
						if (!flag3)
						{
							RelatedCharacter relation = this.GetRelation(selfCharId, groupCharId);
							bool flag4 = !this.HasBetterGuardianInGroup(selfCharId, relation.RelationType, selfGender, groupCharId, groupCollection);
							if (flag4)
							{
								wards.Add(groupCharId);
							}
						}
					}
				}
			}
		}

		// Token: 0x060071A1 RID: 29089 RVA: 0x00416290 File Offset: 0x00414490
		private bool HasBetterGuardianInGroup(int selfCharId, ushort relationType, sbyte selfGender, int wardCharId, HashSet<int> group)
		{
			bool containsStepParent = !RelationType.HasRelation(relationType, 2);
			bool flag = !containsStepParent && selfGender == 0;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool containsAdoptiveParent = containsStepParent && !RelationType.HasRelation(relationType, 16);
				int potentialGuardianCount = 0;
				foreach (int groupCharId in group)
				{
					bool flag2 = groupCharId == selfCharId || groupCharId == wardCharId;
					if (!flag2)
					{
						Character groupChar = this._objects[groupCharId];
						bool flag3 = groupChar.GetAgeGroup() == 0;
						if (!flag3)
						{
							potentialGuardianCount++;
							sbyte groupCharGender = groupChar.GetGender();
							RelatedCharacter relation = this.GetRelation(wardCharId, groupCharId);
							bool flag4 = RelationType.HasRelation(relation.RelationType, 1) && groupCharGender <= selfGender;
							if (flag4)
							{
								return true;
							}
							bool flag5 = !containsStepParent;
							if (!flag5)
							{
								bool flag6 = RelationType.HasRelation(relation.RelationType, 8) && groupCharGender <= selfGender;
								if (flag6)
								{
									return true;
								}
								bool flag7 = !containsAdoptiveParent;
								if (!flag7)
								{
									bool flag8 = RelationType.HasRelation(relation.RelationType, 64) && groupCharId <= (int)selfGender;
									if (flag8)
									{
										return true;
									}
								}
							}
						}
					}
				}
				result = (potentialGuardianCount > 0);
			}
			return result;
		}

		// Token: 0x060071A2 RID: 29090 RVA: 0x00416408 File Offset: 0x00414608
		public void ChangeGroup(DataContext context, HashSet<int> memberIds, Character targetLeader)
		{
			int targetLeaderId = targetLeader.GetId();
			foreach (int memberId in memberIds)
			{
				Character memberChar = this._objects[memberId];
				int currLeaderId = memberChar.GetLeaderId();
				bool flag = currLeaderId >= 0 && currLeaderId != targetLeaderId;
				if (flag)
				{
					this.LeaveGroup(context, memberChar, true);
				}
				this.JoinGroup(context, memberChar, targetLeader);
			}
		}

		// Token: 0x060071A3 RID: 29091 RVA: 0x0041649C File Offset: 0x0041469C
		public void HideCharacterOnMap(DataContext context, Character character, byte hideCharacterState, bool bringWards = true)
		{
			Tester.Assert(character.GetCreatingType() == 1, "");
			Tester.Assert((hideCharacterState & 60) > 0, "");
			int charId = character.GetId();
			Location location = character.GetLocation();
			this.LeaveGroup(context, character, bringWards);
			character.ActiveExternalRelationState(context, hideCharacterState);
			bool flag = character.IsCompletelyInfected();
			if (flag)
			{
				Events.RaiseInfectedCharacterLocationChanged(context, charId, location, Location.Invalid);
			}
			else
			{
				Events.RaiseCharacterLocationChanged(context, charId, location, Location.Invalid);
			}
		}

		// Token: 0x060071A4 RID: 29092 RVA: 0x0041651C File Offset: 0x0041471C
		public void UnhideCharacterOnMap(DataContext context, Character character, byte hideCharacterState)
		{
			Tester.Assert(character.GetCreatingType() == 1, "");
			Tester.Assert((hideCharacterState & 60) > 0, "");
			bool flag = !character.IsActiveExternalRelationState(hideCharacterState);
			if (!flag)
			{
				character.DeactivateExternalRelationState(context, hideCharacterState);
				bool flag2 = character.IsActiveExternalRelationState(60);
				if (!flag2)
				{
					int charId = character.GetId();
					Location location = character.GetLocation();
					bool flag3 = character.IsCompletelyInfected();
					if (flag3)
					{
						Events.RaiseInfectedCharacterLocationChanged(context, charId, Location.Invalid, location);
					}
					else
					{
						Events.RaiseCharacterLocationChanged(context, charId, Location.Invalid, location);
					}
				}
			}
		}

		// Token: 0x060071A5 RID: 29093 RVA: 0x004165B0 File Offset: 0x004147B0
		public void GroupMove(DataContext context, Character character, Location targetLocation)
		{
			bool flag = character.GetKidnapperId() >= 0;
			if (!flag)
			{
				int groupLeaderId = character.GetLeaderId();
				Location srcLocation = character.GetLocation();
				int selfCharId = character.GetId();
				bool flag2 = groupLeaderId < 0;
				if (flag2)
				{
					this.RemoveCrossAreaTravelInfo(context, selfCharId);
					bool flag3 = character.IsCompletelyInfected();
					if (flag3)
					{
						Events.RaiseInfectedCharacterLocationChanged(context, selfCharId, srcLocation, targetLocation);
					}
					else
					{
						Events.RaiseCharacterLocationChanged(context, selfCharId, srcLocation, targetLocation);
					}
					character.SetLocation(targetLocation, context);
				}
				else
				{
					this.RemoveCrossAreaTravelInfo(context, groupLeaderId);
					CharacterSet group;
					bool flag4 = !this.TryGetElement_CharacterGroups(groupLeaderId, out group);
					if (!flag4)
					{
						foreach (int groupCharId in group.GetCollection())
						{
							Character groupMember = this._objects[groupCharId];
							Events.RaiseCharacterLocationChanged(context, groupCharId, groupMember.GetLocation(), targetLocation);
							groupMember.SetLocation(targetLocation, context);
						}
					}
				}
			}
		}

		// Token: 0x060071A6 RID: 29094 RVA: 0x004166B8 File Offset: 0x004148B8
		public bool IsInTheSameGroup(int charIdA, int charIdB)
		{
			Character charA;
			Character charB;
			return this._objects.TryGetValue(charIdA, out charA) && this._objects.TryGetValue(charIdB, out charB) && charA.GetLeaderId() >= 0 && charA.GetLeaderId() == charB.GetLeaderId();
		}

		// Token: 0x060071A7 RID: 29095 RVA: 0x00416704 File Offset: 0x00414904
		public CharacterSet GetGroup(int leaderId)
		{
			return this._characterGroups[leaderId];
		}

		// Token: 0x060071A8 RID: 29096 RVA: 0x00416724 File Offset: 0x00414924
		public bool HasNonBabyMemberInGroup(int leaderId)
		{
			CharacterSet group;
			bool flag = leaderId < 0 || !this._characterGroups.TryGetValue(leaderId, out group);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				foreach (int memberId in group.GetCollection())
				{
					bool flag2 = this._objects[memberId].GetAgeGroup() != 0 && leaderId != memberId;
					if (flag2)
					{
						return true;
					}
				}
				result = false;
			}
			return result;
		}

		// Token: 0x060071A9 RID: 29097 RVA: 0x004167C8 File Offset: 0x004149C8
		public void UpdateExceedingGroupChars(DataContext context)
		{
			Dictionary<int, CharacterSet> toRemoveDict = new Dictionary<int, CharacterSet>();
			List<long> sortedGroupChars = ObjectPool<List<long>>.Instance.Get();
			CharacterMatcherItem matcher = CharacterMatcher.DefValue.CanBeRemovedFromGroup;
			foreach (KeyValuePair<int, CharacterSet> keyValuePair in this._characterGroups)
			{
				int num;
				CharacterSet characterSet;
				keyValuePair.Deconstruct(out num, out characterSet);
				int leaderId = num;
				CharacterSet groupCharSet = characterSet;
				HashSet<int> groupChars = groupCharSet.GetCollection();
				bool flag = groupChars.Count <= (int)AiHelper.FixedActionConstants.NpcGroupSoftMaxCount;
				if (!flag)
				{
					int toRemoveCount = groupChars.Count - (int)AiHelper.FixedActionConstants.NpcGroupSoftMaxCount;
					sortedGroupChars.Clear();
					foreach (int groupCharId in groupChars)
					{
						bool flag2 = groupCharId == leaderId;
						if (!flag2)
						{
							Character groupChar = this._objects[groupCharId];
							bool flag3 = !matcher.Match(groupChar);
							if (!flag3)
							{
								RelatedCharacter relation = this.GetRelation(groupCharId, leaderId);
								bool flag4 = RelationType.HasRelation(relation.RelationType, 1024);
								if (!flag4)
								{
									bool flag5 = RelationType.ContainParentRelations(relation.RelationType);
									if (!flag5)
									{
										sortedGroupChars.Add(((long)relation.Favorability << 32) + (long)groupCharId);
									}
								}
							}
						}
					}
					bool flag6 = sortedGroupChars.Count <= toRemoveCount;
					if (flag6)
					{
						toRemoveCount = sortedGroupChars.Count;
					}
					else
					{
						sortedGroupChars.Sort();
					}
					bool flag7 = toRemoveCount <= 0;
					if (!flag7)
					{
						CharacterSet toRemoveSet = default(CharacterSet);
						for (int i = 0; i < toRemoveCount; i++)
						{
							long groupCharInfo = sortedGroupChars[i];
							int groupCharId2 = (int)groupCharInfo;
							toRemoveSet.Add(groupCharId2);
						}
						bool flag8 = toRemoveSet.GetCount() > 0;
						if (flag8)
						{
							toRemoveDict.Add(leaderId, toRemoveSet);
						}
					}
				}
			}
			foreach (KeyValuePair<int, CharacterSet> keyValuePair in toRemoveDict)
			{
				int num;
				CharacterSet characterSet;
				keyValuePair.Deconstruct(out num, out characterSet);
				int leaderId2 = num;
				CharacterSet toRemoveSet2 = characterSet;
				CharacterSet group = this._characterGroups[leaderId2];
				foreach (int toRemoveCharId in toRemoveSet2.GetCollection())
				{
					this.LeaveGroup(context, this._objects[toRemoveCharId], true);
					bool flag9 = group.GetCount() <= (int)AiHelper.FixedActionConstants.NpcGroupSoftMaxCount;
					if (flag9)
					{
						break;
					}
				}
			}
			ObjectPool<List<long>>.Instance.Return(sortedGroupChars);
		}

		// Token: 0x060071AA RID: 29098 RVA: 0x00416AE4 File Offset: 0x00414CE4
		public int GetCharacterWisdomCount(int characterId)
		{
			return this.GetElement_Objects(characterId).GetFeatureMedalValue(2);
		}

		// Token: 0x060071AB RID: 29099 RVA: 0x00416AF3 File Offset: 0x00414CF3
		public int GetCharactersWisdomCount(IEnumerable<int> characterIds)
		{
			return characterIds.Sum(new Func<int, int>(this.GetCharacterWisdomCount));
		}

		// Token: 0x060071AC RID: 29100 RVA: 0x00416B08 File Offset: 0x00414D08
		[DomainMethod]
		public int GetCharacterWisdomCountById(int characterId)
		{
			return this.GetCharacterWisdomCount(characterId);
		}

		// Token: 0x060071AD RID: 29101 RVA: 0x00416B24 File Offset: 0x00414D24
		[DomainMethod]
		public int GetCharacterListWisdomCount(List<int> charIdList)
		{
			int mainCharId = charIdList[0];
			charIdList.RemoveAll((int id) => id < 0);
			int totalValue = DomainManager.Character.GetCharacterWisdomCount(mainCharId) * (4 - (charIdList.Count - 1));
			for (int i = 1; i < charIdList.Count; i++)
			{
				totalValue += DomainManager.Character.GetCharacterWisdomCount(charIdList[i]);
			}
			return totalValue;
		}

		// Token: 0x060071AE RID: 29102 RVA: 0x00416BA8 File Offset: 0x00414DA8
		[DomainMethod]
		public List<int> GetCharacterWisdomList(List<int> charIdList)
		{
			List<int> res = new List<int>();
			int mainCharId = charIdList[0];
			res.Add(DomainManager.Character.GetCharacterWisdomCount(mainCharId) * (4 - (charIdList.Count - 1)));
			for (int i = 1; i < charIdList.Count; i++)
			{
				res.Add(Character.IsCharacterIdValid(charIdList[i]) ? DomainManager.Character.GetCharacterWisdomCount(charIdList[i]) : 0);
			}
			return res;
		}

		// Token: 0x060071AF RID: 29103 RVA: 0x00416C28 File Offset: 0x00414E28
		public int CreateNonIntelligentCharacter(DataContext context, short templateId)
		{
			CharacterItem characterCfg = Character.Instance[templateId];
			byte creatingType = characterCfg.CreatingType;
			Character fixedCharacter;
			bool flag = creatingType == 0 && DomainManager.Character.TryGetFixedCharacterByTemplateId(templateId, out fixedCharacter);
			int result;
			if (flag)
			{
				result = fixedCharacter.GetId();
			}
			else
			{
				if (!true)
				{
				}
				Character character;
				switch (creatingType)
				{
				case 0:
					character = DomainManager.Character.CreateFixedCharacter(context, templateId);
					goto IL_C6;
				case 2:
					character = DomainManager.Character.CreateRandomEnemy(context, templateId, null);
					goto IL_C6;
				case 3:
					character = DomainManager.Character.CreateFixedEnemy(context, templateId);
					goto IL_C6;
				}
				string paramName = "templateId";
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(71, 1);
				defaultInterpolatedStringHandler.AppendLiteral("character with template id ");
				defaultInterpolatedStringHandler.AppendFormatted<short>(templateId);
				defaultInterpolatedStringHandler.AppendLiteral(" is neither fixed character nor random enemy");
				throw new ArgumentOutOfRangeException(paramName, defaultInterpolatedStringHandler.ToStringAndClear());
				IL_C6:
				if (!true)
				{
				}
				Character enemy = character;
				int enemyId = enemy.GetId();
				DomainManager.Character.CompleteCreatingCharacter(enemyId);
				DomainManager.Adventure.AddTemporaryEnemyId(enemyId);
				bool flag2 = creatingType == 2;
				if (flag2)
				{
					sbyte affectedByLegendaryBookRate = 50;
					Location location = DomainManager.Taiwu.GetTaiwu().GetLocation();
					bool flag3 = location.IsValid() && (characterCfg.OrganizationInfo.OrgTemplateId == 17 || characterCfg.OrganizationInfo.OrgTemplateId == 18) && context.Random.CheckPercentProb((int)affectedByLegendaryBookRate);
					if (flag3)
					{
						HashSet<int> charIds = ObjectPool<HashSet<int>>.Instance.Get();
						DomainManager.Extra.GetLegendaryBookConsumedCharacters(charIds);
						for (sbyte combatSkillType = 0; combatSkillType < 14; combatSkillType += 1)
						{
							int ownerId = DomainManager.LegendaryBook.GetOwner(combatSkillType);
							Character bookOwner;
							bool flag4 = ownerId < 0 || !DomainManager.Character.TryGetElement_Objects(ownerId, out bookOwner);
							if (!flag4)
							{
								bool flag5 = bookOwner.GetLegendaryBookOwnerState() < 1;
								if (!flag5)
								{
									bool flag6 = bookOwner.GetLocation().AreaId != location.AreaId;
									if (!flag6)
									{
										enemy.AddFeature(context, 340, false);
										break;
									}
								}
							}
						}
						ObjectPool<HashSet<int>>.Instance.Return(charIds);
					}
					short currAdventureId = DomainManager.Adventure.GetCurAdventureId();
					bool flag7 = currAdventureId >= 0 && DomainManager.Adventure.AdventureCfg.Type == 4;
					if (flag7)
					{
						sbyte enemyNestTemplateId = AdventureDomain.GetEnemyNestTemplateId(currAdventureId);
						bool flag8 = enemyNestTemplateId >= 0 && EnemyNest.Instance[(short)enemyNestTemplateId].Leader == templateId;
						if (flag8)
						{
							enemy.AddFeature(context, 403, false);
						}
					}
				}
				result = enemyId;
			}
			return result;
		}

		// Token: 0x060071B0 RID: 29104 RVA: 0x00416EAC File Offset: 0x004150AC
		public bool HasGroup(int charId)
		{
			CharacterSet group;
			return this.TryGetElement_CharacterGroups(charId, out group) && group.GetCount() > 1;
		}

		// Token: 0x060071B1 RID: 29105 RVA: 0x00416ED8 File Offset: 0x004150D8
		private static void InitializeRandomEnemyCharTemplateCache()
		{
			CharacterDomain._randomEnemyCharTemplateCache = new Dictionary<sbyte, List<short>[]>();
			HashSet<short> hashSet = new HashSet<short>();
			foreach (EnemyNestItem enemyNestTemplate in ((IEnumerable<EnemyNestItem>)EnemyNest.Instance))
			{
				bool flag = enemyNestTemplate.Members != null;
				if (flag)
				{
					hashSet.UnionWith(enemyNestTemplate.Members);
				}
			}
			foreach (CharacterItem template in ((IEnumerable<CharacterItem>)Character.Instance))
			{
				bool flag2 = template.CreatingType != 2;
				if (!flag2)
				{
					bool flag3 = (template.OrganizationInfo.OrgTemplateId == 18 || template.OrganizationInfo.OrgTemplateId == 17) && !hashSet.Contains(template.TemplateId);
					if (!flag3)
					{
						bool flag4 = !CharacterDomain._randomEnemyCharTemplateCache.ContainsKey(template.OrganizationInfo.OrgTemplateId);
						List<short>[] orgEnemies;
						if (flag4)
						{
							orgEnemies = new List<short>[9];
							CharacterDomain._randomEnemyCharTemplateCache.Add(template.OrganizationInfo.OrgTemplateId, orgEnemies);
						}
						else
						{
							orgEnemies = CharacterDomain._randomEnemyCharTemplateCache[template.OrganizationInfo.OrgTemplateId];
						}
						List<short>[] array = orgEnemies;
						int grade = (int)template.OrganizationInfo.Grade;
						if (array[grade] == null)
						{
							array[grade] = new List<short>();
						}
						orgEnemies[(int)template.OrganizationInfo.Grade].Add(template.TemplateId);
					}
				}
			}
		}

		// Token: 0x060071B2 RID: 29106 RVA: 0x00417098 File Offset: 0x00415298
		public static short GetRandomEnemyCharTemplateId(IRandomSource random, sbyte orgTemplateId, sbyte expectedGrade)
		{
			List<short>[] orgEnemies;
			bool flag = !CharacterDomain._randomEnemyCharTemplateCache.TryGetValue(orgTemplateId, out orgEnemies);
			short result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				for (sbyte currGrade = expectedGrade; currGrade >= 0; currGrade -= 1)
				{
					bool flag2 = orgEnemies[(int)currGrade] != null && orgEnemies[(int)currGrade].Count > 0;
					if (flag2)
					{
						return orgEnemies[(int)currGrade].GetRandom(random);
					}
				}
				result = -1;
			}
			return result;
		}

		// Token: 0x060071B3 RID: 29107 RVA: 0x00417100 File Offset: 0x00415300
		public void CreatePregeneratedCityTownGuards(DataContext context)
		{
			for (sbyte stateTemplateId = 0; stateTemplateId < 16; stateTemplateId += 1)
			{
				for (sbyte grade = 0; grade < 9; grade += 1)
				{
					short hereticTemplateId = CharacterDomain.PregenerateHereticTemplateIds[(int)grade];
					Character hereticChar = this.CreateRandomEnemy(context, hereticTemplateId, null);
					int hereticCharIndex = this.CalcPregeneratedCityTownGuardIndex(stateTemplateId, true, grade);
					this._pregeneratedCityTownGuards[hereticCharIndex] = hereticChar.GetId();
					this.CompleteCreatingCharacter(hereticChar.GetId());
					short righteousTemplateId = CharacterDomain.PregenerateRighteousTemplateIds[(int)grade];
					Character righteousChar = this.CreateRandomEnemy(context, righteousTemplateId, null);
					int righteousCharIndex = this.CalcPregeneratedCityTownGuardIndex(stateTemplateId, false, grade);
					this._pregeneratedCityTownGuards[righteousCharIndex] = righteousChar.GetId();
					this.CompleteCreatingCharacter(righteousChar.GetId());
				}
			}
			this.SetPregeneratedCityTownGuards(this._pregeneratedCityTownGuards, context);
		}

		// Token: 0x060071B4 RID: 29108 RVA: 0x004171C8 File Offset: 0x004153C8
		public void CreatePregeneratedRandomEnemies(DataContext context)
		{
			this._pregeneratedRandomEnemies.Clear();
			for (int i = 0; i < RandomEnemy.Instance.Count; i++)
			{
				this._pregeneratedRandomEnemies.Add(-1);
			}
			short templateId = 0;
			while ((int)templateId < Character.Instance.Count)
			{
				CharacterItem config = Character.Instance[templateId];
				bool flag = config.RandomEnemyId < 0;
				if (!flag)
				{
					Character randomEnemy = this.CreateRandomEnemy(context, templateId, null);
					this._pregeneratedRandomEnemies[(int)config.RandomEnemyId] = randomEnemy.GetId();
					this.CompleteCreatingCharacter(randomEnemy.GetId());
				}
				templateId += 1;
			}
			this.SetPregeneratedRandomEnemies(this._pregeneratedRandomEnemies, context);
		}

		// Token: 0x060071B5 RID: 29109 RVA: 0x00417284 File Offset: 0x00415484
		private void ComplementPregeneratedRandomEnemies(DataContext context, DataUid uid)
		{
			int previousCount = this._pregeneratedRandomEnemies.Count;
			for (int templateId = previousCount; templateId < RandomEnemy.Instance.Count; templateId++)
			{
				this._pregeneratedRandomEnemies.Add(-1);
			}
			short templateId2 = 0;
			while ((int)templateId2 < Character.Instance.Count)
			{
				CharacterItem config = Character.Instance[templateId2];
				bool flag = (int)config.RandomEnemyId < previousCount;
				if (!flag)
				{
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(40, 3);
					defaultInterpolatedStringHandler.AppendLiteral("Complement pregenerated random enemy: ");
					defaultInterpolatedStringHandler.AppendFormatted(config.Surname);
					defaultInterpolatedStringHandler.AppendFormatted(config.GivenName);
					defaultInterpolatedStringHandler.AppendLiteral("(");
					defaultInterpolatedStringHandler.AppendFormatted<short>(config.TemplateId);
					defaultInterpolatedStringHandler.AppendLiteral(")");
					logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
					Character randomEnemy = this.CreateRandomEnemy(context, templateId2, null);
					this._pregeneratedRandomEnemies[(int)config.RandomEnemyId] = randomEnemy.GetId();
					this.CompleteCreatingCharacter(randomEnemy.GetId());
				}
				templateId2 += 1;
			}
			DomainManager.Extra.CreatePregeneratedFixedEnemies(context);
			this.SetPregeneratedRandomEnemies(this._pregeneratedRandomEnemies, context);
			base.RemovePostModificationHandler(uid, "ComplementPregeneratedRandomEnemies");
		}

		// Token: 0x060071B6 RID: 29110 RVA: 0x004173D8 File Offset: 0x004155D8
		public Character GetPregeneratedRandomEnemy(short randomEnemyTemplateId)
		{
			int charId = this._pregeneratedRandomEnemies[(int)randomEnemyTemplateId];
			return this._objects[charId];
		}

		// Token: 0x060071B7 RID: 29111 RVA: 0x00417404 File Offset: 0x00415604
		public Character GetPregeneratedCityTownGuard(sbyte stateTemplateId, bool isHeretic, sbyte grade)
		{
			int index = this.CalcPregeneratedCityTownGuardIndex(stateTemplateId, isHeretic, grade);
			int charId = this._pregeneratedCityTownGuards[index];
			return this._objects[charId];
		}

		// Token: 0x060071B8 RID: 29112 RVA: 0x00417438 File Offset: 0x00415638
		private int CalcPregeneratedCityTownGuardIndex(sbyte stateTemplateId, bool isHeretic, sbyte grade)
		{
			int enemyGroup = isHeretic ? 0 : 1;
			int stateTemplateIdBegin = (int)(stateTemplateId * 2 * 9);
			return stateTemplateIdBegin + enemyGroup * 9 + (int)grade;
		}

		// Token: 0x060071B9 RID: 29113 RVA: 0x00417464 File Offset: 0x00415664
		public void GetGuards(DataContext context, Character character, ref SpanList<short> templateIds)
		{
			MerchantData merchantData;
			bool flag = DomainManager.Merchant.TryGetMerchantData(character.GetId(), out merchantData) && merchantData.MerchantTemplateId >= 0;
			if (flag)
			{
				templateIds.AddRangeSafe(merchantData.MerchantConfig.Guards);
			}
			else
			{
				OrganizationInfo orgInfo = character.GetOrganizationInfo();
				short minionGroupId = OrganizationDomain.GetOrgMemberConfig(orgInfo).MinionGroupId;
				bool flag2 = minionGroupId >= 0;
				if (flag2)
				{
					List<short> minions = MinionGroup.Instance[minionGroupId].Minions;
					templateIds.AddRangeSafe(minions);
				}
				else
				{
					bool flag3 = character.GetCreatingType() == 1;
					if (flag3)
					{
						sbyte fameType = character.GetFameType();
						bool flag4 = fameType == -2;
						if (flag4)
						{
							int fameThatCount = 0;
							bool useGood = context.Random.NextBool();
							List<FameActionRecord> fameActionRecords = character.GetFameActionRecords();
							foreach (FameActionRecord record in fameActionRecords)
							{
								bool flag5 = useGood == record.Value > 0;
								if (flag5)
								{
									fameThatCount += (int)record.Value;
								}
							}
							fameType = FameType.GetFameType((sbyte)Math.Clamp(fameThatCount, -100, 100));
						}
						int guardDifficulty = Math.Clamp((int)orgInfo.Grade + Math.Abs((int)(fameType - 3)), 0, 8);
						bool flag6 = fameType < 3;
						if (flag6)
						{
							templateIds.Add(CharacterDomain.PregenerateHereticTemplateIds[guardDifficulty]);
						}
						else
						{
							templateIds.Add(CharacterDomain.PregenerateRighteousTemplateIds[guardDifficulty]);
						}
					}
				}
			}
		}

		// Token: 0x060071BA RID: 29114 RVA: 0x004175EC File Offset: 0x004157EC
		[Obsolete]
		public unsafe void GetGuardTemplateIds(DataContext context, Character character, List<short> templateIds)
		{
			Span<short> span = new Span<short>(stackalloc byte[(UIntPtr)6], 3);
			SpanList<short> charTemplateIds = span;
			this.GetGuards(context, character, ref charTemplateIds);
		}

		// Token: 0x060071BB RID: 29115 RVA: 0x00417618 File Offset: 0x00415818
		public bool HasGuard(int charId, Character character)
		{
			bool flag = character.IsCompletelyInfected();
			bool result;
			if (flag)
			{
				result = !this._unguardedChars.Contains(charId);
			}
			else
			{
				bool flag2 = character.GetKidnapperId() >= 0;
				if (flag2)
				{
					result = false;
				}
				else
				{
					bool flag3 = character.GetSrcCharId() == DomainManager.Taiwu.GetTaiwuCharId();
					if (flag3)
					{
						result = false;
					}
					else
					{
						OrganizationInfo orgInfo = character.GetOrganizationInfo();
						bool flag4 = orgInfo.SettlementId < 0 || orgInfo.OrgTemplateId == 16;
						if (flag4)
						{
							result = false;
						}
						else
						{
							Settlement settlement = DomainManager.Organization.GetSettlement(orgInfo.SettlementId);
							bool flag5 = settlement.GetLocation().AreaId >= 45;
							result = (!flag5 && !this._unguardedChars.Contains(charId));
						}
					}
				}
			}
			return result;
		}

		// Token: 0x060071BC RID: 29116 RVA: 0x004176E1 File Offset: 0x004158E1
		public void LoseGuard(DataContext context, int charId, Character character)
		{
			this._unguardedChars.Add(charId);
			this.SetUnguardedChars(this._unguardedChars, context);
		}

		// Token: 0x060071BD RID: 29117 RVA: 0x004176FF File Offset: 0x004158FF
		public void OfflineLoseGuard(int charId, Character character)
		{
			this._unguardedChars.Add(charId);
		}

		// Token: 0x060071BE RID: 29118 RVA: 0x0041770F File Offset: 0x0041590F
		public void RecoverGuards(DataContext context)
		{
			this._unguardedChars.Clear();
			this.SetUnguardedChars(this._unguardedChars, context);
		}

		// Token: 0x060071BF RID: 29119 RVA: 0x0041772C File Offset: 0x0041592C
		public static bool TemplateIdIsRighteous(short templateId)
		{
			return CharacterDomain.PregenerateRighteousTemplateIds.Contains(templateId);
		}

		// Token: 0x060071C0 RID: 29120 RVA: 0x0041774C File Offset: 0x0041594C
		private void InitializeInfantMap()
		{
			this._infantMap = new Dictionary<int, int>();
			foreach (KeyValuePair<int, Character> pair in this._objects)
			{
				bool flag = pair.Value.GetAgeGroup() != 0;
				if (!flag)
				{
					bool flag2 = pair.Value.GetCreatingType() != 1;
					if (!flag2)
					{
						this._infantMap[pair.Key] = -1;
					}
				}
			}
		}

		// Token: 0x060071C1 RID: 29121 RVA: 0x004177EC File Offset: 0x004159EC
		public void AddInfant(int id)
		{
			this._infantMap[id] = -1;
		}

		// Token: 0x060071C2 RID: 29122 RVA: 0x004177FD File Offset: 0x004159FD
		public void RemoveInfant(int id)
		{
			this._infantMap.Remove(id);
		}

		// Token: 0x060071C3 RID: 29123 RVA: 0x0041780D File Offset: 0x00415A0D
		public void MarkInfantAsAdopted(int id)
		{
			this._infantMap[id] = -2;
		}

		// Token: 0x060071C4 RID: 29124 RVA: 0x00417820 File Offset: 0x00415A20
		public bool InfantHasPotentialAdopter(int id)
		{
			int adopterId;
			return this._infantMap.TryGetValue(id, out adopterId) && adopterId != -1;
		}

		// Token: 0x060071C5 RID: 29125 RVA: 0x0041784C File Offset: 0x00415A4C
		public bool IsCharacterPotentialInfantAdopter(int infantId, int charId)
		{
			int adopterId;
			return this._infantMap.TryGetValue(infantId, out adopterId) && adopterId == charId;
		}

		// Token: 0x060071C6 RID: 29126 RVA: 0x00417878 File Offset: 0x00415A78
		public bool IsInfantInMap(int id)
		{
			return this._infantMap.ContainsKey(id);
		}

		// Token: 0x060071C7 RID: 29127 RVA: 0x00417896 File Offset: 0x00415A96
		public void AddPotentialAdopterToInfant(int infant, int adopter)
		{
			this._infantMap[infant] = adopter;
		}

		// Token: 0x060071C8 RID: 29128 RVA: 0x004178A7 File Offset: 0x00415AA7
		public void RemovePotentialAdopterToInfant(int infant)
		{
			this._infantMap[infant] = -1;
		}

		// Token: 0x060071C9 RID: 29129 RVA: 0x004178B8 File Offset: 0x00415AB8
		private void InitializeInfectedCharSet()
		{
			this._infectedCharSet = new HashSet<int>();
			foreach (KeyValuePair<int, Character> pair in this._objects)
			{
				bool flag = pair.Value.IsCompletelyInfected();
				if (flag)
				{
					this._infectedCharSet.Add(pair.Key);
				}
			}
		}

		// Token: 0x060071CA RID: 29130 RVA: 0x00417938 File Offset: 0x00415B38
		public void AddInfectedCharToSet(int charId)
		{
			this._infectedCharSet.Add(charId);
		}

		// Token: 0x060071CB RID: 29131 RVA: 0x00417948 File Offset: 0x00415B48
		public void RemoveInfectedCharFromSet(int charId)
		{
			this._infectedCharSet.Remove(charId);
		}

		// Token: 0x060071CC RID: 29132 RVA: 0x00417958 File Offset: 0x00415B58
		public void UpdateInfectedCharacterActions(DataContext context)
		{
			bool flag = this._infectedCharSet.Count == 0;
			if (!flag)
			{
				Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
				Location taiwuCharLocation = taiwuChar.GetLocation();
				TakeRevengeAction action = new TakeRevengeAction();
				CharacterMatcherItem matcher = CharacterMatcher.DefValue.CanPerformInfectedAction;
				CharacterMatcherItem targetMatcher = CharacterMatcher.DefValue.CanBeAttackedByInfectedCharacter;
				foreach (int infectedCharId in this._infectedCharSet)
				{
					Character infectedChar = this._objects[infectedCharId];
					bool flag2 = CharacterDomain.IsLockMovementChar(infectedCharId);
					if (!flag2)
					{
						bool flag3 = !matcher.Match(infectedChar);
						if (!flag3)
						{
							Location location = infectedChar.GetLocation();
							bool flag4 = !location.IsValid();
							if (!flag4)
							{
								MapBlockData block = DomainManager.Map.GetBlock(location);
								bool flag5 = block.InfectedCharacterSet == null || !block.InfectedCharacterSet.Contains(infectedCharId);
								if (!flag5)
								{
									bool flag6 = location.Equals(taiwuCharLocation);
									int targetCharId;
									if (flag6)
									{
										targetCharId = taiwuChar.GetId();
									}
									else
									{
										bool flag7 = block.CharacterSet == null;
										if (flag7)
										{
											continue;
										}
										List<int> charIdList = context.AdvanceMonthRelatedData.CharIdList.Occupy();
										charIdList.Clear();
										foreach (int charId in block.CharacterSet)
										{
											bool flag8 = targetMatcher.Match(this._objects[charId]);
											if (flag8)
											{
												charIdList.Add(charId);
											}
										}
										targetCharId = charIdList.GetRandomOrDefault(context.Random, -1);
										context.AdvanceMonthRelatedData.CharIdList.Release(ref charIdList);
										bool flag9 = targetCharId < 0;
										if (flag9)
										{
											continue;
										}
									}
									action.Target = new NpcTravelTarget(targetCharId, 1);
									action.Execute(context, infectedChar);
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x060071CD RID: 29133 RVA: 0x00417B90 File Offset: 0x00415D90
		[Obsolete]
		public void SetCharacterInfectionValue(Character character, byte infectionValue, DataContext context)
		{
			character.SetXiangshuInfection(infectionValue, context);
			character.UpdateXiangshuInfectionState(context);
		}

		// Token: 0x060071CE RID: 29134 RVA: 0x00417BA4 File Offset: 0x00415DA4
		public int GetSpiritualDebtChangeByInfected(Character character, int valueChange = 100)
		{
			sbyte grade = character.GetOrganizationInfo().Grade;
			return (int)(((grade + 1) * (grade + 1) + 4) * 10) * valueChange / 100;
		}

		// Token: 0x060071CF RID: 29135 RVA: 0x00417BD8 File Offset: 0x00415DD8
		[DomainMethod]
		public CharacterLoveAndHateItemInfo GetCharacterLoveAndHateItemInfo(DataContext context, int charId)
		{
			CharacterLoveAndHateItemInfo info = null;
			Character character;
			bool flag = this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				sbyte favorabilityType = FavorabilityType.GetFavorabilityType(DomainManager.Character.GetFavorability(charId, DomainManager.Taiwu.GetTaiwuCharId()));
				bool flag2 = favorabilityType >= 3 && this.IsInteractedWithTaiwu(charId);
				if (flag2)
				{
					character.SetLovingItemRevealed(true, context);
					character.SetHatingItemRevealed(true, context);
				}
				info = new CharacterLoveAndHateItemInfo();
				info.CharacterId = charId;
				info.CreatingType = character.GetCreatingType();
				info.LovingItemSubType = character.GetLovingItemSubType();
				info.LovingItemRevealed = character.GetLovingItemRevealed();
				info.HatingItemSubType = character.GetHatingItemSubType();
				info.HatingItemRevealed = character.GetHatingItemRevealed();
				info.HobbyExpirationDate = character.GetHobbyExpirationDate();
				info.NeedShowFirstRevealLovingEffect = (info.LovingItemRevealed && !DomainManager.Extra.IsCharacterLovingItemRevealed(charId));
				info.NeedShowFirstRevealHatingEffect = (info.HatingItemRevealed && !DomainManager.Extra.IsCharacterHatingItemRevealed(charId));
			}
			return info;
		}

		// Token: 0x060071D0 RID: 29136 RVA: 0x00417CD8 File Offset: 0x00415ED8
		[DomainMethod]
		public void TransferResourcesWithDebt(DataContext context, int srcCharId, int destCharId, ResourceInts resources, bool checkFavorability)
		{
			Character srcChar = this.GetElement_Objects(srcCharId);
			Character destChar = this.GetElement_Objects(destCharId);
			bool flag = srcChar.GetCreatingType() == 1 && destChar.GetCreatingType() == 1;
			if (flag)
			{
				this.UpdateDebtByResourceTransfer(context, srcChar, destChar, resources, true);
			}
			this.TransferResource(context, srcChar, destChar, ref resources);
		}

		// Token: 0x060071D1 RID: 29137 RVA: 0x00417D28 File Offset: 0x00415F28
		public void UpdateDebtByResourceTransfer(DataContext context, Character srcChar, Character destChar, ResourceInts resources, bool changeFavor)
		{
			int destCharId = destChar.GetId();
			int srcCharId = srcChar.GetId();
			Tester.Assert(srcCharId != destCharId, "");
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			Character relatedChar = destChar;
			bool flag = destCharId == taiwuCharId;
			if (flag)
			{
				relatedChar = srcChar;
				resources = resources.GetReversed();
			}
			else
			{
				bool flag2 = srcCharId != taiwuCharId;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(26, 2);
					defaultInterpolatedStringHandler.AppendLiteral("Neither party is taiwu: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(srcCharId);
					defaultInterpolatedStringHandler.AppendLiteral(", ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(destCharId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
			bool flag3 = relatedChar.GetCreatingType() != 1;
			if (!flag3)
			{
				short oriFavor;
				short oriMaxFavor;
				if (!changeFavor)
				{
					oriFavor = 0;
					oriMaxFavor = 0;
				}
				else
				{
					ValueTuple<short, short> favorAndMaxFavorToTaiwu = this.GetFavorAndMaxFavorToTaiwu(relatedChar);
					oriFavor = favorAndMaxFavorToTaiwu.Item1;
					oriMaxFavor = favorAndMaxFavorToTaiwu.Item2;
				}
				ValueTuple<long, long> resourcesWorth = CharacterDomain.GetResourcesWorth(ref resources);
				long borrowedWorth = resourcesWorth.Item1;
				long lentWorth = resourcesWorth.Item2;
				bool flag4 = lentWorth != 0L;
				if (flag4)
				{
					this.LendResourceToTaiwu(context, relatedChar, lentWorth);
					if (changeFavor)
					{
						short favorDecrement = AiHelper.GeneralActionConstants.GetResourceFavorabilityChange(6, (int)Math.Clamp(lentWorth, 0L, 2147483647L));
						Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
						this.ChangeFavorabilityOptionalGiftItem(context, relatedChar, taiwuChar, (int)(-(int)favorDecrement));
					}
				}
				bool flag5 = borrowedWorth != 0L;
				if (flag5)
				{
					this.BorrowResourceFromTaiwu(context, relatedChar, borrowedWorth);
					if (changeFavor)
					{
						short favorIncrement = AiHelper.GeneralActionConstants.GetResourceFavorabilityChange(6, (int)Math.Clamp(borrowedWorth, 0L, 2147483647L));
						Character taiwuChar2 = DomainManager.Taiwu.GetTaiwu();
						this.ChangeFavorabilityOptionalGiftItem(context, relatedChar, taiwuChar2, (int)favorIncrement);
					}
				}
				bool flag6 = changeFavor && !this.CheckFavorabilityAfterTransferring(relatedChar, oriFavor, oriMaxFavor);
				if (flag6)
				{
					ValueTuple<short, short> favorAndMaxFavorToTaiwu2 = this.GetFavorAndMaxFavorToTaiwu(relatedChar);
					short currFavor = favorAndMaxFavorToTaiwu2.Item1;
					short currMaxFavor = favorAndMaxFavorToTaiwu2.Item2;
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(144, 7);
					defaultInterpolatedStringHandler.AppendLiteral("CheckFavorabilityAfterTransferring failed. ");
					defaultInterpolatedStringHandler.AppendLiteral("Related character: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(destCharId);
					defaultInterpolatedStringHandler.AppendLiteral(", oriFavor: ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(oriFavor);
					defaultInterpolatedStringHandler.AppendLiteral(", oriMaxFavor: ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(oriMaxFavor);
					defaultInterpolatedStringHandler.AppendLiteral("borrowedWorth: ");
					defaultInterpolatedStringHandler.AppendFormatted<long>(borrowedWorth);
					defaultInterpolatedStringHandler.AppendLiteral(", lentWorth: ");
					defaultInterpolatedStringHandler.AppendFormatted<long>(lentWorth);
					defaultInterpolatedStringHandler.AppendLiteral("currFavor: ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(currFavor);
					defaultInterpolatedStringHandler.AppendLiteral(", currMaxFavor: ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(currMaxFavor);
					logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
		}

		// Token: 0x060071D2 RID: 29138 RVA: 0x00417FCC File Offset: 0x004161CC
		public void TransferResource(DataContext context, Character srcChar, Character destChar, sbyte resourceType, int amount)
		{
			Tester.Assert(srcChar.GetId() != destChar.GetId(), "");
			Tester.Assert(resourceType >= 0 && resourceType < 8, "");
			Tester.Assert(amount > 0, "");
			srcChar.ChangeResource(context, resourceType, -amount);
			destChar.ChangeResource(context, resourceType, amount);
		}

		// Token: 0x060071D3 RID: 29139 RVA: 0x00418038 File Offset: 0x00416238
		public void TransferResource(DataContext context, Character srcChar, Character destChar, ref ResourceInts resources)
		{
			Tester.Assert(srcChar.GetId() != destChar.GetId(), "");
			destChar.ChangeResources(context, ref resources);
			resources = resources.GetReversed();
			srcChar.ChangeResources(context, ref resources);
		}

		// Token: 0x060071D4 RID: 29140 RVA: 0x00418084 File Offset: 0x00416284
		[DomainMethod]
		public void TransferInventoryItemWithDebt(DataContext context, int srcCharId, int destCharId, ItemKey itemKey, int amount, bool checkFavorability)
		{
			Character srcChar = DomainManager.Character.GetElement_Objects(srcCharId);
			Character destChar = DomainManager.Character.GetElement_Objects(destCharId);
			this.ClearItemUsingState(context, itemKey, srcCharId, ItemDisplayData.ItemUsingType.Invalid);
			this.TransferInventoryItem(context, srcChar, destChar, itemKey, amount);
			bool flag = destChar.GetCreatingType() == 1 && srcChar.GetCreatingType() == 1;
			if (flag)
			{
				this.UpdateDebtByItemTransfer(context, srcChar, destChar, itemKey, amount, true);
			}
			InteractOfLove.SetLoveTokenHolder(context, itemKey, destCharId);
		}

		// Token: 0x060071D5 RID: 29141 RVA: 0x004180F8 File Offset: 0x004162F8
		public void UpdateDebtByItemTransfer(DataContext context, Character srcChar, Character destChar, ItemKey itemKey, int amount, bool changeFavor)
		{
			int destCharId = destChar.GetId();
			int srcCharId = srcChar.GetId();
			Tester.Assert(srcCharId != destCharId, "");
			Tester.Assert(amount > 0, "");
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
			Character relatedChar = destChar;
			bool flag = destCharId == taiwuCharId;
			if (flag)
			{
				relatedChar = srcChar;
				amount = -amount;
			}
			else
			{
				bool flag2 = srcCharId != taiwuCharId;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(26, 2);
					defaultInterpolatedStringHandler.AppendLiteral("Neither party is taiwu: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(srcCharId);
					defaultInterpolatedStringHandler.AppendLiteral(", ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(destCharId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
			bool flag3 = relatedChar.GetCreatingType() != 1;
			if (!flag3)
			{
				short oriFavor;
				short oriMaxFavor;
				if (!changeFavor)
				{
					oriFavor = 0;
					oriMaxFavor = 0;
				}
				else
				{
					ValueTuple<short, short> favorAndMaxFavorToTaiwu = this.GetFavorAndMaxFavorToTaiwu(relatedChar);
					oriFavor = favorAndMaxFavorToTaiwu.Item1;
					oriMaxFavor = favorAndMaxFavorToTaiwu.Item2;
				}
				bool flag4 = amount >= 0;
				if (flag4)
				{
					this.BorrowItemFromTaiwu(context, relatedChar, itemKey, amount);
				}
				else
				{
					this.LendItemToTaiwu(context, relatedChar, itemKey, -amount);
				}
				if (changeFavor)
				{
					ItemBase item = DomainManager.Item.GetBaseItem(itemKey);
					int favorChange = item.GetFavorabilityChange() * amount;
					this.ChangeFavorabilityOptionalGiftItem(context, relatedChar, taiwuChar, favorChange);
				}
				bool flag5 = changeFavor && !this.CheckFavorabilityAfterTransferring(relatedChar, oriFavor, oriMaxFavor);
				if (flag5)
				{
					ValueTuple<short, short> favorAndMaxFavorToTaiwu2 = this.GetFavorAndMaxFavorToTaiwu(relatedChar);
					short currFavor = favorAndMaxFavorToTaiwu2.Item1;
					short currMaxFavor = favorAndMaxFavorToTaiwu2.Item2;
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(117, 5);
					defaultInterpolatedStringHandler.AppendLiteral("CheckFavorabilityAfterTransferring failed. ");
					defaultInterpolatedStringHandler.AppendLiteral("Related character: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(destCharId);
					defaultInterpolatedStringHandler.AppendLiteral(", oriFavor: ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(oriFavor);
					defaultInterpolatedStringHandler.AppendLiteral(", oriMaxFavor: ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(oriMaxFavor);
					defaultInterpolatedStringHandler.AppendLiteral(",");
					defaultInterpolatedStringHandler.AppendLiteral("currFavor: ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(currFavor);
					defaultInterpolatedStringHandler.AppendLiteral(", currMaxFavor: ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(currMaxFavor);
					logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
				}
			}
		}

		// Token: 0x060071D6 RID: 29142 RVA: 0x00418334 File Offset: 0x00416534
		[DomainMethod]
		public void TransferInventoryItemListWithDebt(DataContext context, int srcCharId, int destCharId, List<ItemKey> keyList, bool checkFavorability)
		{
			Tester.Assert(srcCharId != destCharId, "");
			Tester.Assert(keyList != null, "");
			Tester.Assert(keyList.Count > 0, "");
			foreach (ItemKey key in keyList)
			{
				this.TransferInventoryItemWithDebt(context, srcCharId, destCharId, key, 1, checkFavorability);
			}
		}

		// Token: 0x060071D7 RID: 29143 RVA: 0x004183C4 File Offset: 0x004165C4
		public void TransferInventoryItem(DataContext context, Character srcChar, Character destChar, ItemKey itemKey, int amount)
		{
			int srcCharId = srcChar.GetId();
			int destCharId = destChar.GetId();
			Tester.Assert(srcCharId != destCharId, "");
			bool flag = !DomainManager.Taiwu.IsInGroup(srcCharId) || !DomainManager.Taiwu.IsInGroup(destCharId);
			srcChar.RemoveInventoryItem(context, itemKey, amount, false, false);
			destChar.AddInventoryItem(context, itemKey, amount, false);
			bool flag2 = srcChar == DomainManager.Taiwu.GetTaiwu();
			if (flag2)
			{
				DomainManager.Extra.RecordTaiwuGiftItem(context, destCharId, itemKey, amount);
			}
		}

		// Token: 0x060071D8 RID: 29144 RVA: 0x00418450 File Offset: 0x00416650
		[DomainMethod]
		public void TransferInventoryItemFromAToB(DataContext context, int charA, int charB, ItemKey itemKey, int amount)
		{
			Tester.Assert(charA >= 0 && charB >= 0, "");
			Tester.Assert(charA != charB, "");
			Character characterA = this._objects[charA];
			Character characterB = this._objects[charB];
			this.TransferInventoryItem(context, characterA, characterB, itemKey, amount);
		}

		// Token: 0x060071D9 RID: 29145 RVA: 0x004184B4 File Offset: 0x004166B4
		public void TransferInventoryItemList(DataContext context, Character srcChar, Character destChar, List<ItemKey> keyList)
		{
			Tester.Assert(srcChar.GetId() != destChar.GetId(), "");
			Tester.Assert(keyList != null, "");
			Tester.Assert(keyList.Count > 0, "");
			foreach (ItemKey key in keyList)
			{
				this.TransferInventoryItem(context, srcChar, destChar, key, 1);
			}
		}

		// Token: 0x060071DA RID: 29146 RVA: 0x0041854C File Offset: 0x0041674C
		[DomainMethod]
		public void ChangeEquipment(DataContext context, int charId, sbyte srcSlot, sbyte destSlot, ItemKey srcItemKey)
		{
			Character character = this.GetElement_Objects(charId);
			character.ChangeEquipment(context, srcSlot, destSlot, srcItemKey);
		}

		// Token: 0x060071DB RID: 29147 RVA: 0x00418570 File Offset: 0x00416770
		[DomainMethod]
		public void CreateInventoryItem(DataContext context, int charId, sbyte itemType, short templateId, int amount)
		{
			Character character = this.GetElement_Objects(charId);
			character.CreateInventoryItem(context, itemType, templateId, amount);
		}

		// Token: 0x060071DC RID: 29148 RVA: 0x00418594 File Offset: 0x00416794
		[DomainMethod]
		public List<ItemDisplayData> GetInventoryItems(int charId, short itemSubType)
		{
			Character character = this.GetElement_Objects(charId);
			List<ValueTuple<ItemKey, int>> items = new List<ValueTuple<ItemKey, int>>();
			CharacterItemFilterWrappers.FindByItemSubType(character, itemSubType, items, true, false);
			return CharacterDomain.GetItemDisplayData(charId, items, ItemSourceType.Inventory);
		}

		// Token: 0x060071DD RID: 29149 RVA: 0x004185C8 File Offset: 0x004167C8
		[DomainMethod]
		public List<ItemDisplayData> GetInventoryItemsByItemType(int charId, sbyte itemType)
		{
			Character character = this.GetElement_Objects(charId);
			List<ValueTuple<ItemKey, int>> items = new List<ValueTuple<ItemKey, int>>();
			CharacterItemFilterWrappers.FindByItemType(character, itemType, items, true, false);
			return CharacterDomain.GetItemDisplayData(charId, items, ItemSourceType.Inventory);
		}

		// Token: 0x060071DE RID: 29150 RVA: 0x004185FC File Offset: 0x004167FC
		[DomainMethod]
		public List<ItemDisplayData> GetInventoryEquipment(int charId)
		{
			Character character = this.GetElement_Objects(charId);
			List<ValueTuple<ItemKey, int>> items = new List<ValueTuple<ItemKey, int>>();
			CharacterItemFilterWrappers.FindEquipment(character, items, true, false);
			return CharacterDomain.GetItemDisplayData(charId, items, ItemSourceType.Inventory);
		}

		// Token: 0x060071DF RID: 29151 RVA: 0x00418630 File Offset: 0x00416830
		[DomainMethod]
		public List<ItemDisplayData> GetAllInventoryItems(int charId)
		{
			Character character = this.GetElement_Objects(charId);
			Inventory inventory = character.GetInventory();
			return CharacterDomain.GetItemDisplayData(charId, inventory.Items, ItemSourceType.Inventory);
		}

		// Token: 0x060071E0 RID: 29152 RVA: 0x00418660 File Offset: 0x00416860
		[DomainMethod]
		public List<ItemDisplayData> GetAllInventoryItemsExcludeValueZero(int charId)
		{
			Character character = this.GetElement_Objects(charId);
			Inventory inventory = character.GetInventory();
			Dictionary<ItemKey, int> itemDict = ObjectPool<Dictionary<ItemKey, int>>.Instance.Get();
			itemDict.Clear();
			foreach (KeyValuePair<ItemKey, int> pair in inventory.Items)
			{
				bool flag = DomainManager.Item.GetBaseItem(pair.Key).GetValue() > 0;
				if (flag)
				{
					itemDict.Add(pair.Key, pair.Value);
				}
			}
			List<ItemDisplayData> result = CharacterDomain.GetItemDisplayData(charId, itemDict, ItemSourceType.Inventory);
			ObjectPool<Dictionary<ItemKey, int>>.Instance.Return(itemDict);
			return result;
		}

		// Token: 0x060071E1 RID: 29153 RVA: 0x00418724 File Offset: 0x00416924
		[DomainMethod]
		public int GetInventoryItemAmount(int charId, sbyte itemType, short templateId)
		{
			Character character = this.GetElement_Objects(charId);
			List<ValueTuple<ItemKey, int>> items = new List<ValueTuple<ItemKey, int>>();
			CharacterItemFilterWrappers.FindByTemplateId(character, itemType, templateId, items, true, false);
			int amount = 0;
			int i = 0;
			int itemsCount = items.Count;
			while (i < itemsCount)
			{
				amount += items[i].Item2;
				i++;
			}
			return amount;
		}

		// Token: 0x060071E2 RID: 29154 RVA: 0x00418780 File Offset: 0x00416980
		[DomainMethod]
		public List<ItemDisplayData> GetAllEquipmentItems(int charId)
		{
			List<ItemDisplayData> data = new List<ItemDisplayData>();
			ItemDisplayData emptyData = null;
			Character character;
			bool flag = this.TryGetElement_Objects(charId, out character);
			if (flag)
			{
				ItemKey[] equipment = character.GetEquipment();
				foreach (ItemKey itemKey in equipment)
				{
					bool flag2 = itemKey.IsValid();
					if (flag2)
					{
						data.Add(DomainManager.Item.GetItemDisplayData(DomainManager.Item.GetBaseItem(itemKey), 1, charId, 0));
					}
					else
					{
						List<ItemDisplayData> list = data;
						ItemDisplayData item;
						if ((item = emptyData) == null)
						{
							item = (emptyData = new ItemDisplayData());
						}
						list.Add(item);
					}
				}
			}
			else
			{
				for (int i = 0; i < 12; i++)
				{
					List<ItemDisplayData> list2 = data;
					ItemDisplayData item2;
					if ((item2 = emptyData) == null)
					{
						item2 = (emptyData = new ItemDisplayData());
					}
					list2.Add(item2);
				}
			}
			return data;
		}

		// Token: 0x060071E3 RID: 29155 RVA: 0x0041884C File Offset: 0x00416A4C
		[DomainMethod]
		public ItemDisplayData GetInventoryItemDisplayData(int charId, ItemKey itemKey)
		{
			ItemBase item = DomainManager.Item.GetBaseItem(itemKey);
			return DomainManager.Item.GetItemDisplayData(item, this.GetElement_Objects(charId).GetInventory().Items[itemKey], charId, 1);
		}

		// Token: 0x060071E4 RID: 29156 RVA: 0x00418890 File Offset: 0x00416A90
		[DomainMethod]
		public bool InventoryContainsItem(int charId, ItemKey itemKey)
		{
			Character character = this.GetElement_Objects(charId);
			Inventory inventory = character.GetInventory();
			return inventory.Items.ContainsKey(itemKey);
		}

		// Token: 0x060071E5 RID: 29157 RVA: 0x004188C0 File Offset: 0x00416AC0
		public bool[] GetCharBookReadState(int charId, ItemKey bookItemKey)
		{
			Character character = this.GetElement_Objects(charId);
			GameData.Domains.Item.SkillBook book = DomainManager.Item.GetElement_SkillBooks(bookItemKey.Id);
			bool isLifeSkill = SkillGroup.FromItemSubType(book.GetItemSubType()) == 0;
			bool[] result = new bool[isLifeSkill ? 5 : 6];
			bool flag = isLifeSkill;
			if (flag)
			{
				short skillTemplateId = book.GetLifeSkillTemplateId();
				int index = character.FindLearnedLifeSkillIndex(skillTemplateId);
				bool flag2 = index >= 0;
				if (flag2)
				{
					LifeSkillItem lifeSkill = character.GetLearnedLifeSkills()[index];
					for (byte i = 0; i < 5; i += 1)
					{
						result[(int)i] = lifeSkill.IsPageRead(i);
					}
				}
			}
			else
			{
				short skillTemplateId2 = book.GetCombatSkillTemplateId();
				GameData.Domains.CombatSkill.CombatSkill skill;
				bool flag3 = DomainManager.CombatSkill.TryGetElement_CombatSkills(new CombatSkillKey(charId, skillTemplateId2), out skill);
				if (flag3)
				{
					byte pageTypes = book.GetPageTypes();
					sbyte behaviorType = SkillBookStateHelper.GetOutlinePageType(pageTypes);
					ushort readingState = skill.GetReadingState();
					for (byte j = 0; j < 6; j += 1)
					{
						sbyte direction = SkillBookStateHelper.GetNormalPageType(pageTypes, j);
						result[(int)j] = CombatSkillStateHelper.IsPageRead(readingState, CombatSkillStateHelper.GetPageInternalIndex(behaviorType, direction, j));
					}
				}
			}
			return result;
		}

		// Token: 0x060071E6 RID: 29158 RVA: 0x004189E4 File Offset: 0x00416BE4
		[DomainMethod]
		public void AddEatingItem(DataContext context, int charId, ItemKey itemKey, List<sbyte> targetBodyParts = null)
		{
			Character character = this.GetElement_Objects(charId);
			character.RemoveInventoryItem(context, itemKey, 1, false, false);
			character.AddEatingItem(context, itemKey, targetBodyParts);
		}

		// Token: 0x060071E7 RID: 29159 RVA: 0x00418A14 File Offset: 0x00416C14
		[DomainMethod]
		public SimulateEatingEffectResult SimulateEatingEffect(DataContext context, int charId, ItemKey itemKey, int amount)
		{
			Character character;
			bool flag = !this._objects.TryGetValue(charId, out character);
			SimulateEatingEffectResult result;
			if (flag)
			{
				result = null;
			}
			else
			{
				PoisonInts poisoned = default(PoisonInts);
				poisoned.Add(character.GetPoisoned());
				Injuries injuries = default(Injuries);
				injuries.Initialize();
				injuries.Change(character.GetInjuries());
				short disorderOfQi = character.GetDisorderOfQi();
				short health = character.GetHealth();
				SimulateEatingEffectResult simulateEatingEffectResult = new SimulateEatingEffectResult();
				sbyte itemType = itemKey.ItemType;
				sbyte b = itemType;
				if (b != 8)
				{
					if (b == 9)
					{
						int baseValue = (int)Config.TeaWine.Instance[itemKey.TemplateId].DirectChangeOfQiDisorder * amount;
						ValueTuple<int, int> valueTuple = CFormula.RandomCalcDisorderOfQiRange(baseValue);
						int deltaMin = valueTuple.Item1;
						int deltaMax = valueTuple.Item2;
						deltaMin = character.CalcDisorderOfQiDelta(deltaMin);
						deltaMax = character.CalcDisorderOfQiDelta(deltaMax);
						int disorderOfQiDeltaMin = Math.Clamp((int)disorderOfQi + deltaMin, 0, (int)DisorderLevelOfQi.MaxValue);
						int disorderOfQiDeltaMax = Math.Clamp((int)disorderOfQi + deltaMax, 0, (int)DisorderLevelOfQi.MaxValue);
						simulateEatingEffectResult.MinDisorderOfQi = Math.Min(disorderOfQiDeltaMin, disorderOfQiDeltaMax);
						simulateEatingEffectResult.MaxDisorderOfQi = Math.Max(disorderOfQiDeltaMin, disorderOfQiDeltaMax);
					}
				}
				else
				{
					MedicineItem config = Config.Medicine.Instance[itemKey.TemplateId];
					MedicineEatingInstantEffect effect = new MedicineEatingInstantEffect(config, null);
					for (int i = 0; i < amount; i++)
					{
						switch (config.EffectType)
						{
						case EMedicineEffectType.RecoverOuterInjury:
							character.CalcMedicineEffect_RecoverInjury(ref injuries, context.Random, false, ref effect);
							break;
						case EMedicineEffectType.RecoverInnerInjury:
							character.CalcMedicineEffect_RecoverInjury(ref injuries, context.Random, true, ref effect);
							break;
						case EMedicineEffectType.RecoverHealth:
							character.CalcMedicineEffect_RecoverHealth(ref health, ref effect);
							break;
						case EMedicineEffectType.ChangeDisorderOfQi:
							character.CalcMedicineEffect_RecoverDisorderOfQi(ref disorderOfQi, ref effect);
							simulateEatingEffectResult.MaxDisorderOfQi = (simulateEatingEffectResult.MinDisorderOfQi = (int)disorderOfQi);
							break;
						case EMedicineEffectType.DetoxPoison:
							character.CalcMedicineEffect_DetoxPoison(ref poisoned, ref effect);
							break;
						case EMedicineEffectType.ApplyPoison:
							character.CalcMedicineEffect_ApplyPoison(ref poisoned, ref effect);
							break;
						}
					}
				}
				simulateEatingEffectResult.Health = (int)health;
				simulateEatingEffectResult.Poisons = poisoned;
				simulateEatingEffectResult.Injuries = injuries;
				result = simulateEatingEffectResult;
			}
			return result;
		}

		// Token: 0x060071E8 RID: 29160 RVA: 0x00418C38 File Offset: 0x00416E38
		[DomainMethod]
		public ItemPowerInfo GetItemPowerInfo(int charId, ItemKey itemKey)
		{
			bool flag = !DomainManager.Item.ItemExists(itemKey) || !DomainManager.Character.IsCharacterAlive(charId);
			ItemPowerInfo result;
			if (flag)
			{
				result = ItemPowerInfo.Default;
			}
			else
			{
				result = new ItemPowerInfo
				{
					Power = this.GetItemPower(charId, itemKey),
					MaxPower = this.GetItemMaxPower(charId, itemKey),
					RequirementsPower = this.GetItemRequirementsPower(charId, itemKey)
				};
			}
			return result;
		}

		// Token: 0x060071E9 RID: 29161 RVA: 0x00418CAC File Offset: 0x00416EAC
		public static void ClassifyItemsToLose([TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<ItemBase, int>>[] classifiedItems, IReadOnlyDictionary<ItemKey, int> oriItems, bool isTaiwuInventory = false)
		{
			AdvanceMonthRelatedData.Clear<ValueTuple<ItemBase, int>>(classifiedItems);
			foreach (KeyValuePair<ItemKey, int> keyValuePair in oriItems)
			{
				ItemKey itemKey2;
				int num;
				keyValuePair.Deconstruct(out itemKey2, out num);
				ItemKey itemKey = itemKey2;
				int amount = num;
				bool flag = !ItemDomain.CanItemBeLost(itemKey);
				if (!flag)
				{
					ItemBase item = DomainManager.Item.GetBaseItem(itemKey);
					classifiedItems[(int)(item.GetGrade() / 3)].Add(new ValueTuple<ItemBase, int>(item, amount));
				}
			}
			if (isTaiwuInventory)
			{
				CharacterDomain.RemoveTaiwuReadingBookFromClassifiedItems(classifiedItems);
			}
		}

		// Token: 0x060071EA RID: 29162 RVA: 0x00418D50 File Offset: 0x00416F50
		public static void GetLostItemsByAmount(DataContext context, int amountToLose, Dictionary<ItemKey, int> oriItems, [TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<ItemBase, int>> itemsToBeLost, bool isTaiwuInventory = false)
		{
			IRandomSource random = context.Random;
			List<ValueTuple<ItemBase, int>>[] classifiedItems = context.AdvanceMonthRelatedData.ClassifiedItems.Occupy();
			CharacterDomain.ClassifyItemsToLose(classifiedItems, oriItems, isTaiwuInventory);
			CharacterDomain.GetLostItemsByAmount(random, amountToLose, classifiedItems, itemsToBeLost);
			context.AdvanceMonthRelatedData.ClassifiedItems.Release(ref classifiedItems);
		}

		// Token: 0x060071EB RID: 29163 RVA: 0x00418DA0 File Offset: 0x00416FA0
		public static void GetLostItemsByAmount(IRandomSource random, int amountToLose, [TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<ItemBase, int>>[] classifiedItems, [TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<ItemBase, int>> itemsToBeLost)
		{
			int lostAmount = 0;
			int i = 0;
			int count = classifiedItems.Length;
			while (i < count)
			{
				List<ValueTuple<ItemBase, int>> currItems = classifiedItems[i];
				while (currItems.Count > 0 && lostAmount < amountToLose)
				{
					int randomIndex = random.Next(currItems.Count);
					ValueTuple<ItemBase, int> valueTuple = currItems[randomIndex];
					ItemBase item = valueTuple.Item1;
					int amount = valueTuple.Item2;
					int amountToBeLost = (amount <= 1) ? 1 : (random.Next(amount) + 1);
					amountToBeLost = Math.Min(amountToBeLost, amountToLose - lostAmount);
					itemsToBeLost.Add(new ValueTuple<ItemBase, int>(item, amountToBeLost));
					bool flag = amountToBeLost >= amount;
					if (flag)
					{
						CollectionUtils.SwapAndRemove<ValueTuple<ItemBase, int>>(currItems, randomIndex);
					}
					else
					{
						currItems[randomIndex] = new ValueTuple<ItemBase, int>(item, amount - amountToBeLost);
					}
					lostAmount += amountToBeLost;
				}
				i++;
			}
		}

		// Token: 0x060071EC RID: 29164 RVA: 0x00418E7C File Offset: 0x0041707C
		public static void GetLostItemsDueToOverload(DataContext context, int overloadedWeight, IReadOnlyDictionary<ItemKey, int> oriItems, [TupleElementNames(new string[]
		{
			"item",
			"amount"
		})] List<ValueTuple<ItemBase, int>> itemsToBeLost, bool isTaiwuInventory = false)
		{
			itemsToBeLost.Clear();
			List<ValueTuple<ItemBase, int>>[] classifiedItems = context.AdvanceMonthRelatedData.ClassifiedItems.Occupy();
			CharacterDomain.ClassifyItemsToLose(classifiedItems, oriItems, isTaiwuInventory);
			int singleItemLostWeightLine = Math.Max(overloadedWeight * 20 / 100, 10);
			int lostWeight = 0;
			int i = 0;
			int count = classifiedItems.Length;
			Predicate<ValueTuple<ItemBase, int>> <>9__0;
			while (i < count)
			{
				List<ValueTuple<ItemBase, int>> currItems = classifiedItems[i];
				List<ValueTuple<ItemBase, int>> list = currItems;
				Predicate<ValueTuple<ItemBase, int>> match;
				if ((match = <>9__0) == null)
				{
					match = (<>9__0 = delegate([TupleElementNames(new string[]
					{
						"item",
						"amount"
					})] ValueTuple<ItemBase, int> pair)
					{
						int weight = pair.Item1.GetWeight();
						return weight > singleItemLostWeightLine || weight == 0;
					});
				}
				list.RemoveAll(match);
				currItems.Sort((ValueTuple<ItemBase, int> itemA, ValueTuple<ItemBase, int> itemB) => itemA.Item1.GetWeight().CompareTo(itemB.Item1.GetWeight()));
				while (currItems.Count > 0)
				{
					int index = 0;
					ValueTuple<ItemBase, int> valueTuple = currItems[index];
					ItemBase item = valueTuple.Item1;
					int amount = valueTuple.Item2;
					int amountToBeLost = 1;
					itemsToBeLost.Add(new ValueTuple<ItemBase, int>(item, amountToBeLost));
					bool flag = amountToBeLost >= amount;
					if (flag)
					{
						CollectionUtils.SwapAndRemove<ValueTuple<ItemBase, int>>(currItems, index);
					}
					else
					{
						currItems[index] = new ValueTuple<ItemBase, int>(item, amount - amountToBeLost);
					}
					lostWeight += item.GetWeight() * amountToBeLost;
					bool flag2 = lostWeight >= singleItemLostWeightLine;
					if (flag2)
					{
						context.AdvanceMonthRelatedData.ClassifiedItems.Release(ref classifiedItems);
						return;
					}
				}
				i++;
			}
			context.AdvanceMonthRelatedData.ClassifiedItems.Release(ref classifiedItems);
		}

		// Token: 0x060071ED RID: 29165 RVA: 0x00419000 File Offset: 0x00417200
		public static void GetItemSubTypeStats(DataContext context, Dictionary<ItemKey, int> inventoryItems, ItemKey[] equipmentItems)
		{
			Dictionary<short, ValueTuple<sbyte, int>> itemSubTypeStats = context.AdvanceMonthRelatedData.ItemSubTypeStats.Get();
			itemSubTypeStats.Clear();
			foreach (KeyValuePair<ItemKey, int> pair in inventoryItems)
			{
				ItemKey itemKey = pair.Key;
				int amount = pair.Value;
				short itemSubType = ItemTemplateHelper.GetItemSubType(itemKey.ItemType, itemKey.TemplateId);
				sbyte itemGrade = ItemTemplateHelper.GetGrade(itemKey.ItemType, itemKey.TemplateId);
				ValueTuple<sbyte, int> itemInfo;
				bool flag = itemSubTypeStats.TryGetValue(itemSubType, out itemInfo);
				if (flag)
				{
					itemGrade = Math.Max(itemInfo.Item1, itemGrade);
					amount = itemInfo.Item2 + amount;
				}
				itemSubTypeStats[itemSubType] = new ValueTuple<sbyte, int>(itemGrade, amount);
			}
			foreach (ItemKey itemKey2 in equipmentItems)
			{
				bool flag2 = !itemKey2.IsValid();
				if (!flag2)
				{
					int amount2 = 1;
					short itemSubType2 = ItemTemplateHelper.GetItemSubType(itemKey2.ItemType, itemKey2.TemplateId);
					sbyte itemGrade2 = ItemTemplateHelper.GetGrade(itemKey2.ItemType, itemKey2.TemplateId);
					ValueTuple<sbyte, int> itemInfo2;
					bool flag3 = itemSubTypeStats.TryGetValue(itemSubType2, out itemInfo2);
					if (flag3)
					{
						itemGrade2 = Math.Max(itemInfo2.Item1, itemGrade2);
						amount2 = itemInfo2.Item2 + amount2;
					}
					itemSubTypeStats[itemSubType2] = new ValueTuple<sbyte, int>(itemGrade2, amount2);
				}
			}
		}

		// Token: 0x060071EE RID: 29166 RVA: 0x0041918C File Offset: 0x0041738C
		public static GameData.Domains.Item.Medicine SelectMedicineToUse(DataContext context, EMedicineEffectType effectType, sbyte poisonType, int targetValue)
		{
			List<ValueTuple<GameData.Domains.Item.Medicine, int>>[] categorizedRegenItems = context.AdvanceMonthRelatedData.CategorizedMedicines.Get();
			int bestDiff = int.MaxValue;
			GameData.Domains.Item.Medicine bestMedicine = null;
			foreach (ValueTuple<GameData.Domains.Item.Medicine, int> valueTuple in categorizedRegenItems[(int)effectType])
			{
				GameData.Domains.Item.Medicine item = valueTuple.Item1;
				int amount = valueTuple.Item2;
				bool flag = poisonType != item.GetEffectSubType().PoisonType();
				if (!flag)
				{
					bool flag2 = ModificationStateHelper.IsActive(item.GetModificationState(), 1);
					if (!flag2)
					{
						short effectValue = item.GetEffectValue();
						int diff = (int)effectValue - targetValue;
						diff *= diff;
						bool flag3 = diff < bestDiff;
						if (flag3)
						{
							bestDiff = diff;
							bestMedicine = item;
						}
					}
				}
			}
			return bestMedicine;
		}

		// Token: 0x060071EF RID: 29167 RVA: 0x00419264 File Offset: 0x00417464
		public unsafe void InitializeOwnedItems()
		{
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				Inventory inventory = character.GetInventory();
				foreach (KeyValuePair<ItemKey, int> keyValuePair2 in inventory.Items)
				{
					ItemKey itemKey5;
					keyValuePair2.Deconstruct(out itemKey5, out num);
					ItemKey itemKey = itemKey5;
					DomainManager.Item.SetOwner(itemKey, ItemOwnerType.CharacterInventory, charId);
				}
				ItemKey[] equipments = character.GetEquipment();
				foreach (ItemKey itemKey2 in equipments)
				{
					bool flag = !itemKey2.IsValid();
					if (!flag)
					{
						DomainManager.Item.SetOwner(itemKey2, ItemOwnerType.CharacterEquipment, charId);
					}
				}
				ref EatingItems eatingItems = ref character.GetEatingItems();
				for (int i = 0; i < 9; i++)
				{
					ItemKey itemKey3 = (ItemKey)(*(ref eatingItems.ItemKeys.FixedElementField + (IntPtr)i * 8));
					bool flag2 = !itemKey3.IsValid();
					if (!flag2)
					{
						DomainManager.Item.SetOwner(itemKey3, ItemOwnerType.CharacterEatingItem, charId);
					}
				}
			}
			foreach (KeyValuePair<int, Grave> keyValuePair3 in this._graves)
			{
				int num;
				Grave grave2;
				keyValuePair3.Deconstruct(out num, out grave2);
				int charId2 = num;
				Grave grave = grave2;
				Inventory inventory2 = grave.GetInventory();
				foreach (KeyValuePair<ItemKey, int> keyValuePair2 in inventory2.Items)
				{
					ItemKey itemKey5;
					keyValuePair2.Deconstruct(out itemKey5, out num);
					ItemKey itemKey4 = itemKey5;
					DomainManager.Item.SetOwner(itemKey4, ItemOwnerType.Grave, charId2);
				}
			}
			foreach (KeyValuePair<int, KidnappedCharacterList> keyValuePair4 in this._kidnappedChars)
			{
				int num;
				KidnappedCharacterList kidnappedCharacterList;
				keyValuePair4.Deconstruct(out num, out kidnappedCharacterList);
				KidnappedCharacterList kidnappedCharacters = kidnappedCharacterList;
				List<KidnappedCharacter> kidnappedCharList = kidnappedCharacters.GetCollection();
				foreach (KidnappedCharacter kidnappedChar in kidnappedCharList)
				{
					ItemKey ropeItemKey = kidnappedChar.RopeItemKey;
					bool flag3 = !ropeItemKey.IsValid();
					if (!flag3)
					{
						DomainManager.Item.SetOwner(ropeItemKey, ItemOwnerType.KidnapperRope, kidnappedChar.CharId);
					}
				}
			}
		}

		// Token: 0x060071F0 RID: 29168 RVA: 0x004195B8 File Offset: 0x004177B8
		[DomainMethod]
		public sbyte GetCurrMaxEatingSlotsCount(int charId)
		{
			return this.GetElement_Objects(charId).GetCurrMaxEatingSlotsCount();
		}

		// Token: 0x060071F1 RID: 29169 RVA: 0x004195D8 File Offset: 0x004177D8
		[DomainMethod]
		public int[] GetMixedPoisonTypeRelatedMarkCountArray(int charId)
		{
			Character character = this.GetElement_Objects(charId);
			int length = 20;
			int[] markCount = new int[length];
			sbyte i = 0;
			while ((int)i < length)
			{
				markCount[(int)i] = character.GetMixedPoisonTypeRelatedMarkCount(i + 15);
				i += 1;
			}
			return markCount;
		}

		// Token: 0x060071F2 RID: 29170 RVA: 0x00419624 File Offset: 0x00417824
		[DomainMethod]
		public bool MerchantHasNewGoods(int charId)
		{
			Character character;
			bool flag = !DomainManager.Character.TryGetElement_Objects(charId, out character);
			return !flag && DomainManager.Merchant.HasNewGoods(character);
		}

		// Token: 0x060071F3 RID: 29171 RVA: 0x0041965C File Offset: 0x0041785C
		public short GetItemPower(int charId, ItemKey itemKey)
		{
			bool flag = itemKey.ItemType != 0 && itemKey.ItemType != 1;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Cannot get use power of item type ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(itemKey.ItemType);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			Character character = this.GetElement_Objects(charId);
			int fixPower = (int)((itemKey.ItemType == 0) ? character.GetFixWeaponPower() : character.GetFixArmorPower());
			int power = (fixPower < 0) ? ((int)this.GetItemRequirementsPower(charId, itemKey)) : fixPower;
			bool flag2 = DomainManager.Combat.IsCharInCombat(charId, true);
			if (flag2)
			{
				int addValue = DomainManager.Combat.EquipmentPowerChangeInCombat.GetOrDefault(charId);
				power = DomainManager.SpecialEffect.ModifyValue(charId, 315, power, itemKey.Id, -1, -1, addValue, 0, 0, 0);
			}
			return (short)Math.Clamp(power, 0, 9999);
		}

		// Token: 0x060071F4 RID: 29172 RVA: 0x00419748 File Offset: 0x00417948
		public short GetItemMaxPower(int charId, ItemKey itemKey)
		{
			bool flag = itemKey.ItemType != 0 && itemKey.ItemType != 1;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Cannot get use power of item type ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(itemKey.ItemType);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			int maxPower = CFormula.CalcItemMaxUsePower((int)this.GetElement_Objects(charId).GetWeaponSwitchSpeed());
			ushort fieldId = (itemKey.ItemType == 0) ? 27 : 30;
			maxPower = DomainManager.SpecialEffect.ModifyValue(charId, fieldId, maxPower, itemKey.Id, -1, -1, 0, 0, 0, 0);
			return (short)Math.Clamp(maxPower, 0, 9999);
		}

		// Token: 0x060071F5 RID: 29173 RVA: 0x004197F4 File Offset: 0x004179F4
		public short GetItemRequirementsPower(int charId, ItemKey itemKey)
		{
			bool flag = itemKey.ItemType != 0 && itemKey.ItemType != 1;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Cannot get use power of item type ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(itemKey.ItemType);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			Character character = this.GetElement_Objects(charId);
			bool isWeapon = itemKey.ItemType == 0;
			int power = 0;
			List<PropertyAndValue> requirements = isWeapon ? Config.Weapon.Instance[itemKey.TemplateId].RequiredCharacterProperties : Config.Armor.Instance[itemKey.TemplateId].RequiredCharacterProperties;
			short maxPower = this.GetItemMaxPower(charId, itemKey);
			int requirementPercent = 100;
			int requirementsCount = requirements.Count;
			bool flag2 = itemKey.IsValid();
			if (flag2)
			{
				short equipmentEffectId = DomainManager.Item.GetBaseEquipment(itemKey).GetEquipmentEffectId();
				bool flag3 = equipmentEffectId >= 0;
				if (flag3)
				{
					requirementPercent += (int)EquipmentEffect.Instance[equipmentEffectId].RequirementChange;
				}
			}
			requirementPercent += DomainManager.SpecialEffect.GetModifyValue(charId, isWeapon ? 28 : 31, EDataModifyType.Add, -1, -1, -1, EDataSumType.All);
			bool flag4 = requirementsCount > 0;
			if (flag4)
			{
				for (int i = 0; i < requirementsCount; i++)
				{
					PropertyAndValue requirement = requirements[i];
					bool flag5 = requirement.Value > 0;
					if (flag5)
					{
						int actualValue = character.GetPropertyValue((ECharacterPropertyReferencedType)requirement.PropertyId);
						int requireValue = (int)requirement.Value * requirementPercent / 100;
						power += Math.Min(actualValue * 100 / requireValue, (int)maxPower);
					}
				}
				bool flag6 = requirementsCount > 1;
				if (flag6)
				{
					power /= requirementsCount;
				}
			}
			else
			{
				power = 100;
			}
			return (short)Math.Clamp(power, 0, (int)maxPower);
		}

		// Token: 0x060071F6 RID: 29174 RVA: 0x004199A8 File Offset: 0x00417BA8
		public int CalcWeaponChangeTrickValue(int charId, ItemKey itemKey, bool isFirstAttack = true, bool hit = true)
		{
			int addValue = isFirstAttack ? GlobalConfig.Instance.FirstAttackAddChangeTrickProgress : GlobalConfig.Instance.PursueAttackAddChangeTrickProgress;
			addValue = addValue * this.GetWeaponChangeTrickPercent(charId, itemKey) / 100;
			int result;
			if (hit)
			{
				result = addValue;
			}
			else
			{
				GameData.Domains.Item.Weapon weapon = DomainManager.Item.GetElement_Weapons(itemKey.Id);
				sbyte attackPointCost = weapon.GetAttackPreparePointCost();
				int factor = GlobalConfig.Instance.AvoidChangeTrickProgressPercentByWeapon[(int)attackPointCost];
				addValue *= factor;
				result = addValue;
			}
			return result;
		}

		// Token: 0x060071F7 RID: 29175 RVA: 0x00419A24 File Offset: 0x00417C24
		public int GetWeaponChangeTrickPercent(int charId, ItemKey itemKey)
		{
			bool flag = itemKey.ItemType != 0;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(47, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Cannot get use ChangeTrickPercent of item type ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(itemKey.ItemType);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			short usePower = this.GetItemPower(charId, itemKey);
			return (int)(Config.Weapon.Instance[itemKey.TemplateId].ChangeTrickPercent * usePower / 100);
		}

		// Token: 0x060071F8 RID: 29176 RVA: 0x00419A98 File Offset: 0x00417C98
		[return: TupleElementNames(new string[]
		{
			"type",
			"required",
			"actual"
		})]
		public List<ValueTuple<int, int, int>> GetItemRequirementsAndActualValues(int charId, ItemKey itemKey)
		{
			bool flag = itemKey.ItemType != 0 && itemKey.ItemType != 1;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Cannot get use power of item type ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(itemKey.ItemType);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			Character character = (charId >= 0) ? this.GetElement_Objects(charId) : null;
			List<PropertyAndValue> requirements = (itemKey.ItemType == 0) ? Config.Weapon.Instance[itemKey.TemplateId].RequiredCharacterProperties : Config.Armor.Instance[itemKey.TemplateId].RequiredCharacterProperties;
			List<ValueTuple<int, int, int>> result = new List<ValueTuple<int, int, int>>();
			int requirementPercent = 100;
			short equipmentEffectId = DomainManager.Item.GetBaseEquipment(itemKey).GetEquipmentEffectId();
			bool flag2 = equipmentEffectId >= 0;
			if (flag2)
			{
				requirementPercent += (int)EquipmentEffect.Instance[equipmentEffectId].RequirementChange;
			}
			requirementPercent += DomainManager.SpecialEffect.GetModifyValue(charId, (itemKey.ItemType == 0) ? 28 : 31, EDataModifyType.Add, -1, -1, -1, EDataSumType.All);
			for (int i = 0; i < requirements.Count; i++)
			{
				PropertyAndValue requirement = requirements[i];
				result.Add(new ValueTuple<int, int, int>((int)requirement.PropertyId, (int)requirement.Value * requirementPercent / 100, (character != null) ? character.GetPropertyValue((ECharacterPropertyReferencedType)requirement.PropertyId) : 0));
			}
			return result;
		}

		// Token: 0x060071F9 RID: 29177 RVA: 0x00419BF8 File Offset: 0x00417DF8
		public void RemoveAllInventoryAndEquippedItems(DataContext context, Character character)
		{
			ItemKey[] equipment = character.GetEquipment();
			for (int i = 0; i < 12; i++)
			{
				ItemKey itemKey = equipment[i];
				bool flag = itemKey.IsValid();
				if (flag)
				{
					DomainManager.Item.RemoveItem(context, itemKey);
					equipment[i] = ItemKey.Invalid;
				}
			}
			character.SetEquipment(equipment, context);
			Inventory inventory = character.GetInventory();
			foreach (KeyValuePair<ItemKey, int> keyValuePair in inventory.Items)
			{
				ItemKey itemKey3;
				int num;
				keyValuePair.Deconstruct(out itemKey3, out num);
				ItemKey itemKey2 = itemKey3;
				DomainManager.Item.RemoveItem(context, itemKey2);
			}
			inventory.Items.Clear();
			character.SetInventory(inventory, context);
		}

		// Token: 0x060071FA RID: 29178 RVA: 0x00419CDC File Offset: 0x00417EDC
		public ItemDisplayData.ItemUsingType GetItemUsingType(ItemKey itemKey, int charId)
		{
			bool isTaiwu = charId == DomainManager.Taiwu.GetTaiwuCharId();
			ItemDisplayData.ItemUsingType usingType = ItemDisplayData.ItemUsingType.Invalid;
			bool flag = ItemType.IsEquipmentItemType(itemKey.ItemType);
			if (flag)
			{
				ItemKey[] equipment = DomainManager.Character.GetElement_Objects(charId).GetEquipment();
				foreach (ItemKey key in equipment)
				{
					bool flag2 = key.Equals(itemKey);
					if (flag2)
					{
						usingType = ItemDisplayData.ItemUsingType.Equiped;
						break;
					}
				}
				bool flag3 = usingType != ItemDisplayData.ItemUsingType.Equiped && isTaiwu;
				if (flag3)
				{
					bool isInPlan = DomainManager.Taiwu.CheckItemIsInEquipmentPlan(itemKey);
					bool flag4 = isInPlan;
					if (flag4)
					{
						usingType = ItemDisplayData.ItemUsingType.EquipmentPlaned;
					}
				}
				bool flag5 = DomainManager.Extra.IsItemJiaoRelated(itemKey);
				if (flag5)
				{
					int jiaoId;
					GameData.DLC.FiveLoong.Jiao jiao;
					bool flag6 = DomainManager.Extra.TryGetJiaoIdByItemKey(itemKey, out jiaoId) && DomainManager.Extra.TryGetJiao(jiaoId, out jiao) && jiao.GrowthStage == 2;
					if (flag6)
					{
						foreach (JiaoPool jiaoPool in DomainManager.Extra.GetJiaoPools())
						{
							bool flag7 = jiaoPool.Jiaos.Count >= 2 && jiaoPool.Jiaos.Contains(jiaoId);
							if (flag7)
							{
								usingType = ItemDisplayData.ItemUsingType.Breeding;
								break;
							}
						}
					}
				}
			}
			else
			{
				bool flag8 = itemKey.ItemType == 10 && isTaiwu;
				if (flag8)
				{
					bool flag9 = DomainManager.Taiwu.GetCurReadingBook().Equals(itemKey);
					if (flag9)
					{
						usingType = ItemDisplayData.ItemUsingType.Reading;
					}
					else
					{
						ItemKey[] referenceBooks = DomainManager.Taiwu.GetReferenceBooks();
						foreach (ItemKey key2 in referenceBooks)
						{
							bool flag10 = key2.Equals(itemKey);
							if (flag10)
							{
								usingType = ItemDisplayData.ItemUsingType.Referring;
								break;
							}
						}
					}
				}
			}
			return usingType;
		}

		// Token: 0x060071FB RID: 29179 RVA: 0x00419EC0 File Offset: 0x004180C0
		public void ClearItemUsingState(DataContext context, ItemKey itemKey, int charId, ItemDisplayData.ItemUsingType usingType = ItemDisplayData.ItemUsingType.Invalid)
		{
			bool flag = usingType == ItemDisplayData.ItemUsingType.Invalid;
			if (flag)
			{
				usingType = this.GetItemUsingType(itemKey, charId);
			}
			bool flag2 = usingType == ItemDisplayData.ItemUsingType.Invalid;
			if (!flag2)
			{
				bool isTaiwu = charId == DomainManager.Taiwu.GetTaiwuCharId();
				switch (usingType)
				{
				case ItemDisplayData.ItemUsingType.Reading:
				{
					bool flag3 = !isTaiwu;
					if (!flag3)
					{
						bool flag4 = DomainManager.Taiwu.GetCurReadingBook().Equals(itemKey);
						if (flag4)
						{
							DomainManager.Taiwu.SetReadingBook(context, ItemKey.Invalid);
						}
					}
					break;
				}
				case ItemDisplayData.ItemUsingType.EquipmentPlaned:
				{
					bool flag5 = !isTaiwu;
					if (!flag5)
					{
						int planIndex;
						int slotIndex;
						bool isInPlan = DomainManager.Taiwu.FindItemInEquipmentPlan(itemKey, out planIndex, out slotIndex);
						bool flag6 = isInPlan;
						if (flag6)
						{
							DomainManager.Taiwu.SetEquipmentPlan(context, ItemKey.Invalid, planIndex, slotIndex);
						}
					}
					break;
				}
				case ItemDisplayData.ItemUsingType.Equiped:
				{
					ItemKey[] equipment = DomainManager.Character.GetElement_Objects(charId).GetEquipment();
					sbyte slot = EquipmentSlotHelper.GetEquipmentSlot(itemKey, equipment);
					bool flag7 = slot != -1;
					if (flag7)
					{
						DomainManager.Character.ChangeEquipment(context, charId, slot, -1, itemKey);
					}
					break;
				}
				case ItemDisplayData.ItemUsingType.Referring:
				{
					bool flag8 = !isTaiwu;
					if (!flag8)
					{
						ItemKey[] referenceBooks = DomainManager.Taiwu.GetReferenceBooks();
						int index = Array.IndexOf<ItemKey>(referenceBooks, itemKey);
						DomainManager.Taiwu.SetReferenceBook(context, (sbyte)index, ItemKey.Invalid);
					}
					break;
				}
				}
			}
		}

		// Token: 0x060071FC RID: 29180 RVA: 0x0041A020 File Offset: 0x00418220
		public void RandomChangeEquipmentDurability(DataContext context, Character character, sbyte itemType, bool isAdd, float percent)
		{
			List<ItemBase> items = new List<ItemBase>();
			if (isAdd)
			{
				foreach (ItemKey itemKey in character.GetEquipment())
				{
					bool flag = itemKey.Id < 0 || itemKey.ItemType != itemType;
					if (!flag)
					{
						WeaponItem itemConfig = Config.Weapon.Instance[itemKey.TemplateId];
						bool flag2 = !itemConfig.Transferable;
						if (!flag2)
						{
							ItemBase itemBase = DomainManager.Item.GetBaseItem(itemKey);
							bool flag3 = itemBase.GetMaxDurability() > itemBase.GetCurrDurability();
							if (flag3)
							{
								items.Add(itemBase);
							}
						}
					}
				}
				bool flag4 = items.Count == 0;
				if (!flag4)
				{
					ItemBase item = items[context.Random.Next(items.Count)];
					short curValue = (short)Math.Clamp((float)item.GetCurrDurability() * (1f + percent), 0f, (float)item.GetMaxDurability());
					item.SetCurrDurability(curValue, context);
				}
			}
			else
			{
				foreach (ItemKey itemKey2 in character.GetEquipment())
				{
					bool flag5 = itemKey2.Id < 0 || itemKey2.ItemType != itemType;
					if (!flag5)
					{
						WeaponItem itemConfig2 = Config.Weapon.Instance[itemKey2.TemplateId];
						bool flag6 = !itemConfig2.Transferable;
						if (!flag6)
						{
							ItemBase itemBase2 = DomainManager.Item.GetBaseItem(itemKey2);
							items.Add(itemBase2);
						}
					}
				}
				bool flag7 = items.Count == 0;
				if (!flag7)
				{
					ItemBase item2 = items[context.Random.Next(items.Count)];
					short curValue2 = (short)Math.Clamp((float)item2.GetCurrDurability() * (1f - percent), 0f, (float)item2.GetMaxDurability());
					bool flag8 = curValue2 == 0;
					if (flag8)
					{
						DomainManager.Taiwu.RemoveItem(context, item2.GetItemKey(), 1, 1, true, false);
					}
					else
					{
						item2.SetCurrDurability(curValue2, context);
					}
				}
			}
		}

		// Token: 0x060071FD RID: 29181 RVA: 0x0041A24C File Offset: 0x0041844C
		public void UpdateFixedCharacterEatingItems(DataContext context)
		{
			List<int> fixedCharList = ObjectPool<List<int>>.Instance.Get();
			fixedCharList.Clear();
			fixedCharList.AddRange(this._fixedCharactersCache.Values);
			foreach (int charId in fixedCharList)
			{
				Character character = this._objects[charId];
				short templateId = character.GetTemplateId();
				short num = templateId;
				short num2 = num;
				if (num2 == 810 || num2 == 812)
				{
					character.ClearEatingItems(context);
				}
			}
			ObjectPool<List<int>>.Instance.Return(fixedCharList);
		}

		// Token: 0x060071FE RID: 29182 RVA: 0x0041A308 File Offset: 0x00418508
		[Obsolete]
		public void ConfiscateItem(DataContext context, Character character, List<Character> targetChars, List<ItemKey> itemKeys)
		{
			Location location = character.GetLocation();
			bool flag = !location.IsValid();
			if (flag)
			{
				location = character.GetValidLocation();
			}
			List<MapBlockData> neighborBlockList = ObjectPool<List<MapBlockData>>.Instance.Get();
			DomainManager.Map.GetNeighborBlocks(location.AreaId, location.BlockId, neighborBlockList, 3);
			Inventory inventory = character.GetInventory();
			foreach (ItemKey itemKey in itemKeys)
			{
				bool flag2 = !itemKey.IsValid();
				if (!flag2)
				{
					int amount;
					bool flag3 = !inventory.Items.TryGetValue(itemKey, out amount);
					if (flag3)
					{
						int equipmentIndex = character.GetEquipment().IndexOf(itemKey);
						Tester.Assert(equipmentIndex >= 0, "");
						character.ChangeEquipment(context, (sbyte)equipmentIndex, -1, itemKey);
						amount = 1;
					}
					bool flag4 = targetChars.Count > 0;
					if (flag4)
					{
						Character targetChar = targetChars.GetRandom(context.Random);
						DomainManager.Character.TransferInventoryItem(context, character, targetChar, itemKey, amount);
					}
					else
					{
						MapBlockData block = neighborBlockList[context.Random.Next(neighborBlockList.Count)];
						character.RemoveInventoryItem(context, itemKey, 1, false, false);
						DomainManager.Map.AddBlockItem(context, block, itemKey, 1);
					}
				}
			}
		}

		// Token: 0x060071FF RID: 29183 RVA: 0x0041A474 File Offset: 0x00418674
		[Obsolete]
		public unsafe void ConfiscateResources(DataContext context, Character character, List<Character> targetChars, ResourceInts confiscateResources)
		{
			List<int> countList = ObjectPool<List<int>>.Instance.Get();
			for (sbyte type = 0; type < 8; type += 1)
			{
				int resourceCount = *(ref confiscateResources.Items.FixedElementField + (IntPtr)type * 4);
				bool flag = resourceCount == 0;
				if (!flag)
				{
					int average = resourceCount / targetChars.Count;
					int remainder = resourceCount % targetChars.Count;
					countList.Clear();
					for (int i = 0; i < targetChars.Count; i++)
					{
						countList.Add(average);
						bool flag2 = remainder > 0 && (remainder >= targetChars.Count - i || context.Random.CheckPercentProb(50));
						if (flag2)
						{
							List<int> list = countList;
							int index = i;
							int num = list[index];
							list[index] = num + 1;
							remainder--;
						}
					}
					character.ChangeResource(context, type, -resourceCount);
					for (int j = 0; j < targetChars.Count; j++)
					{
						targetChars[j].ChangeResource(context, type, countList[j]);
					}
				}
			}
			ObjectPool<List<int>>.Instance.Return(countList);
		}

		// Token: 0x06007200 RID: 29184 RVA: 0x0041A5A4 File Offset: 0x004187A4
		[DomainMethod]
		public unsafe static List<TemplateKeyAndCount> GetAllItemsByAreaId(short areaId)
		{
			Span<MapBlockData> blocks = DomainManager.Map.GetAreaBlocks(areaId);
			Dictionary<ValueTuple<sbyte, short>, int> itemCounts = new Dictionary<ValueTuple<sbyte, short>, int>();
			Span<MapBlockData> span = blocks;
			for (int i = 0; i < span.Length; i++)
			{
				MapBlockData block = *span[i];
				bool flag = block.CharacterSet == null;
				if (!flag)
				{
					foreach (int charId in block.CharacterSet)
					{
						Character character = DomainManager.Character.GetElement_Objects(charId);
						bool flag2 = character.GetOrganizationInfo().OrgTemplateId == 16 || character.IsActiveExternalRelationState(60);
						if (!flag2)
						{
							foreach (KeyValuePair<ItemKey, int> keyValuePair in character.GetInventory().Items)
							{
								ItemKey itemKey2;
								int num;
								keyValuePair.Deconstruct(out itemKey2, out num);
								ItemKey itemKey = itemKey2;
								int amount = num;
								ValueTuple<sbyte, short> templateKey = new ValueTuple<sbyte, short>(itemKey.ItemType, itemKey.TemplateId);
								bool flag3 = itemCounts.ContainsKey(templateKey);
								if (flag3)
								{
									Dictionary<ValueTuple<sbyte, short>, int> dictionary = itemCounts;
									ValueTuple<sbyte, short> key = templateKey;
									dictionary[key] += amount;
								}
								else
								{
									itemCounts.Add(templateKey, amount);
								}
							}
						}
					}
				}
			}
			List<TemplateKeyAndCount> templateKeyAndCounts = new List<TemplateKeyAndCount>();
			foreach (KeyValuePair<ValueTuple<sbyte, short>, int> itemCount in itemCounts)
			{
				bool flag4 = !ItemTemplateHelper.IsTransferable(itemCount.Key.Item1, itemCount.Key.Item2) || ItemTemplateHelper.GetBaseValue(itemCount.Key.Item1, itemCount.Key.Item2) == 0 || ItemTemplateHelper.GetIcon(itemCount.Key.Item1, itemCount.Key.Item2) == null || ItemTemplateHelper.IsSpecial(itemCount.Key.Item1, itemCount.Key.Item2);
				if (!flag4)
				{
					templateKeyAndCounts.Add(new TemplateKeyAndCount
					{
						TemplateKey = new TemplateKey(itemCount.Key.Item1, itemCount.Key.Item2),
						Count = itemCount.Value
					});
				}
			}
			return templateKeyAndCounts;
		}

		// Token: 0x06007201 RID: 29185 RVA: 0x0041A848 File Offset: 0x00418A48
		[return: TupleElementNames(new string[]
		{
			"positiveWorth",
			"negativeWorth"
		})]
		private unsafe static ValueTuple<long, long> GetResourcesWorth(ref ResourceInts values)
		{
			long positiveWorth = 0L;
			long negativeWorth = 0L;
			for (int i = 0; i < 8; i++)
			{
				long worth = (long)GlobalConfig.ResourcesWorth[i] * (long)(*(ref values.Items.FixedElementField + (IntPtr)i * 4));
				bool flag = worth >= 0L;
				if (flag)
				{
					positiveWorth += worth;
				}
				else
				{
					negativeWorth -= worth;
				}
			}
			return new ValueTuple<long, long>(positiveWorth, negativeWorth);
		}

		// Token: 0x06007202 RID: 29186 RVA: 0x0041A8B4 File Offset: 0x00418AB4
		private static void CreateItemDisplayData(int charId, ItemKey itemKey, int amount, List<ItemDisplayData> dataList, Dictionary<int, List<ItemDisplayData>> templateIdToDisplayListDict, ItemSourceType itemSourceType)
		{
			ItemBase item = DomainManager.Item.GetBaseItem(itemKey);
			bool isLoveToken = ModificationStateHelper.IsActive(item.GetModificationState(), 4);
			bool isExtraGoods = ModificationStateHelper.IsActive(item.GetModificationState(), 8);
			bool needCreate = true;
			int realKey = (int)((short)itemKey.ItemType * 10000 + itemKey.TemplateId);
			List<ItemDisplayData> displayList;
			bool flag = !templateIdToDisplayListDict.TryGetValue(realKey, out displayList);
			if (flag)
			{
				displayList = new List<ItemDisplayData>();
				templateIdToDisplayListDict.Add(realKey, displayList);
			}
			MerchantExtraGoodsData.ExtraGoodsType extraGoodsType = MerchantExtraGoodsData.ExtraGoodsType.None;
			bool flag2 = item.GetStackable() && !isLoveToken;
			if (flag2)
			{
				bool flag3 = isExtraGoods;
				if (flag3)
				{
					extraGoodsType = DomainManager.Extra.GetExtraGoodsType(itemKey);
					bool flag4 = extraGoodsType > MerchantExtraGoodsData.ExtraGoodsType.None;
					if (flag4)
					{
						ItemDisplayData display = displayList.Find((ItemDisplayData d) => d.Key.TemplateEquals(itemKey) && d.ExtraGoodsType == (sbyte)extraGoodsType);
						bool flag5 = display != null;
						if (flag5)
						{
							for (int i = 0; i < amount; i++)
							{
								display.ChangeAmount(itemKey, true);
							}
							needCreate = false;
						}
					}
				}
				else
				{
					bool poisonable = item.GetPoisonable();
					if (poisonable)
					{
						bool hasPoison = ModificationStateHelper.IsActive(item.GetModificationState(), 1);
						FullPoisonEffects poisonEffects = hasPoison ? DomainManager.Item.PoisonEffects[item.GetId()] : new FullPoisonEffects();
						bool isIdentified = poisonEffects.IsIdentified;
						ItemDisplayData display;
						if (isIdentified)
						{
							display = displayList.Find((ItemDisplayData d) => poisonEffects.SameOf(d.PoisonEffects) && d.ExtraGoodsTypeEnum == MerchantExtraGoodsType.None);
						}
						else
						{
							display = displayList.Find((ItemDisplayData d) => (d.PoisonEffects == null || !d.PoisonEffects.IsIdentified) && d.ExtraGoodsTypeEnum == MerchantExtraGoodsType.None);
						}
						bool flag6 = display != null;
						if (flag6)
						{
							for (int j = 0; j < amount; j++)
							{
								display.ChangeAmount(itemKey, true);
							}
							needCreate = false;
						}
					}
				}
			}
			bool flag7 = needCreate;
			if (flag7)
			{
				ItemDisplayData itemDisplayData = DomainManager.Item.GetItemDisplayData(item, amount, charId, (sbyte)itemSourceType);
				itemDisplayData.ExtraGoodsType = (sbyte)extraGoodsType;
				dataList.Add(itemDisplayData);
				displayList.Add(itemDisplayData);
			}
		}

		// Token: 0x06007203 RID: 29187 RVA: 0x0041AAFC File Offset: 0x00418CFC
		public static List<ItemDisplayData> GetItemDisplayData(int charId, [TupleElementNames(new string[]
		{
			"itemKey",
			"amount"
		})] List<ValueTuple<ItemKey, int>> items, ItemSourceType itemSourceType)
		{
			List<ItemDisplayData> dataList = new List<ItemDisplayData>();
			Dictionary<int, List<ItemDisplayData>> templateIdToDisplayListDict = new Dictionary<int, List<ItemDisplayData>>();
			int i = 0;
			int count = items.Count;
			while (i < count)
			{
				ValueTuple<ItemKey, int> valueTuple = items[i];
				ItemKey itemKey = valueTuple.Item1;
				int amount = valueTuple.Item2;
				CharacterDomain.CreateItemDisplayData(charId, itemKey, amount, dataList, templateIdToDisplayListDict, itemSourceType);
				i++;
			}
			return dataList;
		}

		// Token: 0x06007204 RID: 29188 RVA: 0x0041AB5C File Offset: 0x00418D5C
		public static List<ItemDisplayData> GetItemDisplayData(int charId, IReadOnlyDictionary<ItemKey, int> items, ItemSourceType itemSourceType)
		{
			List<ItemDisplayData> dataList = new List<ItemDisplayData>();
			Dictionary<int, List<ItemDisplayData>> templateIdToDisplayListDict = new Dictionary<int, List<ItemDisplayData>>();
			foreach (KeyValuePair<ItemKey, int> keyValuePair in items)
			{
				ItemKey itemKey2;
				int num;
				keyValuePair.Deconstruct(out itemKey2, out num);
				ItemKey itemKey = itemKey2;
				int amount = num;
				CharacterDomain.CreateItemDisplayData(charId, itemKey, amount, dataList, templateIdToDisplayListDict, itemSourceType);
			}
			return dataList;
		}

		// Token: 0x06007205 RID: 29189 RVA: 0x0041ABD8 File Offset: 0x00418DD8
		private static void RemoveTaiwuReadingBookFromClassifiedItems(List<ValueTuple<ItemBase, int>>[] classifiedItems)
		{
			List<ItemKey> cannotBeLost = new List<ItemKey>();
			cannotBeLost.AddRange(DomainManager.Taiwu.GetReferenceBooks());
			cannotBeLost.Add(DomainManager.Taiwu.GetCurReadingBook());
			for (int i = 0; i < cannotBeLost.Count; i++)
			{
				ItemKey itemKey = cannotBeLost[i];
				bool flag = itemKey.IsValid();
				if (flag)
				{
					ItemBase item = DomainManager.Item.GetBaseItem(itemKey);
					List<ValueTuple<ItemBase, int>> itemList = classifiedItems[(int)(item.GetGrade() / 3)];
					for (int j = itemList.Count - 1; j >= 0; j--)
					{
						bool flag2 = !itemList[j].Item1.GetItemKey().Equals(itemKey);
						if (!flag2)
						{
							itemList.RemoveAt(j);
							break;
						}
					}
				}
			}
		}

		// Token: 0x06007206 RID: 29190 RVA: 0x0041ACB4 File Offset: 0x00418EB4
		private unsafe void RemoveAllItemsBeforeRemovingCharacter(DataContext context, Character character)
		{
			ItemKey[] equipment = character.GetEquipment();
			for (int i = 0; i < 12; i++)
			{
				ItemKey itemKey = equipment[i];
				bool flag = itemKey.IsValid();
				if (flag)
				{
					DomainManager.Item.RemoveItem(context, itemKey);
				}
			}
			Inventory inventory = character.GetInventory();
			foreach (KeyValuePair<ItemKey, int> keyValuePair in inventory.Items)
			{
				ItemKey itemKey4;
				int num;
				keyValuePair.Deconstruct(out itemKey4, out num);
				ItemKey itemKey2 = itemKey4;
				bool flag2 = itemKey2.IsValid();
				if (flag2)
				{
					DomainManager.Item.RemoveItem(context, itemKey2);
				}
			}
			EatingItems eatingItems = *character.GetEatingItems();
			for (int j = 0; j < 9; j++)
			{
				ItemKey itemKey3 = (ItemKey)(*(ref eatingItems.ItemKeys.FixedElementField + (IntPtr)j * 8));
				bool flag3 = itemKey3.IsValid();
				if (flag3)
				{
					DomainManager.Item.RemoveItem(context, itemKey3);
				}
			}
		}

		// Token: 0x06007207 RID: 29191 RVA: 0x0041ADD8 File Offset: 0x00418FD8
		[Obsolete("This method is obsolete, and will removed in future, use GetItemPowerInfo instead.")]
		public ValueTuple<int, int> GetItemUsePowerInfo(DataContext context, int charId, ItemKey itemKey)
		{
			return new ValueTuple<int, int>(100, 100);
		}

		// Token: 0x06007208 RID: 29192 RVA: 0x0041ADE3 File Offset: 0x00418FE3
		[Obsolete("This method is obsolete, and will removed in future, use GetItemPower instead.")]
		public int GetItemUsePower(int charId, ItemKey itemKey)
		{
			return (int)this.GetItemPower(charId, itemKey);
		}

		// Token: 0x06007209 RID: 29193 RVA: 0x0041ADED File Offset: 0x00418FED
		[Obsolete("This method is obsolete, and will removed in future, use GetItemMaxPower instead.")]
		public int GetItemMaxUsePower(int charId, ItemKey itemKey)
		{
			return (int)this.GetItemMaxPower(charId, itemKey);
		}

		// Token: 0x0600720A RID: 29194 RVA: 0x0041ADF8 File Offset: 0x00418FF8
		public KidnappedCharacterList GetKidnappedCharacters(int charId)
		{
			return this._kidnappedChars[charId];
		}

		// Token: 0x0600720B RID: 29195 RVA: 0x0041AE18 File Offset: 0x00419018
		public bool TryGetKidnappedCharacters(int charId, out KidnappedCharacterList list)
		{
			return this._kidnappedChars.TryGetValue(charId, out list);
		}

		// Token: 0x0600720C RID: 29196 RVA: 0x0041AE38 File Offset: 0x00419038
		public void GetAllKidnappedCharacterIds(List<int> results)
		{
			foreach (KeyValuePair<int, KidnappedCharacterList> keyValuePair in this._kidnappedChars)
			{
				int num;
				KidnappedCharacterList kidnappedCharacterList;
				keyValuePair.Deconstruct(out num, out kidnappedCharacterList);
				KidnappedCharacterList kidnappedCharList = kidnappedCharacterList;
				List<KidnappedCharacter> collection = kidnappedCharList.GetCollection();
				foreach (KidnappedCharacter kidnappedChar in collection)
				{
					results.Add(kidnappedChar.CharId);
				}
			}
		}

		// Token: 0x0600720D RID: 29197 RVA: 0x0041AEF0 File Offset: 0x004190F0
		[DomainMethod]
		public void AddKidnappedCharacter(DataContext context, int charId, int kidnappedCharId, ItemKey ropeItemKey)
		{
			bool flag = kidnappedCharId == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				defaultInterpolatedStringHandler.AppendLiteral(" cannot kidnap taiwu ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(kidnappedCharId);
				defaultInterpolatedStringHandler.AppendLiteral(".");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			Character character = this.GetElement_Objects(charId);
			Character kidnappedChar = this.GetElement_Objects(kidnappedCharId);
			this.AddKidnappedCharacter(context, character, kidnappedChar, ropeItemKey);
		}

		// Token: 0x0600720E RID: 29198 RVA: 0x0041AF7C File Offset: 0x0041917C
		[DomainMethod]
		public void TransferKidnappedCharacters(DataContext context, int targetKidnapperId, int sourceKidnapperId, KidnappedCharacterList kidnappedCharsToTransfer)
		{
			List<KidnappedCharacter> kidnappedChars = kidnappedCharsToTransfer.GetCollection();
			bool flag = kidnappedChars.Count == 0;
			if (!flag)
			{
				KidnappedCharacterList targetKidnappedCharList;
				bool isKidnapper = this.TryGetElement_KidnappedChars(targetKidnapperId, out targetKidnappedCharList);
				if (targetKidnappedCharList == null)
				{
					targetKidnappedCharList = new KidnappedCharacterList();
				}
				KidnappedCharacterList sourceKidnappedCharList;
				bool flag2 = !this.TryGetElement_KidnappedChars(sourceKidnapperId, out sourceKidnappedCharList);
				if (flag2)
				{
					throw new Exception("The source kidnapper has not kidnapped anyone.");
				}
				for (int i = kidnappedChars.Count - 1; i >= 0; i--)
				{
					KidnappedCharacter kidnappedCharData = kidnappedChars[i];
					kidnappedCharData.OfflineChangeResistance((int)GlobalConfig.Instance.ResistChangeOnKidnapCharacterTransfer);
					Character kidnappedChar = this.GetElement_Objects(kidnappedCharData.CharId);
					this.TryCreateRelation(context, targetKidnapperId, kidnappedCharData.CharId);
					kidnappedChar.SetKidnapperId(targetKidnapperId, context);
					targetKidnappedCharList.Add(kidnappedCharData);
					sourceKidnappedCharList.Remove(kidnappedCharData.CharId);
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(57, 3);
					defaultInterpolatedStringHandler.AppendFormatted<Character>(kidnappedChar);
					defaultInterpolatedStringHandler.AppendLiteral(" is being transfered from one kidnapper to another: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(sourceKidnapperId);
					defaultInterpolatedStringHandler.AppendLiteral(" => ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(targetKidnapperId);
					defaultInterpolatedStringHandler.AppendLiteral(".");
					logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				Character sourceKidnapper = this.GetElement_Objects(sourceKidnapperId);
				Character targetKidnapper = this.GetElement_Objects(targetKidnapperId);
				bool flag3 = sourceKidnappedCharList.GetCount() == 0;
				if (flag3)
				{
					this.RemoveElement_KidnappedChars(sourceKidnapperId, context);
					sourceKidnapper.DeactivateExternalRelationState(context, 2);
				}
				else
				{
					this.SetElement_KidnappedChars(sourceKidnapperId, sourceKidnappedCharList, context);
				}
				bool flag4 = isKidnapper;
				if (flag4)
				{
					this.SetElement_KidnappedChars(targetKidnapperId, targetKidnappedCharList, context);
				}
				else
				{
					this.AddElement_KidnappedChars(targetKidnapperId, targetKidnappedCharList, context);
				}
				this.RemoveAllKidnappedChars(context, sourceKidnapper, false);
				targetKidnapper.ActiveExternalRelationState(context, 2);
				kidnappedCharsToTransfer.Clear();
			}
		}

		// Token: 0x0600720F RID: 29199 RVA: 0x0041B138 File Offset: 0x00419338
		[DomainMethod]
		public void ChangeKidnappedCharacterRope(DataContext context, int kidnapperId, int kidnappedCharId, ItemKey newRopeKey)
		{
			KidnappedCharacterList kidnappedChars;
			bool flag = !this.TryGetElement_KidnappedChars(kidnapperId, out kidnappedChars);
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler;
			if (flag)
			{
				defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(41, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(kidnappedCharId);
				defaultInterpolatedStringHandler.AppendLiteral(" is not kidnapped by character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(kidnapperId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			for (int i = 0; i < kidnappedChars.GetCount(); i++)
			{
				KidnappedCharacter kidnappedChar = kidnappedChars.Get(i);
				bool flag2 = kidnappedChar.CharId == kidnappedCharId;
				if (flag2)
				{
					DomainManager.Item.RemoveItem(context, kidnappedChar.RopeItemKey);
					kidnappedChar.RopeItemKey = newRopeKey;
					Character kidnapper = this.GetElement_Objects(kidnapperId);
					kidnapper.RemoveInventoryItem(context, newRopeKey, 1, false, false);
					DomainManager.Item.SetOwner(newRopeKey, ItemOwnerType.KidnapperRope, kidnappedCharId);
					this.SetElement_KidnappedChars(kidnapperId, kidnappedChars, context);
					return;
				}
			}
			defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(41, 2);
			defaultInterpolatedStringHandler.AppendLiteral("Character ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(kidnappedCharId);
			defaultInterpolatedStringHandler.AppendLiteral(" is not kidnapped by character ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(kidnapperId);
			throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x06007210 RID: 29200 RVA: 0x0041B260 File Offset: 0x00419460
		[DomainMethod]
		public int GetKidnapMaxSlotCount(int charId)
		{
			Character character = this.GetElement_Objects(charId);
			return character.GetKidnapMaxSlotCount();
		}

		// Token: 0x06007211 RID: 29201 RVA: 0x0041B280 File Offset: 0x00419480
		[DomainMethod]
		public unsafe void TransferKidnappedCharacter(DataContext context, int targetKidnapperId, int sourceKidnapperId, KidnappedCharacter kidnappedCharData)
		{
			KidnappedCharacterList targetKidnappedCharList;
			bool isKidnapper = this.TryGetElement_KidnappedChars(targetKidnapperId, out targetKidnappedCharList);
			KidnappedCharacterList sourceKidnappedCharList;
			bool flag = !this.TryGetElement_KidnappedChars(sourceKidnapperId, out sourceKidnappedCharList);
			if (flag)
			{
				throw new Exception("The source kidnapper has not kidnapped anyone.");
			}
			Character targetKidnapper = this.GetElement_Objects(targetKidnapperId);
			Character kidnappedChar = this.GetElement_Objects(kidnappedCharData.CharId);
			kidnappedCharData.ExtraResistance = *(ref kidnappedChar.GetPersonalities().Items.FixedElementField + 3);
			kidnappedCharData.KidnapBeginDate = DomainManager.World.GetCurrDate();
			kidnappedChar.SetKidnapperId(targetKidnapperId, context);
			if (targetKidnappedCharList == null)
			{
				targetKidnappedCharList = new KidnappedCharacterList();
			}
			targetKidnappedCharList.Add(kidnappedCharData);
			sourceKidnappedCharList.Remove(kidnappedCharData.CharId);
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(57, 3);
			defaultInterpolatedStringHandler.AppendFormatted<Character>(kidnappedChar);
			defaultInterpolatedStringHandler.AppendLiteral(" is being transfered from one kidnapper to another: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(sourceKidnapperId);
			defaultInterpolatedStringHandler.AppendLiteral(" => ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(targetKidnapperId);
			defaultInterpolatedStringHandler.AppendLiteral(".");
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
			bool flag2 = sourceKidnappedCharList.GetCount() == 0;
			if (flag2)
			{
				this.RemoveElement_KidnappedChars(sourceKidnapperId, context);
				Character sourceKidnapper;
				bool flag3 = DomainManager.Character.TryGetElement_Objects(sourceKidnapperId, out sourceKidnapper);
				if (flag3)
				{
					sourceKidnapper.DeactivateExternalRelationState(context, 2);
				}
			}
			else
			{
				this.SetElement_KidnappedChars(sourceKidnapperId, sourceKidnappedCharList, context);
			}
			bool flag4 = isKidnapper;
			if (flag4)
			{
				this.SetElement_KidnappedChars(targetKidnapperId, targetKidnappedCharList, context);
			}
			else
			{
				this.AddElement_KidnappedChars(targetKidnapperId, targetKidnappedCharList, context);
			}
			targetKidnapper.ActiveExternalRelationState(context, 2);
		}

		// Token: 0x06007212 RID: 29202 RVA: 0x0041B3F0 File Offset: 0x004195F0
		[DomainMethod]
		public void RemoveKidnappedCharacter(DataContext context, int kidnappedCharId, int kidnapperId, bool isEscaped)
		{
			Character kidnapper = this.GetElement_Objects(kidnapperId);
			KidnappedCharacterList kidnappedChars = this._kidnappedChars[kidnapperId];
			int slotIndex = kidnappedChars.IndexOf(kidnappedCharId);
			bool flag = slotIndex < 0;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(41, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(kidnappedCharId);
				defaultInterpolatedStringHandler.AppendLiteral(" is not kidnapped by character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(kidnapperId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			this.RemoveKidnappedCharacter(context, kidnapper, kidnappedChars, slotIndex, isEscaped);
		}

		// Token: 0x06007213 RID: 29203 RVA: 0x0041B474 File Offset: 0x00419674
		public unsafe void AddKidnappedCharacter(DataContext context, Character character, Character kidnappedChar, ItemKey ropeItemKey)
		{
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(16, 2);
			defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
			defaultInterpolatedStringHandler.AppendLiteral(" is kidnapping ");
			defaultInterpolatedStringHandler.AppendFormatted<Character>(kidnappedChar);
			defaultInterpolatedStringHandler.AppendLiteral(".");
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
			bool flag = kidnappedChar.GetCreatingType() == 2;
			if (flag)
			{
				this.ConvertRandomEnemy(context, kidnappedChar, character.GetLocation());
			}
			else
			{
				bool flag2 = this.IsTemporaryIntelligentCharacter(kidnappedChar.GetId());
				if (flag2)
				{
					this.ConvertTemporaryIntelligentCharacter(context, kidnappedChar);
				}
			}
			this.TryCreateGeneralRelation(context, character, kidnappedChar);
			this.TransferKidnappedCharsToGrandKidnapper(context, character, kidnappedChar);
			int charId = character.GetId();
			int kidnappedCharId = kidnappedChar.GetId();
			sbyte initialResistance = *(ref kidnappedChar.GetPersonalities().Items.FixedElementField + 3);
			bool flag3 = charId == kidnappedCharId;
			if (flag3)
			{
				defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(40, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				defaultInterpolatedStringHandler.AppendLiteral(" cannot kidnap him or herself.");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			bool flag4 = kidnappedChar.GetKidnapperId() >= 0;
			if (flag4)
			{
				defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(55, 3);
				defaultInterpolatedStringHandler.AppendLiteral("Character ");
				defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
				defaultInterpolatedStringHandler.AppendLiteral(" cannot kidnap ");
				defaultInterpolatedStringHandler.AppendFormatted<Character>(kidnappedChar);
				defaultInterpolatedStringHandler.AppendLiteral(" who is already kidnapped by ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(kidnappedChar.GetKidnapperId());
				defaultInterpolatedStringHandler.AppendLiteral(".");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			bool flag5 = kidnappedChar.GetLeaderId() >= 0;
			if (flag5)
			{
				this.LeaveGroup(context, kidnappedChar, false);
			}
			character.RemoveInventoryItem(context, ropeItemKey, 1, false, false);
			DomainManager.Item.SetOwner(ropeItemKey, ItemOwnerType.KidnapperRope, kidnappedCharId);
			KidnappedCharacterList kidnappedChars;
			bool flag6 = !this._kidnappedChars.TryGetValue(charId, out kidnappedChars);
			if (flag6)
			{
				kidnappedChars = new KidnappedCharacterList();
				kidnappedChars.Add(kidnappedCharId, initialResistance, ropeItemKey, DomainManager.World.GetCurrDate());
				this.AddElement_KidnappedChars(charId, kidnappedChars, context);
			}
			else
			{
				kidnappedChars.Add(kidnappedCharId, initialResistance, ropeItemKey, DomainManager.World.GetCurrDate());
				this.SetElement_KidnappedChars(charId, kidnappedChars, context);
			}
			Location srcLocation = kidnappedChar.GetLocation();
			Location destLocation = Location.Invalid;
			kidnappedChar.SetLocation(destLocation, context);
			bool flag7 = kidnappedChar.IsCompletelyInfected();
			if (flag7)
			{
				Events.RaiseInfectedCharacterLocationChanged(context, kidnappedCharId, srcLocation, destLocation);
			}
			else
			{
				Events.RaiseCharacterLocationChanged(context, kidnappedCharId, srcLocation, destLocation);
			}
			kidnappedChar.SetKidnapperId(charId, context);
			character.ActiveExternalRelationState(context, 2);
			Events.RaiseKidnappedStatusChanged(context, kidnappedChar, true);
		}

		// Token: 0x06007214 RID: 29204 RVA: 0x0041B6F8 File Offset: 0x004198F8
		public void RemoveKidnappedCharacter(DataContext context, Character character, KidnappedCharacterList kidnappedChars, int slotIndex, bool isEscaped)
		{
			int charId = character.GetId();
			KidnappedCharacter kidnappedCharData = kidnappedChars.Get(slotIndex);
			ItemKey ropeItemKey = kidnappedCharData.RopeItemKey;
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(46, 3);
			defaultInterpolatedStringHandler.AppendLiteral("Removing ");
			defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
			defaultInterpolatedStringHandler.AppendLiteral("'s kidnapped character: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(kidnappedCharData.CharId);
			defaultInterpolatedStringHandler.AppendLiteral(" (isEscape=");
			defaultInterpolatedStringHandler.AppendFormatted<bool>(isEscaped);
			defaultInterpolatedStringHandler.AppendLiteral(").");
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
			kidnappedChars.RemoveAt(slotIndex);
			bool flag = kidnappedChars.GetCount() <= 0;
			if (flag)
			{
				this.RemoveElement_KidnappedChars(charId, context);
				character.DeactivateExternalRelationState(context, 2);
			}
			else
			{
				this.SetElement_KidnappedChars(charId, kidnappedChars, context);
			}
			Character kidnappedChar;
			bool flag2 = this.TryGetElement_Objects(kidnappedCharData.CharId, out kidnappedChar);
			if (flag2)
			{
				Location srcLocation = kidnappedChar.GetLocation();
				Location destLocation = character.GetLocation();
				bool flag3 = !destLocation.IsValid();
				if (flag3)
				{
					destLocation = character.GetValidLocation();
				}
				kidnappedChar.SetLocation(destLocation, context);
				bool flag4 = kidnappedChar.IsCompletelyInfected();
				if (flag4)
				{
					Events.RaiseInfectedCharacterLocationChanged(context, kidnappedCharData.CharId, srcLocation, destLocation);
				}
				else
				{
					Events.RaiseCharacterLocationChanged(context, kidnappedCharData.CharId, srcLocation, destLocation);
				}
				kidnappedChar.SetKidnapperId(-1, context);
				Events.RaiseKidnappedStatusChanged(context, kidnappedChar, false);
			}
			bool flag5 = ropeItemKey.IsValid();
			if (flag5)
			{
				DomainManager.Item.RemoveOwner(ropeItemKey, ItemOwnerType.KidnapperRope, kidnappedCharData.CharId);
				if (isEscaped)
				{
					DomainManager.Item.RemoveItem(context, ropeItemKey);
				}
				else
				{
					character.AddInventoryItem(context, ropeItemKey, 1, false);
				}
			}
		}

		// Token: 0x06007215 RID: 29205 RVA: 0x0041B898 File Offset: 0x00419A98
		private unsafe void TransferKidnappedCharsToGrandKidnapper(DataContext context, Character targetKidnapper, Character sourceKidnapper)
		{
			int sourceKidnapperId = sourceKidnapper.GetId();
			int targetKidnapperId = targetKidnapper.GetId();
			KidnappedCharacterList sourceKidnappedCharList;
			bool flag = !this.TryGetElement_KidnappedChars(sourceKidnapperId, out sourceKidnappedCharList);
			if (!flag)
			{
				KidnappedCharacterList targetKidnappedCharList;
				bool isKidnapper = this.TryGetElement_KidnappedChars(targetKidnapperId, out targetKidnappedCharList);
				if (targetKidnappedCharList == null)
				{
					targetKidnappedCharList = new KidnappedCharacterList();
				}
				List<KidnappedCharacter> collection = sourceKidnappedCharList.GetCollection();
				for (int i = collection.Count - 1; i >= 0; i--)
				{
					KidnappedCharacter kidnappedCharData = collection[i];
					bool flag2 = context.Random.CheckProb(40, 100);
					if (!flag2)
					{
						Character kidnappedChar = this.GetElement_Objects(kidnappedCharData.CharId);
						kidnappedCharData.ExtraResistance = *(ref kidnappedChar.GetPersonalities().Items.FixedElementField + 3);
						kidnappedCharData.KidnapBeginDate = DomainManager.World.GetCurrDate();
						this.TryCreateRelation(context, targetKidnapperId, kidnappedCharData.CharId);
						kidnappedChar.SetKidnapperId(targetKidnapperId, context);
						targetKidnappedCharList.Add(kidnappedCharData);
						sourceKidnappedCharList.RemoveAt(i);
						Logger logger = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(57, 3);
						defaultInterpolatedStringHandler.AppendFormatted<Character>(kidnappedChar);
						defaultInterpolatedStringHandler.AppendLiteral(" is being transfered from one kidnapper to another: ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(sourceKidnapperId);
						defaultInterpolatedStringHandler.AppendLiteral(" => ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(targetKidnapperId);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
					}
				}
				bool flag3 = sourceKidnappedCharList.GetCount() == 0;
				if (flag3)
				{
					this.RemoveElement_KidnappedChars(sourceKidnapperId, context);
					sourceKidnapper.DeactivateExternalRelationState(context, 2);
				}
				else
				{
					this.SetElement_KidnappedChars(sourceKidnapperId, sourceKidnappedCharList, context);
				}
				bool flag4 = isKidnapper;
				if (flag4)
				{
					this.SetElement_KidnappedChars(targetKidnapperId, targetKidnappedCharList, context);
				}
				else
				{
					this.AddElement_KidnappedChars(targetKidnapperId, targetKidnappedCharList, context);
				}
				this.RemoveAllKidnappedChars(context, sourceKidnapper, true);
				targetKidnapper.ActiveExternalRelationState(context, 2);
			}
		}

		// Token: 0x06007216 RID: 29206 RVA: 0x0041BA64 File Offset: 0x00419C64
		public void TransferKidnappedCharactersToTaiwuSuccessor(DataContext context, Character targetKidnapper, Character sourceKidnapper)
		{
			int sourceKidnapperId = sourceKidnapper.GetId();
			int targetKidnapperId = targetKidnapper.GetId();
			KidnappedCharacterList sourceKidnappedCharList;
			bool flag = !this.TryGetElement_KidnappedChars(sourceKidnapperId, out sourceKidnappedCharList);
			if (!flag)
			{
				KidnappedCharacterList targetKidnappedCharList;
				bool isKidnapper = this.TryGetElement_KidnappedChars(targetKidnapperId, out targetKidnappedCharList);
				if (targetKidnappedCharList == null)
				{
					targetKidnappedCharList = new KidnappedCharacterList();
				}
				List<KidnappedCharacter> collection = sourceKidnappedCharList.GetCollection();
				for (int i = collection.Count - 1; i >= 0; i--)
				{
					KidnappedCharacter kidnappedCharData = collection[i];
					kidnappedCharData.OfflineChangeResistance((int)GlobalConfig.Instance.ResistChangeOnKidnapCharacterTransfer);
					Character kidnappedChar = this.GetElement_Objects(kidnappedCharData.CharId);
					this.TryCreateRelation(context, targetKidnapperId, kidnappedCharData.CharId);
					kidnappedChar.SetKidnapperId(targetKidnapperId, context);
					targetKidnappedCharList.Add(kidnappedCharData);
					sourceKidnappedCharList.RemoveAt(i);
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(57, 3);
					defaultInterpolatedStringHandler.AppendFormatted<Character>(kidnappedChar);
					defaultInterpolatedStringHandler.AppendLiteral(" is being transfered from one kidnapper to another: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(sourceKidnapperId);
					defaultInterpolatedStringHandler.AppendLiteral(" => ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(targetKidnapperId);
					defaultInterpolatedStringHandler.AppendLiteral(".");
					logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				bool flag2 = sourceKidnappedCharList.GetCount() == 0;
				if (flag2)
				{
					this.RemoveElement_KidnappedChars(sourceKidnapperId, context);
					sourceKidnapper.DeactivateExternalRelationState(context, 2);
				}
				else
				{
					this.SetElement_KidnappedChars(sourceKidnapperId, sourceKidnappedCharList, context);
				}
				bool flag3 = isKidnapper;
				if (flag3)
				{
					this.SetElement_KidnappedChars(targetKidnapperId, targetKidnappedCharList, context);
				}
				else
				{
					this.AddElement_KidnappedChars(targetKidnapperId, targetKidnappedCharList, context);
				}
				this.RemoveAllKidnappedChars(context, sourceKidnapper, true);
				targetKidnapper.ActiveExternalRelationState(context, 2);
			}
		}

		// Token: 0x06007217 RID: 29207 RVA: 0x0041BBF8 File Offset: 0x00419DF8
		public void UpdateKidnappedCharacters(DataContext context)
		{
			int currDate = DomainManager.World.GetCurrDate();
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			List<int> modifiedKidnappers = ObjectPool<List<int>>.Instance.Get();
			List<int> removedKidnappers = ObjectPool<List<int>>.Instance.Get();
			List<MapBlockData> neighborBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
			modifiedKidnappers.Clear();
			removedKidnappers.Clear();
			foreach (KeyValuePair<int, KidnappedCharacterList> keyValuePair in this._kidnappedChars)
			{
				int num;
				KidnappedCharacterList kidnappedCharacterList;
				keyValuePair.Deconstruct(out num, out kidnappedCharacterList);
				int kidnapperId = num;
				KidnappedCharacterList kidnappedChars = kidnappedCharacterList;
				List<KidnappedCharacter> kidnappedCharList = kidnappedChars.GetCollection();
				Character kidnapperChar = this.GetElement_Objects(kidnapperId);
				Location srcLocation = kidnapperChar.GetLocation();
				bool flag = !srcLocation.IsValid();
				if (flag)
				{
					srcLocation = kidnapperChar.GetValidLocation();
				}
				bool kidnapperIsTaiwuPeople = this.IsTaiwuPeople(kidnapperId);
				int kidnappedCharCount = kidnappedCharList.Count;
				DomainManager.Map.GetRealNeighborBlocks(srcLocation.AreaId, srcLocation.BlockId, neighborBlocks, 3, false);
				for (int i = kidnappedCharList.Count - 1; i >= 0; i--)
				{
					KidnappedCharacter kidnappedCharInfo = kidnappedCharList[i];
					Character kidnappedChar = this.GetElement_Objects(kidnappedCharInfo.CharId);
					bool kidnappedCharIsTaiwuPeople = this.IsTaiwuPeople(kidnappedCharInfo.CharId);
					this.ChangeFavorabilityOptionalMonthlyEvolution(context, kidnappedChar, kidnapperChar, -3000);
					RelatedCharacter relation = this.GetRelation(kidnappedCharInfo.CharId, kidnapperId);
					sbyte favorType = FavorabilityType.GetFavorabilityType(relation.Favorability);
					bool flag2 = favorType <= -2 && !RelationType.HasRelation(relation.RelationType, 32768);
					if (flag2)
					{
						bool flag3 = kidnapperId == DomainManager.Taiwu.GetTaiwuCharId();
						if (flag3)
						{
							monthlyEventCollection.AddCaptiveBecomeEnemy(kidnappedCharInfo.CharId, srcLocation, kidnapperId);
						}
						Character.ApplyAddRelation_Enemy(context, kidnappedChar, kidnapperChar, kidnapperIsTaiwuPeople, 1);
					}
					bool flag4 = CharacterDomain.IsLockMovementChar(kidnappedCharInfo.CharId);
					if (!flag4)
					{
						int exceedingAmount = Math.Max(0, kidnappedCharCount - kidnapperChar.GetKidnapMaxSlotCount());
						int totalResistance = this.CalcKidnappedCharacterTotalResistance(kidnapperChar, kidnappedCharInfo);
						int escapeRate = kidnappedCharInfo.CalcEscapeRate(totalResistance, exceedingAmount);
						bool isEscaped = context.Random.CheckPercentProb(escapeRate);
						bool flag5 = !isEscaped;
						if (!flag5)
						{
							ItemKey ropeItemKey = kidnappedCharInfo.RopeItemKey;
							kidnappedChars.RemoveAt(i);
							MapBlockData destBlock = neighborBlocks.GetRandom(context.Random);
							Location destLocation = new Location(destBlock.AreaId, destBlock.BlockId);
							bool flag6 = kidnappedChar.IsCompletelyInfected();
							if (flag6)
							{
								Events.RaiseInfectedCharacterLocationChanged(context, kidnappedCharInfo.CharId, kidnappedChar.GetLocation(), destLocation);
							}
							else
							{
								Events.RaiseCharacterLocationChanged(context, kidnappedCharInfo.CharId, kidnappedChar.GetLocation(), destLocation);
							}
							kidnappedChar.SetLocation(destLocation, context);
							kidnappedChar.SetKidnapperId(-1, context);
							Events.RaiseKidnappedStatusChanged(context, kidnappedChar, false);
							bool flag7 = ropeItemKey.IsValid();
							if (flag7)
							{
								DomainManager.Item.RemoveItem(context, ropeItemKey);
							}
							GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(21, kidnapperId);
							kidnappedChar.AddPersonalNeed(context, need);
							lifeRecordCollection.AddKidnappedCharacterEscaped(kidnappedCharInfo.CharId, currDate, kidnapperId, srcLocation);
							SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
							int secretInfoOffset = secretInformationCollection.AddKidnappedCharacterEscaped(kidnappedCharInfo.CharId, kidnapperId);
							int metaDataId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
							bool flag8 = kidnapperId == DomainManager.Taiwu.GetTaiwuCharId();
							if (flag8)
							{
								monthlyEventCollection.AddEscapeFromPrison(kidnappedCharInfo.CharId, srcLocation, kidnapperId);
							}
							bool flag9 = kidnappedCharIsTaiwuPeople || kidnapperIsTaiwuPeople;
							if (flag9)
							{
								monthlyNotificationCollection.AddEscapeFromPrison(kidnappedCharInfo.CharId, srcLocation, kidnapperId);
								DomainManager.Information.ReceiveSecretInformation(context, metaDataId, DomainManager.Taiwu.GetTaiwuCharId(), kidnappedCharIsTaiwuPeople ? kidnappedCharInfo.CharId : kidnapperId);
							}
							Logger logger = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 2);
							defaultInterpolatedStringHandler.AppendFormatted<Character>(kidnapperChar);
							defaultInterpolatedStringHandler.AppendLiteral("'s kidnapped character escaped: ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(kidnappedChar);
							defaultInterpolatedStringHandler.AppendLiteral(".");
							logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
						}
					}
				}
				bool flag10 = kidnappedChars.GetCount() <= 0;
				if (flag10)
				{
					kidnappedChars.Clear();
					removedKidnappers.Add(kidnapperId);
					kidnapperChar.DeactivateExternalRelationState(context, 2);
				}
				else
				{
					modifiedKidnappers.Add(kidnapperId);
				}
			}
			foreach (int removedKidnapper in removedKidnappers)
			{
				this.RemoveElement_KidnappedChars(removedKidnapper, context);
			}
			foreach (int modifiedKidnapper in modifiedKidnappers)
			{
				this.SetElement_KidnappedChars(modifiedKidnapper, this._kidnappedChars[modifiedKidnapper], context);
			}
			ObjectPool<List<int>>.Instance.Return(modifiedKidnappers);
			ObjectPool<List<int>>.Instance.Return(removedKidnappers);
			ObjectPool<List<MapBlockData>>.Instance.Return(neighborBlocks);
		}

		// Token: 0x06007218 RID: 29208 RVA: 0x0041C140 File Offset: 0x0041A340
		private int CalcKidnappedCharacterBaseResistance(Character kidnapper, KidnappedCharacter kidnappedChar)
		{
			Character kidnapped = DomainManager.Character.GetElement_Objects(kidnappedChar.CharId);
			int behaviorFactor = (int)(kidnapped.GetBehaviorType() + 1);
			int baseValue = behaviorFactor * 10;
			int levelEffect = (int)(GlobalConfig.Instance.MaxConsummateLevel + kidnapped.GetConsummateLevel() - kidnapper.GetConsummateLevel());
			short favor = DomainManager.Character.GetFavorability(kidnapped.GetId(), kidnapper.GetId());
			int favorEffect = (int)(-favor / 500);
			return baseValue + levelEffect + favorEffect;
		}

		// Token: 0x06007219 RID: 29209 RVA: 0x0041C1BC File Offset: 0x0041A3BC
		public int CalcKidnappedCharacterTotalResistance(Character kidnapper, KidnappedCharacter kidnappedChar)
		{
			int value = this.CalcKidnappedCharacterBaseResistance(kidnapper, kidnappedChar);
			return value + (int)kidnappedChar.ExtraResistance;
		}

		// Token: 0x0600721A RID: 29210 RVA: 0x0041C1E4 File Offset: 0x0041A3E4
		public void RemoveAllKidnappedChars(DataContext context, Character character, bool isEscaped)
		{
			int charId = character.GetId();
			KidnappedCharacterList kidnappedChars;
			bool flag = !this._kidnappedChars.TryGetValue(charId, out kidnappedChars);
			if (!flag)
			{
				Location destLocation = character.GetLocation();
				List<KidnappedCharacter> collection = kidnappedChars.GetCollection();
				for (int i = 0; i < collection.Count; i++)
				{
					KidnappedCharacter kidnappedCharData = collection[i];
					int kidnappedCharId = kidnappedCharData.CharId;
					ItemKey ropeItemKey = kidnappedCharData.RopeItemKey;
					Character kidnappedChar;
					bool flag2 = kidnappedCharId >= 0 && this.TryGetElement_Objects(kidnappedCharId, out kidnappedChar);
					if (flag2)
					{
						Location srcLocation = kidnappedChar.GetLocation();
						kidnappedChar.SetLocation(destLocation, context);
						bool flag3 = kidnappedChar.IsCompletelyInfected();
						if (flag3)
						{
							Events.RaiseInfectedCharacterLocationChanged(context, kidnappedCharId, srcLocation, destLocation);
						}
						else
						{
							Events.RaiseCharacterLocationChanged(context, kidnappedCharId, srcLocation, destLocation);
						}
						kidnappedChar.SetKidnapperId(-1, context);
					}
					bool flag4 = ropeItemKey.IsValid();
					if (flag4)
					{
						DomainManager.Item.RemoveOwner(ropeItemKey, ItemOwnerType.KidnapperRope, kidnappedCharId);
						if (isEscaped)
						{
							DomainManager.Item.RemoveItem(context, ropeItemKey);
						}
						else
						{
							character.AddInventoryItem(context, ropeItemKey, 1, false);
						}
					}
				}
				kidnappedChars.Clear();
				this.RemoveElement_KidnappedChars(charId, context);
				character.DeactivateExternalRelationState(context, 2);
			}
		}

		// Token: 0x0600721B RID: 29211 RVA: 0x0041C31C File Offset: 0x0041A51C
		public void SyncLifeSkillReadingStateToCharacter(DataContext context, Character sourceCharacter, Character targetCharacter, sbyte lifeSkillType)
		{
			List<LifeSkillItem> targetNewLearnedLifeSkills = new List<LifeSkillItem>();
			foreach (LifeSkillItem lifeSkillItem in targetCharacter.GetLearnedLifeSkills())
			{
				bool flag = LifeSkill.Instance[lifeSkillItem.SkillTemplateId].Type != lifeSkillType;
				if (flag)
				{
					targetNewLearnedLifeSkills.Add(lifeSkillItem);
				}
			}
			foreach (LifeSkillItem lifeSkillItem2 in sourceCharacter.GetLearnedLifeSkills())
			{
				bool flag2 = LifeSkill.Instance[lifeSkillItem2.SkillTemplateId].Type == lifeSkillType;
				if (flag2)
				{
					targetNewLearnedLifeSkills.Add(lifeSkillItem2);
				}
			}
			targetCharacter.SetLearnedLifeSkills(targetNewLearnedLifeSkills, context);
		}

		// Token: 0x0600721C RID: 29212 RVA: 0x0041C410 File Offset: 0x0041A610
		public void ResetLuckEventPrediction()
		{
			this._predictedLuckEvent = new ValueTuple<int, bool, bool>(-1, false, false);
		}

		// Token: 0x0600721D RID: 29213 RVA: 0x0041C421 File Offset: 0x0041A621
		public void AddLuckEventPrediction(int charId, bool isPositive, bool isAvoided)
		{
			this._predictedLuckEvent = new ValueTuple<int, bool, bool>(charId, isPositive, isAvoided);
		}

		// Token: 0x0600721E RID: 29214 RVA: 0x0041C434 File Offset: 0x0041A634
		public unsafe void UpdateLuckEvents(DataContext context)
		{
			long[] charLucks = new long[this._objects.Count];
			int length = 0;
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int id = num;
				Character character = character2;
				bool flag = character.GetCreatingType() != 1;
				if (!flag)
				{
					bool flag2 = this.IsTemporaryIntelligentCharacter(id);
					if (!flag2)
					{
						charLucks[length] = ((long)(*(ref character.GetPersonalities().Items.FixedElementField + 5)) << 32) + (long)id;
						length++;
					}
				}
			}
			bool flag3 = length == 0;
			if (!flag3)
			{
				List<int> luckyChars = new List<int>(100);
				List<int> unluckyChars = new List<int>(100);
				long[] array;
				long* pList;
				if ((array = charLucks) == null || array.Length == 0)
				{
					pList = null;
				}
				else
				{
					pList = &array[0];
				}
				CollectionUtils.Sort(pList, length);
				int i = 0;
				while (i < length && i < 100)
				{
					int unluckyCharId = (int)(pList[i] & (long)((ulong)-1));
					bool flag4 = unluckyCharId != this._predictedLuckEvent.Item1;
					if (flag4)
					{
						unluckyChars.Add(unluckyCharId);
					}
					int luckyCharId = (int)(pList[length - 1 - i] & (long)((ulong)-1));
					bool flag5 = luckyCharId != this._predictedLuckEvent.Item1;
					if (flag5)
					{
						luckyChars.Add(luckyCharId);
					}
					i++;
				}
				Character targetChar;
				bool flag6 = this._predictedLuckEvent.Item1 >= 0 && !this._predictedLuckEvent.Item3 && DomainManager.Character.TryGetElement_Objects(this._predictedLuckEvent.Item1, out targetChar);
				if (flag6)
				{
					this.ApplyLuckEventToCharacter(context, targetChar, this._predictedLuckEvent.Item2);
				}
				this.ResetLuckEventPrediction();
				this.ApplyLucky_Resource(context, luckyChars, 5, 15);
				this.ApplyLucky_Item(context, luckyChars, 3, 2, 10);
				this.ApplyLucky_Item(context, luckyChars, 3, 0, 5);
				this.ApplyLucky_Item(context, luckyChars, 3, 1, 5);
				this.ApplyLucky_CombatSkillBook(context, luckyChars, 3, 3);
				this.ApplyLucky_LifeSkillBook(context, luckyChars, 3, 5);
				this.ApplyLucky_Regen(context, luckyChars, 5, 8);
				this.ApplyUnlucky_Resource(context, unluckyChars, 5, 15);
				this.ApplyUnlucky_Item(context, unluckyChars, 3, 2, 10);
				this.ApplyUnlucky_Item(context, unluckyChars, 3, 0, 5);
				this.ApplyUnlucky_Item(context, unluckyChars, 3, 1, 5);
				this.ApplyUnlucky_CombatSkillBook(context, unluckyChars, 3, 3);
				this.ApplyUnlucky_LifeSkillBook(context, unluckyChars, 3, 5);
				this.ApplyUnlucky_Harm(context, unluckyChars, 5, 8);
				array = null;
			}
		}

		// Token: 0x0600721F RID: 29215 RVA: 0x0041C6C8 File Offset: 0x0041A8C8
		public unsafe void ApplyLuckEventToCharacter(DataContext context, Character character, bool isPositive)
		{
			List<int> targets = new List<int>(1)
			{
				character.GetId()
			};
			Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)7], 7);
			Span<sbyte> order = span;
			sbyte i = 0;
			while ((int)i < order.Length)
			{
				*order[(int)i] = i;
				i += 1;
			}
			CollectionUtils.Shuffle<sbyte>(context.Random, order, order.Length);
			Span<sbyte> span2 = order;
			for (int j = 0; j < span2.Length; j++)
			{
				sbyte eventType = *span2[j];
				if (isPositive)
				{
					if (!true)
					{
					}
					int num;
					switch (eventType)
					{
					case 0:
						num = this.ApplyLucky_Resource(context, targets, 1, 100);
						break;
					case 1:
						num = this.ApplyLucky_Item(context, targets, 1, 2, 100);
						break;
					case 2:
						num = this.ApplyLucky_Item(context, targets, 1, 0, 100);
						break;
					case 3:
						num = this.ApplyLucky_Item(context, targets, 1, 1, 100);
						break;
					case 4:
						num = this.ApplyLucky_CombatSkillBook(context, targets, 1, 100);
						break;
					case 5:
						num = this.ApplyLucky_LifeSkillBook(context, targets, 1, 100);
						break;
					case 6:
						num = this.ApplyLucky_Regen(context, targets, 1, 100);
						break;
					default:
						num = 0;
						break;
					}
					if (!true)
					{
					}
					int amount = num;
					bool flag = amount > 0;
					if (flag)
					{
						break;
					}
				}
				else
				{
					if (!true)
					{
					}
					int num;
					switch (eventType)
					{
					case 0:
						num = this.ApplyUnlucky_Resource(context, targets, 1, 100);
						break;
					case 1:
						num = this.ApplyUnlucky_Item(context, targets, 1, 2, 100);
						break;
					case 2:
						num = this.ApplyUnlucky_Item(context, targets, 1, 0, 100);
						break;
					case 3:
						num = this.ApplyUnlucky_Item(context, targets, 1, 1, 100);
						break;
					case 4:
						num = this.ApplyUnlucky_CombatSkillBook(context, targets, 1, 100);
						break;
					case 5:
						num = this.ApplyUnlucky_LifeSkillBook(context, targets, 1, 100);
						break;
					case 6:
						num = this.ApplyUnlucky_Harm(context, targets, 1, 100);
						break;
					default:
						num = 0;
						break;
					}
					if (!true)
					{
					}
					int amount2 = num;
					bool flag2 = amount2 > 0;
					if (flag2)
					{
						break;
					}
				}
			}
		}

		// Token: 0x06007220 RID: 29216 RVA: 0x0041C8D0 File Offset: 0x0041AAD0
		private unsafe int ApplyLucky_Resource(DataContext context, List<int> luckyChars, int amountOfChars, sbyte chance)
		{
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int currDate = DomainManager.World.GetCurrDate();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int luckyAmount = 0;
			Span<int> span = new Span<int>(stackalloc byte[checked(unchecked((UIntPtr)amountOfChars) * 4)], amountOfChars);
			Span<int> selectedIndices = span;
			RandomUtils.GetRandomUnrepeated(context.Random, 0, luckyChars.Count - 1, selectedIndices);
			for (int i = 0; i < amountOfChars; i++)
			{
				bool flag = !context.Random.CheckPercentProb((int)chance);
				if (!flag)
				{
					int charId = luckyChars[*selectedIndices[i]];
					int worth = context.Random.Next(12000, 24001);
					sbyte resourceType = (sbyte)context.Random.Next(7);
					int resourceAmount = worth / (int)GlobalConfig.ResourcesWorth[(int)resourceType];
					Character luckyChar = this._objects[charId];
					Location location = luckyChar.GetLocation();
					GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(9, 6);
					luckyChar.AddPersonalNeed(context, personalNeed);
					luckyChar.ChangeResource(context, resourceType, resourceAmount);
					luckyChar.ChangeHappiness(context, worth / 1000);
					lifeRecordCollection.AddUnexpectedResourceGain(charId, currDate, location, resourceType, resourceAmount);
					monthlyNotificationCollection.AddUnexpectedlyGetResource(charId, location, resourceAmount, resourceType);
					int secretInfoOffset = secretInformationCollection.AddUnexpectedResourceGain(charId, resourceType, location);
					int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
					luckyAmount++;
				}
			}
			return luckyAmount;
		}

		// Token: 0x06007221 RID: 29217 RVA: 0x0041CA68 File Offset: 0x0041AC68
		private unsafe int ApplyUnlucky_Resource(DataContext context, List<int> unluckyChars, int amountOfChars, sbyte chance)
		{
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int currDate = DomainManager.World.GetCurrDate();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int unluckyAmount = 0;
			Span<int> span = new Span<int>(stackalloc byte[checked(unchecked((UIntPtr)amountOfChars) * 4)], amountOfChars);
			Span<int> selectedIndices = span;
			RandomUtils.GetRandomUnrepeated(context.Random, 0, unluckyChars.Count - 1, selectedIndices);
			for (int i = 0; i < amountOfChars; i++)
			{
				bool flag = !context.Random.CheckPercentProb((int)chance);
				if (!flag)
				{
					int charId = unluckyChars[*selectedIndices[i]];
					int worth = context.Random.Next(12000, 24001);
					Character unluckyChar = this._objects[charId];
					ResourceInts resources = *unluckyChar.GetResources();
					sbyte resourceType = this.SelectRandomResourceTypeToLose(context.Random, ref resources);
					bool flag2 = resourceType < 0;
					if (!flag2)
					{
						int resourceAmount = Math.Min(worth / (int)GlobalConfig.ResourcesWorth[(int)resourceType], *(ref resources.Items.FixedElementField + (IntPtr)resourceType * 4));
						Location location = unluckyChar.GetLocation();
						GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(8, 6, worth / (int)GlobalConfig.ResourcesWorth[6]);
						unluckyChar.AddPersonalNeed(context, personalNeed);
						unluckyChar.ChangeResource(context, resourceType, -resourceAmount);
						unluckyChar.ChangeHappiness(context, -worth / 1000);
						lifeRecordCollection.AddUnexpectedResourceLose(charId, currDate, location, resourceType, resourceAmount);
						monthlyNotificationCollection.AddUnexpectedlyLoseResource(charId, location, resourceAmount, resourceType);
						int secretInfoOffset = secretInformationCollection.AddUnexpectedResourceLose(charId, resourceType, location);
						int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
						unluckyAmount++;
					}
				}
			}
			return unluckyAmount;
		}

		// Token: 0x06007222 RID: 29218 RVA: 0x0041CC44 File Offset: 0x0041AE44
		private unsafe int ApplyLucky_Item(DataContext context, List<int> luckyChars, int amountOfChars, short itemType, sbyte chance)
		{
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int currDate = DomainManager.World.GetCurrDate();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int luckyAmount = 0;
			Span<int> span = new Span<int>(stackalloc byte[checked(unchecked((UIntPtr)amountOfChars) * 4)], amountOfChars);
			Span<int> selectedIndices = span;
			RandomUtils.GetRandomUnrepeated(context.Random, 0, luckyChars.Count - 1, selectedIndices);
			for (int i = 0; i < amountOfChars; i++)
			{
				bool flag = !context.Random.CheckPercentProb((int)chance);
				if (!flag)
				{
					int charId = luckyChars[*selectedIndices[i]];
					short itemSubType = ItemSubType.Type2SubTypes[(int)itemType].GetRandom(context.Random);
					bool flag2 = !ItemSubType.IsHobbyType(itemSubType);
					if (!flag2)
					{
						sbyte grade = context.Random.CheckProb((int)chance, 1000) ? 7 : 6;
						short itemTemplateId = ItemDomain.GetRandomItemIdInSubType(context.Random, itemSubType, grade);
						ItemKey itemKey = DomainManager.Item.CreateItem(context, ItemSubType.GetType(itemSubType), itemTemplateId);
						int worth = ItemTemplateHelper.GetBaseValue(itemKey.ItemType, itemKey.TemplateId);
						Character luckyChar = this._objects[charId];
						Location location = luckyChar.GetLocation();
						GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(9, 6);
						luckyChar.AddPersonalNeed(context, personalNeed);
						luckyChar.AddInventoryItem(context, itemKey, 1, false);
						luckyChar.ChangeHappiness(context, worth / 1000);
						lifeRecordCollection.AddUnexpectedItemGain(charId, currDate, location, itemKey.ItemType, itemKey.TemplateId);
						monthlyNotificationCollection.AddUnexpectedlyGetRareItem(charId, location, itemKey.ItemType, itemKey.TemplateId);
						int secretInfoOffset = secretInformationCollection.AddUnexpectedItemGain(charId, (ulong)itemKey, location);
						int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
						luckyAmount++;
					}
				}
			}
			return luckyAmount;
		}

		// Token: 0x06007223 RID: 29219 RVA: 0x0041CE44 File Offset: 0x0041B044
		private unsafe int ApplyUnlucky_Item(DataContext context, List<int> unluckyChars, int amountOfChars, sbyte itemType, sbyte chance)
		{
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int currDate = DomainManager.World.GetCurrDate();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int unluckyAmount = 0;
			Span<int> span = new Span<int>(stackalloc byte[checked(unchecked((UIntPtr)amountOfChars) * 4)], amountOfChars);
			Span<int> selectedIndices = span;
			RandomUtils.GetRandomUnrepeated(context.Random, 0, unluckyChars.Count - 1, selectedIndices);
			for (int i = 0; i < amountOfChars; i++)
			{
				bool flag = !context.Random.CheckPercentProb((int)chance);
				if (!flag)
				{
					int charId = unluckyChars[*selectedIndices[i]];
					Character unluckyChar = this._objects[charId];
					ItemKey itemKey = this.SelectItemFromItemTypeToLose(context.Random, unluckyChar, itemType);
					bool flag2 = !itemKey.IsValid();
					if (!flag2)
					{
						int worth = ItemTemplateHelper.GetBaseValue(itemKey.ItemType, itemKey.TemplateId);
						Location location = unluckyChar.GetLocation();
						GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(8, 6, worth / (int)GlobalConfig.ResourcesWorth[6]);
						unluckyChar.AddPersonalNeed(context, personalNeed);
						bool flag3 = !unluckyChar.GetInventory().Items.ContainsKey(itemKey);
						if (flag3)
						{
							ItemKey[] equipments = unluckyChar.GetEquipment();
							for (int slot = 0; slot < equipments.Length; slot++)
							{
								bool flag4 = !itemKey.Equals(equipments[slot]);
								if (!flag4)
								{
									equipments[slot] = ItemKey.Invalid;
									unluckyChar.SetEquipment(equipments, context);
									DomainManager.Item.RemoveItem(context, itemKey);
									break;
								}
							}
						}
						else
						{
							unluckyChar.RemoveInventoryItem(context, itemKey, 1, true, false);
						}
						unluckyChar.ChangeHappiness(context, -worth / 1000);
						lifeRecordCollection.AddUnexpectedItemLose(charId, currDate, location, itemKey.ItemType, itemKey.TemplateId);
						monthlyNotificationCollection.AddUnexpectedlyLoseRareItem(charId, location, itemKey.ItemType, itemKey.TemplateId);
						int secretInfoOffset = secretInformationCollection.AddUnexpectedItemLose(charId, (ulong)itemKey, location);
						int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
						unluckyAmount++;
					}
				}
			}
			return unluckyAmount;
		}

		// Token: 0x06007224 RID: 29220 RVA: 0x0041D090 File Offset: 0x0041B290
		private unsafe int ApplyLucky_LifeSkillBook(DataContext context, List<int> luckyChars, int amountOfChars, sbyte chance)
		{
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int currDate = DomainManager.World.GetCurrDate();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int luckyAmount = 0;
			Span<int> span = new Span<int>(stackalloc byte[checked(unchecked((UIntPtr)amountOfChars) * 4)], amountOfChars);
			Span<int> selectedIndices = span;
			RandomUtils.GetRandomUnrepeated(context.Random, 0, luckyChars.Count - 1, selectedIndices);
			for (int i = 0; i < amountOfChars; i++)
			{
				bool flag = !context.Random.CheckPercentProb((int)chance);
				if (!flag)
				{
					int charId = luckyChars[*selectedIndices[i]];
					sbyte grade = context.Random.CheckProb((int)chance, 1000) ? 7 : 6;
					short itemTemplateId = ItemDomain.GetRandomItemIdInSubType(context.Random, 1000, grade);
					ItemKey itemKey = DomainManager.Item.CreateSkillBook(context, itemTemplateId, -1, -1, -1, 50, true);
					SkillBookItem bookCfg = Config.SkillBook.Instance[itemKey.TemplateId];
					ItemBase baseItem = DomainManager.Item.GetBaseItem(itemKey);
					Character luckyChar = this._objects[charId];
					Location location = luckyChar.GetLocation();
					short attainmentRequirement = SkillGradeData.Instance[bookCfg.Grade].ReadingAttainmentRequirement;
					GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(15, bookCfg.LifeSkillType, attainmentRequirement);
					luckyChar.AddPersonalNeed(context, personalNeed);
					luckyChar.AddInventoryItem(context, itemKey, 1, false);
					luckyChar.ChangeHappiness(context, (int)baseItem.GetHappinessChange());
					lifeRecordCollection.AddUnexpectedSkillBookGain(charId, currDate, location, itemKey.ItemType, itemKey.TemplateId);
					monthlyNotificationCollection.AddUnexpectedlyGetLifeSkill(charId, location, itemKey.ItemType, itemKey.TemplateId);
					int secretInfoOffset = secretInformationCollection.AddUnexpectedSkillBookGain(charId, (ulong)itemKey, location);
					int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
					luckyAmount++;
				}
			}
			return luckyAmount;
		}

		// Token: 0x06007225 RID: 29221 RVA: 0x0041D294 File Offset: 0x0041B494
		private unsafe int ApplyUnlucky_LifeSkillBook(DataContext context, List<int> unluckyChars, int amountOfChars, sbyte chance)
		{
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int currDate = DomainManager.World.GetCurrDate();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int unluckyAmount = 0;
			Span<int> span = new Span<int>(stackalloc byte[checked(unchecked((UIntPtr)amountOfChars) * 4)], amountOfChars);
			Span<int> selectedIndices = span;
			RandomUtils.GetRandomUnrepeated(context.Random, 0, unluckyChars.Count - 1, selectedIndices);
			for (int i = 0; i < amountOfChars; i++)
			{
				bool flag = !context.Random.CheckPercentProb((int)chance);
				if (!flag)
				{
					int charId = unluckyChars[*selectedIndices[i]];
					Character unluckyChar = this._objects[charId];
					ItemKey itemKey = this.SelectItemFromItemSubTypeToLose(context.Random, unluckyChar, 1000);
					bool flag2 = !itemKey.IsValid();
					if (!flag2)
					{
						SkillBookItem bookCfg = Config.SkillBook.Instance[itemKey.TemplateId];
						ItemBase baseItem = DomainManager.Item.GetBaseItem(itemKey);
						Location location = unluckyChar.GetLocation();
						unluckyChar.RemoveInventoryItem(context, itemKey, 1, true, false);
						unluckyChar.ChangeHappiness(context, (int)(-(int)baseItem.GetHappinessChange()));
						lifeRecordCollection.AddUnexpectedSkillBookLose(charId, currDate, location, itemKey.ItemType, itemKey.TemplateId);
						monthlyNotificationCollection.AddUnexpectedlyLoseLifeSkill(charId, location, itemKey.ItemType, itemKey.TemplateId);
						int secretInfoOffset = secretInformationCollection.AddUnexpectedSkillBookLose(charId, (ulong)itemKey, location);
						int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
						unluckyAmount++;
					}
				}
			}
			return unluckyAmount;
		}

		// Token: 0x06007226 RID: 29222 RVA: 0x0041D44C File Offset: 0x0041B64C
		private unsafe int ApplyLucky_CombatSkillBook(DataContext context, List<int> luckyChars, int amountOfChars, sbyte chance)
		{
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int currDate = DomainManager.World.GetCurrDate();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int luckyAmount = 0;
			Span<int> span = new Span<int>(stackalloc byte[checked(unchecked((UIntPtr)amountOfChars) * 4)], amountOfChars);
			Span<int> selectedIndices = span;
			RandomUtils.GetRandomUnrepeated(context.Random, 0, luckyChars.Count - 1, selectedIndices);
			for (int i = 0; i < amountOfChars; i++)
			{
				bool flag = !context.Random.CheckPercentProb((int)chance);
				if (!flag)
				{
					int charId = luckyChars[*selectedIndices[i]];
					sbyte grade = context.Random.CheckProb((int)chance, 1000) ? 7 : 6;
					short itemTemplateId = ItemDomain.GetRandomItemIdInSubType(context.Random, 1001, grade);
					ItemKey itemKey = DomainManager.Item.CreateSkillBook(context, itemTemplateId, -1, -1, -1, 50, true);
					SkillBookItem bookCfg = Config.SkillBook.Instance[itemKey.TemplateId];
					ItemBase baseItem = DomainManager.Item.GetBaseItem(itemKey);
					Character luckyChar = this._objects[charId];
					Location location = luckyChar.GetLocation();
					short attainmentRequirement = SkillGradeData.Instance[bookCfg.Grade].ReadingAttainmentRequirement;
					GameData.Domains.Character.Ai.PersonalNeed personalNeed = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(14, bookCfg.CombatSkillType, attainmentRequirement);
					luckyChar.AddPersonalNeed(context, personalNeed);
					luckyChar.AddInventoryItem(context, itemKey, 1, false);
					luckyChar.ChangeHappiness(context, (int)baseItem.GetHappinessChange());
					lifeRecordCollection.AddUnexpectedSkillBookGain(charId, currDate, location, itemKey.ItemType, itemKey.TemplateId);
					monthlyNotificationCollection.AddUnexpectedlyGetCombatSkill(charId, location, itemKey.ItemType, itemKey.TemplateId);
					int secretInfoOffset = secretInformationCollection.AddUnexpectedSkillBookGain(charId, (ulong)itemKey, location);
					int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
					luckyAmount++;
				}
			}
			return luckyAmount;
		}

		// Token: 0x06007227 RID: 29223 RVA: 0x0041D650 File Offset: 0x0041B850
		private unsafe int ApplyUnlucky_CombatSkillBook(DataContext context, List<int> unluckyChars, int amountOfChars, sbyte chance)
		{
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int currDate = DomainManager.World.GetCurrDate();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int unluckyAmount = 0;
			Span<int> span = new Span<int>(stackalloc byte[checked(unchecked((UIntPtr)amountOfChars) * 4)], amountOfChars);
			Span<int> selectedIndices = span;
			RandomUtils.GetRandomUnrepeated(context.Random, 0, unluckyChars.Count - 1, selectedIndices);
			for (int i = 0; i < amountOfChars; i++)
			{
				bool flag = !context.Random.CheckPercentProb((int)chance);
				if (!flag)
				{
					int charId = unluckyChars[*selectedIndices[i]];
					Character unluckyChar = this._objects[charId];
					ItemKey itemKey = this.SelectItemFromItemSubTypeToLose(context.Random, unluckyChar, 1001);
					bool flag2 = !itemKey.IsValid();
					if (!flag2)
					{
						SkillBookItem itemConfig = Config.SkillBook.Instance[itemKey.TemplateId];
						ItemBase baseItem = DomainManager.Item.GetBaseItem(itemKey);
						Location location = unluckyChar.GetLocation();
						unluckyChar.RemoveInventoryItem(context, itemKey, 1, true, false);
						unluckyChar.ChangeHappiness(context, (int)(-(int)baseItem.GetHappinessChange()));
						lifeRecordCollection.AddUnexpectedSkillBookLose(charId, currDate, location, itemKey.ItemType, itemKey.TemplateId);
						monthlyNotificationCollection.AddUnexpectedlyLoseCombatSkill(charId, location, itemKey.ItemType, itemKey.TemplateId);
						int secretInfoOffset = secretInformationCollection.AddUnexpectedSkillBookLose(charId, (ulong)itemKey, location);
						int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
						unluckyAmount++;
					}
				}
			}
			return unluckyAmount;
		}

		// Token: 0x06007228 RID: 29224 RVA: 0x0041D808 File Offset: 0x0041BA08
		private unsafe int ApplyLucky_Regen(DataContext context, List<int> luckyChars, int amountOfChars, sbyte chance)
		{
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int currDate = DomainManager.World.GetCurrDate();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int luckyAmount = 0;
			Span<int> span = new Span<int>(stackalloc byte[checked(unchecked((UIntPtr)amountOfChars) * 4)], amountOfChars);
			Span<int> selectedIndices = span;
			RandomUtils.GetRandomUnrepeated(context.Random, 0, luckyChars.Count - 1, selectedIndices);
			for (int i = 0; i < amountOfChars; i++)
			{
				bool flag = !context.Random.CheckPercentProb((int)chance);
				if (!flag)
				{
					int charId = luckyChars[*selectedIndices[i]];
					Character luckyChar = this._objects[charId];
					sbyte selectedRecoveryType = this.SelectRandomRecoveryType(context.Random, luckyChar);
					bool flag2 = selectedRecoveryType < 0;
					if (!flag2)
					{
						Location location = luckyChar.GetLocation();
						switch (selectedRecoveryType)
						{
						case 0:
						{
							int recoverAmount = 18;
							luckyChar.ChangeHealth(context, recoverAmount * 12);
							monthlyNotificationCollection.AddUnexpectedlyGetHealth(charId, location, recoverAmount);
							lifeRecordCollection.AddUnexpectedHealthCure(charId, currDate, location, recoverAmount);
							bool flag3 = charId == taiwuCharId;
							if (flag3)
							{
							}
							break;
						}
						case 1:
						{
							Injuries injuries = luckyChar.GetInjuries();
							sbyte recoverAmount2 = (sbyte)context.Random.Next(3, 10);
							this.RecoverFixedInjuries(context.Random, ref injuries, false, recoverAmount2);
							luckyChar.SetInjuries(injuries, context);
							monthlyNotificationCollection.AddUnexpectedlyHealOuterInjury(charId, location, (int)recoverAmount2);
							lifeRecordCollection.AddUnexpectedOuterInjuryCure(charId, currDate, location, (int)recoverAmount2);
							bool flag4 = charId == taiwuCharId;
							if (flag4)
							{
							}
							break;
						}
						case 2:
						{
							Injuries injuries2 = luckyChar.GetInjuries();
							sbyte recoverAmount3 = (sbyte)context.Random.Next(3, 10);
							this.RecoverFixedInjuries(context.Random, ref injuries2, true, recoverAmount3);
							luckyChar.SetInjuries(injuries2, context);
							monthlyNotificationCollection.AddUnexpectedlyHealInnerInjury(charId, location, (int)recoverAmount3);
							lifeRecordCollection.AddUnexpectedInnerInjuryCure(charId, currDate, location, (int)recoverAmount3);
							bool flag5 = charId == taiwuCharId;
							if (flag5)
							{
							}
							break;
						}
						case 3:
						{
							PoisonInts poisoned = *luckyChar.GetPoisoned();
							int recoverAmount4 = context.Random.Next(150, 450);
							sbyte poisonType = this.RecoverFixedPoisoned(context.Random, ref poisoned, recoverAmount4);
							luckyChar.SetPoisoned(ref poisoned, context);
							monthlyNotificationCollection.AddUnexpectedlyHealPoison(charId, location, poisonType);
							lifeRecordCollection.AddUnexpectedPoisonCure(charId, currDate, location, poisonType);
							bool flag6 = charId == taiwuCharId;
							if (flag6)
							{
							}
							break;
						}
						case 4:
						{
							int recoverAmount5 = context.Random.Next(3000, 6000);
							luckyChar.ChangeDisorderOfQi(context, (int)((short)(-(short)recoverAmount5)));
							monthlyNotificationCollection.AddUnexpectedlyHealQi(charId, location);
							lifeRecordCollection.AddUnexpectedDisorderOfQiCure(charId, currDate, location);
							bool flag7 = charId == taiwuCharId;
							if (flag7)
							{
							}
							break;
						}
						}
						luckyChar.ChangeHappiness(context, 15);
						int secretInfoOffset = secretInformationCollection.AddUnexpectedCure(charId, location);
						int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
						luckyAmount++;
					}
				}
			}
			return luckyAmount;
		}

		// Token: 0x06007229 RID: 29225 RVA: 0x0041DB38 File Offset: 0x0041BD38
		private unsafe int ApplyUnlucky_Harm(DataContext context, List<int> unluckyChars, int amountOfChars, sbyte chance)
		{
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			int currDate = DomainManager.World.GetCurrDate();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int unluckyAmount = 0;
			Span<int> span = new Span<int>(stackalloc byte[checked(unchecked((UIntPtr)amountOfChars) * 4)], amountOfChars);
			Span<int> selectedIndices = span;
			RandomUtils.GetRandomUnrepeated(context.Random, 0, unluckyChars.Count - 1, selectedIndices);
			for (int i = 0; i < amountOfChars; i++)
			{
				bool flag = !context.Random.CheckPercentProb((int)chance);
				if (!flag)
				{
					int charId = unluckyChars[*selectedIndices[i]];
					Character unluckyChar = this._objects[charId];
					int selectedRecoveryType = context.Random.Next(5);
					bool flag2 = selectedRecoveryType < 0;
					if (!flag2)
					{
						Location location = unluckyChar.GetLocation();
						switch (selectedRecoveryType)
						{
						case 0:
						{
							int amount = 6;
							unluckyChar.ChangeHealth(context, -amount * 12);
							monthlyNotificationCollection.AddUnexpectedlyLoseHealth(charId, location, amount);
							lifeRecordCollection.AddUnexpectedHealthHarm(charId, currDate, location, amount);
							bool flag3 = charId == taiwuCharId;
							if (flag3)
							{
							}
							break;
						}
						case 1:
						{
							Injuries injuries = unluckyChar.GetInjuries();
							sbyte amount2 = (sbyte)context.Random.Next(1, 4);
							this.GetFixedInjuries(context.Random, ref injuries, false, amount2);
							unluckyChar.SetInjuries(injuries, context);
							monthlyNotificationCollection.AddUnexpectedlySufferOuterInjury(charId, location, (int)amount2);
							lifeRecordCollection.AddUnexpectedOuterInjuryHarm(charId, currDate, location, (int)amount2);
							bool flag4 = charId == taiwuCharId;
							if (flag4)
							{
							}
							break;
						}
						case 2:
						{
							Injuries injuries2 = unluckyChar.GetInjuries();
							sbyte amount3 = (sbyte)context.Random.Next(1, 4);
							this.GetFixedInjuries(context.Random, ref injuries2, true, amount3);
							unluckyChar.SetInjuries(injuries2, context);
							monthlyNotificationCollection.AddUnexpectedlySufferInneInjury(charId, location, (int)amount3);
							lifeRecordCollection.AddUnexpectedInnerInjuryHarm(charId, currDate, location, (int)amount3);
							bool flag5 = charId == taiwuCharId;
							if (flag5)
							{
							}
							break;
						}
						case 3:
						{
							PoisonInts poisoned = default(PoisonInts);
							int amount4 = context.Random.Next(50, 150);
							sbyte poisonType = (sbyte)context.Random.Next(6);
							*(ref poisoned.Items.FixedElementField + (IntPtr)poisonType * 4) += amount4;
							unluckyChar.DirectlyChangePoisoned(context, ref poisoned);
							monthlyNotificationCollection.AddUnexpectedlySufferPoison(charId, location, poisonType);
							lifeRecordCollection.AddUnexpectedPoisonHarm(charId, currDate, location, poisonType);
							bool flag6 = charId == taiwuCharId;
							if (flag6)
							{
							}
							break;
						}
						case 4:
						{
							int amount5 = context.Random.Next(1000, 2000);
							unluckyChar.ChangeDisorderOfQi(context, (int)((short)amount5));
							monthlyNotificationCollection.AddUnexpectedlySufferDisorderOfQi(charId, location);
							lifeRecordCollection.AddUnexpectedDisorderOfQiHarm(charId, currDate, location);
							bool flag7 = charId == taiwuCharId;
							if (flag7)
							{
							}
							break;
						}
						}
						unluckyChar.ChangeHappiness(context, 15);
						int secretInfoOffset = secretInformationCollection.AddUnexpectedHarm(charId, location);
						int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
						unluckyAmount++;
					}
				}
			}
			return unluckyAmount;
		}

		// Token: 0x0600722A RID: 29226 RVA: 0x0041DE70 File Offset: 0x0041C070
		private unsafe sbyte SelectRandomRecoveryType(IRandomSource random, Character character)
		{
			Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)5], 5);
			Span<sbyte> selectables = span;
			int count = 0;
			bool flag = character.GetHealth() != character.GetLeftMaxHealth(false);
			if (flag)
			{
				*selectables[count] = 0;
				count++;
			}
			bool flag2 = character.GetInjuries().HasAnyInjury(false);
			if (flag2)
			{
				*selectables[count] = 1;
				count++;
			}
			bool flag3 = character.GetInjuries().HasAnyInjury(true);
			if (flag3)
			{
				*selectables[count] = 2;
				count++;
			}
			bool flag4 = character.GetPoisoned().IsNonZero();
			if (flag4)
			{
				*selectables[count] = 3;
				count++;
			}
			bool flag5 = character.GetDisorderOfQi() > 0;
			if (flag5)
			{
				*selectables[count] = 4;
				count++;
			}
			bool flag6 = count > 0;
			sbyte result;
			if (flag6)
			{
				result = *selectables[random.Next(count)];
			}
			else
			{
				result = -1;
			}
			return result;
		}

		// Token: 0x0600722B RID: 29227 RVA: 0x0041DF64 File Offset: 0x0041C164
		private unsafe sbyte SelectRandomResourceTypeToLose(IRandomSource random, ref ResourceInts resources)
		{
			Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)7], 7);
			Span<sbyte> selectables = span;
			int count = 0;
			for (sbyte resType = 0; resType < 7; resType += 1)
			{
				bool flag = *(ref resources.Items.FixedElementField + (IntPtr)resType * 4) > 0;
				if (flag)
				{
					*selectables[count] = resType;
					count++;
				}
			}
			bool flag2 = count > 0;
			sbyte result;
			if (flag2)
			{
				result = *selectables[random.Next(count)];
			}
			else
			{
				result = -1;
			}
			return result;
		}

		// Token: 0x0600722C RID: 29228 RVA: 0x0041DFE4 File Offset: 0x0041C1E4
		private ItemKey SelectItemFromItemTypeToLose(IRandomSource random, Character character, sbyte itemType)
		{
			List<ItemKey> validItems = ObjectPool<List<ItemKey>>.Instance.Get();
			validItems.Clear();
			sbyte currGrade = -1;
			foreach (KeyValuePair<ItemKey, int> keyValuePair in character.GetInventory().Items)
			{
				ItemKey itemKey3;
				int num;
				keyValuePair.Deconstruct(out itemKey3, out num);
				ItemKey itemKey = itemKey3;
				bool flag = itemKey.ItemType != itemType;
				if (!flag)
				{
					sbyte grade = ItemTemplateHelper.GetGrade(itemKey.ItemType, itemKey.TemplateId);
					bool flag2 = grade > currGrade;
					if (flag2)
					{
						validItems.Clear();
					}
					else
					{
						bool flag3 = grade < currGrade;
						if (flag3)
						{
							continue;
						}
					}
					validItems.Add(itemKey);
				}
			}
			foreach (ItemKey itemKey2 in character.GetEquipment())
			{
				bool flag4 = !itemKey2.IsValid() || itemKey2.ItemType != itemType;
				if (!flag4)
				{
					sbyte grade2 = ItemTemplateHelper.GetGrade(itemKey2.ItemType, itemKey2.TemplateId);
					bool flag5 = grade2 > currGrade;
					if (flag5)
					{
						validItems.Clear();
					}
					else
					{
						bool flag6 = grade2 < currGrade;
						if (flag6)
						{
							goto IL_12D;
						}
					}
					validItems.Add(itemKey2);
				}
				IL_12D:;
			}
			ItemKey selectedItem = ItemKey.Invalid;
			bool flag7 = validItems.Count > 0;
			if (flag7)
			{
				selectedItem = validItems.GetRandom(random);
			}
			ObjectPool<List<ItemKey>>.Instance.Return(validItems);
			return selectedItem;
		}

		// Token: 0x0600722D RID: 29229 RVA: 0x0041E16C File Offset: 0x0041C36C
		private ItemKey SelectItemFromItemSubTypeToLose(IRandomSource random, Character character, short itemSubType)
		{
			List<ItemKey> validItems = ObjectPool<List<ItemKey>>.Instance.Get();
			validItems.Clear();
			sbyte currGrade = -1;
			foreach (KeyValuePair<ItemKey, int> keyValuePair in character.GetInventory().Items)
			{
				ItemKey itemKey3;
				int num;
				keyValuePair.Deconstruct(out itemKey3, out num);
				ItemKey itemKey = itemKey3;
				bool flag = ItemTemplateHelper.GetItemSubType(itemKey.ItemType, itemKey.TemplateId) != itemSubType;
				if (!flag)
				{
					sbyte grade = ItemTemplateHelper.GetGrade(itemKey.ItemType, itemKey.TemplateId);
					bool flag2 = grade > currGrade;
					if (flag2)
					{
						validItems.Clear();
					}
					else
					{
						bool flag3 = grade < currGrade;
						if (flag3)
						{
							continue;
						}
					}
					validItems.Add(itemKey);
				}
			}
			foreach (ItemKey itemKey2 in character.GetEquipment())
			{
				bool flag4 = !itemKey2.IsValid();
				if (!flag4)
				{
					bool flag5 = ItemTemplateHelper.GetItemSubType(itemKey2.ItemType, itemKey2.TemplateId) != itemSubType;
					if (!flag5)
					{
						sbyte grade2 = ItemTemplateHelper.GetGrade(itemKey2.ItemType, itemKey2.TemplateId);
						bool flag6 = grade2 > currGrade;
						if (flag6)
						{
							validItems.Clear();
						}
						else
						{
							bool flag7 = grade2 < currGrade;
							if (flag7)
							{
								goto IL_151;
							}
						}
						validItems.Add(itemKey2);
					}
				}
				IL_151:;
			}
			ItemKey selectedItem = ItemKey.Invalid;
			bool flag8 = validItems.Count > 0;
			if (flag8)
			{
				selectedItem = validItems.GetRandom(random);
			}
			ObjectPool<List<ItemKey>>.Instance.Return(validItems);
			return selectedItem;
		}

		// Token: 0x0600722E RID: 29230 RVA: 0x0041E31C File Offset: 0x0041C51C
		private unsafe void RecoverFixedInjuries(IRandomSource random, ref Injuries injuries, bool isInnerInjury, sbyte totalRecoverAmount)
		{
			Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)7], 7);
			Span<sbyte> selectables = span;
			for (int i = 0; i < (int)totalRecoverAmount; i++)
			{
				int count = 0;
				for (sbyte part = 0; part < 7; part += 1)
				{
					bool flag = injuries.Get(part, isInnerInjury) <= 0;
					if (!flag)
					{
						*selectables[count] = part;
						count++;
					}
				}
				bool flag2 = count == 0;
				if (flag2)
				{
					break;
				}
				sbyte selectedPart = *selectables[random.Next(count)];
				injuries.Change(selectedPart, isInnerInjury, -1);
			}
		}

		// Token: 0x0600722F RID: 29231 RVA: 0x0041E3B8 File Offset: 0x0041C5B8
		private void GetOrHealRandomInjuriesWithoutChecking(IRandomSource random, ref Injuries injuries, int minAmount, int maxAmount)
		{
			int totalAmount = random.Next(minAmount, maxAmount + 1);
			for (int i = 0; i < totalAmount; i++)
			{
				sbyte selectedIndex = (sbyte)random.Next(14);
				injuries.Change((int)selectedIndex, 1);
			}
		}

		// Token: 0x06007230 RID: 29232 RVA: 0x0041E3F8 File Offset: 0x0041C5F8
		private unsafe void GetOrDetoxRandomPoisonsWithoutChecking(IRandomSource random, ref PoisonInts poisoned, int poisonTypeCount, int minAmount, int maxAmount)
		{
			for (int i = 0; i < poisonTypeCount; i++)
			{
				int poisonType = random.Next(6);
				int amount = random.Next(minAmount, maxAmount + 1);
				*(ref poisoned.Items.FixedElementField + (IntPtr)poisonType * 4) += amount;
				bool flag = *(ref poisoned.Items.FixedElementField + (IntPtr)poisonType * 4) < 0;
				if (flag)
				{
					*(ref poisoned.Items.FixedElementField + (IntPtr)poisonType * 4) = 0;
				}
			}
		}

		// Token: 0x06007231 RID: 29233 RVA: 0x0041E470 File Offset: 0x0041C670
		private unsafe void GetFixedInjuries(IRandomSource random, ref Injuries injuries, bool isInnerInjury, sbyte totalInjureAmount)
		{
			Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)7], 7);
			Span<sbyte> selectables = span;
			for (int i = 0; i < (int)totalInjureAmount; i++)
			{
				int count = 0;
				for (sbyte part = 0; part < 7; part += 1)
				{
					bool flag = injuries.Get(part, isInnerInjury) >= 6;
					if (!flag)
					{
						*selectables[count] = part;
						count++;
					}
				}
				bool flag2 = count == 0;
				if (flag2)
				{
					break;
				}
				sbyte selectedPart = *selectables[random.Next(count)];
				injuries.Change(selectedPart, isInnerInjury, 1);
			}
		}

		// Token: 0x06007232 RID: 29234 RVA: 0x0041E50C File Offset: 0x0041C70C
		private unsafe sbyte RecoverFixedPoisoned(IRandomSource random, ref PoisonInts poisoned, int totalRecoverAmount)
		{
			Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)6], 6);
			Span<sbyte> selectables = span;
			int count = 0;
			for (sbyte poisonType = 0; poisonType < 6; poisonType += 1)
			{
				bool flag = *(ref poisoned.Items.FixedElementField + (IntPtr)poisonType * 4) <= 0;
				if (!flag)
				{
					*selectables[count] = poisonType;
					count++;
				}
			}
			Tester.Assert(count > 0, "");
			sbyte selectedPoisonType = *selectables[random.Next(count)];
			bool condition = selectedPoisonType >= 0 && selectedPoisonType < 6;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(28, 2);
			defaultInterpolatedStringHandler.AppendFormatted<sbyte>(selectedPoisonType);
			defaultInterpolatedStringHandler.AppendLiteral(" >= 0 && ");
			defaultInterpolatedStringHandler.AppendFormatted<sbyte>(selectedPoisonType);
			defaultInterpolatedStringHandler.AppendLiteral(" < PoisonType.Count");
			Tester.Assert(condition, defaultInterpolatedStringHandler.ToStringAndClear());
			int poison = *(ref poisoned.Items.FixedElementField + (IntPtr)selectedPoisonType * 4);
			int recoveredAmount = Math.Min(totalRecoverAmount, poison);
			*(ref poisoned.Items.FixedElementField + (IntPtr)selectedPoisonType * 4) -= recoveredAmount;
			return selectedPoisonType;
		}

		// Token: 0x1700047D RID: 1149
		// (get) Token: 0x06007233 RID: 29235 RVA: 0x0041E618 File Offset: 0x0041C818
		public Location TripleAdoreLocation
		{
			get
			{
				return this._tripleAdoreLocation;
			}
		}

		// Token: 0x1700047E RID: 1150
		// (get) Token: 0x06007234 RID: 29236 RVA: 0x0041E620 File Offset: 0x0041C820
		public Location TripleHateLocation
		{
			get
			{
				return this._tripleHateLocation;
			}
		}

		// Token: 0x1700047F RID: 1151
		// (get) Token: 0x06007235 RID: 29237 RVA: 0x0041E628 File Offset: 0x0041C828
		[Obsolete]
		public Location DoubleAgeIncreaseLocation
		{
			get
			{
				return this._doubleAgeIncreaseLocation;
			}
		}

		// Token: 0x17000480 RID: 1152
		// (get) Token: 0x06007236 RID: 29238 RVA: 0x0041E630 File Offset: 0x0041C830
		[Obsolete]
		public Location NoAgeIncreaseLocation
		{
			get
			{
				return this._noAgeIncreaseLocation;
			}
		}

		// Token: 0x06007237 RID: 29239 RVA: 0x0041E638 File Offset: 0x0041C838
		private void InitializeXiangshuLocations()
		{
			this._tripleHateLocation = Location.Invalid;
			this._tripleAdoreLocation = Location.Invalid;
			this._forceRebelLocation = Location.Invalid;
			this._forceKindLocation = Location.Invalid;
			this._doubleAgeIncreaseLocation = Location.Invalid;
			this._noAgeIncreaseLocation = Location.Invalid;
			foreach (KeyValuePair<short, int> keyValuePair in this._fixedCharactersCache)
			{
				short num;
				int num2;
				keyValuePair.Deconstruct(out num, out num2);
				short templateId = num;
				int charId = num2;
				short num3 = templateId;
				short num4 = num3;
				if (num4 >= 183)
				{
					if (num4 >= 201)
					{
						if (num4 <= 209)
						{
							this._doubleAgeIncreaseLocation = this._objects[charId].GetLocation();
						}
					}
					else if (num4 <= 191)
					{
						this._forceRebelLocation = this._objects[charId].GetLocation();
					}
				}
				else if (num4 >= 165)
				{
					if (num4 <= 173)
					{
						this._tripleHateLocation = this._objects[charId].GetLocation();
					}
				}
				else
				{
					switch (num4)
					{
					case 43:
						this._tripleAdoreLocation = this._objects[charId].GetLocation();
						break;
					case 45:
						this._forceKindLocation = this._objects[charId].GetLocation();
						break;
					case 47:
						this._noAgeIncreaseLocation = this._objects[charId].GetLocation();
						break;
					}
				}
			}
		}

		// Token: 0x06007238 RID: 29240 RVA: 0x0041E7FC File Offset: 0x0041C9FC
		public void OnFixedCharacterLocationChanged(DataContext context, int charId, Location srcLocation, Location destLocation)
		{
			Character character = this._objects[charId];
			short templateId = character.GetTemplateId();
			short num = templateId;
			if (num >= 183)
			{
				if (num >= 201)
				{
					if (num <= 209)
					{
						this._doubleAgeIncreaseLocation = destLocation;
					}
				}
				else if (num <= 191)
				{
					this.SetForceRebelLocation(destLocation, context);
				}
			}
			else if (num >= 165)
			{
				if (num <= 173)
				{
					this._tripleHateLocation = destLocation;
				}
			}
			else
			{
				switch (num)
				{
				case 43:
					this._tripleAdoreLocation = destLocation;
					break;
				case 45:
					this.SetForceKindLocation(destLocation, context);
					break;
				case 47:
					this._noAgeIncreaseLocation = destLocation;
					break;
				}
			}
		}

		// Token: 0x06007239 RID: 29241 RVA: 0x0041E8B8 File Offset: 0x0041CAB8
		public unsafe bool TransferAvoidDeathCharInjuries(DataContext context)
		{
			bool flag = this._avoidDeathCharId < 0;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				Character avoidDeathChar = this._objects[this._avoidDeathCharId];
				Location location = avoidDeathChar.GetLocation();
				bool flag2 = !location.IsValid();
				if (flag2)
				{
					location = avoidDeathChar.GetValidLocation();
				}
				int targetCharId = this.GetRandomCharacterInRange(context, location, 2, true);
				bool flag3 = targetCharId < 0;
				if (flag3)
				{
					result = false;
				}
				else
				{
					Character targetChar = this._objects[targetCharId];
					Injuries injuries = avoidDeathChar.GetInjuries();
					targetChar.ChangeInjuries(context, injuries);
					injuries.Initialize();
					avoidDeathChar.SetInjuries(injuries, context);
					PoisonInts poisons = *avoidDeathChar.GetPoisoned();
					for (sbyte poisonType = 0; poisonType < 6; poisonType += 1)
					{
						targetChar.ChangePoisoned(context, poisonType, 3, *(ref poisons.Items.FixedElementField + (IntPtr)poisonType * 4));
					}
					poisons = default(PoisonInts);
					avoidDeathChar.SetPoisoned(ref poisons, context);
					avoidDeathChar.TransferDisorderOfQi(context, targetChar, (int)avoidDeathChar.GetDisorderOfQi());
					EatingItems eatingItems = *avoidDeathChar.GetEatingItems();
					for (sbyte slotIndex = 0; slotIndex < 9; slotIndex += 1)
					{
						ItemKey itemKey = (ItemKey)(*(ref eatingItems.ItemKeys.FixedElementField + (IntPtr)slotIndex * 8));
						bool flag4 = itemKey.ItemType != 8 || ItemTemplateHelper.GetItemSubType(itemKey.ItemType, itemKey.TemplateId) != 802;
						if (!flag4)
						{
							targetChar.AddWug(context, itemKey.TemplateId);
							avoidDeathChar.RemoveWug(context, itemKey.TemplateId);
						}
					}
					LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
					int currDate = DomainManager.World.GetCurrDate();
					bool flag5 = avoidDeathChar.GetCreatingType() == 0;
					if (flag5)
					{
						lifeRecordCollection.AddWeiQiBad(targetCharId, currDate, targetChar.GetLocation());
					}
					else
					{
						lifeRecordCollection.AddWeiQiGood(this._avoidDeathCharId, currDate, location);
					}
					bool flag6 = DomainManager.World.GetAdvancingMonthState() == 0;
					if (flag6)
					{
						DomainManager.LifeRecord.CommitCurrLifeRecords();
					}
					this.SetAvoidDeathCharId(-1, context);
					result = true;
				}
			}
			return result;
		}

		// Token: 0x0600723A RID: 29242 RVA: 0x0041EAC8 File Offset: 0x0041CCC8
		public static void AddLockMovementCharSet(int charId)
		{
			CharacterDomain.LockMovementCharSet.Add(charId);
		}

		// Token: 0x0600723B RID: 29243 RVA: 0x0041EAD8 File Offset: 0x0041CCD8
		public static bool IsLockMovementChar(int charId)
		{
			return CharacterDomain.LockMovementCharSet.Contains(charId);
		}

		// Token: 0x0600723C RID: 29244 RVA: 0x0041EAF5 File Offset: 0x0041CCF5
		public static void ClearLockMovementCharSet()
		{
			CharacterDomain.LockMovementCharSet.Clear();
		}

		// Token: 0x0600723D RID: 29245 RVA: 0x0041EB04 File Offset: 0x0041CD04
		public void UpdateFixedCharacterMovements(DataContext context)
		{
			List<int> fixedCharList = ObjectPool<List<int>>.Instance.Get();
			fixedCharList.Clear();
			fixedCharList.AddRange(this._fixedCharactersCache.Values);
			foreach (int charId in fixedCharList)
			{
				Character character = this._objects[charId];
				bool flag = !character.GetLocation().IsValid();
				if (!flag)
				{
					short templateId = character.GetTemplateId();
					short num = templateId;
					short num2 = num;
					if (num2 <= 191)
					{
						if (num2 <= 155)
						{
							if (num2 <= 137)
							{
								if (num2 < 129)
								{
									switch (num2)
									{
									case 39:
										this.JuniorMonvMovement(context, character);
										break;
									case 40:
										this.JuniorDayueYaochangMovement(context, character);
										break;
									case 41:
										this.JuniorJiuhanMovement(context, character);
										break;
									case 42:
										this.JuniorJinHuangerMovement(context, character);
										break;
									case 43:
										this.JuniorYiyihouMovement(context, character);
										break;
									case 44:
										this.JuniorWeiQiMovement(context, character);
										break;
									case 45:
										this.JuniorYixiangMovement(context, character);
										break;
									case 46:
										this.JuniorXuefengMovement(context, character);
										break;
									case 47:
										this.JuniorShuFangMovement(context, character);
										break;
									}
								}
								else
								{
									this.MonvMovement(context, character);
								}
							}
							else if (num2 > 146)
							{
								this.JiuhanMovement(context, character);
							}
							else
							{
								this.DayueYaochangMovement(context, character);
							}
						}
						else if (num2 <= 173)
						{
							if (num2 > 164)
							{
								this.YiYihouMovement(context, character);
							}
							else
							{
								this.JinHuangerMovement(context, character);
							}
						}
						else if (num2 > 182)
						{
							this.YixiangMovement(context, character);
						}
						else
						{
							this.WeiQiMovement(context, character);
						}
					}
					else if (num2 <= 536)
					{
						if (num2 <= 209)
						{
							if (num2 > 200)
							{
								this.ShufangMovement(context, character);
							}
							else
							{
								this.XuefengMovement(context, character);
							}
						}
						else if (num2 < 521)
						{
							if (num2 != 441)
							{
								if (num2 != 446)
								{
									if (num2 == 447)
									{
										this.ZiWuxiaoMovement(context, character);
									}
								}
								else
								{
									this.LongYufuMovement(context, character);
								}
							}
							else
							{
								this.RanchenziMovement(context, character);
							}
						}
						else
						{
							this.XuehouOldManMovement(context, character);
						}
					}
					else if (num2 >= 543)
					{
						if (num2 > 547)
						{
							if (num2 <= 747)
							{
								if (num2 != 667)
								{
									if (num2 != 672)
									{
										if (num2 == 747)
										{
											this.ImpersonatorBuddhistMonkMovement(context, character);
										}
									}
									else
									{
										this.WudangBlackSnakeMovement(context, character);
									}
								}
								else
								{
									this.TripodVesselOfMedicineMovement(context, character);
								}
							}
							else if (num2 <= 786)
							{
								if (num2 == 781 || num2 == 786)
								{
									this.BaihuaLeMeMovement(context, character);
								}
							}
							else
							{
								switch (num2)
								{
								case 808:
								case 809:
									this.BaihuaBaiLuXuanXiaoMovement(context, character);
									break;
								case 810:
									this.FulongReudhLazuliMovement(context, character);
									break;
								case 811:
									break;
								case 812:
									this.FulongReudhLazuliFeatherMovement(context, character);
									break;
								default:
									if (num2 == 836)
									{
										this.GearMateMovement(context, character);
									}
									break;
								}
							}
						}
						else
						{
							this.SloppyTaoistMonkMovement(context, character);
						}
					}
					else if (num2 <= 539)
					{
						this.JixiMovement(context, character);
					}
				}
			}
			ObjectPool<List<int>>.Instance.Return(fixedCharList);
		}

		// Token: 0x0600723E RID: 29246 RVA: 0x0041EF18 File Offset: 0x0041D118
		private static Location CalcXiangshuMovementNextBlock(Location start, Location end, bool avoidChars, bool attractedByChars)
		{
			bool flag = start.Equals(end);
			Location result;
			if (flag)
			{
				result = end;
			}
			else
			{
				MapBlockData currBlock = DomainManager.Map.GetBlock(start).GetRootBlock();
				bool flag2 = CharacterDomain.<CalcXiangshuMovementNextBlock>g__BlockHasSwordTombKeeper|620_1(currBlock);
				if (flag2)
				{
					result = start;
				}
				else
				{
					List<MapBlockData> groupBlockList = currBlock.GroupBlockList;
					bool flag3 = groupBlockList != null && groupBlockList.Count > 0;
					if (flag3)
					{
						foreach (MapBlockData groupBlock in currBlock.GroupBlockList)
						{
							bool flag4 = CharacterDomain.<CalcXiangshuMovementNextBlock>g__BlockHasSwordTombKeeper|620_1(groupBlock);
							if (flag4)
							{
								return start;
							}
						}
					}
					byte areaSize = DomainManager.Map.GetAreaSize(start.AreaId);
					CharacterDomain._xiangshuMovementMap.InitMap((int)areaSize, (int)areaSize, delegate(ByteCoordinate coord)
					{
						MapBlockData block = DomainManager.Map.GetBlock(start.AreaId, ByteCoordinate.CoordinateToIndex(coord, areaSize));
						bool avoidChars2 = avoidChars;
						sbyte result2;
						if (avoidChars2)
						{
							result2 = ((block.CharacterSet == null) ? 1 : 4);
						}
						else
						{
							bool attractedByChars2 = attractedByChars;
							if (attractedByChars2)
							{
								result2 = ((block.CharacterSet == null) ? 4 : 1);
							}
							else
							{
								result2 = 1;
							}
						}
						return result2;
					});
					List<ByteCoordinate> pathInArea = ObjectPool<List<ByteCoordinate>>.Instance.Get();
					CharacterDomain._xiangshuMovementMap.FindWay(ByteCoordinate.IndexToCoordinate(start.BlockId, areaSize), ByteCoordinate.IndexToCoordinate(end.BlockId, areaSize), ref pathInArea, null);
					short nextBlockId = ByteCoordinate.CoordinateToIndex(pathInArea[1], areaSize);
					ObjectPool<List<ByteCoordinate>>.Instance.Return(pathInArea);
					result = new Location(start.AreaId, nextBlockId);
				}
			}
			return result;
		}

		// Token: 0x0600723F RID: 29247 RVA: 0x0041F0BC File Offset: 0x0041D2BC
		private void MonvMovement(DataContext context, Character character)
		{
			Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
			Location taiwuLocation = taiwuChar.GetLocation();
			Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			Location srcLocation = character.GetLocation();
			Location nextLocation = CharacterDomain.CalcXiangshuMovementNextBlock(srcLocation, taiwuVillageLocation, true, false);
			bool flag = !srcLocation.Equals(nextLocation);
			if (flag)
			{
				character.SetLocation(nextLocation, context);
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, nextLocation);
			}
			else
			{
				DomainManager.Building.XiangshuDestroyTaiwuVillageBuilding(context, nextLocation);
			}
			DomainManager.Taiwu.UpdateSwordTombKeepersOnXiangshuAvatarMoved(context, character, nextLocation);
			int targetCharId = this.GetRandomCharacterInRange(context, nextLocation, 1, true);
			bool flag2 = targetCharId < 0;
			if (!flag2)
			{
				Character targetChar = this._objects[targetCharId];
				Injuries injuries = targetChar.GetInjuries();
				PoisonInts poisoned = default(PoisonInts);
				this.GetOrHealRandomInjuriesWithoutChecking(context.Random, ref injuries, 3, 6);
				this.GetOrDetoxRandomPoisonsWithoutChecking(context.Random, ref poisoned, 3, 100, 300);
				targetChar.SetInjuries(injuries, context);
				targetChar.DirectlyChangePoisoned(context, ref poisoned);
				int date = DomainManager.World.GetCurrDate();
				DomainManager.LifeRecord.GetLifeRecordCollection().AddMonvBad(targetCharId, date, nextLocation);
				DomainManager.World.GetMonthlyNotificationCollection().AddMonvBringDisaster(nextLocation, targetCharId);
			}
		}

		// Token: 0x06007240 RID: 29248 RVA: 0x0041F1FC File Offset: 0x0041D3FC
		private void DayueYaochangMovement(DataContext context, Character character)
		{
			Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
			Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			Location srcLocation = character.GetLocation();
			Location nextLocation = CharacterDomain.CalcXiangshuMovementNextBlock(srcLocation, taiwuVillageLocation, false, false);
			bool flag = !srcLocation.Equals(nextLocation);
			if (flag)
			{
				character.SetLocation(nextLocation, context);
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, nextLocation);
			}
			else
			{
				DomainManager.Building.XiangshuDestroyTaiwuVillageBuilding(context, nextLocation);
			}
			DomainManager.Taiwu.UpdateSwordTombKeepersOnXiangshuAvatarMoved(context, character, nextLocation);
			int targetCharId = this.GetRandomCharacterInRange(context, nextLocation, 1, false);
			bool flag2 = targetCharId < 0;
			if (!flag2)
			{
				DomainManager.World.GetMonthlyNotificationCollection().AddDayueYaochangBringDisaster(nextLocation, targetCharId);
				bool flag3 = targetCharId == DomainManager.Taiwu.GetTaiwuCharId();
				if (flag3)
				{
					DomainManager.World.SetTaiwuDying(false);
				}
				else
				{
					this.MakeCharacterDead(context, this._objects[targetCharId], 12);
				}
			}
		}

		// Token: 0x06007241 RID: 29249 RVA: 0x0041F2E0 File Offset: 0x0041D4E0
		private void JiuhanMovement(DataContext context, Character character)
		{
			Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
			Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			Location srcLocation = character.GetLocation();
			Location nextLocation = CharacterDomain.CalcXiangshuMovementNextBlock(srcLocation, taiwuVillageLocation, true, false);
			bool flag = !srcLocation.Equals(nextLocation);
			if (flag)
			{
				character.SetLocation(nextLocation, context);
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, nextLocation);
			}
			else
			{
				DomainManager.Building.XiangshuDestroyTaiwuVillageBuilding(context, nextLocation);
			}
			DomainManager.Taiwu.UpdateSwordTombKeepersOnXiangshuAvatarMoved(context, character, nextLocation);
			List<MapBlockData> neighborBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
			DomainManager.Map.GetRealNeighborBlocks(nextLocation.AreaId, nextLocation.BlockId, neighborBlocks, 1, true);
			foreach (MapBlockData block in neighborBlocks)
			{
				bool destroyed = block.Destroyed;
				if (!destroyed)
				{
					bool flag2 = block.IsCityTown() || block.TemplateId == 37;
					if (!flag2)
					{
						bool flag3 = block.RootBlockId >= 0 || block.GroupBlockList != null;
						if (!flag3)
						{
							block.Destroyed = true;
							block.DestroyItemsDirect(context.AdvanceMonthRelatedData.WorldItemsToBeRemoved);
							block.CurrResources.Initialize();
							DomainManager.Map.SetBlockData(context, block);
						}
					}
				}
			}
			context.AdvanceMonthRelatedData.Blocks.Release(ref neighborBlocks);
			DomainManager.World.GetMonthlyNotificationCollection().AddJiuhanvBringDisaster(nextLocation);
		}

		// Token: 0x06007242 RID: 29250 RVA: 0x0041F47C File Offset: 0x0041D67C
		private unsafe void JinHuangerMovement(DataContext context, Character character)
		{
			Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
			Location taiwuLocation = taiwuChar.GetLocation();
			Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			Location srcLocation = character.GetLocation();
			Location nextLocation = CharacterDomain.CalcXiangshuMovementNextBlock(srcLocation, taiwuVillageLocation, false, true);
			bool flag = !srcLocation.Equals(nextLocation);
			if (flag)
			{
				character.SetLocation(nextLocation, context);
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, nextLocation);
			}
			else
			{
				DomainManager.Building.XiangshuDestroyTaiwuVillageBuilding(context, nextLocation);
			}
			DomainManager.Taiwu.UpdateSwordTombKeepersOnXiangshuAvatarMoved(context, character, nextLocation);
			bool flag2 = !context.Random.CheckPercentProb(80);
			if (!flag2)
			{
				int targetCharId = this.GetRandomCharacterInRange(context, nextLocation, 2, true);
				bool flag3 = targetCharId < 0;
				if (!flag3)
				{
					List<int> charIds = context.AdvanceMonthRelatedData.CharIdList.Occupy();
					charIds.Add(targetCharId);
					Span<int> span = new Span<int>(stackalloc byte[(UIntPtr)28], 7);
					Span<int> resultIndices = span;
					RandomUtils.GetRandomUnrepeated(context.Random, 0, 6, resultIndices);
					for (int i = 0; i < 7; i++)
					{
						int randNum = *resultIndices[i];
						if (!true)
						{
						}
						int num;
						switch (randNum)
						{
						case 0:
							num = this.ApplyUnlucky_Resource(context, charIds, 1, 100);
							break;
						case 1:
							num = this.ApplyUnlucky_Item(context, charIds, 1, 2, 100);
							break;
						case 2:
							num = this.ApplyUnlucky_Item(context, charIds, 1, 0, 100);
							break;
						case 3:
							num = this.ApplyUnlucky_Item(context, charIds, 1, 1, 100);
							break;
						case 4:
							num = this.ApplyUnlucky_CombatSkillBook(context, charIds, 1, 100);
							break;
						case 5:
							num = this.ApplyUnlucky_LifeSkillBook(context, charIds, 1, 100);
							break;
						case 6:
							num = this.ApplyUnlucky_Harm(context, charIds, 1, 100);
							break;
						default:
							num = 0;
							break;
						}
						if (!true)
						{
						}
						int unluckyAmount = num;
						bool flag4 = unluckyAmount > 0;
						if (flag4)
						{
							int date = DomainManager.World.GetCurrDate();
							DomainManager.LifeRecord.GetLifeRecordCollection().AddJinHuangerBad(targetCharId, date, nextLocation);
							DomainManager.World.GetMonthlyNotificationCollection().AddJinHuangervBringDisaster(nextLocation, targetCharId);
							break;
						}
					}
					context.AdvanceMonthRelatedData.CharIdList.Release(ref charIds);
				}
			}
		}

		// Token: 0x06007243 RID: 29251 RVA: 0x0041F6A8 File Offset: 0x0041D8A8
		private void YiYihouMovement(DataContext context, Character character)
		{
			Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			Location srcLocation = character.GetLocation();
			Location nextLocation = CharacterDomain.CalcXiangshuMovementNextBlock(srcLocation, taiwuVillageLocation, false, true);
			bool flag = !srcLocation.Equals(nextLocation);
			if (flag)
			{
				character.SetLocation(nextLocation, context);
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, nextLocation);
			}
			else
			{
				DomainManager.Building.XiangshuDestroyTaiwuVillageBuilding(context, nextLocation);
			}
			DomainManager.Taiwu.UpdateSwordTombKeepersOnXiangshuAvatarMoved(context, character, nextLocation);
			DomainManager.World.GetMonthlyNotificationCollection().AddYiYihouvBringDisaster(nextLocation);
		}

		// Token: 0x06007244 RID: 29252 RVA: 0x0041F72C File Offset: 0x0041D92C
		private void WeiQiMovement(DataContext context, Character character)
		{
			Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
			Location taiwuLocation = taiwuChar.GetLocation();
			Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			Location srcLocation = character.GetLocation();
			Location nextLocation = CharacterDomain.CalcXiangshuMovementNextBlock(srcLocation, taiwuVillageLocation, true, false);
			bool flag = !srcLocation.Equals(nextLocation);
			if (flag)
			{
				character.SetLocation(nextLocation, context);
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, nextLocation);
			}
			else
			{
				DomainManager.Building.XiangshuDestroyTaiwuVillageBuilding(context, nextLocation);
			}
			this.SetAvoidDeathCharId(character.GetId(), context);
		}

		// Token: 0x06007245 RID: 29253 RVA: 0x0041F7B8 File Offset: 0x0041D9B8
		private void YixiangMovement(DataContext context, Character character)
		{
			Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
			Location taiwuLocation = taiwuChar.GetLocation();
			Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			Location srcLocation = character.GetLocation();
			Location nextLocation = CharacterDomain.CalcXiangshuMovementNextBlock(srcLocation, taiwuVillageLocation, false, false);
			bool flag = !srcLocation.Equals(nextLocation);
			if (flag)
			{
				character.SetLocation(nextLocation, context);
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, nextLocation);
			}
			else
			{
				DomainManager.Building.XiangshuDestroyTaiwuVillageBuilding(context, nextLocation);
			}
			DomainManager.Taiwu.UpdateSwordTombKeepersOnXiangshuAvatarMoved(context, character, nextLocation);
			int targetCharId = this.GetRandomCharacterInRange(context, nextLocation, 3, true);
			bool flag2 = targetCharId >= 0;
			if (!flag2)
			{
				DomainManager.World.GetMonthlyNotificationCollection().AddYixiangvBringDisaster(nextLocation);
			}
		}

		// Token: 0x06007246 RID: 29254 RVA: 0x0041F874 File Offset: 0x0041DA74
		private void XuefengMovement(DataContext context, Character character)
		{
			Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			Location srcLocation = character.GetLocation();
			Location nextLocation = CharacterDomain.CalcXiangshuMovementNextBlock(srcLocation, taiwuVillageLocation, true, false);
			bool flag = !srcLocation.Equals(nextLocation);
			if (flag)
			{
				character.SetLocation(nextLocation, context);
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, nextLocation);
			}
			else
			{
				DomainManager.Building.XiangshuDestroyTaiwuVillageBuilding(context, nextLocation);
			}
			DomainManager.Taiwu.UpdateSwordTombKeepersOnXiangshuAvatarMoved(context, character, nextLocation);
			List<MapBlockData> neighborBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
			DomainManager.Adventure.GetValidBlocksForRandomEnemy(nextLocation.AreaId, nextLocation.BlockId, 1, true, false, true, neighborBlocks);
			int minionBaseTemplateId = 298 + (int)DomainManager.World.GetXiangshuLevel();
			for (int i = 0; i < 3; i++)
			{
				short minionTemplateId = (short)Math.Clamp(context.Random.Next(minionBaseTemplateId - 1, minionBaseTemplateId + 2), 298, 306);
				DomainManager.Adventure.CreateTemporaryEnemiesOnValidBlocks(context, Location.Invalid, minionTemplateId, 1, neighborBlocks, sbyte.MinValue);
			}
			context.AdvanceMonthRelatedData.Blocks.Release(ref neighborBlocks);
			DomainManager.World.GetMonthlyNotificationCollection().AddXuefengBringDisaster(nextLocation);
		}

		// Token: 0x06007247 RID: 29255 RVA: 0x0041F9A0 File Offset: 0x0041DBA0
		private void ShufangMovement(DataContext context, Character character)
		{
			Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
			Location taiwuLocation = taiwuChar.GetLocation();
			Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			Location srcLocation = character.GetLocation();
			Location nextLocation = CharacterDomain.CalcXiangshuMovementNextBlock(srcLocation, taiwuVillageLocation, true, false);
			bool flag = !srcLocation.Equals(nextLocation);
			if (flag)
			{
				character.SetLocation(nextLocation, context);
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, nextLocation);
			}
			else
			{
				DomainManager.Building.XiangshuDestroyTaiwuVillageBuilding(context, nextLocation);
			}
			DomainManager.Taiwu.UpdateSwordTombKeepersOnXiangshuAvatarMoved(context, character, nextLocation);
			int targetCharId = this.GetRandomCharacterInRange(context, nextLocation, 2, true);
			bool flag2 = targetCharId < 0;
			if (!flag2)
			{
				Character targetChar = this._objects[targetCharId];
				short oldAge = targetChar.GetCurrAge();
				short newAge = oldAge + 1;
				targetChar.SetCurrAge(newAge, context);
				Events.RaiseCharacterAgeChanged(context, targetChar, (int)oldAge, (int)newAge);
				int date = DomainManager.World.GetCurrDate();
				DomainManager.LifeRecord.GetLifeRecordCollection().AddShufangBad(targetCharId, date, nextLocation);
				DomainManager.World.GetMonthlyNotificationCollection().AddShuFangvBringDisaster(nextLocation, targetCharId);
				short newClothingTemplateId = -1;
				bool flag3 = newAge == 16;
				if (flag3)
				{
					OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(targetChar.GetOrganizationInfo());
					newClothingTemplateId = OrganizationDomain.GetRandomOrgMemberClothing(context.Random, orgMemberCfg);
				}
				else
				{
					bool flag4 = (int)newAge == GlobalConfig.Instance.AgeBaby;
					if (flag4)
					{
						newClothingTemplateId = 65;
					}
				}
				bool flag5 = newClothingTemplateId >= 0;
				if (flag5)
				{
					targetChar.ForceReplaceClothing(context, newClothingTemplateId);
				}
			}
		}

		// Token: 0x06007248 RID: 29256 RVA: 0x0041FB1C File Offset: 0x0041DD1C
		private static void UpdateJuniorXiangshuTravelTarget(DataContext context, Character character, int duration, Func<short> getArea)
		{
			List<NpcTravelTarget> travelTargets = character.GetNpcTravelTargets();
			bool flag = travelTargets.Count > 0;
			if (flag)
			{
				NpcTravelTarget travelTarget = travelTargets[0];
				travelTarget.RemainingMonth--;
				bool flag2 = travelTarget.RemainingMonth <= 0;
				if (flag2)
				{
					travelTargets.RemoveAt(0);
				}
				else
				{
					travelTargets[0] = travelTarget;
				}
				character.SetNpcTravelTargets(travelTargets, context);
			}
			bool flag3 = travelTargets.Count <= 0;
			if (flag3)
			{
				short selectedAreaId = getArea();
				Location targetLocation = new Location(selectedAreaId, -1);
				NpcTravelTarget travelTarget2 = new NpcTravelTarget(targetLocation, duration);
				character.AddTravelTarget(context, travelTarget2);
			}
		}

		// Token: 0x06007249 RID: 29257 RVA: 0x0041FBBC File Offset: 0x0041DDBC
		private static Location SelectJuniorXiangshuNextBlock(IRandomSource random, short areaId, Predicate<MapBlockData> predicate)
		{
			List<MapBlockData> validBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
			bool flag = predicate == null;
			Location result;
			if (flag)
			{
				DomainManager.Map.GetPassableBlocksInArea(areaId, validBlocks);
				short blockId = validBlocks[random.Next(validBlocks.Count)].BlockId;
				ObjectPool<List<MapBlockData>>.Instance.Return(validBlocks);
				result = new Location(areaId, blockId);
			}
			else
			{
				predicate = (Predicate<MapBlockData>)Delegate.Combine(predicate, new Predicate<MapBlockData>(MapBlockDataMatchers.IsValidForJuniorXiangshu));
				DomainManager.Map.GetMapBlocksInAreaByFilters(areaId, predicate, validBlocks);
				bool flag2 = validBlocks.Count <= 0;
				if (flag2)
				{
					ObjectPool<List<MapBlockData>>.Instance.Return(validBlocks);
					result = Location.Invalid;
				}
				else
				{
					Location nextLocation = new Location(areaId, validBlocks.GetRandom(random).BlockId);
					ObjectPool<List<MapBlockData>>.Instance.Return(validBlocks);
					result = nextLocation;
				}
			}
			return result;
		}

		// Token: 0x0600724A RID: 29258 RVA: 0x0041FC90 File Offset: 0x0041DE90
		private static Location SelectJuniorXiangshuRandomNextBlock(DataContext context, Location srcLocation)
		{
			List<MapBlockData> validBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
			DomainManager.Adventure.GetValidBlocksForRandomEnemy(srcLocation.AreaId, srcLocation.BlockId, 3, false, false, true, validBlocks);
			short blockId = (validBlocks.Count == 0) ? srcLocation.BlockId : validBlocks.GetRandom(context.Random).BlockId;
			context.AdvanceMonthRelatedData.Blocks.Release(ref validBlocks);
			return new Location(srcLocation.AreaId, blockId);
		}

		// Token: 0x0600724B RID: 29259 RVA: 0x0041FD10 File Offset: 0x0041DF10
		private void UpdateJuniorXiangshuFollowingTarget(DataContext context, Character character, int duration, Func<Character, int> selectValue)
		{
			List<NpcTravelTarget> travelTargets = character.GetNpcTravelTargets();
			bool flag = travelTargets.Count > 0;
			if (flag)
			{
				NpcTravelTarget travelTarget = travelTargets[0];
				travelTarget.RemainingMonth--;
				Character targetChar;
				bool flag2 = travelTarget.RemainingMonth <= 0 || !this.TryGetElement_Objects(travelTarget.TargetCharId, out targetChar) || (!targetChar.GetLocation().IsValid() && !targetChar.IsCrossAreaTraveling()) || DomainManager.Taiwu.IsInGroup(targetChar.GetId()) || targetChar.GetCreatingType() != 1;
				if (flag2)
				{
					travelTargets.RemoveAt(0);
				}
				else
				{
					travelTargets[0] = travelTarget;
				}
				character.SetNpcTravelTargets(travelTargets, context);
			}
			bool flag3 = travelTargets.Count <= 0;
			if (flag3)
			{
				int targetCharId = this.SelectJuniorXiangshuFollowingCharacter(context.Random, selectValue);
				bool flag4 = targetCharId < 0;
				if (!flag4)
				{
					NpcTravelTarget travelTarget2 = new NpcTravelTarget(targetCharId, duration);
					character.AddTravelTarget(context, travelTarget2);
				}
			}
		}

		// Token: 0x0600724C RID: 29260 RVA: 0x0041FE08 File Offset: 0x0041E008
		private int SelectJuniorXiangshuFollowingCharacter(IRandomSource random, Func<Character, int> selectValue)
		{
			int maxVal = int.MinValue;
			List<int> maxValueCharIds = ObjectPool<List<int>>.Instance.Get();
			maxValueCharIds.Clear();
			CharacterMatcherItem matcher = CharacterMatcher.DefValue.JuniorXiangshuFollowingCharacter;
			foreach (KeyValuePair<int, Character> pair in this._objects)
			{
				Character targetChar = pair.Value;
				bool flag = !matcher.Match(targetChar);
				if (!flag)
				{
					int val = selectValue(targetChar);
					bool flag2 = val > maxVal;
					if (flag2)
					{
						maxVal = val;
						maxValueCharIds.Clear();
						maxValueCharIds.Add(pair.Key);
					}
					else
					{
						bool flag3 = val == maxVal;
						if (flag3)
						{
							maxValueCharIds.Add(pair.Key);
						}
					}
				}
			}
			bool flag4 = maxValueCharIds.Count <= 0;
			int result;
			if (flag4)
			{
				result = -1;
			}
			else
			{
				int targetCharId = maxValueCharIds.GetRandom(random);
				ObjectPool<List<int>>.Instance.Return(maxValueCharIds);
				result = targetCharId;
			}
			return result;
		}

		// Token: 0x0600724D RID: 29261 RVA: 0x0041FF14 File Offset: 0x0041E114
		private bool CheckJuniorXiangshuAvatarForbidMovement(Character character)
		{
			bool flag = character.GetXiangshuType() != 3;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				sbyte xiangshuAvatarId = XiangshuAvatarIds.GetXiangshuAvatarIdByCharacterTemplateId(character.GetTemplateId());
				XiangshuAvatarTaskStatus status = DomainManager.World.GetElement_XiangshuAvatarTaskStatuses((int)xiangshuAvatarId);
				short favorability = DomainManager.World.GetXiangshuAvatarFavorability(xiangshuAvatarId);
				result = (status.JuniorXiangshuTaskStatus <= 4 && FavorabilityType.GetFavorabilityType(favorability) >= 5);
			}
			return result;
		}

		// Token: 0x0600724E RID: 29262 RVA: 0x0041FF7C File Offset: 0x0041E17C
		private unsafe void JuniorMonvMovement(DataContext context, Character character)
		{
			bool flag = this.CheckJuniorXiangshuAvatarForbidMovement(character);
			if (!flag)
			{
				Location srcLocation = character.GetLocation();
				CharacterDomain.UpdateJuniorXiangshuTravelTarget(context, character, 6, () => (short)context.Random.Next(45));
				short areaId = character.GetNpcTravelTargets()[0].GetRealTargetLocation().AreaId;
				Location nextLocation = CharacterDomain.SelectJuniorXiangshuNextBlock(context.Random, areaId, (MapBlockData block) => block.BlockType == EMapBlockType.Developed);
				bool flag2 = !nextLocation.IsValid();
				if (flag2)
				{
					nextLocation = CharacterDomain.SelectJuniorXiangshuRandomNextBlock(context, srcLocation);
				}
				bool flag3 = !srcLocation.Equals(nextLocation);
				if (flag3)
				{
					Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), character.GetLocation(), nextLocation);
					character.SetLocation(nextLocation, context);
				}
				int targetCharId = this.GetRandomCharacterInRange(context, nextLocation, 2, true);
				bool flag4 = targetCharId < 0;
				if (!flag4)
				{
					Character selectedChar = this._objects[targetCharId];
					Injuries injuries = selectedChar.GetInjuries();
					this.GetOrHealRandomInjuriesWithoutChecking(context.Random, ref injuries, -6, -3);
					selectedChar.SetInjuries(injuries, context);
					PoisonInts poisoned = *selectedChar.GetPoisoned();
					this.GetOrDetoxRandomPoisonsWithoutChecking(context.Random, ref poisoned, 3, -300, -100);
					selectedChar.SetPoisoned(ref poisoned, context);
					int date = DomainManager.World.GetCurrDate();
					DomainManager.LifeRecord.GetLifeRecordCollection().AddMonvGood(targetCharId, date, nextLocation);
					DomainManager.World.GetMonthlyNotificationCollection().AddMonvSaveSuffering(targetCharId, nextLocation);
				}
			}
		}

		// Token: 0x0600724F RID: 29263 RVA: 0x00420138 File Offset: 0x0041E338
		private unsafe void JuniorDayueYaochangMovement(DataContext context, Character character)
		{
			bool flag = this.CheckJuniorXiangshuAvatarForbidMovement(character);
			if (!flag)
			{
				Span<int> span = new Span<int>(stackalloc byte[(UIntPtr)540], 135);
				Span<int> areaInfectedCounts = span;
				areaInfectedCounts.Fill(0);
				foreach (int infectedCharId in this._infectedCharSet)
				{
					Character infectedChar = this._objects[infectedCharId];
					Location infectedCharLocation = infectedChar.GetLocation();
					bool flag2 = infectedCharLocation.IsValid() && infectedCharLocation.AreaId < 135 && !DomainManager.Map.GetBlock(infectedCharLocation).IsCityTown();
					if (flag2)
					{
						(*areaInfectedCounts[(int)infectedCharLocation.AreaId])++;
					}
				}
				Location srcLocation = character.GetLocation();
				List<NpcTravelTarget> travelTargets = character.GetNpcTravelTargets();
				bool flag3 = travelTargets.Count > 0;
				if (flag3)
				{
					NpcTravelTarget travelTarget = travelTargets[0];
					travelTarget.RemainingMonth--;
					bool flag4 = travelTarget.RemainingMonth <= 0 || *areaInfectedCounts[(int)srcLocation.AreaId] == 0;
					if (flag4)
					{
						travelTargets.RemoveAt(0);
					}
					else
					{
						travelTargets[0] = travelTarget;
					}
					character.SetNpcTravelTargets(travelTargets, context);
				}
				bool flag5 = travelTargets.Count <= 0;
				if (flag5)
				{
					short maxCountAreaId = (short)CollectionUtils.GetMaxIndex(areaInfectedCounts);
					bool flag6 = *areaInfectedCounts[(int)maxCountAreaId] == 0;
					if (flag6)
					{
						maxCountAreaId = srcLocation.AreaId;
					}
					Location targetLocation = new Location(maxCountAreaId, -1);
					NpcTravelTarget travelTarget2 = new NpcTravelTarget(targetLocation, 6);
					character.AddTravelTarget(context, travelTarget2);
				}
				Location nextLocation = travelTargets[0].GetRealTargetLocation();
				bool flag7 = srcLocation.AreaId != nextLocation.AreaId || DomainManager.Map.GetBlock(srcLocation).InfectedCharacterSet == null;
				if (flag7)
				{
					Span<MapBlockData> areaBlocks = DomainManager.Map.GetAreaBlocks(nextLocation.AreaId);
					short maxInfectedBlockId = -1;
					int maxInfectedCount = 0;
					Span<MapBlockData> span2 = areaBlocks;
					for (int i = 0; i < span2.Length; i++)
					{
						MapBlockData areaBlock = *span2[i];
						bool flag8 = areaBlock.IsCityTown();
						if (!flag8)
						{
							bool flag9 = areaBlock.InfectedCharacterSet == null || areaBlock.InfectedCharacterSet.Count <= maxInfectedCount;
							if (!flag9)
							{
								maxInfectedCount = areaBlock.InfectedCharacterSet.Count;
								maxInfectedBlockId = areaBlock.BlockId;
							}
						}
					}
					nextLocation = ((maxInfectedCount == 0) ? CharacterDomain.SelectJuniorXiangshuRandomNextBlock(context, srcLocation) : new Location(nextLocation.AreaId, maxInfectedBlockId));
				}
				else
				{
					nextLocation = srcLocation;
				}
				bool flag10 = !srcLocation.Equals(nextLocation);
				if (flag10)
				{
					Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), character.GetLocation(), nextLocation);
					character.SetLocation(nextLocation, context);
				}
				MapBlockData currBlock = DomainManager.Map.GetBlock(nextLocation);
				bool flag11 = currBlock.InfectedCharacterSet == null || currBlock.InfectedCharacterSet.Count == 0;
				if (!flag11)
				{
					List<int> charIds = context.AdvanceMonthRelatedData.CharIdList.Occupy();
					charIds.AddRange(currBlock.InfectedCharacterSet);
					foreach (int charId in charIds)
					{
						DomainManager.World.GetMonthlyNotificationCollection().AddDayueYaochangSaveSuffering(charId, nextLocation);
						this.MakeCharacterDead(context, this._objects[charId], 13);
					}
					context.AdvanceMonthRelatedData.CharIdList.Release(ref charIds);
				}
			}
		}

		// Token: 0x06007250 RID: 29264 RVA: 0x004204D0 File Offset: 0x0041E6D0
		private void JuniorJiuhanMovement(DataContext context, Character character)
		{
			bool flag = this.CheckJuniorXiangshuAvatarForbidMovement(character);
			if (!flag)
			{
				Location srcLocation = character.GetLocation();
				CharacterDomain.UpdateJuniorXiangshuTravelTarget(context, character, 6, () => (short)context.Random.Next(45));
				short areaId = character.GetNpcTravelTargets()[0].GetRealTargetLocation().AreaId;
				Location nextLocation = CharacterDomain.SelectJuniorXiangshuNextBlock(context.Random, areaId, (MapBlockData block) => block.BlockType == EMapBlockType.Wild);
				bool flag2 = !nextLocation.IsValid();
				if (flag2)
				{
					nextLocation = CharacterDomain.SelectJuniorXiangshuRandomNextBlock(context, srcLocation);
				}
				bool flag3 = !srcLocation.Equals(nextLocation);
				if (flag3)
				{
					Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), character.GetLocation(), nextLocation);
					character.SetLocation(nextLocation, context);
				}
				List<MapBlockData> neighborBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
				DomainManager.Map.GetRealNeighborBlocks(nextLocation.AreaId, nextLocation.BlockId, neighborBlocks, 1, true);
				foreach (MapBlockData block2 in neighborBlocks)
				{
					block2.CurrResources = block2.MaxResources;
					DomainManager.Map.SetBlockData(context, block2);
				}
				context.AdvanceMonthRelatedData.Blocks.Release(ref neighborBlocks);
				DomainManager.World.GetMonthlyNotificationCollection().AddJiuhanvSaveSuffering(nextLocation);
			}
		}

		// Token: 0x06007251 RID: 29265 RVA: 0x0042067C File Offset: 0x0041E87C
		private unsafe void JuniorJinHuangerMovement(DataContext context, Character character)
		{
			bool flag = this.CheckJuniorXiangshuAvatarForbidMovement(character);
			if (!flag)
			{
				Location srcLocation = character.GetLocation();
				this.UpdateJuniorXiangshuFollowingTarget(context, character, 12, (Character targetChar) => (int)targetChar.GetFame());
				List<NpcTravelTarget> travelTargets = character.GetNpcTravelTargets();
				bool flag2 = travelTargets.Count < 0;
				if (!flag2)
				{
					Location targetLocation = travelTargets[0].GetRealTargetLocation();
					bool flag3 = !targetLocation.IsValid();
					if (!flag3)
					{
						List<MapBlockData> neighborBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
						DomainManager.Map.GetRealNeighborBlocks(targetLocation.AreaId, targetLocation.BlockId, neighborBlocks, 2, true);
						MapBlockData nextLocationBlock = neighborBlocks.GetRandom(context.Random);
						context.AdvanceMonthRelatedData.Blocks.Release(ref neighborBlocks);
						Location nextLocation = new Location(nextLocationBlock.AreaId, nextLocationBlock.BlockId);
						bool flag4 = !srcLocation.Equals(nextLocation);
						if (flag4)
						{
							Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), character.GetLocation(), nextLocation);
							character.SetLocation(nextLocation, context);
						}
						bool flag5 = !context.Random.CheckPercentProb(40);
						if (!flag5)
						{
							int selectedCharId = this.GetRandomCharacterInRange(context, nextLocation, 2, true);
							bool flag6 = selectedCharId < 0;
							if (!flag6)
							{
								List<int> charIds = context.AdvanceMonthRelatedData.CharIdList.Occupy();
								charIds.Add(selectedCharId);
								Span<int> span = new Span<int>(stackalloc byte[(UIntPtr)28], 7);
								Span<int> resultIndices = span;
								RandomUtils.GetRandomUnrepeated(context.Random, 0, 6, resultIndices);
								for (int i = 0; i < 7; i++)
								{
									int randNum = *resultIndices[i];
									if (!true)
									{
									}
									int num;
									switch (randNum)
									{
									case 0:
										num = this.ApplyLucky_Resource(context, charIds, 1, 100);
										break;
									case 1:
										num = this.ApplyLucky_Item(context, charIds, 1, 2, 100);
										break;
									case 2:
										num = this.ApplyLucky_Item(context, charIds, 1, 0, 100);
										break;
									case 3:
										num = this.ApplyLucky_Item(context, charIds, 1, 1, 100);
										break;
									case 4:
										num = this.ApplyLucky_CombatSkillBook(context, charIds, 1, 100);
										break;
									case 5:
										num = this.ApplyLucky_LifeSkillBook(context, charIds, 1, 100);
										break;
									case 6:
										num = this.ApplyLucky_Regen(context, charIds, 1, 100);
										break;
									default:
										num = 0;
										break;
									}
									if (!true)
									{
									}
									int luckyAmount = num;
									bool flag7 = luckyAmount > 0;
									if (flag7)
									{
										int date = DomainManager.World.GetCurrDate();
										DomainManager.LifeRecord.GetLifeRecordCollection().AddJinHuangerGood(selectedCharId, date, nextLocation);
										DomainManager.World.GetMonthlyNotificationCollection().AddJinHuangervSaveSuffering(selectedCharId, nextLocation);
										break;
									}
								}
								context.AdvanceMonthRelatedData.CharIdList.Release(ref charIds);
							}
						}
					}
				}
			}
		}

		// Token: 0x06007252 RID: 29266 RVA: 0x00420940 File Offset: 0x0041EB40
		private void JuniorYiyihouMovement(DataContext context, Character character)
		{
			bool flag = this.CheckJuniorXiangshuAvatarForbidMovement(character);
			if (!flag)
			{
				Location srcLocation = character.GetLocation();
				CharacterDomain.UpdateJuniorXiangshuTravelTarget(context, character, 3, delegate
				{
					sbyte randomStateId = (sbyte)context.Random.Next(MapState.Instance.Count - 1);
					MapStateItem stateCfg = MapState.Instance[(int)(randomStateId + 1)];
					List<short> areaIds = ObjectPool<List<short>>.Instance.Get();
					areaIds.Clear();
					int regularAreasPerState = 3;
					for (int i = 0; i < regularAreasPerState; i++)
					{
						short areaId2 = (short)((int)randomStateId * regularAreasPerState + i);
						bool flag4 = areaId2 != (short)stateCfg.MainAreaID && areaId2 != (short)stateCfg.SectAreaID;
						if (flag4)
						{
							areaIds.Add(areaId2);
						}
					}
					return areaIds.GetRandom(context.Random);
				});
				short areaId = character.GetNpcTravelTargets()[0].GetRealTargetLocation().AreaId;
				Location nextLocation = CharacterDomain.SelectJuniorXiangshuNextBlock(context.Random, areaId, (MapBlockData block) => block.IsPassable());
				bool flag2 = !nextLocation.IsValid();
				if (flag2)
				{
					nextLocation = CharacterDomain.SelectJuniorXiangshuRandomNextBlock(context, srcLocation);
				}
				bool flag3 = !srcLocation.Equals(nextLocation);
				if (flag3)
				{
					Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), character.GetLocation(), nextLocation);
					character.SetLocation(nextLocation, context);
				}
				DomainManager.World.GetMonthlyNotificationCollection().AddYiYihouvSaveSuffering(nextLocation);
			}
		}

		// Token: 0x06007253 RID: 29267 RVA: 0x00420A40 File Offset: 0x0041EC40
		private void JuniorWeiQiMovement(DataContext context, Character character)
		{
			bool flag = this.CheckJuniorXiangshuAvatarForbidMovement(character);
			if (!flag)
			{
				Location srcLocation = character.GetLocation();
				this.UpdateJuniorXiangshuFollowingTarget(context, character, 3, (Character targetChar) => (int)Math.Max(targetChar.GetLifeSkillAttainment(12), targetChar.GetLifeSkillAttainment(13)));
				List<NpcTravelTarget> travelTargets = character.GetNpcTravelTargets();
				bool flag2 = travelTargets.Count < 0;
				if (flag2)
				{
					this.SetAvoidDeathCharId(-1, context);
				}
				else
				{
					this.SetAvoidDeathCharId(travelTargets[0].TargetCharId, context);
					Location targetLocation = travelTargets[0].GetRealTargetLocation();
					bool flag3 = !targetLocation.IsValid();
					if (!flag3)
					{
						this.FixedCharacterMoveInRange(context, character, targetLocation, 2);
					}
				}
			}
		}

		// Token: 0x06007254 RID: 29268 RVA: 0x00420AF0 File Offset: 0x0041ECF0
		private void JuniorYixiangMovement(DataContext context, Character character)
		{
			bool flag = this.CheckJuniorXiangshuAvatarForbidMovement(character);
			if (!flag)
			{
				Location srcLocation = character.GetLocation();
				CharacterDomain.UpdateJuniorXiangshuTravelTarget(context, character, 3, delegate
				{
					sbyte randomSectId = OrganizationDomain.GetRandomSectOrgTemplateId(context.Random, -1);
					Settlement settlement = DomainManager.Organization.GetSettlementByOrgTemplateId(randomSectId);
					return settlement.GetLocation().AreaId;
				});
				short areaId = character.GetNpcTravelTargets()[0].GetRealTargetLocation().AreaId;
				Location nextLocation = CharacterDomain.SelectJuniorXiangshuNextBlock(context.Random, areaId, (MapBlockData block) => block.IsPassable());
				bool flag2 = !nextLocation.IsValid();
				if (flag2)
				{
					nextLocation = CharacterDomain.SelectJuniorXiangshuRandomNextBlock(context, srcLocation);
				}
				bool flag3 = !srcLocation.Equals(nextLocation);
				if (flag3)
				{
					Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), character.GetLocation(), nextLocation);
					character.SetLocation(nextLocation, context);
				}
				DomainManager.World.GetMonthlyNotificationCollection().AddYixiangvSaveSuffering(nextLocation);
			}
		}

		// Token: 0x06007255 RID: 29269 RVA: 0x00420BF0 File Offset: 0x0041EDF0
		private void JuniorXuefengMovement(DataContext context, Character character)
		{
			bool flag = this.CheckJuniorXiangshuAvatarForbidMovement(character);
			if (!flag)
			{
				Location srcLocation = character.GetLocation();
				this.UpdateJuniorXiangshuFollowingTarget(context, character, 3, (Character targetChar) => (int)(-(int)targetChar.GetFame()));
				List<NpcTravelTarget> travelTargets = character.GetNpcTravelTargets();
				bool flag2 = travelTargets.Count < 0;
				if (!flag2)
				{
					int targetCharId = travelTargets[0].TargetCharId;
					Character targetChar2 = this._objects[targetCharId];
					Location targetLocation = travelTargets[0].GetRealTargetLocation();
					bool flag3 = !targetLocation.IsValid() || targetChar2.IsCrossAreaTraveling();
					if (!flag3)
					{
						this.FixedCharacterMoveInRange(context, character, targetLocation, 2);
						bool flag4 = targetChar2.GetLocation().IsValid();
						if (flag4)
						{
							DomainManager.Character.SimulateCharacterCombat(context, character, targetChar2, CombatType.Beat, true, 5);
							int date = DomainManager.World.GetCurrDate();
							DomainManager.LifeRecord.GetLifeRecordCollection().AddXuefengGood(targetCharId, date, targetLocation);
							DomainManager.World.GetMonthlyNotificationCollection().AddXuefengSaveSuffering(targetCharId, targetLocation);
						}
					}
				}
			}
		}

		// Token: 0x06007256 RID: 29270 RVA: 0x00420D08 File Offset: 0x0041EF08
		private void JuniorShuFangMovement(DataContext context, Character character)
		{
			bool flag = this.CheckJuniorXiangshuAvatarForbidMovement(character);
			if (!flag)
			{
				Location srcLocation = character.GetLocation();
				this.UpdateJuniorXiangshuFollowingTarget(context, character, 12, (Character targetChar) => Math.Abs((int)(targetChar.GetHappinessType() - 3)));
				Location nextLocation = srcLocation;
				List<NpcTravelTarget> travelTargets = character.GetNpcTravelTargets();
				Location targetLocation = (travelTargets.Count > 0) ? travelTargets[0].GetRealTargetLocation() : Location.Invalid;
				bool flag2 = targetLocation.IsValid();
				if (flag2)
				{
					nextLocation = this.FixedCharacterMoveInRange(context, character, targetLocation, 2);
				}
				bool flag3 = context.Random.NextBool();
				if (!flag3)
				{
					Location taiwuLocation = DomainManager.Taiwu.GetTaiwu().GetLocation();
					List<int> charIds = context.AdvanceMonthRelatedData.CharIdList.Occupy();
					List<MapBlockData> neighborBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
					DomainManager.Map.GetRealNeighborBlocks(nextLocation.AreaId, nextLocation.BlockId, neighborBlocks, 2, true);
					foreach (MapBlockData block in neighborBlocks)
					{
						bool flag4 = block.CharacterSet != null;
						if (flag4)
						{
							foreach (int charId in block.CharacterSet)
							{
								bool flag5 = this._objects[charId].GetCurrAge() > 16;
								if (flag5)
								{
									charIds.Add(charId);
								}
							}
						}
						bool flag6 = block.AreaId == taiwuLocation.AreaId && block.BlockId == taiwuLocation.BlockId;
						if (flag6)
						{
							HashSet<int> taiwuGroupCharIds = DomainManager.Taiwu.GetGroupCharIds().GetCollection();
							foreach (int charId2 in taiwuGroupCharIds)
							{
								bool flag7 = this._objects[charId2].GetCurrAge() > 16;
								if (flag7)
								{
									charIds.Add(charId2);
								}
							}
						}
					}
					int targetCharId = charIds.GetRandomOrDefault(context.Random, -1);
					context.AdvanceMonthRelatedData.CharIdList.Release(ref charIds);
					context.AdvanceMonthRelatedData.Blocks.Release(ref neighborBlocks);
					bool flag8 = targetCharId < 0;
					if (!flag8)
					{
						Character targetChar2 = this._objects[targetCharId];
						short oldAge = targetChar2.GetCurrAge();
						short newAge = oldAge - 1;
						targetChar2.SetCurrAge(newAge, context);
						Events.RaiseCharacterAgeChanged(context, targetChar2, (int)oldAge, (int)newAge);
						int date = DomainManager.World.GetCurrDate();
						DomainManager.LifeRecord.GetLifeRecordCollection().AddShufangGood(targetCharId, date, nextLocation);
						DomainManager.World.GetMonthlyNotificationCollection().AddShuFangvSaveSuffering(targetCharId, nextLocation);
					}
				}
			}
		}

		// Token: 0x06007257 RID: 29271 RVA: 0x00421034 File Offset: 0x0041F234
		private void ZiWuxiaoMovement(DataContext context, Character character)
		{
			Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			this.FixedCharacterMoveInRange(context, character, taiwuVillageLocation, 3);
		}

		// Token: 0x06007258 RID: 29272 RVA: 0x00421058 File Offset: 0x0041F258
		private void RanchenziMovement(DataContext context, Character character)
		{
			Character wuxiao;
			bool flag = !DomainManager.Character.TryGetFixedCharacterByTemplateId(447, out wuxiao);
			if (!flag)
			{
				Location wuxiaoLocation = wuxiao.GetLocation();
				bool flag2 = !wuxiaoLocation.IsValid();
				if (!flag2)
				{
					this.FixedCharacterMoveInRange(context, character, wuxiaoLocation, 2);
				}
			}
		}

		// Token: 0x06007259 RID: 29273 RVA: 0x004210A4 File Offset: 0x0041F2A4
		private void LongYufuMovement(DataContext context, Character character)
		{
			Character ranchenzi;
			bool flag = !DomainManager.Character.TryGetFixedCharacterByTemplateId(441, out ranchenzi);
			if (!flag)
			{
				Location ranchenziLocation = ranchenzi.GetLocation();
				bool flag2 = !ranchenziLocation.IsValid();
				if (!flag2)
				{
					this.FixedCharacterMoveInRange(context, character, ranchenziLocation, 2);
				}
			}
		}

		// Token: 0x0600725A RID: 29274 RVA: 0x004210F0 File Offset: 0x0041F2F0
		private void FulongReudhLazuliMovement(DataContext context, Character character)
		{
			EventArgBox argBox = DomainManager.Extra.GetSectMainStoryEventArgBox(14);
			bool fulongReudhLazuliAi2 = false;
			argBox.Get("ConchShip_PresetKey_FulongReudhLazuliAI2", ref fulongReudhLazuliAi2);
			bool flag = fulongReudhLazuliAi2;
			if (flag)
			{
				bool flag2 = DomainManager.Extra.IsExtraTaskInProgress(344);
				if (flag2)
				{
					this.FulongReudhLazuliMovementDependMonv(context, character);
				}
			}
			else
			{
				Settlement settlement = DomainManager.Organization.GetSettlementByOrgTemplateId(14);
				this.FixedCharacterMoveInSettlementRange(context, character, settlement.GetLocation());
			}
		}

		// Token: 0x0600725B RID: 29275 RVA: 0x00421168 File Offset: 0x0041F368
		public void FulongReudhLazuliMovementDependMonv(DataContext context, Character character)
		{
			Character monv = null;
			Location targetLocation = Location.Invalid;
			Character juniorMonv;
			DomainManager.Character.TryGetFixedCharacterByTemplateId(39, out juniorMonv);
			bool flag = juniorMonv != null && juniorMonv.GetLocation().AreaId == DomainManager.Taiwu.GetTaiwuVillageLocation().AreaId;
			if (flag)
			{
				monv = juniorMonv;
			}
			for (short i = 129; i <= 137; i += 1)
			{
				Character weakenedMonv;
				DomainManager.Character.TryGetFixedCharacterByTemplateId(i, out weakenedMonv);
				bool flag2 = weakenedMonv != null && weakenedMonv.GetLocation().AreaId == DomainManager.Taiwu.GetTaiwuVillageLocation().AreaId;
				if (flag2)
				{
					monv = weakenedMonv;
					break;
				}
			}
			bool flag3 = monv != null;
			if (flag3)
			{
				List<MapBlockData> nearBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
				nearBlocks.Clear();
				DomainManager.Map.GetLocationByDistance(monv.GetLocation(), 1, 1, ref nearBlocks);
				MapBlockData targetBlock = nearBlocks.GetRandom(context.Random);
				targetLocation = targetBlock.GetLocation();
				ObjectPool<List<MapBlockData>>.Instance.Return(nearBlocks);
			}
			sbyte xiangshuAvatarId = XiangshuAvatarIds.GetXiangshuAvatarIdByCharacterTemplateId(39);
			XiangshuAvatarTaskStatus status = DomainManager.World.GetElement_XiangshuAvatarTaskStatuses((int)xiangshuAvatarId);
			bool flag4 = status.SwordTombStatus < 2;
			if (flag4)
			{
				for (int j = 1; j < 8; j++)
				{
					Location location = DomainManager.Map.GetElement_SwordTombLocations(j);
					MapBlockData mapBlockData = DomainManager.Map.GetBlockData(location.AreaId, location.BlockId);
					bool flag5 = mapBlockData.GetConfig().TemplateId == 128;
					if (flag5)
					{
						targetLocation = mapBlockData.GetLocation();
						break;
					}
				}
			}
			EventArgBox sectArgBox = DomainManager.Extra.GetSectMainStoryEventArgBox(14);
			bool fulongTravelWithLazuliMonvTalkTriggered = false;
			sectArgBox.Get("ConchShip_PresetKey_FulongTravelWithLazuliMonvTalkTriggered", ref fulongTravelWithLazuliMonvTalkTriggered);
			bool flag6 = !targetLocation.IsValid() || fulongTravelWithLazuliMonvTalkTriggered;
			if (flag6)
			{
				List<MapBlockData> nearBlocks2 = ObjectPool<List<MapBlockData>>.Instance.Get();
				nearBlocks2.Clear();
				Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
				DomainManager.Map.GetLocationByDistance(taiwuVillageLocation, 0, 2, ref nearBlocks2);
				MapBlockData targetBlock2 = nearBlocks2.GetRandom(context.Random);
				targetLocation = targetBlock2.GetLocation();
				ObjectPool<List<MapBlockData>>.Instance.Return(nearBlocks2);
			}
			bool flag7 = !character.GetLocation().Equals(targetLocation);
			if (flag7)
			{
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), character.GetLocation(), targetLocation);
				character.SetLocation(targetLocation, context);
			}
		}

		// Token: 0x0600725C RID: 29276 RVA: 0x004213C4 File Offset: 0x0041F5C4
		private void FulongReudhLazuliFeatherMovement(DataContext context, Character character)
		{
			bool flag = DomainManager.Extra.IsExtraTaskChainInProgress(52);
			if (!flag)
			{
				EventArgBox argBox = DomainManager.Extra.GetSectMainStoryEventArgBox(14);
				bool fulongReudhLazuliFeatherFollowOpen = false;
				argBox.Get("ConchShip_PresetKey_FulongReudhLazuliFeatherFollowOpen", ref fulongReudhLazuliFeatherFollowOpen);
				bool flag2 = fulongReudhLazuliFeatherFollowOpen;
				if (!flag2)
				{
					Location villageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
					this.FixedCharacterMoveInSettlementRange(context, character, villageLocation);
				}
			}
		}

		// Token: 0x0600725D RID: 29277 RVA: 0x00421420 File Offset: 0x0041F620
		private void BaihuaBaiLuXuanXiaoMovement(DataContext context, Character character)
		{
			EventArgBox argBox = DomainManager.Extra.GetSectMainStoryEventArgBox(3);
			bool flag = !argBox.Contains<int>("ConchShip_PresetKey_BaihuaAnimalsBackDate");
			if (!flag)
			{
				sbyte taskStatus = DomainManager.World.GetSectMainStoryTaskStatus(3);
				bool flag2 = taskStatus == 1;
				if (flag2)
				{
					Settlement baihuaSettlement = DomainManager.Organization.GetSettlementByOrgTemplateId(3);
					Location baihuaLocation = baihuaSettlement.GetLocation();
					this.FixedCharacterMoveInSettlement(context, character, baihuaLocation);
				}
				else
				{
					Location villageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
					this.FixedCharacterMoveInSettlementRange(context, character, villageLocation);
				}
			}
		}

		// Token: 0x0600725E RID: 29278 RVA: 0x004214A0 File Offset: 0x0041F6A0
		private void BaihuaLeMeMovement(DataContext context, Character character)
		{
			sbyte taskStatus = DomainManager.World.GetSectMainStoryTaskStatus(3);
			bool flag = taskStatus == 0;
			if (!flag)
			{
				Settlement baihuaSettlement = DomainManager.Organization.GetSettlementByOrgTemplateId(3);
				Location baihuaLocation = baihuaSettlement.GetLocation();
				this.FixedCharacterMoveInSettlement(context, character, baihuaLocation);
			}
		}

		// Token: 0x0600725F RID: 29279 RVA: 0x004214E4 File Offset: 0x0041F6E4
		private Location FixedCharacterMoveInRange(DataContext context, Character character, Location targetLocation, int maxSteps)
		{
			List<MapBlockData> neighborBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
			DomainManager.Map.GetRealNeighborBlocks(targetLocation.AreaId, targetLocation.BlockId, neighborBlocks, maxSteps, true);
			MapBlockData nextLocationBlock = neighborBlocks.GetRandom(context.Random);
			Location srcLocation = character.GetLocation();
			Location nextLocation = new Location(nextLocationBlock.AreaId, nextLocationBlock.BlockId);
			context.AdvanceMonthRelatedData.Blocks.Release(ref neighborBlocks);
			bool flag = !srcLocation.Equals(nextLocation);
			if (flag)
			{
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), character.GetLocation(), nextLocation);
				character.SetLocation(nextLocation, context);
			}
			return nextLocation;
		}

		// Token: 0x06007260 RID: 29280 RVA: 0x00421590 File Offset: 0x0041F790
		private void FixedCharacterMoveInSettlement(DataContext context, Character character, Location settlementLocation)
		{
			List<short> blockIds = context.AdvanceMonthRelatedData.BlockIds.Occupy();
			DomainManager.Map.GetSettlementBlocks(settlementLocation.AreaId, settlementLocation.BlockId, blockIds);
			Location srcLocation = character.GetLocation();
			short dstBlockId = blockIds.GetRandom(context.Random);
			Location dstLocation = new Location(srcLocation.AreaId, dstBlockId);
			context.AdvanceMonthRelatedData.BlockIds.Release(ref blockIds);
			bool flag = dstLocation != srcLocation;
			if (flag)
			{
				Tester.Assert(character.GetCreatingType() == 0, "");
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, dstLocation);
				character.SetLocation(dstLocation, context);
			}
		}

		// Token: 0x06007261 RID: 29281 RVA: 0x00421638 File Offset: 0x0041F838
		public void CullCanSelectBlocks(List<MapBlockData> blocks)
		{
			bool flag = blocks.Count <= 1;
			if (!flag)
			{
				int count = 0;
				foreach (MapBlockData block in blocks)
				{
					bool flag2 = FiveLoongDlcEntry.IsBlockLoongBlock(block);
					if (flag2)
					{
						count++;
					}
				}
				bool flag3 = count == blocks.Count;
				if (!flag3)
				{
					for (int i = blocks.Count - 1; i >= 0; i--)
					{
						bool flag4 = FiveLoongDlcEntry.IsBlockLoongBlock(blocks[i]);
						if (flag4)
						{
							blocks.RemoveAt(i);
						}
					}
					count = 0;
					foreach (MapBlockData block2 in blocks)
					{
						bool flag5 = block2.GetConfig().TemplateId == 124;
						if (flag5)
						{
							count++;
						}
					}
					bool flag6 = count == blocks.Count;
					if (!flag6)
					{
						for (int j = blocks.Count - 1; j >= 0; j--)
						{
							bool flag7 = blocks[j].GetConfig().TemplateId == 124;
							if (flag7)
							{
								blocks.RemoveAt(j);
							}
						}
						count = 0;
						foreach (MapBlockData block3 in blocks)
						{
							bool flag8 = block3.GetConfig().SubType == EMapBlockSubType.Ruin;
							if (flag8)
							{
								count++;
							}
						}
						bool flag9 = count == blocks.Count;
						if (!flag9)
						{
							for (int k = blocks.Count - 1; k >= 0; k--)
							{
								bool flag10 = blocks[k].GetConfig().SubType == EMapBlockSubType.Ruin;
								if (flag10)
								{
									blocks.RemoveAt(k);
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06007262 RID: 29282 RVA: 0x00421854 File Offset: 0x0041FA54
		private void FixedCharacterMoveInSettlementRange(DataContext context, Character character, Location settlementLocation)
		{
			List<MapBlockData> blocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
			DomainManager.Map.GetSettlementAffiliatedBlocks(settlementLocation.AreaId, settlementLocation.BlockId, blocks);
			this.CullCanSelectBlocks(blocks);
			Location srcLocation = character.GetLocation();
			Location dstLocation = blocks.GetRandom(context.Random).GetLocation();
			context.AdvanceMonthRelatedData.Blocks.Release(ref blocks);
			bool flag = dstLocation != srcLocation;
			if (flag)
			{
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, dstLocation);
				character.SetLocation(dstLocation, context);
			}
		}

		// Token: 0x06007263 RID: 29283 RVA: 0x004218E4 File Offset: 0x0041FAE4
		private void ImpersonatorBuddhistMonkMovement(DataContext context, Character character)
		{
			Location villageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			this.FixedCharacterMoveInSettlementRange(context, character, villageLocation);
		}

		// Token: 0x06007264 RID: 29284 RVA: 0x00421908 File Offset: 0x0041FB08
		private unsafe void TripodVesselOfMedicineMovement(DataContext context, Character character)
		{
			CharacterDomain.<>c__DisplayClass658_0 CS$<>8__locals1;
			CS$<>8__locals1.<>4__this = this;
			CS$<>8__locals1.context = context;
			int selfCharId = character.GetId();
			Location srcLocation = character.GetLocation();
			short medicineAttainment = character.GetLifeSkillAttainment(8);
			short toxicologyAttainment = character.GetLifeSkillAttainment(9);
			EventArgBox argBox = DomainManager.Extra.GetSectMainStoryEventArgBox(10);
			short targetAreaId = -1;
			bool flag = !argBox.Get("ConchShip_PresetKey_TripodVesselOfMedicineAreaId", ref targetAreaId) || targetAreaId < 0;
			if (!flag)
			{
				bool flag2 = srcLocation.AreaId != targetAreaId || DomainManager.Map.GetBelongSettlementBlock(srcLocation) == null;
				if (flag2)
				{
					MapAreaData areaData = DomainManager.Map.GetElement_Areas((int)targetAreaId);
					for (int i = 0; i < areaData.SettlementInfos.Length; i++)
					{
						SettlementInfo settlementInfo = areaData.SettlementInfos[i];
						bool flag3 = settlementInfo.SettlementId < 0;
						if (!flag3)
						{
							List<MapBlockData> blocks = CS$<>8__locals1.context.AdvanceMonthRelatedData.Blocks.Occupy();
							DomainManager.Map.GetSettlementAffiliatedBlocks(targetAreaId, settlementInfo.BlockId, blocks);
							bool flag4 = blocks.Count > 0;
							if (flag4)
							{
								MapBlockData targetBlock = blocks.GetRandom(CS$<>8__locals1.context.Random);
								Location dstLocation = targetBlock.GetLocation();
								Events.RaiseFixedCharacterLocationChanged(CS$<>8__locals1.context, selfCharId, srcLocation, dstLocation);
								character.SetLocation(dstLocation, CS$<>8__locals1.context);
								DomainManager.Map.SetBlockAndViewRangeVisible(CS$<>8__locals1.context, dstLocation.AreaId, dstLocation.BlockId);
							}
							CS$<>8__locals1.context.AdvanceMonthRelatedData.Blocks.Release(ref blocks);
							break;
						}
					}
				}
				CS$<>8__locals1.actionType = CharacterDomain.<TripodVesselOfMedicineMovement>g__SelectTripodVesselActionType|658_0(CS$<>8__locals1.context.Random, selfCharId);
				bool flag5 = CS$<>8__locals1.actionType < 0;
				if (!flag5)
				{
					DomainManager.Extra.AddAiActionCooldown(CS$<>8__locals1.context, selfCharId, 2, CS$<>8__locals1.actionType, 2);
					targetAreaId = character.GetLocation().AreaId;
					Span<MapBlockData> areaBlocks = DomainManager.Map.GetAreaBlocks(targetAreaId);
					Span<MapBlockData> span = areaBlocks;
					for (int j = 0; j < span.Length; j++)
					{
						MapBlockData block = *span[j];
						bool flag6 = block.CharacterSet == null;
						if (!flag6)
						{
							foreach (int charId in block.CharacterSet)
							{
								this.<TripodVesselOfMedicineMovement>g__ExecuteTripodVesselAction|658_1(charId, ref CS$<>8__locals1);
							}
						}
					}
					bool flag7 = DomainManager.Taiwu.GetTaiwu().GetLocation().AreaId == targetAreaId;
					if (flag7)
					{
						HashSet<int> taiwuGroupCharIds = DomainManager.Taiwu.GetGroupCharIds().GetCollection();
						foreach (int charId2 in taiwuGroupCharIds)
						{
							this.<TripodVesselOfMedicineMovement>g__ExecuteTripodVesselAction|658_1(charId2, ref CS$<>8__locals1);
						}
					}
					MonthlyNotificationCollection monthlyNotifications = DomainManager.World.GetMonthlyNotificationCollection();
					Location location = new Location(character.GetLocation().AreaId, -1);
					switch (CS$<>8__locals1.actionType)
					{
					case 0:
						monthlyNotifications.AddSectMainStoryKongsangTripodVesselCures(location);
						break;
					case 1:
						monthlyNotifications.AddSectMainStoryKongsangTripodVesselDetoxifies(location);
						break;
					case 2:
						monthlyNotifications.AddSectMainStoryKongsangTripodVesselRestoresHealth(location);
						break;
					case 3:
						monthlyNotifications.AddSectMainStoryKongsangTripodVesselRemovesQiDisorder(location);
						break;
					}
				}
			}
		}

		// Token: 0x06007265 RID: 29285 RVA: 0x00421C88 File Offset: 0x0041FE88
		private void WudangBlackSnakeMovement(DataContext context, Character character)
		{
			Settlement settlement = DomainManager.Organization.GetSettlementByOrgTemplateId(4);
			Location settlementLocation = settlement.GetLocation();
			List<short> blockIds = context.AdvanceMonthRelatedData.BlockIds.Occupy();
			DomainManager.Map.GetSettlementBlocksAndAffiliatedBlocks(settlementLocation.AreaId, settlementLocation.BlockId, blockIds);
			short blockId = blockIds.GetRandom(context.Random);
			context.AdvanceMonthRelatedData.BlockIds.Release(ref blockIds);
			Location srcLocation = character.GetLocation();
			Location dstLocation = new Location(settlementLocation.AreaId, blockId);
			Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, dstLocation);
			character.SetLocation(dstLocation, context);
		}

		// Token: 0x06007266 RID: 29286 RVA: 0x00421D24 File Offset: 0x0041FF24
		private void XuehouOldManMovement(DataContext context, Character character)
		{
			Location srcLocation = character.GetLocation();
			Character taiwuChar = DomainManager.Taiwu.GetTaiwu();
			Location taiwuLocation = taiwuChar.GetLocation();
			taiwuLocation = (taiwuLocation.IsValid() ? taiwuLocation : taiwuChar.GetValidLocation());
			MapBlockData taiwuBlock = DomainManager.Map.GetBlock(taiwuLocation);
			List<MapBlockData> neighborBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
			DomainManager.Map.GetRealNeighborBlocks(srcLocation.AreaId, srcLocation.BlockId, neighborBlocks, 3, true);
			Settlement settlement = DomainManager.Organization.GetSettlementByOrgTemplateId(15);
			bool flag = DomainManager.Extra.IsLocationContainsBloodLight(taiwuLocation) || neighborBlocks.Contains(taiwuBlock);
			if (flag)
			{
				bool flag2 = DomainManager.Map.IsLocationInSettlementInfluenceRange(taiwuLocation, settlement.GetId());
				if (flag2)
				{
					Location dstLocation = taiwuLocation;
					Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, dstLocation);
					character.SetLocation(dstLocation, context);
				}
			}
			context.AdvanceMonthRelatedData.Blocks.Release(ref neighborBlocks);
		}

		// Token: 0x06007267 RID: 29287 RVA: 0x00421E10 File Offset: 0x00420010
		private void JixiMovement(DataContext context, Character character)
		{
			bool flag = DomainManager.Extra.IsExtraTaskInProgress(125);
			if (!flag)
			{
				EventArgBox sectArgBox = DomainManager.Extra.GetSectMainStoryEventArgBox(15);
				bool @bool = sectArgBox.GetBool("ConchShip_PresetKey_JixiFollowOpen");
				if (@bool)
				{
					this.JixiMovementFollow(context, character);
				}
				else
				{
					bool flag2 = DomainManager.World.IsJixiFree();
					if (flag2)
					{
						this.JixiMovementFree(context, character);
					}
					else
					{
						bool flag3 = DomainManager.Extra.IsExtraTaskInProgress(135);
						if (flag3)
						{
							this.JixiMovementPassLegacy(context, character);
						}
						else
						{
							this.JixiMovementTaiwu(context, character);
						}
					}
				}
			}
		}

		// Token: 0x06007268 RID: 29288 RVA: 0x00421E9C File Offset: 0x0042009C
		private void JixiMovementTaiwu(DataContext context, Character character)
		{
			List<MapBlockData> taiwuBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
			Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			DomainManager.Map.QueryRegularBelongBlocks(taiwuBlocks, taiwuVillageLocation, true, Array.Empty<MapDomain.MapBlockDataFilter>());
			Location newLocation = taiwuBlocks.GetRandom(context.Random).GetLocation();
			context.AdvanceMonthRelatedData.Blocks.Release(ref taiwuBlocks);
			this.JixiMovementChangeLocation(context, character, newLocation);
		}

		// Token: 0x06007269 RID: 29289 RVA: 0x00421F08 File Offset: 0x00420108
		private void JixiMovementPassLegacy(DataContext context, Character character)
		{
			EventArgBox sectArgBox = DomainManager.Extra.GetSectMainStoryEventArgBox(15);
			int awakeTaiwuCharId = sectArgBox.GetInt("ConchShip_PresetKey_AwakeJixiTaiwuId");
			int graveStayMonth = sectArgBox.GetInt("ConchShip_PresetKey_SectStory_Xuehou_Jixi_StayAtGraveMonthKey");
			Grave grave;
			bool flag = this._graves.TryGetValue(awakeTaiwuCharId, out grave) && graveStayMonth < 7;
			if (flag)
			{
				this.JixiMovementChangeLocation(context, character, grave.GetLocation());
				sectArgBox.Set("ConchShip_PresetKey_SectStory_Xuehou_Jixi_StayAtGraveMonthKey", graveStayMonth + 1);
				DomainManager.Extra.SaveSectMainStoryEventArgumentBox(context, 15);
			}
			else
			{
				int currDate = DomainManager.World.GetCurrDate();
				DomainManager.World.DealSectMainStoryEnd(context, 15, 1, currDate);
				this.JixiMovementFree(context, character);
			}
		}

		// Token: 0x0600726A RID: 29290 RVA: 0x00421FB0 File Offset: 0x004201B0
		private void JixiMovementFree(DataContext context, Character character)
		{
			this.UpdateJixiTravelTarget(context, character);
			Location settlementLocation = character.GetNpcTravelTargets()[0].GetRealTargetLocation();
			List<MapBlockData> settlementBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
			DomainManager.Map.QueryRegularBelongBlocks(settlementBlocks, settlementLocation, true, Array.Empty<MapDomain.MapBlockDataFilter>());
			bool flag = !this.JixiMovementActionToBlocks(context, character, settlementBlocks);
			if (flag)
			{
				List<NpcTravelTarget> travelTargets = character.GetNpcTravelTargets();
				travelTargets.RemoveAt(0);
				character.SetNpcTravelTargets(travelTargets, context);
			}
			context.AdvanceMonthRelatedData.Blocks.Release(ref settlementBlocks);
		}

		// Token: 0x0600726B RID: 29291 RVA: 0x0042203C File Offset: 0x0042023C
		private void UpdateJixiTravelTarget(DataContext context, Character character)
		{
			List<NpcTravelTarget> travelTargets = character.GetNpcTravelTargets();
			bool flag = travelTargets.Count > 0;
			if (flag)
			{
				NpcTravelTarget travelTarget = travelTargets[0];
				travelTarget.RemainingMonth--;
				bool flag2 = travelTarget.RemainingMonth <= 0;
				if (flag2)
				{
					travelTargets.RemoveAt(0);
				}
				else
				{
					travelTargets[0] = travelTarget;
				}
				character.SetNpcTravelTargets(travelTargets, context);
			}
			bool flag3 = travelTargets.Count <= 0;
			if (flag3)
			{
				Location targetLocation = this.SelectJixiTravelTarget(context, character);
				short templateId = character.GetTemplateId();
				if (!true)
				{
				}
				sbyte b;
				switch (templateId)
				{
				case 537:
					b = 12;
					break;
				case 538:
					b = 9;
					break;
				case 539:
					b = 6;
					break;
				default:
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(43, 2);
					defaultInterpolatedStringHandler.AppendLiteral("Template out of range: charId=");
					defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetId());
					defaultInterpolatedStringHandler.AppendLiteral(", templateId=");
					defaultInterpolatedStringHandler.AppendFormatted<short>(character.GetTemplateId());
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				}
				if (!true)
				{
				}
				sbyte stayMonth = b;
				NpcTravelTarget travelTarget2 = new NpcTravelTarget(targetLocation, (int)stayMonth);
				character.AddTravelTarget(context, travelTarget2);
			}
		}

		// Token: 0x0600726C RID: 29292 RVA: 0x00422164 File Offset: 0x00420364
		private Location SelectJixiTravelTarget(DataContext context, Character character)
		{
			List<Settlement> settlements = ObjectPool<List<Settlement>>.Instance.Get();
			List<Location> locations = ObjectPool<List<Location>>.Instance.Get();
			Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
			Location currentLocation = character.GetLocation();
			Location expectedSettlementLocation = Location.Invalid;
			bool flag = currentLocation.IsValid();
			if (flag)
			{
				MapBlockData block = DomainManager.Map.GetBlock(currentLocation);
				bool flag2 = block.BelongBlockId >= 0;
				if (flag2)
				{
					expectedSettlementLocation = new Location(currentLocation.AreaId, block.BelongBlockId);
				}
			}
			DomainManager.Organization.GetAllCivilianSettlements(settlements);
			foreach (Settlement settlement in settlements)
			{
				Location settlementLocation = settlement.GetLocation();
				bool flag3 = settlementLocation == taiwuVillageLocation;
				if (!flag3)
				{
					bool flag4 = settlementLocation == expectedSettlementLocation;
					if (!flag4)
					{
						bool flag5 = settlementLocation.AreaId >= 45;
						if (!flag5)
						{
							OrganizationItem settlementConfig = Organization.Instance[settlement.GetOrgTemplateId()];
							bool isSect = settlementConfig.IsSect;
							if (!isSect)
							{
								locations.Add(settlementLocation);
							}
						}
					}
				}
			}
			bool flag6 = context.Random.CheckPercentProb(20);
			if (flag6)
			{
				int taiwuId = DomainManager.Taiwu.GetTaiwuCharId();
				List<Location> taiwuEnemyLocations = ObjectPool<List<Location>>.Instance.Get();
				HashSet<int> taiwuRelatedCharIds = context.AdvanceMonthRelatedData.RelatedCharIds.Occupy();
				this.GetAllRelatedCharIds(taiwuId, taiwuRelatedCharIds, true);
				foreach (int charId in taiwuRelatedCharIds)
				{
					Character relatedChar;
					bool flag7 = !this._objects.TryGetValue(charId, out relatedChar);
					if (!flag7)
					{
						bool flag8 = relatedChar.GetCreatingType() != 1;
						if (!flag8)
						{
							Location location = relatedChar.GetLocation();
							bool flag9 = !location.IsValid() || location.AreaId >= 45;
							if (!flag9)
							{
								MapBlockData blockData = DomainManager.Map.GetBlock(location);
								bool flag10 = blockData.BelongBlockId < 0;
								if (!flag10)
								{
									bool flag11 = this.IsCharacterRelationFriendly(taiwuId, charId);
									if (!flag11)
									{
										bool flag12 = !this.IsCharacterRelationUnfriendly(taiwuId, charId);
										if (!flag12)
										{
											Location enemySettlementLocation = new Location(location.AreaId, blockData.BelongBlockId);
											bool flag13 = !locations.Contains(enemySettlementLocation);
											if (!flag13)
											{
												taiwuEnemyLocations.Add(enemySettlementLocation);
											}
										}
									}
								}
							}
						}
					}
				}
				bool flag14 = taiwuEnemyLocations.Count > 0;
				if (flag14)
				{
					locations.Clear();
					locations.AddRange(taiwuEnemyLocations);
				}
				context.AdvanceMonthRelatedData.RelatedCharIds.Release(ref taiwuRelatedCharIds);
				ObjectPool<List<Location>>.Instance.Return(taiwuEnemyLocations);
			}
			Location targetLocation = locations.GetRandom(context.Random);
			ObjectPool<List<Settlement>>.Instance.Return(settlements);
			ObjectPool<List<Location>>.Instance.Return(locations);
			return targetLocation;
		}

		// Token: 0x0600726D RID: 29293 RVA: 0x00422478 File Offset: 0x00420678
		private void JixiMovementFollow(DataContext context, Character character)
		{
			List<MapBlockData> taiwuNeighborBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
			this.JixiGetTaiwuNeighborBlocks(taiwuNeighborBlocks);
			this.JixiMovementActionToBlocks(context, character, taiwuNeighborBlocks);
			ObjectPool<List<MapBlockData>>.Instance.Return(taiwuNeighborBlocks);
			this.JixiKillAllTemplateEnemies(context, character);
			this.JixiRescueTaiwu(context, character);
			this.JixiMovementViewRangeVisible(context, character);
		}

		// Token: 0x0600726E RID: 29294 RVA: 0x004224CC File Offset: 0x004206CC
		public void JixiMovementFollowTaiwu(DataContext context, Character character)
		{
			List<MapBlockData> taiwuNeighborBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
			List<MapBlockData> enemyBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
			this.JixiGetTaiwuNeighborBlocks(taiwuNeighborBlocks);
			foreach (MapBlockData block in taiwuNeighborBlocks)
			{
				bool flag = this.JixiMatchTemplateEnemyBlock(block);
				if (flag)
				{
					enemyBlocks.Add(block);
				}
			}
			MapBlockData dstBlock = (enemyBlocks.Count > 0) ? enemyBlocks.GetRandom(context.Random) : taiwuNeighborBlocks.GetRandom(context.Random);
			ObjectPool<List<MapBlockData>>.Instance.Return(enemyBlocks);
			ObjectPool<List<MapBlockData>>.Instance.Return(taiwuNeighborBlocks);
			Location dstLocation = dstBlock.GetLocation();
			this.JixiMovementChangeLocation(context, character, dstLocation);
			this.JixiKillAllTemplateEnemies(context, character);
			this.JixiMovementViewRangeVisible(context, character);
		}

		// Token: 0x0600726F RID: 29295 RVA: 0x004225AC File Offset: 0x004207AC
		private void JixiGetTaiwuNeighborBlocks(List<MapBlockData> neighborBlocks)
		{
			Character taiwu = DomainManager.Taiwu.GetTaiwu();
			Location taiwuLocation = taiwu.GetLocation();
			bool flag = !taiwuLocation.IsValid();
			if (flag)
			{
				taiwuLocation = taiwu.GetValidLocation();
			}
			DomainManager.Map.GetRealNeighborBlocks(taiwuLocation.AreaId, taiwuLocation.BlockId, neighborBlocks, 2, false);
		}

		// Token: 0x06007270 RID: 29296 RVA: 0x004225FC File Offset: 0x004207FC
		private bool JixiMatchTemplateEnemyBlock(MapBlockData block)
		{
			bool flag = block.TemplateEnemyList == null;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				foreach (MapTemplateEnemyInfo enemyInfo in block.TemplateEnemyList)
				{
					bool flag2 = Character.Instance[enemyInfo.TemplateId].OrganizationInfo.OrgTemplateId != 19;
					if (flag2)
					{
						return true;
					}
				}
				result = false;
			}
			return result;
		}

		// Token: 0x06007271 RID: 29297 RVA: 0x0042268C File Offset: 0x0042088C
		private void JixiKillAllTemplateEnemies(DataContext context, Character character)
		{
			Location location = character.GetLocation();
			bool flag = !location.IsValid();
			if (!flag)
			{
				MapBlockData blockData = DomainManager.Map.GetBlock(location);
				bool flag2 = blockData.TemplateEnemyList == null;
				if (!flag2)
				{
					for (int i = blockData.TemplateEnemyList.Count - 1; i >= 0; i--)
					{
						MapTemplateEnemyInfo enemyInfo = blockData.TemplateEnemyList[i];
						bool flag3 = Character.Instance[enemyInfo.TemplateId].OrganizationInfo.OrgTemplateId == 19;
						if (!flag3)
						{
							Events.RaiseTemplateEnemyLocationChanged(context, enemyInfo, location, Location.Invalid);
						}
					}
					DomainManager.Extra.SaveArgToSectMainStoryEventArgBox<bool>(context, 15, "ConchShip_PresetKey_JixiKilledEnemy", true);
				}
			}
		}

		// Token: 0x06007272 RID: 29298 RVA: 0x00422754 File Offset: 0x00420954
		private void JixiRescueTaiwu(DataContext context, Character character)
		{
			bool flag = character.GetTemplateId() == 537;
			if (!flag)
			{
				Character taiwu = DomainManager.Taiwu.GetTaiwu();
				short taiwuHealth = taiwu.GetHealth();
				short taiwuMaxHealth = taiwu.GetLeftMaxHealth(false);
				bool flag2 = taiwuHealth >= taiwuMaxHealth * 33 / 100 || taiwuHealth <= 0;
				if (!flag2)
				{
					short templateId = character.GetTemplateId();
					if (!true)
					{
					}
					sbyte b;
					if (templateId != 538)
					{
						if (templateId != 539)
						{
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(43, 2);
							defaultInterpolatedStringHandler.AppendLiteral("Template out of range: charId=");
							defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetId());
							defaultInterpolatedStringHandler.AppendLiteral(", templateId=");
							defaultInterpolatedStringHandler.AppendFormatted<short>(character.GetTemplateId());
							throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						b = 100;
					}
					else
					{
						b = 50;
					}
					if (!true)
					{
					}
					sbyte rescueHealthPercent = b;
					short rescueHealthValue = taiwuMaxHealth * (short)rescueHealthPercent / 100;
					taiwu.ChangeHealth(context, (int)rescueHealthValue);
					DomainManager.World.JixiGrowUp(context, character.GetTemplateId(), 537);
					int currDate = DomainManager.World.GetCurrDate();
					LifeRecordCollection lifeRecord = DomainManager.LifeRecord.GetLifeRecordCollection();
					lifeRecord.AddSectMainStoryXuehouJixiRescueTaiwu(taiwu.GetId(), currDate, taiwu.GetLocation());
					MonthlyNotificationCollection monthlyNotifications = DomainManager.World.GetMonthlyNotificationCollection();
					monthlyNotifications.AddSectMainStoryXuehouJixiRescue(taiwu.GetId());
				}
			}
		}

		// Token: 0x06007273 RID: 29299 RVA: 0x004228A8 File Offset: 0x00420AA8
		private void JixiMovementChangeLocation(DataContext context, Character character, Location dstLocation)
		{
			Location srcLocation = character.GetLocation();
			bool flag = srcLocation == dstLocation;
			if (!flag)
			{
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, dstLocation);
				character.SetLocation(dstLocation, context);
			}
		}

		// Token: 0x06007274 RID: 29300 RVA: 0x004228E4 File Offset: 0x00420AE4
		private void JixiMovementViewRangeVisible(DataContext context, Character character)
		{
			Location location = character.GetLocation();
			bool flag = !location.IsValid();
			if (!flag)
			{
				MapBlockData blockData = DomainManager.Map.GetBlock(location);
				bool visible = blockData.Visible;
				if (!visible)
				{
					blockData.SetVisible(true, context);
				}
			}
		}

		// Token: 0x06007275 RID: 29301 RVA: 0x0042292C File Offset: 0x00420B2C
		private bool JixiMovementActionToBlocks(DataContext context, Character character, List<MapBlockData> targetBlocks)
		{
			bool actionInCd = this.JixiMovementKillCheckCd(character);
			bool flag = actionInCd;
			bool result;
			if (flag)
			{
				Location dstLocation = targetBlocks.GetRandom(context.Random).GetLocation();
				this.JixiMovementChangeLocation(context, character, dstLocation);
				result = true;
			}
			else
			{
				int targetCharId = this.JixiMovementKillSelectTarget(context, targetBlocks);
				bool actionSuccess = targetCharId >= 0;
				Location dstLocation2 = actionSuccess ? this._objects[targetCharId].GetLocation() : targetBlocks.GetRandom(context.Random).GetLocation();
				this.JixiMovementChangeLocation(context, character, dstLocation2);
				this.JixiMovementKillActionTarget(context, character, targetCharId);
				result = actionSuccess;
			}
			return result;
		}

		// Token: 0x06007276 RID: 29302 RVA: 0x004229C4 File Offset: 0x00420BC4
		private int JixiMovementKillSelectTarget(DataContext context, List<MapBlockData> validBlocks)
		{
			List<int> targetCharIds = context.AdvanceMonthRelatedData.TargetCharIdList.Occupy();
			List<int> charIds = context.AdvanceMonthRelatedData.CharIdList.Occupy();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			CharacterMatcherItem matcher = CharacterMatcher.DefValue.CanBeJixiKillingTarget;
			foreach (MapBlockData block in validBlocks)
			{
				bool flag = block.CharacterSet == null;
				if (!flag)
				{
					foreach (int charId in block.CharacterSet)
					{
						Character blockCharacter = this._objects[charId];
						bool flag2 = !matcher.Match(blockCharacter);
						if (!flag2)
						{
							bool flag3 = DomainManager.Character.IsCharacterRelationUnfriendly(taiwuCharId, charId);
							if (flag3)
							{
								targetCharIds.Add(charId);
							}
							else
							{
								charIds.Add(charId);
							}
						}
					}
				}
			}
			int targetCharId = (targetCharIds.Count > 0) ? targetCharIds.GetRandom(context.Random) : ((charIds.Count > 0) ? charIds.GetRandom(context.Random) : -1);
			context.AdvanceMonthRelatedData.TargetCharIdList.Release(ref targetCharIds);
			context.AdvanceMonthRelatedData.CharIdList.Release(ref charIds);
			return targetCharId;
		}

		// Token: 0x06007277 RID: 29303 RVA: 0x00422B4C File Offset: 0x00420D4C
		private bool JixiMovementKillCheckCd(Character character)
		{
			EventArgBox sectArgBox = DomainManager.Extra.GetSectMainStoryEventArgBox(15);
			int waitingDate = sectArgBox.GetInt("ConchShip_PresetKey_SectStory_Xuehou_Jixi_WaitingMonth");
			int currDate = DomainManager.World.GetCurrDate();
			short templateId = character.GetTemplateId();
			if (!true)
			{
			}
			sbyte b;
			switch (templateId)
			{
			case 537:
				b = 0;
				break;
			case 538:
				b = 1;
				break;
			case 539:
				b = 2;
				break;
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(43, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Template out of range: charId=");
				defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetId());
				defaultInterpolatedStringHandler.AppendLiteral(", templateId=");
				defaultInterpolatedStringHandler.AppendFormatted<short>(character.GetTemplateId());
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
			if (!true)
			{
			}
			sbyte killedInterval = b;
			return currDate < waitingDate + (int)killedInterval;
		}

		// Token: 0x06007278 RID: 29304 RVA: 0x00422C14 File Offset: 0x00420E14
		private void JixiMovementKillResetCd(DataContext context)
		{
			int currDate = DomainManager.World.GetCurrDate();
			DomainManager.Extra.SaveArgToSectMainStoryEventArgBox<int>(context, 15, "ConchShip_PresetKey_SectStory_Xuehou_Jixi_WaitingMonth", currDate);
		}

		// Token: 0x06007279 RID: 29305 RVA: 0x00422C44 File Offset: 0x00420E44
		private void JixiMovementKillActionTarget(DataContext context, Character character, int targetCharId)
		{
			Character targetChar;
			bool flag = targetCharId < 0 || !this._objects.TryGetValue(targetCharId, out targetChar);
			if (!flag)
			{
				EventArgBox eventArgBox = DomainManager.Extra.GetSectMainStoryEventArgBox(15);
				Location location = character.GetLocation();
				DomainManager.Character.MakeCharacterDead(context, targetChar, 14);
				MonthlyNotificationCollection monthlyNotifications = DomainManager.World.GetMonthlyNotificationCollection();
				monthlyNotifications.AddSectMainStoryXuehouJixiKillsPeople(location, 1);
				int killedCount = eventArgBox.GetInt("ConchShip_PresetKey_SectStory_Xuehou_Jixi_KilledCount");
				eventArgBox.Set("ConchShip_PresetKey_SectStory_Xuehou_Jixi_KilledCount", ++killedCount);
				if (!true)
				{
				}
				short num;
				if (killedCount >= 7)
				{
					if (killedCount >= 14)
					{
						num = 539;
					}
					else
					{
						num = 538;
					}
				}
				else
				{
					num = 537;
				}
				if (!true)
				{
				}
				short templateId = num;
				bool flag2 = character.GetTemplateId() != templateId;
				if (flag2)
				{
					List<NpcTravelTarget> travelTargets = character.GetNpcTravelTargets();
					DomainManager.World.JixiGrowUp(context, character.GetTemplateId(), templateId);
					character = DomainManager.Character.GetOrCreateFixedCharacterByTemplateId(context, templateId);
					character.SetNpcTravelTargets(travelTargets, context);
				}
				this.JixiMovementKillResetCd(context);
			}
		}

		// Token: 0x0600727A RID: 29306 RVA: 0x00422D54 File Offset: 0x00420F54
		private void SloppyTaoistMonkMovement(DataContext context, Character character)
		{
			Location srcLocation = character.GetLocation();
			Settlement settlement = DomainManager.Organization.GetSettlementByOrgTemplateId(4);
			List<MapBlockData> sectBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
			DomainManager.Map.QueryRootBlocks(sectBlocks, settlement.GetLocation());
			Location dstLocation = sectBlocks.GetRandom(context.Random).GetLocation();
			context.AdvanceMonthRelatedData.Blocks.Release(ref sectBlocks);
			bool flag = srcLocation != dstLocation;
			if (flag)
			{
				Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), srcLocation, dstLocation);
				character.SetLocation(dstLocation, context);
			}
		}

		// Token: 0x0600727B RID: 29307 RVA: 0x00422DE4 File Offset: 0x00420FE4
		public static List<short> CalcFuyuHiltMovementPath(Location start, Location end, short moveCount = -1)
		{
			bool flag = start.Equals(end);
			List<short> result;
			if (flag)
			{
				result = null;
			}
			else
			{
				byte areaSize = DomainManager.Map.GetAreaSize(start.AreaId);
				CharacterDomain._fuyuHiltMovementMap.InitMap((int)areaSize, (int)areaSize, delegate(ByteCoordinate coord)
				{
					MapBlockData block = DomainManager.Map.GetBlock(start.AreaId, ByteCoordinate.CoordinateToIndex(coord, areaSize));
					return block.IsPassable() ? block.MoveCost : -1;
				});
				List<ByteCoordinate> pathInArea = ObjectPool<List<ByteCoordinate>>.Instance.Get();
				List<ByteCoordinate> avoidPosList = ObjectPool<List<ByteCoordinate>>.Instance.Get();
				List<short> settlementIds = ObjectPool<List<short>>.Instance.Get();
				DomainManager.Map.GetAreaSettlementIds(start.AreaId, settlementIds, true, true);
				for (int i = 0; i < settlementIds.Count; i++)
				{
					Settlement settlement = DomainManager.Organization.GetSettlement(settlementIds[i]);
					bool flag2 = settlement.GetOrgTemplateId() == 16;
					if (!flag2)
					{
						Location settlementLocation = settlement.GetLocation();
						MapBlockData mapBlockData = DomainManager.Map.GetBlockData(settlementLocation.AreaId, settlementLocation.BlockId);
						avoidPosList.Add(mapBlockData.GetBlockPos());
					}
				}
				CharacterDomain._fuyuHiltMovementMap.FindWay(ByteCoordinate.IndexToCoordinate(start.BlockId, areaSize), ByteCoordinate.IndexToCoordinate(end.BlockId, areaSize), ref pathInArea, avoidPosList);
				List<short> pathList = new List<short>();
				bool flag3 = moveCount == -1;
				if (flag3)
				{
					moveCount = (short)(pathInArea.Count - 1);
				}
				pathList.Add(ByteCoordinate.CoordinateToIndex(pathInArea[0], areaSize));
				pathList.Add(ByteCoordinate.CoordinateToIndex(pathInArea[(int)moveCount], areaSize));
				ObjectPool<List<ByteCoordinate>>.Instance.Return(pathInArea);
				ObjectPool<List<ByteCoordinate>>.Instance.Return(avoidPosList);
				ObjectPool<List<short>>.Instance.Return(settlementIds);
				result = pathList;
			}
			return result;
		}

		// Token: 0x0600727C RID: 29308 RVA: 0x00422FB8 File Offset: 0x004211B8
		private void GearMateMovement(DataContext context, Character character)
		{
			bool flag = DomainManager.Extra.IsSpecialGroupMember(character);
			if (!flag)
			{
				short settlementId = DomainManager.Organization.GetSettlementIdByOrgTemplateId(16);
				bool flag2 = DomainManager.Map.IsLocationInSettlementInfluenceRange(character.GetLocation(), settlementId);
				if (!flag2)
				{
					List<MapBlockData> mapBlockDataList = ObjectPool<List<MapBlockData>>.Instance.Get();
					Location taiwuVillageLocation = DomainManager.Taiwu.GetTaiwuVillageLocation();
					DomainManager.Map.GetSettlementAffiliatedBlocks(taiwuVillageLocation.AreaId, taiwuVillageLocation.BlockId, mapBlockDataList);
					MapBlockData randomBlock = mapBlockDataList.GetRandom(context.Random);
					Events.RaiseFixedCharacterLocationChanged(context, character.GetId(), character.GetLocation(), randomBlock.GetLocation());
					character.SetLocation(randomBlock.GetLocation(), context);
					ObjectPool<List<MapBlockData>>.Instance.Return(mapBlockDataList);
				}
			}
		}

		// Token: 0x0600727D RID: 29309 RVA: 0x00423070 File Offset: 0x00421270
		public void UpdateIntelligentCharacterMovements(DataContext context)
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				bool flag = charId == taiwuCharId;
				if (!flag)
				{
					bool flag2 = this.IsTemporaryIntelligentCharacter(charId);
					if (!flag2)
					{
						byte creatingType = character.GetCreatingType();
						byte b = creatingType;
						if (b == 1)
						{
							bool flag3 = !CharacterDomain.LockMovementCharSet.Contains(charId);
							if (flag3)
							{
								character.UpdateIntelligentCharacterMovement(context);
							}
							character.UpdateTravelTargetRemainingMonths(context);
						}
					}
				}
			}
		}

		// Token: 0x0600727E RID: 29310 RVA: 0x00423134 File Offset: 0x00421334
		public void UpdateInfectedCharacterMovements(DataContext context)
		{
			foreach (int infectedCharId in this._infectedCharSet)
			{
				Character infectedChar = this._objects[infectedCharId];
				bool flag = CharacterDomain.IsLockMovementChar(infectedCharId);
				if (!flag)
				{
					bool flag2 = infectedChar.GetKidnapperId() >= 0;
					if (!flag2)
					{
						bool flag3 = infectedChar.IsActiveExternalRelationState(60);
						if (!flag3)
						{
							Location location = infectedChar.GetLocation();
							bool flag4 = !location.IsValid();
							if (!flag4)
							{
								MapBlockData block = DomainManager.Map.GetBlock(location);
								bool flag5 = block.InfectedCharacterSet == null || !block.InfectedCharacterSet.Contains(infectedCharId);
								if (!flag5)
								{
									infectedChar.CompletelyInfectedCharacterMovement(context);
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x0600727F RID: 29311 RVA: 0x0042321C File Offset: 0x0042141C
		public void UpdateLegendaryBookInsaneCharacterMovements(DataContext context)
		{
			for (sbyte combatSkillType = 0; combatSkillType < 14; combatSkillType += 1)
			{
				int ownerId = DomainManager.LegendaryBook.GetOwner(combatSkillType);
				bool flag = ownerId < 0;
				if (!flag)
				{
					bool flag2 = ownerId == DomainManager.Taiwu.GetTaiwuCharId();
					if (!flag2)
					{
						Character character = this._objects[ownerId];
						bool flag3 = character.GetLegendaryBookOwnerState() != 2;
						if (!flag3)
						{
							bool flag4 = character.IsActiveExternalRelationState(60);
							if (!flag4)
							{
								bool flag5 = character.GetKidnapperId() >= 0;
								if (!flag5)
								{
									bool flag6 = !character.GetLocation().IsValid();
									if (!flag6)
									{
										character.CompletelyInfectedCharacterMovement(context);
									}
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06007280 RID: 29312 RVA: 0x004232D8 File Offset: 0x004214D8
		public void RemoveCrossAreaTravelInfo(DataContext context, int charId)
		{
			bool flag = this._crossAreaMoveInfos.ContainsKey(charId);
			if (flag)
			{
				this.RemoveElement_CrossAreaMoveInfos(charId, context);
			}
		}

		// Token: 0x06007281 RID: 29313 RVA: 0x00423300 File Offset: 0x00421500
		public void SetCrossAreaTravelInfo(DataContext context, int charId, CrossAreaMoveInfo crossAreaMoveInfo)
		{
			bool flag = this._crossAreaMoveInfos.ContainsKey(charId);
			if (flag)
			{
				this.SetElement_CrossAreaMoveInfos(charId, crossAreaMoveInfo, context);
			}
			else
			{
				this.AddElement_CrossAreaMoveInfos(charId, crossAreaMoveInfo, context);
			}
		}

		// Token: 0x06007282 RID: 29314 RVA: 0x00423334 File Offset: 0x00421534
		public void GetCrossAreaTravelingCharacterIds(List<int> charIds)
		{
			charIds.Clear();
			charIds.AddRange(this._crossAreaMoveInfos.Keys);
		}

		// Token: 0x06007283 RID: 29315 RVA: 0x00423350 File Offset: 0x00421550
		private int GetRandomCharacterInRange(DataContext context, Location centerLocation, int maxSteps, bool includeTaiwu)
		{
			List<int> charIds = context.AdvanceMonthRelatedData.CharIdList.Occupy();
			this.GetCharactersInRange(context, centerLocation, charIds, maxSteps, includeTaiwu);
			int selectedCharId = charIds.GetRandomOrDefault(context.Random, -1);
			context.AdvanceMonthRelatedData.CharIdList.Release(ref charIds);
			return selectedCharId;
		}

		// Token: 0x06007284 RID: 29316 RVA: 0x004233A4 File Offset: 0x004215A4
		private void GetCharactersInRange(DataContext context, Location centerLocation, List<int> charIds, int maxSteps, bool includeTaiwu)
		{
			Character taiwu = DomainManager.Taiwu.GetTaiwu();
			Location taiwuLocation = taiwu.GetLocation();
			int taiwuCharId = taiwu.GetId();
			List<MapBlockData> neighborBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
			DomainManager.Map.GetRealNeighborBlocks(centerLocation.AreaId, centerLocation.BlockId, neighborBlocks, maxSteps, true);
			foreach (MapBlockData block in neighborBlocks)
			{
				bool flag = block.CharacterSet != null;
				if (flag)
				{
					charIds.AddRange(block.CharacterSet);
				}
				bool flag2 = block.InfectedCharacterSet != null;
				if (flag2)
				{
					charIds.AddRange(block.InfectedCharacterSet);
				}
				bool flag3 = block.AreaId != taiwuLocation.AreaId || block.BlockId != taiwuLocation.BlockId;
				if (!flag3)
				{
					if (includeTaiwu)
					{
						charIds.AddRange(DomainManager.Taiwu.GetGroupCharIds().GetCollection());
					}
					else
					{
						foreach (int charId in DomainManager.Taiwu.GetGroupCharIds().GetCollection())
						{
							bool flag4 = charId != taiwuCharId;
							if (flag4)
							{
								charIds.Add(charId);
							}
						}
					}
				}
			}
			context.AdvanceMonthRelatedData.Blocks.Release(ref neighborBlocks);
		}

		// Token: 0x06007285 RID: 29317 RVA: 0x00423558 File Offset: 0x00421758
		public void EscapeToRandomNearbyBlock(DataContext context, Character character, int steps = 3)
		{
			int charId = character.GetId();
			bool flag = CharacterDomain.IsLockMovementChar(charId) || charId == DomainManager.Taiwu.GetTaiwuCharId();
			if (!flag)
			{
				Location location = character.GetLocation();
				bool flag2 = !location.IsValid();
				if (!flag2)
				{
					List<MapBlockData> neighborBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
					DomainManager.Map.GetRealNeighborBlocks(location.AreaId, location.BlockId, neighborBlocks, steps, false);
					bool flag3 = neighborBlocks.Count == 0;
					if (!flag3)
					{
						MapBlockData destBlock = neighborBlocks.GetRandom(context.Random);
						Location destLocation = new Location(destBlock.AreaId, destBlock.BlockId);
						ObjectPool<List<MapBlockData>>.Instance.Return(neighborBlocks);
						int leaderId = character.GetLeaderId();
						bool flag4 = leaderId >= 0 && leaderId != charId;
						if (flag4)
						{
							this.LeaveGroup(context, character, true);
						}
						this.GroupMove(context, character, destLocation);
					}
				}
			}
		}

		// Token: 0x06007286 RID: 29318 RVA: 0x00423644 File Offset: 0x00421844
		[DomainMethod]
		public FullName GenerateRandomHanName(DataContext context, int customSurnameId, short surnameId, sbyte gender)
		{
			return CharacterDomain.GenerateRandomHanName(context.Random, customSurnameId, surnameId, gender, -1);
		}

		// Token: 0x06007287 RID: 29319 RVA: 0x00423668 File Offset: 0x00421868
		[DomainMethod]
		public FullName GenerateRandomZangName(DataContext context, sbyte gender)
		{
			return CharacterDomain.GenerateRandomZangName(context.Random, gender);
		}

		// Token: 0x06007288 RID: 29320 RVA: 0x00423688 File Offset: 0x00421888
		[DomainMethod]
		public FullName GenerateRandomChildName(DataContext context, sbyte gender, FullName parentName)
		{
			bool flag = (parentName.Type & 1) != 0;
			FullName result;
			if (flag)
			{
				result = CharacterDomain.GenerateRandomHanName(context.Random, parentName.GetCustomSurnameId(), parentName.GetSurnameId(), gender, -1);
			}
			else
			{
				bool flag2 = (parentName.Type & 2) != 0;
				if (!flag2)
				{
					throw new Exception("Invalid parent name");
				}
				result = CharacterDomain.GenerateRandomZangName(context.Random, gender);
			}
			return result;
		}

		// Token: 0x06007289 RID: 29321 RVA: 0x004236F0 File Offset: 0x004218F0
		[DomainMethod]
		public NameRelatedData GenerateRandomName(DataContext context)
		{
			sbyte gender = context.Random.NextBool() ? 1 : 0;
			return new NameRelatedData
			{
				Gender = gender,
				FullName = CharacterDomain.GenerateRandomHanName(context.Random, -1, -1, gender, -1)
			};
		}

		// Token: 0x0600728A RID: 29322 RVA: 0x0042373C File Offset: 0x0042193C
		public static FullName GenerateRandomHanName(IRandomSource random, int customSurnameId, short surnameId, sbyte gender, int elderBrothersCount)
		{
			bool flag = customSurnameId < 0 && surnameId < 0;
			if (flag)
			{
				surnameId = CharacterDomain.GetRandomHanSurname(random);
			}
			int unattachedTotalCount = CharacterDomain._randomHanNameUnattachedTotalCounts[(int)gender];
			int attachedTotalCount = CharacterDomain._randomHanNameAttachedTotalCounts[(int)gender];
			bool flag2 = elderBrothersCount < 0;
			if (!flag2)
			{
				bool flag3 = elderBrothersCount == 0;
				if (flag3)
				{
					HanNameItem nameGroup = LocalNames.Instance.AllNamesCore[0];
					unattachedTotalCount += nameGroup.ApartMan.Length + nameGroup.ApartNeutral.Length;
					attachedTotalCount += nameGroup.SerialMan.Length + nameGroup.SerialNeutral.Length;
				}
				else
				{
					HanNameItem nameGroup2 = LocalNames.Instance.AllNamesCore[elderBrothersCount];
					unattachedTotalCount = nameGroup2.ApartMan.Length + nameGroup2.ApartNeutral.Length;
					attachedTotalCount = nameGroup2.SerialMan.Length + nameGroup2.SerialNeutral.Length;
				}
			}
			int randomResult = random.Next(unattachedTotalCount + attachedTotalCount);
			bool useUnattachedName = randomResult < unattachedTotalCount;
			int resultIndex = useUnattachedName ? randomResult : (randomResult - unattachedTotalCount);
			int resultGroupId = -1;
			int resultElementId = -1;
			bool flag4 = elderBrothersCount < 0;
			if (flag4)
			{
				int nameGroupsCount = LocalNames.Instance.AllNamesCore.Length;
				short i = 100;
				while ((int)i < nameGroupsCount)
				{
					HanNameItem nameGroup3 = LocalNames.Instance.AllNamesCore[(int)i];
					bool flag5 = nameGroup3 == null;
					if (!flag5)
					{
						int nameCount = useUnattachedName ? (((gender == 1) ? nameGroup3.ApartMan.Length : nameGroup3.ApartWoman.Length) + nameGroup3.ApartNeutral.Length) : (((gender == 1) ? nameGroup3.SerialMan.Length : nameGroup3.SerialWoman.Length) + nameGroup3.SerialNeutral.Length);
						bool flag6 = resultIndex < nameCount;
						if (flag6)
						{
							resultGroupId = (int)i;
							resultElementId = resultIndex;
							break;
						}
						resultIndex -= nameCount;
					}
					i += 1;
				}
			}
			else
			{
				bool flag7 = elderBrothersCount == 0;
				if (flag7)
				{
					int nameGroupsCount2 = LocalNames.Instance.AllNamesCore.Length;
					short j = 0;
					while ((int)j < nameGroupsCount2)
					{
						bool flag8 = j > 0 && j < 100;
						if (!flag8)
						{
							HanNameItem nameGroup4 = LocalNames.Instance.AllNamesCore[(int)j];
							bool flag9 = nameGroup4 == null;
							if (!flag9)
							{
								int nameCount2 = useUnattachedName ? (nameGroup4.ApartMan.Length + nameGroup4.ApartNeutral.Length) : (nameGroup4.SerialMan.Length + nameGroup4.SerialNeutral.Length);
								bool flag10 = resultIndex < nameCount2;
								if (flag10)
								{
									resultGroupId = (int)j;
									resultElementId = resultIndex;
									break;
								}
								resultIndex -= nameCount2;
							}
						}
						j += 1;
					}
				}
				else
				{
					resultGroupId = elderBrothersCount;
					resultElementId = resultIndex;
				}
			}
			bool flag11 = resultGroupId < 0 || resultElementId < 0;
			if (flag11)
			{
				throw new Exception("Failed to choose given name group.");
			}
			int givenNameType = useUnattachedName ? (random.CheckPercentProb(35) ? 0 : 1) : 2;
			return new FullName(customSurnameId, -1, surnameId, (short)resultGroupId, (short)resultElementId, (sbyte)givenNameType);
		}

		// Token: 0x0600728B RID: 29323 RVA: 0x00423A04 File Offset: 0x00421C04
		public static FullName GenerateRandomZangName(IRandomSource random, sbyte gender)
		{
			int secondNameId = -1;
			bool usedAloneName = false;
			bool flag = gender == 1;
			short genderSpecificStart;
			short genderSpecificEnd;
			if (flag)
			{
				genderSpecificStart = LocalZangNames.Instance.MaleStart;
				genderSpecificEnd = LocalZangNames.Instance.MaleEnd;
			}
			else
			{
				genderSpecificStart = LocalZangNames.Instance.FemaleStart;
				genderSpecificEnd = LocalZangNames.Instance.FemaleEnd;
			}
			int randomResult = random.Next(100);
			bool flag2 = randomResult < 25;
			int firstNameId;
			if (flag2)
			{
				firstNameId = random.Next((int)LocalZangNames.Instance.SoloStart, (int)(LocalZangNames.Instance.SoloEnd + 1));
				usedAloneName = true;
			}
			else
			{
				bool flag3 = randomResult < 63;
				if (flag3)
				{
					firstNameId = random.Next((int)LocalZangNames.Instance.MixStart, (int)(LocalZangNames.Instance.MixEnd + 1));
				}
				else
				{
					firstNameId = random.Next((int)genderSpecificStart, (int)(genderSpecificEnd + 1));
				}
			}
			bool flag4 = random.CheckPercentProb(50);
			if (flag4)
			{
				int randomResult2 = random.Next(100);
				bool flag5 = randomResult2 < 25;
				if (flag5)
				{
					bool flag6 = !usedAloneName;
					if (flag6)
					{
						do
						{
							secondNameId = random.Next((int)LocalZangNames.Instance.SoloStart, (int)(LocalZangNames.Instance.SoloEnd + 1));
						}
						while (secondNameId == firstNameId);
					}
				}
				else
				{
					bool flag7 = randomResult2 < 63;
					if (flag7)
					{
						do
						{
							secondNameId = random.Next((int)LocalZangNames.Instance.MixStart, (int)(LocalZangNames.Instance.MixEnd + 1));
						}
						while (secondNameId == firstNameId);
					}
					else
					{
						do
						{
							secondNameId = random.Next((int)genderSpecificStart, (int)(genderSpecificEnd + 1));
						}
						while (secondNameId == firstNameId);
					}
				}
			}
			bool flag8 = secondNameId >= 0 && random.CheckPercentProb(50);
			if (flag8)
			{
				int num = secondNameId;
				secondNameId = firstNameId;
				firstNameId = num;
			}
			return new FullName(-1, (short)firstNameId, (short)secondNameId);
		}

		// Token: 0x0600728C RID: 29324 RVA: 0x00423BA4 File Offset: 0x00421DA4
		public static MonasticTitle CreateSectMemberMonasticTitle(DataContext context, Sect sect, short mentorSeniorityId = -1)
		{
			sbyte orgTemplateId = sect.GetOrgTemplateId();
			OrganizationItem orgConfig = Organization.Instance[orgTemplateId];
			bool flag = mentorSeniorityId >= 0;
			short currSeniorityId;
			if (flag)
			{
				currSeniorityId = OrganizationDomain.GetNextSeniorityId(orgConfig.SeniorityGroupId, mentorSeniorityId);
				bool flag2 = mentorSeniorityId == sect.GetMinSeniorityId();
				if (flag2)
				{
					sect.SetMinSeniorityId(currSeniorityId, context);
				}
			}
			else
			{
				currSeniorityId = sect.GetMinSeniorityId();
			}
			List<short> suffixIds = sect.GetAvailableMonasticTitleSuffixIds();
			int currSuffixIndex = context.Random.Next(suffixIds.Count);
			short currSuffixId = suffixIds[currSuffixIndex];
			suffixIds.RemoveAt(currSuffixIndex);
			bool flag3 = suffixIds.Count <= 0;
			if (flag3)
			{
				ValueTuple<short, short> monasticTitleSuffixRange = OrganizationDomain.GetMonasticTitleSuffixRange(orgConfig.SeniorityGroupId);
				short suffixFirst = monasticTitleSuffixRange.Item1;
				short suffixLast = monasticTitleSuffixRange.Item2;
				for (short i = suffixFirst; i <= suffixLast; i += 1)
				{
					suffixIds.Add(i);
				}
			}
			sect.SetAvailableMonasticTitleSuffixIds(suffixIds, context);
			return new MonasticTitle(currSeniorityId, currSuffixId);
		}

		// Token: 0x0600728D RID: 29325 RVA: 0x00423C9C File Offset: 0x00421E9C
		[return: TupleElementNames(new string[]
		{
			"surname",
			"givenName"
		})]
		public ValueTuple<string, string> GetMonasticTitleOrDisplayName(int charId)
		{
			NameRelatedData data = new NameRelatedData();
			this.GetNameRelatedData(charId, ref data);
			bool isTaiwu = charId == DomainManager.Taiwu.GetTaiwuCharId();
			return data.GetMonasticTitleOrDisplayName(isTaiwu);
		}

		// Token: 0x0600728E RID: 29326 RVA: 0x00423CD8 File Offset: 0x00421ED8
		[return: TupleElementNames(new string[]
		{
			"surname",
			"givenName"
		})]
		public ValueTuple<string, string> GetRealName(int charId)
		{
			NameRelatedData data = new NameRelatedData();
			this.GetNameRelatedData(charId, ref data);
			return data.GetRealName();
		}

		// Token: 0x0600728F RID: 29327 RVA: 0x00423D04 File Offset: 0x00421F04
		[return: TupleElementNames(new string[]
		{
			"surname",
			"givenName"
		})]
		public static ValueTuple<string, string> GetRealName(Character character)
		{
			NameRelatedData data = new NameRelatedData();
			CharacterDomain.GetNameRelatedData(character, ref data);
			return data.GetRealName();
		}

		// Token: 0x06007290 RID: 29328 RVA: 0x00423D30 File Offset: 0x00421F30
		public static string FormatName(string surname, string givenName)
		{
			string curLanguageKey = LocalStringManager.CurLanguageKey;
			string a = curLanguageKey;
			string result;
			if (!(a == "EN"))
			{
				result = (surname ?? string.Empty) + givenName;
			}
			else
			{
				result = (string.IsNullOrEmpty(surname) ? givenName : (givenName + " " + surname));
			}
			return result;
		}

		// Token: 0x06007291 RID: 29329 RVA: 0x00423D83 File Offset: 0x00421F83
		public static string FormatName(ValueTuple<string, string> name)
		{
			return CharacterDomain.FormatName(name.Item1, name.Item2);
		}

		// Token: 0x06007292 RID: 29330 RVA: 0x00423D96 File Offset: 0x00421F96
		public string GetName(int charId, bool realName = false)
		{
			return CharacterDomain.FormatName(realName ? this.GetRealName(charId) : this.GetMonasticTitleOrDisplayName(charId));
		}

		// Token: 0x06007293 RID: 29331 RVA: 0x00423DB0 File Offset: 0x00421FB0
		[DomainMethod]
		public List<NameRelatedData> GetNameRelatedDataList(List<int> charIds)
		{
			bool flag = charIds == null || charIds.Count == 0;
			List<NameRelatedData> result;
			if (flag)
			{
				result = new List<NameRelatedData>();
			}
			else
			{
				int charsCount = charIds.Count;
				List<NameRelatedData> dataList = new List<NameRelatedData>(charsCount);
				for (int i = 0; i < charsCount; i++)
				{
					NameRelatedData data = new NameRelatedData();
					this.GetNameRelatedData(charIds[i], ref data);
					dataList.Add(data);
				}
				result = dataList;
			}
			return result;
		}

		// Token: 0x06007294 RID: 29332 RVA: 0x00423E28 File Offset: 0x00422028
		[DomainMethod]
		public NameRelatedData GetNameRelatedData(int charId)
		{
			NameRelatedData data = new NameRelatedData();
			this.GetNameRelatedData(charId, ref data);
			return data;
		}

		// Token: 0x06007295 RID: 29333 RVA: 0x00423E4C File Offset: 0x0042204C
		[DomainMethod]
		public List<NameAndLifeRelatedData> GetNameAndLifeRelatedDataList(List<int> charIds)
		{
			int charsCount = charIds.Count;
			List<NameAndLifeRelatedData> dataList = new List<NameAndLifeRelatedData>(charsCount);
			for (int i = 0; i < charsCount; i++)
			{
				NameAndLifeRelatedData data = default(NameAndLifeRelatedData);
				this.GetNameAndLifeRelatedData(charIds[i], ref data);
				dataList.Add(data);
			}
			return dataList;
		}

		// Token: 0x06007296 RID: 29334 RVA: 0x00423EA4 File Offset: 0x004220A4
		[DomainMethod]
		public NameAndLifeRelatedData GetNameAndLifeRelatedData(int charId)
		{
			NameAndLifeRelatedData data = default(NameAndLifeRelatedData);
			this.GetNameAndLifeRelatedData(charId, ref data);
			return data;
		}

		// Token: 0x06007297 RID: 29335 RVA: 0x00423ECC File Offset: 0x004220CC
		private static void InitializeRandomHanNameInfo()
		{
			List<short> surnameIds = new List<short>();
			List<int> accumulativeWeights = new List<int>();
			int accumulativeWeight = 0;
			int i = 0;
			int count = LocalSurnames.Instance.SurnameCore.Length;
			while (i < count)
			{
				SurnameItem item = LocalSurnames.Instance.SurnameCore[i];
				bool flag = item != null;
				if (flag)
				{
					accumulativeWeight += (int)item.Prob;
					surnameIds.Add(item.TemplateId);
					accumulativeWeights.Add(accumulativeWeight);
				}
				i++;
			}
			CharacterDomain._randomHanNameSurnameIds = surnameIds.ToArray();
			CharacterDomain._randomHanNameSurnameAccumulativeWeights = accumulativeWeights.ToArray();
			int maleUnattachedTotalCount = 0;
			int maleAttachedTotalCount = 0;
			int femaleUnattachedTotalCount = 0;
			int femaleAttachedTotalCount = 0;
			int nameGroupsCount = LocalNames.Instance.AllNamesCore.Length;
			short j = 100;
			while ((int)j < nameGroupsCount)
			{
				HanNameItem nameGroup = LocalNames.Instance.AllNamesCore[(int)j];
				bool flag2 = nameGroup == null;
				if (!flag2)
				{
					maleUnattachedTotalCount += nameGroup.ApartMan.Length + nameGroup.ApartNeutral.Length;
					maleAttachedTotalCount += nameGroup.SerialMan.Length + nameGroup.SerialNeutral.Length;
					femaleUnattachedTotalCount += nameGroup.ApartWoman.Length + nameGroup.ApartNeutral.Length;
					femaleAttachedTotalCount += nameGroup.SerialWoman.Length + nameGroup.SerialNeutral.Length;
				}
				j += 1;
			}
			CharacterDomain._randomHanNameUnattachedTotalCounts = new int[]
			{
				femaleUnattachedTotalCount,
				maleUnattachedTotalCount
			};
			CharacterDomain._randomHanNameAttachedTotalCounts = new int[]
			{
				femaleAttachedTotalCount,
				maleAttachedTotalCount
			};
		}

		// Token: 0x06007298 RID: 29336 RVA: 0x00424040 File Offset: 0x00422240
		private unsafe static short GetRandomHanSurname(IRandomSource random)
		{
			int[] array;
			int* pAccumulativeWeights;
			if ((array = CharacterDomain._randomHanNameSurnameAccumulativeWeights) == null || array.Length == 0)
			{
				pAccumulativeWeights = null;
			}
			else
			{
				pAccumulativeWeights = &array[0];
			}
			int index = CollectionUtils.GetRandomAccumulativeWeightedElement(random, pAccumulativeWeights, CharacterDomain._randomHanNameSurnameAccumulativeWeights.Length);
			array = null;
			return CharacterDomain._randomHanNameSurnameIds[index];
		}

		// Token: 0x06007299 RID: 29337 RVA: 0x00424088 File Offset: 0x00422288
		private void GetNameRelatedData(int charId, ref NameRelatedData data)
		{
			Character character;
			bool flag = this._objects.TryGetValue(charId, out character);
			if (flag)
			{
				CharacterDomain.GetNameRelatedData(character, ref data);
			}
			else
			{
				DeadCharacter deadChar;
				bool flag2 = this._deadCharacters.TryGetValue(charId, out deadChar);
				if (flag2)
				{
					CharacterDomain.GetNameRelatedData(charId, deadChar, ref data);
				}
				else
				{
					data.CharTemplateId = -1;
					data.NickNameId = DomainManager.Taiwu.GetFollowingNpcNickNameId(charId);
				}
			}
		}

		// Token: 0x0600729A RID: 29338 RVA: 0x004240EC File Offset: 0x004222EC
		private void GetNameAndLifeRelatedData(int charId, ref NameAndLifeRelatedData data)
		{
			Character character;
			bool flag = this._objects.TryGetValue(charId, out character);
			if (flag)
			{
				CharacterDomain.GetNameRelatedData(character, ref data.NameRelatedData);
				data.LifeState = 0;
			}
			else
			{
				DeadCharacter deadChar;
				bool flag2 = this._deadCharacters.TryGetValue(charId, out deadChar);
				if (flag2)
				{
					CharacterDomain.GetNameRelatedData(charId, deadChar, ref data.NameRelatedData);
					data.LifeState = 1;
				}
				else
				{
					data.NameRelatedData.CharTemplateId = -1;
					data.LifeState = 2;
				}
			}
		}

		// Token: 0x0600729B RID: 29339 RVA: 0x00424164 File Offset: 0x00422364
		public static void GetNameRelatedData(Character character, ref NameRelatedData data)
		{
			data.CharTemplateId = character.GetTemplateId();
			data.Gender = character.GetGender();
			data.MonkType = character.GetMonkType();
			data.FullName = character.GetFullName();
			OrganizationInfo orgInfo = character.GetOrganizationInfo();
			data.OrgTemplateId = orgInfo.OrgTemplateId;
			data.OrgGrade = orgInfo.Grade;
			data.MonasticTitle = character.GetMonasticTitle();
			data.CustomDisplayNameId = DomainManager.Extra.GetCharacterCustomDisplayName(character.GetId());
			data.NickNameId = DomainManager.Taiwu.GetFollowingNpcNickNameId(character.GetId());
			data.ExtraNameTextTemplateId = character.GetExtraNameTextTemplateId();
		}

		// Token: 0x0600729C RID: 29340 RVA: 0x00424208 File Offset: 0x00422408
		public static void GetNameRelatedData(AbridgedCharacter character, ref NameRelatedData data)
		{
			data.CharTemplateId = character.CharTemplateId;
			data.Gender = character.Gender;
			data.MonkType = character.MonkType;
			data.FullName = character.FullName;
			data.OrgTemplateId = character.OrganizationInfo.OrgTemplateId;
			data.OrgGrade = character.OrganizationInfo.Grade;
			data.MonasticTitle = character.MonasticTitle;
			data.CustomDisplayNameId = character.CustomDisplayNameId;
			data.NickNameId = DomainManager.Taiwu.GetFollowingNpcNickNameId(character.Id);
			data.ExtraNameTextTemplateId = -1;
		}

		// Token: 0x0600729D RID: 29341 RVA: 0x0042429D File Offset: 0x0042249D
		public static void GetNameRelatedData(int charId, DeadCharacter deadChar, ref NameRelatedData data)
		{
			data = deadChar.GetRawNameRelatedData();
			data.CustomDisplayNameId = DomainManager.Extra.GetCharacterCustomDisplayName(charId);
			data.NickNameId = DomainManager.Taiwu.GetFollowingNpcNickNameId(charId);
		}

		// Token: 0x0600729E RID: 29342 RVA: 0x004242D0 File Offset: 0x004224D0
		[Obsolete("Use NameRelatedData.GetRealName instead.")]
		[return: TupleElementNames(new string[]
		{
			"surname",
			"givenName"
		})]
		private static ValueTuple<string, string> GetRealName(ref NameRelatedData data)
		{
			return data.GetRealName();
		}

		// Token: 0x0600729F RID: 29343 RVA: 0x004242E8 File Offset: 0x004224E8
		public int PackCharacter(RawDataBlock dataBlock, Character character)
		{
			CharacterDataPackage package = this.PackCharacter(character);
			return dataBlock.AddSerializableGameData(package);
		}

		// Token: 0x060072A0 RID: 29344 RVA: 0x0042430C File Offset: 0x0042250C
		public CharacterDataPackage PackCharacter(Character character)
		{
			CharacterDataPackage characterPackage = new CharacterDataPackage();
			int charId = character.GetId();
			characterPackage.Character = character;
			characterPackage.ItemGroupPackage = new ItemGroupPackage();
			characterPackage.CombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(charId);
			characterPackage.CombatSkillProficiencies = new Dictionary<short, int>();
			foreach (short skillId in characterPackage.CombatSkills.Keys)
			{
				CombatSkillKey key = new CombatSkillKey(charId, skillId);
				int proficiency;
				bool flag = DomainManager.Extra.TryGetElement_CombatSkillProficiencies(key, out proficiency);
				if (flag)
				{
					characterPackage.CombatSkillProficiencies.Add(skillId, proficiency);
				}
			}
			foreach (ItemKey srcItemKey in character.GetEquipment())
			{
				bool flag2 = !srcItemKey.IsValid();
				if (!flag2)
				{
					ItemBase itemBase = DomainManager.Item.GetBaseItem(srcItemKey);
					DomainManager.Item.PackItem(characterPackage.ItemGroupPackage, itemBase);
				}
			}
			Dictionary<ItemKey, int> inventoryItems = character.GetInventory().Items;
			foreach (KeyValuePair<ItemKey, int> keyValuePair in inventoryItems)
			{
				ItemKey itemKey;
				int num;
				keyValuePair.Deconstruct(out itemKey, out num);
				ItemKey srcItemKey2 = itemKey;
				bool flag3 = ItemTemplateHelper.GetItemSubType(srcItemKey2.ItemType, srcItemKey2.TemplateId) == 1202;
				if (!flag3)
				{
					ItemBase itemBase2 = DomainManager.Item.GetBaseItem(srcItemKey2);
					DomainManager.Item.PackItem(characterPackage.ItemGroupPackage, itemBase2);
				}
			}
			return characterPackage;
		}

		// Token: 0x060072A1 RID: 29345 RVA: 0x004244D4 File Offset: 0x004226D4
		public Character UnpackCharacter(DataContext context, RawDataBlock block, ref int offset, bool connectWithSrc)
		{
			CharacterDataPackage package = null;
			offset += block.GetSerializableGameData<CharacterDataPackage>(ref package, offset);
			return DomainManager.Character.UnpackCharacter(context, package, connectWithSrc, false);
		}

		// Token: 0x060072A2 RID: 29346 RVA: 0x00424508 File Offset: 0x00422708
		public Character UnpackCharacter(DataContext context, CharacterDataPackage package, bool connectWithSrc = false, bool tryKeepOriginalId = false)
		{
			Character character = package.Character;
			int originalId = character.GetId();
			bool flag = tryKeepOriginalId && !this._objects.ContainsKey(originalId);
			if (flag)
			{
				Grave grave;
				bool flag2 = this._graves.TryGetValue(originalId, out grave);
				if (flag2)
				{
					this.RemoveGrave(context, grave);
				}
				bool flag3 = this._deadCharacters.ContainsKey(originalId);
				if (flag3)
				{
					this.RemoveElement_DeadCharacters(originalId, context);
					this.RemoveElement_DeadCharDeletionStates(originalId, context);
				}
			}
			int charId = this.GenerateNextObjectId(context);
			int srcCharId = connectWithSrc ? originalId : -1;
			ItemKey[] srcEquipments = character.GetEquipment().ToArray<ItemKey>();
			character.OfflineSetId(charId);
			character.OfflineSetCopySource(srcCharId);
			this.AddElement_Objects(charId, character);
			this.StartCreatingCharacter(charId);
			List<GameData.Domains.CombatSkill.CombatSkill> combatSkills = ObjectPool<List<GameData.Domains.CombatSkill.CombatSkill>>.Instance.Get();
			combatSkills.Clear();
			foreach (KeyValuePair<short, GameData.Domains.CombatSkill.CombatSkill> keyValuePair in package.CombatSkills)
			{
				short num;
				GameData.Domains.CombatSkill.CombatSkill combatSkill2;
				keyValuePair.Deconstruct(out num, out combatSkill2);
				GameData.Domains.CombatSkill.CombatSkill combatSkill = combatSkill2;
				combatSkill.OfflineSetCharId(charId);
				combatSkill.OfflineSetSpecialEffectId(-1L);
				combatSkills.Add(combatSkill);
			}
			DomainManager.CombatSkill.RegisterCombatSkills(charId, combatSkills);
			this.AutoActivateReadCombatSkillNormalPages(context, combatSkills, charId);
			ObjectPool<List<GameData.Domains.CombatSkill.CombatSkill>>.Instance.Return(combatSkills);
			foreach (KeyValuePair<short, int> keyValuePair2 in package.CombatSkillProficiencies)
			{
				short num;
				int num2;
				keyValuePair2.Deconstruct(out num, out num2);
				short combatSkillId = num;
				int value = num2;
				DomainManager.Extra.SetCombatSkillProficiency(context, new CombatSkillKey(charId, combatSkillId), value);
			}
			ItemKey[] equipments = character.GetEquipment();
			for (int slot = 0; slot < equipments.Length; slot++)
			{
				ItemKey srcItemKey = srcEquipments[slot];
				bool flag4 = !srcItemKey.IsValid();
				if (!flag4)
				{
					ItemKey destItemKey = DomainManager.Item.UnpackItem(context, package.ItemGroupPackage, srcItemKey.Id);
					equipments[slot] = destItemKey;
					bool flag5 = !destItemKey.IsValid();
					if (!flag5)
					{
						EquipmentBase equipmentBase = DomainManager.Item.GetBaseEquipment(destItemKey);
						equipmentBase.SetOwner(ItemOwnerType.CharacterEquipment, charId);
						equipmentBase.SetEquippedCharId(charId, context);
					}
				}
			}
			character.SetEquipment(equipments, context);
			Dictionary<ItemKey, int> inventoryItems = character.GetInventory().Items;
			Inventory newInventory = new Inventory();
			foreach (KeyValuePair<ItemKey, int> keyValuePair3 in inventoryItems)
			{
				int num2;
				ItemKey itemKey;
				keyValuePair3.Deconstruct(out itemKey, out num2);
				ItemKey srcItemKey2 = itemKey;
				int amount = num2;
				ItemKey newItemKey = DomainManager.Item.UnpackItem(context, package.ItemGroupPackage, srcItemKey2.Id);
				newInventory.OfflineAdd(newItemKey, amount);
				DomainManager.Item.SetOwner(newItemKey, ItemOwnerType.CharacterInventory, charId);
			}
			character.SetInventory(newInventory, context);
			DomainManager.Information.RegisterInformation(charId, context);
			Events.RaiseCharacterCreated(context, character);
			this.CompleteCreatingCharacter(charId);
			if (connectWithSrc)
			{
				this.RegisterTemporaryIntelligentCharacter(charId);
			}
			return character;
		}

		// Token: 0x060072A3 RID: 29347 RVA: 0x0042485C File Offset: 0x00422A5C
		public void CreatePregnantState(DataContext context, Character mother, Character father, bool isRaped)
		{
			int motherId = mother.GetId();
			PregnantState state;
			bool flag = this._pregnantStates.TryGetValue(motherId, out state);
			if (flag)
			{
				Logger logger = CharacterDomain.Logger;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(45, 2);
				defaultInterpolatedStringHandler.AppendLiteral("PregnantState already exist for character ");
				defaultInterpolatedStringHandler.AppendFormatted<Character>(mother);
				defaultInterpolatedStringHandler.AppendLiteral(" - ");
				defaultInterpolatedStringHandler.AppendFormatted<PregnantState>(state);
				logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			else
			{
				state = new PregnantState(mother, father, isRaped);
				int currDate = DomainManager.World.GetCurrDate();
				int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
				bool flag2 = taiwuCharId == mother.GetId() || taiwuCharId == father.GetId();
				if (flag2)
				{
					state.IsHuman = !context.Random.CheckPercentProb(DomainManager.Taiwu.GetCricketLuckPoint() / 100);
					bool isHuman = state.IsHuman;
					if (isHuman)
					{
						state.ExpectedBirthDate = currDate + context.Random.Next(6, 10);
					}
					else
					{
						state.ExpectedBirthDate = currDate + 42;
						DomainManager.Taiwu.SetCricketLuckPoint(0, context);
					}
				}
				else
				{
					state.ExpectedBirthDate = currDate + context.Random.Next(6, 10);
					state.IsHuman = true;
				}
				bool flag3 = mother.GetLeaderId() == DomainManager.Taiwu.GetTaiwuCharId();
				if (flag3)
				{
					Events.RaiseTaiwuOrTeammatePregnant(context, mother.GetId(), mother.GetLocation());
				}
				this.AddElement_PregnantStates(mother.GetId(), state, context);
			}
		}

		// Token: 0x060072A4 RID: 29348 RVA: 0x004249CC File Offset: 0x00422BCC
		public PregnantState GetPregnantState(int motherCharId)
		{
			return this._pregnantStates[motherCharId];
		}

		// Token: 0x060072A5 RID: 29349 RVA: 0x004249EC File Offset: 0x00422BEC
		public bool TryGetPregnantState(int motherCharId, out PregnantState pregnantState)
		{
			return this._pregnantStates.TryGetValue(motherCharId, out pregnantState);
		}

		// Token: 0x060072A6 RID: 29350 RVA: 0x00424A0C File Offset: 0x00422C0C
		public void ConvertPregnantWithCricketToHuman(DataContext context, int motherCharId)
		{
			PregnantState state = this._pregnantStates[motherCharId];
			state.IsHuman = true;
			state.ExpectedBirthDate = DomainManager.World.GetCurrDate() + 3;
			this.SetElement_PregnantStates(motherCharId, state, context);
		}

		// Token: 0x060072A7 RID: 29351 RVA: 0x00424A4A File Offset: 0x00422C4A
		public void RemovePregnantLock(DataContext context, int motherCharId)
		{
			this.RemoveElement_PregnancyLockEndDates(motherCharId, context);
		}

		// Token: 0x060072A8 RID: 29352 RVA: 0x00424A58 File Offset: 0x00422C58
		public bool CanSelectForForcePregnancy(Character character)
		{
			bool flag = character.GetGender() != 0;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = character.GetAgeGroup() != 2;
				if (flag2)
				{
					result = false;
				}
				else
				{
					bool flag3 = character.IsCompletelyInfected();
					if (flag3)
					{
						result = false;
					}
					else
					{
						bool flag4 = character.GetLegendaryBookOwnerState() >= 2;
						if (flag4)
						{
							result = false;
						}
						else
						{
							PregnantState pregnantState;
							bool flag5 = this.TryGetPregnantState(character.GetId(), out pregnantState);
							result = !flag5;
						}
					}
				}
			}
			return result;
		}

		// Token: 0x060072A9 RID: 29353 RVA: 0x00424ACC File Offset: 0x00422CCC
		public void MakePregnantWithoutMale(DataContext context, Character mother)
		{
			int currDate = DomainManager.World.GetCurrDate();
			PregnantState state = new PregnantState(mother, null, false);
			state.ExpectedBirthDate = currDate + context.Random.Next(6, 10);
			state.IsHuman = true;
			mother.AddFeature(context, 197, false);
			bool flag = mother.GetLeaderId() == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag)
			{
				Events.RaiseTaiwuOrTeammatePregnant(context, mother.GetId(), mother.GetLocation());
			}
			this.AddElement_PregnantStates(mother.GetId(), state, context);
		}

		// Token: 0x060072AA RID: 29354 RVA: 0x00424B54 File Offset: 0x00422D54
		public void UpdatePregnancyUnlockDates(DataContext context)
		{
			int currDate = DomainManager.World.GetCurrDate();
			List<int> toRemoveList = ObjectPool<List<int>>.Instance.Get();
			toRemoveList.Clear();
			foreach (KeyValuePair<int, int> keyValuePair in this._pregnancyLockEndDates)
			{
				int num;
				int num2;
				keyValuePair.Deconstruct(out num, out num2);
				int charId = num;
				int date = num2;
				bool flag = currDate >= date;
				if (flag)
				{
					toRemoveList.Add(charId);
				}
			}
			foreach (int charId2 in toRemoveList)
			{
				this.RemoveElement_PregnancyLockEndDates(charId2, context);
			}
			ObjectPool<List<int>>.Instance.Return(toRemoveList);
		}

		// Token: 0x060072AB RID: 29355 RVA: 0x00424C3C File Offset: 0x00422E3C
		public void ParallelUpdatePregnantState(DataContext context, Character mother, PregnantStateModification mod)
		{
			PregnantState state = this.GetElement_PregnantStates(mother.GetId());
			int currDate = DomainManager.World.GetCurrDate();
			int motherCharId = mother.GetId();
			bool isMotherCompletelyInfected = mother.GetXiangshuInfection() >= 200;
			IRandomSource random = context.Random;
			int taiwuId = DomainManager.Taiwu.GetTaiwuCharId();
			bool flag = isMotherCompletelyInfected || state.ExpectedBirthDate > currDate;
			if (flag)
			{
				short currHealth = mother.GetHealth();
				short leftMaxHealth = mother.GetLeftMaxHealth(false);
				double healthPercentage = (double)currHealth / (double)leftMaxHealth;
				bool flag2 = healthPercentage < 0.30000001192092896 || isMotherCompletelyInfected;
				if (flag2)
				{
					GameData.Domains.Character.Ai.PersonalNeed need = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(1, (int)(leftMaxHealth - currHealth));
					mother.OfflineAddPersonalNeed(need);
					bool flag3 = isMotherCompletelyInfected || random.NextDouble() < 0.30000001192092896 - healthPercentage;
					if (flag3)
					{
						mod.State = PregnantStateModification.ChildState.Dead;
						return;
					}
				}
				bool flag4 = motherCharId == DomainManager.Taiwu.GetTaiwuCharId() && state.IsHuman;
				if (flag4)
				{
					bool flag5;
					switch (state.ExpectedBirthDate - currDate)
					{
					case 1:
					case 3:
					case 5:
						flag5 = true;
						goto IL_121;
					}
					flag5 = false;
					IL_121:
					bool flag6 = flag5 && random.CheckPercentProb(75);
					if (flag6)
					{
						mod.PrenatalEvent = true;
					}
				}
				else
				{
					bool flag7 = (taiwuId == state.FatherId || taiwuId == motherCharId) && !state.IsHuman;
					if (flag7)
					{
						bool flag8 = state.ExpectedBirthDate - currDate <= 3;
						if (flag8)
						{
							mod.DreamedOfCricket = true;
						}
					}
				}
			}
			else
			{
				bool isHuman = state.IsHuman;
				if (isHuman)
				{
					short currHealth2 = mother.GetHealth();
					short leftMaxHealth2 = mother.GetLeftMaxHealth(false);
					double healthPercentage2 = (double)currHealth2 / (double)leftMaxHealth2;
					bool flag9 = healthPercentage2 < 0.30000001192092896 && random.NextDouble() < 0.30000001192092896 - healthPercentage2;
					if (flag9)
					{
						int randomVal = random.Next(10);
						mod.Dystocia = true;
						bool flag10 = randomVal < 1;
						if (flag10)
						{
							mod.LostMother = true;
							mod.State = PregnantStateModification.ChildState.Dead;
						}
						else
						{
							bool flag11 = randomVal < 3;
							if (flag11)
							{
								mod.State = PregnantStateModification.ChildState.AliveHuman;
							}
							else
							{
								bool flag12 = randomVal < 6;
								if (flag12)
								{
									mod.State = PregnantStateModification.ChildState.Dead;
								}
								else
								{
									mod.LostMother = true;
									mod.State = PregnantStateModification.ChildState.AliveHuman;
								}
							}
						}
					}
					else
					{
						mod.State = PregnantStateModification.ChildState.AliveHuman;
					}
				}
				else
				{
					mod.State = PregnantStateModification.ChildState.AliveCricket;
				}
			}
		}

		// Token: 0x060072AC RID: 29356 RVA: 0x00424EA8 File Offset: 0x004230A8
		public void ApplyPregnantStateChange(DataContext context, Character mother, PregnantStateModification mod)
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			int motherCharId = mother.GetId();
			int currDate = DomainManager.World.GetCurrDate();
			MonthlyNotificationCollection monthlyNotificationCollection = DomainManager.World.GetMonthlyNotificationCollection();
			LifeRecordCollection lifeRecordCollection = DomainManager.LifeRecord.GetLifeRecordCollection();
			SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
			MonthlyEventCollection monthlyEventCollection = DomainManager.World.GetMonthlyEventCollection();
			PregnantState pregnantState = this.GetElement_PregnantStates(motherCharId);
			Location location = mother.GetLocation();
			bool flag = mod.State == PregnantStateModification.ChildState.Dead;
			if (flag)
			{
				lifeRecordCollection.AddMotherLoseFetus(motherCharId, currDate, location);
				GameData.Domains.Character.Ai.PersonalNeed needToTeamUp = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(20, pregnantState.FatherId);
				GameData.Domains.Character.Ai.PersonalNeed needToAdoptChild = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(25, 128);
				mother.OfflineAddPersonalNeed(needToTeamUp);
				mother.OfflineAddPersonalNeed(needToAdoptChild);
				mother.SetPersonalNeeds(mother.GetPersonalNeeds(), context);
				mother.SetHappiness(mother.GetHappiness(), context);
				IntPair samsaraInfo = this.GetDirectedSamsaraInfo(motherCharId);
				bool lostMother = mod.LostMother;
				if (lostMother)
				{
					bool flag2 = motherCharId == taiwuCharId;
					if (flag2)
					{
						monthlyEventCollection.AddMotherFetusBothDieTaiwu(motherCharId, location);
					}
					else
					{
						bool flag3 = pregnantState.FatherId == taiwuCharId;
						if (flag3)
						{
							monthlyEventCollection.AddMotherFetusBothDieWife(motherCharId, location);
						}
					}
					bool flag4 = samsaraInfo.First >= 0;
					if (flag4)
					{
						monthlyNotificationCollection.AddMiscarriageAndReincarnationMotherDies(motherCharId, location, samsaraInfo.First);
					}
				}
				else
				{
					bool flag5 = motherCharId == taiwuCharId;
					if (flag5)
					{
						bool dystocia = mod.Dystocia;
						if (dystocia)
						{
							monthlyEventCollection.AddDystociaLoseFetusTaiwu(motherCharId, location);
						}
						else
						{
							monthlyEventCollection.AddAbortionTaiwu(motherCharId, location);
						}
					}
					else
					{
						bool flag6 = pregnantState.FatherId == taiwuCharId;
						if (flag6)
						{
							bool dystocia2 = mod.Dystocia;
							if (dystocia2)
							{
								monthlyEventCollection.AddDystociaLoseFetusWife(motherCharId, location);
							}
							else
							{
								monthlyEventCollection.AddLoseFetusWife(motherCharId, location);
							}
						}
					}
					bool flag7 = this.IsTaiwuPeople(motherCharId);
					if (flag7)
					{
						monthlyNotificationCollection.AddMotherLoseFetus(motherCharId, location);
					}
					bool flag8 = samsaraInfo.First >= 0;
					if (flag8)
					{
						monthlyNotificationCollection.AddMiscarriageAndReincarnation(motherCharId, location, samsaraInfo.First);
					}
				}
				int secretInfoOffset = secretInformationCollection.AddLoseFetus(motherCharId, location);
				int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
				Character father;
				bool flag9 = pregnantState.CreateFatherRelation && DomainManager.Character.TryGetElement_Objects(pregnantState.FatherId, out father);
				if (flag9)
				{
					lifeRecordCollection.AddFatherLoseFetus(pregnantState.FatherId, currDate, motherCharId, location);
					needToTeamUp = GameData.Domains.Character.Ai.PersonalNeed.CreatePersonalNeed(20, motherCharId);
					father.OfflineAddPersonalNeed(needToTeamUp);
					father.OfflineAddPersonalNeed(needToAdoptChild);
					father.SetPersonalNeeds(father.GetPersonalNeeds(), context);
					father.SetHappiness(father.GetHappiness(), context);
				}
			}
			else
			{
				bool flag10 = mod.State == PregnantStateModification.ChildState.AliveCricket;
				if (flag10)
				{
					bool flag11 = taiwuCharId == motherCharId;
					if (flag11)
					{
						monthlyEventCollection.AddGiveBirthToCricketTaiwu(taiwuCharId);
					}
					else
					{
						bool flag12 = taiwuCharId == pregnantState.FatherId;
						if (flag12)
						{
							monthlyEventCollection.AddGiveBirthToCricketWife(motherCharId);
						}
					}
					monthlyNotificationCollection.AddGiveBirthToCricket(taiwuCharId);
				}
				else
				{
					bool dreamedOfCricket = mod.DreamedOfCricket;
					if (dreamedOfCricket)
					{
						bool flag13 = mother.GetId() == taiwuCharId;
						if (flag13)
						{
							monthlyEventCollection.AddCricketInDream(taiwuCharId, location);
						}
						else
						{
							Character taiwu = DomainManager.Taiwu.GetTaiwu();
							monthlyEventCollection.AddCricketInDreamTaiwuPartnerPregnant(taiwuCharId, taiwu.GetLocation(), mother.GetId());
						}
					}
					else
					{
						bool prenatalEvent = mod.PrenatalEvent;
						if (prenatalEvent)
						{
							monthlyEventCollection.AddPrenatalEducationTaiwu(taiwuCharId);
						}
					}
				}
			}
			bool flag14 = mod.State > PregnantStateModification.ChildState.Invalid;
			if (flag14)
			{
				DomainManager.Building.TryRemoveSamsaraPlatformBornData(context, motherCharId);
				ProfessionSkillHandle.BuddhistMonkSkill_TryRemoveDirectedSamsara(context, motherCharId, true);
				this.RemoveElement_PregnantStates(motherCharId, context);
				int lockEndDate = currDate + context.Random.Next(12, 36);
				int num;
				bool flag15 = this.TryGetElement_PregnancyLockEndDates(motherCharId, out num);
				if (flag15)
				{
					this.SetElement_PregnancyLockEndDates(motherCharId, lockEndDate, context);
				}
				else
				{
					this.AddElement_PregnancyLockEndDates(motherCharId, lockEndDate, context);
				}
			}
		}

		// Token: 0x060072AD RID: 29357 RVA: 0x00425249 File Offset: 0x00423449
		public void PrepareForPrioritizedAction(DataContext context)
		{
			this.PrepareContestForLegendaryBookPrioritizedActionData(context);
			this.PrepareYuanShanPrioritizedActionData(context);
			this.PrepareShiXiangPrioritizedActionData(context);
			this.PrepareInfantPrioritizedActionData(context);
			this.PrepareEMeiPrioritizedActionData(context);
			this.PrepareBaihuaPrioritizedActionData();
		}

		// Token: 0x060072AE RID: 29358 RVA: 0x0042527C File Offset: 0x0042347C
		private void PrepareContestForLegendaryBookPrioritizedActionData(DataContext context)
		{
			bool flag = !DomainManager.LegendaryBook.IsAnyLegendaryBookOwned();
			if (!flag)
			{
				int canContestTotalCount = 0;
				for (sbyte combatSkillType = 0; combatSkillType < 14; combatSkillType += 1)
				{
					bool flag2 = DomainManager.LegendaryBook.GetOwner(combatSkillType) < 0;
					if (!flag2)
					{
						int contestantCount = DomainManager.Extra.GetContestForLegendaryBookCharacterSet(combatSkillType).GetCount();
						int canContestCount = 2 - contestantCount;
						bool flag3 = canContestCount <= 0;
						if (!flag3)
						{
							canContestTotalCount += canContestCount;
						}
					}
				}
				bool flag4 = canContestTotalCount <= 0;
				if (!flag4)
				{
					List<int> charIds = context.AdvanceMonthRelatedData.CharIdList.Occupy();
					IList<int> topThousands = this._topThousandCharDescendingRanking.Values;
					int i = 0;
					int count = Math.Min(topThousands.Count, 100);
					while (i < count)
					{
						charIds.Add(topThousands[i]);
						i++;
					}
					for (sbyte orgTemplateId = 1; orgTemplateId <= 15; orgTemplateId += 1)
					{
						Settlement settlement = DomainManager.Organization.GetSettlementByOrgTemplateId(orgTemplateId);
						for (int j = 1; j <= 3; j++)
						{
							long rankingInfo = settlement.GetRankingInfo(1);
							int charId = (int)(rankingInfo & 2147483647L);
							charIds.Add(charId);
						}
					}
					CollectionUtils.Shuffle<int>(context.Random, charIds);
					foreach (int charId2 in charIds)
					{
						bool flag5 = canContestTotalCount <= 0;
						if (flag5)
						{
							break;
						}
						Character character;
						bool flag6 = !this._objects.TryGetValue(charId2, out character);
						if (!flag6)
						{
							bool flag7 = character.GetAgeGroup() == 0;
							if (!flag7)
							{
								bool flag8 = character.IsActiveExternalRelationState(60) || character.IsActiveExternalRelationState(1);
								if (!flag8)
								{
									bool flag9 = DomainManager.LegendaryBook.IsCharacterActingCrazy(character);
									if (!flag9)
									{
										BasePrioritizedAction basePrioritizedAction;
										bool flag10 = this.TryGetCharacterPrioritizedAction(charId2, out basePrioritizedAction);
										if (!flag10)
										{
											bool flag11 = DomainManager.Extra.IsPrioritizedActionInCooldown(charId2, 9);
											if (!flag11)
											{
												this._legendaryBookChallengers.Add(charId2);
												canContestTotalCount--;
											}
										}
									}
								}
							}
						}
					}
					context.AdvanceMonthRelatedData.CharIdList.Release(ref charIds);
				}
			}
		}

		// Token: 0x060072AF RID: 29359 RVA: 0x004254E0 File Offset: 0x004236E0
		private void PrepareYuanShanPrioritizedActionData(DataContext context)
		{
			this._yuanShanEnemyLocations.Clear();
			EventArgBox sectArgBox = DomainManager.Extra.GetSectMainStoryEventArgBox(5);
			bool flag = !sectArgBox.GetBool("ConchShip_PresetKey_YuanshanToFightDemon");
			if (!flag)
			{
				Character character;
				bool flag2 = DomainManager.Character.TryGetFixedCharacterByTemplateId(585, out character);
				if (flag2)
				{
					Location location = character.GetLocation();
					bool flag3 = location.IsValid();
					if (flag3)
					{
						this._yuanShanEnemyLocations.Add(location);
					}
				}
				bool flag4 = DomainManager.Character.TryGetFixedCharacterByTemplateId(586, out character);
				if (flag4)
				{
					Location location2 = character.GetLocation();
					bool flag5 = location2.IsValid();
					if (flag5)
					{
						this._yuanShanEnemyLocations.Add(location2);
					}
				}
				bool flag6 = DomainManager.Character.TryGetFixedCharacterByTemplateId(587, out character);
				if (flag6)
				{
					Location location3 = character.GetLocation();
					bool flag7 = location3.IsValid();
					if (flag7)
					{
						this._yuanShanEnemyLocations.Add(location3);
					}
				}
			}
		}

		// Token: 0x060072B0 RID: 29360 RVA: 0x004255D0 File Offset: 0x004237D0
		private void PrepareShiXiangPrioritizedActionData(DataContext context)
		{
			this._shiXiangEnemyBlockIds.Clear();
			EventArgBox sectArgBox = DomainManager.Extra.GetSectMainStoryEventArgBox(6);
			bool flag = !sectArgBox.GetBool("ConchShip_PresetKey_ShixiangToFightEnemy");
			if (!flag)
			{
				SectStoryShixiangToFightEnemyAction.ResetKilledLimit(context);
				DomainManager.World.ShixiangQueryEnemyLocations(context, out this._shiXiangEnemyAreaId, out this._shiXiangEnemyBlockIds);
			}
		}

		// Token: 0x060072B1 RID: 29361 RVA: 0x0042562C File Offset: 0x0042382C
		private unsafe void PrepareInfantPrioritizedActionData(DataContext context)
		{
			this._charactersWithInfantNearBy.Clear();
			this._characterWithInfantWithBloodRelation.Clear();
			foreach (KeyValuePair<int, int> pair in this._infantMap)
			{
				Character infant;
				bool flag = !this.TryGetElement_Objects(pair.Key, out infant) || infant.GetAgeGroup() != 0 || infant.GetLeaderId() >= 0 || this.InfantHasPotentialAdopter(pair.Key) || infant.GetOrganizationInfo().OrgTemplateId == 16;
				if (!flag)
				{
					Location location = infant.GetLocation();
					bool flag2 = !location.IsValid();
					if (!flag2)
					{
						Span<MapBlockData> blocks = DomainManager.Map.GetAreaBlocks(location.AreaId);
						ByteCoordinate locationPos = DomainManager.Map.GetBlock(location).GetBlockPos();
						Span<MapBlockData> span = blocks;
						for (int i = 0; i < span.Length; i++)
						{
							MapBlockData block = *span[i];
							bool flag3 = block.CharacterSet == null;
							if (!flag3)
							{
								foreach (int id in block.CharacterSet)
								{
									bool flag4 = !RelationTypeHelper.AllowAddingAdoptiveChildRelation(id, pair.Key);
									if (flag4)
									{
										this._characterWithInfantWithBloodRelation[id] = pair.Key;
									}
									int newDistance = locationPos.GetManhattanDistance(block.GetBlockPos());
									ValueTuple<int, int> existed;
									bool flag5 = !this._charactersWithInfantNearBy.TryGetValue(id, out existed) || existed.Item2 > newDistance;
									if (flag5)
									{
										this._charactersWithInfantNearBy[id] = new ValueTuple<int, int>(pair.Key, newDistance);
									}
									else
									{
										bool flag6 = existed.Item2 == newDistance && context.Random.CheckPercentProb(50);
										if (flag6)
										{
											this._charactersWithInfantNearBy[id] = new ValueTuple<int, int>(pair.Key, newDistance);
										}
									}
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x060072B2 RID: 29362 RVA: 0x00425890 File Offset: 0x00423A90
		private void PrepareEMeiPrioritizedActionData(DataContext context)
		{
			this._eMeiPsychotics.Clear();
			EventArgBox sectArgBox = DomainManager.Extra.GetSectMainStoryEventArgBox(2);
			bool flag = !sectArgBox.Contains<int>("ConchShip_PresetKey_EmeiKillEachOtherStage");
			if (!flag)
			{
				int limitation = (sectArgBox.GetInt("ConchShip_PresetKey_EmeiKillEachOtherStage") == 1) ? context.Random.Next(1, 4) : context.Random.Next(3, 10);
				Settlement settlement = DomainManager.Organization.GetSettlementByOrgTemplateId(2);
				short locationAreaId = settlement.GetLocation().AreaId;
				OrgMemberCollection orgMembers = settlement.GetMembers();
				List<int> members = context.AdvanceMonthRelatedData.CharIdList.Occupy();
				orgMembers.GetAllMembers(members);
				foreach (int charId in members)
				{
					bool flag2 = DomainManager.Extra.SectEmeiGetInsaneCharacterIdCount() >= limitation;
					if (flag2)
					{
						break;
					}
					Character character;
					bool flag3 = !DomainManager.Character.TryGetElement_Objects(charId, out character);
					if (!flag3)
					{
						bool flag4 = character.GetLocation().AreaId != locationAreaId;
						if (!flag4)
						{
							this._eMeiPsychotics.Add(charId);
						}
					}
				}
				context.AdvanceMonthRelatedData.CharIdList.Release(ref members);
			}
		}

		// Token: 0x060072B3 RID: 29363 RVA: 0x004259E4 File Offset: 0x00423BE4
		private void PrepareBaihuaPrioritizedActionData()
		{
			this.BaihuaManicCharIds.Clear();
			IntList deadCharIds = DomainManager.World.BaihuaGetSpecialDebuffIntList();
			List<int> items = deadCharIds.Items;
			bool flag = items == null || items.Count <= 0;
			if (!flag)
			{
				List<int> targets = ObjectPool<List<int>>.Instance.Get();
				targets.Clear();
				targets.AddRange(deadCharIds.Items);
				IntList cureCharIds = DomainManager.World.BaihuaGetCureSpecialDebuffIntList();
				items = cureCharIds.Items;
				bool flag2 = items != null && items.Count > 0;
				if (flag2)
				{
					targets.RemoveAll(new Predicate<int>(cureCharIds.Items.Contains));
				}
				targets.RemoveAll(new Predicate<int>(this.IsNotManicCharId));
				foreach (int target in targets)
				{
					this.BaihuaManicCharIds.Add(target);
				}
				ObjectPool<List<int>>.Instance.Return(targets);
			}
		}

		// Token: 0x060072B4 RID: 29364 RVA: 0x00425AFC File Offset: 0x00423CFC
		private bool IsNotManicCharId(int charId)
		{
			Character character;
			return !this.TryGetElement_Objects(charId, out character) || this.IsNotManicCharacter(character);
		}

		// Token: 0x060072B5 RID: 29365 RVA: 0x00425B24 File Offset: 0x00423D24
		public bool IsNotManicCharacter(Character character)
		{
			List<short> featureIds = character.GetFeatureIds();
			return !featureIds.Contains(541) && !featureIds.Contains(542);
		}

		// Token: 0x060072B6 RID: 29366 RVA: 0x00425B5C File Offset: 0x00423D5C
		public Location TryGetYuanShanEnemyLocation(DataContext context)
		{
			bool flag = this._yuanShanEnemyLocations.Count <= 0;
			Location result;
			if (flag)
			{
				result = Location.Invalid;
			}
			else
			{
				Location demonLocation = this._yuanShanEnemyLocations[context.Random.Next(this._yuanShanEnemyLocations.Count)];
				List<MapBlockData> neighborBlocks = context.AdvanceMonthRelatedData.Blocks.Occupy();
				DomainManager.Map.GetNeighborBlocks(demonLocation.AreaId, demonLocation.BlockId, neighborBlocks, 2);
				Location location = neighborBlocks.GetRandom(context.Random).GetLocation();
				context.AdvanceMonthRelatedData.Blocks.Release(ref neighborBlocks);
				result = location;
			}
			return result;
		}

		// Token: 0x060072B7 RID: 29367 RVA: 0x00425C00 File Offset: 0x00423E00
		public Location TryGetShiXiangEnemyLocation(DataContext context)
		{
			bool flag = this._shiXiangEnemyBlockIds.Count == 0;
			Location result;
			if (flag)
			{
				result = Location.Invalid;
			}
			else
			{
				result = new Location(this._shiXiangEnemyAreaId, this._shiXiangEnemyBlockIds.GetRandom(context.Random));
			}
			return result;
		}

		// Token: 0x060072B8 RID: 29368 RVA: 0x00425C48 File Offset: 0x00423E48
		public bool TryGetClosestInfant(int charId, out ValueTuple<int, int> infantData)
		{
			return this._charactersWithInfantNearBy.TryGetValue(charId, out infantData);
		}

		// Token: 0x060072B9 RID: 29369 RVA: 0x00425C68 File Offset: 0x00423E68
		public bool TryGetBloodRelationInfant(int charId, out int infantId)
		{
			return this._characterWithInfantWithBloodRelation.TryGetValue(charId, out infantId);
		}

		// Token: 0x060072BA RID: 29370 RVA: 0x00425C88 File Offset: 0x00423E88
		public bool IsEMeiCharacterPsychotic(int charId)
		{
			return this._eMeiPsychotics.Contains(charId);
		}

		// Token: 0x060072BB RID: 29371 RVA: 0x00425CA8 File Offset: 0x00423EA8
		public bool IsCharacterTryingToContestLegendaryBook(int charId)
		{
			return this._legendaryBookChallengers.Contains(charId);
		}

		// Token: 0x060072BC RID: 29372 RVA: 0x00425CC8 File Offset: 0x00423EC8
		public unsafe void GenerateCharacterProfession(DataContext context, Character character)
		{
			int charId = character.GetId();
			bool flag = charId == DomainManager.Taiwu.GetTaiwuCharId();
			if (!flag)
			{
				ProfessionData currProfession = DomainManager.Extra.GetCharacterCurrentProfession(charId);
				bool flag2 = currProfession != null;
				if (!flag2)
				{
					OrganizationMemberItem orgMemberCfg = OrganizationDomain.GetOrgMemberConfig(character.GetOrganizationInfo());
					IntPair[] preferProfessions = orgMemberCfg.PreferProfessions;
					bool flag3 = preferProfessions == null || preferProfessions.Length <= 0;
					if (!flag3)
					{
						int num = orgMemberCfg.PreferProfessions.Length;
						Span<IntPair> span = new Span<IntPair>(stackalloc byte[checked(unchecked((UIntPtr)num) * (UIntPtr)sizeof(IntPair))], num);
						SpanList<IntPair> professions = span;
						professions.AddRange(orgMemberCfg.PreferProfessions);
						CollectionUtils.Shuffle<IntPair>(context.Random, professions);
						foreach (IntPair ptr in professions)
						{
							IntPair pair = ptr;
							bool flag4 = !context.Random.CheckPercentProb(pair.Second);
							if (!flag4)
							{
								ProfessionItem professionCfg = Profession.Instance[pair.First];
								int maxSeniority = character.GetMaxProfessionSeniority(pair.First);
								int seniority = MathUtils.Clamp(professionCfg.ProfessionSeniorityPerMonth[(int)character.GetInteractionGrade()] * (int)(character.GetCurrAge() - 16) * 12, 0, maxSeniority);
								DomainManager.Extra.SetCharacterCurrProfession(context, character.GetId(), pair.First, seniority);
								break;
							}
						}
					}
				}
			}
		}

		// Token: 0x060072BD RID: 29373 RVA: 0x00425E30 File Offset: 0x00424030
		[DomainMethod]
		public ValueTuple<ushort, ushort> GetRelationBetweenCharacters(int charId, int relatedCharId)
		{
			RelationKey relationKey = new RelationKey(charId, relatedCharId);
			RelationKey reverseKey = new RelationKey(relatedCharId, charId);
			RelatedCharacter relation;
			ushort relationTypes = this._relations.TryGetValue(relationKey, out relation) ? relation.RelationType : ushort.MaxValue;
			RelatedCharacter reverseRelation;
			ushort reverseRelationTypes = this._relations.TryGetValue(reverseKey, out reverseRelation) ? reverseRelation.RelationType : ushort.MaxValue;
			return new ValueTuple<ushort, ushort>(relationTypes, reverseRelationTypes);
		}

		// Token: 0x060072BE RID: 29374 RVA: 0x00425E9C File Offset: 0x0042409C
		public RelatedCharacter GetRelation(int charId, int relatedCharId)
		{
			return this._relations[new RelationKey(charId, relatedCharId)];
		}

		// Token: 0x060072BF RID: 29375 RVA: 0x00425EC0 File Offset: 0x004240C0
		public bool TryGetRelation(int charId, int relatedCharId, out RelatedCharacter relation)
		{
			return this._relations.TryGetValue(new RelationKey(charId, relatedCharId), out relation);
		}

		// Token: 0x060072C0 RID: 29376 RVA: 0x00425EE8 File Offset: 0x004240E8
		public bool HasRelation(int charId, int relatedCharId, ushort targetRelationType)
		{
			RelatedCharacter relation;
			bool flag = this._relations.TryGetValue(new RelationKey(charId, relatedCharId), out relation);
			bool result;
			if (flag)
			{
				ushort actualRelationTypes = relation.RelationType;
				result = ((targetRelationType != 0) ? RelationType.HasRelation(actualRelationTypes, targetRelationType) : (actualRelationTypes == 0));
			}
			else
			{
				result = false;
			}
			return result;
		}

		// Token: 0x060072C1 RID: 29377 RVA: 0x00425F30 File Offset: 0x00424130
		public bool HasBloodGrandParentRelations(int charId, int relatedCharId)
		{
			HashSet<int> selfParents = this.GetRelatedCharIds(charId, 1);
			HashSet<int> targetChildren = this.GetRelatedCharIds(relatedCharId, 2);
			return selfParents.Overlaps(targetChildren);
		}

		// Token: 0x060072C2 RID: 29378 RVA: 0x00425F5C File Offset: 0x0042415C
		public bool IsCharacterRelationFriendly(int charIdA, int charIdB)
		{
			RelatedCharacter selfToTarget;
			bool hasSelfToTargetRelation = this.TryGetRelation(charIdA, charIdB, out selfToTarget);
			RelatedCharacter targetToSelf;
			bool hasTargetToSelfRelation = this.TryGetRelation(charIdB, charIdA, out targetToSelf);
			bool flag = !hasSelfToTargetRelation && !hasTargetToSelfRelation;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				sbyte categorySelfToTarget = AiHelper.ActionTargetRelationCategory.GetTargetRelationCategory(selfToTarget.RelationType);
				sbyte categoryTargetToSelf = AiHelper.ActionTargetRelationCategory.GetTargetRelationCategory(targetToSelf.RelationType);
				result = (categorySelfToTarget == 1 || categoryTargetToSelf == 1);
			}
			return result;
		}

		// Token: 0x060072C3 RID: 29379 RVA: 0x00425FC4 File Offset: 0x004241C4
		public bool IsCharacterRelationUnfriendly(int charIdA, int charIdB)
		{
			RelatedCharacter selfToTarget;
			bool hasSelfToTargetRelation = this.TryGetRelation(charIdA, charIdB, out selfToTarget);
			RelatedCharacter targetToSelf;
			bool hasTargetToSelfRelation = this.TryGetRelation(charIdB, charIdA, out targetToSelf);
			bool flag = !hasSelfToTargetRelation && !hasTargetToSelfRelation;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				sbyte categorySelfToTarget = AiHelper.ActionTargetRelationCategory.GetTargetRelationCategory(selfToTarget.RelationType);
				sbyte categoryTargetToSelf = AiHelper.ActionTargetRelationCategory.GetTargetRelationCategory(targetToSelf.RelationType);
				result = (categorySelfToTarget == 2 || categoryTargetToSelf == 2);
			}
			return result;
		}

		// Token: 0x060072C4 RID: 29380 RVA: 0x0042602C File Offset: 0x0042422C
		[DomainMethod]
		public bool IsInteractedWithTaiwu(int charId)
		{
			return DomainManager.Extra.GetIsInteractedCharacter(charId);
		}

		// Token: 0x060072C5 RID: 29381 RVA: 0x0042604C File Offset: 0x0042424C
		public sbyte GetFavorabilityType(int charId, int relatedCharId)
		{
			short favorability = this.GetFavorability(charId, relatedCharId);
			return FavorabilityType.GetFavorabilityType(favorability);
		}

		// Token: 0x060072C6 RID: 29382 RVA: 0x00426070 File Offset: 0x00424270
		[DomainMethod]
		public short GetFavorability(int charId, int relatedCharId)
		{
			RelatedCharacter relation;
			return this.TryGetRelation(charId, relatedCharId, out relation) ? relation.Favorability : short.MinValue;
		}

		// Token: 0x060072C7 RID: 29383 RVA: 0x0042609C File Offset: 0x0042429C
		public short GetFavorabilityMaxValueToTaiwuWithDebt(int charId)
		{
			Debts debt;
			bool flag = !this._debtsToTaiwu.TryGetValue(charId, out debt);
			short result;
			if (flag)
			{
				result = 30000;
			}
			else
			{
				result = debt.GetMaxFavorabilityWithDebt();
			}
			return result;
		}

		// Token: 0x060072C8 RID: 29384 RVA: 0x004260D1 File Offset: 0x004242D1
		[Obsolete("Use ChangeFavorabilityOptional instead")]
		public void ChangeFavorability(DataContext context, Character character, Character relatedChar, int baseDelta)
		{
			this.ChangeFavorabilityOptional(context, character, relatedChar, baseDelta, -1);
		}

		// Token: 0x060072C9 RID: 29385 RVA: 0x004260E4 File Offset: 0x004242E4
		public void ChangeFavorabilityOptional(DataContext context, Character character, Character relatedChar, int baseDelta, short type)
		{
			Tester.Assert(character.GetCreatingType() == 1, "");
			Tester.Assert(relatedChar.GetCreatingType() == 1, "");
			int delta = CharacterDomain.CalcFavorabilityDelta(character, relatedChar, baseDelta, type);
			this.DirectlyChangeFavorabilityOptional(context, character, relatedChar, delta, -1);
		}

		// Token: 0x060072CA RID: 29386 RVA: 0x00426132 File Offset: 0x00424332
		public void ChangeFavorabilityOptionalMonthlyEvolution(DataContext context, Character character, Character relatedChar, int baseDelta)
		{
			this.ChangeFavorabilityOptional(context, character, relatedChar, baseDelta, 5);
		}

		// Token: 0x060072CB RID: 29387 RVA: 0x00426142 File Offset: 0x00424342
		public void ChangeFavorabilityOptionalGiftItem(DataContext context, Character character, Character relatedChar, int baseDelta)
		{
			this.ChangeFavorabilityOptional(context, character, relatedChar, baseDelta, 1);
		}

		// Token: 0x060072CC RID: 29388 RVA: 0x00426152 File Offset: 0x00424352
		public void ChangeFavorabilityOptionalRepeatedEvent(DataContext context, Character character, Character relatedChar, int baseDelta)
		{
			this.ChangeFavorabilityOptional(context, character, relatedChar, baseDelta, 3);
		}

		// Token: 0x060072CD RID: 29389 RVA: 0x00426162 File Offset: 0x00424362
		[Obsolete("Use DirectlyChangeFavorabilityOptional instead")]
		public void DirectlyChangeFavorability(DataContext context, Character character, Character relatedChar, int delta)
		{
			this.DirectlyChangeFavorabilityOptional(context, character, relatedChar, delta, -1);
		}

		// Token: 0x060072CE RID: 29390 RVA: 0x00426174 File Offset: 0x00424374
		public void DirectlyChangeFavorabilityOptional(DataContext context, Character character, Character relatedChar, int delta, short type)
		{
			byte creatingType = character.GetCreatingType();
			bool condition = creatingType <= 1;
			Tester.Assert(condition, "");
			creatingType = relatedChar.GetCreatingType();
			condition = (creatingType <= 1);
			Tester.Assert(condition, "");
			int charId = character.GetId();
			int relatedCharId = relatedChar.GetId();
			RelationKey relationKey = new RelationKey(charId, relatedCharId);
			RelatedCharacter relation;
			bool flag = !this._relations.TryGetValue(relationKey, out relation);
			if (flag)
			{
				ValueTuple<short, short> valueTuple = CharacterDomain.CalcInitialFavorabilitiesOfAliveChars(context.Random, character, relatedChar);
				short favor = valueTuple.Item1;
				short relatedFavor = valueTuple.Item2;
				this.CreateRelation(context, charId, relatedCharId, 0, favor, int.MinValue);
				this.CreateRelation(context, relatedCharId, charId, 0, relatedFavor, int.MinValue);
				relation = this._relations[relationKey];
			}
			ValueTuple<int, bool> favFactor = DomainManager.World.GetFavorabilityChangePercent(type, character.IsFavorabilityGainFixed);
			delta = ((delta < 0 && favFactor.Item2) ? (delta * 100 / favFactor.Item1) : (delta * favFactor.Item1 / 100));
			bool flag2 = relatedCharId == DomainManager.Taiwu.GetTaiwuCharId();
			if (flag2)
			{
				relation.Favorability = (short)Math.Clamp((int)relation.Favorability + delta, -30000, (int)this.GetFavorabilityMaxValueToTaiwuWithDebt(charId));
				bool flag3 = FavorabilityType.GetFavorabilityType(relation.Favorability) >= 3;
				if (flag3)
				{
					character.SetLovingItemRevealed(true, context);
					character.SetHatingItemRevealed(true, context);
				}
			}
			else
			{
				relation.Favorability = (short)Math.Clamp((int)relation.Favorability + delta, -30000, 30000);
			}
			this.SetElement_Relations(relationKey, relation, context);
		}

		// Token: 0x060072CF RID: 29391 RVA: 0x00426317 File Offset: 0x00424517
		public void DirectlySetFavorabilities(DataContext context, int charId, int relatedCharId, short value, short relatedValue)
		{
			this.SetFavorability(context, charId, relatedCharId, value);
			this.SetFavorability(context, relatedCharId, charId, relatedValue);
		}

		// Token: 0x060072D0 RID: 29392 RVA: 0x00426334 File Offset: 0x00424534
		public void DirectlyUpgradeFavorability(DataContext context, int charA, int charB)
		{
			short favorability = DomainManager.Character.GetFavorability(charA, charB);
			sbyte favorabilityType = FavorabilityType.GetFavorabilityType(favorability);
			favorabilityType += 1;
			bool flag = favorabilityType >= 6;
			if (flag)
			{
				favorabilityType = 6;
			}
			favorability = FavorabilityType.GetRandomFavorability(context.Random, favorabilityType);
			this.DirectlySetFavorabilities(context, charA, charB, favorability, favorability);
		}

		// Token: 0x060072D1 RID: 29393 RVA: 0x00426384 File Offset: 0x00424584
		public void ChangeFavorabilityTendToZero(DataContext context, int charId, int targetCharId, int delta)
		{
			short favorability = this.GetFavorability(charId, targetCharId);
			bool flag = favorability == short.MinValue || favorability == 0;
			bool flag2 = flag;
			if (!flag2)
			{
				short value = (favorability > 0) ? ((short)Math.Max(0, (int)favorability - delta)) : ((short)Math.Min(0, (int)favorability + delta));
				this.SetFavorability(context, charId, targetCharId, value);
			}
		}

		// Token: 0x060072D2 RID: 29394 RVA: 0x004263E0 File Offset: 0x004245E0
		[return: TupleElementNames(new string[]
		{
			"charId",
			"favorability"
		})]
		public List<ValueTuple<int, short>> ChangeFavorabilitiesOfAllRelatedCharsWhenChangingHobby(DataContext context, Character character)
		{
			int charId = character.GetId();
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			HashSet<int> relatedCharIds = context.AdvanceMonthRelatedData.RelatedCharIds.Occupy();
			this.GetAllRelatedCharIds(charId, relatedCharIds, true);
			bool flag = relatedCharIds.Count <= 0;
			List<ValueTuple<int, short>> result;
			if (flag)
			{
				context.AdvanceMonthRelatedData.RelatedCharIds.Release(ref relatedCharIds);
				result = null;
			}
			else
			{
				sbyte behaviorType = character.GetBehaviorType();
				ValueTuple<short, short> valueTuple = CharacterDomain.BaseChangedFavorabilitiesOfChangingHobby[(int)behaviorType];
				short positive = valueTuple.Item1;
				short negative = valueTuple.Item2;
				List<ValueTuple<int, short>> favorabilitiesOfRelatedChars = new List<ValueTuple<int, short>>();
				foreach (int relatedCharId in relatedCharIds)
				{
					bool flag2 = !this.IsCharacterAlive(relatedCharId);
					if (!flag2)
					{
						RelatedCharacter relation = this._relations[new RelationKey(charId, relatedCharId)];
						short oriFavor = relation.Favorability;
						sbyte favorabilityType = FavorabilityType.GetFavorabilityType(oriFavor);
						sbyte factor = CharacterDomain.FavorabilityChangingFactorsOfChangingHobby[(int)FavorabilityType.ToIndex(favorabilityType)];
						int delta = (int)(((favorabilityType >= 0) ? positive : negative) * (short)factor / 100);
						short maxValue = (relatedCharId == taiwuCharId) ? this.GetFavorabilityMaxValueToTaiwuWithDebt(charId) : 30000;
						short newFavor = (short)Math.Clamp((int)oriFavor + delta, -30000, (int)maxValue);
						bool flag3 = newFavor != oriFavor;
						if (flag3)
						{
							favorabilitiesOfRelatedChars.Add(new ValueTuple<int, short>(relatedCharId, newFavor));
						}
					}
				}
				context.AdvanceMonthRelatedData.RelatedCharIds.Release(ref relatedCharIds);
				result = ((favorabilitiesOfRelatedChars.Count > 0) ? favorabilitiesOfRelatedChars : null);
			}
			return result;
		}

		// Token: 0x060072D3 RID: 29395 RVA: 0x00426588 File Offset: 0x00424788
		public void ApplyFavorabilitiesOfRelatedCharsWhenChangingHobby(DataContext context, int charId, [TupleElementNames(new string[]
		{
			"charId",
			"favorability"
		})] List<ValueTuple<int, short>> relatedChars)
		{
			int i = 0;
			int count = relatedChars.Count;
			while (i < count)
			{
				ValueTuple<int, short> valueTuple = relatedChars[i];
				int relatedCharId = valueTuple.Item1;
				short favorability = valueTuple.Item2;
				bool flag = !this.IsCharacterAlive(relatedCharId);
				if (!flag)
				{
					RelationKey relationKey = new RelationKey(charId, relatedCharId);
					RelatedCharacter relation = this._relations[relationKey];
					relation.Favorability = favorability;
					this.SetElement_Relations(relationKey, relation, context);
				}
				i++;
			}
		}

		// Token: 0x060072D4 RID: 29396 RVA: 0x00426604 File Offset: 0x00424804
		public void TryEnterTaiwuDreamWhenReincarnated(int reincarnatedCharId, short settlementId)
		{
			bool flag = settlementId < 0 || DomainManager.World.GetAdvancingMonthState() == 0;
			if (!flag)
			{
				int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
				RelatedCharacter relation;
				bool flag2 = !this.TryGetRelation(reincarnatedCharId, taiwuCharId, out relation);
				if (!flag2)
				{
					sbyte favorType = FavorabilityType.GetFavorabilityType(relation.Favorability);
					RelatedCharacter taiwuToTarget;
					bool flag3 = favorType < 5 && favorType > -5 && relation.RelationType == 0 && (!this.TryGetRelation(taiwuCharId, reincarnatedCharId, out taiwuToTarget) || taiwuToTarget.RelationType == 0);
					if (!flag3)
					{
						MonthlyNotificationCollection monthlyNotifications = DomainManager.World.GetMonthlyNotificationCollection();
						monthlyNotifications.AddReincarnationNewWithLocation(taiwuCharId, reincarnatedCharId, DomainManager.Organization.GetSettlement(settlementId).GetLocation());
					}
				}
			}
		}

		// Token: 0x060072D5 RID: 29397 RVA: 0x004266B8 File Offset: 0x004248B8
		public void TransferFixedCharacterFavorability(DataContext context, int oldTaiwuCharId, int newTaiwuCharId)
		{
			List<int> fixedCharList = ObjectPool<List<int>>.Instance.Get();
			fixedCharList.Clear();
			fixedCharList.AddRange(this._fixedCharactersCache.Values);
			foreach (int charId in fixedCharList)
			{
				Character character = this._objects[charId];
				short templateId = character.GetTemplateId();
				short num = templateId;
				short num2 = num;
				if (num2 == 810 || num2 == 812)
				{
					short favorability = this.GetFavorability(charId, oldTaiwuCharId);
					this.DirectlySetFavorabilities(context, charId, newTaiwuCharId, favorability, favorability);
				}
			}
			ObjectPool<List<int>>.Instance.Return(fixedCharList);
		}

		// Token: 0x060072D6 RID: 29398 RVA: 0x00426784 File Offset: 0x00424984
		public void GetPotentialRelatedCharactersInSet(PotentialRelatedCharacters canStartRelationChars, PotentialRelatedCharacters canEndRelationChars, List<Character> needToCreateRelations, Character character, HashSet<int> blockCharSet)
		{
			canStartRelationChars.OfflineClear();
			canEndRelationChars.OfflineClear();
			int charId = character.GetId();
			short charAge = character.GetCurrAge();
			sbyte charAgeGroup = AgeGroup.GetAgeGroup(charAge);
			bool charIsMarried = this.GetAliveSpouse(charId) >= 0 || !character.GetOrganizationInfo().Principal;
			bool charCanMarry = character.OrgAndMonkTypeAllowMarriage();
			sbyte selfBehaviorType = character.GetBehaviorType();
			sbyte selfOrgTemplateId = character.GetOrganizationInfo().OrgTemplateId;
			foreach (int blockCharId in blockCharSet)
			{
				bool flag = charId == blockCharId;
				if (!flag)
				{
					RelatedCharacter selfToTarget;
					bool flag2 = !this.TryGetRelation(charId, blockCharId, out selfToTarget);
					if (flag2)
					{
						needToCreateRelations.Add(DomainManager.Character.GetElement_Objects(blockCharId));
					}
					else
					{
						RelatedCharacter targetToSelf;
						bool flag3 = !this.TryGetRelation(blockCharId, charId, out targetToSelf);
						if (!flag3)
						{
							Character blockChar = DomainManager.Character.GetElement_Objects(blockCharId);
							sbyte targetBehaviorType = blockChar.GetBehaviorType();
							short targetAge = blockChar.GetCurrAge();
							sbyte blockCharAgeGroup = AgeGroup.GetAgeGroup(targetAge);
							bool flag4 = blockCharAgeGroup == 0;
							if (!flag4)
							{
								bool flag5 = blockChar.GetLegendaryBookOwnerState() > 1;
								if (!flag5)
								{
									bool flag6 = AiHelper.Relation.CanStartRelation_Enemy(selfToTarget, selfBehaviorType);
									if (flag6)
									{
										canStartRelationChars.Enemies.Add(blockCharId);
									}
									else
									{
										bool flag7 = AiHelper.Relation.CanEndRelation_Enemy(selfToTarget, selfBehaviorType);
										if (flag7)
										{
											canEndRelationChars.Enemies.Add(blockCharId);
										}
									}
									bool flag8 = AiHelper.Relation.CanStartRelation_Friend(selfToTarget, selfBehaviorType, targetToSelf, targetBehaviorType);
									if (flag8)
									{
										canStartRelationChars.Friends.Add(blockCharId);
									}
									else
									{
										bool flag9 = AiHelper.Relation.CanEndRelation_Friend(selfToTarget, selfBehaviorType);
										if (flag9)
										{
											canEndRelationChars.Friends.Add(blockCharId);
										}
									}
									bool flag10 = AiHelper.Relation.CanStartRelation_SwornBrotherOrSister(selfToTarget, selfBehaviorType, targetToSelf, targetBehaviorType);
									if (flag10)
									{
										canStartRelationChars.SwornBrothersAndSisters.Add(blockCharId);
									}
									else
									{
										bool flag11 = AiHelper.Relation.CanEndRelation_SwornBrotherOrSister(selfToTarget, selfBehaviorType);
										if (flag11)
										{
											canEndRelationChars.SwornBrothersAndSisters.Add(blockCharId);
										}
									}
									bool flag12 = AiHelper.Relation.CanStartRelation_AdoptiveParent(charId, selfToTarget, charAge, blockCharId, targetToSelf, targetAge);
									if (flag12)
									{
										canStartRelationChars.AdoptiveParents.Add(blockCharId);
									}
									else
									{
										bool flag13 = AiHelper.Relation.CanStartRelation_AdoptiveChild(charId, selfToTarget, charAge, blockCharId, targetToSelf, targetAge);
										if (flag13)
										{
											canStartRelationChars.AdoptiveChildren.Add(blockCharId);
										}
									}
									bool flag14 = charAgeGroup != 2 || blockCharAgeGroup != 2;
									if (!flag14)
									{
										bool flag15 = !RelationType.HasRelation(selfToTarget.RelationType, 1024);
										if (flag15)
										{
											bool flag16 = AiHelper.Relation.CanStartRelation_Adored(selfToTarget, selfBehaviorType);
											if (flag16)
											{
												canStartRelationChars.Adored.Add(blockCharId);
											}
											else
											{
												bool flag17 = AiHelper.Relation.CanStartRelation_BoyOrGirlFriend(selfToTarget, selfBehaviorType, targetToSelf, targetBehaviorType);
												if (flag17)
												{
													canStartRelationChars.BoyAndGirlFriends.Add(blockCharId);
												}
											}
										}
										bool flag18 = AiHelper.Relation.CanEndRelation_BoyOrGirlFriend(selfToTarget, selfBehaviorType, targetToSelf, targetBehaviorType);
										if (flag18)
										{
											canEndRelationChars.BoyAndGirlFriends.Add(blockCharId);
										}
										else
										{
											bool flag19 = AiHelper.Relation.CanEndRelation_HusbandOrWife(selfToTarget, selfBehaviorType);
											if (flag19)
											{
												canEndRelationChars.HusbandsAndWives.Add(blockCharId);
											}
											else
											{
												OrganizationInfo blockCharOrgInfo = blockChar.GetOrganizationInfo();
												sbyte orgTemplateId = blockCharOrgInfo.OrgTemplateId;
												sbyte b = orgTemplateId;
												if (b != 0)
												{
													if (b != 16)
													{
														bool flag20 = selfOrgTemplateId == 0 || selfOrgTemplateId == 16;
														bool flag21 = flag20;
														if (flag21)
														{
															continue;
														}
													}
													else
													{
														bool flag22 = selfOrgTemplateId != 16;
														if (flag22)
														{
															continue;
														}
													}
												}
												else
												{
													bool flag23 = selfOrgTemplateId != 0;
													if (flag23)
													{
														continue;
													}
												}
												bool blockCharIsMarried = this.GetAliveSpouse(blockCharId) >= 0 || !blockCharOrgInfo.Principal;
												bool blockCharCanMarry = blockChar.OrgAndMonkTypeAllowMarriage();
												bool flag24 = charCanMarry && blockCharCanMarry && !charIsMarried && !blockCharIsMarried && AiHelper.Relation.CanStartRelation_HusbandOrWife(charId, selfToTarget, selfBehaviorType, blockCharId, targetToSelf, targetBehaviorType);
												if (flag24)
												{
													canStartRelationChars.HusbandsAndWives.Add(blockCharId);
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x060072D7 RID: 29399 RVA: 0x00426B74 File Offset: 0x00424D74
		public HashSet<int> GetRelatedCharIds(int charId, ushort relationType)
		{
			RelatedCharacters relatedChars;
			return this._relatedCharIds.TryGetValue(charId, out relatedChars) ? relatedChars.GetCharacterSet(relationType).GetCollection() : CharacterDomain.EmptyCharacterSet;
		}

		// Token: 0x060072D8 RID: 29400 RVA: 0x00426BAC File Offset: 0x00424DAC
		public RelatedCharacters GetRelatedCharacters(int charId)
		{
			RelatedCharacters relatedChars;
			return this._relatedCharIds.TryGetValue(charId, out relatedChars) ? relatedChars : null;
		}

		// Token: 0x060072D9 RID: 29401 RVA: 0x00426BD4 File Offset: 0x00424DD4
		public void GetAllRelatedCharIds(int charId, HashSet<int> relatedCharIds, bool includeGeneral = true)
		{
			RelatedCharacters relatedChars;
			bool flag = this._relatedCharIds.TryGetValue(charId, out relatedChars);
			if (flag)
			{
				relatedChars.GetAllRelatedCharIds(relatedCharIds, includeGeneral);
			}
		}

		// Token: 0x060072DA RID: 29402 RVA: 0x00426C00 File Offset: 0x00424E00
		public void GetAllTwoWayRelatedCharIds(int charId, HashSet<int> relatedCharIds)
		{
			RelatedCharacters relatedChars;
			bool flag = this._relatedCharIds.TryGetValue(charId, out relatedChars);
			if (flag)
			{
				relatedChars.GetAllTwoWayRelatedCharIds(relatedCharIds);
			}
		}

		// Token: 0x060072DB RID: 29403 RVA: 0x00426C28 File Offset: 0x00424E28
		public void GetAllRelatedDeadCharIds(int charId, HashSet<int> relatedCharIds, bool includeGeneral)
		{
			relatedCharIds.Clear();
			this.GetAllRelatedCharIds(charId, relatedCharIds, includeGeneral);
			relatedCharIds.RemoveWhere(new Predicate<int>(this.IsCharacterAlive));
		}

		// Token: 0x060072DC RID: 29404 RVA: 0x00426C50 File Offset: 0x00424E50
		public bool HasEnoughBloodParents(int charId)
		{
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			return !flag && relatedChars.BloodParents.GetCount() >= 2;
		}

		// Token: 0x060072DD RID: 29405 RVA: 0x00426C8C File Offset: 0x00424E8C
		public int GetAliveMentor(int charId)
		{
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			int result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				HashSet<int> mentorCharIds = relatedChars.Mentors.GetCollection();
				foreach (int mentorCharId in mentorCharIds)
				{
					bool flag2 = this.IsCharacterAlive(mentorCharId);
					if (flag2)
					{
						return mentorCharId;
					}
				}
				result = -1;
			}
			return result;
		}

		// Token: 0x060072DE RID: 29406 RVA: 0x00426D18 File Offset: 0x00424F18
		public int GetAliveParent(int charId)
		{
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			int result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				HashSet<int> bloodParentCharIds = relatedChars.BloodParents.GetCollection();
				foreach (int parentCharId in bloodParentCharIds)
				{
					bool flag2 = this.IsCharacterAlive(parentCharId);
					if (flag2)
					{
						return parentCharId;
					}
				}
				HashSet<int> adoptiveParentCharIds = relatedChars.AdoptiveParents.GetCollection();
				foreach (int parentCharId2 in adoptiveParentCharIds)
				{
					bool flag3 = this.IsCharacterAlive(parentCharId2);
					if (flag3)
					{
						return parentCharId2;
					}
				}
				HashSet<int> stepParentCharIds = relatedChars.StepParents.GetCollection();
				foreach (int parentCharId3 in stepParentCharIds)
				{
					bool flag4 = this.IsCharacterAlive(parentCharId3);
					if (flag4)
					{
						return parentCharId3;
					}
				}
				result = -1;
			}
			return result;
		}

		// Token: 0x060072DF RID: 29407 RVA: 0x00426E64 File Offset: 0x00425064
		public int GetAliveChild(int charId)
		{
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			int result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				HashSet<int> bloodChildrenCharIds = relatedChars.BloodChildren.GetCollection();
				foreach (int childCharId in bloodChildrenCharIds)
				{
					bool flag2 = this.IsCharacterAlive(childCharId);
					if (flag2)
					{
						return childCharId;
					}
				}
				HashSet<int> adoptiveChildrenCharIds = relatedChars.AdoptiveChildren.GetCollection();
				foreach (int childCharId2 in adoptiveChildrenCharIds)
				{
					bool flag3 = this.IsCharacterAlive(childCharId2);
					if (flag3)
					{
						return childCharId2;
					}
				}
				HashSet<int> stepChildrenCharIds = relatedChars.StepChildren.GetCollection();
				foreach (int childCharId3 in stepChildrenCharIds)
				{
					bool flag4 = this.IsCharacterAlive(childCharId3);
					if (flag4)
					{
						return childCharId3;
					}
				}
				result = -1;
			}
			return result;
		}

		// Token: 0x060072E0 RID: 29408 RVA: 0x00426FB0 File Offset: 0x004251B0
		public int GetAliveSpouse(int charId)
		{
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			int result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				HashSet<int> spouseCharIds = relatedChars.HusbandsAndWives.GetCollection();
				foreach (int spouseCharId in spouseCharIds)
				{
					bool flag2 = this.IsCharacterAlive(spouseCharId);
					if (flag2)
					{
						return spouseCharId;
					}
				}
				result = -1;
			}
			return result;
		}

		// Token: 0x060072E1 RID: 29409 RVA: 0x0042703C File Offset: 0x0042523C
		public int GetLastSpouse(int charId)
		{
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			int result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				HashSet<int> spouseCharIds = relatedChars.HusbandsAndWives.GetCollection();
				foreach (int spouseCharId in spouseCharIds)
				{
					bool flag2 = this.IsCharacterAlive(spouseCharId);
					if (flag2)
					{
						return spouseCharId;
					}
				}
				int maxDeathDate = int.MinValue;
				int selectedSpouseCharId = -1;
				foreach (int spouseCharId2 in spouseCharIds)
				{
					DeadCharacter deadChar;
					bool flag3 = !this.TryGetElement_DeadCharacters(spouseCharId2, out deadChar);
					if (flag3)
					{
						return spouseCharId2;
					}
					bool flag4 = deadChar.DeathDate > maxDeathDate;
					if (flag4)
					{
						maxDeathDate = deadChar.DeathDate;
						selectedSpouseCharId = spouseCharId2;
					}
				}
				result = selectedSpouseCharId;
			}
			return result;
		}

		// Token: 0x060072E2 RID: 29410 RVA: 0x0042714C File Offset: 0x0042534C
		[DomainMethod]
		public RelatedCharactersForRelations GetRelatedCharactersForRelations(int charId)
		{
			Character character;
			bool flag = DomainManager.Character.TryGetElement_Objects(charId, out character) && character.GetSrcCharId() >= 0;
			if (flag)
			{
				charId = character.GetSrcCharId();
			}
			RelatedCharacters relatedChars;
			bool flag2 = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			RelatedCharactersForRelations result;
			if (flag2)
			{
				result = new RelatedCharactersForRelations();
			}
			else
			{
				RelatedCharactersForRelations collection = new RelatedCharactersForRelations(relatedChars);
				collection.RelatedAdored = this.GetReversedRelatedCharIds(charId, 16384);
				collection.RelatedEnemies = this.GetReversedRelatedCharIds(charId, 32768);
				bool flag3 = character != null && character.GetFactionId() >= 0;
				if (flag3)
				{
					collection.FactionMembers.AddRange(DomainManager.Organization.GetElement_Factions(collection.FactionLeaderId = character.GetFactionId()).GetCollection());
				}
				else
				{
					collection.FactionLeaderId = -1;
				}
				result = collection;
			}
			return result;
		}

		// Token: 0x060072E3 RID: 29411 RVA: 0x00427230 File Offset: 0x00425430
		[DomainMethod]
		public void TryCreateRelation(DataContext context, int charId, int relatedCharId)
		{
			bool flag = charId == relatedCharId;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(41, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Cannot create relationship with oneself: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(relatedCharId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			bool flag2 = this._relations.ContainsKey(new RelationKey(charId, relatedCharId));
			if (!flag2)
			{
				Character character = this._objects[charId];
				Character relatedChar = this._objects[relatedCharId];
				bool flag3 = character.GetCreatingType() != 1 || relatedChar.GetCreatingType() != 1;
				if (flag3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(45, 2);
					defaultInterpolatedStringHandler.AppendLiteral("Both sides must be intelligent characters: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
					defaultInterpolatedStringHandler.AppendLiteral(", ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(relatedCharId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				ValueTuple<short, short> valueTuple = CharacterDomain.CalcInitialFavorabilitiesOfAliveChars(context.Random, character, relatedChar);
				short favor = valueTuple.Item1;
				short relatedFavor = valueTuple.Item2;
				this.CreateRelation(context, charId, relatedCharId, 0, favor, int.MinValue);
				this.CreateRelation(context, relatedCharId, charId, 0, relatedFavor, int.MinValue);
				bool flag4 = charId == DomainManager.Taiwu.GetTaiwuCharId() || relatedCharId == DomainManager.Taiwu.GetTaiwuCharId();
				if (flag4)
				{
					DomainManager.Taiwu.AddLegacyPoint(context, 0, 100);
				}
			}
		}

		// Token: 0x060072E4 RID: 29412 RVA: 0x0042737C File Offset: 0x0042557C
		[DomainMethod]
		public void TryAddAndApplyOneWayRelation(DataContext context, int charId, int relatedCharId, ushort relationType)
		{
			bool flag = !RelationType.IsOneWayRelation(relationType);
			if (flag)
			{
				throw new Exception("Cannot add two way relation directly.");
			}
			bool flag2 = this.HasRelation(charId, relatedCharId, relationType);
			if (!flag2)
			{
				int currDate = DomainManager.World.GetCurrDate();
				int taiwuId = DomainManager.Taiwu.GetTaiwuCharId();
				Location selfCharLocation = this.GetElement_Objects(charId).GetValidLocation();
				Location targetCharLocation = this.GetElement_Objects(relatedCharId).GetValidLocation();
				DomainManager.Character.AddRelation(context, charId, relatedCharId, relationType, currDate);
				bool flag3 = relationType == 16384;
				if (flag3)
				{
					DomainManager.LifeRecord.GetLifeRecordCollection().AddAdore(charId, currDate, relatedCharId, selfCharLocation);
					bool flag4 = DomainManager.Character.HasRelation(relatedCharId, charId, relationType);
					if (flag4)
					{
						Character selfChar = this.GetElement_Objects(charId);
						Character targetChar = this.GetElement_Objects(relatedCharId);
						DomainManager.Character.ChangeFavorabilityOptional(context, selfChar, targetChar, 3000, 3);
						DomainManager.Character.ChangeFavorabilityOptional(context, targetChar, selfChar, 3000, 3);
						selfChar.ChangeHappiness(context, (int)AiHelper.RelationsRelatedConstants.ConfessLoveSucceedHappinessChange[(int)selfChar.GetBehaviorType()]);
						SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
						int secretInfoOffset = secretInformationCollection.AddBecomeLover(charId, relatedCharId);
						int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
						bool flag5 = this.IsTaiwuPeople(charId);
						if (flag5)
						{
							DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, taiwuId, charId);
						}
					}
				}
				else
				{
					bool flag6 = relationType == 32768;
					if (flag6)
					{
						DomainManager.LifeRecord.GetLifeRecordCollection().AddMakeEnemy(charId, currDate, relatedCharId, selfCharLocation);
						SecretInformationCollection secretInformationCollection2 = DomainManager.Information.GetSecretInformationCollection();
						int secretInfoOffset2 = secretInformationCollection2.AddBecomeEnemy(charId, relatedCharId);
						int secretInfoId2 = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset2, true);
						bool flag7 = this.IsTaiwuPeople(charId);
						if (flag7)
						{
							DomainManager.Information.ReceiveSecretInformation(context, secretInfoId2, taiwuId, charId);
						}
					}
				}
				bool flag8 = charId == taiwuId && targetCharLocation != Location.Invalid;
				if (flag8)
				{
					MapBlockData blockData = DomainManager.Map.GetBlock(targetCharLocation);
					DomainManager.Map.SetBlockData(context, blockData);
				}
				else
				{
					bool flag9 = relatedCharId == taiwuId && selfCharLocation != Location.Invalid;
					if (flag9)
					{
						MapBlockData blockData2 = DomainManager.Map.GetBlock(selfCharLocation);
						DomainManager.Map.SetBlockData(context, blockData2);
					}
				}
			}
		}

		// Token: 0x060072E5 RID: 29413 RVA: 0x004275AC File Offset: 0x004257AC
		[DomainMethod]
		public void TryRemoveOneWayRelation(DataContext context, int charId, int relatedCharId, ushort relationType)
		{
			bool flag = !RelationType.IsOneWayRelation(relationType);
			if (flag)
			{
				throw new Exception("Cannot remove two way relation directly.");
			}
			bool flag2 = !this.HasRelation(charId, relatedCharId, relationType);
			if (!flag2)
			{
				int taiwuId = DomainManager.Taiwu.GetTaiwuCharId();
				Location selfCharLocation = this.GetElement_Objects(charId).GetValidLocation();
				Location targetCharLocation = this.GetElement_Objects(relatedCharId).GetValidLocation();
				bool flag3 = relationType == 16384;
				if (flag3)
				{
					bool flag4 = DomainManager.Character.HasRelation(relatedCharId, charId, relationType);
					if (flag4)
					{
						Character selfChar = this.GetElement_Objects(charId);
						Character targetChar = this.GetElement_Objects(relatedCharId);
						Character.ApplyBreakupWithBoyOrGirlFriend(context, selfChar, targetChar, selfChar.GetBehaviorType(), context.Random.CheckPercentProb((int)AiHelper.RelationsRelatedConstants.BreakupMutuallyChance[(int)targetChar.GetBehaviorType()]), this.IsTaiwuPeople(charId), this.IsTaiwuPeople(relatedCharId));
					}
					else
					{
						DomainManager.Character.ChangeRelationType(context, charId, relatedCharId, relationType, 0);
					}
				}
				else
				{
					bool flag5 = relationType == 32768;
					if (flag5)
					{
						int currDate = DomainManager.World.GetCurrDate();
						DomainManager.Character.ChangeRelationType(context, charId, relatedCharId, relationType, 0);
						DomainManager.LifeRecord.GetLifeRecordCollection().AddSeverEnemy(charId, currDate, relatedCharId, selfCharLocation);
						SecretInformationCollection secretInformationCollection = DomainManager.Information.GetSecretInformationCollection();
						int secretInfoOffset = secretInformationCollection.AddSeverEnemy(charId, relatedCharId);
						int secretInfoId = DomainManager.Information.AddSecretInformationMetaData(context, secretInfoOffset, true);
						bool flag6 = this.IsTaiwuPeople(charId);
						if (flag6)
						{
							DomainManager.Information.ReceiveSecretInformation(context, secretInfoId, taiwuId, charId);
						}
					}
				}
				bool flag7 = charId == taiwuId && targetCharLocation != Location.Invalid;
				if (flag7)
				{
					MapBlockData blockData = DomainManager.Map.GetBlock(targetCharLocation);
					DomainManager.Map.SetBlockData(context, blockData);
				}
				else
				{
					bool flag8 = relatedCharId == taiwuId && selfCharLocation != Location.Invalid;
					if (flag8)
					{
						MapBlockData blockData2 = DomainManager.Map.GetBlock(selfCharLocation);
						DomainManager.Map.SetBlockData(context, blockData2);
					}
				}
			}
		}

		// Token: 0x060072E6 RID: 29414 RVA: 0x00427790 File Offset: 0x00425990
		public void TryCreateGeneralRelation(DataContext context, Character selfChar, Character relatedChar)
		{
			int selfCharId = selfChar.GetId();
			int relatedCharId = relatedChar.GetId();
			bool flag = this._relations.ContainsKey(new RelationKey(selfCharId, relatedCharId));
			if (!flag)
			{
				bool flag2 = selfChar.GetCreatingType() != 1 || relatedChar.GetCreatingType() != 1;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(45, 2);
					defaultInterpolatedStringHandler.AppendLiteral("Both sides must be intelligent characters: ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(selfCharId);
					defaultInterpolatedStringHandler.AppendLiteral(", ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(relatedCharId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				ValueTuple<short, short> valueTuple = CharacterDomain.CalcInitialFavorabilitiesOfAliveChars(context.Random, selfChar, relatedChar);
				short favor = valueTuple.Item1;
				short relatedFavor = valueTuple.Item2;
				this.CreateRelation(context, selfCharId, relatedCharId, 0, favor, int.MinValue);
				this.CreateRelation(context, relatedCharId, selfCharId, 0, relatedFavor, int.MinValue);
			}
		}

		// Token: 0x060072E7 RID: 29415 RVA: 0x00427868 File Offset: 0x00425A68
		public void AddBloodParentRelations(DataContext context, int charId, int bloodParentCharId, int establishmentDate = -2147483648)
		{
			this.AddRelation(context, charId, bloodParentCharId, 1, establishmentDate);
			HashSet<int> bloodChildIds = this.GetRelatedCharIds(bloodParentCharId, 2);
			foreach (int childId in bloodChildIds)
			{
				bool flag = childId == charId;
				if (!flag)
				{
					this.AddRelation(context, charId, childId, 4, establishmentDate);
				}
			}
			HashSet<int> stepChildIds = this.GetRelatedCharIds(bloodParentCharId, 16);
			foreach (int childId2 in stepChildIds)
			{
				this.AddRelation(context, charId, childId2, 32, establishmentDate);
			}
			HashSet<int> adoptiveChildIds = this.GetRelatedCharIds(bloodParentCharId, 128);
			foreach (int childId3 in adoptiveChildIds)
			{
				this.AddRelation(context, charId, childId3, 256, establishmentDate);
			}
		}

		// Token: 0x060072E8 RID: 29416 RVA: 0x00427994 File Offset: 0x00425B94
		public void AddStepParentRelations(DataContext context, int charId, int stepParentCharId, int establishmentDate = -2147483648)
		{
			this.AddRelation(context, charId, stepParentCharId, 8, establishmentDate);
			HashSet<int> bloodChildIds = this.GetRelatedCharIds(stepParentCharId, 2);
			foreach (int childId in bloodChildIds)
			{
				this.AddRelation(context, charId, childId, 32, establishmentDate);
			}
			HashSet<int> stepChildIds = this.GetRelatedCharIds(stepParentCharId, 16);
			foreach (int childId2 in stepChildIds)
			{
				bool flag = childId2 == charId;
				if (!flag)
				{
					this.AddRelation(context, charId, childId2, 32, establishmentDate);
				}
			}
			HashSet<int> adoptiveChildIds = this.GetRelatedCharIds(stepParentCharId, 128);
			foreach (int childId3 in adoptiveChildIds)
			{
				this.AddRelation(context, charId, childId3, 256, establishmentDate);
			}
		}

		// Token: 0x060072E9 RID: 29417 RVA: 0x00427AC0 File Offset: 0x00425CC0
		public void AddAdoptiveParentRelations(DataContext context, int charId, int adoptiveParentCharId, int establishmentDate = -2147483648)
		{
			this.AddRelation(context, charId, adoptiveParentCharId, 64, establishmentDate);
			HashSet<int> bloodChildIds = this.GetRelatedCharIds(adoptiveParentCharId, 2);
			foreach (int childId in bloodChildIds)
			{
				this.AddRelation(context, charId, childId, 256, establishmentDate);
			}
			HashSet<int> stepChildIds = this.GetRelatedCharIds(adoptiveParentCharId, 16);
			foreach (int childId2 in stepChildIds)
			{
				this.AddRelation(context, charId, childId2, 256, establishmentDate);
			}
			HashSet<int> adoptiveChildIds = this.GetRelatedCharIds(adoptiveParentCharId, 128);
			foreach (int childId3 in adoptiveChildIds)
			{
				bool flag = childId3 == charId;
				if (!flag)
				{
					this.AddRelation(context, charId, childId3, 256, establishmentDate);
				}
			}
		}

		// Token: 0x060072EA RID: 29418 RVA: 0x00427BF4 File Offset: 0x00425DF4
		public void AddHusbandOrWifeRelations(DataContext context, int charId, int spouseCharId, int establishmentDate = -2147483648)
		{
			this.AddRelation(context, charId, spouseCharId, 1024, establishmentDate);
			List<int> selfBloodChildren = ObjectPool<List<int>>.Instance.Get();
			selfBloodChildren.Clear();
			selfBloodChildren.AddRange(this.GetRelatedCharIds(charId, 2));
			List<int> spouseBloodChildren = ObjectPool<List<int>>.Instance.Get();
			spouseBloodChildren.Clear();
			spouseBloodChildren.AddRange(this.GetRelatedCharIds(spouseCharId, 2));
			List<int> selfStepChildren = ObjectPool<List<int>>.Instance.Get();
			selfStepChildren.Clear();
			selfStepChildren.AddRange(this.GetRelatedCharIds(charId, 16));
			List<int> spouseStepChildren = ObjectPool<List<int>>.Instance.Get();
			spouseStepChildren.Clear();
			spouseStepChildren.AddRange(this.GetRelatedCharIds(spouseCharId, 16));
			List<int> selfAdoptiveChildren = ObjectPool<List<int>>.Instance.Get();
			selfAdoptiveChildren.Clear();
			selfAdoptiveChildren.AddRange(this.GetRelatedCharIds(charId, 128));
			List<int> spouseAdoptiveChildren = ObjectPool<List<int>>.Instance.Get();
			spouseAdoptiveChildren.Clear();
			spouseAdoptiveChildren.AddRange(this.GetRelatedCharIds(spouseCharId, 128));
			int i = 0;
			int count = selfBloodChildren.Count;
			while (i < count)
			{
				bool flag = selfBloodChildren[i] != spouseCharId;
				if (flag)
				{
					this.AddRelation(context, selfBloodChildren[i], spouseCharId, 8, establishmentDate);
				}
				i++;
			}
			int j = 0;
			int count2 = spouseBloodChildren.Count;
			while (j < count2)
			{
				bool flag2 = spouseBloodChildren[j] != charId;
				if (flag2)
				{
					this.AddRelation(context, spouseBloodChildren[j], charId, 8, establishmentDate);
				}
				j++;
			}
			int k = 0;
			int count3 = selfStepChildren.Count;
			while (k < count3)
			{
				bool flag3 = selfStepChildren[k] != spouseCharId;
				if (flag3)
				{
					this.AddRelation(context, selfStepChildren[k], spouseCharId, 8, establishmentDate);
				}
				k++;
			}
			int l = 0;
			int count4 = spouseStepChildren.Count;
			while (l < count4)
			{
				bool flag4 = spouseStepChildren[l] != charId;
				if (flag4)
				{
					this.AddRelation(context, spouseStepChildren[l], charId, 8, establishmentDate);
				}
				l++;
			}
			int m = 0;
			int count5 = selfAdoptiveChildren.Count;
			while (m < count5)
			{
				bool flag5 = selfAdoptiveChildren[m] != spouseCharId;
				if (flag5)
				{
					this.AddRelation(context, selfAdoptiveChildren[m], spouseCharId, 64, establishmentDate);
				}
				m++;
			}
			int n = 0;
			int count6 = spouseAdoptiveChildren.Count;
			while (n < count6)
			{
				bool flag6 = spouseAdoptiveChildren[n] != charId;
				if (flag6)
				{
					this.AddRelation(context, spouseAdoptiveChildren[n], charId, 64, establishmentDate);
				}
				n++;
			}
			int i2 = 0;
			int selfChildCount = selfBloodChildren.Count;
			while (i2 < selfChildCount)
			{
				int selfBloodChildId = selfBloodChildren[i2];
				int j2 = 0;
				int spouseChildCount = spouseBloodChildren.Count;
				while (j2 < spouseChildCount)
				{
					bool flag7 = selfBloodChildId != spouseBloodChildren[j2];
					if (flag7)
					{
						this.AddRelation(context, selfBloodChildId, spouseBloodChildren[j2], 32, establishmentDate);
					}
					j2++;
				}
				int j3 = 0;
				int spouseChildCount2 = spouseStepChildren.Count;
				while (j3 < spouseChildCount2)
				{
					bool flag8 = selfBloodChildId != spouseStepChildren[j3];
					if (flag8)
					{
						this.AddRelation(context, selfBloodChildId, spouseStepChildren[j3], 32, establishmentDate);
					}
					j3++;
				}
				int j4 = 0;
				int spouseChildCount3 = spouseAdoptiveChildren.Count;
				while (j4 < spouseChildCount3)
				{
					bool flag9 = selfBloodChildId != spouseAdoptiveChildren[j4];
					if (flag9)
					{
						this.AddRelation(context, selfBloodChildId, spouseAdoptiveChildren[j4], 256, establishmentDate);
					}
					j4++;
				}
				i2++;
			}
			int i3 = 0;
			int selfChildCount2 = selfStepChildren.Count;
			while (i3 < selfChildCount2)
			{
				int selfStepChildId = selfStepChildren[i3];
				int j5 = 0;
				int spouseChildCount4 = spouseBloodChildren.Count;
				while (j5 < spouseChildCount4)
				{
					bool flag10 = selfStepChildId != spouseBloodChildren[j5];
					if (flag10)
					{
						this.AddRelation(context, selfStepChildId, spouseBloodChildren[j5], 32, establishmentDate);
					}
					j5++;
				}
				int j6 = 0;
				int spouseChildCount5 = spouseStepChildren.Count;
				while (j6 < spouseChildCount5)
				{
					bool flag11 = selfStepChildId != spouseStepChildren[j6];
					if (flag11)
					{
						this.AddRelation(context, selfStepChildId, spouseStepChildren[j6], 32, establishmentDate);
					}
					j6++;
				}
				int j7 = 0;
				int spouseChildCount6 = spouseAdoptiveChildren.Count;
				while (j7 < spouseChildCount6)
				{
					bool flag12 = selfStepChildId != spouseAdoptiveChildren[j7];
					if (flag12)
					{
						this.AddRelation(context, selfStepChildId, spouseAdoptiveChildren[j7], 256, establishmentDate);
					}
					j7++;
				}
				i3++;
			}
			int i4 = 0;
			int selfChildCount3 = selfAdoptiveChildren.Count;
			while (i4 < selfChildCount3)
			{
				int selfAdoptiveChildId = selfAdoptiveChildren[i4];
				int j8 = 0;
				int spouseChildCount7 = spouseBloodChildren.Count;
				while (j8 < spouseChildCount7)
				{
					bool flag13 = selfAdoptiveChildId != spouseBloodChildren[j8];
					if (flag13)
					{
						this.AddRelation(context, selfAdoptiveChildId, spouseBloodChildren[j8], 256, establishmentDate);
					}
					j8++;
				}
				int j9 = 0;
				int spouseChildCount8 = spouseStepChildren.Count;
				while (j9 < spouseChildCount8)
				{
					bool flag14 = selfAdoptiveChildId != spouseStepChildren[j9];
					if (flag14)
					{
						this.AddRelation(context, selfAdoptiveChildId, spouseStepChildren[j9], 256, establishmentDate);
					}
					j9++;
				}
				int j10 = 0;
				int spouseChildCount9 = spouseAdoptiveChildren.Count;
				while (j10 < spouseChildCount9)
				{
					bool flag15 = selfAdoptiveChildId != spouseAdoptiveChildren[j10];
					if (flag15)
					{
						this.AddRelation(context, selfAdoptiveChildId, spouseAdoptiveChildren[j10], 256, establishmentDate);
					}
					j10++;
				}
				i4++;
			}
			ObjectPool<List<int>>.Instance.Return(selfBloodChildren);
			ObjectPool<List<int>>.Instance.Return(spouseBloodChildren);
			ObjectPool<List<int>>.Instance.Return(selfStepChildren);
			ObjectPool<List<int>>.Instance.Return(spouseStepChildren);
			ObjectPool<List<int>>.Instance.Return(selfAdoptiveChildren);
			ObjectPool<List<int>>.Instance.Return(spouseAdoptiveChildren);
		}

		// Token: 0x060072EB RID: 29419 RVA: 0x0042822C File Offset: 0x0042642C
		public void AddRelation(DataContext context, int charId, int relatedCharId, ushort addingType, int establishmentDate = -2147483648)
		{
			bool flag = charId == relatedCharId;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(41, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Cannot create relationship with oneself: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			this.AddRelationInternal(context, charId, relatedCharId, addingType, establishmentDate);
			ushort oppositeAddingType = RelationType.GetOppositeRelationType(addingType);
			this.AddRelationInternal(context, relatedCharId, charId, oppositeAddingType, establishmentDate);
		}

		// Token: 0x060072EC RID: 29420 RVA: 0x00428294 File Offset: 0x00426494
		public void ChangeRelationType(DataContext context, int charId, int relatedCharId, ushort removingType, ushort addingType)
		{
			RelationKey relationKey = new RelationKey(charId, relatedCharId);
			RelatedCharacter relation = this._relations[relationKey];
			ushort relationType = this.RelatedCharIds_ChangeRelation(charId, relatedCharId, relation.RelationType, removingType, addingType);
			DomainManager.Extra.AddRemovedSpecialRelations(context, relationKey, removingType);
			Events.RaiseRelationAdded(context, charId, relatedCharId, relationType);
			relation.RelationType = relationType;
			this.SetElement_Relations(relationKey, relation, context);
		}

		// Token: 0x060072ED RID: 29421 RVA: 0x004282F8 File Offset: 0x004264F8
		public void RemoveRelation(DataContext context, int charId, int relatedCharId)
		{
			RelationKey key = new RelationKey(charId, relatedCharId);
			RelatedCharacter relation;
			bool flag = !this._relations.TryGetValue(key, out relation);
			if (!flag)
			{
				this.RelatedCharIds_RemoveRelations(charId, relatedCharId, relation.RelationType);
				DomainManager.Extra.ClearRemovedSpecialRelations(context, key);
				this.RemoveElement_Relations(key, context);
			}
		}

		// Token: 0x060072EE RID: 29422 RVA: 0x0042834C File Offset: 0x0042654C
		public void RemoveAllGeneralRelations(DataContext context, int charId)
		{
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			if (!flag)
			{
				CharacterSet general = relatedChars.General;
				foreach (int relatedCharId in general.GetCollection())
				{
					RelationKey key = new RelationKey(charId, relatedCharId);
					this.RemoveElement_Relations(key, context);
					DomainManager.Extra.ClearRemovedSpecialRelations(context, key);
					RelationKey reverseKey = new RelationKey(relatedCharId, charId);
					RelatedCharacter reverseRelation;
					bool flag2 = !this._relations.TryGetValue(reverseKey, out reverseRelation);
					if (!flag2)
					{
						bool flag3 = reverseRelation.RelationType == 0;
						if (flag3)
						{
							this.RemoveElement_Relations(reverseKey, context);
							DomainManager.Extra.ClearRemovedSpecialRelations(context, reverseKey);
							this.RelatedCharIds_RemoveRelations(relatedCharId, charId, 0);
						}
					}
				}
				general.Clear();
			}
		}

		// Token: 0x060072EF RID: 29423 RVA: 0x0042844C File Offset: 0x0042664C
		public void RemoveAllRelations(DataContext context, int charId, bool removeRelatedRelations)
		{
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			if (!flag)
			{
				this._relatedCharIds.Remove(charId);
				HashSet<int> relatedCharIds = new HashSet<int>();
				relatedChars.GetAllRelatedCharIds(relatedCharIds, true);
				relatedChars.OfflineClear();
				foreach (int relatedCharId in relatedCharIds)
				{
					RelationKey key = new RelationKey(charId, relatedCharId);
					this.RemoveElement_Relations(key, context);
					DomainManager.Extra.ClearRemovedSpecialRelations(context, key);
				}
				if (removeRelatedRelations)
				{
					foreach (int relatedCharId2 in relatedCharIds)
					{
						this.RemoveRelation(context, relatedCharId2, charId);
					}
				}
			}
		}

		// Token: 0x060072F0 RID: 29424 RVA: 0x00428544 File Offset: 0x00426744
		public bool HasTwoWayRelation(int charId, ushort relationType)
		{
			Tester.Assert(RelationType.IsOneWayRelation(relationType), "");
			HashSet<int> relatedCharIds = this.GetRelatedCharIds(charId, relationType);
			bool flag = relatedCharIds.Count <= 0;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				foreach (int relatedCharId in relatedCharIds)
				{
					HashSet<int> currRelatedCharIds = this.GetRelatedCharIds(relatedCharId, relationType);
					bool flag2 = currRelatedCharIds.Contains(charId);
					if (flag2)
					{
						return true;
					}
				}
				result = false;
			}
			return result;
		}

		// Token: 0x060072F1 RID: 29425 RVA: 0x004285E4 File Offset: 0x004267E4
		public bool HasEnemyRelationWithFamily(int charId, int relatedCharId)
		{
			HashSet<int> enemies = this.GetRelatedCharIds(charId, 32768);
			bool flag = enemies.Contains(relatedCharId);
			bool result;
			if (flag)
			{
				result = true;
			}
			else
			{
				foreach (int enemyId in enemies)
				{
					RelatedCharacter enemyToTarget;
					bool flag2 = !this.TryGetRelation(enemyId, relatedCharId, out enemyToTarget);
					if (!flag2)
					{
						bool flag3 = RelationType.ContainBloodRelatedRelations(enemyToTarget.RelationType);
						if (flag3)
						{
							return true;
						}
					}
				}
				result = false;
			}
			return result;
		}

		// Token: 0x060072F2 RID: 29426 RVA: 0x00428680 File Offset: 0x00426880
		public bool IsInsect(int charId, int relatedCharId)
		{
			sbyte generationCount = GlobalConfig.Instance.InsectDetectionGenerationCount;
			HashSet<int> charAncestorSet = ObjectPool<HashSet<int>>.Instance.Get();
			charAncestorSet.Clear();
			this.GetAncestors(charId, charAncestorSet, (int)generationCount);
			HashSet<int> relatedCharAncestorSet = ObjectPool<HashSet<int>>.Instance.Get();
			relatedCharAncestorSet.Clear();
			this.GetAncestors(relatedCharId, relatedCharAncestorSet, (int)generationCount);
			bool result = charAncestorSet.Overlaps(relatedCharAncestorSet);
			ObjectPool<HashSet<int>>.Instance.Return(charAncestorSet);
			ObjectPool<HashSet<int>>.Instance.Return(relatedCharAncestorSet);
			return result;
		}

		// Token: 0x060072F3 RID: 29427 RVA: 0x004286F8 File Offset: 0x004268F8
		public unsafe void GetAncestors(int charId, HashSet<int> ancestors, int recursionCount)
		{
			ancestors.Add(charId);
			bool flag = recursionCount <= 0;
			if (!flag)
			{
				int* pActualBloodParentIds = stackalloc int[(UIntPtr)8];
				RelatedCharacters relatedChars = this.GetRelatedCharacters(charId);
				this.GetActualBloodParents(charId, relatedChars, pActualBloodParentIds);
				for (int i = 0; i < 2; i++)
				{
					int parentId = pActualBloodParentIds[i];
					bool flag2 = parentId < 0;
					if (!flag2)
					{
						this.GetAncestors(parentId, ancestors, recursionCount - 1);
					}
				}
			}
		}

		// Token: 0x060072F4 RID: 29428 RVA: 0x0042876C File Offset: 0x0042696C
		public bool HasNominalBloodRelation(int charId, int relatedCharId, RelatedCharacter relation)
		{
			bool flag = relation.RelationType != ushort.MaxValue;
			if (flag)
			{
				bool flag2 = RelationType.ContainDirectBloodRelations(relation.RelationType);
				if (flag2)
				{
					return true;
				}
			}
			RelatedCharacters relatedChars;
			bool flag3 = this._relatedCharIds.TryGetValue(charId, out relatedChars);
			if (flag3)
			{
				bool flag4 = this.HasNominalDirectBloodRelation(relatedChars.BloodParents, relatedCharId, false);
				if (flag4)
				{
					return true;
				}
				bool flag5 = this.HasNominalDirectBloodRelation(relatedChars.BloodBrothersAndSisters, relatedCharId, false);
				if (flag5)
				{
					return true;
				}
				bool flag6 = this.HasNominalDirectBloodRelation(relatedChars.BloodChildren, relatedCharId, true);
				if (flag6)
				{
					return true;
				}
			}
			return false;
		}

		// Token: 0x060072F5 RID: 29429 RVA: 0x00428808 File Offset: 0x00426A08
		public bool HasActualBloodRelation(int charId, int relatedCharId)
		{
			HashSet<int> actualDirectBloodCharIds = new HashSet<int>();
			bool flag = this.HasActualDirectBloodRelation(charId, relatedCharId, false, actualDirectBloodCharIds);
			bool result;
			if (flag)
			{
				result = true;
			}
			else
			{
				RelatedCharacters relatedChars = this.GetRelatedCharacters(charId);
				foreach (int actualDirectBloodCharId in actualDirectBloodCharIds)
				{
					bool exceptParent = this.IsActualBloodChildren(charId, relatedChars, actualDirectBloodCharId, null);
					bool flag2 = this.HasActualDirectBloodRelation(actualDirectBloodCharId, relatedCharId, exceptParent, null);
					if (flag2)
					{
						return true;
					}
				}
				result = false;
			}
			return result;
		}

		// Token: 0x060072F6 RID: 29430 RVA: 0x004288A0 File Offset: 0x00426AA0
		public bool IsTaiwuPeople(int charId)
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			RelatedCharacter taiwuRelationWithTarget;
			RelatedCharacter targetRelationWithTaiwu;
			return charId == taiwuCharId || DomainManager.Taiwu.IsInGroup(charId) || (this.TryGetRelation(taiwuCharId, charId, out taiwuRelationWithTarget) && taiwuRelationWithTarget.RelationType != 0 && this.TryGetRelation(taiwuCharId, charId, out targetRelationWithTaiwu) && targetRelationWithTaiwu.RelationType > 0);
		}

		// Token: 0x060072F7 RID: 29431 RVA: 0x00428900 File Offset: 0x00426B00
		public bool IsTaiwuPeople(int charId, ushort relationToTaiwu, ushort taiwuRelationToSelf)
		{
			return charId == DomainManager.Taiwu.GetTaiwuCharId() || DomainManager.Taiwu.IsInGroup(charId) || (relationToTaiwu != 0 && taiwuRelationToSelf > 0);
		}

		// Token: 0x060072F8 RID: 29432 RVA: 0x0042893C File Offset: 0x00426B3C
		public unsafe bool IsClosePeople(IRandomSource random, Character selfChar, Character targetChar)
		{
			bool flag = selfChar.GetId() == targetChar.GetId();
			bool result;
			if (flag)
			{
				result = true;
			}
			else
			{
				bool flag2 = selfChar.GetLeaderId() >= 0 && selfChar.GetLeaderId() == targetChar.GetLeaderId();
				if (flag2)
				{
					result = true;
				}
				else
				{
					Personalities personalities = targetChar.GetPersonalities();
					Location selfLocation = selfChar.GetLocation();
					Location targetLocation = targetChar.GetLocation();
					bool flag3 = selfLocation.IsValid() && targetLocation.IsValid();
					if (flag3)
					{
						bool flag4 = selfLocation.Equals(targetLocation);
						if (flag4)
						{
							return random.CheckPercentProb((int)(30 + *(ref personalities.Items.FixedElementField + 2)));
						}
						MapBlockData selfBlock = DomainManager.Map.GetBlock(selfLocation);
						MapBlockData targetBlock = DomainManager.Map.GetBlock(targetLocation);
						bool flag5 = selfBlock.GetBlockPos().GetManhattanDistance(targetBlock.GetBlockPos()) < 1;
						if (flag5)
						{
							random.CheckPercentProb((int)(15 + *(ref personalities.Items.FixedElementField + 2) / 2));
						}
					}
					result = false;
				}
			}
			return result;
		}

		// Token: 0x060072F9 RID: 29433 RVA: 0x00428A48 File Offset: 0x00426C48
		public unsafe bool IsSameBlockPeople(IRandomSource random, Character selfChar, Character targetChar)
		{
			bool flag = selfChar.GetId() == targetChar.GetId();
			bool result;
			if (flag)
			{
				result = true;
			}
			else
			{
				bool flag2 = selfChar.GetLeaderId() >= 0 && selfChar.GetLeaderId() == targetChar.GetLeaderId();
				if (flag2)
				{
					result = true;
				}
				else
				{
					Personalities personalities = targetChar.GetPersonalities();
					bool flag3 = selfChar.GetLocation().IsValid() && selfChar.GetLocation().Equals(targetChar.GetLocation());
					result = (flag3 && random.CheckPercentProb((int)(30 + *(ref personalities.Items.FixedElementField + 2))));
				}
			}
			return result;
		}

		// Token: 0x060072FA RID: 29434 RVA: 0x00428AE4 File Offset: 0x00426CE4
		public void GetTaiwuPeople(HashSet<int> targetCharIds)
		{
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			targetCharIds.Clear();
			this.GetAllTwoWayRelatedCharIds(taiwuCharId, targetCharIds);
			targetCharIds.RemoveWhere((int charId) => !this._objects.ContainsKey(charId));
			foreach (int charId2 in DomainManager.Taiwu.GetGroupCharIds().GetCollection())
			{
				targetCharIds.Add(charId2);
				KidnappedCharacterList kidnappedCharacterList;
				bool flag = this._kidnappedChars.TryGetValue(charId2, out kidnappedCharacterList);
				if (flag)
				{
					List<KidnappedCharacter> collection = kidnappedCharacterList.GetCollection();
					foreach (KidnappedCharacter kidnappedChar in collection)
					{
						targetCharIds.Add(kidnappedChar.CharId);
					}
				}
			}
			targetCharIds.UnionWith(DomainManager.Taiwu.GetGroupCharIds().GetCollection());
		}

		// Token: 0x060072FB RID: 29435 RVA: 0x00428BFC File Offset: 0x00426DFC
		public unsafe void GetSameBlockPeople(IRandomSource random, Character selfChar, HashSet<int> targetCharIds, sbyte factor = 100)
		{
			targetCharIds.Clear();
			int selfCharId = selfChar.GetId();
			targetCharIds.Add(selfCharId);
			int leaderId = selfChar.GetLeaderId();
			bool flag = leaderId >= 0;
			if (flag)
			{
				foreach (int charId in (DomainManager.Taiwu.IsInGroup(selfCharId) ? DomainManager.Taiwu.GetGroupCharIds() : this._characterGroups[leaderId]).GetCollection())
				{
					targetCharIds.Add(charId);
					KidnappedCharacterList kidnappedCharacterList;
					bool flag2 = this._kidnappedChars.TryGetValue(charId, out kidnappedCharacterList);
					if (flag2)
					{
						List<KidnappedCharacter> collection = kidnappedCharacterList.GetCollection();
						foreach (KidnappedCharacter kidnappedChar in collection)
						{
							targetCharIds.Add(kidnappedChar.CharId);
						}
					}
				}
			}
			else
			{
				bool flag3 = selfChar.IsActiveExternalRelationState(2);
				if (flag3)
				{
					List<KidnappedCharacter> collection2 = this._kidnappedChars[selfCharId].GetCollection();
					foreach (KidnappedCharacter kidnappedChar2 in collection2)
					{
						targetCharIds.Add(kidnappedChar2.CharId);
					}
				}
			}
			Location location = selfChar.GetLocation();
			bool flag4 = !location.IsValid();
			if (flag4)
			{
				location = selfChar.GetValidLocation();
			}
			MapBlockData blockData = DomainManager.Map.GetBlock(location);
			bool flag5 = blockData.CharacterSet != null;
			if (flag5)
			{
				foreach (int charId2 in blockData.CharacterSet)
				{
					Character character;
					bool flag6 = !this._objects.TryGetValue(charId2, out character);
					if (flag6)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(66, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Trying to get ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(selfCharId);
						defaultInterpolatedStringHandler.AppendLiteral("'s same/neighbor block people ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(charId2);
						defaultInterpolatedStringHandler.AppendLiteral(" who is not alive at ");
						defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					bool flag7 = random.CheckPercentProb((int)((30 + *(ref character.GetPersonalities().Items.FixedElementField + 2)) * factor / 100));
					if (flag7)
					{
						targetCharIds.Add(charId2);
					}
				}
			}
			bool flag8 = DomainManager.Taiwu.GetTaiwu().GetLocation().Equals(location);
			if (flag8)
			{
				HashSet<int> taiwuGroupCollection = DomainManager.Taiwu.GetGroupCharIds().GetCollection();
				foreach (int charId3 in taiwuGroupCollection)
				{
					Character character2;
					bool flag9 = !this._objects.TryGetValue(charId3, out character2);
					if (flag9)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(66, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Trying to get ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(selfCharId);
						defaultInterpolatedStringHandler.AppendLiteral("'s same/neighbor block people ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(charId3);
						defaultInterpolatedStringHandler.AppendLiteral(" who is not alive at ");
						defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					bool flag10 = random.CheckPercentProb((int)(30 + *(ref character2.GetPersonalities().Items.FixedElementField + 2)));
					if (flag10)
					{
						targetCharIds.Add(charId3);
					}
				}
			}
		}

		// Token: 0x060072FC RID: 29436 RVA: 0x00428FE8 File Offset: 0x004271E8
		public unsafe void GetClosePeople(IRandomSource random, Character selfChar, HashSet<int> targetCharIds, sbyte factor = 100)
		{
			targetCharIds.Clear();
			int selfCharId = selfChar.GetId();
			targetCharIds.Add(selfCharId);
			int leaderId = selfChar.GetLeaderId();
			bool flag = leaderId >= 0;
			if (flag)
			{
				foreach (int charId in (DomainManager.Taiwu.IsInGroup(selfCharId) ? DomainManager.Taiwu.GetGroupCharIds() : this._characterGroups[leaderId]).GetCollection())
				{
					targetCharIds.Add(charId);
					KidnappedCharacterList kidnappedCharacterList;
					bool flag2 = this._kidnappedChars.TryGetValue(charId, out kidnappedCharacterList);
					if (flag2)
					{
						List<KidnappedCharacter> collection = kidnappedCharacterList.GetCollection();
						foreach (KidnappedCharacter kidnappedChar in collection)
						{
							targetCharIds.Add(kidnappedChar.CharId);
						}
					}
				}
			}
			else
			{
				bool flag3 = selfChar.IsActiveExternalRelationState(2);
				if (flag3)
				{
					List<KidnappedCharacter> collection2 = this._kidnappedChars[selfCharId].GetCollection();
					foreach (KidnappedCharacter kidnappedChar2 in collection2)
					{
						targetCharIds.Add(kidnappedChar2.CharId);
					}
				}
			}
			Location location = selfChar.GetLocation();
			bool flag4 = !location.IsValid();
			if (flag4)
			{
				location = selfChar.GetValidLocation();
			}
			MapBlockData blockData = DomainManager.Map.GetBlock(location);
			bool flag5 = blockData.CharacterSet != null;
			if (flag5)
			{
				foreach (int charId2 in blockData.CharacterSet)
				{
					bool flag6 = charId2 == selfCharId;
					if (!flag6)
					{
						Character character;
						bool flag7 = !this._objects.TryGetValue(charId2, out character);
						if (flag7)
						{
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(66, 3);
							defaultInterpolatedStringHandler.AppendLiteral("Trying to get ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(selfCharId);
							defaultInterpolatedStringHandler.AppendLiteral("'s same/neighbor block people ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(charId2);
							defaultInterpolatedStringHandler.AppendLiteral(" who is not alive at ");
							defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
							defaultInterpolatedStringHandler.AppendLiteral(".");
							throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						bool flag8 = random.CheckPercentProb((int)((30 + *(ref character.GetPersonalities().Items.FixedElementField + 2)) * factor / 100));
						if (flag8)
						{
							targetCharIds.Add(charId2);
						}
					}
				}
			}
			Character taiwu = DomainManager.Taiwu.GetTaiwu();
			bool flag9 = taiwu.GetLocation().Equals(location);
			if (flag9)
			{
				foreach (int charId3 in DomainManager.Taiwu.GetGroupCharIds().GetCollection())
				{
					bool flag10 = charId3 == selfCharId;
					if (!flag10)
					{
						Character character2;
						bool flag11 = !this._objects.TryGetValue(charId3, out character2);
						if (flag11)
						{
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(66, 3);
							defaultInterpolatedStringHandler.AppendLiteral("Trying to get ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(selfCharId);
							defaultInterpolatedStringHandler.AppendLiteral("'s same/neighbor block people ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(charId3);
							defaultInterpolatedStringHandler.AppendLiteral(" who is not alive at ");
							defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
							defaultInterpolatedStringHandler.AppendLiteral(".");
							throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						bool flag12 = random.CheckPercentProb((int)((30 + *(ref character2.GetPersonalities().Items.FixedElementField + 2)) * factor / 100));
						if (flag12)
						{
							targetCharIds.Add(charId3);
						}
					}
				}
			}
			List<MapBlockData> neighborBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
			DomainManager.Map.GetRealNeighborBlocks(location.AreaId, location.BlockId, neighborBlocks, 1, false);
			foreach (MapBlockData neighborBlock in neighborBlocks)
			{
				bool flag13 = neighborBlock.CharacterSet == null;
				if (!flag13)
				{
					foreach (int charId4 in neighborBlock.CharacterSet)
					{
						Character character3;
						bool flag14 = !this._objects.TryGetValue(charId4, out character3);
						if (flag14)
						{
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(66, 3);
							defaultInterpolatedStringHandler.AppendLiteral("Trying to get ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(selfCharId);
							defaultInterpolatedStringHandler.AppendLiteral("'s same/neighbor block people ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(charId4);
							defaultInterpolatedStringHandler.AppendLiteral(" who is not alive at ");
							defaultInterpolatedStringHandler.AppendFormatted<Location>(neighborBlock.GetLocation());
							defaultInterpolatedStringHandler.AppendLiteral(".");
							throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						bool flag15 = random.CheckPercentProb((int)((15 + *(ref character3.GetPersonalities().Items.FixedElementField + 2) / 2) * factor / 100));
						if (flag15)
						{
							targetCharIds.Add(charId4);
						}
					}
					bool flag16 = taiwu.GetLocation().Equals(new Location(neighborBlock.AreaId, neighborBlock.BlockId));
					if (flag16)
					{
						foreach (int charId5 in DomainManager.Taiwu.GetGroupCharIds().GetCollection())
						{
							Character character4;
							bool flag17 = !this._objects.TryGetValue(charId5, out character4);
							if (flag17)
							{
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(66, 3);
								defaultInterpolatedStringHandler.AppendLiteral("Trying to get ");
								defaultInterpolatedStringHandler.AppendFormatted<int>(selfCharId);
								defaultInterpolatedStringHandler.AppendLiteral("'s same/neighbor block people ");
								defaultInterpolatedStringHandler.AppendFormatted<int>(charId5);
								defaultInterpolatedStringHandler.AppendLiteral(" who is not alive at ");
								defaultInterpolatedStringHandler.AppendFormatted<Location>(neighborBlock.GetLocation());
								defaultInterpolatedStringHandler.AppendLiteral(".");
								throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
							}
							bool flag18 = random.CheckPercentProb((int)(15 + *(ref character4.GetPersonalities().Items.FixedElementField + 2) / 2));
							if (flag18)
							{
								targetCharIds.Add(charId5);
							}
						}
					}
				}
			}
		}

		// Token: 0x060072FD RID: 29437 RVA: 0x00429718 File Offset: 0x00427918
		public unsafe void GetAreaPeople(IRandomSource random, Character selfChar, HashSet<int> targetCharIds, sbyte factor = 100)
		{
			Location location = selfChar.GetLocation();
			bool flag = !location.IsValid();
			if (flag)
			{
				location = selfChar.GetValidLocation();
			}
			int selfCharId = selfChar.GetId();
			targetCharIds.Add(selfCharId);
			int leaderId = selfChar.GetLeaderId();
			bool flag2 = leaderId >= 0;
			if (flag2)
			{
				foreach (int charId in (DomainManager.Taiwu.IsInGroup(selfCharId) ? DomainManager.Taiwu.GetGroupCharIds() : this._characterGroups[leaderId]).GetCollection())
				{
					targetCharIds.Add(charId);
					KidnappedCharacterList kidnappedCharacterList;
					bool flag3 = this._kidnappedChars.TryGetValue(charId, out kidnappedCharacterList);
					if (flag3)
					{
						List<KidnappedCharacter> collection = kidnappedCharacterList.GetCollection();
						foreach (KidnappedCharacter kidnappedChar in collection)
						{
							targetCharIds.Add(kidnappedChar.CharId);
						}
					}
				}
			}
			else
			{
				bool flag4 = selfChar.IsActiveExternalRelationState(2);
				if (flag4)
				{
					List<KidnappedCharacter> collection2 = this._kidnappedChars[selfCharId].GetCollection();
					foreach (KidnappedCharacter kidnappedChar2 in collection2)
					{
						targetCharIds.Add(kidnappedChar2.CharId);
					}
				}
			}
			MapBlockData blockData = DomainManager.Map.GetBlock(location);
			bool flag5 = blockData.CharacterSet != null;
			if (flag5)
			{
				foreach (int charId2 in blockData.CharacterSet)
				{
					Character character;
					bool flag6 = !this._objects.TryGetValue(charId2, out character);
					if (flag6)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(66, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Trying to get ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(selfCharId);
						defaultInterpolatedStringHandler.AppendLiteral("'s same/neighbor block people ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(charId2);
						defaultInterpolatedStringHandler.AppendLiteral(" who is not alive at ");
						defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					bool flag7 = random.CheckPercentProb((int)((60 + *(ref character.GetPersonalities().Items.FixedElementField + 2) * 2) * factor / 100));
					if (flag7)
					{
						targetCharIds.Add(charId2);
					}
				}
			}
			Location taiwuLocation = DomainManager.Taiwu.GetTaiwu().GetLocation();
			bool flag8 = taiwuLocation.Equals(location);
			if (flag8)
			{
				HashSet<int> taiwuGroupCollection = DomainManager.Taiwu.GetGroupCharIds().GetCollection();
				foreach (int charId3 in taiwuGroupCollection)
				{
					Character character2;
					bool flag9 = !this._objects.TryGetValue(charId3, out character2);
					if (flag9)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(66, 3);
						defaultInterpolatedStringHandler.AppendLiteral("Trying to get ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(selfCharId);
						defaultInterpolatedStringHandler.AppendLiteral("'s same/neighbor block people ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(charId3);
						defaultInterpolatedStringHandler.AppendLiteral(" who is not alive at ");
						defaultInterpolatedStringHandler.AppendFormatted<Location>(location);
						defaultInterpolatedStringHandler.AppendLiteral(".");
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					bool flag10 = random.CheckPercentProb((int)(60 + *(ref character2.GetPersonalities().Items.FixedElementField + 2) * 2));
					if (flag10)
					{
						targetCharIds.Add(charId3);
					}
				}
			}
			List<MapBlockData> neighborBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
			DomainManager.Map.GetRealNeighborBlocks(location.AreaId, location.BlockId, neighborBlocks, 1, false);
			foreach (MapBlockData neighborBlock in neighborBlocks)
			{
				bool flag11 = neighborBlock.CharacterSet == null;
				if (!flag11)
				{
					foreach (int charId4 in neighborBlock.CharacterSet)
					{
						Character character3;
						bool flag12 = !this._objects.TryGetValue(charId4, out character3);
						if (flag12)
						{
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(61, 3);
							defaultInterpolatedStringHandler.AppendLiteral("Trying to get ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(selfCharId);
							defaultInterpolatedStringHandler.AppendLiteral("'s neighbor block people ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(charId4);
							defaultInterpolatedStringHandler.AppendLiteral(" who is not alive at ");
							defaultInterpolatedStringHandler.AppendFormatted<Location>(neighborBlock.GetLocation());
							defaultInterpolatedStringHandler.AppendLiteral(".");
							throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						bool flag13 = random.CheckPercentProb((int)((30 + *(ref character3.GetPersonalities().Items.FixedElementField + 2)) * factor / 100));
						if (flag13)
						{
							targetCharIds.Add(charId4);
						}
					}
					bool flag14 = taiwuLocation.Equals(new Location(neighborBlock.AreaId, neighborBlock.BlockId));
					if (flag14)
					{
						foreach (int charId5 in DomainManager.Taiwu.GetGroupCharIds().GetCollection())
						{
							Character character4;
							bool flag15 = !this._objects.TryGetValue(charId5, out character4);
							if (flag15)
							{
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(66, 3);
								defaultInterpolatedStringHandler.AppendLiteral("Trying to get ");
								defaultInterpolatedStringHandler.AppendFormatted<int>(selfCharId);
								defaultInterpolatedStringHandler.AppendLiteral("'s same/neighbor block people ");
								defaultInterpolatedStringHandler.AppendFormatted<int>(charId5);
								defaultInterpolatedStringHandler.AppendLiteral(" who is not alive at ");
								defaultInterpolatedStringHandler.AppendFormatted<Location>(neighborBlock.GetLocation());
								defaultInterpolatedStringHandler.AppendLiteral(".");
								throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
							}
							bool flag16 = random.CheckPercentProb((int)(30 + *(ref character4.GetPersonalities().Items.FixedElementField + 2)));
							if (flag16)
							{
								targetCharIds.Add(charId5);
							}
						}
					}
				}
			}
			Span<MapBlockData> blocks = DomainManager.Map.GetAreaBlocks(location.AreaId);
			int i = 0;
			int blocksCount = blocks.Length;
			while (i < blocksCount)
			{
				HashSet<int> charIds = blocks[i]->CharacterSet;
				bool flag17 = charIds != null;
				if (flag17)
				{
					foreach (int charId6 in charIds)
					{
						Character character5;
						bool flag18 = !this._objects.TryGetValue(charId6, out character5);
						if (flag18)
						{
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(66, 3);
							defaultInterpolatedStringHandler.AppendLiteral("Trying to get ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(selfCharId);
							defaultInterpolatedStringHandler.AppendLiteral("'s same/neighbor block people ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(charId6);
							defaultInterpolatedStringHandler.AppendLiteral(" who is not alive at ");
							defaultInterpolatedStringHandler.AppendFormatted<Location>(blocks[i]->GetLocation());
							defaultInterpolatedStringHandler.AppendLiteral(".");
							throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						bool flag19 = random.CheckPercentProb((int)((15 + *(ref character5.GetPersonalities().Items.FixedElementField + 2) / 2) * factor / 100));
						if (flag19)
						{
							targetCharIds.Add(charId6);
						}
					}
				}
				i++;
			}
		}

		// Token: 0x060072FE RID: 29438 RVA: 0x00429F80 File Offset: 0x00428180
		private void InitializeRelations()
		{
			this._relatedCharIds = new Dictionary<int, RelatedCharacters>();
			foreach (KeyValuePair<RelationKey, RelatedCharacter> keyValuePair in this._relations)
			{
				RelationKey relationKey;
				RelatedCharacter relatedCharacter;
				keyValuePair.Deconstruct(out relationKey, out relatedCharacter);
				RelationKey key = relationKey;
				RelatedCharacter relation = relatedCharacter;
				this.RelatedCharIds_AddRelations(key.CharId, key.RelatedCharId, relation.RelationType);
			}
		}

		// Token: 0x060072FF RID: 29439 RVA: 0x0042A008 File Offset: 0x00428208
		private ushort RelatedCharIds_AddRelation(int charId, int relatedCharId, ushort oriTypes, ushort addingType)
		{
			Tester.Assert(addingType > 0, "");
			RelatedCharacters relatedChars = this._relatedCharIds[charId];
			ushort currTypes = RelationTypeHelper.AddRelation(relatedChars, relatedCharId, oriTypes, addingType);
			bool flag = oriTypes == 0 && currTypes > 0;
			if (flag)
			{
				relatedChars.General.Remove(relatedCharId);
			}
			return currTypes;
		}

		// Token: 0x06007300 RID: 29440 RVA: 0x0042A060 File Offset: 0x00428260
		private ushort RelatedCharIds_ChangeRelation(int charId, int relatedCharId, ushort oriTypes, ushort removingType, ushort addingType)
		{
			RelatedCharacters relatedChars = this._relatedCharIds[charId];
			ushort currTypes = oriTypes;
			bool flag = removingType > 0;
			if (flag)
			{
				relatedChars.Remove(relatedCharId, removingType);
				currTypes &= ~removingType;
			}
			bool flag2 = addingType > 0;
			if (flag2)
			{
				currTypes = RelationTypeHelper.AddRelation(relatedChars, relatedCharId, currTypes, addingType);
			}
			bool flag3 = oriTypes == 0 && currTypes > 0;
			if (flag3)
			{
				relatedChars.General.Remove(relatedCharId);
			}
			else
			{
				bool flag4 = oriTypes != 0 && currTypes == 0;
				if (flag4)
				{
					relatedChars.General.Add(relatedCharId);
				}
			}
			return currTypes;
		}

		// Token: 0x06007301 RID: 29441 RVA: 0x0042A0F4 File Offset: 0x004282F4
		private void RelatedCharIds_AddRelations(int charId, int relatedCharId, ushort relationTypes)
		{
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			if (flag)
			{
				relatedChars = new RelatedCharacters();
				this._relatedCharIds.Add(charId, relatedChars);
			}
			bool flag2 = relationTypes == 0;
			if (flag2)
			{
				relatedChars.General.Add(relatedCharId);
			}
			else
			{
				for (int i = 0; i < 17; i++)
				{
					ushort currType = (ushort)(1 << i);
					bool flag3 = (relationTypes & currType) > 0;
					if (flag3)
					{
						relatedChars.Add(relatedCharId, currType);
					}
				}
			}
		}

		// Token: 0x06007302 RID: 29442 RVA: 0x0042A17C File Offset: 0x0042837C
		private void RelatedCharIds_RemoveRelations(int charId, int relatedCharId, ushort relationTypes)
		{
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			if (!flag)
			{
				bool flag2 = relationTypes == 0;
				if (flag2)
				{
					relatedChars.General.Remove(relatedCharId);
				}
				else
				{
					for (int i = 0; i < 17; i++)
					{
						ushort currType = (ushort)(1 << i);
						bool flag3 = (relationTypes & currType) > 0;
						if (flag3)
						{
							relatedChars.Remove(relatedCharId, currType);
						}
					}
				}
			}
		}

		// Token: 0x06007303 RID: 29443 RVA: 0x0042A1F0 File Offset: 0x004283F0
		private void AddRelationInternal(DataContext context, int charId, int relatedCharId, ushort addingType, int establishmentDate)
		{
			RelationKey relationKey = new RelationKey(charId, relatedCharId);
			RelatedCharacter relation;
			bool flag = this._relations.TryGetValue(relationKey, out relation);
			if (flag)
			{
				bool flag2 = addingType == 0;
				if (!flag2)
				{
					ushort relationType = this.RelatedCharIds_AddRelation(charId, relatedCharId, relation.RelationType, addingType);
					relation.RelationType = relationType;
					this.SetElement_Relations(relationKey, relation, context);
					Events.RaiseRelationAdded(context, charId, relatedCharId, addingType);
				}
			}
			else
			{
				short initialFavorability = this.IsAnyCharacterCreating() ? this.GetInitialFabricatedFavorability(context.Random, charId, addingType) : this.CalcInitialFavorability(context.Random, charId, relatedCharId);
				this.CreateRelation(context, charId, relatedCharId, addingType, initialFavorability, establishmentDate);
				Events.RaiseRelationAdded(context, charId, relatedCharId, addingType);
			}
		}

		// Token: 0x06007304 RID: 29444 RVA: 0x0042A2A0 File Offset: 0x004284A0
		private RelatedCharacter CreateRelation(DataContext context, int charId, int relatedCharId, ushort relationType, short initialFavorability, int establishmentDate = -2147483648)
		{
			RelationKey key = new RelationKey(charId, relatedCharId);
			RelatedCharacter relation = new RelatedCharacter(relationType, initialFavorability, (establishmentDate == int.MinValue) ? DomainManager.World.GetCurrDate() : establishmentDate);
			this.AddElement_Relations(key, relation, context);
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			if (flag)
			{
				relatedChars = new RelatedCharacters();
				this._relatedCharIds.Add(charId, relatedChars);
			}
			relatedChars.Add(relatedCharId, relationType);
			return relation;
		}

		// Token: 0x06007305 RID: 29445 RVA: 0x0042A320 File Offset: 0x00428520
		internal short CalcInitialFavorability(IRandomSource random, int charId, int relatedCharId)
		{
			bool notIntelligentCharacter = true;
			Character character;
			bool flag = this._objects.TryGetValue(charId, out character);
			sbyte selfBehaviorType;
			OrganizationMemberItem selfOrgMemberCfg;
			if (flag)
			{
				notIntelligentCharacter = character.IsFavorabilityGainFixed;
				selfBehaviorType = character.GetBehaviorType();
				selfOrgMemberCfg = OrganizationDomain.GetOrgMemberConfig(character.GetOrganizationInfo());
			}
			else
			{
				DeadCharacter deadChar;
				bool flag2 = this._deadCharacters.TryGetValue(charId, out deadChar);
				if (flag2)
				{
					selfBehaviorType = BehaviorType.GetBehaviorType(deadChar.Morality);
					selfOrgMemberCfg = OrganizationDomain.GetOrgMemberConfig(deadChar.OrganizationInfo);
				}
				else
				{
					selfBehaviorType = -1;
					selfOrgMemberCfg = OrganizationMember.Instance[0];
				}
			}
			Character relatedChar;
			bool flag3 = this._objects.TryGetValue(relatedCharId, out relatedChar);
			ValueTuple<short, sbyte, sbyte, short, sbyte, sbyte, OrganizationMemberItem> targetData;
			if (flag3)
			{
				targetData = CharacterDomain.GetInitialFavorabilityRelatedDataOfAliveChar(relatedChar);
			}
			else
			{
				DeadCharacter deadChar2;
				bool flag4 = this._deadCharacters.TryGetValue(charId, out deadChar2);
				if (flag4)
				{
					targetData = CharacterDomain.GetInitialFavorabilityRelatedDataOfDeadChar(deadChar2);
				}
				else
				{
					targetData = CharacterDomain.GetDefaultInitialFavorabilityRelatedData();
				}
			}
			bool relatedCharIsTaiwu = relatedCharId == DomainManager.Taiwu.GetTaiwuCharId();
			bool selfCharIsTaiwu = charId == DomainManager.Taiwu.GetTaiwuCharId();
			bool hasTaiwu = relatedCharIsTaiwu || selfCharIsTaiwu;
			int initialFavor = CharacterDomain.CalcInitialFavorability(selfOrgMemberCfg, targetData.Item1, targetData.Item2, targetData.Item3, targetData.Item4, selfBehaviorType, targetData.Item5, hasTaiwu, notIntelligentCharacter);
			bool flag5 = relatedCharIsTaiwu;
			if (flag5)
			{
				short percent = CharacterDomain.GetWorldFavorabilityPercent(notIntelligentCharacter);
				bool flag6 = selfOrgMemberCfg.Organization == 16;
				if (flag6)
				{
					initialFavor += (int)(9000 * percent / 100);
				}
				short taiwuSettlementId = DomainManager.Taiwu.GetTaiwuVillageSettlementId();
				int buildingEffect = DomainManager.Building.GetBuildingBlockEffect(taiwuSettlementId, EBuildingScaleEffect.InitialFavorability, -1);
				initialFavor += buildingEffect * (int)percent / 100;
			}
			return (short)Math.Clamp(initialFavor, -30000, 30000);
		}

		// Token: 0x06007306 RID: 29446 RVA: 0x0042A4B4 File Offset: 0x004286B4
		[return: TupleElementNames(new string[]
		{
			"favor",
			"relatedFavor"
		})]
		private static ValueTuple<short, short> CalcInitialFavorabilitiesOfAliveChars(IRandomSource random, Character character, Character relatedChar)
		{
			ValueTuple<short, sbyte, sbyte, short, sbyte, sbyte, OrganizationMemberItem> selfData = CharacterDomain.GetInitialFavorabilityRelatedDataOfAliveChar(character);
			ValueTuple<short, sbyte, sbyte, short, sbyte, sbyte, OrganizationMemberItem> relatedData = CharacterDomain.GetInitialFavorabilityRelatedDataOfAliveChar(relatedChar);
			bool selfNotIntelligentCharacter = character.IsFavorabilityGainFixed;
			bool relatedNotIntelligentCharacter = relatedChar.IsFavorabilityGainFixed;
			bool relatedCharIsTaiwu = relatedChar.GetId() == DomainManager.Taiwu.GetTaiwuCharId();
			bool selfCharIsTaiwu = character.GetId() == DomainManager.Taiwu.GetTaiwuCharId();
			bool hasTaiwu = relatedCharIsTaiwu || selfCharIsTaiwu;
			int initialFavor = CharacterDomain.CalcInitialFavorability(selfData.Item7, relatedData.Item1, relatedData.Item2, relatedData.Item3, relatedData.Item4, selfData.Item5, relatedData.Item5, hasTaiwu, selfNotIntelligentCharacter);
			bool flag = relatedCharIsTaiwu;
			if (flag)
			{
				initialFavor = CharacterDomain.<CalcInitialFavorabilitiesOfAliveChars>g__TaiwuRelatedFavorAdd|841_0(initialFavor, character);
			}
			short favor = (short)Math.Clamp(initialFavor, -30000, 30000);
			int relatedInitialFavor = CharacterDomain.CalcInitialFavorability(relatedData.Item7, selfData.Item1, selfData.Item2, selfData.Item3, selfData.Item4, relatedData.Item5, selfData.Item5, hasTaiwu, relatedNotIntelligentCharacter);
			bool flag2 = selfCharIsTaiwu;
			if (flag2)
			{
				relatedInitialFavor = CharacterDomain.<CalcInitialFavorabilitiesOfAliveChars>g__TaiwuRelatedFavorAdd|841_0(relatedInitialFavor, relatedChar);
			}
			short relatedFavor = (short)Math.Clamp(relatedInitialFavor, -30000, 30000);
			return new ValueTuple<short, short>(favor, relatedFavor);
		}

		// Token: 0x06007307 RID: 29447 RVA: 0x0042A5D4 File Offset: 0x004287D4
		[return: TupleElementNames(new string[]
		{
			"attraction",
			"fameType",
			"gender",
			"clothingTemplateId",
			"behaviorType",
			"interactionGrade",
			"orgMemberCfg"
		})]
		private static ValueTuple<short, sbyte, sbyte, short, sbyte, sbyte, OrganizationMemberItem> GetInitialFavorabilityRelatedDataOfAliveChar(Character character)
		{
			ItemKey clothingKey = character.GetEquipment()[4];
			short clothingTemplateId = (clothingKey.IsValid() && !DomainManager.Item.GetBaseItem(clothingKey).IsDurabilityRunningOut()) ? clothingKey.TemplateId : -1;
			return new ValueTuple<short, sbyte, sbyte, short, sbyte, sbyte, OrganizationMemberItem>(character.GetAttraction(), FameType.GetFameType(character.GetFame()), character.GetDisplayingGender(), clothingTemplateId, character.GetBehaviorType(), character.GetInteractionGrade(), OrganizationDomain.GetOrgMemberConfig(character.GetOrganizationInfo()));
		}

		// Token: 0x06007308 RID: 29448 RVA: 0x0042A64C File Offset: 0x0042884C
		[return: TupleElementNames(new string[]
		{
			"attraction",
			"fameType",
			"gender",
			"clothingTemplateId",
			"behaviorType",
			"interactionGrade",
			"orgMemberCfg"
		})]
		private static ValueTuple<short, sbyte, sbyte, short, sbyte, sbyte, OrganizationMemberItem> GetInitialFavorabilityRelatedDataOfDeadChar(DeadCharacter deadCharacter)
		{
			OrganizationMemberItem orgMember = OrganizationDomain.GetOrgMemberConfig(deadCharacter.OrganizationInfo);
			return new ValueTuple<short, sbyte, sbyte, short, sbyte, sbyte, OrganizationMemberItem>(deadCharacter.Attraction, deadCharacter.FameType, deadCharacter.Avatar.GetGender(), -1, BehaviorType.GetBehaviorType(deadCharacter.Morality), deadCharacter.OrganizationInfo.Grade, orgMember);
		}

		// Token: 0x06007309 RID: 29449 RVA: 0x0042A6A0 File Offset: 0x004288A0
		[return: TupleElementNames(new string[]
		{
			"attraction",
			"fameType",
			"gender",
			"clothingTemplateId",
			"behaviorType",
			"interactionGrade",
			"orgMemberCfg"
		})]
		private static ValueTuple<short, sbyte, sbyte, short, sbyte, sbyte, OrganizationMemberItem> GetDefaultInitialFavorabilityRelatedData()
		{
			return new ValueTuple<short, sbyte, sbyte, short, sbyte, sbyte, OrganizationMemberItem>(450, 3, -1, -1, -1, 0, OrganizationMember.Instance[0]);
		}

		// Token: 0x0600730A RID: 29450 RVA: 0x0042A6CC File Offset: 0x004288CC
		private static int CalcInitialFavorability(OrganizationMemberItem selfOrgMemberCfg, short relatedAttraction, sbyte relatedFameType, sbyte relatedGender, short relatedClothingTemplateId, sbyte selfBehaviorType, sbyte relatedBehaviorType, bool hasTaiwu, bool selfIsNotIntelligentCharacter)
		{
			int factor = 100;
			factor += (int)(relatedAttraction / 3);
			factor += (int)((relatedFameType - 3) * 60);
			bool flag = relatedGender == 0;
			if (flag)
			{
				factor += 20;
			}
			bool flag2 = selfOrgMemberCfg.FavoriteClothingIds.Contains(relatedClothingTemplateId);
			if (flag2)
			{
				factor += 20;
				bool flag3 = selfOrgMemberCfg.Organization == 13;
				if (flag3)
				{
					factor += 20;
				}
			}
			else
			{
				bool flag4 = selfOrgMemberCfg.HatedClothingIds.Contains(relatedClothingTemplateId);
				if (flag4)
				{
					factor -= 20;
				}
			}
			bool flag5 = selfBehaviorType >= 0 && relatedBehaviorType >= 0;
			if (flag5)
			{
				bool flag6 = selfBehaviorType == relatedBehaviorType;
				if (flag6)
				{
					factor += 60;
				}
				else
				{
					bool flag7 = BehaviorType.IsContradictory(selfBehaviorType, relatedBehaviorType);
					if (flag7)
					{
						factor -= 60;
					}
				}
			}
			if (hasTaiwu)
			{
				short percent = CharacterDomain.GetWorldFavorabilityPercent(selfIsNotIntelligentCharacter);
				int change = factor - 100;
				change = change * (int)percent / 100;
				factor = 100 + change;
			}
			return 3000 * factor / 100;
		}

		// Token: 0x0600730B RID: 29451 RVA: 0x0042A7B8 File Offset: 0x004289B8
		private short GetInitialFabricatedFavorability(IRandomSource random, int charId, ushort relationType)
		{
			bool flag = relationType == 0;
			short result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				Character character;
				bool flag2 = this._objects.TryGetValue(charId, out character);
				short morality;
				sbyte orgTemplateId;
				if (flag2)
				{
					morality = character.GetMorality();
					orgTemplateId = character.GetOrganizationInfo().OrgTemplateId;
				}
				else
				{
					DeadCharacter deadChar;
					bool flag3 = this._deadCharacters.TryGetValue(charId, out deadChar);
					if (!flag3)
					{
						return 0;
					}
					morality = deadChar.Morality;
					orgTemplateId = deadChar.OrganizationInfo.OrgTemplateId;
				}
				ValueTuple<short[], int> initialFabricatedFavorabilitySettings = CharacterDomain.GetInitialFabricatedFavorabilitySettings(orgTemplateId, relationType);
				short[] settings = initialFabricatedFavorabilitySettings.Item1;
				int offset = initialFabricatedFavorabilitySettings.Item2;
				sbyte behaviorType = BehaviorType.GetBehaviorType(morality);
				short mean = settings[offset + (int)behaviorType];
				short min = settings[offset + 5];
				short max = settings[offset + 5 + 1];
				float stdDev = (float)(max - min) / 7f;
				result = (short)RedzenHelper.NormalDistribute(random, (float)mean, stdDev, (int)min, (int)max);
			}
			return result;
		}

		// Token: 0x0600730C RID: 29452 RVA: 0x0042A894 File Offset: 0x00428A94
		[return: TupleElementNames(new string[]
		{
			"settings",
			"offset"
		})]
		private static ValueTuple<short[], int> GetInitialFabricatedFavorabilitySettings(sbyte orgTemplateId, ushort relationType)
		{
			bool flag = relationType == 2048 || relationType == 4096;
			if (flag)
			{
				sbyte largeSectIndex = OrganizationDomain.GetLargeSectIndex(orgTemplateId);
				bool flag2 = largeSectIndex >= 0;
				if (flag2)
				{
					return new ValueTuple<short[], int>(CharacterDomain.InitialMentorFabricatedFavorOfSects, (int)(largeSectIndex * 7));
				}
			}
			sbyte relationTypeId = RelationType.GetTypeId(relationType);
			return new ValueTuple<short[], int>(CharacterDomain.InitialFabricatedFavorOfRelationTypes, (int)(relationTypeId * 7));
		}

		// Token: 0x0600730D RID: 29453 RVA: 0x0042A8F8 File Offset: 0x00428AF8
		private bool HasNominalDirectBloodRelation(CharacterSet characterSet, int relatedCharId, bool exceptBloodParent)
		{
			HashSet<int> charIds = characterSet.GetCollection();
			bool flag = charIds.Count <= 0;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				foreach (int charId in charIds)
				{
					RelatedCharacter relation;
					bool flag2 = !this._relations.TryGetValue(new RelationKey(charId, relatedCharId), out relation);
					if (!flag2)
					{
						bool flag3 = !RelationType.ContainDirectBloodRelations(relation.RelationType);
						if (!flag3)
						{
							bool flag4 = exceptBloodParent && (relation.RelationType & 1) > 0;
							if (!flag4)
							{
								return true;
							}
						}
					}
				}
				result = false;
			}
			return result;
		}

		// Token: 0x0600730E RID: 29454 RVA: 0x0042A9C0 File Offset: 0x00428BC0
		private unsafe bool HasActualDirectBloodRelation(int charId, int relatedCharId, bool exceptBloodParent, HashSet<int> actualDirectBloodCharIds = null)
		{
			RelatedCharacters relatedChars;
			this._relatedCharIds.TryGetValue(charId, out relatedChars);
			int* pActualBloodParentIds = stackalloc int[(UIntPtr)8];
			this.GetActualBloodParents(charId, relatedChars, pActualBloodParentIds);
			for (int i = 0; i < 2; i++)
			{
				int actualBloodParentId = pActualBloodParentIds[i];
				bool flag = actualBloodParentId >= 0;
				if (flag)
				{
					bool flag2 = actualBloodParentId == relatedCharId && !exceptBloodParent;
					if (flag2)
					{
						return true;
					}
					if (actualDirectBloodCharIds != null)
					{
						actualDirectBloodCharIds.Add(actualBloodParentId);
					}
				}
			}
			for (int j = 0; j < 2; j++)
			{
				int actualBloodParentId2 = pActualBloodParentIds[j];
				bool flag3 = actualBloodParentId2 >= 0;
				if (flag3)
				{
					RelatedCharacters currRelatedChars;
					this._relatedCharIds.TryGetValue(actualBloodParentId2, out currRelatedChars);
					bool flag4 = this.IsActualBloodChildren(actualBloodParentId2, currRelatedChars, relatedCharId, actualDirectBloodCharIds);
					if (flag4)
					{
						return true;
					}
				}
			}
			if (actualDirectBloodCharIds != null)
			{
				actualDirectBloodCharIds.Remove(charId);
			}
			return this.IsActualBloodChildren(charId, relatedChars, relatedCharId, actualDirectBloodCharIds);
		}

		// Token: 0x0600730F RID: 29455 RVA: 0x0042AAC8 File Offset: 0x00428CC8
		private unsafe void GetActualBloodParents(int charId, RelatedCharacters relatedChars, int* pActualBloodParentIds)
		{
			IntPtr intPtr = stackalloc byte[(UIntPtr)8];
			*intPtr = -2;
			*(intPtr + 4) = -1;
			int* pNominalBloodParentIds = intPtr;
			bool flag = relatedChars != null;
			if (flag)
			{
				HashSet<int> bloodParentIds = relatedChars.BloodParents.GetCollection();
				foreach (int bloodParentId in bloodParentIds)
				{
					sbyte gender = this.GetAliveOrDeadCharacterGender(bloodParentId);
					bool flag2 = gender != -1;
					if (flag2)
					{
						pNominalBloodParentIds[gender] = bloodParentId;
					}
					else
					{
						bool flag3 = *pNominalBloodParentIds < 0;
						if (flag3)
						{
							*pNominalBloodParentIds = bloodParentId;
						}
						else
						{
							pNominalBloodParentIds[1] = bloodParentId;
						}
					}
				}
			}
			for (int i = 0; i < 2; i++)
			{
				int nominalBloodParentId = pNominalBloodParentIds[i];
				int actualParentId;
				pActualBloodParentIds[i] = (this.TryGetActualBloodParent(nominalBloodParentId, charId, out actualParentId) ? actualParentId : nominalBloodParentId);
			}
		}

		// Token: 0x06007310 RID: 29456 RVA: 0x0042ABB4 File Offset: 0x00428DB4
		private bool IsActualBloodChildren(int charId, RelatedCharacters relatedChars, int relatedCharId, HashSet<int> actualDirectBloodCharIds = null)
		{
			bool flag = relatedChars != null;
			if (flag)
			{
				HashSet<int> bloodChildIds = relatedChars.BloodChildren.GetCollection();
				foreach (int bloodChildId in bloodChildIds)
				{
					int actualParentId;
					bool flag2 = !this.TryGetActualBloodParent(charId, bloodChildId, out actualParentId);
					if (flag2)
					{
						bool flag3 = bloodChildId == relatedCharId;
						if (flag3)
						{
							return true;
						}
						if (actualDirectBloodCharIds != null)
						{
							actualDirectBloodCharIds.Add(bloodChildId);
						}
					}
				}
			}
			List<ParentAndChild> nominalRelations = this.GetNominalBloodParentRelations(charId);
			bool flag4 = nominalRelations != null;
			if (flag4)
			{
				int i = 0;
				int count = nominalRelations.Count;
				while (i < count)
				{
					int childId = nominalRelations[i].ChildId;
					bool flag5 = childId == relatedCharId;
					if (flag5)
					{
						return true;
					}
					if (actualDirectBloodCharIds != null)
					{
						actualDirectBloodCharIds.Add(childId);
					}
					i++;
				}
			}
			return false;
		}

		// Token: 0x06007311 RID: 29457 RVA: 0x0042ACBC File Offset: 0x00428EBC
		private int GetAliveRemarrySpouse(int charId, int firstSpouseCharId)
		{
			RelatedCharacters relatedChars;
			bool flag = this._relatedCharIds.TryGetValue(charId, out relatedChars);
			if (flag)
			{
				HashSet<int> husbandOrWifeIds = relatedChars.HusbandsAndWives.GetCollection();
				foreach (int husbandOrWifeId in husbandOrWifeIds)
				{
					bool flag2 = husbandOrWifeId != firstSpouseCharId && this.IsCharacterAlive(husbandOrWifeId);
					if (flag2)
					{
						return husbandOrWifeId;
					}
				}
			}
			return -1;
		}

		// Token: 0x06007312 RID: 29458 RVA: 0x0042AD4C File Offset: 0x00428F4C
		private void SetFavorability(DataContext context, int charId, int relatedCharId, short value)
		{
			value = Math.Clamp(value, -30000, 30000);
			RelationKey relationKey = new RelationKey(charId, relatedCharId);
			RelatedCharacter relation;
			bool flag = this._relations.TryGetValue(relationKey, out relation);
			if (flag)
			{
				relation.Favorability = value;
				this.SetElement_Relations(relationKey, relation, context);
			}
			else
			{
				this.CreateRelation(context, charId, relatedCharId, 0, value, int.MinValue);
			}
		}

		// Token: 0x06007313 RID: 29459 RVA: 0x0042ADB4 File Offset: 0x00428FB4
		[DomainMethod]
		public int CalcItemsFavorabilityDelta(int characterId, int relatedCharId, Inventory items, short type)
		{
			bool flag = items != null && items.InventoryItemTotalCount == 0;
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				Character character = this.GetElement_Objects(characterId);
				Character relatedChar = this.GetElement_Objects(relatedCharId);
				int itemFavor = 0;
				ResourceInts resources = default(ResourceInts);
				foreach (KeyValuePair<ItemKey, int> keyValuePair in items.Items)
				{
					ItemKey itemKey2;
					int num;
					keyValuePair.Deconstruct(out itemKey2, out num);
					ItemKey itemKey = itemKey2;
					int count = num;
					bool flag2 = ItemTemplateHelper.IsMiscResource(itemKey.ItemType, itemKey.TemplateId);
					if (flag2)
					{
						sbyte resourceType = ItemTemplateHelper.GetMiscResourceType(itemKey.ItemType, itemKey.TemplateId);
						resources.Add(resourceType, count);
					}
					else
					{
						ItemBase itemBase = DomainManager.Item.GetBaseItem(itemKey);
						int value = count * itemBase.GetFavorabilityChange();
						itemFavor += value;
					}
				}
				bool flag3 = resources.IsNonZero();
				if (flag3)
				{
					ValueTuple<long, long> resourcesWorth = CharacterDomain.GetResourcesWorth(ref resources);
					long borrowedWorth = resourcesWorth.Item1;
					long lentWorth = resourcesWorth.Item2;
					short favorIncrement = AiHelper.GeneralActionConstants.GetResourceFavorabilityChange(6, (int)Math.Clamp(borrowedWorth, 0L, 2147483647L));
					itemFavor += (int)favorIncrement;
				}
				result = CharacterDomain.CalcFavorabilityDelta(character, relatedChar, itemFavor, type);
			}
			return result;
		}

		// Token: 0x06007314 RID: 29460 RVA: 0x0042AF08 File Offset: 0x00429108
		[DomainMethod]
		public int CalcFavorabilityDelta(int characterId, int relatedCharId, int baseDelta, short type)
		{
			Character character = this.GetElement_Objects(characterId);
			Character relatedChar = this.GetElement_Objects(relatedCharId);
			return CharacterDomain.CalcFavorabilityDelta(character, relatedChar, baseDelta, type);
		}

		// Token: 0x06007315 RID: 29461 RVA: 0x0042AF34 File Offset: 0x00429134
		public static int CalcFavorabilityDelta(Character character, Character relatedChar, int baseDelta, short type)
		{
			int factor = 1000;
			bool flag = baseDelta > 0;
			if (flag)
			{
				bool flag2 = character.GetCreatingType() == 1;
				if (flag2)
				{
					sbyte selfBehaviorType = character.GetBehaviorType();
					sbyte relatedBehaviorType = relatedChar.GetBehaviorType();
					bool flag3 = selfBehaviorType == relatedBehaviorType;
					if (flag3)
					{
						factor += 400;
					}
					else
					{
						bool flag4 = BehaviorType.IsContradictory(selfBehaviorType, relatedBehaviorType);
						if (flag4)
						{
							factor -= 400;
						}
					}
					short relatedSettlementId = relatedChar.GetOrganizationInfo().SettlementId;
					int buildingBonus = DomainManager.Building.GetBuildingBlockEffect(relatedSettlementId, EBuildingScaleEffect.FavorIncreaseBonus, -1);
					factor += buildingBonus * 10;
					int gradeDiff = (int)(character.GetInteractionGrade() - relatedChar.GetInteractionGrade());
					factor = factor * (int)CharacterDomain.FavorabilityFactorOfGradeDifferences[8 + gradeDiff] / 100;
				}
				OuterAndInnerShorts featureFactors = character.GetFavorabilityChangingFactor();
				factor = factor * (int)featureFactors.Outer / 100;
				ValueTuple<int, bool> favFactor = DomainManager.World.GetFavorabilityChangePercent(type, character.IsFavorabilityGainFixed);
				factor = ((factor < 0 && favFactor.Item2) ? (factor * 100 / favFactor.Item1) : (factor * favFactor.Item1 / 100));
			}
			else
			{
				bool flag5 = relatedChar == DomainManager.Taiwu.GetTaiwu() && character.GetCreatingType() == 1;
				if (flag5)
				{
					OrganizationInfo selfOrgInfo = character.GetOrganizationInfo();
					bool flag6 = OrganizationDomain.IsSect(selfOrgInfo.OrgTemplateId);
					if (flag6)
					{
						bool flag7 = DomainManager.Extra.IsProfessionalSkillUnlockedAndEquipped(9) && (int)selfOrgInfo.Grade <= DomainManager.Extra.GetProfessionData(3).GetSeniorityOrgGrade();
						if (flag7)
						{
							factor -= 200;
						}
					}
					else
					{
						bool flag8 = DomainManager.Extra.IsProfessionalSkillUnlockedAndEquipped(32) && (int)selfOrgInfo.Grade <= DomainManager.Extra.GetProfessionData(10).GetSeniorityOrgGrade();
						if (flag8)
						{
							factor -= 200;
						}
					}
				}
				short relatedSettlementId2 = relatedChar.GetOrganizationInfo().SettlementId;
				int buildingBonus2 = DomainManager.Building.GetBuildingBlockEffect(relatedSettlementId2, EBuildingScaleEffect.FavorDecreaseReduction, -1);
				factor -= buildingBonus2 * 10;
				OuterAndInnerShorts featureFactors2 = character.GetFavorabilityChangingFactor();
				factor = factor * (int)featureFactors2.Inner / 100;
				ValueTuple<int, bool> favFactor2 = DomainManager.World.GetFavorabilityChangePercent(type, character.IsFavorabilityGainFixed);
				factor = ((factor > 0 && favFactor2.Item2) ? (factor * 100 / favFactor2.Item1) : (factor * favFactor2.Item1 / 100));
			}
			return baseDelta * factor / 1000;
		}

		// Token: 0x06007316 RID: 29462 RVA: 0x0042B178 File Offset: 0x00429378
		public CharacterSet GetReversedRelatedCharIds(int charId, ushort relationType)
		{
			CharacterSet relatedCharIds = default(CharacterSet);
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			CharacterSet result;
			if (flag)
			{
				result = relatedCharIds;
			}
			else
			{
				ushort oppositeRelationType = RelationType.GetOppositeRelationType(relationType);
				bool flag2 = oppositeRelationType > 0;
				if (flag2)
				{
					HashSet<int> currCharIds = relatedChars.GetCharacterSet(oppositeRelationType).GetCollection();
					relatedCharIds.AddRange(currCharIds);
				}
				else
				{
					HashSet<int> currCharIds2 = ObjectPool<HashSet<int>>.Instance.Get();
					currCharIds2.Clear();
					relatedChars.GetAllRelatedCharIds(currCharIds2, true);
					foreach (int currCharId in currCharIds2)
					{
						bool flag3 = this.HasRelation(currCharId, charId, relationType);
						if (flag3)
						{
							relatedCharIds.Add(currCharId);
						}
					}
					ObjectPool<HashSet<int>>.Instance.Return(currCharIds2);
				}
				result = relatedCharIds;
			}
			return result;
		}

		// Token: 0x06007317 RID: 29463 RVA: 0x0042B26C File Offset: 0x0042946C
		public int GetReversedRelatedCharIdCount(int charId, ushort relationType)
		{
			RelatedCharacters relatedChars;
			bool flag = !this._relatedCharIds.TryGetValue(charId, out relatedChars);
			int result;
			if (flag)
			{
				result = 0;
			}
			else
			{
				ushort oppositeRelationType = RelationType.GetOppositeRelationType(relationType);
				bool flag2 = oppositeRelationType > 0;
				if (flag2)
				{
					HashSet<int> currCharIds = relatedChars.GetCharacterSet(oppositeRelationType).GetCollection();
					result = currCharIds.Count;
				}
				else
				{
					HashSet<int> currCharIds2 = ObjectPool<HashSet<int>>.Instance.Get();
					currCharIds2.Clear();
					relatedChars.GetAllRelatedCharIds(currCharIds2, true);
					int count = 0;
					foreach (int currCharId in currCharIds2)
					{
						bool flag3 = this.HasRelation(currCharId, charId, relationType);
						if (flag3)
						{
							count++;
						}
					}
					ObjectPool<HashSet<int>>.Instance.Return(currCharIds2);
					result = count;
				}
			}
			return result;
		}

		// Token: 0x06007318 RID: 29464 RVA: 0x0042B350 File Offset: 0x00429550
		private static short GetWorldFavorabilityPercent(bool notIntelligentCharacter)
		{
			byte favorabilityChange = DomainManager.Extra.GetFavorabilityChange();
			short type = notIntelligentCharacter ? 6 : 0;
			WorldFavorabilityItem worldFavorability = WorldFavorability.Instance[type];
			return worldFavorability.InfluenceFactors[(int)favorabilityChange];
		}

		// Token: 0x06007319 RID: 29465 RVA: 0x0042B390 File Offset: 0x00429590
		public void AddFavorabilityChangeInstantNotification(Character characterA, Character characterB, bool isIncrease)
		{
			int charAId = characterA.GetId();
			int charBId = characterB.GetId();
			bool flag = DomainManager.Taiwu.GetTaiwuCharId() == charBId;
			if (flag)
			{
				InstantNotificationCollection collection = DomainManager.World.GetInstantNotificationCollection();
				short settlementId = characterA.GetOrganizationInfo().SettlementId;
				bool flag2 = settlementId >= 0;
				if (flag2)
				{
					if (isIncrease)
					{
						collection.AddFavorabilityIncreased(settlementId, charAId, charBId);
					}
					else
					{
						collection.AddFavorabilityDecreased(settlementId, charAId, charBId);
					}
				}
			}
		}

		// Token: 0x0600731A RID: 29466 RVA: 0x0042B408 File Offset: 0x00429608
		[DomainMethod]
		public Genealogy GetGenealogy(int charId)
		{
			Character character;
			bool flag = this.TryGetElement_Objects(charId, out character) && character.GetSrcCharId() >= 0;
			if (flag)
			{
				charId = character.GetSrcCharId();
			}
			Genealogy genealogy = new Genealogy
			{
				CoreCharId = charId,
				BloodFatherId = this.GetBloodParent(charId, 1),
				BloodMotherId = this.GetBloodParent(charId, 0)
			};
			bool flag2 = genealogy.BloodFatherId >= 0;
			if (flag2)
			{
				genealogy.GrandfatherId = this.GetBloodParent(genealogy.BloodFatherId, 1);
				genealogy.GrandmotherId = this.GetBloodParent(genealogy.BloodFatherId, 0);
			}
			bool flag3 = genealogy.BloodMotherId >= 0;
			if (flag3)
			{
				genealogy.MaternalGrandfatherId = this.GetBloodParent(genealogy.BloodMotherId, 1);
				genealogy.MaternalGrandmotherId = this.GetBloodParent(genealogy.BloodMotherId, 0);
			}
			genealogy.Parents = this.GetParents(charId, genealogy.BloodFatherId, genealogy.BloodMotherId);
			genealogy.BrothersAndSisters = this.GetBrothersAndSisters(charId);
			genealogy.Spouses = this.GetSpouseAndChildren(charId, 0);
			return genealogy;
		}

		// Token: 0x0600731B RID: 29467 RVA: 0x0042B514 File Offset: 0x00429714
		public int GetOtherBloodParent(int charId, int parentId)
		{
			HashSet<int> parentCharIds = this.GetRelatedCharIds(charId, 1);
			foreach (int parentCharId in parentCharIds)
			{
				bool flag = parentCharId == parentId;
				if (!flag)
				{
					return parentCharId;
				}
			}
			Character parentChar;
			bool flag2 = this._objects.TryGetValue(parentId, out parentChar);
			int result;
			if (flag2)
			{
				result = ((parentChar.GetGender() == 0) ? -1 : -2);
			}
			else
			{
				DeadCharacter parentDeadChar;
				bool flag3 = this._deadCharacters.TryGetValue(parentId, out parentDeadChar);
				if (flag3)
				{
					result = ((parentDeadChar.Gender == 0) ? -1 : -2);
				}
				else
				{
					result = -1;
				}
			}
			return result;
		}

		// Token: 0x0600731C RID: 29468 RVA: 0x0042B5D0 File Offset: 0x004297D0
		public int GetBloodParent(int charId, sbyte parentGender)
		{
			HashSet<int> parentCharIds = this.GetRelatedCharIds(charId, 1);
			List<int> removedParents = null;
			foreach (int parentCharId in parentCharIds)
			{
				sbyte gender = this.GetAliveOrDeadCharacterGender(parentCharId);
				bool flag = gender == parentGender;
				if (flag)
				{
					return parentCharId;
				}
				bool flag2 = gender == -1;
				if (flag2)
				{
					if (removedParents == null)
					{
						removedParents = new List<int>();
					}
					removedParents.Add(parentCharId);
				}
			}
			bool flag3 = removedParents != null;
			int result;
			if (flag3)
			{
				int index = (parentGender == 0) ? 0 : 1;
				result = ((removedParents.Count > index) ? removedParents[index] : -1);
			}
			else
			{
				result = ((parentGender == 0) ? -2 : -1);
			}
			return result;
		}

		// Token: 0x0600731D RID: 29469 RVA: 0x0042B69C File Offset: 0x0042989C
		private List<CharIdAndRelation> GetParents(int charId, int bloodFatherId, int bloodMotherId)
		{
			List<CharIdAndRelation> parents = new List<CharIdAndRelation>();
			bool flag = bloodFatherId >= 0;
			if (flag)
			{
				parents.Add(new CharIdAndRelation(bloodFatherId, 1));
			}
			bool flag2 = bloodMotherId >= 0;
			if (flag2)
			{
				parents.Add(new CharIdAndRelation(bloodMotherId, 1));
			}
			foreach (int relatedCharId in this.GetRelatedCharIds(charId, 8))
			{
				parents.Add(new CharIdAndRelation(relatedCharId, 8));
			}
			foreach (int relatedCharId2 in this.GetRelatedCharIds(charId, 64))
			{
				parents.Add(new CharIdAndRelation(relatedCharId2, 64));
			}
			this.Sort(charId, parents, -1);
			return parents;
		}

		// Token: 0x0600731E RID: 29470 RVA: 0x0042B798 File Offset: 0x00429998
		private List<CharIdAndRelation> GetBrothersAndSisters(int charId)
		{
			List<CharIdAndRelation> brothersAndSisters = new List<CharIdAndRelation>
			{
				new CharIdAndRelation(charId, ushort.MaxValue)
			};
			foreach (int relatedCharId in this.GetRelatedCharIds(charId, 4))
			{
				brothersAndSisters.Add(new CharIdAndRelation(relatedCharId, 4));
			}
			foreach (int relatedCharId2 in this.GetRelatedCharIds(charId, 32))
			{
				brothersAndSisters.Add(new CharIdAndRelation(relatedCharId2, 32));
			}
			foreach (int relatedCharId3 in this.GetRelatedCharIds(charId, 256))
			{
				brothersAndSisters.Add(new CharIdAndRelation(relatedCharId3, 256));
			}
			Character character;
			int num;
			if (!this.TryGetElement_Objects(charId, out character))
			{
				DeadCharacter deadCharacter = this.TryGetDeadCharacter(charId);
				num = ((deadCharacter != null) ? deadCharacter.BirthDate : -1);
			}
			else
			{
				num = character.GetBirthDate();
			}
			int birthDate = num;
			this.Sort(charId, brothersAndSisters, birthDate);
			return brothersAndSisters;
		}

		// Token: 0x0600731F RID: 29471 RVA: 0x0042B8F4 File Offset: 0x00429AF4
		private List<SpouseAndChildren> GetSpouseAndChildren(int charId, int depth = 0)
		{
			List<SpouseAndChildren> spouses = new List<SpouseAndChildren>();
			List<int> bloodChildIds = new List<int>(this.GetRelatedCharIds(charId, 2));
			List<int> stepChildIds = new List<int>(this.GetRelatedCharIds(charId, 16));
			List<int> adoptiveChildIds = new List<int>(this.GetRelatedCharIds(charId, 128));
			foreach (int spouseId in this.GetRelatedCharIds(charId, 1024))
			{
				SpouseAndChildren spouseAndChildren = new SpouseAndChildren
				{
					SpouseCharId = spouseId,
					Children = new List<CharIdAndRelation>(),
					BloodChildrenSpouses = new List<SpousesAndChildren>()
				};
				HashSet<int> spouseBloodChildIds = this.GetRelatedCharIds(spouseId, 2);
				foreach (int spouseBloodChildId in spouseBloodChildIds)
				{
					bool flag = bloodChildIds.Contains(spouseBloodChildId);
					if (flag)
					{
						bloodChildIds.Remove(spouseBloodChildId);
						spouseAndChildren.Children.Add(new CharIdAndRelation(spouseBloodChildId, 2));
						bool flag2 = depth == 0;
						if (flag2)
						{
							List<SpouseAndChildren> childSpouses = this.GetSpouseAndChildren(spouseBloodChildId, depth + 1);
							spouseAndChildren.BloodChildrenSpouses.Add(new SpousesAndChildren(spouseBloodChildId, childSpouses));
						}
					}
					else
					{
						bool flag3 = stepChildIds.Contains(spouseBloodChildId);
						if (flag3)
						{
							stepChildIds.Remove(spouseBloodChildId);
							spouseAndChildren.Children.Add(new CharIdAndRelation(spouseBloodChildId, 16));
						}
						else
						{
							Logger logger = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(77, 3);
							defaultInterpolatedStringHandler.AppendLiteral("Spouse's blood-child is neither someone's blood-child nor stepchild: (");
							defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
							defaultInterpolatedStringHandler.AppendLiteral(", ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(spouseId);
							defaultInterpolatedStringHandler.AppendLiteral(") -> ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(spouseBloodChildId);
							logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						}
					}
				}
				HashSet<int> spouseStepChildIds = this.GetRelatedCharIds(spouseId, 16);
				foreach (int spouseStepChildId in spouseStepChildIds)
				{
					bool flag4 = stepChildIds.Contains(spouseStepChildId);
					if (flag4)
					{
						stepChildIds.Remove(spouseStepChildId);
						spouseAndChildren.Children.Add(new CharIdAndRelation(spouseStepChildId, 16));
					}
					else
					{
						bool flag5 = bloodChildIds.Contains(spouseStepChildId);
						if (!flag5)
						{
							Logger logger2 = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(75, 3);
							defaultInterpolatedStringHandler.AppendLiteral("Spouse's stepchild is neither someone's blood-child nor stepchild: (");
							defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
							defaultInterpolatedStringHandler.AppendLiteral(", ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(spouseId);
							defaultInterpolatedStringHandler.AppendLiteral(") -> ");
							defaultInterpolatedStringHandler.AppendFormatted<int>(spouseStepChildId);
							logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						}
					}
				}
				HashSet<int> spouseAdoptiveChildIds = this.GetRelatedCharIds(spouseId, 128);
				foreach (int spouseAdoptiveChildId in spouseAdoptiveChildIds)
				{
					bool flag6 = adoptiveChildIds.Contains(spouseAdoptiveChildId);
					if (flag6)
					{
						adoptiveChildIds.Remove(spouseAdoptiveChildId);
						spouseAndChildren.Children.Add(new CharIdAndRelation(spouseAdoptiveChildId, 128));
					}
				}
				this.Sort(charId, spouseAndChildren.Children, -1);
				spouses.Add(spouseAndChildren);
			}
			bool flag7 = bloodChildIds.Count > 0 || stepChildIds.Count > 0 || adoptiveChildIds.Count > 0;
			if (flag7)
			{
				SpouseAndChildren spouseAndChildren2 = new SpouseAndChildren
				{
					SpouseCharId = -1,
					Children = new List<CharIdAndRelation>(),
					BloodChildrenSpouses = new List<SpousesAndChildren>()
				};
				foreach (int bloodChildId in bloodChildIds)
				{
					spouseAndChildren2.Children.Add(new CharIdAndRelation(bloodChildId, 2));
					bool flag8 = depth == 0;
					if (flag8)
					{
						List<SpouseAndChildren> childSpouses2 = this.GetSpouseAndChildren(bloodChildId, depth + 1);
						spouseAndChildren2.BloodChildrenSpouses.Add(new SpousesAndChildren(bloodChildId, childSpouses2));
					}
				}
				foreach (int stepChildId in stepChildIds)
				{
					spouseAndChildren2.Children.Add(new CharIdAndRelation(stepChildId, 16));
				}
				foreach (int adoptiveChildId in adoptiveChildIds)
				{
					spouseAndChildren2.Children.Add(new CharIdAndRelation(adoptiveChildId, 128));
				}
				this.Sort(charId, spouseAndChildren2.Children, -1);
				spouses.Add(spouseAndChildren2);
			}
			this.Sort(charId, spouses);
			return spouses;
		}

		// Token: 0x06007320 RID: 29472 RVA: 0x0042BE68 File Offset: 0x0042A068
		private void Sort(int charId, List<CharIdAndRelation> relatedChars, int selfBirthDate = -1)
		{
			relatedChars.Sort(delegate(CharIdAndRelation lhs, CharIdAndRelation rhs)
			{
				int lhsDate = (charId != lhs.CharId) ? DomainManager.Character.GetRelation(charId, lhs.CharId).EstablishmentDate : selfBirthDate;
				int rhsDate = (charId != rhs.CharId) ? DomainManager.Character.GetRelation(charId, rhs.CharId).EstablishmentDate : selfBirthDate;
				return (lhsDate != rhsDate) ? (lhsDate - rhsDate) : (lhs.CharId - rhs.CharId);
			});
		}

		// Token: 0x06007321 RID: 29473 RVA: 0x0042BEA0 File Offset: 0x0042A0A0
		private void Sort(int charId, List<SpouseAndChildren> spousesAndChildren)
		{
			spousesAndChildren.Sort(delegate(SpouseAndChildren lhs, SpouseAndChildren rhs)
			{
				int lhsDate = (lhs.SpouseCharId >= 0) ? DomainManager.Character.GetRelation(charId, lhs.SpouseCharId).EstablishmentDate : int.MaxValue;
				int rhsDate = (rhs.SpouseCharId >= 0) ? DomainManager.Character.GetRelation(charId, rhs.SpouseCharId).EstablishmentDate : int.MaxValue;
				return (lhsDate != rhsDate) ? (lhsDate - rhsDate) : (lhs.SpouseCharId - rhs.SpouseCharId);
			});
		}

		// Token: 0x06007322 RID: 29474 RVA: 0x0042BED0 File Offset: 0x0042A0D0
		public void AddActualBloodParent(DataContext context, int nominalParentId, int childId, int actualParentId)
		{
			ParentAndChild nominalRelation = new ParentAndChild(nominalParentId, childId);
			this.AddElement_ActualBloodParents(nominalRelation, actualParentId, context);
			this.AddNominalBloodParentRelation(actualParentId, nominalRelation);
		}

		// Token: 0x06007323 RID: 29475 RVA: 0x0042BEFC File Offset: 0x0042A0FC
		public void AddFatherSubstitution(DataContext context, int nominalFatherId, int childId, int actualFatherId)
		{
			ParentAndChild nominalRelation = new ParentAndChild(nominalFatherId, childId);
			this.AddElement_ActualBloodParents(nominalRelation, actualFatherId, context);
			this.AddNominalBloodParentRelation(actualFatherId, nominalRelation);
		}

		// Token: 0x06007324 RID: 29476 RVA: 0x0042BF28 File Offset: 0x0042A128
		public void AddImmaculateConception(DataContext context, int nominalFatherId, int childId)
		{
			ParentAndChild nominalRelation = new ParentAndChild(nominalFatherId, childId);
			this.AddElement_ActualBloodParents(nominalRelation, -1, context);
		}

		// Token: 0x06007325 RID: 29477 RVA: 0x0042BF4C File Offset: 0x0042A14C
		public void AddChildAbandonment(DataContext context, int nominalParentId, int childId, int actualParentId)
		{
			ParentAndChild nominalRelation = new ParentAndChild(nominalParentId, childId);
			this.AddElement_ActualBloodParents(nominalRelation, actualParentId, context);
			this.AddNominalBloodParentRelation(actualParentId, nominalRelation);
		}

		// Token: 0x06007326 RID: 29478 RVA: 0x0042BF78 File Offset: 0x0042A178
		public bool TryGetActualBloodParent(int nominalParentId, int childId, out int actualParentId)
		{
			return this._actualBloodParents.TryGetValue(new ParentAndChild(nominalParentId, childId), out actualParentId);
		}

		// Token: 0x06007327 RID: 29479 RVA: 0x0042BFA0 File Offset: 0x0042A1A0
		public List<ParentAndChild> GetNominalBloodParentRelations(int bloodParentId)
		{
			List<ParentAndChild> nominalRelations;
			this._nominalBloodParentRelations.TryGetValue(bloodParentId, out nominalRelations);
			return nominalRelations;
		}

		// Token: 0x06007328 RID: 29480 RVA: 0x0042BFC4 File Offset: 0x0042A1C4
		public void RemoveActualBloodParent(DataContext context, int nominalParentId, int childId)
		{
			ParentAndChild nominalRelation = new ParentAndChild(nominalParentId, childId);
			int actualParentId = this._actualBloodParents[nominalRelation];
			this.RemoveElement_ActualBloodParents(nominalRelation, context);
			this.RemoveNominalBloodParentRelation(actualParentId, nominalRelation);
		}

		// Token: 0x06007329 RID: 29481 RVA: 0x0042BFFC File Offset: 0x0042A1FC
		public void RemoveObsoleteActualBloodParents(DataContext context)
		{
			List<ValueTuple<ParentAndChild, int>> toBeRemoved = new List<ValueTuple<ParentAndChild, int>>();
			foreach (KeyValuePair<ParentAndChild, int> entry in this._actualBloodParents)
			{
				ParentAndChild nominalRelation = entry.Key;
				int actualParentId = entry.Value;
				bool flag = nominalRelation.ChildId >= 0 && !this.IsCharacterDeadAndRemoved(nominalRelation.ChildId);
				if (!flag)
				{
					bool flag2 = nominalRelation.ParentId >= 0 && !this.IsCharacterDeadAndRemoved(nominalRelation.ParentId);
					if (!flag2)
					{
						bool flag3 = actualParentId >= 0 && !this.IsCharacterDeadAndRemoved(actualParentId);
						if (!flag3)
						{
							toBeRemoved.Add(new ValueTuple<ParentAndChild, int>(nominalRelation, actualParentId));
						}
					}
				}
			}
			int i = 0;
			int count = toBeRemoved.Count;
			while (i < count)
			{
				ValueTuple<ParentAndChild, int> valueTuple = toBeRemoved[i];
				ParentAndChild nominalRelation2 = valueTuple.Item1;
				int actualParentId2 = valueTuple.Item2;
				this.RemoveElement_ActualBloodParents(nominalRelation2, context);
				this.RemoveNominalBloodParentRelation(actualParentId2, nominalRelation2);
				i++;
			}
		}

		// Token: 0x0600732A RID: 29482 RVA: 0x0042C128 File Offset: 0x0042A328
		private void InitializeNominalBloodParentRelations()
		{
			this._nominalBloodParentRelations = new Dictionary<int, List<ParentAndChild>>();
			foreach (KeyValuePair<ParentAndChild, int> entry in this._actualBloodParents)
			{
				this.AddNominalBloodParentRelation(entry.Value, entry.Key);
			}
		}

		// Token: 0x0600732B RID: 29483 RVA: 0x0042C198 File Offset: 0x0042A398
		private void AddNominalBloodParentRelation(int actualParentId, ParentAndChild nominalRelation)
		{
			bool flag = actualParentId < 0;
			if (!flag)
			{
				List<ParentAndChild> nominalRelations;
				bool flag2 = !this._nominalBloodParentRelations.TryGetValue(actualParentId, out nominalRelations);
				if (flag2)
				{
					nominalRelations = new List<ParentAndChild>();
					this._nominalBloodParentRelations.Add(actualParentId, nominalRelations);
				}
				nominalRelations.Add(nominalRelation);
			}
		}

		// Token: 0x0600732C RID: 29484 RVA: 0x0042C1E4 File Offset: 0x0042A3E4
		private void RemoveNominalBloodParentRelation(int actualParentId, ParentAndChild nominalRelation)
		{
			bool flag = actualParentId < 0;
			if (!flag)
			{
				List<ParentAndChild> nominalRelations = this._nominalBloodParentRelations[actualParentId];
				nominalRelations.Remove(nominalRelation);
				bool flag2 = nominalRelations.Count <= 0;
				if (flag2)
				{
					this._nominalBloodParentRelations.Remove(actualParentId);
				}
			}
		}

		// Token: 0x0600732D RID: 29485 RVA: 0x0042C230 File Offset: 0x0042A430
		public void GetSkillBookLibrary(DataContext context, Character character, List<ItemKey> combatSkillBooks, List<ItemKey> lifeSkillBooks)
		{
			int charId = character.GetId();
			context.SwitchRandomSource((ulong)((long)charId));
			GameData.Utilities.ShortList soldSkillBooks;
			bool foundLibrary = this._soldLibrarySkillBooks.TryGetValue(charId, out soldSkillBooks);
			bool flag = !foundLibrary;
			if (flag)
			{
				soldSkillBooks = GameData.Utilities.ShortList.Create();
			}
			bool flag2 = soldSkillBooks.Items == null;
			if (flag2)
			{
				soldSkillBooks.Items = new List<short>();
			}
			List<short> soldBookTemplateIds = soldSkillBooks.Items;
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> charCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(charId);
			foreach (KeyValuePair<short, GameData.Domains.CombatSkill.CombatSkill> keyValuePair in charCombatSkills)
			{
				short num;
				GameData.Domains.CombatSkill.CombatSkill combatSkill;
				keyValuePair.Deconstruct(out num, out combatSkill);
				short skillTemplateId = num;
				GameData.Domains.CombatSkill.CombatSkill skill = combatSkill;
				ushort activationState = skill.GetActivationState();
				bool flag3 = !CombatSkillStateHelper.IsBrokenOut(activationState);
				if (!flag3)
				{
					bool flag4 = !CombatSkillStateHelper.CanGenerateBookFromActivationState(activationState);
					if (!flag4)
					{
						short bookTemplateId = Config.CombatSkill.Instance[skillTemplateId].BookId;
						bool flag5 = bookTemplateId < 0;
						if (!flag5)
						{
							bool flag6 = soldBookTemplateIds.Contains(bookTemplateId);
							if (!flag6)
							{
								int currRandomSeed = charId ^ ((int)activationState << 16) + (int)bookTemplateId;
								context.Random.Reinitialise((ulong)((long)currRandomSeed));
								ItemKey itemKey = DomainManager.Item.CreateSkillBook(context, bookTemplateId, activationState);
								DomainManager.Item.SetOwner(itemKey, ItemOwnerType.Library, charId);
								combatSkillBooks.Add(itemKey);
							}
						}
					}
				}
			}
			List<LifeSkillItem> lifeSkills = character.GetLearnedLifeSkills();
			int i = 0;
			int count = lifeSkills.Count;
			while (i < count)
			{
				LifeSkillItem lifeSkill = lifeSkills[i];
				bool flag7 = lifeSkill.GetReadPagesCount() < 3;
				if (!flag7)
				{
					short bookTemplateId2 = LifeSkill.Instance[lifeSkill.SkillTemplateId].SkillBookId;
					bool flag8 = soldBookTemplateIds.Contains(bookTemplateId2);
					if (!flag8)
					{
						int currRandomSeed2 = charId ^ (int)bookTemplateId2;
						context.Random.Reinitialise((ulong)((long)currRandomSeed2));
						ItemKey itemKey2 = DomainManager.Item.CreateSkillBook(context, bookTemplateId2, -1, -1, -1, 50, true);
						DomainManager.Item.SetOwner(itemKey2, ItemOwnerType.Library, charId);
						lifeSkillBooks.Add(itemKey2);
					}
				}
				i++;
			}
			context.RestoreRandomSource();
		}

		// Token: 0x0600732E RID: 29486 RVA: 0x0042C460 File Offset: 0x0042A660
		public void DealWithSkillBookLibraryAfterTrading(DataContext context, Character character, List<ItemKey> soldSkillBooks, List<ItemKey> leftSkillBooks)
		{
			int charId = character.GetId();
			GameData.Utilities.ShortList totalSoldSkillBooks;
			bool foundLibrary = this._soldLibrarySkillBooks.TryGetValue(charId, out totalSoldSkillBooks);
			bool flag = !foundLibrary;
			if (flag)
			{
				totalSoldSkillBooks = GameData.Utilities.ShortList.Create();
			}
			bool flag2 = totalSoldSkillBooks.Items == null;
			if (flag2)
			{
				totalSoldSkillBooks.Items = new List<short>();
			}
			int i = 0;
			int count = soldSkillBooks.Count;
			while (i < count)
			{
				short bookTemplateId = soldSkillBooks[i].TemplateId;
				totalSoldSkillBooks.Items.Add(bookTemplateId);
				i++;
			}
			bool flag3 = foundLibrary;
			if (flag3)
			{
				this.SetElement_SoldLibrarySkillBooks(charId, totalSoldSkillBooks, context);
			}
			else
			{
				this.AddElement_SoldLibrarySkillBooks(charId, totalSoldSkillBooks, context);
			}
			bool flag4 = leftSkillBooks != null;
			if (flag4)
			{
				DomainManager.Item.RemoveItems(context, leftSkillBooks);
			}
		}

		// Token: 0x0600732F RID: 29487 RVA: 0x0042C523 File Offset: 0x0042A723
		public void RecoverSkillBookLibraries(DataContext context)
		{
			this.ClearSoldLibrarySkillBooks(context);
		}

		// Token: 0x06007330 RID: 29488 RVA: 0x0042C530 File Offset: 0x0042A730
		public short[] GetSkillBookLibraryGradeCount(int charId)
		{
			short[] gradeCount = new short[9];
			Character character = this.GetElement_Objects(charId);
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> charCombatSkills = DomainManager.CombatSkill.GetCharCombatSkills(charId);
			foreach (KeyValuePair<short, GameData.Domains.CombatSkill.CombatSkill> keyValuePair in charCombatSkills)
			{
				short num;
				GameData.Domains.CombatSkill.CombatSkill combatSkill;
				keyValuePair.Deconstruct(out num, out combatSkill);
				short skillTemplateId = num;
				GameData.Domains.CombatSkill.CombatSkill skill = combatSkill;
				ushort activationState = skill.GetActivationState();
				bool flag = !CombatSkillStateHelper.IsBrokenOut(activationState);
				if (!flag)
				{
					bool flag2 = !CombatSkillStateHelper.CanGenerateBookFromActivationState(activationState);
					if (!flag2)
					{
						short bookTemplateId = Config.CombatSkill.Instance[skillTemplateId].BookId;
						bool flag3 = bookTemplateId < 0;
						if (!flag3)
						{
							SkillBookItem bookConfig = Config.SkillBook.Instance[bookTemplateId];
							short[] array = gradeCount;
							sbyte grade = bookConfig.Grade;
							array[(int)grade] = array[(int)grade] + 1;
						}
					}
				}
			}
			List<LifeSkillItem> lifeSkills = character.GetLearnedLifeSkills();
			int i = 0;
			int count = lifeSkills.Count;
			while (i < count)
			{
				LifeSkillItem lifeSkill = lifeSkills[i];
				bool flag4 = lifeSkill.GetReadPagesCount() < 3;
				if (!flag4)
				{
					short bookTemplateId2 = LifeSkill.Instance[lifeSkill.SkillTemplateId].SkillBookId;
					bool flag5 = bookTemplateId2 < 0;
					if (!flag5)
					{
						SkillBookItem bookConfig2 = Config.SkillBook.Instance[bookTemplateId2];
						short[] array2 = gradeCount;
						sbyte grade2 = bookConfig2.Grade;
						array2[(int)grade2] = array2[(int)grade2] + 1;
					}
				}
				i++;
			}
			return gradeCount;
		}

		// Token: 0x06007331 RID: 29489 RVA: 0x0042C6B4 File Offset: 0x0042A8B4
		private static short GetBaseTemplateId(short charTemplateId, sbyte gender)
		{
			CharacterItem template = Character.Instance[charTemplateId];
			bool flag = template.CreatingType != 1 || template.Gender != gender;
			short result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				result = charTemplateId - (short)gender;
			}
			return result;
		}

		// Token: 0x06007332 RID: 29490 RVA: 0x0042C6F8 File Offset: 0x0042A8F8
		private static short GenerateTemplateId(short charBaseTemplateId, sbyte gender)
		{
			return charBaseTemplateId + (short)gender;
		}

		// Token: 0x06007333 RID: 29491 RVA: 0x0042C710 File Offset: 0x0042A910
		public void BeginTemporaryModification(Character character, RevertibleCharacterPropertyType type)
		{
			bool flag = this._currTemporaryModifyingCharacter != null;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(31, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Already in modification state: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(this._currTemporaryModifyingCharacter.GetId());
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			this._currTemporaryModifyingCharacter = character;
			this.BeginTemporaryModificationInternal(character, type);
		}

		// Token: 0x06007334 RID: 29492 RVA: 0x0042C774 File Offset: 0x0042A974
		public void BeginTemporaryModification(Character character, params RevertibleCharacterPropertyType[] types)
		{
			bool flag = this._currTemporaryModifyingCharacter != null;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(31, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Already in modification state: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(this._currTemporaryModifyingCharacter.GetId());
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			this._currTemporaryModifyingCharacter = character;
			int i = 0;
			int count = types.Length;
			while (i < count)
			{
				this.BeginTemporaryModificationInternal(character, types[i]);
				i++;
			}
		}

		// Token: 0x06007335 RID: 29493 RVA: 0x0042C7F0 File Offset: 0x0042A9F0
		public void RecordTemporaryModification()
		{
			bool flag = this._currTemporaryModifyingCharacter == null;
			if (flag)
			{
				throw new Exception("Not in modification state");
			}
			CharacterModificationRecords records = this.GetRecords(this._currTemporaryModifyingCharacter.GetId());
			int i = 0;
			int count = this._currTemporaryModifyingValues.Count;
			while (i < count)
			{
				this.RecordTemporaryModificationInternal(i, records);
				i++;
			}
			this._currTemporaryModifyingCharacter = null;
			this._currTemporaryModifyingValues.Clear();
		}

		// Token: 0x06007336 RID: 29494 RVA: 0x0042C864 File Offset: 0x0042AA64
		public void TemporarilyModifyHappiness(DataContext context, Character character, sbyte targetValue)
		{
			sbyte oriValue = character.GetHappiness();
			sbyte currValue = Math.Clamp(targetValue, -119, 119);
			character.SetHappiness(currValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordHappiness(oriValue, currValue);
		}

		// Token: 0x06007337 RID: 29495 RVA: 0x0042C8A4 File Offset: 0x0042AAA4
		public void TemporarilyModifyBaseMorality(DataContext context, Character character, short targetValue)
		{
			short oriValue = character.GetBaseMorality();
			short currValue = Math.Clamp(targetValue, -500, 500);
			character.SetBaseMorality(currValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordBaseMorality(oriValue, currValue);
		}

		// Token: 0x06007338 RID: 29496 RVA: 0x0042C8EC File Offset: 0x0042AAEC
		public void TemporarilyModifyFeatureIds(DataContext context, Character character, List<short> targetValue)
		{
			List<short> oriValue = character.GetFeatureIds();
			bool flag = oriValue == targetValue;
			if (flag)
			{
				throw new Exception("OriValue and targetValue are the same object");
			}
			character.SetFeatureIds(targetValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordFeatureIds(oriValue, targetValue);
		}

		// Token: 0x06007339 RID: 29497 RVA: 0x0042C934 File Offset: 0x0042AB34
		public unsafe void TemporarilyModifyBaseMainAttributes(DataContext context, Character character, MainAttributes targetValue)
		{
			MainAttributes oriValue = character.GetBaseMainAttributes();
			for (int i = 0; i < 6; i++)
			{
				*(ref targetValue.Items.FixedElementField + (IntPtr)i * 2) = Math.Max(*(ref targetValue.Items.FixedElementField + (IntPtr)i * 2), 0);
			}
			character.SetBaseMainAttributes(targetValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordBaseMainAttributes(oriValue, targetValue);
		}

		// Token: 0x0600733A RID: 29498 RVA: 0x0042C9A4 File Offset: 0x0042ABA4
		public void TemporarilyModifyDisorderOfQi(DataContext context, Character character, short targetValue)
		{
			short oriValue = character.GetDisorderOfQi();
			short currValue = Math.Clamp(targetValue, DisorderLevelOfQi.MinValue, DisorderLevelOfQi.MaxValue);
			character.SetDisorderOfQi(currValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordDisorderOfQi(oriValue, currValue);
		}

		// Token: 0x0600733B RID: 29499 RVA: 0x0042C9EC File Offset: 0x0042ABEC
		public unsafe void TemporarilyModifyInjuries(DataContext context, Character character, Injuries targetValue)
		{
			Injuries oriValue = character.GetInjuries();
			for (int i = 0; i < 14; i++)
			{
				*(ref targetValue.Items.FixedElementField + i) = Math.Clamp(*(ref targetValue.Items.FixedElementField + i), 0, 6);
			}
			character.SetInjuries(targetValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordInjuries(oriValue, targetValue);
		}

		// Token: 0x0600733C RID: 29500 RVA: 0x0042CA58 File Offset: 0x0042AC58
		public void TemporarilyModifyExtraNeili(DataContext context, Character character, int targetValue)
		{
			int oriValue = character.GetExtraNeili();
			int currValue = Math.Max(targetValue, 0);
			character.SetExtraNeili(currValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordExtraNeili(oriValue, currValue);
		}

		// Token: 0x0600733D RID: 29501 RVA: 0x0042CA94 File Offset: 0x0042AC94
		public void TemporarilyModifyConsummateLevel(DataContext context, Character character, sbyte targetValue)
		{
			sbyte oriValue = character.GetConsummateLevel();
			sbyte currValue = Math.Clamp(targetValue, 0, sbyte.MaxValue);
			character.SetConsummateLevel(currValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordConsummateLevel(oriValue, currValue);
		}

		// Token: 0x0600733E RID: 29502 RVA: 0x0042CAD4 File Offset: 0x0042ACD4
		public unsafe void TemporarilyModifyBaseLifeSkillQualifications(DataContext context, Character character, ref LifeSkillShorts targetValue)
		{
			ref LifeSkillShorts oriValue = ref character.GetBaseLifeSkillQualifications();
			fixed (LifeSkillShorts* ptr = &oriValue)
			{
				LifeSkillShorts* pOriValue = ptr;
				fixed (LifeSkillShorts* ptr2 = &targetValue)
				{
					LifeSkillShorts* pTargetValue = ptr2;
					bool flag = pOriValue == pTargetValue;
					if (flag)
					{
						throw new Exception("OriValue and targetValue are the same object");
					}
					ptr = null;
				}
				for (int i = 0; i < 16; i++)
				{
					*(ref targetValue.Items.FixedElementField + (IntPtr)i * 2) = Math.Max(*(ref targetValue.Items.FixedElementField + (IntPtr)i * 2), 0);
				}
				character.SetBaseLifeSkillQualifications(ref targetValue, context);
				CharacterModificationRecords records = this.GetRecords(character.GetId());
				records.RecordBaseLifeSkillQualifications(ref oriValue, ref targetValue);
				return;
			}
		}

		// Token: 0x0600733F RID: 29503 RVA: 0x0042CB74 File Offset: 0x0042AD74
		public unsafe void TemporarilyModifyBaseCombatSkillQualifications(DataContext context, Character character, ref CombatSkillShorts targetValue)
		{
			ref CombatSkillShorts oriValue = ref character.GetBaseCombatSkillQualifications();
			fixed (CombatSkillShorts* ptr = &oriValue)
			{
				CombatSkillShorts* pOriValue = ptr;
				fixed (CombatSkillShorts* ptr2 = &targetValue)
				{
					CombatSkillShorts* pTargetValue = ptr2;
					bool flag = pOriValue == pTargetValue;
					if (flag)
					{
						throw new Exception("OriValue and targetValue are the same object");
					}
					ptr = null;
				}
				for (int i = 0; i < 14; i++)
				{
					*(ref targetValue.Items.FixedElementField + (IntPtr)i * 2) = Math.Max(*(ref targetValue.Items.FixedElementField + (IntPtr)i * 2), 0);
				}
				character.SetBaseCombatSkillQualifications(ref targetValue, context);
				CharacterModificationRecords records = this.GetRecords(character.GetId());
				records.RecordBaseCombatSkillQualifications(ref oriValue, ref targetValue);
				return;
			}
		}

		// Token: 0x06007340 RID: 29504 RVA: 0x0042CC14 File Offset: 0x0042AE14
		public unsafe void TemporarilyModifyResources(DataContext context, Character character, ref ResourceInts targetValue)
		{
			ref ResourceInts oriValue = ref character.GetResources();
			fixed (ResourceInts* ptr = &oriValue)
			{
				ResourceInts* pOriValue = ptr;
				fixed (ResourceInts* ptr2 = &targetValue)
				{
					ResourceInts* pTargetValue = ptr2;
					bool flag = pOriValue == pTargetValue;
					if (flag)
					{
						throw new Exception("OriValue and targetValue are the same object");
					}
					ptr = null;
				}
				for (int i = 0; i < 8; i++)
				{
					bool flag2 = *(ref targetValue.Items.FixedElementField + (IntPtr)i * 4) < 0;
					if (flag2)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(41, 3);
						defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetId());
						defaultInterpolatedStringHandler.AppendLiteral("'s resource amount cannot be negative: ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(i);
						defaultInterpolatedStringHandler.AppendLiteral(", ");
						defaultInterpolatedStringHandler.AppendFormatted<int>(*(ref targetValue.Items.FixedElementField + (IntPtr)i * 4));
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
				}
				character.SetResources(ref targetValue, context);
				CharacterModificationRecords records = this.GetRecords(character.GetId());
				records.RecordResources(ref oriValue, ref targetValue);
				return;
			}
		}

		// Token: 0x06007341 RID: 29505 RVA: 0x0042CD10 File Offset: 0x0042AF10
		public unsafe void TemporarilyModifyCurrMainAttributes(DataContext context, Character character, MainAttributes targetValue)
		{
			MainAttributes oriValue = character.GetCurrMainAttributes();
			for (int i = 0; i < 6; i++)
			{
				*(ref targetValue.Items.FixedElementField + (IntPtr)i * 2) = Math.Max(*(ref targetValue.Items.FixedElementField + (IntPtr)i * 2), 0);
			}
			character.SetCurrMainAttributes(targetValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordCurrMainAttributes(oriValue, targetValue);
		}

		// Token: 0x06007342 RID: 29506 RVA: 0x0042CD80 File Offset: 0x0042AF80
		public unsafe void TemporarilyModifyPoisoned(DataContext context, Character character, ref PoisonInts targetValue)
		{
			ref PoisonInts oriValue = ref character.GetPoisoned();
			fixed (PoisonInts* ptr = &oriValue)
			{
				PoisonInts* pOriValue = ptr;
				fixed (PoisonInts* ptr2 = &targetValue)
				{
					PoisonInts* pTargetValue = ptr2;
					bool flag = pOriValue == pTargetValue;
					if (flag)
					{
						throw new Exception("OriValue and targetValue are the same object");
					}
					ptr = null;
				}
				int maxValue = 25000;
				for (int i = 0; i < 6; i++)
				{
					*(ref targetValue.Items.FixedElementField + (IntPtr)i * 4) = Math.Clamp(*(ref targetValue.Items.FixedElementField + (IntPtr)i * 4), 0, maxValue);
				}
				character.SetPoisoned(ref targetValue, context);
				CharacterModificationRecords records = this.GetRecords(character.GetId());
				records.RecordPoisoned(ref oriValue, ref targetValue);
				return;
			}
		}

		// Token: 0x06007343 RID: 29507 RVA: 0x0042CE2C File Offset: 0x0042B02C
		public void TemporarilyModifyCurrNeili(DataContext context, Character character, int targetValue)
		{
			int oriValue = character.GetCurrNeili();
			bool flag = targetValue < 0;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(40, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Current neili cannot be less than zero: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(targetValue);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			int maxNeili = character.GetMaxNeili();
			int currValue = (targetValue <= maxNeili) ? targetValue : maxNeili;
			character.SetCurrNeili(currValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordCurrNeili(oriValue, currValue);
		}

		// Token: 0x06007344 RID: 29508 RVA: 0x0042CEA8 File Offset: 0x0042B0A8
		public void TemporarilyModifyExtraNeiliAllocation(DataContext context, Character character, NeiliAllocation targetValue)
		{
			NeiliAllocation oriValue = character.GetExtraNeiliAllocation();
			character.SetExtraNeiliAllocation(targetValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordExtraNeiliAllocation(oriValue, targetValue);
		}

		// Token: 0x06007345 RID: 29509 RVA: 0x0042CEDC File Offset: 0x0042B0DC
		public void TemporarilyModifyXiangshuInfection(DataContext context, Character character, byte targetValue)
		{
			byte oriValue = character.GetXiangshuInfection();
			byte currValue = Math.Clamp(targetValue, 0, 200);
			character.SetXiangshuInfection(currValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordXiangshuInfection(oriValue, currValue);
		}

		// Token: 0x06007346 RID: 29510 RVA: 0x0042CF20 File Offset: 0x0042B120
		public void TemporarilyModifyCurrAge(DataContext context, Character character, short targetValue)
		{
			short oriValue = character.GetCurrAge();
			character.SetCurrAge(targetValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordCurrAge(oriValue, targetValue);
		}

		// Token: 0x06007347 RID: 29511 RVA: 0x0042CF54 File Offset: 0x0042B154
		public void TemporarilyModifyHealth(DataContext context, Character character, short targetValue)
		{
			short oriValue = character.GetHealth();
			character.SetHealth(targetValue, context);
			CharacterModificationRecords records = this.GetRecords(character.GetId());
			records.RecordHealth(oriValue, targetValue);
		}

		// Token: 0x06007348 RID: 29512 RVA: 0x0042CF88 File Offset: 0x0042B188
		public void CreateSavepoint(int charId)
		{
			CharacterModificationRecords records = this.GetRecords(charId);
			records.CreateSavepoint();
		}

		// Token: 0x06007349 RID: 29513 RVA: 0x0042CFA8 File Offset: 0x0042B1A8
		public void RevertTemporaryModificationsToSavepoint(DataContext context, Character character)
		{
			int charId = character.GetId();
			CharacterModificationRecords records;
			bool flag = !this._characterTemporaryModifications.TryGetValue(charId, out records);
			if (!flag)
			{
				CharacterDomain.RevertTemporaryModificationsToSavepoint(context, character, records);
			}
		}

		// Token: 0x0600734A RID: 29514 RVA: 0x0042CFE0 File Offset: 0x0042B1E0
		public void RevertAllTemporaryModifications(DataContext context, Character character)
		{
			int charId = character.GetId();
			CharacterModificationRecords records;
			bool flag = !this._characterTemporaryModifications.TryGetValue(charId, out records);
			if (!flag)
			{
				CharacterDomain.RevertAllTemporaryModifications(context, character, records);
				this._characterTemporaryModifications.Remove(charId);
			}
		}

		// Token: 0x0600734B RID: 29515 RVA: 0x0042D024 File Offset: 0x0042B224
		public void RevertAllTemporaryModificationsOfAllCharacters(DataContext context)
		{
			foreach (KeyValuePair<int, CharacterModificationRecords> keyValuePair in this._characterTemporaryModifications)
			{
				int num;
				CharacterModificationRecords characterModificationRecords;
				keyValuePair.Deconstruct(out num, out characterModificationRecords);
				int charId = num;
				CharacterModificationRecords records = characterModificationRecords;
				Character character;
				bool flag = !this._objects.TryGetValue(charId, out character);
				if (!flag)
				{
					CharacterDomain.RevertAllTemporaryModifications(context, character, records);
				}
			}
			this._characterTemporaryModifications.Clear();
		}

		// Token: 0x0600734C RID: 29516 RVA: 0x0042D0B8 File Offset: 0x0042B2B8
		public void CheckCharacterTemporaryModificationState()
		{
			bool flag = this._characterTemporaryModifications.Count <= 0;
			if (flag)
			{
				return;
			}
			StringBuilder message = new StringBuilder("Some characters are still in temporary modification state:\n");
			foreach (KeyValuePair<int, CharacterModificationRecords> keyValuePair in this._characterTemporaryModifications)
			{
				int num;
				CharacterModificationRecords characterModificationRecords;
				keyValuePair.Deconstruct(out num, out characterModificationRecords);
				int charId = num;
				Character character;
				bool flag2 = this.TryGetElement_Objects(charId, out character);
				if (flag2)
				{
					StringBuilder stringBuilder = message;
					StringBuilder stringBuilder2 = stringBuilder;
					StringBuilder.AppendInterpolatedStringHandler appendInterpolatedStringHandler = new StringBuilder.AppendInterpolatedStringHandler(38, 4, stringBuilder);
					appendInterpolatedStringHandler.AppendLiteral("  TemplateId: ");
					appendInterpolatedStringHandler.AppendFormatted<short>(character.GetTemplateId());
					appendInterpolatedStringHandler.AppendLiteral(", CreatingType: ");
					appendInterpolatedStringHandler.AppendFormatted<byte>(character.GetCreatingType());
					appendInterpolatedStringHandler.AppendLiteral(", Name: ");
					appendInterpolatedStringHandler.AppendFormatted(character.GetSurname());
					appendInterpolatedStringHandler.AppendFormatted(character.GetGivenName());
					stringBuilder2.AppendLine(ref appendInterpolatedStringHandler);
				}
				else
				{
					StringBuilder stringBuilder = message;
					StringBuilder stringBuilder3 = stringBuilder;
					StringBuilder.AppendInterpolatedStringHandler appendInterpolatedStringHandler = new StringBuilder.AppendInterpolatedStringHandler(37, 1, stringBuilder);
					appendInterpolatedStringHandler.AppendLiteral("  CharacterId: ");
					appendInterpolatedStringHandler.AppendFormatted<int>(charId);
					appendInterpolatedStringHandler.AppendLiteral(" (Character not found)");
					stringBuilder3.AppendLine(ref appendInterpolatedStringHandler);
				}
			}
			throw new Exception(message.ToString());
		}

		// Token: 0x0600734D RID: 29517 RVA: 0x0042D218 File Offset: 0x0042B418
		private unsafe void BeginTemporaryModificationInternal(Character character, RevertibleCharacterPropertyType type)
		{
			RevertibleCharacterPropertyValue value = default(RevertibleCharacterPropertyValue);
			switch (type)
			{
			case RevertibleCharacterPropertyType.Happiness:
				value.Sbyte = character.GetHappiness();
				break;
			case RevertibleCharacterPropertyType.BaseMorality:
				value.Short = character.GetBaseMorality();
				break;
			case RevertibleCharacterPropertyType.FeatureIds:
				value.Object = new List<short>(character.GetFeatureIds());
				break;
			case RevertibleCharacterPropertyType.BaseMainAttributes:
				value.MainAttributes = character.GetBaseMainAttributes();
				break;
			case RevertibleCharacterPropertyType.DisorderOfQi:
				value.Short = character.GetDisorderOfQi();
				break;
			case RevertibleCharacterPropertyType.Injuries:
				value.Injuries = character.GetInjuries();
				break;
			case RevertibleCharacterPropertyType.ExtraNeili:
				value.Int = character.GetExtraNeili();
				break;
			case RevertibleCharacterPropertyType.ConsummateLevel:
				value.Sbyte = character.GetConsummateLevel();
				break;
			case RevertibleCharacterPropertyType.BaseLifeSkillQualifications:
				value.LifeSkills = *character.GetBaseLifeSkillQualifications();
				break;
			case RevertibleCharacterPropertyType.BaseCombatSkillQualifications:
				value.CombatSkills = *character.GetBaseCombatSkillQualifications();
				break;
			case RevertibleCharacterPropertyType.Resources:
				value.Resources = *character.GetResources();
				break;
			case RevertibleCharacterPropertyType.CurrMainAttributes:
				value.MainAttributes = character.GetCurrMainAttributes();
				break;
			case RevertibleCharacterPropertyType.Poisoned:
				value.Poisons = *character.GetPoisoned();
				break;
			case RevertibleCharacterPropertyType.CurrNeili:
				value.Int = character.GetCurrNeili();
				break;
			case RevertibleCharacterPropertyType.ExtraNeiliAllocation:
				value.ExtraNeiliAllocation = character.GetExtraNeiliAllocation();
				break;
			case RevertibleCharacterPropertyType.XiangshuInfection:
				value.Byte = character.GetXiangshuInfection();
				break;
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(45, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported RevertibleCharacterPropertyType: ");
				defaultInterpolatedStringHandler.AppendFormatted<RevertibleCharacterPropertyType>(type);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
			this._currTemporaryModifyingValues.Add(new ValueTuple<RevertibleCharacterPropertyType, RevertibleCharacterPropertyValue>(type, value));
		}

		// Token: 0x0600734E RID: 29518 RVA: 0x0042D3E4 File Offset: 0x0042B5E4
		private void RecordTemporaryModificationInternal(int index, CharacterModificationRecords records)
		{
			ValueTuple<RevertibleCharacterPropertyType, RevertibleCharacterPropertyValue> valueTuple = this._currTemporaryModifyingValues[index];
			RevertibleCharacterPropertyType type = valueTuple.Item1;
			RevertibleCharacterPropertyValue value = valueTuple.Item2;
			switch (type)
			{
			case RevertibleCharacterPropertyType.Happiness:
			{
				sbyte oriValue = value.Sbyte;
				sbyte currValue = this._currTemporaryModifyingCharacter.GetHappiness();
				records.RecordHappiness(oriValue, currValue);
				break;
			}
			case RevertibleCharacterPropertyType.BaseMorality:
			{
				short oriValue2 = value.Short;
				short currValue2 = this._currTemporaryModifyingCharacter.GetBaseMorality();
				records.RecordBaseMorality(oriValue2, currValue2);
				break;
			}
			case RevertibleCharacterPropertyType.FeatureIds:
			{
				List<short> oriValue3 = (List<short>)value.Object;
				List<short> currValue3 = this._currTemporaryModifyingCharacter.GetFeatureIds();
				records.RecordFeatureIds(oriValue3, currValue3);
				break;
			}
			case RevertibleCharacterPropertyType.BaseMainAttributes:
			{
				MainAttributes oriValue4 = value.MainAttributes;
				MainAttributes currValue4 = this._currTemporaryModifyingCharacter.GetBaseMainAttributes();
				records.RecordBaseMainAttributes(oriValue4, currValue4);
				break;
			}
			case RevertibleCharacterPropertyType.DisorderOfQi:
			{
				short oriValue5 = value.Short;
				short currValue5 = this._currTemporaryModifyingCharacter.GetDisorderOfQi();
				records.RecordDisorderOfQi(oriValue5, currValue5);
				break;
			}
			case RevertibleCharacterPropertyType.Injuries:
			{
				Injuries oriValue6 = value.Injuries;
				Injuries currValue6 = this._currTemporaryModifyingCharacter.GetInjuries();
				records.RecordInjuries(oriValue6, currValue6);
				break;
			}
			case RevertibleCharacterPropertyType.ExtraNeili:
			{
				int oriValue7 = value.Int;
				int currValue7 = this._currTemporaryModifyingCharacter.GetExtraNeili();
				records.RecordExtraNeili(oriValue7, currValue7);
				break;
			}
			case RevertibleCharacterPropertyType.ConsummateLevel:
			{
				sbyte oriValue8 = value.Sbyte;
				sbyte currValue8 = this._currTemporaryModifyingCharacter.GetConsummateLevel();
				records.RecordConsummateLevel(oriValue8, currValue8);
				break;
			}
			case RevertibleCharacterPropertyType.BaseLifeSkillQualifications:
			{
				ref LifeSkillShorts oriValue9 = ref value.LifeSkills;
				ref LifeSkillShorts currValue9 = ref this._currTemporaryModifyingCharacter.GetBaseLifeSkillQualifications();
				records.RecordBaseLifeSkillQualifications(ref oriValue9, ref currValue9);
				break;
			}
			case RevertibleCharacterPropertyType.BaseCombatSkillQualifications:
			{
				ref CombatSkillShorts oriValue10 = ref value.CombatSkills;
				ref CombatSkillShorts currValue10 = ref this._currTemporaryModifyingCharacter.GetBaseCombatSkillQualifications();
				records.RecordBaseCombatSkillQualifications(ref oriValue10, ref currValue10);
				break;
			}
			case RevertibleCharacterPropertyType.Resources:
			{
				ref ResourceInts oriValue11 = ref value.Resources;
				ref ResourceInts currValue11 = ref this._currTemporaryModifyingCharacter.GetResources();
				records.RecordResources(ref oriValue11, ref currValue11);
				break;
			}
			case RevertibleCharacterPropertyType.CurrMainAttributes:
			{
				MainAttributes oriValue12 = value.MainAttributes;
				MainAttributes currValue12 = this._currTemporaryModifyingCharacter.GetCurrMainAttributes();
				records.RecordCurrMainAttributes(oriValue12, currValue12);
				break;
			}
			case RevertibleCharacterPropertyType.Poisoned:
			{
				ref PoisonInts oriValue13 = ref value.Poisons;
				ref PoisonInts currValue13 = ref this._currTemporaryModifyingCharacter.GetPoisoned();
				records.RecordPoisoned(ref oriValue13, ref currValue13);
				break;
			}
			case RevertibleCharacterPropertyType.CurrNeili:
			{
				int oriValue14 = value.Int;
				int currValue14 = this._currTemporaryModifyingCharacter.GetCurrNeili();
				records.RecordCurrNeili(oriValue14, currValue14);
				break;
			}
			case RevertibleCharacterPropertyType.ExtraNeiliAllocation:
			{
				NeiliAllocation oriValue15 = value.ExtraNeiliAllocation;
				NeiliAllocation currValue15 = this._currTemporaryModifyingCharacter.GetExtraNeiliAllocation();
				records.RecordExtraNeiliAllocation(oriValue15, currValue15);
				break;
			}
			case RevertibleCharacterPropertyType.XiangshuInfection:
			{
				byte oriValue16 = value.Byte;
				byte currValue16 = this._currTemporaryModifyingCharacter.GetXiangshuInfection();
				records.RecordXiangshuInfection(oriValue16, currValue16);
				break;
			}
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(45, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported RevertibleCharacterPropertyType: ");
				defaultInterpolatedStringHandler.AppendFormatted<RevertibleCharacterPropertyType>(type);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
		}

		// Token: 0x0600734F RID: 29519 RVA: 0x0042D6E8 File Offset: 0x0042B8E8
		private CharacterModificationRecords GetRecords(int charId)
		{
			CharacterModificationRecords records;
			bool flag = this._characterTemporaryModifications.TryGetValue(charId, out records);
			CharacterModificationRecords result;
			if (flag)
			{
				result = records;
			}
			else
			{
				records = new CharacterModificationRecords();
				this._characterTemporaryModifications.Add(charId, records);
				result = records;
			}
			return result;
		}

		// Token: 0x06007350 RID: 29520 RVA: 0x0042D728 File Offset: 0x0042B928
		private unsafe static void RevertAllTemporaryModifications(DataContext context, Character character, CharacterModificationRecords records)
		{
			byte[] array;
			byte* pRawData;
			if ((array = records.RawData) == null || array.Length == 0)
			{
				pRawData = null;
			}
			else
			{
				pRawData = &array[0];
			}
			while (records.Size > 0)
			{
				ValueTuple<RevertibleCharacterPropertyType, int, ushort> valueTuple = records.Pop(pRawData);
				RevertibleCharacterPropertyType propertyType = valueTuple.Item1;
				int offset = valueTuple.Item2;
				ushort dataSize = valueTuple.Item3;
				CharacterDomain.RevertTemporaryModification(context, character, propertyType, pRawData + offset, dataSize);
			}
			array = null;
		}

		// Token: 0x06007351 RID: 29521 RVA: 0x0042D794 File Offset: 0x0042B994
		private unsafe static void RevertTemporaryModificationsToSavepoint(DataContext context, Character character, CharacterModificationRecords records)
		{
			bool flag = records.Savepoint < 0;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(37, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetId());
				defaultInterpolatedStringHandler.AppendLiteral(": records have no savepoint");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			byte[] array;
			byte* pRawData;
			if ((array = records.RawData) == null || array.Length == 0)
			{
				pRawData = null;
			}
			else
			{
				pRawData = &array[0];
			}
			while (records.Size > records.Savepoint)
			{
				ValueTuple<RevertibleCharacterPropertyType, int, ushort> valueTuple = records.Pop(pRawData);
				RevertibleCharacterPropertyType propertyType = valueTuple.Item1;
				int offset = valueTuple.Item2;
				ushort dataSize = valueTuple.Item3;
				CharacterDomain.RevertTemporaryModification(context, character, propertyType, pRawData + offset, dataSize);
			}
			array = null;
			bool flag2 = records.Size != records.Savepoint;
			if (flag2)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetId());
				defaultInterpolatedStringHandler.AppendLiteral(": malformed records data");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			records.DeleteSavepoint();
		}

		// Token: 0x06007352 RID: 29522 RVA: 0x0042D8B4 File Offset: 0x0042BAB4
		private unsafe static void RevertTemporaryModification(DataContext context, Character character, RevertibleCharacterPropertyType propertyType, byte* pModificationData, ushort dataSize)
		{
			switch (propertyType)
			{
			case RevertibleCharacterPropertyType.Happiness:
			{
				int delta = CharacterModificationRecords.RetrieveHappiness(pModificationData);
				character.ChangeHappiness(context, -delta);
				break;
			}
			case RevertibleCharacterPropertyType.BaseMorality:
			{
				int delta2 = CharacterModificationRecords.RetrieveBaseMorality(pModificationData);
				character.ChangeBaseMorality(context, -delta2);
				break;
			}
			case RevertibleCharacterPropertyType.FeatureIds:
			{
				List<ShortListModification> modifications = CharacterModificationRecords.RetrieveFeatureIds(pModificationData, dataSize);
				character.RevertFeatures(context, modifications);
				break;
			}
			case RevertibleCharacterPropertyType.BaseMainAttributes:
				character.ChangeBaseMainAttributes(context, CharacterModificationRecords.RetrieveBaseMainAttributes(pModificationData).GetReversed());
				break;
			case RevertibleCharacterPropertyType.DisorderOfQi:
			{
				int delta3 = CharacterModificationRecords.RetrieveDisorderOfQi(pModificationData);
				character.ChangeDisorderOfQi(context, (int)((short)(-(short)delta3)));
				break;
			}
			case RevertibleCharacterPropertyType.Injuries:
				character.ChangeInjuries(context, CharacterModificationRecords.RetrieveInjuries(pModificationData).GetReversed());
				break;
			case RevertibleCharacterPropertyType.ExtraNeili:
			{
				int delta4 = CharacterModificationRecords.RetrieveExtraNeili(pModificationData);
				character.ChangeExtraNeili(context, -delta4);
				break;
			}
			case RevertibleCharacterPropertyType.ConsummateLevel:
			{
				int delta5 = CharacterModificationRecords.RetrieveConsummateLevel(pModificationData);
				character.ChangeConsummateLevel(context, -delta5);
				break;
			}
			case RevertibleCharacterPropertyType.BaseLifeSkillQualifications:
			{
				LifeSkillShorts delta6 = CharacterModificationRecords.RetrieveBaseLifeSkillQualifications(pModificationData);
				delta6 = delta6.GetReversed();
				character.ChangeBaseLifeSkillQualifications(context, ref delta6);
				break;
			}
			case RevertibleCharacterPropertyType.BaseCombatSkillQualifications:
			{
				CombatSkillShorts delta7 = CharacterModificationRecords.RetrieveBaseCombatSkillQualifications(pModificationData);
				delta7 = delta7.GetReversed();
				character.ChangeBaseCombatSkillQualifications(context, ref delta7);
				break;
			}
			case RevertibleCharacterPropertyType.Resources:
			{
				ResourceInts delta8 = CharacterModificationRecords.RetrieveResources(pModificationData);
				delta8 = delta8.GetReversed();
				character.ChangeResourcesWithoutChecking(context, ref delta8);
				break;
			}
			case RevertibleCharacterPropertyType.CurrMainAttributes:
				character.ChangeCurrMainAttributes(context, CharacterModificationRecords.RetrieveCurrMainAttributes(pModificationData).GetReversed());
				break;
			case RevertibleCharacterPropertyType.Poisoned:
			{
				PoisonInts delta9 = CharacterModificationRecords.RetrievePoisoned(pModificationData);
				delta9 = delta9.GetReversed();
				character.DirectlyChangePoisoned(context, ref delta9);
				break;
			}
			case RevertibleCharacterPropertyType.CurrNeili:
			{
				int delta10 = CharacterModificationRecords.RetrieveCurrNeili(pModificationData);
				character.ChangeCurrNeiliWithoutChecking(context, -delta10);
				break;
			}
			case RevertibleCharacterPropertyType.ExtraNeiliAllocation:
				character.ChangeExtraNeiliAllocation(context, CharacterModificationRecords.RetrieveExtraNeiliAllocation(pModificationData).GetReversed());
				break;
			case RevertibleCharacterPropertyType.XiangshuInfection:
			{
				int delta11 = CharacterModificationRecords.RetrieveXiangshuInfection(pModificationData);
				character.ChangeXiangshuInfection(context, -delta11);
				break;
			}
			case RevertibleCharacterPropertyType.CurrAge:
			{
				int value = CharacterModificationRecords.RetrieveCurrAge(pModificationData);
				character.SetCurrAge((short)value, context);
				break;
			}
			case RevertibleCharacterPropertyType.Health:
			{
				int value2 = CharacterModificationRecords.RetrieveHealth(pModificationData);
				character.SetHealth((short)value2, context);
				break;
			}
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(26, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported propertyType: ");
				defaultInterpolatedStringHandler.AppendFormatted<RevertibleCharacterPropertyType>(propertyType);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
		}

		// Token: 0x06007353 RID: 29523 RVA: 0x0042DB2C File Offset: 0x0042BD2C
		public unsafe static string ReportAttributesAndQualificationsStats(Character character)
		{
			ValueTuple<string, string> name = CharacterDomain.GetRealName(character);
			OrganizationInfo organizationInfo = character.GetOrganizationInfo();
			string orgName = Organization.Instance[organizationInfo.OrgTemplateId].Name;
			string gradeName = OrganizationDomain.GetOrgMemberConfig(organizationInfo).GradeName;
			sbyte grade = organizationInfo.Grade;
			MainAttributes baseMainAttributes = character.GetBaseMainAttributes();
			LifeSkillShorts baseLifeSkillQualifications = *character.GetBaseLifeSkillQualifications();
			CombatSkillShorts baseCombatSkillQualifications = *character.GetBaseCombatSkillQualifications();
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(54, 41);
			defaultInterpolatedStringHandler.AppendFormatted(name.Item1);
			defaultInterpolatedStringHandler.AppendFormatted(name.Item2);
			defaultInterpolatedStringHandler.AppendLiteral("(");
			defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetId());
			defaultInterpolatedStringHandler.AppendLiteral("),");
			defaultInterpolatedStringHandler.AppendFormatted(orgName);
			defaultInterpolatedStringHandler.AppendLiteral(",品级,");
			defaultInterpolatedStringHandler.AppendFormatted<sbyte>(grade);
			defaultInterpolatedStringHandler.AppendLiteral(",主属性,");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseMainAttributes[0]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseMainAttributes[1]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseMainAttributes[2]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseMainAttributes[3]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseMainAttributes[4]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseMainAttributes[5]);
			defaultInterpolatedStringHandler.AppendLiteral(",技艺,");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[0]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[1]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[2]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[3]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[4]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[5]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[6]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[7]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[8]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[9]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[10]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[11]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[12]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[13]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[14]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseLifeSkillQualifications[15]);
			defaultInterpolatedStringHandler.AppendLiteral(",武学,");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[0]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[1]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[2]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[3]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[4]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[5]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[6]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[7]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[8]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[9]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[10]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[11]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[12]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			defaultInterpolatedStringHandler.AppendFormatted<short>(*baseCombatSkillQualifications[13]);
			defaultInterpolatedStringHandler.AppendLiteral(",");
			return defaultInterpolatedStringHandler.ToStringAndClear();
		}

		// Token: 0x06007354 RID: 29524 RVA: 0x0042E064 File Offset: 0x0042C264
		public void ReportAllAttributesAndQualificationsStats()
		{
			foreach (Character character in this._objects.Values)
			{
				AdaptableLog.Info(CharacterDomain.ReportAttributesAndQualificationsStats(character));
			}
		}

		// Token: 0x06007355 RID: 29525 RVA: 0x0042E0C8 File Offset: 0x0042C2C8
		private void Test_CharacterTemplateGroup()
		{
			foreach (CharacterItem template in ((IEnumerable<CharacterItem>)Character.Instance))
			{
				bool flag = template.GroupId < 0;
				if (!flag)
				{
					sbyte i = 0;
					while ((int)i < ConsummateLevel.Instance.Count)
					{
						short resultTemplateId = CharacterDomain.GetCharacterTemplateIdInGroup(template.GroupId, i);
						CharacterItem resultTemplate = Character.Instance[resultTemplateId];
						Logger logger = CharacterDomain.Logger;
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(18, 3);
						defaultInterpolatedStringHandler.AppendLiteral("taiwu level ");
						defaultInterpolatedStringHandler.AppendFormatted<sbyte>(i);
						defaultInterpolatedStringHandler.AppendLiteral(" - ");
						defaultInterpolatedStringHandler.AppendFormatted(resultTemplate.GivenName);
						defaultInterpolatedStringHandler.AppendLiteral(" (");
						defaultInterpolatedStringHandler.AppendFormatted<sbyte>(resultTemplate.ConsummateLevel);
						defaultInterpolatedStringHandler.AppendLiteral(")");
						logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
						i += 1;
					}
				}
			}
		}

		// Token: 0x06007356 RID: 29526 RVA: 0x0042E1E4 File Offset: 0x0042C3E4
		private void Test_SummarizeProfessions()
		{
			AccurateHistogram<int> histogram = new AccurateHistogram<int>((from professionCfg in Profession.Instance
			select professionCfg.Name).ToArray<string>(), (from professionCfg in Profession.Instance
			select professionCfg.TemplateId).ToArray<int>());
			int noProfessionCount = 0;
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				bool flag = character.GetCreatingType() != 1;
				if (!flag)
				{
					ProfessionData profession = DomainManager.Extra.GetCharacterCurrentProfession(charId);
					bool flag2 = profession == null;
					if (flag2)
					{
						noProfessionCount++;
					}
					else
					{
						histogram.Record(profession.TemplateId);
					}
				}
			}
			CharacterDomain.Logger.Info(histogram.GetTextGraph(100));
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(21, 1);
			defaultInterpolatedStringHandler.AppendLiteral("No Profession Count: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(noProfessionCount);
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x06007357 RID: 29527 RVA: 0x0042E334 File Offset: 0x0042C534
		private void Test_InventoryItemGroup()
		{
			Inventory inventory = new Inventory();
			inventory.OfflineAdd(new ItemKey(0, 0, 606, 0), 1);
			inventory.OfflineAdd(new ItemKey(0, 0, 608, 0), 1);
			inventory.OfflineAdd(new ItemKey(0, 0, 610, 0), 1);
			inventory.OfflineAdd(new ItemKey(0, 0, 267, 0), 1);
			inventory.OfflineAdd(new ItemKey(0, 0, 268, 0), 1);
			inventory.OfflineAdd(new ItemKey(2, 0, 227, 0), 1);
			Tester.Assert(inventory.GetItemInGroup(0, 606, 0, 8).TemplateId == 610, "");
			Tester.Assert(inventory.GetItemInGroup(0, 606, 0, 2).TemplateId == 608, "");
			Tester.Assert(inventory.GetItemInGroup(0, 606, 3, 8).TemplateId == 610, "");
			Tester.Assert(inventory.GetItemInGroup(0, 606, 6, 8).TemplateId == -1, "");
			Tester.Assert(inventory.GetItemInGroup(0, 264, 0, 2).TemplateId == -1, "");
			Tester.Assert(inventory.GetItemInGroup(2, 225, 0, 2).TemplateId == -1, "");
			Tester.Assert(inventory.GetItemInSameGroup(0, 264, -9).TemplateId == -1, "");
			Tester.Assert(inventory.GetItemInSameGroup(0, 268, -9).TemplateId == 268, "");
			Tester.Assert(inventory.GetItemInSameGroup(0, 267, -9).TemplateId == 267, "");
			Tester.Assert(inventory.GetItemInSameGroup(0, 609, -9).TemplateId == 608, "");
			Tester.Assert(inventory.GetItemInSameGroup(0, 610, -9).TemplateId == 610, "");
			Tester.Assert(inventory.GetItemInSameGroup(0, 612, -9).TemplateId == 610, "");
			Tester.Assert(inventory.GetItemInSameGroup(0, 614, -9).TemplateId == 610, "");
			Tester.Assert(inventory.GetItemInSameGroup(0, 614, -2).TemplateId == -1, "");
			Tester.Assert(inventory.HasItemInGroup(0, 606, 0, 8, null), "");
			Tester.Assert(inventory.HasItemInGroup(0, 606, 4, 8, null), "");
			Tester.Assert(inventory.HasItemInGroup(0, 606, 2, 2, null), "");
			Tester.Assert(!inventory.HasItemInGroup(0, 606, 5, 8, null), "");
			Tester.Assert(!inventory.HasItemInGroup(0, 606, 3, 3, null), "");
			Tester.Assert(!inventory.HasItemInGroup(0, 588, 0, 8, null), "");
			Tester.Assert(inventory.HasItemInSameGroup(0, 606, -9, null), "");
			Tester.Assert(inventory.HasItemInSameGroup(0, 608, -9, null), "");
			Tester.Assert(inventory.HasItemInSameGroup(0, 610, -9, null), "");
			Tester.Assert(inventory.HasItemInSameGroup(0, 612, -9, null), "");
			Tester.Assert(inventory.HasItemInSameGroup(0, 614, -9, null), "");
			Tester.Assert(!inventory.HasItemInSameGroup(0, 614, -2, null), "");
			Tester.Assert(!inventory.HasItemInSameGroup(0, 596, -9, null), "");
			Tester.Assert(!inventory.HasItemInSameGroup(2, 225, -9, null), "");
			Tester.Assert(!inventory.HasItemInSameGroup(2, 229, -9, null), "");
		}

		// Token: 0x06007358 RID: 29528 RVA: 0x0042E754 File Offset: 0x0042C954
		private ValueTuple<int, long> Test_GeneralAction_SpendResource(DataContext context, int range)
		{
			Stopwatch stopWatch = Stopwatch.StartNew();
			int totalCount = 0;
			HashSet<int> charList = new HashSet<int>();
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				charList.Clear();
				Location charLocation = character.GetLocation();
				OrganizationInfo charOrgInfo = character.GetOrganizationInfo();
				bool flag = character.GetCreatingType() != 1;
				if (!flag)
				{
					bool flag2 = !charLocation.IsValid();
					if (!flag2)
					{
						bool flag3 = character.IsActiveExternalRelationState(60);
						if (!flag3)
						{
							bool flag4 = character.IsCompletelyInfected();
							if (!flag4)
							{
								bool flag5 = character.GetAgeGroup() == 0;
								if (!flag5)
								{
									bool flag6 = DomainManager.LegendaryBook.IsCharacterActingCrazy(character);
									if (!flag6)
									{
										bool flag7 = !character.IsInRegularSettlementRange();
										if (!flag7)
										{
											MapBlockData currBlock = DomainManager.Map.GetBlock(character.GetLocation());
											bool flag8 = range == 0;
											if (flag8)
											{
												bool flag9 = currBlock.CharacterSet != null;
												if (flag9)
												{
													charList.UnionWith(currBlock.CharacterSet);
												}
											}
											else
											{
												List<MapBlockData> neighborBlocks = ObjectPool<List<MapBlockData>>.Instance.Get();
												DomainManager.Map.GetRealNeighborBlocks(charLocation.AreaId, charLocation.BlockId, neighborBlocks, range, true);
												foreach (MapBlockData block in neighborBlocks)
												{
													bool flag10 = block.CharacterSet != null;
													if (flag10)
													{
														charList.UnionWith(block.CharacterSet);
													}
												}
												ObjectPool<List<MapBlockData>>.Instance.Return(neighborBlocks);
											}
											charList.Remove(charId);
											Character selectedChar = character.SelectMaxPriorityActionTarget(context, charList, delegate(Character target)
											{
												foreach (GameData.Domains.Character.Ai.PersonalNeed need in target.GetPersonalNeeds())
												{
													bool flag12 = need.TemplateId == 10 && need.ItemType != 11;
													if (flag12)
													{
														return true;
													}
												}
												return false;
											}, true);
											bool flag11 = selectedChar == null;
											if (!flag11)
											{
												totalCount++;
											}
										}
									}
								}
							}
						}
					}
				}
			}
			long totalTime = stopWatch.ElapsedMilliseconds;
			stopWatch.Stop();
			return new ValueTuple<int, long>(totalCount, totalTime);
		}

		// Token: 0x06007359 RID: 29529 RVA: 0x0042E9CC File Offset: 0x0042CBCC
		private void Test_GenerateCloseFriendFeatures(DataContext context)
		{
			AdaptableLog.TagInfo("Test_GenerateCloseFriendFeatures", "Start testing close friend features.");
			for (int i = 0; i < 10000; i++)
			{
				Character character = new Character();
				short morality = (short)context.Random.Next(-500, 501);
				character.OfflineSetCloseFriendFields(context, morality);
				List<short> featureIds = character.GetFeatureIds();
				foreach (short featureId in featureIds)
				{
					CharacterFeatureItem featureCfg = CharacterFeature.Instance[featureId];
					bool flag = featureCfg.CandidateGroupId == 1;
					if (flag)
					{
						throw new Exception("Negative feature " + featureCfg.Name + " generated for close friend.");
					}
				}
				bool flag2 = !featureIds.Contains(164);
				if (flag2)
				{
					throw new Exception("Close friend has to contain feature " + CharacterFeature.Instance[164].Name + ".");
				}
			}
			string tag = "Test_GenerateCloseFriendFeatures";
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(27, 1);
			defaultInterpolatedStringHandler.AppendLiteral("Total ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(10000);
			defaultInterpolatedStringHandler.AppendLiteral(" iterations executed.");
			AdaptableLog.TagInfo(tag, defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x0600735A RID: 29530 RVA: 0x0042EB30 File Offset: 0x0042CD30
		private void Test_SummarizePregeneratedCharacterSize()
		{
			int totalSize = 0;
			int totalCount = this._pregeneratedRandomEnemies.Count + this._pregeneratedCityTownGuards.Length;
			foreach (int charId in this._pregeneratedRandomEnemies)
			{
				Character character = DomainManager.Character.GetElement_Objects(charId);
				totalSize += this.Test_GetCharacterDataSize(character);
			}
			foreach (int charId2 in this._pregeneratedCityTownGuards)
			{
				Character character2 = DomainManager.Character.GetElement_Objects(charId2);
				totalSize += this.Test_GetCharacterDataSize(character2);
			}
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(46, 2);
			defaultInterpolatedStringHandler.AppendLiteral("Pregenerated character count: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(totalCount);
			defaultInterpolatedStringHandler.AppendLiteral("\t Total size: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(totalSize / 1024);
			defaultInterpolatedStringHandler.AppendLiteral("kb");
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x0600735B RID: 29531 RVA: 0x0042EC4C File Offset: 0x0042CE4C
		private void Test_SummarizeAllAliveCharacterSize()
		{
			int totalSize = 0;
			foreach (Character character in this._objects.Values)
			{
				totalSize += 4 + this.Test_GetCharacterDataSize(character);
			}
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(39, 2);
			defaultInterpolatedStringHandler.AppendLiteral("Alive character count: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(this._objects.Count);
			defaultInterpolatedStringHandler.AppendLiteral("\t Total size: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(totalSize / 1024);
			defaultInterpolatedStringHandler.AppendLiteral("kb");
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x0600735C RID: 29532 RVA: 0x0042ED14 File Offset: 0x0042CF14
		private void Test_PunishSectCharacters(DataContext context)
		{
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				bool flag = character.GetCreatingType() != 1;
				if (!flag)
				{
					bool flag2 = !character.GetLocation().IsValid();
					if (!flag2)
					{
						OrganizationInfo orgInfo = character.GetOrganizationInfo();
						Sect sect;
						bool flag3 = !DomainManager.Organization.TryGetElement_Sects(orgInfo.SettlementId, out sect);
						if (!flag3)
						{
							int spouseId = this.GetAliveSpouse(charId);
							bool flag4 = spouseId < 0;
							if (!flag4)
							{
								Character spouse = this._objects[spouseId];
								bool flag5 = spouse.GetOrganizationInfo().OrgTemplateId != orgInfo.OrgTemplateId;
								if (!flag5)
								{
									bool flag6 = context.Random.NextBool();
									if (flag6)
									{
										DomainManager.Organization.PunishSectMember(context, sect, character, 4, 1, false);
									}
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x0600735D RID: 29533 RVA: 0x0042EE40 File Offset: 0x0042D040
		private int Test_GetCharacterDataSize(Character character)
		{
			int totalSize = character.GetSerializedSize();
			foreach (ItemKey itemKey in character.GetInventory().Items.Keys)
			{
				bool flag = !itemKey.IsValid();
				if (!flag)
				{
					ISerializableGameData item = (ISerializableGameData)DomainManager.Item.GetBaseItem(itemKey);
					totalSize += item.GetSerializedSize();
				}
			}
			foreach (ItemKey itemKey2 in character.GetEquipment())
			{
				bool flag2 = !itemKey2.IsValid();
				if (!flag2)
				{
					ISerializableGameData item2 = (ISerializableGameData)DomainManager.Item.GetBaseItem(itemKey2);
					totalSize += item2.GetSerializedSize();
				}
			}
			Dictionary<short, GameData.Domains.CombatSkill.CombatSkill> combatSkills = DomainManager.CombatSkill.GetCharCombatSkills(character.GetId());
			foreach (GameData.Domains.CombatSkill.CombatSkill combatSkill in combatSkills.Values)
			{
				totalSize += 2 + combatSkill.GetSerializedSize();
			}
			return totalSize;
		}

		// Token: 0x0600735E RID: 29534 RVA: 0x0042EF90 File Offset: 0x0042D190
		public void Test_AddPoisonToEveryone(DataContext context)
		{
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				Character character = character2;
				for (int i = 0; i < 80; i++)
				{
					MedicineItem cfg = Config.Medicine.Instance[i];
					bool flag = cfg.EffectType == EMedicineEffectType.ApplyPoison;
					if (flag)
					{
						character.CreateInventoryItem(context, cfg.ItemType, cfg.TemplateId, 1);
					}
				}
			}
		}

		// Token: 0x0600735F RID: 29535 RVA: 0x0042F044 File Offset: 0x0042D244
		private unsafe void Test_GenerateFirstGeneration(DataContext context)
		{
			StringBuilder stringBuilder = new StringBuilder();
			stringBuilder.AppendLine("门派\t品级\t理想门派\t成长品级\t自身属性\t属性总和\t自身技艺\t技艺总和\t自身武学\t武学总和");
			IRandomSource random = context.Random;
			List<ValueTuple<Character, sbyte, sbyte>> characters = new List<ValueTuple<Character, sbyte, sbyte>>();
			foreach (OrganizationItem orgCfg in ((IEnumerable<OrganizationItem>)Organization.Instance))
			{
				bool flag = !orgCfg.IsSect;
				bool flag2 = flag;
				if (flag2)
				{
					sbyte templateId = orgCfg.TemplateId;
					bool flag3 = templateId < 21 || templateId > 35;
					flag2 = flag3;
				}
				bool flag4 = flag2;
				if (!flag4)
				{
					foreach (short memberId in orgCfg.Members)
					{
						OrganizationMemberItem memberCfg = OrganizationMember.Instance[memberId];
						int count = (int)(memberCfg.RestrictPrincipalAmount ? memberCfg.Amount : (memberCfg.Amount * 2));
						for (int i = 0; i < count; i++)
						{
							OrganizationInfo orgInfo = new OrganizationInfo(orgCfg.TemplateId, memberCfg.Grade, true, -1);
							sbyte gender = Gender.GetRandom(random);
							bool flag5 = !OrganizationDomain.MeetGenderRestriction(orgInfo.OrgTemplateId, gender) || (memberCfg.Gender >= 0 && memberCfg.Gender != gender);
							if (flag5)
							{
								gender = Gender.Flip(gender);
							}
							short charTemplateId = orgCfg.CharTemplateIds[(int)gender];
							IntelligentCharacterCreationInfo creationInfo = new IntelligentCharacterCreationInfo(Location.Invalid, orgInfo, charTemplateId);
							creationInfo.MotherCharId = -1;
							creationInfo.ActualFatherCharId = -1;
							creationInfo.GrowingSectId = -1;
							Character fakeCharacter = new Character(charTemplateId);
							bool flag6 = fakeCharacter.GetIdealSect() < 0;
							if (flag6)
							{
								ReflectionExtensions.CallMethod(fakeCharacter, "OfflineGenerateRandomIdealSect", new object[]
								{
									random
								});
							}
							sbyte idealSect = fakeCharacter.GetIdealSect();
							creationInfo.GrowingSectGrade = Math.Clamp(CharacterCreation.CalcGrowingSectGradeAndAssignWeights(random, ref creationInfo, idealSect), 0, 8);
							MainAttributes mainAttributes = CharacterCreation.CreateMainAttributes(random, ref creationInfo, 2, 20);
							LifeSkillShorts lifeSkillQualifications = CharacterCreation.CreateLifeSkillQualifications(random, ref creationInfo, 4, 20);
							CombatSkillShorts combatSkillQualifications = CharacterCreation.CreateCombatSkillQualifications(random, ref creationInfo, 3, 20);
							ReflectionExtensions.ModifyField<Character>(fakeCharacter, "_organizationInfo", orgInfo);
							ReflectionExtensions.ModifyField<Character>(fakeCharacter, "_baseMainAttributes", mainAttributes);
							ReflectionExtensions.ModifyField<Character>(fakeCharacter, "_baseLifeSkillQualifications", lifeSkillQualifications);
							ReflectionExtensions.ModifyField<Character>(fakeCharacter, "_baseCombatSkillQualifications", combatSkillQualifications);
							stringBuilder.AppendFormat("{0}\t{1}\t{2}\t{3}\t", new object[]
							{
								orgCfg.Name,
								orgInfo.Grade,
								(idealSect < 0) ? -1 : Organization.Instance[idealSect].Name,
								creationInfo.GrowingSectGrade
							});
							this.WriteString(&mainAttributes.Items.FixedElementField, 6, stringBuilder);
							stringBuilder.Append('\t');
							stringBuilder.Append(mainAttributes.GetSum());
							stringBuilder.Append('\t');
							this.WriteString(&lifeSkillQualifications.Items.FixedElementField, 16, stringBuilder);
							stringBuilder.Append('\t');
							stringBuilder.Append(lifeSkillQualifications.GetSum());
							stringBuilder.Append('\t');
							this.WriteString(&combatSkillQualifications.Items.FixedElementField, 14, stringBuilder);
							stringBuilder.Append('\t');
							stringBuilder.Append(combatSkillQualifications.GetSum());
							stringBuilder.AppendLine();
							characters.Add(new ValueTuple<Character, sbyte, sbyte>(fakeCharacter, creationInfo.GrowingSectId, creationInfo.GrowingSectGrade));
						}
					}
				}
			}
			File.WriteAllText(Path.Combine(Program.BaseDataDir, "Logs", "FirstGeneration.txt"), stringBuilder.ToString());
			this.Test_GenerateChildren(context, characters);
		}

		// Token: 0x06007360 RID: 29536 RVA: 0x0042F414 File Offset: 0x0042D614
		private unsafe void Test_GenerateChildren(DataContext context, [TupleElementNames(new string[]
		{
			null,
			"growingSectId",
			"growingGrade"
		})] List<ValueTuple<Character, sbyte, sbyte>> characterIds)
		{
			StringBuilder stringBuilder = new StringBuilder();
			stringBuilder.AppendLine("母亲品级\t父亲品级\t品级\t母亲成长品级\t父亲成长品级\t成长品级\t门派\t理想门派\t母亲属性\t父亲属性\t自身属性\t属性总和\t母亲技艺\t父亲技艺\t自身技艺\t技艺总和\t母亲武学\t父亲武学\t自身武学\t武学总和");
			int count = 0;
			IRandomSource random = context.Random;
			while (count < 10000)
			{
				ValueTuple<Character, sbyte, sbyte> random2 = characterIds.GetRandom(random);
				Character mother = random2.Item1;
				sbyte motherGrowingSectId = random2.Item2;
				sbyte motherGrowingGrade = random2.Item3;
				ValueTuple<Character, sbyte, sbyte> random3 = characterIds.GetRandom(random);
				Character father = random3.Item1;
				sbyte fatherGroupingSectId = random3.Item2;
				sbyte fatherGrowingGrade = random3.Item3;
				bool flag = random.CheckPercentProb(20);
				if (flag)
				{
					father = null;
				}
				Location location = mother.GetLocation();
				ValueTuple<OrganizationInfo, short, bool> mainParentInfo = CharacterDomain.GetMainParentInfo(mother, father, true, true, false);
				OrganizationInfo orgInfo = mainParentInfo.Item1;
				short baseTemplateId = mainParentInfo.Item2;
				bool isAbandoned = mainParentInfo.Item3;
				IntelligentCharacterCreationInfo creationInfo = new IntelligentCharacterCreationInfo(location, orgInfo, baseTemplateId);
				creationInfo.MotherCharId = mother.GetId();
				creationInfo.Mother = mother;
				creationInfo.ActualFatherCharId = ((father != null) ? father.GetId() : -1);
				creationInfo.ActualFather = father;
				creationInfo.GrowingSectId = -1;
				creationInfo.AllowRandomGrowingGradeAdjust = true;
				Character fakeCharacter = new Character(baseTemplateId);
				bool flag2 = fakeCharacter.GetIdealSect() < 0;
				if (flag2)
				{
					ReflectionExtensions.CallMethod(fakeCharacter, "OfflineGenerateRandomIdealSect", new object[]
					{
						random
					});
				}
				sbyte idealSect = fakeCharacter.GetIdealSect();
				creationInfo.GrowingSectGrade = Math.Clamp(CharacterCreation.CalcGrowingSectGradeAndAssignWeights(context.Random, ref creationInfo, idealSect), 0, 8);
				stringBuilder.Append(mother.GetInteractionGrade());
				stringBuilder.Append('\t');
				bool flag3 = father != null;
				if (flag3)
				{
					stringBuilder.Append(father.GetInteractionGrade());
				}
				else
				{
					stringBuilder.Append(-1);
				}
				stringBuilder.Append('\t');
				stringBuilder.Append(orgInfo.Grade);
				stringBuilder.Append('\t');
				stringBuilder.Append(motherGrowingGrade);
				stringBuilder.Append('\t');
				bool flag4 = father != null;
				if (flag4)
				{
					stringBuilder.Append(fatherGrowingGrade);
				}
				else
				{
					stringBuilder.Append(-1);
				}
				stringBuilder.Append('\t');
				stringBuilder.Append(creationInfo.GrowingSectGrade);
				stringBuilder.Append('\t');
				stringBuilder.Append(Organization.Instance[orgInfo.OrgTemplateId].Name);
				stringBuilder.Append('\t');
				stringBuilder.Append((idealSect < 0) ? -1 : Organization.Instance[idealSect].Name);
				stringBuilder.Append('\t');
				this.WriteString(&mother.GetBaseMainAttributes().Items.FixedElementField, 6, stringBuilder);
				stringBuilder.Append('\t');
				bool flag5 = father != null;
				if (flag5)
				{
					this.WriteString(&father.GetBaseMainAttributes().Items.FixedElementField, 6, stringBuilder);
				}
				else
				{
					stringBuilder.Append("{}");
				}
				stringBuilder.Append('\t');
				MainAttributes mainAttributes = CharacterCreation.CreateMainAttributes(context.Random, ref creationInfo, 2, 20);
				this.WriteString(&mainAttributes.Items.FixedElementField, 6, stringBuilder);
				stringBuilder.Append('\t');
				stringBuilder.Append(mainAttributes.GetSum());
				stringBuilder.Append('\t');
				LifeSkillShorts motherLifeSkillQualifications = *mother.GetBaseLifeSkillQualifications();
				this.WriteString(&motherLifeSkillQualifications.Items.FixedElementField, 16, stringBuilder);
				stringBuilder.Append('\t');
				bool flag6 = father != null;
				if (flag6)
				{
					LifeSkillShorts fatherLifeSkillQualifications = *father.GetBaseLifeSkillQualifications();
					this.WriteString(&fatherLifeSkillQualifications.Items.FixedElementField, 16, stringBuilder);
				}
				else
				{
					stringBuilder.Append("{}");
				}
				stringBuilder.Append('\t');
				this.WriteString(&CharacterCreation.CreateLifeSkillQualifications(context.Random, ref creationInfo, 4, 20).Items.FixedElementField, 16, stringBuilder);
				stringBuilder.Append('\t');
				stringBuilder.Append(motherLifeSkillQualifications.GetSum());
				stringBuilder.Append('\t');
				CombatSkillShorts motherCombatSkillQualifications = *mother.GetBaseCombatSkillQualifications();
				this.WriteString(&motherCombatSkillQualifications.Items.FixedElementField, 14, stringBuilder);
				stringBuilder.Append('\t');
				bool flag7 = father != null;
				if (flag7)
				{
					CombatSkillShorts fatherCombatSkillQualifications = *father.GetBaseCombatSkillQualifications();
					this.WriteString(&fatherCombatSkillQualifications.Items.FixedElementField, 14, stringBuilder);
				}
				else
				{
					stringBuilder.Append("{}");
				}
				stringBuilder.Append('\t');
				CombatSkillShorts combatSkillQualifications = CharacterCreation.CreateCombatSkillQualifications(context.Random, ref creationInfo, 3, 20);
				this.WriteString(&combatSkillQualifications.Items.FixedElementField, 14, stringBuilder);
				stringBuilder.Append('\t');
				stringBuilder.Append(combatSkillQualifications.GetSum());
				stringBuilder.AppendLine();
				count++;
			}
			File.WriteAllText(Path.Combine(Program.BaseDataDir, "Logs", "ChildrenGeneration.txt"), stringBuilder.ToString());
		}

		// Token: 0x06007361 RID: 29537 RVA: 0x0042F8C8 File Offset: 0x0042DAC8
		public unsafe void Test_GenerateChildren(DataContext context)
		{
			Stopwatch timer = GlobalDomain.StartTimer();
			List<ValueTuple<Character, Character>> charsToChildbirth = new List<ValueTuple<Character, Character>>();
			float childBirthProb = 0.5f;
			StringBuilder stringBuilder = new StringBuilder();
			stringBuilder.AppendLine("母亲品级\t父亲品级\t父母最高品级\t自身未修正成长品级\t自身修正后成长品级\t母亲属性\t父亲属性\t自身属性\t属性总和\t母亲技艺\t父亲技艺\t自身技艺\t技艺总和\t母亲武学\t父亲武学\t自身武学\t武学总和");
			int count = 0;
			while (count < 10000)
			{
				for (short areaId = 0; areaId < 135; areaId += 1)
				{
					Span<MapBlockData> blocks = DomainManager.Map.GetAreaBlocks(areaId);
					int i = 0;
					int blocksCount = blocks.Length;
					while (i < blocksCount)
					{
						HashSet<int> charIds = blocks[i]->CharacterSet;
						bool flag = charIds == null;
						if (!flag)
						{
							foreach (int charId in charIds)
							{
								Character character = DomainManager.Character.GetElement_Objects(charId);
								bool flag2 = character.GetGender() != 0 || character.GetAgeGroup() != 2;
								if (!flag2)
								{
									HashSet<int> spouseCharIds = DomainManager.Character.GetRelatedCharIds(charId, 1024);
									int aliveSpouseId = DomainManager.Character.GetAliveSpouse(charId);
									bool flag3 = spouseCharIds.Count > 0 && aliveSpouseId < 0;
									if (!flag3)
									{
										bool flag4 = context.Random.NextFloat() >= childBirthProb;
										if (!flag4)
										{
											Character spouse = (aliveSpouseId >= 0) ? DomainManager.Character.GetElement_Objects(aliveSpouseId) : null;
											charsToChildbirth.Add(new ValueTuple<Character, Character>(character, spouse));
										}
									}
								}
							}
						}
						i++;
					}
				}
				foreach (ValueTuple<Character, Character> valueTuple in charsToChildbirth)
				{
					Character mother = valueTuple.Item1;
					Character father = valueTuple.Item2;
					Location location = mother.GetLocation();
					ValueTuple<OrganizationInfo, short, bool> mainParentInfo = CharacterDomain.GetMainParentInfo(mother, father, true, true, false);
					OrganizationInfo orgInfo = mainParentInfo.Item1;
					short baseTemplateId = mainParentInfo.Item2;
					bool isAbandoned = mainParentInfo.Item3;
					IntelligentCharacterCreationInfo creationInfo = new IntelligentCharacterCreationInfo(location, orgInfo, baseTemplateId);
					creationInfo.MotherCharId = mother.GetId();
					creationInfo.Mother = mother;
					creationInfo.ActualFatherCharId = ((father != null) ? father.GetId() : -1);
					creationInfo.ActualFather = father;
					Character fakeCharacter = new Character(baseTemplateId);
					bool flag5 = fakeCharacter.GetIdealSect() < 0;
					if (flag5)
					{
						ReflectionExtensions.CallMethod(fakeCharacter, "OfflineGenerateRandomIdealSect", new object[]
						{
							context.Random
						});
					}
					sbyte idealSect = fakeCharacter.GetIdealSect();
					stringBuilder.Append(mother.GetInteractionGrade());
					stringBuilder.Append('\t');
					bool flag6 = father != null;
					if (flag6)
					{
						stringBuilder.Append(father.GetInteractionGrade());
					}
					else
					{
						stringBuilder.Append(-1);
					}
					stringBuilder.Append('\t');
					sbyte parentMaxGrade = mother.GetInteractionGrade();
					bool flag7 = father != null && father.GetInteractionGrade() > parentMaxGrade;
					if (flag7)
					{
						parentMaxGrade = father.GetInteractionGrade();
					}
					stringBuilder.Append(parentMaxGrade);
					stringBuilder.Append('\t');
					creationInfo.AllowRandomGrowingGradeAdjust = false;
					creationInfo.GrowingSectGrade = CharacterCreation.CalcGrowingSectGradeAndAssignWeights(context.Random, ref creationInfo, idealSect);
					stringBuilder.Append(creationInfo.GrowingSectGrade);
					stringBuilder.Append('\t');
					creationInfo.AllowRandomGrowingGradeAdjust = true;
					creationInfo.GrowingSectGrade = CharacterCreation.CalcGrowingSectGradeAndAssignWeights(context.Random, ref creationInfo, idealSect);
					stringBuilder.Append(creationInfo.GrowingSectGrade);
					stringBuilder.Append('\t');
					this.WriteString(&mother.GetBaseMainAttributes().Items.FixedElementField, 6, stringBuilder);
					stringBuilder.Append('\t');
					bool flag8 = father != null;
					if (flag8)
					{
						this.WriteString(&father.GetBaseMainAttributes().Items.FixedElementField, 6, stringBuilder);
					}
					else
					{
						stringBuilder.Append("{}");
					}
					stringBuilder.Append('\t');
					MainAttributes mainAttributes = CharacterCreation.CreateMainAttributes(context.Random, ref creationInfo, 2, 20);
					this.WriteString(&mainAttributes.Items.FixedElementField, 6, stringBuilder);
					stringBuilder.Append('\t');
					stringBuilder.Append(mainAttributes.GetSum());
					stringBuilder.Append('\t');
					LifeSkillShorts motherLifeSkillQualifications = *mother.GetBaseLifeSkillQualifications();
					this.WriteString(&motherLifeSkillQualifications.Items.FixedElementField, 16, stringBuilder);
					stringBuilder.Append('\t');
					bool flag9 = father != null;
					if (flag9)
					{
						LifeSkillShorts fatherLifeSkillQualifications = *father.GetBaseLifeSkillQualifications();
						this.WriteString(&fatherLifeSkillQualifications.Items.FixedElementField, 16, stringBuilder);
					}
					else
					{
						stringBuilder.Append("{}");
					}
					stringBuilder.Append('\t');
					this.WriteString(&CharacterCreation.CreateLifeSkillQualifications(context.Random, ref creationInfo, 4, 20).Items.FixedElementField, 16, stringBuilder);
					stringBuilder.Append('\t');
					stringBuilder.Append(motherLifeSkillQualifications.GetSum());
					stringBuilder.Append('\t');
					CombatSkillShorts motherCombatSkillQualifications = *mother.GetBaseCombatSkillQualifications();
					this.WriteString(&motherCombatSkillQualifications.Items.FixedElementField, 14, stringBuilder);
					stringBuilder.Append('\t');
					bool flag10 = father != null;
					if (flag10)
					{
						CombatSkillShorts fatherCombatSkillQualifications = *father.GetBaseCombatSkillQualifications();
						this.WriteString(&fatherCombatSkillQualifications.Items.FixedElementField, 14, stringBuilder);
					}
					else
					{
						stringBuilder.Append("{}");
					}
					stringBuilder.Append('\t');
					CombatSkillShorts combatSkillQualifications = CharacterCreation.CreateCombatSkillQualifications(context.Random, ref creationInfo, 3, 20);
					this.WriteString(&combatSkillQualifications.Items.FixedElementField, 14, stringBuilder);
					stringBuilder.Append('\t');
					stringBuilder.Append(combatSkillQualifications.GetSum());
					stringBuilder.Append('\t');
					stringBuilder.AppendLine();
					count++;
				}
			}
			GlobalDomain.StopTimer(timer, "New Character Stats Generation");
			File.WriteAllText(Path.Combine(Program.BaseDataDir, "Logs", "GenerationSum"), stringBuilder.ToString());
		}

		// Token: 0x06007362 RID: 29538 RVA: 0x0042FEF0 File Offset: 0x0042E0F0
		private unsafe void WriteString(short* pArr, int count, StringBuilder stringBuilder)
		{
			stringBuilder.Append('{');
			for (int i = 0; i < count; i++)
			{
				stringBuilder.Append(pArr[i]);
				bool flag = i != count - 1;
				if (flag)
				{
					stringBuilder.Append(',');
				}
			}
			stringBuilder.Append('}');
		}

		// Token: 0x06007363 RID: 29539 RVA: 0x0042FF48 File Offset: 0x0042E148
		public void Test_SoftCheckGroups()
		{
			foreach (KeyValuePair<int, CharacterSet> keyValuePair in this._characterGroups)
			{
				int num;
				CharacterSet characterSet;
				keyValuePair.Deconstruct(out num, out characterSet);
				int leaderId = num;
				CharacterSet group = characterSet;
				Character leader;
				bool flag = !this._objects.TryGetValue(leaderId, out leader);
				if (flag)
				{
					Logger logger = CharacterDomain.Logger;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(22, 1);
					defaultInterpolatedStringHandler.AppendLiteral("group leader ");
					defaultInterpolatedStringHandler.AppendFormatted<int>(leaderId);
					defaultInterpolatedStringHandler.AppendLiteral(" is dead.");
					logger.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				else
				{
					HashSet<int> groupCharSet = group.GetCollection();
					foreach (int charId in groupCharSet)
					{
						Character character;
						bool flag2 = !this._objects.TryGetValue(charId, out character);
						if (flag2)
						{
							Logger logger2 = CharacterDomain.Logger;
							DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(24, 2);
							defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
							defaultInterpolatedStringHandler.AppendLiteral(" is not alive (leader ");
							defaultInterpolatedStringHandler.AppendFormatted<Character>(leader);
							defaultInterpolatedStringHandler.AppendLiteral(").");
							logger2.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
						}
						else
						{
							bool flag3 = character.GetLeaderId() != leaderId;
							if (flag3)
							{
								Logger logger3 = CharacterDomain.Logger;
								DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(18, 3);
								defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
								defaultInterpolatedStringHandler.AppendLiteral("'s leader ");
								defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetLeaderId());
								defaultInterpolatedStringHandler.AppendLiteral(" is not ");
								defaultInterpolatedStringHandler.AppendFormatted<Character>(leader);
								logger3.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
							}
							bool flag4 = charId == leaderId;
							if (!flag4)
							{
								RelatedCharacter relatedCharacter;
								bool flag5 = !this.TryGetRelation(leaderId, charId, out relatedCharacter);
								if (flag5)
								{
									Logger logger4 = CharacterDomain.Logger;
									DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(30, 2);
									defaultInterpolatedStringHandler.AppendFormatted<Character>(character);
									defaultInterpolatedStringHandler.AppendLiteral(" has not relation with leader ");
									defaultInterpolatedStringHandler.AppendFormatted<Character>(leader);
									logger4.Warn(defaultInterpolatedStringHandler.ToStringAndClear());
								}
							}
						}
					}
				}
			}
		}

		// Token: 0x06007364 RID: 29540 RVA: 0x004301A8 File Offset: 0x0042E3A8
		public void Test_HardCheckGroups()
		{
			foreach (KeyValuePair<int, CharacterSet> keyValuePair in this._characterGroups)
			{
				int num;
				CharacterSet characterSet;
				keyValuePair.Deconstruct(out num, out characterSet);
				int leaderId = num;
				CharacterSet group = characterSet;
				Character leader;
				Tester.Assert(!this._objects.TryGetValue(leaderId, out leader), "");
				HashSet<int> groupCharSet = group.GetCollection();
				foreach (int charId in groupCharSet)
				{
					Character character;
					Tester.Assert(!this._objects.TryGetValue(charId, out character), "");
					Tester.Assert(character.GetLeaderId() != leaderId, "");
					bool flag = charId == leaderId;
					if (!flag)
					{
						RelatedCharacter relatedCharacter;
						Tester.Assert(this.TryGetRelation(leaderId, charId, out relatedCharacter), "");
					}
				}
			}
		}

		// Token: 0x06007365 RID: 29541 RVA: 0x004302CC File Offset: 0x0042E4CC
		private void Test_LogMaxConsummateLevel()
		{
			CharacterDomain.<>c__DisplayClass942_0 CS$<>8__locals1;
			CS$<>8__locals1.builder = new StringBuilder();
			CS$<>8__locals1.builder.AppendLine("角色\t品级\t身龄\t方法一最大精纯\t方法一功法类型\t方法一功法造诣盘\t方法二最大精纯\t方法二功法类型\t方法二功法造诣盘\t方法三最大精纯\t方法三功法类型\t方法三功法造诣盘");
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				Character character = character2;
				CS$<>8__locals1.builder.Append(character);
				CS$<>8__locals1.builder.Append('\t');
				CS$<>8__locals1.builder.Append(character.GetOrganizationInfo().Grade);
				CS$<>8__locals1.builder.Append('\t');
				CS$<>8__locals1.builder.Append(character.GetCurrAge());
				CS$<>8__locals1.builder.Append('\t');
				short[] attainmentPanels = character.GetCombatSkillAttainmentPanels();
				sbyte combatSkillType = -1;
				sbyte maxConsummateLevel = CharacterDomain.Test_CalcMaxConsummateLevel1(attainmentPanels, ref combatSkillType);
				CS$<>8__locals1.builder.Append(maxConsummateLevel);
				CS$<>8__locals1.builder.Append('\t');
				bool flag = combatSkillType >= 0;
				if (flag)
				{
					CS$<>8__locals1.builder.Append(Config.CombatSkillType.Instance[combatSkillType].Name);
					CS$<>8__locals1.builder.Append('\t');
					CharacterDomain.<Test_LogMaxConsummateLevel>g__AppendGradesOnPanel|942_0(attainmentPanels, combatSkillType, ref CS$<>8__locals1);
				}
				else
				{
					CS$<>8__locals1.builder.Append("无");
					CS$<>8__locals1.builder.Append('\t');
				}
				CS$<>8__locals1.builder.Append('\t');
				sbyte combatSkillType2 = -1;
				sbyte maxConsummateLevel2 = CharacterDomain.Test_CalcMaxConsummateLevel2(attainmentPanels, ref combatSkillType2);
				CS$<>8__locals1.builder.Append(maxConsummateLevel2);
				CS$<>8__locals1.builder.Append('\t');
				bool flag2 = combatSkillType2 >= 0;
				if (flag2)
				{
					CS$<>8__locals1.builder.Append(Config.CombatSkillType.Instance[combatSkillType2].Name);
				}
				else
				{
					CS$<>8__locals1.builder.Append("无");
				}
				CS$<>8__locals1.builder.Append('\t');
				CharacterDomain.<Test_LogMaxConsummateLevel>g__AppendGradesOnPanel|942_0(attainmentPanels, combatSkillType2, ref CS$<>8__locals1);
				CS$<>8__locals1.builder.Append('\t');
				sbyte combatSkillType3 = -1;
				sbyte maxConsummateLevel3 = CharacterDomain.Test_CalcMaxConsummateLevel3(attainmentPanels, ref combatSkillType3);
				CS$<>8__locals1.builder.Append(maxConsummateLevel3);
				CS$<>8__locals1.builder.Append('\t');
				bool flag3 = combatSkillType3 >= 0;
				if (flag3)
				{
					CS$<>8__locals1.builder.Append(Config.CombatSkillType.Instance[combatSkillType3].Name);
				}
				else
				{
					CS$<>8__locals1.builder.Append("无");
				}
				CS$<>8__locals1.builder.Append('\t');
				CharacterDomain.<Test_LogMaxConsummateLevel>g__AppendGradesOnPanel|942_0(attainmentPanels, combatSkillType3, ref CS$<>8__locals1);
				CS$<>8__locals1.builder.AppendLine();
			}
			File.WriteAllText(Path.Combine(Program.BaseDataDir, "Logs", "MaxConsummateLevel.txt"), CS$<>8__locals1.builder.ToString());
		}

		// Token: 0x06007366 RID: 29542 RVA: 0x004305B4 File Offset: 0x0042E7B4
		private static sbyte Test_CalcMaxConsummateLevel1(short[] combatSkillAttainmentPanels, ref sbyte combatSkillType)
		{
			int maxConsummateLevel = -1;
			for (sbyte skillType = 0; skillType < 14; skillType += 1)
			{
				int maxConsecutiveGrade = -1;
				int totalCount = 0;
				for (sbyte grade = 0; grade <= 8; grade += 1)
				{
					int offset = (int)(9 * skillType + grade);
					short skillTemplateId = combatSkillAttainmentPanels[offset];
					bool flag = skillTemplateId < 0;
					if (!flag)
					{
						bool flag2 = grade != 0;
						if (flag2)
						{
							totalCount++;
						}
						bool flag3 = maxConsecutiveGrade + 1 == (int)grade;
						if (flag3)
						{
							maxConsecutiveGrade = (int)grade;
						}
					}
				}
				bool flag4 = maxConsecutiveGrade > 0;
				if (flag4)
				{
					totalCount += maxConsecutiveGrade;
				}
				bool flag5 = maxConsummateLevel < totalCount;
				if (flag5)
				{
					maxConsummateLevel = totalCount;
					combatSkillType = skillType;
				}
			}
			return (sbyte)Math.Clamp(maxConsummateLevel, 0, (int)GlobalConfig.Instance.MaxConsummateLevel);
		}

		// Token: 0x06007367 RID: 29543 RVA: 0x00430674 File Offset: 0x0042E874
		private unsafe static sbyte Test_CalcMaxConsummateLevel2(short[] combatSkillAttainmentPanels, ref sbyte combatSkillType)
		{
			IntPtr intPtr = stackalloc byte[(UIntPtr)18];
			*intPtr = 10;
			*(intPtr + 2) = 10;
			*(intPtr + (IntPtr)2 * 2) = 10;
			*(intPtr + (IntPtr)3 * 2) = 10;
			*(intPtr + (IntPtr)4 * 2) = 15;
			*(intPtr + (IntPtr)5 * 2) = 15;
			*(intPtr + (IntPtr)6 * 2) = 20;
			*(intPtr + (IntPtr)7 * 2) = 30;
			*(intPtr + (IntPtr)8 * 2) = 40;
			short* gradePoints = intPtr;
			int maxConsummateLevel = -1;
			for (sbyte skillType = 0; skillType < 14; skillType += 1)
			{
				int totalPoints = 0;
				for (sbyte grade = 0; grade <= 8; grade += 1)
				{
					int offset = (int)(9 * skillType + grade);
					short skillTemplateId = combatSkillAttainmentPanels[offset];
					bool flag = skillTemplateId < 0;
					if (!flag)
					{
						totalPoints += (int)gradePoints[grade];
					}
				}
				int currValue = totalPoints / 10;
				bool flag2 = maxConsummateLevel < currValue;
				if (flag2)
				{
					maxConsummateLevel = currValue;
					combatSkillType = skillType;
				}
			}
			return (sbyte)Math.Clamp(maxConsummateLevel, 0, (int)GlobalConfig.Instance.MaxConsummateLevel);
		}

		// Token: 0x06007368 RID: 29544 RVA: 0x00430760 File Offset: 0x0042E960
		private unsafe static sbyte Test_CalcMaxConsummateLevel3(short[] combatSkillAttainmentPanels, ref sbyte combatSkillType)
		{
			IntPtr intPtr = stackalloc byte[(UIntPtr)18];
			*intPtr = 5;
			*(intPtr + 2) = 10;
			*(intPtr + (IntPtr)2 * 2) = 15;
			*(intPtr + (IntPtr)3 * 2) = 20;
			*(intPtr + (IntPtr)4 * 2) = 25;
			*(intPtr + (IntPtr)5 * 2) = 30;
			*(intPtr + (IntPtr)6 * 2) = 35;
			*(intPtr + (IntPtr)7 * 2) = 45;
			*(intPtr + (IntPtr)8 * 2) = 55;
			short* gradePoints = intPtr;
			int maxConsummateLevel = -1;
			for (sbyte skillType = 0; skillType < 14; skillType += 1)
			{
				int totalCount = 0;
				int lowPoint = 0;
				int middlePoint = 0;
				int highPoint = 0;
				for (sbyte grade = 0; grade <= 8; grade += 1)
				{
					int offset = (int)(9 * skillType + grade);
					short skillTemplateId = combatSkillAttainmentPanels[offset];
					bool flag = skillTemplateId < 0;
					if (!flag)
					{
						bool flag2 = grade != 0;
						if (flag2)
						{
							totalCount++;
						}
						short point = gradePoints[grade];
						switch (Grade.GetGroup(grade))
						{
						case 0:
							lowPoint = Math.Max((int)point, lowPoint);
							break;
						case 1:
							middlePoint = Math.Max((int)point, middlePoint);
							break;
						case 2:
							highPoint = Math.Max((int)point, highPoint);
							break;
						}
					}
				}
				totalCount += (lowPoint + middlePoint + highPoint) / 10;
				bool flag3 = maxConsummateLevel < totalCount;
				if (flag3)
				{
					maxConsummateLevel = totalCount;
					combatSkillType = skillType;
				}
			}
			return (sbyte)Math.Clamp(maxConsummateLevel, 0, (int)GlobalConfig.Instance.MaxConsummateLevel);
		}

		// Token: 0x06007369 RID: 29545 RVA: 0x004308BC File Offset: 0x0042EABC
		public CharacterDomain() : base(30)
		{
			this._objects = new Dictionary<int, Character>(8192);
			this._nextObjectId = 0;
			this._deadCharacters = new Dictionary<int, DeadCharacter>(65536);
			this._deadCharDeletionStates = new Dictionary<int, DeadCharDeletionState>(0);
			this._recentDeadCharacters = new SortedSetAsDictionary<IntPair>();
			this._waitingReincarnationChars = new SortedSetAsDictionary<IntPair>();
			this._graves = new Dictionary<int, Grave>(16384);
			this._pregnantStates = new Dictionary<int, PregnantState>(0);
			this._pregnancyLockEndDates = new Dictionary<int, int>(0);
			this._unguardedChars = default(CharacterSet);
			this._kidnappedChars = new Dictionary<int, KidnappedCharacterList>(0);
			this._relations = new Dictionary<RelationKey, RelatedCharacter>(0);
			this._actualBloodParents = new Dictionary<ParentAndChild, int>(0);
			this._characterGroups = new Dictionary<int, CharacterSet>(0);
			this._joinGroupDates = new Dictionary<int, int>(0);
			this._debtsToTaiwu = new Dictionary<int, Debts>(0);
			this._soldLibrarySkillBooks = new Dictionary<int, GameData.Utilities.ShortList>(0);
			this._usedCombatResourceObsoletes = new Dictionary<int, CombatResourcesObsolete>(0);
			this._avatarElementGrowthProgress = new Dictionary<int, AvatarElementsGrownDates>(0);
			this._targetedForAssassination = string.Empty;
			this._prioritizedActions = new Dictionary<int, PrioritizedActionWrapper>(0);
			this._crossAreaMoveInfos = new Dictionary<int, CrossAreaMoveInfo>(0);
			this._ongoingVengeances = new Dictionary<int, CharacterSet>(0);
			this._mournedOthersChars = default(CharacterSet);
			this._pregeneratedCityTownGuards = new int[288];
			this._pregeneratedRandomEnemies = new List<int>();
			this._forceRebelLocation = default(Location);
			this._forceKindLocation = default(Location);
			this._avoidDeathCharId = 0;
			this._subscriberOrders = new Dictionary<int, CharacterList>(0);
			this.HelperDataObjects = new ObjectCollectionHelperData(4, 0, CharacterDomain.CacheInfluencesObjects, this._dataStatesObjects, true);
			this.HelperDataGraves = new ObjectCollectionHelperData(4, 6, CharacterDomain.CacheInfluencesGraves, this._dataStatesGraves, true);
			this.OnInitializedDomainData();
		}

		// Token: 0x0600736A RID: 29546 RVA: 0x00430B90 File Offset: 0x0042ED90
		public Character GetElement_Objects(int objectId)
		{
			return this._objects[objectId];
		}

		// Token: 0x0600736B RID: 29547 RVA: 0x00430BB0 File Offset: 0x0042EDB0
		public bool TryGetElement_Objects(int objectId, out Character element)
		{
			return this._objects.TryGetValue(objectId, out element);
		}

		// Token: 0x0600736C RID: 29548 RVA: 0x00430BD0 File Offset: 0x0042EDD0
		private unsafe void AddElement_Objects(int objectId, Character instance)
		{
			instance.CollectionHelperData = this.HelperDataObjects;
			instance.DataStatesOffset = this._dataStatesObjects.Create();
			this._objects.Add(objectId, instance);
			byte* pData = OperationAdder.DynamicObjectCollection_Add<int>(4, 0, objectId, instance.GetSerializedSize());
			instance.Serialize(pData);
		}

		// Token: 0x0600736D RID: 29549 RVA: 0x00430C20 File Offset: 0x0042EE20
		private void RemoveElement_Objects(int objectId)
		{
			Character instance;
			bool flag = !this._objects.TryGetValue(objectId, out instance);
			if (!flag)
			{
				this._dataStatesObjects.Remove(instance.DataStatesOffset);
				this._objects.Remove(objectId);
				OperationAdder.DynamicObjectCollection_Remove<int>(4, 0, objectId);
			}
		}

		// Token: 0x0600736E RID: 29550 RVA: 0x00430C6D File Offset: 0x0042EE6D
		private void ClearObjects()
		{
			this._dataStatesObjects.Clear();
			this._objects.Clear();
			OperationAdder.DynamicObjectCollection_Clear(4, 0);
		}

		// Token: 0x0600736F RID: 29551 RVA: 0x00430C90 File Offset: 0x0042EE90
		public unsafe int GetElementField_Objects(int objectId, ushort fieldId, RawDataPool dataPool, bool resetModified)
		{
			Character instance;
			bool flag = !this._objects.TryGetValue(objectId, out instance);
			int result;
			if (flag)
			{
				string tag = "GetElementField_Objects";
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find element ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(objectId);
				defaultInterpolatedStringHandler.AppendLiteral(" with field ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				AdaptableLog.TagWarning(tag, defaultInterpolatedStringHandler.ToStringAndClear(), false);
				result = -1;
			}
			else
			{
				if (resetModified)
				{
					this._dataStatesObjects.ResetModified(instance.DataStatesOffset, (int)fieldId);
				}
				switch (fieldId)
				{
				case 0:
					result = Serializer.Serialize(instance.GetId(), dataPool);
					break;
				case 1:
					result = Serializer.Serialize(instance.GetTemplateId(), dataPool);
					break;
				case 2:
					result = Serializer.Serialize(instance.GetCreatingType(), dataPool);
					break;
				case 3:
					result = Serializer.Serialize(instance.GetGender(), dataPool);
					break;
				case 4:
					result = Serializer.Serialize(instance.GetActualAge(), dataPool);
					break;
				case 5:
					result = Serializer.Serialize(instance.GetBirthMonth(), dataPool);
					break;
				case 6:
					result = Serializer.Serialize(instance.GetHappiness(), dataPool);
					break;
				case 7:
					result = Serializer.Serialize(instance.GetBaseMorality(), dataPool);
					break;
				case 8:
					result = Serializer.Serialize(instance.GetOrganizationInfo(), dataPool);
					break;
				case 9:
					result = Serializer.Serialize(instance.GetIdealSect(), dataPool);
					break;
				case 10:
					result = Serializer.Serialize(instance.GetLifeSkillTypeInterest(), dataPool);
					break;
				case 11:
					result = Serializer.Serialize(instance.GetCombatSkillTypeInterest(), dataPool);
					break;
				case 12:
					result = Serializer.Serialize(instance.GetMainAttributeInterest(), dataPool);
					break;
				case 13:
					result = Serializer.Serialize(instance.GetTransgender(), dataPool);
					break;
				case 14:
					result = Serializer.Serialize(instance.GetBisexual(), dataPool);
					break;
				case 15:
					result = Serializer.Serialize(instance.GetXiangshuType(), dataPool);
					break;
				case 16:
					result = Serializer.Serialize(instance.GetMonkType(), dataPool);
					break;
				case 17:
					result = Serializer.Serialize(instance.GetFeatureIds(), dataPool);
					break;
				case 18:
					result = Serializer.Serialize(instance.GetBaseMainAttributes(), dataPool);
					break;
				case 19:
					result = Serializer.Serialize(instance.GetHealth(), dataPool);
					break;
				case 20:
					result = Serializer.Serialize(instance.GetBaseMaxHealth(), dataPool);
					break;
				case 21:
					result = Serializer.Serialize(instance.GetDisorderOfQi(), dataPool);
					break;
				case 22:
					result = Serializer.Serialize(instance.GetHaveLeftArm(), dataPool);
					break;
				case 23:
					result = Serializer.Serialize(instance.GetHaveRightArm(), dataPool);
					break;
				case 24:
					result = Serializer.Serialize(instance.GetHaveLeftLeg(), dataPool);
					break;
				case 25:
					result = Serializer.Serialize(instance.GetHaveRightLeg(), dataPool);
					break;
				case 26:
					result = Serializer.Serialize(instance.GetInjuries(), dataPool);
					break;
				case 27:
					result = Serializer.Serialize(instance.GetExtraNeili(), dataPool);
					break;
				case 28:
					result = Serializer.Serialize(instance.GetConsummateLevel(), dataPool);
					break;
				case 29:
					result = Serializer.Serialize(instance.GetLearnedLifeSkills(), dataPool);
					break;
				case 30:
					result = Serializer.Serialize(*instance.GetBaseLifeSkillQualifications(), dataPool);
					break;
				case 31:
					result = Serializer.Serialize(instance.GetLifeSkillQualificationGrowthType(), dataPool);
					break;
				case 32:
					result = Serializer.Serialize(*instance.GetBaseCombatSkillQualifications(), dataPool);
					break;
				case 33:
					result = Serializer.Serialize(instance.GetCombatSkillQualificationGrowthType(), dataPool);
					break;
				case 34:
					result = Serializer.Serialize(*instance.GetResources(), dataPool);
					break;
				case 35:
					result = Serializer.Serialize(instance.GetLovingItemSubType(), dataPool);
					break;
				case 36:
					result = Serializer.Serialize(instance.GetHatingItemSubType(), dataPool);
					break;
				case 37:
					result = Serializer.Serialize(instance.GetFullName(), dataPool);
					break;
				case 38:
					result = Serializer.Serialize(instance.GetMonasticTitle(), dataPool);
					break;
				case 39:
					result = Serializer.Serialize(instance.GetAvatar(), dataPool);
					break;
				case 40:
					result = Serializer.Serialize(instance.GetPotentialFeatureIds(), dataPool);
					break;
				case 41:
					result = Serializer.Serialize(instance.GetFameActionRecords(), dataPool);
					break;
				case 42:
					result = Serializer.Serialize(*instance.GetGenome(), dataPool);
					break;
				case 43:
					result = Serializer.Serialize(instance.GetCurrMainAttributes(), dataPool);
					break;
				case 44:
					result = Serializer.Serialize(*instance.GetPoisoned(), dataPool);
					break;
				case 45:
					result = Serializer.Serialize(instance.GetInjuriesRecoveryProgress(), dataPool);
					break;
				case 46:
					result = Serializer.Serialize(instance.GetCurrNeili(), dataPool);
					break;
				case 47:
					result = Serializer.Serialize(instance.GetLoopingNeigong(), dataPool);
					break;
				case 48:
					result = Serializer.Serialize(instance.GetBaseNeiliAllocation(), dataPool);
					break;
				case 49:
					result = Serializer.Serialize(instance.GetExtraNeiliAllocation(), dataPool);
					break;
				case 50:
					result = Serializer.Serialize(instance.GetBaseNeiliProportionOfFiveElements(), dataPool);
					break;
				case 51:
					result = Serializer.Serialize(instance.GetHobbyExpirationDate(), dataPool);
					break;
				case 52:
					result = Serializer.Serialize(instance.GetLovingItemRevealed(), dataPool);
					break;
				case 53:
					result = Serializer.Serialize(instance.GetHatingItemRevealed(), dataPool);
					break;
				case 54:
					result = Serializer.Serialize(instance.GetLegitimateBoysCount(), dataPool);
					break;
				case 55:
					result = Serializer.Serialize(instance.GetBirthLocation(), dataPool);
					break;
				case 56:
					result = Serializer.Serialize(instance.GetLocation(), dataPool);
					break;
				case 57:
					result = Serializer.Serialize(instance.GetEquipment(), dataPool);
					break;
				case 58:
					result = Serializer.Serialize(instance.GetInventory(), dataPool);
					break;
				case 59:
					result = Serializer.Serialize(*instance.GetEatingItems(), dataPool);
					break;
				case 60:
					result = Serializer.Serialize(instance.GetLearnedCombatSkills(), dataPool);
					break;
				case 61:
					result = Serializer.Serialize(instance.GetEquippedCombatSkills(), dataPool);
					break;
				case 62:
					result = Serializer.Serialize(instance.GetCombatSkillAttainmentPanels(), dataPool);
					break;
				case 63:
					result = Serializer.Serialize(instance.GetSkillQualificationBonuses(), dataPool);
					break;
				case 64:
					result = Serializer.Serialize(*instance.GetPreexistenceCharIds(), dataPool);
					break;
				case 65:
					result = Serializer.Serialize(instance.GetXiangshuInfection(), dataPool);
					break;
				case 66:
					result = Serializer.Serialize(instance.GetCurrAge(), dataPool);
					break;
				case 67:
					result = Serializer.Serialize(instance.GetExp(), dataPool);
					break;
				case 68:
					result = Serializer.Serialize(instance.GetExternalRelationState(), dataPool);
					break;
				case 69:
					result = Serializer.Serialize(instance.GetKidnapperId(), dataPool);
					break;
				case 70:
					result = Serializer.Serialize(instance.GetLeaderId(), dataPool);
					break;
				case 71:
					result = Serializer.Serialize(instance.GetFactionId(), dataPool);
					break;
				case 72:
					result = Serializer.Serialize(instance.GetPersonalNeeds(), dataPool);
					break;
				case 73:
					result = Serializer.Serialize(instance.GetActionEnergies(), dataPool);
					break;
				case 74:
					result = Serializer.Serialize(instance.GetNpcTravelTargets(), dataPool);
					break;
				case 75:
					result = Serializer.Serialize(instance.GetPrioritizedActionCooldowns(), dataPool);
					break;
				case 76:
					result = Serializer.Serialize(instance.GetPhysiologicalAge(), dataPool);
					break;
				case 77:
					result = Serializer.Serialize(instance.GetFame(), dataPool);
					break;
				case 78:
					result = Serializer.Serialize(instance.GetMorality(), dataPool);
					break;
				case 79:
					result = Serializer.Serialize(instance.GetAttraction(), dataPool);
					break;
				case 80:
					result = Serializer.Serialize(instance.GetMaxMainAttributes(), dataPool);
					break;
				case 81:
					result = Serializer.Serialize(instance.GetHitValues(), dataPool);
					break;
				case 82:
					result = Serializer.Serialize(instance.GetPenetrations(), dataPool);
					break;
				case 83:
					result = Serializer.Serialize(instance.GetAvoidValues(), dataPool);
					break;
				case 84:
					result = Serializer.Serialize(instance.GetPenetrationResists(), dataPool);
					break;
				case 85:
					result = Serializer.Serialize(instance.GetRecoveryOfStanceAndBreath(), dataPool);
					break;
				case 86:
					result = Serializer.Serialize(instance.GetMoveSpeed(), dataPool);
					break;
				case 87:
					result = Serializer.Serialize(instance.GetRecoveryOfFlaw(), dataPool);
					break;
				case 88:
					result = Serializer.Serialize(instance.GetCastSpeed(), dataPool);
					break;
				case 89:
					result = Serializer.Serialize(instance.GetRecoveryOfBlockedAcupoint(), dataPool);
					break;
				case 90:
					result = Serializer.Serialize(instance.GetWeaponSwitchSpeed(), dataPool);
					break;
				case 91:
					result = Serializer.Serialize(instance.GetAttackSpeed(), dataPool);
					break;
				case 92:
					result = Serializer.Serialize(instance.GetInnerRatio(), dataPool);
					break;
				case 93:
					result = Serializer.Serialize(instance.GetRecoveryOfQiDisorder(), dataPool);
					break;
				case 94:
					result = Serializer.Serialize(*instance.GetPoisonResists(), dataPool);
					break;
				case 95:
					result = Serializer.Serialize(instance.GetMaxHealth(), dataPool);
					break;
				case 96:
					result = Serializer.Serialize(instance.GetFertility(), dataPool);
					break;
				case 97:
					result = Serializer.Serialize(*instance.GetLifeSkillQualifications(), dataPool);
					break;
				case 98:
					result = Serializer.Serialize(*instance.GetLifeSkillAttainments(), dataPool);
					break;
				case 99:
					result = Serializer.Serialize(*instance.GetCombatSkillQualifications(), dataPool);
					break;
				case 100:
					result = Serializer.Serialize(*instance.GetCombatSkillAttainments(), dataPool);
					break;
				case 101:
					result = Serializer.Serialize(instance.GetPersonalities(), dataPool);
					break;
				case 102:
					result = Serializer.Serialize(instance.GetHobbyChangingPeriod(), dataPool);
					break;
				case 103:
					result = Serializer.Serialize(instance.GetFavorabilityChangingFactor(), dataPool);
					break;
				case 104:
					result = Serializer.Serialize(instance.GetMaxInventoryLoad(), dataPool);
					break;
				case 105:
					result = Serializer.Serialize(instance.GetCurrInventoryLoad(), dataPool);
					break;
				case 106:
					result = Serializer.Serialize(instance.GetMaxEquipmentLoad(), dataPool);
					break;
				case 107:
					result = Serializer.Serialize(instance.GetCurrEquipmentLoad(), dataPool);
					break;
				case 108:
					result = Serializer.Serialize(instance.GetInventoryTotalValue(), dataPool);
					break;
				case 109:
					result = Serializer.Serialize(instance.GetMaxNeili(), dataPool);
					break;
				case 110:
					result = Serializer.Serialize(instance.GetNeiliAllocation(), dataPool);
					break;
				case 111:
					result = Serializer.Serialize(instance.GetNeiliProportionOfFiveElements(), dataPool);
					break;
				case 112:
					result = Serializer.Serialize(instance.GetNeiliType(), dataPool);
					break;
				case 113:
					result = Serializer.Serialize(instance.GetCombatPower(), dataPool);
					break;
				case 114:
					result = Serializer.Serialize(instance.GetAttackTendencyOfInnerAndOuter(), dataPool);
					break;
				case 115:
					result = Serializer.Serialize(instance.GetAllocatedNeiliEffects(), dataPool);
					break;
				case 116:
					result = Serializer.Serialize(instance.GetMaxConsummateLevel(), dataPool);
					break;
				case 117:
					result = Serializer.Serialize(instance.GetCombatSkillEquipment(), dataPool);
					break;
				case 118:
					result = Serializer.Serialize(instance.GetDarkAshProtector(), dataPool);
					break;
				default:
				{
					bool flag2 = fieldId >= 195;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler;
					if (flag2)
					{
						defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(20, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Unsupported fieldId ");
						defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Not allow to get readonly field data: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				}
			}
			return result;
		}

		// Token: 0x06007370 RID: 29552 RVA: 0x00431810 File Offset: 0x0042FA10
		public void SetElementField_Objects(int objectId, ushort fieldId, int valueOffset, RawDataPool dataPool, DataContext context)
		{
			Character instance;
			bool flag = !this._objects.TryGetValue(objectId, out instance);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find element ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(objectId);
				defaultInterpolatedStringHandler.AppendLiteral(" with field ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			switch (fieldId)
			{
			case 0:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 1:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 2:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 3:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 4:
			{
				short value = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value);
				instance.SetActualAge(value, context);
				break;
			}
			case 5:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 6:
			{
				sbyte value2 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value2);
				instance.SetHappiness(value2, context);
				break;
			}
			case 7:
			{
				short value3 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value3);
				instance.SetBaseMorality(value3, context);
				break;
			}
			case 8:
			{
				OrganizationInfo value4 = default(OrganizationInfo);
				Serializer.Deserialize(dataPool, valueOffset, ref value4);
				instance.SetOrganizationInfo(value4, context);
				break;
			}
			case 9:
			{
				sbyte value5 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value5);
				instance.SetIdealSect(value5, context);
				break;
			}
			case 10:
			{
				sbyte value6 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value6);
				instance.SetLifeSkillTypeInterest(value6, context);
				break;
			}
			case 11:
			{
				sbyte value7 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value7);
				instance.SetCombatSkillTypeInterest(value7, context);
				break;
			}
			case 12:
			{
				sbyte value8 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value8);
				instance.SetMainAttributeInterest(value8, context);
				break;
			}
			case 13:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 14:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 15:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 16:
			{
				byte value9 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value9);
				instance.SetMonkType(value9, context);
				break;
			}
			case 17:
			{
				List<short> value10 = instance.GetFeatureIds();
				Serializer.Deserialize(dataPool, valueOffset, ref value10);
				instance.SetFeatureIds(value10, context);
				break;
			}
			case 18:
			{
				MainAttributes value11 = default(MainAttributes);
				Serializer.Deserialize(dataPool, valueOffset, ref value11);
				instance.SetBaseMainAttributes(value11, context);
				break;
			}
			case 19:
			{
				short value12 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value12);
				instance.SetHealth(value12, context);
				break;
			}
			case 20:
			{
				short value13 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value13);
				instance.SetBaseMaxHealth(value13, context);
				break;
			}
			case 21:
			{
				short value14 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value14);
				instance.SetDisorderOfQi(value14, context);
				break;
			}
			case 22:
			{
				bool value15 = false;
				Serializer.Deserialize(dataPool, valueOffset, ref value15);
				instance.SetHaveLeftArm(value15, context);
				break;
			}
			case 23:
			{
				bool value16 = false;
				Serializer.Deserialize(dataPool, valueOffset, ref value16);
				instance.SetHaveRightArm(value16, context);
				break;
			}
			case 24:
			{
				bool value17 = false;
				Serializer.Deserialize(dataPool, valueOffset, ref value17);
				instance.SetHaveLeftLeg(value17, context);
				break;
			}
			case 25:
			{
				bool value18 = false;
				Serializer.Deserialize(dataPool, valueOffset, ref value18);
				instance.SetHaveRightLeg(value18, context);
				break;
			}
			case 26:
			{
				Injuries value19 = default(Injuries);
				Serializer.Deserialize(dataPool, valueOffset, ref value19);
				instance.SetInjuries(value19, context);
				break;
			}
			case 27:
			{
				int value20 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value20);
				instance.SetExtraNeili(value20, context);
				break;
			}
			case 28:
			{
				sbyte value21 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value21);
				instance.SetConsummateLevel(value21, context);
				break;
			}
			case 29:
			{
				List<LifeSkillItem> value22 = instance.GetLearnedLifeSkills();
				Serializer.Deserialize(dataPool, valueOffset, ref value22);
				instance.SetLearnedLifeSkills(value22, context);
				break;
			}
			case 30:
			{
				LifeSkillShorts value23 = default(LifeSkillShorts);
				Serializer.Deserialize(dataPool, valueOffset, ref value23);
				instance.SetBaseLifeSkillQualifications(ref value23, context);
				break;
			}
			case 31:
			{
				sbyte value24 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value24);
				instance.SetLifeSkillQualificationGrowthType(value24, context);
				break;
			}
			case 32:
			{
				CombatSkillShorts value25 = default(CombatSkillShorts);
				Serializer.Deserialize(dataPool, valueOffset, ref value25);
				instance.SetBaseCombatSkillQualifications(ref value25, context);
				break;
			}
			case 33:
			{
				sbyte value26 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value26);
				instance.SetCombatSkillQualificationGrowthType(value26, context);
				break;
			}
			case 34:
			{
				ResourceInts value27 = default(ResourceInts);
				Serializer.Deserialize(dataPool, valueOffset, ref value27);
				instance.SetResources(ref value27, context);
				break;
			}
			case 35:
			{
				short value28 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value28);
				instance.SetLovingItemSubType(value28, context);
				break;
			}
			case 36:
			{
				short value29 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value29);
				instance.SetHatingItemSubType(value29, context);
				break;
			}
			case 37:
			{
				FullName value30 = default(FullName);
				Serializer.Deserialize(dataPool, valueOffset, ref value30);
				instance.SetFullName(value30, context);
				break;
			}
			case 38:
			{
				MonasticTitle value31 = default(MonasticTitle);
				Serializer.Deserialize(dataPool, valueOffset, ref value31);
				instance.SetMonasticTitle(value31, context);
				break;
			}
			case 39:
			{
				AvatarData value32 = instance.GetAvatar();
				Serializer.Deserialize(dataPool, valueOffset, ref value32);
				instance.SetAvatar(value32, context);
				break;
			}
			case 40:
			{
				List<short> value33 = instance.GetPotentialFeatureIds();
				Serializer.Deserialize(dataPool, valueOffset, ref value33);
				instance.SetPotentialFeatureIds(value33, context);
				break;
			}
			case 41:
			{
				List<FameActionRecord> value34 = instance.GetFameActionRecords();
				Serializer.Deserialize(dataPool, valueOffset, ref value34);
				instance.SetFameActionRecords(value34, context);
				break;
			}
			case 42:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 43:
			{
				MainAttributes value35 = default(MainAttributes);
				Serializer.Deserialize(dataPool, valueOffset, ref value35);
				instance.SetCurrMainAttributes(value35, context);
				break;
			}
			case 44:
			{
				PoisonInts value36 = default(PoisonInts);
				Serializer.Deserialize(dataPool, valueOffset, ref value36);
				instance.SetPoisoned(ref value36, context);
				break;
			}
			case 45:
			{
				byte[] value37 = instance.GetInjuriesRecoveryProgress();
				Serializer.Deserialize(dataPool, valueOffset, ref value37);
				instance.SetInjuriesRecoveryProgress(value37, context);
				break;
			}
			case 46:
			{
				int value38 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value38);
				instance.SetCurrNeili(value38, context);
				break;
			}
			case 47:
			{
				short value39 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value39);
				instance.SetLoopingNeigong(value39, context);
				break;
			}
			case 48:
			{
				NeiliAllocation value40 = default(NeiliAllocation);
				Serializer.Deserialize(dataPool, valueOffset, ref value40);
				instance.SetBaseNeiliAllocation(value40, context);
				break;
			}
			case 49:
			{
				NeiliAllocation value41 = default(NeiliAllocation);
				Serializer.Deserialize(dataPool, valueOffset, ref value41);
				instance.SetExtraNeiliAllocation(value41, context);
				break;
			}
			case 50:
			{
				NeiliProportionOfFiveElements value42 = default(NeiliProportionOfFiveElements);
				Serializer.Deserialize(dataPool, valueOffset, ref value42);
				instance.SetBaseNeiliProportionOfFiveElements(value42, context);
				break;
			}
			case 51:
			{
				int value43 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value43);
				instance.SetHobbyExpirationDate(value43, context);
				break;
			}
			case 52:
			{
				bool value44 = false;
				Serializer.Deserialize(dataPool, valueOffset, ref value44);
				instance.SetLovingItemRevealed(value44, context);
				break;
			}
			case 53:
			{
				bool value45 = false;
				Serializer.Deserialize(dataPool, valueOffset, ref value45);
				instance.SetHatingItemRevealed(value45, context);
				break;
			}
			case 54:
			{
				sbyte value46 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value46);
				instance.SetLegitimateBoysCount(value46, context);
				break;
			}
			case 55:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 56:
			{
				Location value47 = default(Location);
				Serializer.Deserialize(dataPool, valueOffset, ref value47);
				instance.SetLocation(value47, context);
				break;
			}
			case 57:
			{
				ItemKey[] value48 = instance.GetEquipment();
				Serializer.Deserialize(dataPool, valueOffset, ref value48);
				instance.SetEquipment(value48, context);
				break;
			}
			case 58:
			{
				Inventory value49 = instance.GetInventory();
				Serializer.Deserialize(dataPool, valueOffset, ref value49);
				instance.SetInventory(value49, context);
				break;
			}
			case 59:
			{
				EatingItems value50 = default(EatingItems);
				Serializer.Deserialize(dataPool, valueOffset, ref value50);
				instance.SetEatingItems(ref value50, context);
				break;
			}
			case 60:
			{
				List<short> value51 = instance.GetLearnedCombatSkills();
				Serializer.Deserialize(dataPool, valueOffset, ref value51);
				instance.SetLearnedCombatSkills(value51, context);
				break;
			}
			case 61:
			{
				short[] value52 = instance.GetEquippedCombatSkills();
				Serializer.Deserialize(dataPool, valueOffset, ref value52);
				instance.SetEquippedCombatSkills(value52, context);
				break;
			}
			case 62:
			{
				short[] value53 = instance.GetCombatSkillAttainmentPanels();
				Serializer.Deserialize(dataPool, valueOffset, ref value53);
				instance.SetCombatSkillAttainmentPanels(value53, context);
				break;
			}
			case 63:
			{
				List<SkillQualificationBonus> value54 = instance.GetSkillQualificationBonuses();
				Serializer.Deserialize(dataPool, valueOffset, ref value54);
				instance.SetSkillQualificationBonuses(value54, context);
				break;
			}
			case 64:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 65:
			{
				byte value55 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value55);
				instance.SetXiangshuInfection(value55, context);
				break;
			}
			case 66:
			{
				short value56 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value56);
				instance.SetCurrAge(value56, context);
				break;
			}
			case 67:
			{
				int value57 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value57);
				instance.SetExp(value57, context);
				break;
			}
			case 68:
			{
				byte value58 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value58);
				instance.SetExternalRelationState(value58, context);
				break;
			}
			case 69:
			{
				int value59 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value59);
				instance.SetKidnapperId(value59, context);
				break;
			}
			case 70:
			{
				int value60 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value60);
				instance.SetLeaderId(value60, context);
				break;
			}
			case 71:
			{
				int value61 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value61);
				instance.SetFactionId(value61, context);
				break;
			}
			case 72:
			{
				List<GameData.Domains.Character.Ai.PersonalNeed> value62 = instance.GetPersonalNeeds();
				Serializer.Deserialize(dataPool, valueOffset, ref value62);
				instance.SetPersonalNeeds(value62, context);
				break;
			}
			case 73:
			{
				ActionEnergySbytes value63 = default(ActionEnergySbytes);
				Serializer.Deserialize(dataPool, valueOffset, ref value63);
				instance.SetActionEnergies(value63, context);
				break;
			}
			case 74:
			{
				List<NpcTravelTarget> value64 = instance.GetNpcTravelTargets();
				Serializer.Deserialize(dataPool, valueOffset, ref value64);
				instance.SetNpcTravelTargets(value64, context);
				break;
			}
			case 75:
			{
				PrioritizedActionCooldownSbytes value65 = default(PrioritizedActionCooldownSbytes);
				Serializer.Deserialize(dataPool, valueOffset, ref value65);
				instance.SetPrioritizedActionCooldowns(value65, context);
				break;
			}
			default:
			{
				bool flag2 = fieldId >= 195;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler;
				if (flag2)
				{
					defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(20, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported fieldId ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				bool flag3 = fieldId >= 119;
				if (flag3)
				{
					defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set cache field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
		}

		// Token: 0x06007371 RID: 29553 RVA: 0x004324C8 File Offset: 0x004306C8
		private unsafe int CheckModified_Objects(int objectId, ushort fieldId, RawDataPool dataPool)
		{
			Character instance;
			bool flag = !this._objects.TryGetValue(objectId, out instance);
			int result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				bool flag2 = fieldId >= 119;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(40, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Not allow to check readonly field data: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				bool flag3 = !this._dataStatesObjects.IsModified(instance.DataStatesOffset, (int)fieldId);
				if (flag3)
				{
					result = -1;
				}
				else
				{
					this._dataStatesObjects.ResetModified(instance.DataStatesOffset, (int)fieldId);
					switch (fieldId)
					{
					case 0:
						result = Serializer.Serialize(instance.GetId(), dataPool);
						break;
					case 1:
						result = Serializer.Serialize(instance.GetTemplateId(), dataPool);
						break;
					case 2:
						result = Serializer.Serialize(instance.GetCreatingType(), dataPool);
						break;
					case 3:
						result = Serializer.Serialize(instance.GetGender(), dataPool);
						break;
					case 4:
						result = Serializer.Serialize(instance.GetActualAge(), dataPool);
						break;
					case 5:
						result = Serializer.Serialize(instance.GetBirthMonth(), dataPool);
						break;
					case 6:
						result = Serializer.Serialize(instance.GetHappiness(), dataPool);
						break;
					case 7:
						result = Serializer.Serialize(instance.GetBaseMorality(), dataPool);
						break;
					case 8:
						result = Serializer.Serialize(instance.GetOrganizationInfo(), dataPool);
						break;
					case 9:
						result = Serializer.Serialize(instance.GetIdealSect(), dataPool);
						break;
					case 10:
						result = Serializer.Serialize(instance.GetLifeSkillTypeInterest(), dataPool);
						break;
					case 11:
						result = Serializer.Serialize(instance.GetCombatSkillTypeInterest(), dataPool);
						break;
					case 12:
						result = Serializer.Serialize(instance.GetMainAttributeInterest(), dataPool);
						break;
					case 13:
						result = Serializer.Serialize(instance.GetTransgender(), dataPool);
						break;
					case 14:
						result = Serializer.Serialize(instance.GetBisexual(), dataPool);
						break;
					case 15:
						result = Serializer.Serialize(instance.GetXiangshuType(), dataPool);
						break;
					case 16:
						result = Serializer.Serialize(instance.GetMonkType(), dataPool);
						break;
					case 17:
						result = Serializer.Serialize(instance.GetFeatureIds(), dataPool);
						break;
					case 18:
						result = Serializer.Serialize(instance.GetBaseMainAttributes(), dataPool);
						break;
					case 19:
						result = Serializer.Serialize(instance.GetHealth(), dataPool);
						break;
					case 20:
						result = Serializer.Serialize(instance.GetBaseMaxHealth(), dataPool);
						break;
					case 21:
						result = Serializer.Serialize(instance.GetDisorderOfQi(), dataPool);
						break;
					case 22:
						result = Serializer.Serialize(instance.GetHaveLeftArm(), dataPool);
						break;
					case 23:
						result = Serializer.Serialize(instance.GetHaveRightArm(), dataPool);
						break;
					case 24:
						result = Serializer.Serialize(instance.GetHaveLeftLeg(), dataPool);
						break;
					case 25:
						result = Serializer.Serialize(instance.GetHaveRightLeg(), dataPool);
						break;
					case 26:
						result = Serializer.Serialize(instance.GetInjuries(), dataPool);
						break;
					case 27:
						result = Serializer.Serialize(instance.GetExtraNeili(), dataPool);
						break;
					case 28:
						result = Serializer.Serialize(instance.GetConsummateLevel(), dataPool);
						break;
					case 29:
						result = Serializer.Serialize(instance.GetLearnedLifeSkills(), dataPool);
						break;
					case 30:
						result = Serializer.Serialize(*instance.GetBaseLifeSkillQualifications(), dataPool);
						break;
					case 31:
						result = Serializer.Serialize(instance.GetLifeSkillQualificationGrowthType(), dataPool);
						break;
					case 32:
						result = Serializer.Serialize(*instance.GetBaseCombatSkillQualifications(), dataPool);
						break;
					case 33:
						result = Serializer.Serialize(instance.GetCombatSkillQualificationGrowthType(), dataPool);
						break;
					case 34:
						result = Serializer.Serialize(*instance.GetResources(), dataPool);
						break;
					case 35:
						result = Serializer.Serialize(instance.GetLovingItemSubType(), dataPool);
						break;
					case 36:
						result = Serializer.Serialize(instance.GetHatingItemSubType(), dataPool);
						break;
					case 37:
						result = Serializer.Serialize(instance.GetFullName(), dataPool);
						break;
					case 38:
						result = Serializer.Serialize(instance.GetMonasticTitle(), dataPool);
						break;
					case 39:
						result = Serializer.Serialize(instance.GetAvatar(), dataPool);
						break;
					case 40:
						result = Serializer.Serialize(instance.GetPotentialFeatureIds(), dataPool);
						break;
					case 41:
						result = Serializer.Serialize(instance.GetFameActionRecords(), dataPool);
						break;
					case 42:
						result = Serializer.Serialize(*instance.GetGenome(), dataPool);
						break;
					case 43:
						result = Serializer.Serialize(instance.GetCurrMainAttributes(), dataPool);
						break;
					case 44:
						result = Serializer.Serialize(*instance.GetPoisoned(), dataPool);
						break;
					case 45:
						result = Serializer.Serialize(instance.GetInjuriesRecoveryProgress(), dataPool);
						break;
					case 46:
						result = Serializer.Serialize(instance.GetCurrNeili(), dataPool);
						break;
					case 47:
						result = Serializer.Serialize(instance.GetLoopingNeigong(), dataPool);
						break;
					case 48:
						result = Serializer.Serialize(instance.GetBaseNeiliAllocation(), dataPool);
						break;
					case 49:
						result = Serializer.Serialize(instance.GetExtraNeiliAllocation(), dataPool);
						break;
					case 50:
						result = Serializer.Serialize(instance.GetBaseNeiliProportionOfFiveElements(), dataPool);
						break;
					case 51:
						result = Serializer.Serialize(instance.GetHobbyExpirationDate(), dataPool);
						break;
					case 52:
						result = Serializer.Serialize(instance.GetLovingItemRevealed(), dataPool);
						break;
					case 53:
						result = Serializer.Serialize(instance.GetHatingItemRevealed(), dataPool);
						break;
					case 54:
						result = Serializer.Serialize(instance.GetLegitimateBoysCount(), dataPool);
						break;
					case 55:
						result = Serializer.Serialize(instance.GetBirthLocation(), dataPool);
						break;
					case 56:
						result = Serializer.Serialize(instance.GetLocation(), dataPool);
						break;
					case 57:
						result = Serializer.Serialize(instance.GetEquipment(), dataPool);
						break;
					case 58:
						result = Serializer.Serialize(instance.GetInventory(), dataPool);
						break;
					case 59:
						result = Serializer.Serialize(*instance.GetEatingItems(), dataPool);
						break;
					case 60:
						result = Serializer.Serialize(instance.GetLearnedCombatSkills(), dataPool);
						break;
					case 61:
						result = Serializer.Serialize(instance.GetEquippedCombatSkills(), dataPool);
						break;
					case 62:
						result = Serializer.Serialize(instance.GetCombatSkillAttainmentPanels(), dataPool);
						break;
					case 63:
						result = Serializer.Serialize(instance.GetSkillQualificationBonuses(), dataPool);
						break;
					case 64:
						result = Serializer.Serialize(*instance.GetPreexistenceCharIds(), dataPool);
						break;
					case 65:
						result = Serializer.Serialize(instance.GetXiangshuInfection(), dataPool);
						break;
					case 66:
						result = Serializer.Serialize(instance.GetCurrAge(), dataPool);
						break;
					case 67:
						result = Serializer.Serialize(instance.GetExp(), dataPool);
						break;
					case 68:
						result = Serializer.Serialize(instance.GetExternalRelationState(), dataPool);
						break;
					case 69:
						result = Serializer.Serialize(instance.GetKidnapperId(), dataPool);
						break;
					case 70:
						result = Serializer.Serialize(instance.GetLeaderId(), dataPool);
						break;
					case 71:
						result = Serializer.Serialize(instance.GetFactionId(), dataPool);
						break;
					case 72:
						result = Serializer.Serialize(instance.GetPersonalNeeds(), dataPool);
						break;
					case 73:
						result = Serializer.Serialize(instance.GetActionEnergies(), dataPool);
						break;
					case 74:
						result = Serializer.Serialize(instance.GetNpcTravelTargets(), dataPool);
						break;
					case 75:
						result = Serializer.Serialize(instance.GetPrioritizedActionCooldowns(), dataPool);
						break;
					case 76:
						result = Serializer.Serialize(instance.GetPhysiologicalAge(), dataPool);
						break;
					case 77:
						result = Serializer.Serialize(instance.GetFame(), dataPool);
						break;
					case 78:
						result = Serializer.Serialize(instance.GetMorality(), dataPool);
						break;
					case 79:
						result = Serializer.Serialize(instance.GetAttraction(), dataPool);
						break;
					case 80:
						result = Serializer.Serialize(instance.GetMaxMainAttributes(), dataPool);
						break;
					case 81:
						result = Serializer.Serialize(instance.GetHitValues(), dataPool);
						break;
					case 82:
						result = Serializer.Serialize(instance.GetPenetrations(), dataPool);
						break;
					case 83:
						result = Serializer.Serialize(instance.GetAvoidValues(), dataPool);
						break;
					case 84:
						result = Serializer.Serialize(instance.GetPenetrationResists(), dataPool);
						break;
					case 85:
						result = Serializer.Serialize(instance.GetRecoveryOfStanceAndBreath(), dataPool);
						break;
					case 86:
						result = Serializer.Serialize(instance.GetMoveSpeed(), dataPool);
						break;
					case 87:
						result = Serializer.Serialize(instance.GetRecoveryOfFlaw(), dataPool);
						break;
					case 88:
						result = Serializer.Serialize(instance.GetCastSpeed(), dataPool);
						break;
					case 89:
						result = Serializer.Serialize(instance.GetRecoveryOfBlockedAcupoint(), dataPool);
						break;
					case 90:
						result = Serializer.Serialize(instance.GetWeaponSwitchSpeed(), dataPool);
						break;
					case 91:
						result = Serializer.Serialize(instance.GetAttackSpeed(), dataPool);
						break;
					case 92:
						result = Serializer.Serialize(instance.GetInnerRatio(), dataPool);
						break;
					case 93:
						result = Serializer.Serialize(instance.GetRecoveryOfQiDisorder(), dataPool);
						break;
					case 94:
						result = Serializer.Serialize(*instance.GetPoisonResists(), dataPool);
						break;
					case 95:
						result = Serializer.Serialize(instance.GetMaxHealth(), dataPool);
						break;
					case 96:
						result = Serializer.Serialize(instance.GetFertility(), dataPool);
						break;
					case 97:
						result = Serializer.Serialize(*instance.GetLifeSkillQualifications(), dataPool);
						break;
					case 98:
						result = Serializer.Serialize(*instance.GetLifeSkillAttainments(), dataPool);
						break;
					case 99:
						result = Serializer.Serialize(*instance.GetCombatSkillQualifications(), dataPool);
						break;
					case 100:
						result = Serializer.Serialize(*instance.GetCombatSkillAttainments(), dataPool);
						break;
					case 101:
						result = Serializer.Serialize(instance.GetPersonalities(), dataPool);
						break;
					case 102:
						result = Serializer.Serialize(instance.GetHobbyChangingPeriod(), dataPool);
						break;
					case 103:
						result = Serializer.Serialize(instance.GetFavorabilityChangingFactor(), dataPool);
						break;
					case 104:
						result = Serializer.Serialize(instance.GetMaxInventoryLoad(), dataPool);
						break;
					case 105:
						result = Serializer.Serialize(instance.GetCurrInventoryLoad(), dataPool);
						break;
					case 106:
						result = Serializer.Serialize(instance.GetMaxEquipmentLoad(), dataPool);
						break;
					case 107:
						result = Serializer.Serialize(instance.GetCurrEquipmentLoad(), dataPool);
						break;
					case 108:
						result = Serializer.Serialize(instance.GetInventoryTotalValue(), dataPool);
						break;
					case 109:
						result = Serializer.Serialize(instance.GetMaxNeili(), dataPool);
						break;
					case 110:
						result = Serializer.Serialize(instance.GetNeiliAllocation(), dataPool);
						break;
					case 111:
						result = Serializer.Serialize(instance.GetNeiliProportionOfFiveElements(), dataPool);
						break;
					case 112:
						result = Serializer.Serialize(instance.GetNeiliType(), dataPool);
						break;
					case 113:
						result = Serializer.Serialize(instance.GetCombatPower(), dataPool);
						break;
					case 114:
						result = Serializer.Serialize(instance.GetAttackTendencyOfInnerAndOuter(), dataPool);
						break;
					case 115:
						result = Serializer.Serialize(instance.GetAllocatedNeiliEffects(), dataPool);
						break;
					case 116:
						result = Serializer.Serialize(instance.GetMaxConsummateLevel(), dataPool);
						break;
					case 117:
						result = Serializer.Serialize(instance.GetCombatSkillEquipment(), dataPool);
						break;
					case 118:
						result = Serializer.Serialize(instance.GetDarkAshProtector(), dataPool);
						break;
					default:
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(20, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Unsupported fieldId ");
						defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					}
				}
			}
			return result;
		}

		// Token: 0x06007372 RID: 29554 RVA: 0x00433008 File Offset: 0x00431208
		private void ResetModifiedWrapper_Objects(int objectId, ushort fieldId)
		{
			Character instance;
			bool flag = !this._objects.TryGetValue(objectId, out instance);
			if (!flag)
			{
				bool flag2 = fieldId >= 119;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(62, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of readonly field data: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				bool flag3 = !this._dataStatesObjects.IsModified(instance.DataStatesOffset, (int)fieldId);
				if (!flag3)
				{
					this._dataStatesObjects.ResetModified(instance.DataStatesOffset, (int)fieldId);
				}
			}
		}

		// Token: 0x06007373 RID: 29555 RVA: 0x00433098 File Offset: 0x00431298
		private bool IsModifiedWrapper_Objects(int objectId, ushort fieldId)
		{
			Character instance;
			bool flag = !this._objects.TryGetValue(objectId, out instance);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = fieldId >= 119;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(62, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification state of readonly field data: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				result = this._dataStatesObjects.IsModified(instance.DataStatesOffset, (int)fieldId);
			}
			return result;
		}

		// Token: 0x06007374 RID: 29556 RVA: 0x00433110 File Offset: 0x00431310
		private int GetNextObjectId()
		{
			return this._nextObjectId;
		}

		// Token: 0x06007375 RID: 29557 RVA: 0x00433128 File Offset: 0x00431328
		private unsafe void SetNextObjectId(int value, DataContext context)
		{
			this._nextObjectId = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(1, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValue_Set(4, 1, 4);
			*(int*)pData = this._nextObjectId;
			pData += 4;
		}

		// Token: 0x06007376 RID: 29558 RVA: 0x00433168 File Offset: 0x00431368
		private DeadCharacter GetElement_DeadCharacters(int elementId)
		{
			return this._deadCharacters[elementId];
		}

		// Token: 0x06007377 RID: 29559 RVA: 0x00433188 File Offset: 0x00431388
		private bool TryGetElement_DeadCharacters(int elementId, out DeadCharacter value)
		{
			return this._deadCharacters.TryGetValue(elementId, out value);
		}

		// Token: 0x06007378 RID: 29560 RVA: 0x004331A8 File Offset: 0x004313A8
		private unsafe void AddElement_DeadCharacters(int elementId, DeadCharacter value, DataContext context)
		{
			this._deadCharacters.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(2, this.DataStates, CharacterDomain.CacheInfluences, context);
			bool flag = value != null;
			if (flag)
			{
				int contentSize = value.GetSerializedSize();
				byte* pData = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 2, elementId, contentSize);
				pData += value.Serialize(pData);
			}
			else
			{
				OperationAdder.DynamicSingleValueCollection_Add<int>(4, 2, elementId, 0);
			}
		}

		// Token: 0x06007379 RID: 29561 RVA: 0x00433208 File Offset: 0x00431408
		private unsafe void SetElement_DeadCharacters(int elementId, DeadCharacter value, DataContext context)
		{
			this._deadCharacters[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(2, this.DataStates, CharacterDomain.CacheInfluences, context);
			bool flag = value != null;
			if (flag)
			{
				int contentSize = value.GetSerializedSize();
				byte* pData = OperationAdder.DynamicSingleValueCollection_Set<int>(4, 2, elementId, contentSize);
				pData += value.Serialize(pData);
			}
			else
			{
				OperationAdder.DynamicSingleValueCollection_Set<int>(4, 2, elementId, 0);
			}
		}

		// Token: 0x0600737A RID: 29562 RVA: 0x00433268 File Offset: 0x00431468
		private void RemoveElement_DeadCharacters(int elementId, DataContext context)
		{
			this._deadCharacters.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(2, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Remove<int>(4, 2, elementId);
		}

		// Token: 0x0600737B RID: 29563 RVA: 0x00433294 File Offset: 0x00431494
		private void ClearDeadCharacters(DataContext context)
		{
			this._deadCharacters.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(2, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Clear(4, 2);
		}

		// Token: 0x0600737C RID: 29564 RVA: 0x004332C0 File Offset: 0x004314C0
		private DeadCharDeletionState GetElement_DeadCharDeletionStates(int elementId)
		{
			return this._deadCharDeletionStates[elementId];
		}

		// Token: 0x0600737D RID: 29565 RVA: 0x004332E0 File Offset: 0x004314E0
		private bool TryGetElement_DeadCharDeletionStates(int elementId, out DeadCharDeletionState value)
		{
			return this._deadCharDeletionStates.TryGetValue(elementId, out value);
		}

		// Token: 0x0600737E RID: 29566 RVA: 0x00433300 File Offset: 0x00431500
		private unsafe void AddElement_DeadCharDeletionStates(int elementId, DeadCharDeletionState value, DataContext context)
		{
			this._deadCharDeletionStates.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(3, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Add<int>(4, 3, elementId, 2);
			pData += value.Serialize(pData);
		}

		// Token: 0x0600737F RID: 29567 RVA: 0x00433344 File Offset: 0x00431544
		private unsafe void SetElement_DeadCharDeletionStates(int elementId, DeadCharDeletionState value, DataContext context)
		{
			this._deadCharDeletionStates[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(3, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Set<int>(4, 3, elementId, 2);
			pData += value.Serialize(pData);
		}

		// Token: 0x06007380 RID: 29568 RVA: 0x00433388 File Offset: 0x00431588
		private void RemoveElement_DeadCharDeletionStates(int elementId, DataContext context)
		{
			this._deadCharDeletionStates.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(3, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Remove<int>(4, 3, elementId);
		}

		// Token: 0x06007381 RID: 29569 RVA: 0x004333B4 File Offset: 0x004315B4
		private void ClearDeadCharDeletionStates(DataContext context)
		{
			this._deadCharDeletionStates.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(3, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Clear(4, 3);
		}

		// Token: 0x06007382 RID: 29570 RVA: 0x004333E0 File Offset: 0x004315E0
		private VoidValue GetElement_RecentDeadCharacters(IntPair elementId)
		{
			return this._recentDeadCharacters[elementId];
		}

		// Token: 0x06007383 RID: 29571 RVA: 0x00433400 File Offset: 0x00431600
		private bool TryGetElement_RecentDeadCharacters(IntPair elementId, out VoidValue value)
		{
			return this._recentDeadCharacters.TryGetValue(elementId, out value);
		}

		// Token: 0x06007384 RID: 29572 RVA: 0x00433420 File Offset: 0x00431620
		private unsafe void AddElement_RecentDeadCharacters(IntPair elementId, VoidValue value, DataContext context)
		{
			this._recentDeadCharacters.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(4, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Add<IntPair>(4, 4, elementId, 0);
			pData += value.Serialize(pData);
		}

		// Token: 0x06007385 RID: 29573 RVA: 0x00433464 File Offset: 0x00431664
		private unsafe void SetElement_RecentDeadCharacters(IntPair elementId, VoidValue value, DataContext context)
		{
			this._recentDeadCharacters[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(4, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Set<IntPair>(4, 4, elementId, 0);
			pData += value.Serialize(pData);
		}

		// Token: 0x06007386 RID: 29574 RVA: 0x004334A8 File Offset: 0x004316A8
		private void RemoveElement_RecentDeadCharacters(IntPair elementId, DataContext context)
		{
			this._recentDeadCharacters.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(4, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Remove<IntPair>(4, 4, elementId);
		}

		// Token: 0x06007387 RID: 29575 RVA: 0x004334D4 File Offset: 0x004316D4
		private void ClearRecentDeadCharacters(DataContext context)
		{
			this._recentDeadCharacters.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(4, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Clear(4, 4);
		}

		// Token: 0x06007388 RID: 29576 RVA: 0x00433500 File Offset: 0x00431700
		private VoidValue GetElement_WaitingReincarnationChars(IntPair elementId)
		{
			return this._waitingReincarnationChars[elementId];
		}

		// Token: 0x06007389 RID: 29577 RVA: 0x00433520 File Offset: 0x00431720
		private bool TryGetElement_WaitingReincarnationChars(IntPair elementId, out VoidValue value)
		{
			return this._waitingReincarnationChars.TryGetValue(elementId, out value);
		}

		// Token: 0x0600738A RID: 29578 RVA: 0x00433540 File Offset: 0x00431740
		private unsafe void AddElement_WaitingReincarnationChars(IntPair elementId, VoidValue value, DataContext context)
		{
			this._waitingReincarnationChars.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(5, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Add<IntPair>(4, 5, elementId, 0);
			pData += value.Serialize(pData);
		}

		// Token: 0x0600738B RID: 29579 RVA: 0x00433584 File Offset: 0x00431784
		private unsafe void SetElement_WaitingReincarnationChars(IntPair elementId, VoidValue value, DataContext context)
		{
			this._waitingReincarnationChars[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(5, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Set<IntPair>(4, 5, elementId, 0);
			pData += value.Serialize(pData);
		}

		// Token: 0x0600738C RID: 29580 RVA: 0x004335C8 File Offset: 0x004317C8
		private void RemoveElement_WaitingReincarnationChars(IntPair elementId, DataContext context)
		{
			this._waitingReincarnationChars.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(5, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Remove<IntPair>(4, 5, elementId);
		}

		// Token: 0x0600738D RID: 29581 RVA: 0x004335F4 File Offset: 0x004317F4
		private void ClearWaitingReincarnationChars(DataContext context)
		{
			this._waitingReincarnationChars.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(5, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Clear(4, 5);
		}

		// Token: 0x0600738E RID: 29582 RVA: 0x00433620 File Offset: 0x00431820
		public Grave GetElement_Graves(int objectId)
		{
			return this._graves[objectId];
		}

		// Token: 0x0600738F RID: 29583 RVA: 0x00433640 File Offset: 0x00431840
		public bool TryGetElement_Graves(int objectId, out Grave element)
		{
			return this._graves.TryGetValue(objectId, out element);
		}

		// Token: 0x06007390 RID: 29584 RVA: 0x00433660 File Offset: 0x00431860
		private unsafe void AddElement_Graves(int objectId, Grave instance)
		{
			instance.CollectionHelperData = this.HelperDataGraves;
			instance.DataStatesOffset = this._dataStatesGraves.Create();
			this._graves.Add(objectId, instance);
			byte* pData = OperationAdder.DynamicObjectCollection_Add<int>(4, 6, objectId, instance.GetSerializedSize());
			instance.Serialize(pData);
		}

		// Token: 0x06007391 RID: 29585 RVA: 0x004336B0 File Offset: 0x004318B0
		private void RemoveElement_Graves(int objectId)
		{
			Grave instance;
			bool flag = !this._graves.TryGetValue(objectId, out instance);
			if (!flag)
			{
				this._dataStatesGraves.Remove(instance.DataStatesOffset);
				this._graves.Remove(objectId);
				OperationAdder.DynamicObjectCollection_Remove<int>(4, 6, objectId);
			}
		}

		// Token: 0x06007392 RID: 29586 RVA: 0x004336FD File Offset: 0x004318FD
		private void ClearGraves()
		{
			this._dataStatesGraves.Clear();
			this._graves.Clear();
			OperationAdder.DynamicObjectCollection_Clear(4, 6);
		}

		// Token: 0x06007393 RID: 29587 RVA: 0x00433720 File Offset: 0x00431920
		public unsafe int GetElementField_Graves(int objectId, ushort fieldId, RawDataPool dataPool, bool resetModified)
		{
			Grave instance;
			bool flag = !this._graves.TryGetValue(objectId, out instance);
			int result;
			if (flag)
			{
				string tag = "GetElementField_Graves";
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find element ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(objectId);
				defaultInterpolatedStringHandler.AppendLiteral(" with field ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				AdaptableLog.TagWarning(tag, defaultInterpolatedStringHandler.ToStringAndClear(), false);
				result = -1;
			}
			else
			{
				if (resetModified)
				{
					this._dataStatesGraves.ResetModified(instance.DataStatesOffset, (int)fieldId);
				}
				switch (fieldId)
				{
				case 0:
					result = Serializer.Serialize(instance.GetId(), dataPool);
					break;
				case 1:
					result = Serializer.Serialize(instance.GetLocation(), dataPool);
					break;
				case 2:
					result = Serializer.Serialize(instance.GetLevel(), dataPool);
					break;
				case 3:
					result = Serializer.Serialize(instance.GetDurability(), dataPool);
					break;
				case 4:
					result = Serializer.Serialize(instance.GetInventory(), dataPool);
					break;
				case 5:
					result = Serializer.Serialize(*instance.GetResources(), dataPool);
					break;
				case 6:
					result = Serializer.Serialize(instance.GetSkeletonCharId(), dataPool);
					break;
				default:
				{
					bool flag2 = fieldId >= 7;
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler;
					if (flag2)
					{
						defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(20, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Unsupported fieldId ");
						defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Not allow to get readonly field data: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				}
			}
			return result;
		}

		// Token: 0x06007394 RID: 29588 RVA: 0x004338C0 File Offset: 0x00431AC0
		public void SetElementField_Graves(int objectId, ushort fieldId, int valueOffset, RawDataPool dataPool, DataContext context)
		{
			Grave instance;
			bool flag = !this._graves.TryGetValue(objectId, out instance);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to find element ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(objectId);
				defaultInterpolatedStringHandler.AppendLiteral(" with field ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			switch (fieldId)
			{
			case 0:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 1:
			{
				Location value = default(Location);
				Serializer.Deserialize(dataPool, valueOffset, ref value);
				instance.SetLocation(value, context);
				break;
			}
			case 2:
			{
				sbyte value2 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value2);
				instance.SetLevel(value2, context);
				break;
			}
			case 3:
			{
				short value3 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value3);
				instance.SetDurability(value3, context);
				break;
			}
			case 4:
			{
				Inventory value4 = instance.GetInventory();
				Serializer.Deserialize(dataPool, valueOffset, ref value4);
				instance.SetInventory(value4, context);
				break;
			}
			case 5:
			{
				ResourceInts value5 = default(ResourceInts);
				Serializer.Deserialize(dataPool, valueOffset, ref value5);
				instance.SetResources(ref value5, context);
				break;
			}
			case 6:
			{
				int value6 = 0;
				Serializer.Deserialize(dataPool, valueOffset, ref value6);
				instance.SetSkeletonCharId(value6, context);
				break;
			}
			default:
			{
				bool flag2 = fieldId >= 7;
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler;
				if (flag2)
				{
					defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(20, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported fieldId ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				bool flag3 = fieldId >= 7;
				if (flag3)
				{
					defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(38, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Not allow to set readonly field data: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set cache field data: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
		}

		// Token: 0x06007395 RID: 29589 RVA: 0x00433AEC File Offset: 0x00431CEC
		private unsafe int CheckModified_Graves(int objectId, ushort fieldId, RawDataPool dataPool)
		{
			Grave instance;
			bool flag = !this._graves.TryGetValue(objectId, out instance);
			int result;
			if (flag)
			{
				result = -1;
			}
			else
			{
				bool flag2 = fieldId >= 7;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(40, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Not allow to check readonly field data: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				bool flag3 = !this._dataStatesGraves.IsModified(instance.DataStatesOffset, (int)fieldId);
				if (flag3)
				{
					result = -1;
				}
				else
				{
					this._dataStatesGraves.ResetModified(instance.DataStatesOffset, (int)fieldId);
					switch (fieldId)
					{
					case 0:
						result = Serializer.Serialize(instance.GetId(), dataPool);
						break;
					case 1:
						result = Serializer.Serialize(instance.GetLocation(), dataPool);
						break;
					case 2:
						result = Serializer.Serialize(instance.GetLevel(), dataPool);
						break;
					case 3:
						result = Serializer.Serialize(instance.GetDurability(), dataPool);
						break;
					case 4:
						result = Serializer.Serialize(instance.GetInventory(), dataPool);
						break;
					case 5:
						result = Serializer.Serialize(*instance.GetResources(), dataPool);
						break;
					case 6:
						result = Serializer.Serialize(instance.GetSkeletonCharId(), dataPool);
						break;
					default:
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(20, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Unsupported fieldId ");
						defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					}
				}
			}
			return result;
		}

		// Token: 0x06007396 RID: 29590 RVA: 0x00433C50 File Offset: 0x00431E50
		private void ResetModifiedWrapper_Graves(int objectId, ushort fieldId)
		{
			Grave instance;
			bool flag = !this._graves.TryGetValue(objectId, out instance);
			if (!flag)
			{
				bool flag2 = fieldId >= 7;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(62, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of readonly field data: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				bool flag3 = !this._dataStatesGraves.IsModified(instance.DataStatesOffset, (int)fieldId);
				if (!flag3)
				{
					this._dataStatesGraves.ResetModified(instance.DataStatesOffset, (int)fieldId);
				}
			}
		}

		// Token: 0x06007397 RID: 29591 RVA: 0x00433CE0 File Offset: 0x00431EE0
		private bool IsModifiedWrapper_Graves(int objectId, ushort fieldId)
		{
			Grave instance;
			bool flag = !this._graves.TryGetValue(objectId, out instance);
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				bool flag2 = fieldId >= 7;
				if (flag2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(62, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification state of readonly field data: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(fieldId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				result = this._dataStatesGraves.IsModified(instance.DataStatesOffset, (int)fieldId);
			}
			return result;
		}

		// Token: 0x06007398 RID: 29592 RVA: 0x00433D58 File Offset: 0x00431F58
		private PregnantState GetElement_PregnantStates(int elementId)
		{
			return this._pregnantStates[elementId];
		}

		// Token: 0x06007399 RID: 29593 RVA: 0x00433D78 File Offset: 0x00431F78
		private bool TryGetElement_PregnantStates(int elementId, out PregnantState value)
		{
			return this._pregnantStates.TryGetValue(elementId, out value);
		}

		// Token: 0x0600739A RID: 29594 RVA: 0x00433D98 File Offset: 0x00431F98
		private unsafe void AddElement_PregnantStates(int elementId, PregnantState value, DataContext context)
		{
			this._pregnantStates.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(7, this.DataStates, CharacterDomain.CacheInfluences, context);
			bool flag = value != null;
			if (flag)
			{
				int contentSize = value.GetSerializedSize();
				byte* pData = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 7, elementId, contentSize);
				pData += value.Serialize(pData);
			}
			else
			{
				OperationAdder.DynamicSingleValueCollection_Add<int>(4, 7, elementId, 0);
			}
		}

		// Token: 0x0600739B RID: 29595 RVA: 0x00433DF8 File Offset: 0x00431FF8
		private unsafe void SetElement_PregnantStates(int elementId, PregnantState value, DataContext context)
		{
			this._pregnantStates[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(7, this.DataStates, CharacterDomain.CacheInfluences, context);
			bool flag = value != null;
			if (flag)
			{
				int contentSize = value.GetSerializedSize();
				byte* pData = OperationAdder.DynamicSingleValueCollection_Set<int>(4, 7, elementId, contentSize);
				pData += value.Serialize(pData);
			}
			else
			{
				OperationAdder.DynamicSingleValueCollection_Set<int>(4, 7, elementId, 0);
			}
		}

		// Token: 0x0600739C RID: 29596 RVA: 0x00433E58 File Offset: 0x00432058
		private void RemoveElement_PregnantStates(int elementId, DataContext context)
		{
			this._pregnantStates.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(7, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Remove<int>(4, 7, elementId);
		}

		// Token: 0x0600739D RID: 29597 RVA: 0x00433E84 File Offset: 0x00432084
		private void ClearPregnantStates(DataContext context)
		{
			this._pregnantStates.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(7, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Clear(4, 7);
		}

		// Token: 0x0600739E RID: 29598 RVA: 0x00433EB0 File Offset: 0x004320B0
		public int GetElement_PregnancyLockEndDates(int elementId)
		{
			return this._pregnancyLockEndDates[elementId];
		}

		// Token: 0x0600739F RID: 29599 RVA: 0x00433ED0 File Offset: 0x004320D0
		public bool TryGetElement_PregnancyLockEndDates(int elementId, out int value)
		{
			return this._pregnancyLockEndDates.TryGetValue(elementId, out value);
		}

		// Token: 0x060073A0 RID: 29600 RVA: 0x00433EF0 File Offset: 0x004320F0
		private unsafe void AddElement_PregnancyLockEndDates(int elementId, int value, DataContext context)
		{
			this._pregnancyLockEndDates.Add(elementId, value);
			this._modificationsPregnancyLockEndDates.RecordAdding(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(8, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Add<int>(4, 8, elementId, 4);
			*(int*)pData = value;
			pData += 4;
		}

		// Token: 0x060073A1 RID: 29601 RVA: 0x00433F40 File Offset: 0x00432140
		private unsafe void SetElement_PregnancyLockEndDates(int elementId, int value, DataContext context)
		{
			this._pregnancyLockEndDates[elementId] = value;
			this._modificationsPregnancyLockEndDates.RecordSetting(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(8, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Set<int>(4, 8, elementId, 4);
			*(int*)pData = value;
			pData += 4;
		}

		// Token: 0x060073A2 RID: 29602 RVA: 0x00433F8D File Offset: 0x0043218D
		private void RemoveElement_PregnancyLockEndDates(int elementId, DataContext context)
		{
			this._pregnancyLockEndDates.Remove(elementId);
			this._modificationsPregnancyLockEndDates.RecordRemoving(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(8, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Remove<int>(4, 8, elementId);
		}

		// Token: 0x060073A3 RID: 29603 RVA: 0x00433FC6 File Offset: 0x004321C6
		private void ClearPregnancyLockEndDates(DataContext context)
		{
			this._pregnancyLockEndDates.Clear();
			this._modificationsPregnancyLockEndDates.RecordClearing();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(8, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Clear(4, 8);
		}

		// Token: 0x060073A4 RID: 29604 RVA: 0x00433FFC File Offset: 0x004321FC
		public CharacterSet GetUnguardedChars()
		{
			return this._unguardedChars;
		}

		// Token: 0x060073A5 RID: 29605 RVA: 0x00434014 File Offset: 0x00432214
		public unsafe void SetUnguardedChars(CharacterSet value, DataContext context)
		{
			this._unguardedChars = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(9, this.DataStates, CharacterDomain.CacheInfluences, context);
			int dataSize = this._unguardedChars.GetSerializedSize();
			byte* pData = OperationAdder.DynamicSingleValue_Set(4, 9, dataSize);
			pData += this._unguardedChars.Serialize(pData);
		}

		// Token: 0x060073A6 RID: 29606 RVA: 0x00434064 File Offset: 0x00432264
		private KidnappedCharacterList GetElement_KidnappedChars(int elementId)
		{
			return this._kidnappedChars[elementId];
		}

		// Token: 0x060073A7 RID: 29607 RVA: 0x00434084 File Offset: 0x00432284
		private bool TryGetElement_KidnappedChars(int elementId, out KidnappedCharacterList value)
		{
			return this._kidnappedChars.TryGetValue(elementId, out value);
		}

		// Token: 0x060073A8 RID: 29608 RVA: 0x004340A4 File Offset: 0x004322A4
		private unsafe void AddElement_KidnappedChars(int elementId, KidnappedCharacterList value, DataContext context)
		{
			this._kidnappedChars.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(10, this.DataStates, CharacterDomain.CacheInfluences, context);
			bool flag = value != null;
			if (flag)
			{
				int contentSize = value.GetSerializedSize();
				byte* pData = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 10, elementId, contentSize);
				pData += value.Serialize(pData);
			}
			else
			{
				OperationAdder.DynamicSingleValueCollection_Add<int>(4, 10, elementId, 0);
			}
		}

		// Token: 0x060073A9 RID: 29609 RVA: 0x00434108 File Offset: 0x00432308
		private unsafe void SetElement_KidnappedChars(int elementId, KidnappedCharacterList value, DataContext context)
		{
			this._kidnappedChars[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(10, this.DataStates, CharacterDomain.CacheInfluences, context);
			bool flag = value != null;
			if (flag)
			{
				int contentSize = value.GetSerializedSize();
				byte* pData = OperationAdder.DynamicSingleValueCollection_Set<int>(4, 10, elementId, contentSize);
				pData += value.Serialize(pData);
			}
			else
			{
				OperationAdder.DynamicSingleValueCollection_Set<int>(4, 10, elementId, 0);
			}
		}

		// Token: 0x060073AA RID: 29610 RVA: 0x0043416B File Offset: 0x0043236B
		private void RemoveElement_KidnappedChars(int elementId, DataContext context)
		{
			this._kidnappedChars.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(10, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Remove<int>(4, 10, elementId);
		}

		// Token: 0x060073AB RID: 29611 RVA: 0x00434199 File Offset: 0x00432399
		private void ClearKidnappedChars(DataContext context)
		{
			this._kidnappedChars.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(10, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Clear(4, 10);
		}

		// Token: 0x060073AC RID: 29612 RVA: 0x004341C8 File Offset: 0x004323C8
		private RelatedCharacter GetElement_Relations(RelationKey elementId)
		{
			return this._relations[elementId];
		}

		// Token: 0x060073AD RID: 29613 RVA: 0x004341E8 File Offset: 0x004323E8
		private bool TryGetElement_Relations(RelationKey elementId, out RelatedCharacter value)
		{
			return this._relations.TryGetValue(elementId, out value);
		}

		// Token: 0x060073AE RID: 29614 RVA: 0x00434208 File Offset: 0x00432408
		private unsafe void AddElement_Relations(RelationKey elementId, RelatedCharacter value, DataContext context)
		{
			this._relations.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(11, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Add<RelationKey>(4, 11, elementId, 8);
			pData += value.Serialize(pData);
		}

		// Token: 0x060073AF RID: 29615 RVA: 0x00434250 File Offset: 0x00432450
		private unsafe void SetElement_Relations(RelationKey elementId, RelatedCharacter value, DataContext context)
		{
			this._relations[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(11, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Set<RelationKey>(4, 11, elementId, 8);
			pData += value.Serialize(pData);
		}

		// Token: 0x060073B0 RID: 29616 RVA: 0x00434296 File Offset: 0x00432496
		private void RemoveElement_Relations(RelationKey elementId, DataContext context)
		{
			this._relations.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(11, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Remove<RelationKey>(4, 11, elementId);
		}

		// Token: 0x060073B1 RID: 29617 RVA: 0x004342C4 File Offset: 0x004324C4
		private void ClearRelations(DataContext context)
		{
			this._relations.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(11, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Clear(4, 11);
		}

		// Token: 0x060073B2 RID: 29618 RVA: 0x004342F0 File Offset: 0x004324F0
		private int GetElement_ActualBloodParents(ParentAndChild elementId)
		{
			return this._actualBloodParents[elementId];
		}

		// Token: 0x060073B3 RID: 29619 RVA: 0x00434310 File Offset: 0x00432510
		private bool TryGetElement_ActualBloodParents(ParentAndChild elementId, out int value)
		{
			return this._actualBloodParents.TryGetValue(elementId, out value);
		}

		// Token: 0x060073B4 RID: 29620 RVA: 0x00434330 File Offset: 0x00432530
		private unsafe void AddElement_ActualBloodParents(ParentAndChild elementId, int value, DataContext context)
		{
			this._actualBloodParents.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(12, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Add<ParentAndChild>(4, 12, elementId, 4);
			*(int*)pData = value;
			pData += 4;
		}

		// Token: 0x060073B5 RID: 29621 RVA: 0x00434374 File Offset: 0x00432574
		private unsafe void SetElement_ActualBloodParents(ParentAndChild elementId, int value, DataContext context)
		{
			this._actualBloodParents[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(12, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Set<ParentAndChild>(4, 12, elementId, 4);
			*(int*)pData = value;
			pData += 4;
		}

		// Token: 0x060073B6 RID: 29622 RVA: 0x004343B6 File Offset: 0x004325B6
		private void RemoveElement_ActualBloodParents(ParentAndChild elementId, DataContext context)
		{
			this._actualBloodParents.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(12, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Remove<ParentAndChild>(4, 12, elementId);
		}

		// Token: 0x060073B7 RID: 29623 RVA: 0x004343E4 File Offset: 0x004325E4
		private void ClearActualBloodParents(DataContext context)
		{
			this._actualBloodParents.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(12, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Clear(4, 12);
		}

		// Token: 0x060073B8 RID: 29624 RVA: 0x00434410 File Offset: 0x00432610
		private CharacterSet GetElement_CharacterGroups(int elementId)
		{
			return this._characterGroups[elementId];
		}

		// Token: 0x060073B9 RID: 29625 RVA: 0x00434430 File Offset: 0x00432630
		private bool TryGetElement_CharacterGroups(int elementId, out CharacterSet value)
		{
			return this._characterGroups.TryGetValue(elementId, out value);
		}

		// Token: 0x060073BA RID: 29626 RVA: 0x00434450 File Offset: 0x00432650
		private unsafe void AddElement_CharacterGroups(int elementId, CharacterSet value, DataContext context)
		{
			this._characterGroups.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(13, this.DataStates, CharacterDomain.CacheInfluences, context);
			int dataSize = value.GetSerializedSize();
			byte* pData = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 13, elementId, dataSize);
			pData += value.Serialize(pData);
		}

		// Token: 0x060073BB RID: 29627 RVA: 0x004344A0 File Offset: 0x004326A0
		private unsafe void SetElement_CharacterGroups(int elementId, CharacterSet value, DataContext context)
		{
			this._characterGroups[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(13, this.DataStates, CharacterDomain.CacheInfluences, context);
			int dataSize = value.GetSerializedSize();
			byte* pData = OperationAdder.DynamicSingleValueCollection_Set<int>(4, 13, elementId, dataSize);
			pData += value.Serialize(pData);
		}

		// Token: 0x060073BC RID: 29628 RVA: 0x004344EE File Offset: 0x004326EE
		private void RemoveElement_CharacterGroups(int elementId, DataContext context)
		{
			this._characterGroups.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(13, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Remove<int>(4, 13, elementId);
		}

		// Token: 0x060073BD RID: 29629 RVA: 0x0043451C File Offset: 0x0043271C
		private void ClearCharacterGroups(DataContext context)
		{
			this._characterGroups.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(13, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Clear(4, 13);
		}

		// Token: 0x060073BE RID: 29630 RVA: 0x00434548 File Offset: 0x00432748
		public int GetElement_JoinGroupDates(int elementId)
		{
			return this._joinGroupDates[elementId];
		}

		// Token: 0x060073BF RID: 29631 RVA: 0x00434568 File Offset: 0x00432768
		public bool TryGetElement_JoinGroupDates(int elementId, out int value)
		{
			return this._joinGroupDates.TryGetValue(elementId, out value);
		}

		// Token: 0x060073C0 RID: 29632 RVA: 0x00434588 File Offset: 0x00432788
		private unsafe void AddElement_JoinGroupDates(int elementId, int value, DataContext context)
		{
			this._joinGroupDates.Add(elementId, value);
			this._modificationsJoinGroupDates.RecordAdding(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(14, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Add<int>(4, 14, elementId, 4);
			*(int*)pData = value;
			pData += 4;
		}

		// Token: 0x060073C1 RID: 29633 RVA: 0x004345D8 File Offset: 0x004327D8
		private unsafe void SetElement_JoinGroupDates(int elementId, int value, DataContext context)
		{
			this._joinGroupDates[elementId] = value;
			this._modificationsJoinGroupDates.RecordSetting(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(14, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Set<int>(4, 14, elementId, 4);
			*(int*)pData = value;
			pData += 4;
		}

		// Token: 0x060073C2 RID: 29634 RVA: 0x00434627 File Offset: 0x00432827
		private void RemoveElement_JoinGroupDates(int elementId, DataContext context)
		{
			this._joinGroupDates.Remove(elementId);
			this._modificationsJoinGroupDates.RecordRemoving(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(14, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Remove<int>(4, 14, elementId);
		}

		// Token: 0x060073C3 RID: 29635 RVA: 0x00434662 File Offset: 0x00432862
		private void ClearJoinGroupDates(DataContext context)
		{
			this._joinGroupDates.Clear();
			this._modificationsJoinGroupDates.RecordClearing();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(14, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Clear(4, 14);
		}

		// Token: 0x060073C4 RID: 29636 RVA: 0x0043469C File Offset: 0x0043289C
		private Debts GetElement_DebtsToTaiwu(int elementId)
		{
			return this._debtsToTaiwu[elementId];
		}

		// Token: 0x060073C5 RID: 29637 RVA: 0x004346BC File Offset: 0x004328BC
		private bool TryGetElement_DebtsToTaiwu(int elementId, out Debts value)
		{
			return this._debtsToTaiwu.TryGetValue(elementId, out value);
		}

		// Token: 0x060073C6 RID: 29638 RVA: 0x004346DC File Offset: 0x004328DC
		private unsafe void AddElement_DebtsToTaiwu(int elementId, Debts value, DataContext context)
		{
			this._debtsToTaiwu.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(15, this.DataStates, CharacterDomain.CacheInfluences, context);
			bool flag = value != null;
			if (flag)
			{
				int contentSize = value.GetSerializedSize();
				byte* pData = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 15, elementId, contentSize);
				pData += value.Serialize(pData);
			}
			else
			{
				OperationAdder.DynamicSingleValueCollection_Add<int>(4, 15, elementId, 0);
			}
		}

		// Token: 0x060073C7 RID: 29639 RVA: 0x00434740 File Offset: 0x00432940
		private unsafe void SetElement_DebtsToTaiwu(int elementId, Debts value, DataContext context)
		{
			this._debtsToTaiwu[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(15, this.DataStates, CharacterDomain.CacheInfluences, context);
			bool flag = value != null;
			if (flag)
			{
				int contentSize = value.GetSerializedSize();
				byte* pData = OperationAdder.DynamicSingleValueCollection_Set<int>(4, 15, elementId, contentSize);
				pData += value.Serialize(pData);
			}
			else
			{
				OperationAdder.DynamicSingleValueCollection_Set<int>(4, 15, elementId, 0);
			}
		}

		// Token: 0x060073C8 RID: 29640 RVA: 0x004347A3 File Offset: 0x004329A3
		private void RemoveElement_DebtsToTaiwu(int elementId, DataContext context)
		{
			this._debtsToTaiwu.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(15, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Remove<int>(4, 15, elementId);
		}

		// Token: 0x060073C9 RID: 29641 RVA: 0x004347D1 File Offset: 0x004329D1
		private void ClearDebtsToTaiwu(DataContext context)
		{
			this._debtsToTaiwu.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(15, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Clear(4, 15);
		}

		// Token: 0x060073CA RID: 29642 RVA: 0x00434800 File Offset: 0x00432A00
		private GameData.Utilities.ShortList GetElement_SoldLibrarySkillBooks(int elementId)
		{
			return this._soldLibrarySkillBooks[elementId];
		}

		// Token: 0x060073CB RID: 29643 RVA: 0x00434820 File Offset: 0x00432A20
		private bool TryGetElement_SoldLibrarySkillBooks(int elementId, out GameData.Utilities.ShortList value)
		{
			return this._soldLibrarySkillBooks.TryGetValue(elementId, out value);
		}

		// Token: 0x060073CC RID: 29644 RVA: 0x00434840 File Offset: 0x00432A40
		private unsafe void AddElement_SoldLibrarySkillBooks(int elementId, GameData.Utilities.ShortList value, DataContext context)
		{
			this._soldLibrarySkillBooks.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(16, this.DataStates, CharacterDomain.CacheInfluences, context);
			int dataSize = value.GetSerializedSize();
			byte* pData = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 16, elementId, dataSize);
			pData += value.Serialize(pData);
		}

		// Token: 0x060073CD RID: 29645 RVA: 0x00434890 File Offset: 0x00432A90
		private unsafe void SetElement_SoldLibrarySkillBooks(int elementId, GameData.Utilities.ShortList value, DataContext context)
		{
			this._soldLibrarySkillBooks[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(16, this.DataStates, CharacterDomain.CacheInfluences, context);
			int dataSize = value.GetSerializedSize();
			byte* pData = OperationAdder.DynamicSingleValueCollection_Set<int>(4, 16, elementId, dataSize);
			pData += value.Serialize(pData);
		}

		// Token: 0x060073CE RID: 29646 RVA: 0x004348DE File Offset: 0x00432ADE
		private void RemoveElement_SoldLibrarySkillBooks(int elementId, DataContext context)
		{
			this._soldLibrarySkillBooks.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(16, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Remove<int>(4, 16, elementId);
		}

		// Token: 0x060073CF RID: 29647 RVA: 0x0043490C File Offset: 0x00432B0C
		private void ClearSoldLibrarySkillBooks(DataContext context)
		{
			this._soldLibrarySkillBooks.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(16, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Clear(4, 16);
		}

		// Token: 0x060073D0 RID: 29648 RVA: 0x00434938 File Offset: 0x00432B38
		[Obsolete("DomainData _usedCombatResourceObsoletes is no longer in use.")]
		private CombatResourcesObsolete GetElement_UsedCombatResourceObsoletes(int elementId)
		{
			return this._usedCombatResourceObsoletes[elementId];
		}

		// Token: 0x060073D1 RID: 29649 RVA: 0x00434958 File Offset: 0x00432B58
		[Obsolete("DomainData _usedCombatResourceObsoletes is no longer in use.")]
		private bool TryGetElement_UsedCombatResourceObsoletes(int elementId, out CombatResourcesObsolete value)
		{
			return this._usedCombatResourceObsoletes.TryGetValue(elementId, out value);
		}

		// Token: 0x060073D2 RID: 29650 RVA: 0x00434978 File Offset: 0x00432B78
		[Obsolete("DomainData _usedCombatResourceObsoletes is no longer in use.")]
		private unsafe void AddElement_UsedCombatResourceObsoletes(int elementId, CombatResourcesObsolete value, DataContext context)
		{
			this._usedCombatResourceObsoletes.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(17, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Add<int>(4, 17, elementId, 2);
			pData += value.Serialize(pData);
		}

		// Token: 0x060073D3 RID: 29651 RVA: 0x004349C0 File Offset: 0x00432BC0
		[Obsolete("DomainData _usedCombatResourceObsoletes is no longer in use.")]
		private unsafe void SetElement_UsedCombatResourceObsoletes(int elementId, CombatResourcesObsolete value, DataContext context)
		{
			this._usedCombatResourceObsoletes[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(17, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Set<int>(4, 17, elementId, 2);
			pData += value.Serialize(pData);
		}

		// Token: 0x060073D4 RID: 29652 RVA: 0x00434A05 File Offset: 0x00432C05
		[Obsolete("DomainData _usedCombatResourceObsoletes is no longer in use.")]
		private void RemoveElement_UsedCombatResourceObsoletes(int elementId, DataContext context)
		{
			this._usedCombatResourceObsoletes.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(17, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Remove<int>(4, 17, elementId);
		}

		// Token: 0x060073D5 RID: 29653 RVA: 0x00434A33 File Offset: 0x00432C33
		[Obsolete("DomainData _usedCombatResourceObsoletes is no longer in use.")]
		private void ClearUsedCombatResourceObsoletes(DataContext context)
		{
			this._usedCombatResourceObsoletes.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(17, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Clear(4, 17);
		}

		// Token: 0x060073D6 RID: 29654 RVA: 0x00434A60 File Offset: 0x00432C60
		private AvatarElementsGrownDates GetElement_AvatarElementGrowthProgress(int elementId)
		{
			return this._avatarElementGrowthProgress[elementId];
		}

		// Token: 0x060073D7 RID: 29655 RVA: 0x00434A80 File Offset: 0x00432C80
		private bool TryGetElement_AvatarElementGrowthProgress(int elementId, out AvatarElementsGrownDates value)
		{
			return this._avatarElementGrowthProgress.TryGetValue(elementId, out value);
		}

		// Token: 0x060073D8 RID: 29656 RVA: 0x00434AA0 File Offset: 0x00432CA0
		private unsafe void AddElement_AvatarElementGrowthProgress(int elementId, ref AvatarElementsGrownDates value, DataContext context)
		{
			this._avatarElementGrowthProgress.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(18, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Add<int>(4, 18, elementId, 28);
			pData += value.Serialize(pData);
		}

		// Token: 0x060073D9 RID: 29657 RVA: 0x00434AEC File Offset: 0x00432CEC
		private unsafe void SetElement_AvatarElementGrowthProgress(int elementId, ref AvatarElementsGrownDates value, DataContext context)
		{
			this._avatarElementGrowthProgress[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(18, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValueCollection_Set<int>(4, 18, elementId, 28);
			pData += value.Serialize(pData);
		}

		// Token: 0x060073DA RID: 29658 RVA: 0x00434B37 File Offset: 0x00432D37
		private void RemoveElement_AvatarElementGrowthProgress(int elementId, DataContext context)
		{
			this._avatarElementGrowthProgress.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(18, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Remove<int>(4, 18, elementId);
		}

		// Token: 0x060073DB RID: 29659 RVA: 0x00434B65 File Offset: 0x00432D65
		private void ClearAvatarElementGrowthProgress(DataContext context)
		{
			this._avatarElementGrowthProgress.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(18, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.FixedSingleValueCollection_Clear(4, 18);
		}

		// Token: 0x060073DC RID: 29660 RVA: 0x00434B94 File Offset: 0x00432D94
		public string GetTargetedForAssassination()
		{
			return this._targetedForAssassination;
		}

		// Token: 0x060073DD RID: 29661 RVA: 0x00434BAC File Offset: 0x00432DAC
		public unsafe void SetTargetedForAssassination(string value, DataContext context)
		{
			this._targetedForAssassination = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(19, this.DataStates, CharacterDomain.CacheInfluences, context);
			int elementsCount = this._targetedForAssassination.Length;
			int contentSize = 2 * elementsCount;
			byte* pData = OperationAdder.DynamicSingleValue_Set(4, 19, contentSize);
			string targetedForAssassination = this._targetedForAssassination;
			char* ptr;
			if (targetedForAssassination == null)
			{
				ptr = null;
			}
			else
			{
				fixed (char* ptr2 = targetedForAssassination.GetPinnableReference())
				{
					ptr = ptr2;
				}
			}
			char* pChar = ptr;
			for (int i = 0; i < elementsCount; i++)
			{
				*(short*)(pData + (IntPtr)i * 2) = (short)pChar[i];
			}
			char* ptr2 = null;
		}

		// Token: 0x060073DE RID: 29662 RVA: 0x00434C34 File Offset: 0x00432E34
		private PrioritizedActionWrapper GetElement_PrioritizedActions(int elementId)
		{
			return this._prioritizedActions[elementId];
		}

		// Token: 0x060073DF RID: 29663 RVA: 0x00434C54 File Offset: 0x00432E54
		private bool TryGetElement_PrioritizedActions(int elementId, out PrioritizedActionWrapper value)
		{
			return this._prioritizedActions.TryGetValue(elementId, out value);
		}

		// Token: 0x060073E0 RID: 29664 RVA: 0x00434C74 File Offset: 0x00432E74
		private unsafe void AddElement_PrioritizedActions(int elementId, PrioritizedActionWrapper value, DataContext context)
		{
			this._prioritizedActions.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(20, this.DataStates, CharacterDomain.CacheInfluences, context);
			bool flag = value != null;
			if (flag)
			{
				int contentSize = value.GetSerializedSize();
				byte* pData = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 20, elementId, contentSize);
				pData += value.Serialize(pData);
			}
			else
			{
				OperationAdder.DynamicSingleValueCollection_Add<int>(4, 20, elementId, 0);
			}
		}

		// Token: 0x060073E1 RID: 29665 RVA: 0x00434CD8 File Offset: 0x00432ED8
		private unsafe void SetElement_PrioritizedActions(int elementId, PrioritizedActionWrapper value, DataContext context)
		{
			this._prioritizedActions[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(20, this.DataStates, CharacterDomain.CacheInfluences, context);
			bool flag = value != null;
			if (flag)
			{
				int contentSize = value.GetSerializedSize();
				byte* pData = OperationAdder.DynamicSingleValueCollection_Set<int>(4, 20, elementId, contentSize);
				pData += value.Serialize(pData);
			}
			else
			{
				OperationAdder.DynamicSingleValueCollection_Set<int>(4, 20, elementId, 0);
			}
		}

		// Token: 0x060073E2 RID: 29666 RVA: 0x00434D3B File Offset: 0x00432F3B
		private void RemoveElement_PrioritizedActions(int elementId, DataContext context)
		{
			this._prioritizedActions.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(20, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Remove<int>(4, 20, elementId);
		}

		// Token: 0x060073E3 RID: 29667 RVA: 0x00434D69 File Offset: 0x00432F69
		private void ClearPrioritizedActions(DataContext context)
		{
			this._prioritizedActions.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(20, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Clear(4, 20);
		}

		// Token: 0x060073E4 RID: 29668 RVA: 0x00434D98 File Offset: 0x00432F98
		public CrossAreaMoveInfo GetElement_CrossAreaMoveInfos(int elementId)
		{
			return this._crossAreaMoveInfos[elementId];
		}

		// Token: 0x060073E5 RID: 29669 RVA: 0x00434DB8 File Offset: 0x00432FB8
		public bool TryGetElement_CrossAreaMoveInfos(int elementId, out CrossAreaMoveInfo value)
		{
			return this._crossAreaMoveInfos.TryGetValue(elementId, out value);
		}

		// Token: 0x060073E6 RID: 29670 RVA: 0x00434DD8 File Offset: 0x00432FD8
		private unsafe void AddElement_CrossAreaMoveInfos(int elementId, CrossAreaMoveInfo value, DataContext context)
		{
			this._crossAreaMoveInfos.Add(elementId, value);
			this._modificationsCrossAreaMoveInfos.RecordAdding(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(21, this.DataStates, CharacterDomain.CacheInfluences, context);
			bool flag = value != null;
			if (flag)
			{
				int contentSize = value.GetSerializedSize();
				byte* pData = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 21, elementId, contentSize);
				pData += value.Serialize(pData);
			}
			else
			{
				OperationAdder.DynamicSingleValueCollection_Add<int>(4, 21, elementId, 0);
			}
		}

		// Token: 0x060073E7 RID: 29671 RVA: 0x00434E48 File Offset: 0x00433048
		private unsafe void SetElement_CrossAreaMoveInfos(int elementId, CrossAreaMoveInfo value, DataContext context)
		{
			this._crossAreaMoveInfos[elementId] = value;
			this._modificationsCrossAreaMoveInfos.RecordSetting(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(21, this.DataStates, CharacterDomain.CacheInfluences, context);
			bool flag = value != null;
			if (flag)
			{
				int contentSize = value.GetSerializedSize();
				byte* pData = OperationAdder.DynamicSingleValueCollection_Set<int>(4, 21, elementId, contentSize);
				pData += value.Serialize(pData);
			}
			else
			{
				OperationAdder.DynamicSingleValueCollection_Set<int>(4, 21, elementId, 0);
			}
		}

		// Token: 0x060073E8 RID: 29672 RVA: 0x00434EB8 File Offset: 0x004330B8
		private void RemoveElement_CrossAreaMoveInfos(int elementId, DataContext context)
		{
			this._crossAreaMoveInfos.Remove(elementId);
			this._modificationsCrossAreaMoveInfos.RecordRemoving(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(21, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Remove<int>(4, 21, elementId);
		}

		// Token: 0x060073E9 RID: 29673 RVA: 0x00434EF3 File Offset: 0x004330F3
		private void ClearCrossAreaMoveInfos(DataContext context)
		{
			this._crossAreaMoveInfos.Clear();
			this._modificationsCrossAreaMoveInfos.RecordClearing();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(21, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Clear(4, 21);
		}

		// Token: 0x060073EA RID: 29674 RVA: 0x00434F2C File Offset: 0x0043312C
		private CharacterSet GetElement_OngoingVengeances(int elementId)
		{
			return this._ongoingVengeances[elementId];
		}

		// Token: 0x060073EB RID: 29675 RVA: 0x00434F4C File Offset: 0x0043314C
		private bool TryGetElement_OngoingVengeances(int elementId, out CharacterSet value)
		{
			return this._ongoingVengeances.TryGetValue(elementId, out value);
		}

		// Token: 0x060073EC RID: 29676 RVA: 0x00434F6C File Offset: 0x0043316C
		private unsafe void AddElement_OngoingVengeances(int elementId, CharacterSet value, DataContext context)
		{
			this._ongoingVengeances.Add(elementId, value);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(22, this.DataStates, CharacterDomain.CacheInfluences, context);
			int dataSize = value.GetSerializedSize();
			byte* pData = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 22, elementId, dataSize);
			pData += value.Serialize(pData);
		}

		// Token: 0x060073ED RID: 29677 RVA: 0x00434FBC File Offset: 0x004331BC
		private unsafe void SetElement_OngoingVengeances(int elementId, CharacterSet value, DataContext context)
		{
			this._ongoingVengeances[elementId] = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(22, this.DataStates, CharacterDomain.CacheInfluences, context);
			int dataSize = value.GetSerializedSize();
			byte* pData = OperationAdder.DynamicSingleValueCollection_Set<int>(4, 22, elementId, dataSize);
			pData += value.Serialize(pData);
		}

		// Token: 0x060073EE RID: 29678 RVA: 0x0043500A File Offset: 0x0043320A
		private void RemoveElement_OngoingVengeances(int elementId, DataContext context)
		{
			this._ongoingVengeances.Remove(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(22, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Remove<int>(4, 22, elementId);
		}

		// Token: 0x060073EF RID: 29679 RVA: 0x00435038 File Offset: 0x00433238
		private void ClearOngoingVengeances(DataContext context)
		{
			this._ongoingVengeances.Clear();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(22, this.DataStates, CharacterDomain.CacheInfluences, context);
			OperationAdder.DynamicSingleValueCollection_Clear(4, 22);
		}

		// Token: 0x060073F0 RID: 29680 RVA: 0x00435064 File Offset: 0x00433264
		[Obsolete("DomainData _mournedOthersChars is no longer in use.")]
		public CharacterSet GetMournedOthersChars()
		{
			return this._mournedOthersChars;
		}

		// Token: 0x060073F1 RID: 29681 RVA: 0x0043507C File Offset: 0x0043327C
		[Obsolete("DomainData _mournedOthersChars is no longer in use.")]
		public unsafe void SetMournedOthersChars(CharacterSet value, DataContext context)
		{
			this._mournedOthersChars = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(23, this.DataStates, CharacterDomain.CacheInfluences, context);
			int dataSize = this._mournedOthersChars.GetSerializedSize();
			byte* pData = OperationAdder.DynamicSingleValue_Set(4, 23, dataSize);
			pData += this._mournedOthersChars.Serialize(pData);
		}

		// Token: 0x060073F2 RID: 29682 RVA: 0x004350CC File Offset: 0x004332CC
		private int[] GetPregeneratedCityTownGuards()
		{
			return this._pregeneratedCityTownGuards;
		}

		// Token: 0x060073F3 RID: 29683 RVA: 0x004350E4 File Offset: 0x004332E4
		private unsafe void SetPregeneratedCityTownGuards(int[] value, DataContext context)
		{
			this._pregeneratedCityTownGuards = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(24, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValue_Set(4, 24, 1152);
			for (int i = 0; i < 288; i++)
			{
				*(int*)(pData + (IntPtr)i * 4) = this._pregeneratedCityTownGuards[i];
			}
			pData += 1152;
		}

		// Token: 0x060073F4 RID: 29684 RVA: 0x00435148 File Offset: 0x00433348
		private List<int> GetPregeneratedRandomEnemies()
		{
			return this._pregeneratedRandomEnemies;
		}

		// Token: 0x060073F5 RID: 29685 RVA: 0x00435160 File Offset: 0x00433360
		private unsafe void SetPregeneratedRandomEnemies(List<int> value, DataContext context)
		{
			this._pregeneratedRandomEnemies = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(25, this.DataStates, CharacterDomain.CacheInfluences, context);
			int elementsCount = this._pregeneratedRandomEnemies.Count;
			int contentSize = 4 * elementsCount;
			int dataSize = 2 + contentSize;
			byte* pData = OperationAdder.DynamicSingleValue_Set(4, 25, dataSize);
			*(short*)pData = (short)((ushort)elementsCount);
			pData += 2;
			for (int i = 0; i < elementsCount; i++)
			{
				*(int*)(pData + (IntPtr)i * 4) = this._pregeneratedRandomEnemies[i];
			}
			pData += contentSize;
		}

		// Token: 0x060073F6 RID: 29686 RVA: 0x004351E0 File Offset: 0x004333E0
		public Location GetForceRebelLocation()
		{
			return this._forceRebelLocation;
		}

		// Token: 0x060073F7 RID: 29687 RVA: 0x004351F8 File Offset: 0x004333F8
		private void SetForceRebelLocation(Location value, DataContext context)
		{
			this._forceRebelLocation = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(26, this.DataStates, CharacterDomain.CacheInfluences, context);
		}

		// Token: 0x060073F8 RID: 29688 RVA: 0x00435218 File Offset: 0x00433418
		public Location GetForceKindLocation()
		{
			return this._forceKindLocation;
		}

		// Token: 0x060073F9 RID: 29689 RVA: 0x00435230 File Offset: 0x00433430
		private void SetForceKindLocation(Location value, DataContext context)
		{
			this._forceKindLocation = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(27, this.DataStates, CharacterDomain.CacheInfluences, context);
		}

		// Token: 0x060073FA RID: 29690 RVA: 0x00435250 File Offset: 0x00433450
		public int GetAvoidDeathCharId()
		{
			return this._avoidDeathCharId;
		}

		// Token: 0x060073FB RID: 29691 RVA: 0x00435268 File Offset: 0x00433468
		private unsafe void SetAvoidDeathCharId(int value, DataContext context)
		{
			this._avoidDeathCharId = value;
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(28, this.DataStates, CharacterDomain.CacheInfluences, context);
			byte* pData = OperationAdder.FixedSingleValue_Set(4, 28, 4);
			*(int*)pData = this._avoidDeathCharId;
			pData += 4;
		}

		// Token: 0x060073FC RID: 29692 RVA: 0x004352A8 File Offset: 0x004334A8
		public CharacterList GetElement_SubscriberOrders(int elementId)
		{
			return this._subscriberOrders[elementId];
		}

		// Token: 0x060073FD RID: 29693 RVA: 0x004352C8 File Offset: 0x004334C8
		public bool TryGetElement_SubscriberOrders(int elementId, out CharacterList value)
		{
			return this._subscriberOrders.TryGetValue(elementId, out value);
		}

		// Token: 0x060073FE RID: 29694 RVA: 0x004352E7 File Offset: 0x004334E7
		private void AddElement_SubscriberOrders(int elementId, CharacterList value, DataContext context)
		{
			this._subscriberOrders.Add(elementId, value);
			this._modificationsSubscriberOrders.RecordAdding(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(29, this.DataStates, CharacterDomain.CacheInfluences, context);
		}

		// Token: 0x060073FF RID: 29695 RVA: 0x00435319 File Offset: 0x00433519
		private void SetElement_SubscriberOrders(int elementId, CharacterList value, DataContext context)
		{
			this._subscriberOrders[elementId] = value;
			this._modificationsSubscriberOrders.RecordSetting(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(29, this.DataStates, CharacterDomain.CacheInfluences, context);
		}

		// Token: 0x06007400 RID: 29696 RVA: 0x0043534B File Offset: 0x0043354B
		private void RemoveElement_SubscriberOrders(int elementId, DataContext context)
		{
			this._subscriberOrders.Remove(elementId);
			this._modificationsSubscriberOrders.RecordRemoving(elementId);
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(29, this.DataStates, CharacterDomain.CacheInfluences, context);
		}

		// Token: 0x06007401 RID: 29697 RVA: 0x0043537C File Offset: 0x0043357C
		private void ClearSubscriberOrders(DataContext context)
		{
			this._subscriberOrders.Clear();
			this._modificationsSubscriberOrders.RecordClearing();
			BaseGameDataDomain.SetModifiedAndInvalidateInfluencedCache(29, this.DataStates, CharacterDomain.CacheInfluences, context);
		}

		// Token: 0x06007402 RID: 29698 RVA: 0x004353AB File Offset: 0x004335AB
		public override void OnInitializeGameDataModule()
		{
			this.InitializeOnInitializeGameDataModule();
		}

		// Token: 0x06007403 RID: 29699 RVA: 0x004353B8 File Offset: 0x004335B8
		public unsafe override void OnEnterNewWorld()
		{
			this.InitializeOnEnterNewWorld();
			this.InitializeInternalDataOfCollections();
			foreach (KeyValuePair<int, Character> entry in this._objects)
			{
				int objectId = entry.Key;
				Character instance = entry.Value;
				byte* pData = OperationAdder.DynamicObjectCollection_Add<int>(4, 0, objectId, instance.GetSerializedSize());
				instance.Serialize(pData);
			}
			byte* pData2 = OperationAdder.FixedSingleValue_Set(4, 1, 4);
			*(int*)pData2 = this._nextObjectId;
			pData2 += 4;
			foreach (KeyValuePair<int, DeadCharacter> entry2 in this._deadCharacters)
			{
				int elementId = entry2.Key;
				DeadCharacter value = entry2.Value;
				bool flag = value != null;
				if (flag)
				{
					int contentSize = value.GetSerializedSize();
					byte* pData3 = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 2, elementId, contentSize);
					pData3 += value.Serialize(pData3);
				}
				else
				{
					OperationAdder.DynamicSingleValueCollection_Add<int>(4, 2, elementId, 0);
				}
			}
			foreach (KeyValuePair<int, DeadCharDeletionState> entry3 in this._deadCharDeletionStates)
			{
				int elementId2 = entry3.Key;
				DeadCharDeletionState value2 = entry3.Value;
				byte* pData4 = OperationAdder.FixedSingleValueCollection_Add<int>(4, 3, elementId2, 2);
				pData4 += value2.Serialize(pData4);
			}
			foreach (KeyValuePair<IntPair, VoidValue> entry4 in this._recentDeadCharacters)
			{
				IntPair elementId3 = entry4.Key;
				VoidValue value3 = entry4.Value;
				byte* pData5 = OperationAdder.FixedSingleValueCollection_Add<IntPair>(4, 4, elementId3, 0);
				pData5 += value3.Serialize(pData5);
			}
			foreach (KeyValuePair<IntPair, VoidValue> entry5 in this._waitingReincarnationChars)
			{
				IntPair elementId4 = entry5.Key;
				VoidValue value4 = entry5.Value;
				byte* pData6 = OperationAdder.FixedSingleValueCollection_Add<IntPair>(4, 5, elementId4, 0);
				pData6 += value4.Serialize(pData6);
			}
			foreach (KeyValuePair<int, Grave> entry6 in this._graves)
			{
				int objectId2 = entry6.Key;
				Grave instance2 = entry6.Value;
				byte* pData7 = OperationAdder.DynamicObjectCollection_Add<int>(4, 6, objectId2, instance2.GetSerializedSize());
				instance2.Serialize(pData7);
			}
			foreach (KeyValuePair<int, PregnantState> entry7 in this._pregnantStates)
			{
				int elementId5 = entry7.Key;
				PregnantState value5 = entry7.Value;
				bool flag2 = value5 != null;
				if (flag2)
				{
					int contentSize2 = value5.GetSerializedSize();
					byte* pData8 = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 7, elementId5, contentSize2);
					pData8 += value5.Serialize(pData8);
				}
				else
				{
					OperationAdder.DynamicSingleValueCollection_Add<int>(4, 7, elementId5, 0);
				}
			}
			foreach (KeyValuePair<int, int> entry8 in this._pregnancyLockEndDates)
			{
				int elementId6 = entry8.Key;
				int value6 = entry8.Value;
				byte* pData9 = OperationAdder.FixedSingleValueCollection_Add<int>(4, 8, elementId6, 4);
				*(int*)pData9 = value6;
				pData9 += 4;
			}
			int dataSize = this._unguardedChars.GetSerializedSize();
			byte* pData10 = OperationAdder.DynamicSingleValue_Set(4, 9, dataSize);
			pData10 += this._unguardedChars.Serialize(pData10);
			foreach (KeyValuePair<int, KidnappedCharacterList> entry9 in this._kidnappedChars)
			{
				int elementId7 = entry9.Key;
				KidnappedCharacterList value7 = entry9.Value;
				bool flag3 = value7 != null;
				if (flag3)
				{
					int contentSize3 = value7.GetSerializedSize();
					byte* pData11 = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 10, elementId7, contentSize3);
					pData11 += value7.Serialize(pData11);
				}
				else
				{
					OperationAdder.DynamicSingleValueCollection_Add<int>(4, 10, elementId7, 0);
				}
			}
			foreach (KeyValuePair<RelationKey, RelatedCharacter> entry10 in this._relations)
			{
				RelationKey elementId8 = entry10.Key;
				RelatedCharacter value8 = entry10.Value;
				byte* pData12 = OperationAdder.FixedSingleValueCollection_Add<RelationKey>(4, 11, elementId8, 8);
				pData12 += value8.Serialize(pData12);
			}
			foreach (KeyValuePair<ParentAndChild, int> entry11 in this._actualBloodParents)
			{
				ParentAndChild elementId9 = entry11.Key;
				int value9 = entry11.Value;
				byte* pData13 = OperationAdder.FixedSingleValueCollection_Add<ParentAndChild>(4, 12, elementId9, 4);
				*(int*)pData13 = value9;
				pData13 += 4;
			}
			foreach (KeyValuePair<int, CharacterSet> entry12 in this._characterGroups)
			{
				int elementId10 = entry12.Key;
				CharacterSet value10 = entry12.Value;
				int dataSize2 = value10.GetSerializedSize();
				byte* pData14 = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 13, elementId10, dataSize2);
				pData14 += value10.Serialize(pData14);
			}
			foreach (KeyValuePair<int, int> entry13 in this._joinGroupDates)
			{
				int elementId11 = entry13.Key;
				int value11 = entry13.Value;
				byte* pData15 = OperationAdder.FixedSingleValueCollection_Add<int>(4, 14, elementId11, 4);
				*(int*)pData15 = value11;
				pData15 += 4;
			}
			foreach (KeyValuePair<int, Debts> entry14 in this._debtsToTaiwu)
			{
				int elementId12 = entry14.Key;
				Debts value12 = entry14.Value;
				bool flag4 = value12 != null;
				if (flag4)
				{
					int contentSize4 = value12.GetSerializedSize();
					byte* pData16 = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 15, elementId12, contentSize4);
					pData16 += value12.Serialize(pData16);
				}
				else
				{
					OperationAdder.DynamicSingleValueCollection_Add<int>(4, 15, elementId12, 0);
				}
			}
			foreach (KeyValuePair<int, GameData.Utilities.ShortList> entry15 in this._soldLibrarySkillBooks)
			{
				int elementId13 = entry15.Key;
				GameData.Utilities.ShortList value13 = entry15.Value;
				int dataSize3 = value13.GetSerializedSize();
				byte* pData17 = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 16, elementId13, dataSize3);
				pData17 += value13.Serialize(pData17);
			}
			foreach (KeyValuePair<int, CombatResourcesObsolete> entry16 in this._usedCombatResourceObsoletes)
			{
				int elementId14 = entry16.Key;
				CombatResourcesObsolete value14 = entry16.Value;
				byte* pData18 = OperationAdder.FixedSingleValueCollection_Add<int>(4, 17, elementId14, 2);
				pData18 += value14.Serialize(pData18);
			}
			foreach (KeyValuePair<int, AvatarElementsGrownDates> entry17 in this._avatarElementGrowthProgress)
			{
				int elementId15 = entry17.Key;
				AvatarElementsGrownDates value15 = entry17.Value;
				byte* pData19 = OperationAdder.FixedSingleValueCollection_Add<int>(4, 18, elementId15, 28);
				pData19 += value15.Serialize(pData19);
			}
			int elementsCount = this._targetedForAssassination.Length;
			int contentSize5 = 2 * elementsCount;
			byte* pData20 = OperationAdder.DynamicSingleValue_Set(4, 19, contentSize5);
			string targetedForAssassination = this._targetedForAssassination;
			char* ptr;
			if (targetedForAssassination == null)
			{
				ptr = null;
			}
			else
			{
				fixed (char* ptr2 = targetedForAssassination.GetPinnableReference())
				{
					ptr = ptr2;
				}
			}
			char* pChar = ptr;
			for (int i = 0; i < elementsCount; i++)
			{
				*(short*)(pData20 + (IntPtr)i * 2) = (short)pChar[i];
			}
			char* ptr2 = null;
			foreach (KeyValuePair<int, PrioritizedActionWrapper> entry18 in this._prioritizedActions)
			{
				int elementId16 = entry18.Key;
				PrioritizedActionWrapper value16 = entry18.Value;
				bool flag5 = value16 != null;
				if (flag5)
				{
					int contentSize6 = value16.GetSerializedSize();
					byte* pData21 = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 20, elementId16, contentSize6);
					pData21 += value16.Serialize(pData21);
				}
				else
				{
					OperationAdder.DynamicSingleValueCollection_Add<int>(4, 20, elementId16, 0);
				}
			}
			foreach (KeyValuePair<int, CrossAreaMoveInfo> entry19 in this._crossAreaMoveInfos)
			{
				int elementId17 = entry19.Key;
				CrossAreaMoveInfo value17 = entry19.Value;
				bool flag6 = value17 != null;
				if (flag6)
				{
					int contentSize7 = value17.GetSerializedSize();
					byte* pData22 = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 21, elementId17, contentSize7);
					pData22 += value17.Serialize(pData22);
				}
				else
				{
					OperationAdder.DynamicSingleValueCollection_Add<int>(4, 21, elementId17, 0);
				}
			}
			foreach (KeyValuePair<int, CharacterSet> entry20 in this._ongoingVengeances)
			{
				int elementId18 = entry20.Key;
				CharacterSet value18 = entry20.Value;
				int dataSize4 = value18.GetSerializedSize();
				byte* pData23 = OperationAdder.DynamicSingleValueCollection_Add<int>(4, 22, elementId18, dataSize4);
				pData23 += value18.Serialize(pData23);
			}
			int dataSize5 = this._mournedOthersChars.GetSerializedSize();
			byte* pData24 = OperationAdder.DynamicSingleValue_Set(4, 23, dataSize5);
			pData24 += this._mournedOthersChars.Serialize(pData24);
			byte* pData25 = OperationAdder.FixedSingleValue_Set(4, 24, 1152);
			for (int j = 0; j < 288; j++)
			{
				*(int*)(pData25 + (IntPtr)j * 4) = this._pregeneratedCityTownGuards[j];
			}
			pData25 += 1152;
			int elementsCount2 = this._pregeneratedRandomEnemies.Count;
			int contentSize8 = 4 * elementsCount2;
			int dataSize6 = 2 + contentSize8;
			byte* pData26 = OperationAdder.DynamicSingleValue_Set(4, 25, dataSize6);
			*(short*)pData26 = (short)((ushort)elementsCount2);
			pData26 += 2;
			for (int k = 0; k < elementsCount2; k++)
			{
				*(int*)(pData26 + (IntPtr)k * 4) = this._pregeneratedRandomEnemies[k];
			}
			pData26 += contentSize8;
			byte* pData27 = OperationAdder.FixedSingleValue_Set(4, 28, 4);
			*(int*)pData27 = this._avoidDeathCharId;
			pData27 += 4;
		}

		// Token: 0x06007404 RID: 29700 RVA: 0x00435F00 File Offset: 0x00434100
		public override void OnLoadWorld()
		{
			this._pendingLoadingOperationIds = new Queue<uint>();
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicObjectCollection_GetAllObjects(4, 0));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.FixedSingleValue_Get(4, 1));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValueCollection_GetAll(4, 2));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.FixedSingleValueCollection_GetAll(4, 3));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.FixedSingleValueCollection_GetAll(4, 4));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.FixedSingleValueCollection_GetAll(4, 5));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicObjectCollection_GetAllObjects(4, 6));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValueCollection_GetAll(4, 7));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.FixedSingleValueCollection_GetAll(4, 8));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValue_Get(4, 9));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValueCollection_GetAll(4, 10));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.FixedSingleValueCollection_GetAll(4, 11));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.FixedSingleValueCollection_GetAll(4, 12));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValueCollection_GetAll(4, 13));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.FixedSingleValueCollection_GetAll(4, 14));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValueCollection_GetAll(4, 15));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValueCollection_GetAll(4, 16));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.FixedSingleValueCollection_GetAll(4, 17));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.FixedSingleValueCollection_GetAll(4, 18));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValue_Get(4, 19));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValueCollection_GetAll(4, 20));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValueCollection_GetAll(4, 21));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValueCollection_GetAll(4, 22));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValue_Get(4, 23));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.FixedSingleValue_Get(4, 24));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.DynamicSingleValue_Get(4, 25));
			this._pendingLoadingOperationIds.Enqueue(OperationAdder.FixedSingleValue_Get(4, 28));
		}

		// Token: 0x06007405 RID: 29701 RVA: 0x0043612C File Offset: 0x0043432C
		public override int GetData(ushort dataId, ulong subId0, uint subId1, RawDataPool dataPool, bool resetModified)
		{
			int result;
			switch (dataId)
			{
			case 0:
				result = this.GetElementField_Objects((int)subId0, (ushort)subId1, dataPool, resetModified);
				break;
			case 1:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 2:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 3:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 4:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 5:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 6:
				result = this.GetElementField_Graves((int)subId0, (ushort)subId1, dataPool, resetModified);
				break;
			case 7:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 8:
				if (resetModified)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 8);
					this._modificationsPregnancyLockEndDates.Reset();
				}
				result = Serializer.SerializeModifications<int>(this._pregnancyLockEndDates, dataPool);
				break;
			case 9:
				if (resetModified)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 9);
				}
				result = Serializer.Serialize(this._unguardedChars, dataPool);
				break;
			case 10:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 11:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 12:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 13:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 14:
				if (resetModified)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 14);
					this._modificationsJoinGroupDates.Reset();
				}
				result = Serializer.SerializeModifications<int>(this._joinGroupDates, dataPool);
				break;
			case 15:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 16:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 17:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 18:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 19:
				if (resetModified)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 19);
				}
				result = Serializer.Serialize(this._targetedForAssassination, dataPool);
				break;
			case 20:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 21:
				if (resetModified)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 21);
					this._modificationsCrossAreaMoveInfos.Reset();
				}
				result = Serializer.SerializeModifications<int>(this._crossAreaMoveInfos, dataPool);
				break;
			case 22:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 23:
				if (resetModified)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 23);
				}
				result = Serializer.Serialize(this._mournedOthersChars, dataPool);
				break;
			case 24:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 25:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to get value of dataId: ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 26:
				if (resetModified)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 26);
				}
				result = Serializer.Serialize(this._forceRebelLocation, dataPool);
				break;
			case 27:
				if (resetModified)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 27);
				}
				result = Serializer.Serialize(this._forceKindLocation, dataPool);
				break;
			case 28:
				if (resetModified)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 28);
				}
				result = Serializer.Serialize(this._avoidDeathCharId, dataPool);
				break;
			case 29:
				if (resetModified)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 29);
					this._modificationsSubscriberOrders.Reset();
				}
				result = Serializer.SerializeModifications<int>(this._subscriberOrders, dataPool);
				break;
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(19, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
			return result;
		}

		// Token: 0x06007406 RID: 29702 RVA: 0x0043670C File Offset: 0x0043490C
		public override void SetData(ushort dataId, ulong subId0, uint subId1, int valueOffset, RawDataPool dataPool, DataContext context)
		{
			switch (dataId)
			{
			case 0:
				this.SetElementField_Objects((int)subId0, (ushort)subId1, valueOffset, dataPool, context);
				break;
			case 1:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 2:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 3:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 4:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 5:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 6:
				this.SetElementField_Graves((int)subId0, (ushort)subId1, valueOffset, dataPool, context);
				break;
			case 7:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 8:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 9:
				Serializer.Deserialize(dataPool, valueOffset, ref this._unguardedChars);
				this.SetUnguardedChars(this._unguardedChars, context);
				break;
			case 10:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 11:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 12:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 13:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 14:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 15:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 16:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 17:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 18:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 19:
				Serializer.Deserialize(dataPool, valueOffset, ref this._targetedForAssassination);
				this.SetTargetedForAssassination(this._targetedForAssassination, context);
				break;
			case 20:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 21:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 22:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 23:
				Serializer.Deserialize(dataPool, valueOffset, ref this._mournedOthersChars);
				this.SetMournedOthersChars(this._mournedOthersChars, context);
				break;
			case 24:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 25:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 26:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 27:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 28:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 29:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(33, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to set value of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(19, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
		}

		// Token: 0x06007407 RID: 29703 RVA: 0x00436CD0 File Offset: 0x00434ED0
		public override int CallMethod(Operation operation, RawDataPool argDataPool, RawDataPool returnDataPool, DataContext context)
		{
			int argsOffset = operation.ArgsOffset;
			int result;
			switch (operation.MethodId)
			{
			case 0:
			{
				int argsCount = operation.ArgsCount;
				int num = argsCount;
				if (num != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				ProtagonistCreationInfo info = null;
				argsOffset += Serializer.DeserializeDefault<ProtagonistCreationInfo>(argDataPool, argsOffset, ref info);
				int returnValue = this.CreateProtagonist(context, info);
				result = Serializer.Serialize(returnValue, returnDataPool);
				break;
			}
			case 1:
			{
				int argsCount2 = operation.ArgsCount;
				int num2 = argsCount2;
				if (num2 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId);
				RelatedCharactersForRelations returnValue2 = this.GetRelatedCharactersForRelations(charId);
				result = Serializer.Serialize(returnValue2, returnDataPool);
				break;
			}
			case 2:
			{
				int argsCount3 = operation.ArgsCount;
				int num3 = argsCount3;
				if (num3 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId2);
				int relatedCharId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref relatedCharId);
				this.TryCreateRelation(context, charId2, relatedCharId);
				result = -1;
				break;
			}
			case 3:
			{
				int argsCount4 = operation.ArgsCount;
				int num4 = argsCount4;
				if (num4 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId3);
				Genealogy returnValue3 = this.GetGenealogy(charId3);
				result = Serializer.Serialize(returnValue3, returnDataPool);
				break;
			}
			case 4:
			{
				int argsCount5 = operation.ArgsCount;
				int num5 = argsCount5;
				if (num5 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int customSurnameId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref customSurnameId);
				short surnameId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref surnameId);
				sbyte gender = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref gender);
				FullName returnValue4 = this.GenerateRandomHanName(context, customSurnameId, surnameId, gender);
				result = Serializer.Serialize(returnValue4, returnDataPool);
				break;
			}
			case 5:
			{
				int argsCount6 = operation.ArgsCount;
				int num6 = argsCount6;
				if (num6 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				sbyte gender2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref gender2);
				FullName returnValue5 = this.GenerateRandomZangName(context, gender2);
				result = Serializer.Serialize(returnValue5, returnDataPool);
				break;
			}
			case 6:
			{
				int argsCount7 = operation.ArgsCount;
				int num7 = argsCount7;
				if (num7 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				sbyte gender3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref gender3);
				FullName parentName = default(FullName);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref parentName);
				FullName returnValue6 = this.GenerateRandomChildName(context, gender3, parentName);
				result = Serializer.Serialize(returnValue6, returnDataPool);
				break;
			}
			case 7:
			{
				int argsCount8 = operation.ArgsCount;
				int num8 = argsCount8;
				if (num8 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIds = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIds);
				List<NameRelatedData> returnValue7 = this.GetNameRelatedDataList(charIds);
				result = Serializer.Serialize(returnValue7, returnDataPool);
				break;
			}
			case 8:
			{
				int argsCount9 = operation.ArgsCount;
				int num9 = argsCount9;
				if (num9 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId4 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId4);
				NameRelatedData returnValue8 = this.GetNameRelatedData(charId4);
				result = Serializer.Serialize(returnValue8, returnDataPool);
				break;
			}
			case 9:
			{
				int argsCount10 = operation.ArgsCount;
				int num10 = argsCount10;
				if (num10 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIds2 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIds2);
				List<NameAndLifeRelatedData> returnValue9 = this.GetNameAndLifeRelatedDataList(charIds2);
				result = Serializer.Serialize(returnValue9, returnDataPool);
				break;
			}
			case 10:
			{
				int argsCount11 = operation.ArgsCount;
				int num11 = argsCount11;
				if (num11 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId5 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId5);
				NameAndLifeRelatedData returnValue10 = this.GetNameAndLifeRelatedData(charId5);
				result = Serializer.Serialize(returnValue10, returnDataPool);
				break;
			}
			case 11:
			{
				int argsCount12 = operation.ArgsCount;
				int num12 = argsCount12;
				if (num12 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId6 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId6);
				int relatedCharId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref relatedCharId2);
				short returnValue11 = this.GetFavorability(charId6, relatedCharId2);
				result = Serializer.Serialize(returnValue11, returnDataPool);
				break;
			}
			case 12:
			{
				int argsCount13 = operation.ArgsCount;
				int num13 = argsCount13;
				if (num13 != 0)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<List<CharacterDisplayData>> returnValue12 = this.GmCmd_GetAllGroupMembers();
				result = Serializer.Serialize(returnValue12, returnDataPool);
				break;
			}
			case 13:
			{
				int argsCount14 = operation.ArgsCount;
				int num14 = argsCount14;
				if (num14 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId7 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId7);
				sbyte itemType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemType);
				int times = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref times);
				this.GmCmd_GenerateRandomRefinedItemToCharacter(context, charId7, itemType, times);
				result = -1;
				break;
			}
			case 14:
			{
				int argsCount15 = operation.ArgsCount;
				int num15 = argsCount15;
				if (num15 != 4)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId8 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId8);
				bool isInnerInjury = false;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref isInnerInjury);
				sbyte bodyPartType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref bodyPartType);
				sbyte delta = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref delta);
				this.GmCmd_ChangeInjury(context, charId8, isInnerInjury, bodyPartType, delta);
				result = -1;
				break;
			}
			case 15:
			{
				int argsCount16 = operation.ArgsCount;
				int num16 = argsCount16;
				if (num16 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId9 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId9);
				sbyte poisonType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref poisonType);
				int changeValue = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref changeValue);
				this.GmCmd_ChangePoisonByType(context, charId9, poisonType, changeValue);
				result = -1;
				break;
			}
			case 16:
			{
				int argsCount17 = operation.ArgsCount;
				int num17 = argsCount17;
				if (num17 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId10 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId10);
				short skillTemplateId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref skillTemplateId);
				this.GmCmd_ForgetCombatSkill(context, charId10, skillTemplateId);
				result = -1;
				break;
			}
			case 17:
			{
				int argsCount18 = operation.ArgsCount;
				int num18 = argsCount18;
				if (num18 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId11 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId11);
				List<short> skillTemplateIdList = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref skillTemplateIdList);
				this.GmCmd_RevokeCombatSkill(context, charId11, skillTemplateIdList);
				result = -1;
				break;
			}
			case 18:
			{
				int argsCount19 = operation.ArgsCount;
				int num19 = argsCount19;
				if (num19 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId12 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId12);
				List<LifeSkillItem> learnedLifeSkills = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref learnedLifeSkills);
				this.GmCmd_SetLearnedLifeSkills(context, charId12, learnedLifeSkills);
				result = -1;
				break;
			}
			case 19:
				switch (operation.ArgsCount)
				{
				case 2:
				{
					short colorId = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref colorId);
					short partId = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref partId);
					this.GmCmd_GetCricket(context, colorId, partId, -1, 0, 0);
					result = -1;
					break;
				}
				case 3:
				{
					short colorId2 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref colorId2);
					short partId2 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref partId2);
					int grade = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref grade);
					this.GmCmd_GetCricket(context, colorId2, partId2, grade, 0, 0);
					result = -1;
					break;
				}
				case 4:
				{
					short colorId3 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref colorId3);
					short partId3 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref partId3);
					int grade2 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref grade2);
					short winsCount = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref winsCount);
					this.GmCmd_GetCricket(context, colorId3, partId3, grade2, winsCount, 0);
					result = -1;
					break;
				}
				case 5:
				{
					short colorId4 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref colorId4);
					short partId4 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref partId4);
					int grade3 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref grade3);
					short winsCount2 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref winsCount2);
					short lossesCount = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref lossesCount);
					this.GmCmd_GetCricket(context, colorId4, partId4, grade3, winsCount2, lossesCount);
					result = -1;
					break;
				}
				default:
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				}
				break;
			case 20:
			{
				int argsCount20 = operation.ArgsCount;
				int num20 = argsCount20;
				if (num20 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId13 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId13);
				int relatedCharId3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref relatedCharId3);
				ushort addingType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref addingType);
				this.GmCmd_AddRelation(context, charId13, relatedCharId3, addingType);
				result = -1;
				break;
			}
			case 21:
			{
				int argsCount21 = operation.ArgsCount;
				int num21 = argsCount21;
				if (num21 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId14 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId14);
				List<int> returnValue13 = this.GetGroupSet(context, charId14);
				result = Serializer.Serialize(returnValue13, returnDataPool);
				break;
			}
			case 22:
			{
				int argsCount22 = operation.ArgsCount;
				int num22 = argsCount22;
				if (num22 != 4)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int srcCharId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref srcCharId);
				int destCharId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref destCharId);
				ResourceInts resources = default(ResourceInts);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref resources);
				bool checkFavorability = false;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref checkFavorability);
				this.TransferResourcesWithDebt(context, srcCharId, destCharId, resources, checkFavorability);
				result = -1;
				break;
			}
			case 23:
			{
				int argsCount23 = operation.ArgsCount;
				int num23 = argsCount23;
				if (num23 != 5)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int srcCharId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref srcCharId2);
				int destCharId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref destCharId2);
				ItemKey itemKey = default(ItemKey);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemKey);
				int amount = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref amount);
				bool checkFavorability2 = false;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref checkFavorability2);
				this.TransferInventoryItemWithDebt(context, srcCharId2, destCharId2, itemKey, amount, checkFavorability2);
				result = -1;
				break;
			}
			case 24:
			{
				int argsCount24 = operation.ArgsCount;
				int num24 = argsCount24;
				if (num24 != 4)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId15 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId15);
				sbyte srcSlot = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref srcSlot);
				sbyte destSlot = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref destSlot);
				ItemKey srcItemKey = default(ItemKey);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref srcItemKey);
				this.ChangeEquipment(context, charId15, srcSlot, destSlot, srcItemKey);
				result = -1;
				break;
			}
			case 25:
			{
				int argsCount25 = operation.ArgsCount;
				int num25 = argsCount25;
				if (num25 != 4)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId16 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId16);
				sbyte itemType2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemType2);
				short templateId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref templateId);
				int amount2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref amount2);
				this.CreateInventoryItem(context, charId16, itemType2, templateId, amount2);
				result = -1;
				break;
			}
			case 26:
			{
				int argsCount26 = operation.ArgsCount;
				int num26 = argsCount26;
				if (num26 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId17 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId17);
				short itemSubType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemSubType);
				List<ItemDisplayData> returnValue14 = this.GetInventoryItems(charId17, itemSubType);
				result = Serializer.Serialize(returnValue14, returnDataPool);
				break;
			}
			case 27:
			{
				int argsCount27 = operation.ArgsCount;
				int num27 = argsCount27;
				if (num27 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId18 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId18);
				List<ItemDisplayData> returnValue15 = this.GetAllInventoryItems(charId18);
				result = Serializer.Serialize(returnValue15, returnDataPool);
				break;
			}
			case 28:
			{
				int argsCount28 = operation.ArgsCount;
				int num28 = argsCount28;
				if (num28 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId19 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId19);
				sbyte itemType3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemType3);
				short templateId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref templateId2);
				int returnValue16 = this.GetInventoryItemAmount(charId19, itemType3, templateId2);
				result = Serializer.Serialize(returnValue16, returnDataPool);
				break;
			}
			case 29:
			{
				int argsCount29 = operation.ArgsCount;
				int num29 = argsCount29;
				if (num29 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId20 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId20);
				List<ItemDisplayData> returnValue17 = this.GetAllEquipmentItems(charId20);
				result = Serializer.Serialize(returnValue17, returnDataPool);
				break;
			}
			case 30:
			{
				int argsCount30 = operation.ArgsCount;
				int num30 = argsCount30;
				if (num30 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId21 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId21);
				ItemKey itemKey2 = default(ItemKey);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemKey2);
				ItemDisplayData returnValue18 = this.GetInventoryItemDisplayData(charId21, itemKey2);
				result = Serializer.Serialize(returnValue18, returnDataPool);
				break;
			}
			case 31:
			{
				int argsCount31 = operation.ArgsCount;
				int num31 = argsCount31;
				if (num31 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId22 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId22);
				ItemKey itemKey3 = default(ItemKey);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemKey3);
				bool returnValue19 = this.InventoryContainsItem(charId22, itemKey3);
				result = Serializer.Serialize(returnValue19, returnDataPool);
				break;
			}
			case 32:
			{
				int argsCount32 = operation.ArgsCount;
				int num32 = argsCount32;
				if (num32 != 2)
				{
					if (num32 != 3)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
						defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					int charId23 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId23);
					ItemKey itemKey4 = default(ItemKey);
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemKey4);
					List<sbyte> targetBodyParts = null;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref targetBodyParts);
					this.AddEatingItem(context, charId23, itemKey4, targetBodyParts);
					result = -1;
				}
				else
				{
					int charId24 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId24);
					ItemKey itemKey5 = default(ItemKey);
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemKey5);
					this.AddEatingItem(context, charId24, itemKey5, null);
					result = -1;
				}
				break;
			}
			case 33:
			{
				int argsCount33 = operation.ArgsCount;
				int num33 = argsCount33;
				if (num33 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId25 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId25);
				sbyte returnValue20 = this.GetCurrMaxEatingSlotsCount(charId25);
				result = Serializer.Serialize(returnValue20, returnDataPool);
				break;
			}
			case 34:
			{
				int argsCount34 = operation.ArgsCount;
				int num34 = argsCount34;
				if (num34 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId26 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId26);
				bool returnValue21 = this.MerchantHasNewGoods(charId26);
				result = Serializer.Serialize(returnValue21, returnDataPool);
				break;
			}
			case 35:
			{
				int argsCount35 = operation.ArgsCount;
				int num35 = argsCount35;
				if (num35 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId27 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId27);
				int kidnappedCharId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref kidnappedCharId);
				ItemKey ropeItemKey = default(ItemKey);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref ropeItemKey);
				this.AddKidnappedCharacter(context, charId27, kidnappedCharId, ropeItemKey);
				result = -1;
				break;
			}
			case 36:
			{
				int argsCount36 = operation.ArgsCount;
				int num36 = argsCount36;
				if (num36 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int targetKidnapperId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref targetKidnapperId);
				int sourceKidnapperId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref sourceKidnapperId);
				KidnappedCharacterList kidnappedCharsToTransfer = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref kidnappedCharsToTransfer);
				this.TransferKidnappedCharacters(context, targetKidnapperId, sourceKidnapperId, kidnappedCharsToTransfer);
				result = -1;
				break;
			}
			case 37:
			{
				int argsCount37 = operation.ArgsCount;
				int num37 = argsCount37;
				if (num37 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int kidnapperId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref kidnapperId);
				int kidnappedCharId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref kidnappedCharId2);
				ItemKey newRopeKey = default(ItemKey);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref newRopeKey);
				this.ChangeKidnappedCharacterRope(context, kidnapperId, kidnappedCharId2, newRopeKey);
				result = -1;
				break;
			}
			case 38:
			{
				int argsCount38 = operation.ArgsCount;
				int num38 = argsCount38;
				if (num38 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId28 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId28);
				int returnValue22 = this.GetKidnapMaxSlotCount(charId28);
				result = Serializer.Serialize(returnValue22, returnDataPool);
				break;
			}
			case 39:
			{
				int argsCount39 = operation.ArgsCount;
				int num39 = argsCount39;
				if (num39 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int targetKidnapperId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref targetKidnapperId2);
				int sourceKidnapperId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref sourceKidnapperId2);
				KidnappedCharacter kidnappedCharData = new KidnappedCharacter();
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref kidnappedCharData);
				this.TransferKidnappedCharacter(context, targetKidnapperId2, sourceKidnapperId2, kidnappedCharData);
				result = -1;
				break;
			}
			case 40:
			{
				int argsCount40 = operation.ArgsCount;
				int num40 = argsCount40;
				if (num40 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int kidnappedCharId3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref kidnappedCharId3);
				int kidnapperId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref kidnapperId2);
				bool isEscaped = false;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref isEscaped);
				this.RemoveKidnappedCharacter(context, kidnappedCharId3, kidnapperId2, isEscaped);
				result = -1;
				break;
			}
			case 41:
			{
				int argsCount41 = operation.ArgsCount;
				int num41 = argsCount41;
				if (num41 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId29 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId29);
				short returnValue23 = this.GetDisplayingAge(charId29);
				result = Serializer.Serialize(returnValue23, returnDataPool);
				break;
			}
			case 42:
			{
				int argsCount42 = operation.ArgsCount;
				int num42 = argsCount42;
				if (num42 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId30 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId30);
				MainAttributes returnValue24 = this.GetMainAttributesRecoveries(charId30);
				result = Serializer.Serialize(returnValue24, returnDataPool);
				break;
			}
			case 43:
			{
				int argsCount43 = operation.ArgsCount;
				int num43 = argsCount43;
				if (num43 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId31 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId31);
				sbyte returnValue25 = this.GetInscriptionStatus(charId31);
				result = Serializer.Serialize(returnValue25, returnDataPool);
				break;
			}
			case 44:
			{
				int argsCount44 = operation.ArgsCount;
				int num44 = argsCount44;
				if (num44 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId32 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId32);
				int[] returnValue26 = this.GetCharacterBirthDate(charId32);
				result = Serializer.Serialize(returnValue26, returnDataPool);
				break;
			}
			case 45:
			{
				int argsCount45 = operation.ArgsCount;
				int num45 = argsCount45;
				if (num45 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId33 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId33);
				long returnValue27 = this.GetMaxWorthCanBeLentToTaiwu(charId33);
				result = Serializer.Serialize(returnValue27, returnDataPool);
				break;
			}
			case 46:
			{
				int argsCount46 = operation.ArgsCount;
				int num46 = argsCount46;
				if (num46 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId34 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId34);
				ResourceInts resources2 = default(ResourceInts);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref resources2);
				bool returnValue28 = this.CheckFavorabilityBeforeTransferring(charId34, resources2);
				result = Serializer.Serialize(returnValue28, returnDataPool);
				break;
			}
			case 47:
			{
				int argsCount47 = operation.ArgsCount;
				int num47 = argsCount47;
				if (num47 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId35 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId35);
				short returnValue29 = this.GetClothingDisplayId(charId35);
				result = Serializer.Serialize(returnValue29, returnDataPool);
				break;
			}
			case 48:
			{
				int argsCount48 = operation.ArgsCount;
				int num48 = argsCount48;
				if (num48 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIdList = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIdList);
				List<CharacterDisplayData> returnValue30 = this.GetCharacterDisplayDataList(charIdList);
				result = Serializer.Serialize(returnValue30, returnDataPool);
				break;
			}
			case 49:
			{
				int argsCount49 = operation.ArgsCount;
				int num49 = argsCount49;
				if (num49 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIdList2 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIdList2);
				sbyte lifeSkillType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref lifeSkillType);
				List<short> returnValue31 = this.GetCharacterLifeSkillAttainmentList(charIdList2, lifeSkillType);
				result = Serializer.Serialize(returnValue31, returnDataPool);
				break;
			}
			case 50:
			{
				int argsCount50 = operation.ArgsCount;
				int num50 = argsCount50;
				if (num50 != 0)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<GraveDisplayData> returnValue32 = this.GetTaiwuRelatedGraveDisplayDataList();
				result = Serializer.Serialize(returnValue32, returnDataPool);
				break;
			}
			case 51:
			{
				int argsCount51 = operation.ArgsCount;
				int num51 = argsCount51;
				if (num51 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIdList3 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIdList3);
				List<GraveDisplayData> returnValue33 = this.GetGraveDisplayDataList(charIdList3);
				result = Serializer.Serialize(returnValue33, returnDataPool);
				break;
			}
			case 52:
			{
				int argsCount52 = operation.ArgsCount;
				int num52 = argsCount52;
				if (num52 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIds3 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIds3);
				List<CharacterDisplayDataForRelations> returnValue34 = this.GetCharacterDisplayDataListForRelations(charIds3);
				result = Serializer.Serialize(returnValue34, returnDataPool);
				break;
			}
			case 53:
			{
				int argsCount53 = operation.ArgsCount;
				int num53 = argsCount53;
				if (num53 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId36 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId36);
				KidnappedCharacterList returnValue35 = this.GetSomeoneKidnapCharacters(charId36);
				result = Serializer.Serialize(returnValue35, returnDataPool);
				break;
			}
			case 54:
			{
				int argsCount54 = operation.ArgsCount;
				int num54 = argsCount54;
				if (num54 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId37 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId37);
				CharacterAttributeDisplayData returnValue36 = this.GetCharacterAttributeDisplayData(charId37);
				result = Serializer.Serialize(returnValue36, returnDataPool);
				break;
			}
			case 55:
			{
				int argsCount55 = operation.ArgsCount;
				int num55 = argsCount55;
				if (num55 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId38 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId38);
				CharacterSamsaraData returnValue37 = this.GetCharacterSamsaraData(charId38);
				result = Serializer.Serialize(returnValue37, returnDataPool);
				break;
			}
			case 56:
			{
				int argsCount56 = operation.ArgsCount;
				int num56 = argsCount56;
				if (num56 != 4)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId39 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId39);
				sbyte srcSlot2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref srcSlot2);
				sbyte destSlot2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref destSlot2);
				ItemKey srcItemKey2 = default(ItemKey);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref srcItemKey2);
				CharacterAttributeDisplayData returnValue38 = this.GetEquipmentCompareData(context, charId39, srcSlot2, destSlot2, srcItemKey2);
				result = Serializer.Serialize(returnValue38, returnDataPool);
				break;
			}
			case 57:
			{
				int argsCount57 = operation.ArgsCount;
				int num57 = argsCount57;
				if (num57 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIdList4 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIdList4);
				List<GroupCharDisplayData> returnValue39 = this.GetGroupCharDisplayDataList(context, charIdList4);
				result = Serializer.Serialize(returnValue39, returnDataPool);
				break;
			}
			case 58:
			{
				int argsCount58 = operation.ArgsCount;
				int num58 = argsCount58;
				if (num58 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIdList5 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIdList5);
				List<ValueTuple<int, short>> returnValue40 = this.GetDefeatMarkCountList(charIdList5);
				result = Serializer.Serialize(returnValue40, returnDataPool);
				break;
			}
			case 59:
			{
				int argsCount59 = operation.ArgsCount;
				int num59 = argsCount59;
				if (num59 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId40 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId40);
				sbyte medalType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref medalType);
				int returnValue41 = this.GetFeatureMedalValue(charId40, medalType);
				result = Serializer.Serialize(returnValue41, returnDataPool);
				break;
			}
			case 60:
			{
				int argsCount60 = operation.ArgsCount;
				int num60 = argsCount60;
				if (num60 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIdList6 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIdList6);
				sbyte medalType2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref medalType2);
				List<ValueTuple<int, short>> returnValue42 = this.GetFeatureMedalValueList(charIdList6, medalType2);
				result = Serializer.Serialize(returnValue42, returnDataPool);
				break;
			}
			case 61:
			{
				int argsCount61 = operation.ArgsCount;
				int num61 = argsCount61;
				if (num61 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				short templateId3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref templateId3);
				int returnValue43 = this.GetFixedCharacterIdByTemplateId(templateId3);
				result = Serializer.Serialize(returnValue43, returnDataPool);
				break;
			}
			case 62:
			{
				int argsCount62 = operation.ArgsCount;
				int num62 = argsCount62;
				if (num62 != 6)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charIdA = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIdA);
				int charIdB = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIdB);
				sbyte combatType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref combatType);
				int killBaseChance = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref killBaseChance);
				int kidnapBaseChance = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref kidnapBaseChance);
				int releaseBaseChance = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref releaseBaseChance);
				this.GmCmd_SimulateNpcCombat(context, charIdA, charIdB, combatType, killBaseChance, kidnapBaseChance, releaseBaseChance);
				result = -1;
				break;
			}
			case 63:
			{
				int argsCount63 = operation.ArgsCount;
				int num63 = argsCount63;
				if (num63 != 0)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<CharIdAndName> returnValue44 = this.GmCmd_GetAllCharacterName();
				result = Serializer.Serialize(returnValue44, returnDataPool);
				break;
			}
			case 64:
			{
				int argsCount64 = operation.ArgsCount;
				int num64 = argsCount64;
				if (num64 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int selfCharId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref selfCharId);
				int relatedCharId4 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref relatedCharId4);
				short delta2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref delta2);
				this.GmCmd_ChangeFavorability(context, selfCharId, relatedCharId4, delta2);
				result = -1;
				break;
			}
			case 65:
			{
				int argsCount65 = operation.ArgsCount;
				int num65 = argsCount65;
				if (num65 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId41 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId41);
				this.GmCmd_ClearFameActionRecords(context, charId41);
				result = -1;
				break;
			}
			case 66:
				switch (operation.ArgsCount)
				{
				case 2:
				{
					int charId42 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId42);
					short fameActionId = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref fameActionId);
					this.GmCmd_RecordFameAction(context, charId42, fameActionId, -1, 1);
					result = -1;
					break;
				}
				case 3:
				{
					int charId43 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId43);
					short fameActionId2 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref fameActionId2);
					int targetCharId = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref targetCharId);
					this.GmCmd_RecordFameAction(context, charId43, fameActionId2, targetCharId, 1);
					result = -1;
					break;
				}
				case 4:
				{
					int charId44 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId44);
					short fameActionId3 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref fameActionId3);
					int targetCharId2 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref targetCharId2);
					short fameMultiplier = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref fameMultiplier);
					this.GmCmd_RecordFameAction(context, charId44, fameActionId3, targetCharId2, fameMultiplier);
					result = -1;
					break;
				}
				default:
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				}
				break;
			case 67:
			{
				int argsCount66 = operation.ArgsCount;
				int num66 = argsCount66;
				if (num66 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charCount = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charCount);
				sbyte orgTemplateId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref orgTemplateId);
				bool createHere = false;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref createHere);
				this.GmCmd_CreateRandomIntelligentCharacters(context, charCount, orgTemplateId, createHere);
				result = -1;
				break;
			}
			case 68:
			{
				int argsCount67 = operation.ArgsCount;
				int num67 = argsCount67;
				if (num67 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId45 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId45);
				sbyte orgTemplateId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref orgTemplateId2);
				this.GmCmd_ForceChangeOrganization(context, charId45, orgTemplateId2);
				result = -1;
				break;
			}
			case 69:
			{
				int argsCount68 = operation.ArgsCount;
				int num68 = argsCount68;
				if (num68 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId46 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId46);
				sbyte grade4 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref grade4);
				bool principal = false;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref principal);
				bool returnValue45 = this.GmCmd_ForceChangeGrade(context, charId46, grade4, principal);
				result = Serializer.Serialize(returnValue45, returnDataPool);
				break;
			}
			case 70:
			{
				int argsCount69 = operation.ArgsCount;
				int num69 = argsCount69;
				if (num69 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId47 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId47);
				this.GmCmd_Die(context, charId47);
				result = -1;
				break;
			}
			case 71:
			{
				int argsCount70 = operation.ArgsCount;
				int num70 = argsCount70;
				if (num70 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int preexistenceCharId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref preexistenceCharId);
				int returnValue46 = this.GmCmd_GetAliveCharByPreexistenceChar(preexistenceCharId);
				result = Serializer.Serialize(returnValue46, returnDataPool);
				break;
			}
			case 72:
			{
				int argsCount71 = operation.ArgsCount;
				int num71 = argsCount71;
				if (num71 != 0)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				this.GmCmd_LogCharacterSamsaraInfo();
				result = -1;
				break;
			}
			case 73:
			{
				int argsCount72 = operation.ArgsCount;
				int num72 = argsCount72;
				if (num72 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int characterId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref characterId);
				NeiliAllocation allocation = default(NeiliAllocation);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref allocation);
				this.GmCmd_EditExtraNeiliAllocation(context, characterId, allocation);
				result = -1;
				break;
			}
			case 74:
			{
				int argsCount73 = operation.ArgsCount;
				int num73 = argsCount73;
				if (num73 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int characterId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref characterId2);
				int targetCharacterId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref targetCharacterId);
				this.GmCmd_MakeCharacterKidnapped(context, characterId2, targetCharacterId);
				result = -1;
				break;
			}
			case 75:
			{
				int argsCount74 = operation.ArgsCount;
				int num74 = argsCount74;
				if (num74 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId48 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId48);
				Location destLocation = default(Location);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref destLocation);
				bool returnValue47 = this.GmCmd_MoveIntelligentCharacter(context, charId48, destLocation);
				result = Serializer.Serialize(returnValue47, returnDataPool);
				break;
			}
			case 76:
			{
				int argsCount75 = operation.ArgsCount;
				int num75 = argsCount75;
				if (num75 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				sbyte orgTemplateId3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref orgTemplateId3);
				this.GmCmd_RandomizeRelationShipsInSettlement(context, orgTemplateId3);
				result = -1;
				break;
			}
			case 77:
			{
				int argsCount76 = operation.ArgsCount;
				int num76 = argsCount76;
				if (num76 != 4)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int selfCharId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref selfCharId2);
				int targetCharId3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref targetCharId3);
				bool isRaped = false;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref isRaped);
				int pregnantRemainTime = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref pregnantRemainTime);
				this.GmCmd_MakeCharacterHaveSex(context, selfCharId2, targetCharId3, isRaped, pregnantRemainTime);
				result = -1;
				break;
			}
			case 78:
			{
				int argsCount77 = operation.ArgsCount;
				int num77 = argsCount77;
				if (num77 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId49 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId49);
				int returnValue48 = this.GmCmd_GetCharacterPregnancyLockEndDates(context, charId49);
				result = Serializer.Serialize(returnValue48, returnDataPool);
				break;
			}
			case 79:
			{
				int argsCount78 = operation.ArgsCount;
				int num78 = argsCount78;
				if (num78 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId50 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId50);
				List<int> returnValue49 = this.GmCmd_GetCharacterActualBloodParents(context, charId50);
				result = Serializer.Serialize(returnValue49, returnDataPool);
				break;
			}
			case 80:
			{
				int argsCount79 = operation.ArgsCount;
				int num79 = argsCount79;
				if (num79 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int cutterCharId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref cutterCharId);
				int shaveCharId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref shaveCharId);
				AvatarData shaveResult = new AvatarData();
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref shaveResult);
				bool returnValue50 = this.CharacterShaveAvatar(context, cutterCharId, shaveCharId, shaveResult);
				result = Serializer.Serialize(returnValue50, returnDataPool);
				break;
			}
			case 81:
			{
				int argsCount80 = operation.ArgsCount;
				int num80 = argsCount80;
				if (num80 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId51 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId51);
				byte neiliAllocationType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref neiliAllocationType);
				this.AllocateNeili(context, charId51, neiliAllocationType);
				result = -1;
				break;
			}
			case 82:
			{
				int argsCount81 = operation.ArgsCount;
				int num81 = argsCount81;
				if (num81 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId52 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId52);
				byte neiliAllocationType2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref neiliAllocationType2);
				this.DeallocateNeili(context, charId52, neiliAllocationType2);
				result = -1;
				break;
			}
			case 83:
			{
				int argsCount82 = operation.ArgsCount;
				int num82 = argsCount82;
				if (num82 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId53 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId53);
				short returnValue51 = this.GetChangeOfQiDisorder(charId53);
				result = Serializer.Serialize(returnValue51, returnDataPool);
				break;
			}
			case 84:
			{
				int argsCount83 = operation.ArgsCount;
				int num83 = argsCount83;
				if (num83 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId54 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId54);
				CombatResources returnValue52 = this.GetUsableCombatResources(charId54);
				result = Serializer.Serialize(returnValue52, returnDataPool);
				break;
			}
			case 85:
			{
				int argsCount84 = operation.ArgsCount;
				int num84 = argsCount84;
				if (num84 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId55 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId55);
				sbyte[] returnValue53 = this.GetCombatSkillSlotCounts(charId55);
				result = Serializer.Serialize(returnValue53, returnDataPool);
				break;
			}
			case 86:
			{
				int argsCount85 = operation.ArgsCount;
				int num85 = argsCount85;
				if (num85 != 4)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId56 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId56);
				sbyte equipType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref equipType);
				int index = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref index);
				short skillTemplateId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref skillTemplateId2);
				this.SetCombatSkillSlot(context, charId56, equipType, index, skillTemplateId2);
				result = -1;
				break;
			}
			case 87:
			{
				int argsCount86 = operation.ArgsCount;
				int num86 = argsCount86;
				if (num86 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId57 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId57);
				sbyte type = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref type);
				ValueTuple<int, int> returnValue54 = this.GetCombatSkillAttainment(charId57, type);
				result = Serializer.Serialize(returnValue54, returnDataPool);
				break;
			}
			case 88:
			{
				int argsCount87 = operation.ArgsCount;
				int num87 = argsCount87;
				if (num87 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId58 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId58);
				int[] returnValue55 = this.GetAllCombatSkillAttainment(charId58);
				result = Serializer.Serialize(returnValue55, returnDataPool);
				break;
			}
			case 89:
			{
				int argsCount88 = operation.ArgsCount;
				int num88 = argsCount88;
				if (num88 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId59 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId59);
				sbyte type2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref type2);
				ValueTuple<int, int> returnValue56 = this.GetLifeSkillAttainment(charId59, type2);
				result = Serializer.Serialize(returnValue56, returnDataPool);
				break;
			}
			case 90:
			{
				int argsCount89 = operation.ArgsCount;
				int num89 = argsCount89;
				if (num89 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId60 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId60);
				int[] returnValue57 = this.GetAllLifeSkillAttainment(charId60);
				result = Serializer.Serialize(returnValue57, returnDataPool);
				break;
			}
			case 91:
			{
				int argsCount90 = operation.ArgsCount;
				int num90 = argsCount90;
				if (num90 != 2)
				{
					if (num90 != 3)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
						defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					int charId61 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId61);
					short skillTemplateId3 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref skillTemplateId3);
					ushort readingState = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref readingState);
					this.LearnCombatSkill(context, charId61, skillTemplateId3, readingState);
					result = -1;
				}
				else
				{
					int charId62 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId62);
					short skillTemplateId4 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref skillTemplateId4);
					this.LearnCombatSkill(context, charId62, skillTemplateId4, 0);
					result = -1;
				}
				break;
			}
			case 92:
			{
				int argsCount91 = operation.ArgsCount;
				int num91 = argsCount91;
				if (num91 != 2)
				{
					if (num91 != 3)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
						defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					int charId63 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId63);
					short skillTemplateId5 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref skillTemplateId5);
					byte readingState2 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref readingState2);
					this.LearnLifeSkill(context, charId63, skillTemplateId5, readingState2);
					result = -1;
				}
				else
				{
					int charId64 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId64);
					short skillTemplateId6 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref skillTemplateId6);
					this.LearnLifeSkill(context, charId64, skillTemplateId6, 0);
					result = -1;
				}
				break;
			}
			case 93:
			{
				int argsCount92 = operation.ArgsCount;
				int num92 = argsCount92;
				if (num92 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId65 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId65);
				DeadCharacter returnValue58 = this.TryGetDeadCharacter(charId65);
				result = Serializer.Serialize(returnValue58, returnDataPool);
				break;
			}
			case 94:
			{
				int argsCount93 = operation.ArgsCount;
				int num93 = argsCount93;
				if (num93 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId66 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId66);
				List<short> returnValue59 = this.GetTitles(charId66);
				result = Serializer.Serialize(returnValue59, returnDataPool);
				break;
			}
			case 95:
			{
				int argsCount94 = operation.ArgsCount;
				int num94 = argsCount94;
				if (num94 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId67 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId67);
				sbyte returnValue60 = this.GetHighestGradeCombatSkillById(charId67);
				result = Serializer.Serialize(returnValue60, returnDataPool);
				break;
			}
			case 96:
			{
				int argsCount95 = operation.ArgsCount;
				int num95 = argsCount95;
				if (num95 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId68 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId68);
				short returnValue61 = this.GetLeftMaxHealth(charId68);
				result = Serializer.Serialize(returnValue61, returnDataPool);
				break;
			}
			case 97:
			{
				int argsCount96 = operation.ArgsCount;
				int num96 = argsCount96;
				if (num96 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId69 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId69);
				short returnValue62 = this.GetHealthRecovery(charId69);
				result = Serializer.Serialize(returnValue62, returnDataPool);
				break;
			}
			case 98:
			{
				int argsCount97 = operation.ArgsCount;
				int num97 = argsCount97;
				if (num97 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIdList7 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIdList7);
				List<AvatarRelatedData> returnValue63 = this.GetAvatarRelatedDataList(charIdList7);
				result = Serializer.Serialize(returnValue63, returnDataPool);
				break;
			}
			case 99:
			{
				int argsCount98 = operation.ArgsCount;
				int num98 = argsCount98;
				if (num98 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId70 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId70);
				AvatarData returnValue64 = this.GetAvatarData(context, charId70);
				result = Serializer.Serialize(returnValue64, returnDataPool);
				break;
			}
			case 100:
			{
				int argsCount99 = operation.ArgsCount;
				int num99 = argsCount99;
				if (num99 != 4)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int srcCharId3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref srcCharId3);
				int destCharId3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref destCharId3);
				List<ItemKey> keyList = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref keyList);
				bool checkFavorability3 = false;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref checkFavorability3);
				this.TransferInventoryItemListWithDebt(context, srcCharId3, destCharId3, keyList, checkFavorability3);
				result = -1;
				break;
			}
			case 101:
			{
				int argsCount100 = operation.ArgsCount;
				int num100 = argsCount100;
				if (num100 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId71 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId71);
				sbyte returnValue65 = this.GetFameType(charId71);
				result = Serializer.Serialize(returnValue65, returnDataPool);
				break;
			}
			case 102:
			{
				int argsCount101 = operation.ArgsCount;
				int num101 = argsCount101;
				if (num101 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId72 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId72);
				AvatarRelatedData returnValue66 = this.GetAvatarRelatedData(charId72);
				result = Serializer.Serialize(returnValue66, returnDataPool);
				break;
			}
			case 103:
			{
				int argsCount102 = operation.ArgsCount;
				int num102 = argsCount102;
				if (num102 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIdList8 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIdList8);
				int returnValue67 = this.GetCharacterListWisdomCount(charIdList8);
				result = Serializer.Serialize(returnValue67, returnDataPool);
				break;
			}
			case 104:
			{
				int argsCount103 = operation.ArgsCount;
				int num103 = argsCount103;
				if (num103 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> managerList = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref managerList);
				List<IntPair> returnValue68 = this.SortCharacterListByMaxCombatSkill(managerList);
				result = Serializer.Serialize(returnValue68, returnDataPool);
				break;
			}
			case 105:
			{
				int argsCount104 = operation.ArgsCount;
				int num104 = argsCount104;
				if (num104 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId73 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId73);
				ValueTuple<sbyte, short> returnValue69 = this.GetCharacterMaxCombatSkillAttainment(charId73);
				result = Serializer.Serialize(returnValue69, returnDataPool);
				break;
			}
			case 106:
			{
				int argsCount105 = operation.ArgsCount;
				int num105 = argsCount105;
				if (num105 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int targetCharId4 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref targetCharId4);
				Debts returnValue70 = this.GetDebts(targetCharId4);
				result = Serializer.Serialize(returnValue70, returnDataPool);
				break;
			}
			case 107:
			{
				int argsCount106 = operation.ArgsCount;
				int num106 = argsCount106;
				if (num106 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId74 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId74);
				ItemKey itemKey6 = default(ItemKey);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemKey6);
				ItemPowerInfo returnValue71 = this.GetItemPowerInfo(charId74, itemKey6);
				result = Serializer.Serialize(returnValue71, returnDataPool);
				break;
			}
			case 108:
			{
				int argsCount107 = operation.ArgsCount;
				int num107 = argsCount107;
				if (num107 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId75 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId75);
				short returnValue72 = this.CalcMaxFavorabilityToTaiwuById(charId75);
				result = Serializer.Serialize(returnValue72, returnDataPool);
				break;
			}
			case 109:
			{
				int argsCount108 = operation.ArgsCount;
				int num108 = argsCount108;
				if (num108 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId76 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId76);
				ResourceInts resources3 = default(ResourceInts);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref resources3);
				ValueTuple<sbyte, short> returnValue73 = this.CheckDebtChange(charId76, resources3);
				result = Serializer.Serialize(returnValue73, returnDataPool);
				break;
			}
			case 110:
			{
				int argsCount109 = operation.ArgsCount;
				int num109 = argsCount109;
				if (num109 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int characterId3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref characterId3);
				int returnValue74 = this.GetCharacterWisdomCountById(characterId3);
				result = Serializer.Serialize(returnValue74, returnDataPool);
				break;
			}
			case 111:
			{
				int argsCount110 = operation.ArgsCount;
				int num110 = argsCount110;
				if (num110 != 4)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charA = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charA);
				int charB = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charB);
				ItemKey itemKey7 = default(ItemKey);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemKey7);
				int amount3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref amount3);
				this.TransferInventoryItemFromAToB(context, charA, charB, itemKey7, amount3);
				result = -1;
				break;
			}
			case 112:
			{
				int argsCount111 = operation.ArgsCount;
				int num111 = argsCount111;
				if (num111 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId77 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId77);
				this.GmCmd_SetCurReadingEvent(context, charId77);
				result = -1;
				break;
			}
			case 113:
			{
				int argsCount112 = operation.ArgsCount;
				int num112 = argsCount112;
				if (num112 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId78 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId78);
				int[] personalities = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref personalities);
				this.GmCmd_SetAdventurePersonalities(context, charId78, personalities);
				result = -1;
				break;
			}
			case 114:
			{
				int argsCount113 = operation.ArgsCount;
				int num113 = argsCount113;
				if (num113 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId79 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId79);
				short templateId4 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref templateId4);
				this.GmCmd_AddFeature(context, charId79, templateId4);
				result = -1;
				break;
			}
			case 115:
			{
				int argsCount114 = operation.ArgsCount;
				int num114 = argsCount114;
				if (num114 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId80 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId80);
				List<short> features = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref features);
				this.GmCmd_SetFeatures(context, charId80, features);
				result = -1;
				break;
			}
			case 116:
			{
				int argsCount115 = operation.ArgsCount;
				int num115 = argsCount115;
				if (num115 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId81 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId81);
				short templateId5 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref templateId5);
				this.GmCmd_RemoveFeature(context, charId81, templateId5);
				result = -1;
				break;
			}
			case 117:
			{
				int argsCount116 = operation.ArgsCount;
				int num116 = argsCount116;
				if (num116 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId82 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId82);
				int relatedCharId5 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref relatedCharId5);
				ushort removeType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref removeType);
				this.GmCmd_RemoveRelation(context, charId82, relatedCharId5, removeType);
				result = -1;
				break;
			}
			case 118:
			{
				int argsCount117 = operation.ArgsCount;
				int num117 = argsCount117;
				if (num117 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId83 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId83);
				bool returnValue75 = this.IsReclusive(charId83);
				result = Serializer.Serialize(returnValue75, returnDataPool);
				break;
			}
			case 119:
			{
				int argsCount118 = operation.ArgsCount;
				int num118 = argsCount118;
				if (num118 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId84 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId84);
				List<ItemDisplayData> returnValue76 = this.GetInventoryEquipment(charId84);
				result = Serializer.Serialize(returnValue76, returnDataPool);
				break;
			}
			case 120:
			{
				int argsCount119 = operation.ArgsCount;
				int num119 = argsCount119;
				if (num119 != 0)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> returnValue77 = this.GetFilteredCharacterCounts();
				result = Serializer.Serialize(returnValue77, returnDataPool);
				break;
			}
			case 121:
			{
				int argsCount120 = operation.ArgsCount;
				int num120 = argsCount120;
				if (num120 != 0)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				this.ClearCharacterSortFilter();
				result = -1;
				break;
			}
			case 122:
			{
				int argsCount121 = operation.ArgsCount;
				int num121 = argsCount121;
				if (num121 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				CharacterSortFilterSettings sortFilterSettings = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref sortFilterSettings);
				CharacterList returnValue78 = this.UpdateSortFilterSettings(sortFilterSettings);
				result = Serializer.Serialize(returnValue78, returnDataPool);
				break;
			}
			case 123:
			{
				int argsCount122 = operation.ArgsCount;
				int num122 = argsCount122;
				if (num122 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				CharacterSortFilterSettings sortFilterSettings2 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref sortFilterSettings2);
				CharacterList returnValue79 = this.InitializeCharacterSortFilter(sortFilterSettings2);
				result = Serializer.Serialize(returnValue79, returnDataPool);
				break;
			}
			case 124:
			{
				int argsCount123 = operation.ArgsCount;
				int num123 = argsCount123;
				if (num123 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				string name = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref name);
				CharacterList returnValue80 = this.FindNameInCurrentSortFilter(name);
				result = Serializer.Serialize(returnValue80, returnDataPool);
				break;
			}
			case 125:
			{
				int argsCount124 = operation.ArgsCount;
				int num124 = argsCount124;
				if (num124 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIdList9 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIdList9);
				List<CharacterDisplayDataForUltimateSelect> returnValue81 = this.GetCharacterDisplayDataListForUltimateSelect(charIdList9);
				result = Serializer.Serialize(returnValue81, returnDataPool);
				break;
			}
			case 126:
			{
				int argsCount125 = operation.ArgsCount;
				int num125 = argsCount125;
				if (num125 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> sortingTypes = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref sortingTypes);
				sbyte filterSubId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref filterSubId);
				List<int> returnValue82 = this.GetMaxSortingTypeCharIds(sortingTypes, filterSubId);
				result = Serializer.Serialize(returnValue82, returnDataPool);
				break;
			}
			case 127:
			{
				int argsCount126 = operation.ArgsCount;
				int num126 = argsCount126;
				if (num126 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId85 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId85);
				int value = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref value);
				this.GmCmd_SetCurrNeili(context, charId85, value);
				result = -1;
				break;
			}
			case 128:
			{
				int argsCount127 = operation.ArgsCount;
				int num127 = argsCount127;
				if (num127 != 6)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId86 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId86);
				sbyte baseItemType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref baseItemType);
				short baseItemId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref baseItemId);
				short poisonId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref poisonId);
				short poisonId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref poisonId2);
				short poisonId3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref poisonId3);
				this.GmCmd_AddPoisonedInventoryItem(context, charId86, baseItemType, baseItemId, poisonId, poisonId2, poisonId3);
				result = -1;
				break;
			}
			case 129:
			{
				int argsCount128 = operation.ArgsCount;
				int num128 = argsCount128;
				if (num128 != 6)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId87 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId87);
				sbyte baseItemType2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref baseItemType2);
				short baseItemId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref baseItemId2);
				short poisonId4 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref poisonId4);
				short poisonId5 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref poisonId5);
				short poisonId6 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref poisonId6);
				this.GmCmd_AddPoisonedEatingItem(context, charId87, baseItemType2, baseItemId2, poisonId4, poisonId5, poisonId6);
				result = -1;
				break;
			}
			case 130:
			{
				int argsCount129 = operation.ArgsCount;
				int num129 = argsCount129;
				if (num129 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId88 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId88);
				NeiliProportionOfFiveElements fiveElements = default(NeiliProportionOfFiveElements);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref fiveElements);
				this.GmCmd_SetCharBaseNeiliProportionOfFiveElements(context, charId88, fiveElements);
				result = -1;
				break;
			}
			case 131:
			{
				int argsCount130 = operation.ArgsCount;
				int num130 = argsCount130;
				if (num130 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId89 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId89);
				int relatedCharId6 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref relatedCharId6);
				ValueTuple<ushort, ushort> returnValue83 = this.GetRelationBetweenCharacters(charId89, relatedCharId6);
				result = Serializer.Serialize(returnValue83, returnDataPool);
				break;
			}
			case 132:
			{
				int argsCount131 = operation.ArgsCount;
				int num131 = argsCount131;
				if (num131 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId90 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId90);
				sbyte itemType4 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemType4);
				List<ItemDisplayData> returnValue84 = this.GetInventoryItemsByItemType(charId90, itemType4);
				result = Serializer.Serialize(returnValue84, returnDataPool);
				break;
			}
			case 133:
			{
				int argsCount132 = operation.ArgsCount;
				int num132 = argsCount132;
				if (num132 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId91 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId91);
				CharacterDisplayData returnValue85 = this.GetCharacterDisplayData(charId91);
				result = Serializer.Serialize(returnValue85, returnDataPool);
				break;
			}
			case 134:
			{
				int argsCount133 = operation.ArgsCount;
				int num133 = argsCount133;
				if (num133 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId92 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId92);
				this.UnequipAllCombatSkills(context, charId92);
				result = -1;
				break;
			}
			case 135:
			{
				int argsCount134 = operation.ArgsCount;
				int num134 = argsCount134;
				if (num134 != 1)
				{
					if (num134 != 2)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
						defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					int charId93 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId93);
					short combatConfigTemplateId = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref combatConfigTemplateId);
					this.AutoEquipCombatSkills(context, charId93, combatConfigTemplateId);
					result = -1;
				}
				else
				{
					int charId94 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId94);
					this.AutoEquipCombatSkills(context, charId94, -1);
					result = -1;
				}
				break;
			}
			case 136:
			{
				int argsCount135 = operation.ArgsCount;
				int num135 = argsCount135;
				if (num135 != 2)
				{
					if (num135 != 3)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
						defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					int charId95 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId95);
					short titleTemplateId = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref titleTemplateId);
					int duration = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref duration);
					this.GmCmd_AddCharacterExtraTitle(context, charId95, titleTemplateId, duration);
					result = -1;
				}
				else
				{
					int charId96 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId96);
					short titleTemplateId2 = 0;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref titleTemplateId2);
					this.GmCmd_AddCharacterExtraTitle(context, charId96, titleTemplateId2, -1);
					result = -1;
				}
				break;
			}
			case 137:
			{
				int argsCount136 = operation.ArgsCount;
				int num136 = argsCount136;
				if (num136 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId97 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId97);
				int relatedCharId7 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref relatedCharId7);
				ushort relationType = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref relationType);
				this.TryAddAndApplyOneWayRelation(context, charId97, relatedCharId7, relationType);
				result = -1;
				break;
			}
			case 138:
			{
				int argsCount137 = operation.ArgsCount;
				int num137 = argsCount137;
				if (num137 != 1)
				{
					if (num137 != 2)
					{
						DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
						defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
						defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
						throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
					}
					Location targetLocation = default(Location);
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref targetLocation);
					bool hide = false;
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref hide);
					this.MoveFuyuHiltLocation(context, targetLocation, hide);
					result = -1;
				}
				else
				{
					Location targetLocation2 = default(Location);
					argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref targetLocation2);
					this.MoveFuyuHiltLocation(context, targetLocation2, false);
					result = -1;
				}
				break;
			}
			case 139:
			{
				int argsCount138 = operation.ArgsCount;
				int num138 = argsCount138;
				if (num138 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId98 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId98);
				int relatedCharId8 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref relatedCharId8);
				ushort relationType2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref relationType2);
				this.TryRemoveOneWayRelation(context, charId98, relatedCharId8, relationType2);
				result = -1;
				break;
			}
			case 140:
			{
				int argsCount139 = operation.ArgsCount;
				int num139 = argsCount139;
				if (num139 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId99 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId99);
				CharacterLoveAndHateItemInfo returnValue86 = this.GetCharacterLoveAndHateItemInfo(context, charId99);
				result = Serializer.Serialize(returnValue86, returnDataPool);
				break;
			}
			case 141:
			{
				int argsCount140 = operation.ArgsCount;
				int num140 = argsCount140;
				if (num140 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId100 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId100);
				bool returnValue87 = this.IsTemporaryIntelligentCharacter(charId100);
				result = Serializer.Serialize(returnValue87, returnDataPool);
				break;
			}
			case 142:
			{
				int argsCount141 = operation.ArgsCount;
				int num141 = argsCount141;
				if (num141 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId101 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId101);
				int[] returnValue88 = this.GetMixedPoisonTypeRelatedMarkCountArray(charId101);
				result = Serializer.Serialize(returnValue88, returnDataPool);
				break;
			}
			case 143:
			{
				int argsCount142 = operation.ArgsCount;
				int num142 = argsCount142;
				if (num142 != 3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId102 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId102);
				ItemKey itemKey8 = default(ItemKey);
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref itemKey8);
				int amount4 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref amount4);
				SimulateEatingEffectResult returnValue89 = this.SimulateEatingEffect(context, charId102, itemKey8, amount4);
				result = Serializer.Serialize(returnValue89, returnDataPool);
				break;
			}
			case 144:
			{
				int argsCount143 = operation.ArgsCount;
				int num143 = argsCount143;
				if (num143 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId103 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId103);
				CharacterDisplayDataForTooltip returnValue90 = this.GetCharacterDisplayDataForTooltip(charId103);
				result = Serializer.Serialize(returnValue90, returnDataPool);
				break;
			}
			case 145:
			{
				int argsCount144 = operation.ArgsCount;
				int num144 = argsCount144;
				if (num144 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId104 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId104);
				this.GmCmd_SetCurLoopingEvent(context, charId104);
				result = -1;
				break;
			}
			case 146:
			{
				int argsCount145 = operation.ArgsCount;
				int num145 = argsCount145;
				if (num145 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId105 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId105);
				sbyte returnValue91 = this.GetHealthType(charId105);
				result = Serializer.Serialize(returnValue91, returnDataPool);
				break;
			}
			case 147:
			{
				int argsCount146 = operation.ArgsCount;
				int num146 = argsCount146;
				if (num146 != 4)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int characterId4 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref characterId4);
				int relatedCharId9 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref relatedCharId9);
				int baseDelta = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref baseDelta);
				short type3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref type3);
				int returnValue92 = this.CalcFavorabilityDelta(characterId4, relatedCharId9, baseDelta, type3);
				result = Serializer.Serialize(returnValue92, returnDataPool);
				break;
			}
			case 148:
			{
				int argsCount147 = operation.ArgsCount;
				int num147 = argsCount147;
				if (num147 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId106 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId106);
				CharacterLocationDisplayData returnValue93 = this.GetCharacterLocationDisplayData(charId106);
				result = Serializer.Serialize(returnValue93, returnDataPool);
				break;
			}
			case 149:
			{
				int argsCount148 = operation.ArgsCount;
				int num148 = argsCount148;
				if (num148 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId107 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId107);
				CharacterDisplayDataForMapBlock returnValue94 = this.GetCharacterDisplayDataForMapBlock(charId107);
				result = Serializer.Serialize(returnValue94, returnDataPool);
				break;
			}
			case 150:
			{
				int argsCount149 = operation.ArgsCount;
				int num149 = argsCount149;
				if (num149 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				List<int> charIdList10 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIdList10);
				List<int> returnValue95 = this.GetCharacterWisdomList(charIdList10);
				result = Serializer.Serialize(returnValue95, returnDataPool);
				break;
			}
			case 151:
			{
				int argsCount150 = operation.ArgsCount;
				int num150 = argsCount150;
				if (num150 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				sbyte xiangshuAvatarId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref xiangshuAvatarId);
				int returnValue96 = this.GetOrCreateSwordTombCharacterIdForNormalInformation(context, xiangshuAvatarId);
				result = Serializer.Serialize(returnValue96, returnDataPool);
				break;
			}
			case 152:
			{
				int argsCount151 = operation.ArgsCount;
				int num151 = argsCount151;
				if (num151 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId108 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId108);
				List<ItemDisplayData> returnValue97 = this.GetAllInventoryItemsExcludeValueZero(charId108);
				result = Serializer.Serialize(returnValue97, returnDataPool);
				break;
			}
			case 153:
			{
				int argsCount152 = operation.ArgsCount;
				int num152 = argsCount152;
				if (num152 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId109 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId109);
				int returnValue98 = this.GetAddConsummateLevelRequiredMonth(charId109);
				result = Serializer.Serialize(returnValue98, returnDataPool);
				break;
			}
			case 154:
			{
				int argsCount153 = operation.ArgsCount;
				int num153 = argsCount153;
				if (num153 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId110 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId110);
				this.GmCmd_ResetHairGrowth(context, charId110);
				result = -1;
				break;
			}
			case 155:
			{
				int argsCount154 = operation.ArgsCount;
				int num154 = argsCount154;
				if (num154 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				short areaId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref areaId);
				List<TemplateKeyAndCount> returnValue99 = CharacterDomain.GetAllItemsByAreaId(areaId);
				result = Serializer.Serialize(returnValue99, returnDataPool);
				break;
			}
			case 156:
			{
				int argsCount155 = operation.ArgsCount;
				int num155 = argsCount155;
				if (num155 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId111 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId111);
				bool isLocked = false;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref isLocked);
				this.SetCombatSkillPlanLock(context, charId111, isLocked);
				result = -1;
				break;
			}
			case 157:
			{
				int argsCount156 = operation.ArgsCount;
				int num156 = argsCount156;
				if (num156 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId112 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId112);
				this.AppendCombatSkillPlan(context, charId112);
				result = -1;
				break;
			}
			case 158:
			{
				int argsCount157 = operation.ArgsCount;
				int num157 = argsCount157;
				if (num157 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId113 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId113);
				this.DuplicateCurrentCombatSkillPlan(context, charId113);
				result = -1;
				break;
			}
			case 159:
			{
				int argsCount158 = operation.ArgsCount;
				int num158 = argsCount158;
				if (num158 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId114 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId114);
				int planId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref planId);
				this.UpdateCombatSkillPlan(context, charId114, planId);
				result = -1;
				break;
			}
			case 160:
			{
				int argsCount159 = operation.ArgsCount;
				int num159 = argsCount159;
				if (num159 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId115 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId115);
				ValueTuple<int, int> returnValue100 = this.GetCurrentPlanIdAndPlanCount(charId115);
				result = Serializer.Serialize(returnValue100, returnDataPool);
				break;
			}
			case 161:
			{
				int argsCount160 = operation.ArgsCount;
				int num160 = argsCount160;
				if (num160 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId116 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId116);
				int planId2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref planId2);
				this.DeleteCombatSkillPlan(context, charId116, planId2);
				result = -1;
				break;
			}
			case 162:
			{
				int argsCount161 = operation.ArgsCount;
				int num161 = argsCount161;
				if (num161 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId117 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId117);
				bool returnValue101 = this.IsInteractedWithTaiwu(charId117);
				result = Serializer.Serialize(returnValue101, returnDataPool);
				break;
			}
			case 163:
			{
				int argsCount162 = operation.ArgsCount;
				int num162 = argsCount162;
				if (num162 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId118 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId118);
				bool returnValue102 = this.IsNeiliAllocationLocked(charId118);
				result = Serializer.Serialize(returnValue102, returnDataPool);
				break;
			}
			case 164:
			{
				int argsCount163 = operation.ArgsCount;
				int num163 = argsCount163;
				if (num163 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId119 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId119);
				sbyte equipType2 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref equipType2);
				this.AllocateGenericGrid(context, charId119, equipType2);
				result = -1;
				break;
			}
			case 165:
			{
				int argsCount164 = operation.ArgsCount;
				int num164 = argsCount164;
				if (num164 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId120 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId120);
				sbyte equipType3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref equipType3);
				this.DeallocateGenericGrid(context, charId120, equipType3);
				result = -1;
				break;
			}
			case 166:
			{
				int argsCount165 = operation.ArgsCount;
				int num165 = argsCount165;
				if (num165 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId121 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId121);
				bool returnValue103 = this.IsCombatSkillEquipmentLocked(charId121);
				result = Serializer.Serialize(returnValue103, returnDataPool);
				break;
			}
			case 167:
			{
				int argsCount166 = operation.ArgsCount;
				int num166 = argsCount166;
				if (num166 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId122 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId122);
				this.AutoAllocateNeili(context, charId122);
				result = -1;
				break;
			}
			case 168:
			{
				int argsCount167 = operation.ArgsCount;
				int num167 = argsCount167;
				if (num167 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId123 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId123);
				this.AutoSetCombatSkillAttainmentPanels(context, charId123);
				result = -1;
				break;
			}
			case 169:
			{
				int argsCount168 = operation.ArgsCount;
				int num168 = argsCount168;
				if (num168 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId124 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId124);
				this.AutoEquipItems(context, charId124);
				result = -1;
				break;
			}
			case 170:
			{
				int argsCount169 = operation.ArgsCount;
				int num169 = argsCount169;
				if (num169 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId125 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId125);
				bool isLocked2 = false;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref isLocked2);
				this.SetCombatSkillAttainmentLock(context, charId125, isLocked2);
				result = -1;
				break;
			}
			case 171:
			{
				int argsCount170 = operation.ArgsCount;
				int num170 = argsCount170;
				if (num170 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId126 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId126);
				bool returnValue104 = this.IsCombatSkillAttainmentLocked(charId126);
				result = Serializer.Serialize(returnValue104, returnDataPool);
				break;
			}
			case 172:
			{
				int argsCount171 = operation.ArgsCount;
				int num171 = argsCount171;
				if (num171 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId127 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId127);
				byte[] returnValue105 = this.GetGenericGridAllocation(charId127);
				result = Serializer.Serialize(returnValue105, returnDataPool);
				break;
			}
			case 173:
			{
				int argsCount172 = operation.ArgsCount;
				int num172 = argsCount172;
				if (num172 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId128 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId128);
				bool isLocked3 = false;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref isLocked3);
				this.SetNeiliAllocationLock(context, charId128, isLocked3);
				result = -1;
				break;
			}
			case 174:
			{
				int argsCount173 = operation.ArgsCount;
				int num173 = argsCount173;
				if (num173 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId129 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId129);
				short skillTemplateId7 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref skillTemplateId7);
				this.RemoveEquippedCombatSkill(context, charId129, skillTemplateId7);
				result = -1;
				break;
			}
			case 175:
			{
				int argsCount174 = operation.ArgsCount;
				int num174 = argsCount174;
				if (num174 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId130 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId130);
				short skillTemplateId8 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref skillTemplateId8);
				this.AddEquippedCombatSkill(context, charId130, skillTemplateId8);
				result = -1;
				break;
			}
			case 176:
			{
				int argsCount175 = operation.ArgsCount;
				int num175 = argsCount175;
				if (num175 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId131 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId131);
				sbyte[] returnValue106 = this.GetCombatSkillExtraSlotCounts(charId131);
				result = Serializer.Serialize(returnValue106, returnDataPool);
				break;
			}
			case 177:
			{
				int argsCount176 = operation.ArgsCount;
				int num176 = argsCount176;
				if (num176 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId132 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId132);
				List<bool> returnValue107 = this.GetCharacterAllBodyPartExists(charId132);
				result = Serializer.Serialize(returnValue107, returnDataPool);
				break;
			}
			case 178:
			{
				int argsCount177 = operation.ArgsCount;
				int num177 = argsCount177;
				if (num177 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId133 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId133);
				int delta3 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref delta3);
				this.GmCmd_ChangeCharDisorderOfQi(context, charId133, delta3);
				result = -1;
				break;
			}
			case 179:
			{
				int argsCount178 = operation.ArgsCount;
				int num178 = argsCount178;
				if (num178 != 0)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				NameRelatedData returnValue108 = this.GenerateRandomName(context);
				result = Serializer.Serialize(returnValue108, returnDataPool);
				break;
			}
			case 180:
			{
				int argsCount179 = operation.ArgsCount;
				int num179 = argsCount179;
				if (num179 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int currCharId = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref currCharId);
				List<int> charIds4 = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charIds4);
				List<CharacterDisplayDataForRelations> returnValue109 = this.GetCharacterDisplayDataListForRelationsWithRelationType(currCharId, charIds4);
				result = Serializer.Serialize(returnValue109, returnDataPool);
				break;
			}
			case 181:
			{
				int argsCount180 = operation.ArgsCount;
				int num180 = argsCount180;
				if (num180 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId134 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId134);
				short returnValue110 = this.GetPhysiologicalAge(charId134);
				result = Serializer.Serialize(returnValue110, returnDataPool);
				break;
			}
			case 182:
			{
				int argsCount181 = operation.ArgsCount;
				int num181 = argsCount181;
				if (num181 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId135 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId135);
				byte returnValue111 = this.GetPhysiologicalAgeAffector(charId135);
				result = Serializer.Serialize(returnValue111, returnDataPool);
				break;
			}
			case 183:
			{
				int argsCount182 = operation.ArgsCount;
				int num182 = argsCount182;
				if (num182 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId136 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId136);
				List<KidnappedCharacterDisplayData> returnValue112 = this.GetKidnappedCharacterDisplayData(charId136);
				result = Serializer.Serialize(returnValue112, returnDataPool);
				break;
			}
			case 184:
			{
				int argsCount183 = operation.ArgsCount;
				int num183 = argsCount183;
				if (num183 != 4)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int characterId5 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref characterId5);
				int relatedCharId10 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref relatedCharId10);
				Inventory items = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref items);
				short type4 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref type4);
				int returnValue113 = this.CalcItemsFavorabilityDelta(characterId5, relatedCharId10, items, type4);
				result = Serializer.Serialize(returnValue113, returnDataPool);
				break;
			}
			case 185:
			{
				int argsCount184 = operation.ArgsCount;
				int num184 = argsCount184;
				if (num184 != 1)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId137 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId137);
				bool returnValue114 = this.IsCarrierDurabilityRunningOut(charId137);
				result = Serializer.Serialize(returnValue114, returnDataPool);
				break;
			}
			case 186:
			{
				int argsCount185 = operation.ArgsCount;
				int num185 = argsCount185;
				if (num185 != 2)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
					defaultInterpolatedStringHandler.AppendLiteral("Unsupported argsCount of methodId: ");
					defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				}
				int charId138 = 0;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref charId138);
				string settlementName = null;
				argsOffset += Serializer.Deserialize(argDataPool, argsOffset, ref settlementName);
				bool returnValue115 = this.GmCmd_ForceChangeOrganizationByName(context, charId138, settlementName);
				result = Serializer.Serialize(returnValue115, returnDataPool);
				break;
			}
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(21, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported methodId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.MethodId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
			return result;
		}

		// Token: 0x06007408 RID: 29704 RVA: 0x0043E2B0 File Offset: 0x0043C4B0
		public override void OnMonitorData(ushort dataId, ulong subId0, uint subId1, bool monitoring)
		{
			switch (dataId)
			{
			case 0:
				break;
			case 1:
				break;
			case 2:
				break;
			case 3:
				break;
			case 4:
				break;
			case 5:
				break;
			case 6:
				break;
			case 7:
				break;
			case 8:
				this._modificationsPregnancyLockEndDates.ChangeRecording(monitoring);
				break;
			case 9:
				break;
			case 10:
				break;
			case 11:
				break;
			case 12:
				break;
			case 13:
				break;
			case 14:
				this._modificationsJoinGroupDates.ChangeRecording(monitoring);
				break;
			case 15:
				break;
			case 16:
				break;
			case 17:
				break;
			case 18:
				break;
			case 19:
				break;
			case 20:
				break;
			case 21:
				this._modificationsCrossAreaMoveInfos.ChangeRecording(monitoring);
				break;
			case 22:
				break;
			case 23:
				break;
			case 24:
				break;
			case 25:
				break;
			case 26:
				break;
			case 27:
				break;
			case 28:
				break;
			case 29:
				this._modificationsSubscriberOrders.ChangeRecording(monitoring);
				break;
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(19, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
		}

		// Token: 0x06007409 RID: 29705 RVA: 0x0043E404 File Offset: 0x0043C604
		public override int CheckModified(ushort dataId, ulong subId0, uint subId1, RawDataPool dataPool)
		{
			int result;
			switch (dataId)
			{
			case 0:
				result = this.CheckModified_Objects((int)subId0, (ushort)subId1, dataPool);
				break;
			case 1:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 2:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 3:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 4:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 5:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 6:
				result = this.CheckModified_Graves((int)subId0, (ushort)subId1, dataPool);
				break;
			case 7:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 8:
			{
				bool flag = !BaseGameDataDomain.IsModified(this.DataStates, 8);
				if (flag)
				{
					result = -1;
				}
				else
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 8);
					int offset = Serializer.SerializeModifications<int>(this._pregnancyLockEndDates, dataPool, this._modificationsPregnancyLockEndDates);
					this._modificationsPregnancyLockEndDates.Reset();
					result = offset;
				}
				break;
			}
			case 9:
			{
				bool flag2 = !BaseGameDataDomain.IsModified(this.DataStates, 9);
				if (flag2)
				{
					result = -1;
				}
				else
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 9);
					result = Serializer.Serialize(this._unguardedChars, dataPool);
				}
				break;
			}
			case 10:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 11:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 12:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 13:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 14:
			{
				bool flag3 = !BaseGameDataDomain.IsModified(this.DataStates, 14);
				if (flag3)
				{
					result = -1;
				}
				else
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 14);
					int offset2 = Serializer.SerializeModifications<int>(this._joinGroupDates, dataPool, this._modificationsJoinGroupDates);
					this._modificationsJoinGroupDates.Reset();
					result = offset2;
				}
				break;
			}
			case 15:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 16:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 17:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 18:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 19:
			{
				bool flag4 = !BaseGameDataDomain.IsModified(this.DataStates, 19);
				if (flag4)
				{
					result = -1;
				}
				else
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 19);
					result = Serializer.Serialize(this._targetedForAssassination, dataPool);
				}
				break;
			}
			case 20:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 21:
			{
				bool flag5 = !BaseGameDataDomain.IsModified(this.DataStates, 21);
				if (flag5)
				{
					result = -1;
				}
				else
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 21);
					int offset3 = Serializer.SerializeModifications<int>(this._crossAreaMoveInfos, dataPool, this._modificationsCrossAreaMoveInfos);
					this._modificationsCrossAreaMoveInfos.Reset();
					result = offset3;
				}
				break;
			}
			case 22:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 23:
			{
				bool flag6 = !BaseGameDataDomain.IsModified(this.DataStates, 23);
				if (flag6)
				{
					result = -1;
				}
				else
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 23);
					result = Serializer.Serialize(this._mournedOthersChars, dataPool);
				}
				break;
			}
			case 24:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 25:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to check modification of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 26:
			{
				bool flag7 = !BaseGameDataDomain.IsModified(this.DataStates, 26);
				if (flag7)
				{
					result = -1;
				}
				else
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 26);
					result = Serializer.Serialize(this._forceRebelLocation, dataPool);
				}
				break;
			}
			case 27:
			{
				bool flag8 = !BaseGameDataDomain.IsModified(this.DataStates, 27);
				if (flag8)
				{
					result = -1;
				}
				else
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 27);
					result = Serializer.Serialize(this._forceKindLocation, dataPool);
				}
				break;
			}
			case 28:
			{
				bool flag9 = !BaseGameDataDomain.IsModified(this.DataStates, 28);
				if (flag9)
				{
					result = -1;
				}
				else
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 28);
					result = Serializer.Serialize(this._avoidDeathCharId, dataPool);
				}
				break;
			}
			case 29:
			{
				bool flag10 = !BaseGameDataDomain.IsModified(this.DataStates, 29);
				if (flag10)
				{
					result = -1;
				}
				else
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 29);
					int offset4 = Serializer.SerializeModifications<int>(this._subscriberOrders, dataPool, this._modificationsSubscriberOrders);
					this._modificationsSubscriberOrders.Reset();
					result = offset4;
				}
				break;
			}
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(19, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
			return result;
		}

		// Token: 0x0600740A RID: 29706 RVA: 0x0043EAD8 File Offset: 0x0043CCD8
		public override void ResetModifiedWrapper(ushort dataId, ulong subId0, uint subId1)
		{
			switch (dataId)
			{
			case 0:
				this.ResetModifiedWrapper_Objects((int)subId0, (ushort)subId1);
				break;
			case 1:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 2:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 3:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 4:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 5:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 6:
				this.ResetModifiedWrapper_Graves((int)subId0, (ushort)subId1);
				break;
			case 7:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 8:
			{
				bool flag = !BaseGameDataDomain.IsModified(this.DataStates, 8);
				if (!flag)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 8);
					this._modificationsPregnancyLockEndDates.Reset();
				}
				break;
			}
			case 9:
			{
				bool flag2 = !BaseGameDataDomain.IsModified(this.DataStates, 9);
				if (!flag2)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 9);
				}
				break;
			}
			case 10:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 11:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 12:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 13:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 14:
			{
				bool flag3 = !BaseGameDataDomain.IsModified(this.DataStates, 14);
				if (!flag3)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 14);
					this._modificationsJoinGroupDates.Reset();
				}
				break;
			}
			case 15:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 16:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 17:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 18:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 19:
			{
				bool flag4 = !BaseGameDataDomain.IsModified(this.DataStates, 19);
				if (!flag4)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 19);
				}
				break;
			}
			case 20:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 21:
			{
				bool flag5 = !BaseGameDataDomain.IsModified(this.DataStates, 21);
				if (!flag5)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 21);
					this._modificationsCrossAreaMoveInfos.Reset();
				}
				break;
			}
			case 22:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 23:
			{
				bool flag6 = !BaseGameDataDomain.IsModified(this.DataStates, 23);
				if (!flag6)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 23);
				}
				break;
			}
			case 24:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 25:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to reset modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 26:
			{
				bool flag7 = !BaseGameDataDomain.IsModified(this.DataStates, 26);
				if (!flag7)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 26);
				}
				break;
			}
			case 27:
			{
				bool flag8 = !BaseGameDataDomain.IsModified(this.DataStates, 27);
				if (!flag8)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 27);
				}
				break;
			}
			case 28:
			{
				bool flag9 = !BaseGameDataDomain.IsModified(this.DataStates, 28);
				if (!flag9)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 28);
				}
				break;
			}
			case 29:
			{
				bool flag10 = !BaseGameDataDomain.IsModified(this.DataStates, 29);
				if (!flag10)
				{
					BaseGameDataDomain.ResetModified(this.DataStates, 29);
					this._modificationsSubscriberOrders.Reset();
				}
				break;
			}
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(19, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
		}

		// Token: 0x0600740B RID: 29707 RVA: 0x0043F0DC File Offset: 0x0043D2DC
		public override bool IsModifiedWrapper(ushort dataId, ulong subId0, uint subId1)
		{
			bool result;
			switch (dataId)
			{
			case 0:
				result = this.IsModifiedWrapper_Objects((int)subId0, (ushort)subId1);
				break;
			case 1:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 2:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 3:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 4:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 5:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 6:
				result = this.IsModifiedWrapper_Graves((int)subId0, (ushort)subId1);
				break;
			case 7:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 8:
				result = BaseGameDataDomain.IsModified(this.DataStates, 8);
				break;
			case 9:
				result = BaseGameDataDomain.IsModified(this.DataStates, 9);
				break;
			case 10:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 11:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 12:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 13:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 14:
				result = BaseGameDataDomain.IsModified(this.DataStates, 14);
				break;
			case 15:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 16:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 17:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 18:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 19:
				result = BaseGameDataDomain.IsModified(this.DataStates, 19);
				break;
			case 20:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 21:
				result = BaseGameDataDomain.IsModified(this.DataStates, 21);
				break;
			case 22:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 23:
				result = BaseGameDataDomain.IsModified(this.DataStates, 23);
				break;
			case 24:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 25:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Not allow to verify modification state of dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			case 26:
				result = BaseGameDataDomain.IsModified(this.DataStates, 26);
				break;
			case 27:
				result = BaseGameDataDomain.IsModified(this.DataStates, 27);
				break;
			case 28:
				result = BaseGameDataDomain.IsModified(this.DataStates, 28);
				break;
			case 29:
				result = BaseGameDataDomain.IsModified(this.DataStates, 29);
				break;
			default:
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(19, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(dataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			}
			return result;
		}

		// Token: 0x0600740C RID: 29708 RVA: 0x0043F59C File Offset: 0x0043D79C
		public override void InvalidateCache(BaseGameDataObject sourceObject, DataInfluence influence, DataContext context, bool unconditionallyInfluenceAll)
		{
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler;
			switch (influence.TargetIndicator.DataId)
			{
			case 0:
			{
				bool flag = !unconditionallyInfluenceAll;
				if (flag)
				{
					List<BaseGameDataObject> influencedObjects = InfluenceChecker.InfluencedObjectsPool.Get();
					bool influenceAll = InfluenceChecker.GetScope<int, Character>(context, sourceObject, influence.Scope, this._objects, influencedObjects);
					bool flag2 = !influenceAll;
					if (flag2)
					{
						int influencedObjectsCount = influencedObjects.Count;
						for (int i = 0; i < influencedObjectsCount; i++)
						{
							BaseGameDataObject targetObject = influencedObjects[i];
							List<DataUid> targetUids = influence.TargetUids;
							int targetUidsCount = targetUids.Count;
							for (int j = 0; j < targetUidsCount; j++)
							{
								DataUid targetUid = targetUids[j];
								targetObject.InvalidateSelfAndInfluencedCache((ushort)targetUid.SubId1, context);
							}
						}
					}
					else
					{
						BaseGameDataDomain.InvalidateAllAndInfluencedCaches(CharacterDomain.CacheInfluencesObjects, this._dataStatesObjects, influence, context);
					}
					influencedObjects.Clear();
					InfluenceChecker.InfluencedObjectsPool.Return(influencedObjects);
				}
				else
				{
					BaseGameDataDomain.InvalidateAllAndInfluencedCaches(CharacterDomain.CacheInfluencesObjects, this._dataStatesObjects, influence, context);
				}
				return;
			}
			case 1:
				break;
			case 2:
				break;
			case 3:
				break;
			case 4:
				break;
			case 5:
				break;
			case 6:
			{
				bool flag3 = !unconditionallyInfluenceAll;
				if (flag3)
				{
					List<BaseGameDataObject> influencedObjects2 = InfluenceChecker.InfluencedObjectsPool.Get();
					bool influenceAll2 = InfluenceChecker.GetScope<int, Grave>(context, sourceObject, influence.Scope, this._graves, influencedObjects2);
					bool flag4 = !influenceAll2;
					if (flag4)
					{
						int influencedObjectsCount2 = influencedObjects2.Count;
						for (int k = 0; k < influencedObjectsCount2; k++)
						{
							BaseGameDataObject targetObject2 = influencedObjects2[k];
							List<DataUid> targetUids2 = influence.TargetUids;
							int targetUidsCount2 = targetUids2.Count;
							for (int l = 0; l < targetUidsCount2; l++)
							{
								DataUid targetUid2 = targetUids2[l];
								targetObject2.InvalidateSelfAndInfluencedCache((ushort)targetUid2.SubId1, context);
							}
						}
					}
					else
					{
						BaseGameDataDomain.InvalidateAllAndInfluencedCaches(CharacterDomain.CacheInfluencesGraves, this._dataStatesGraves, influence, context);
					}
					influencedObjects2.Clear();
					InfluenceChecker.InfluencedObjectsPool.Return(influencedObjects2);
				}
				else
				{
					BaseGameDataDomain.InvalidateAllAndInfluencedCaches(CharacterDomain.CacheInfluencesGraves, this._dataStatesGraves, influence, context);
				}
				return;
			}
			case 7:
				break;
			case 8:
				break;
			case 9:
				break;
			case 10:
				break;
			case 11:
				break;
			case 12:
				break;
			case 13:
				break;
			case 14:
				break;
			case 15:
				break;
			case 16:
				break;
			case 17:
				break;
			case 18:
				break;
			case 19:
				break;
			case 20:
				break;
			case 21:
				break;
			case 22:
				break;
			case 23:
				break;
			case 24:
				break;
			case 25:
				break;
			case 26:
				break;
			case 27:
				break;
			case 28:
				break;
			case 29:
				break;
			default:
				defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(19, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(influence.TargetIndicator.DataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(48, 1);
			defaultInterpolatedStringHandler.AppendLiteral("Cannot invalidate cache state of non-cache data ");
			defaultInterpolatedStringHandler.AppendFormatted<ushort>(influence.TargetIndicator.DataId);
			throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x0600740D RID: 29709 RVA: 0x0043F8DC File Offset: 0x0043DADC
		public unsafe override void ProcessArchiveResponse(OperationWrapper operation, byte* pResult)
		{
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler;
			switch (operation.DataId)
			{
			case 0:
				ResponseProcessor.ProcessDynamicObjectCollection<int, Character>(operation, pResult, this._objects);
				break;
			case 1:
				ResponseProcessor.ProcessSingleValue_BasicType_Fixed_Value_Single<int>(operation, pResult, ref this._nextObjectId);
				break;
			case 2:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Dynamic_Ref<int, DeadCharacter>(operation, pResult, this._deadCharacters);
				break;
			case 3:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Fixed_Value<int, DeadCharDeletionState>(operation, pResult, this._deadCharDeletionStates, 2);
				break;
			case 4:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Fixed_Value<IntPair, VoidValue>(operation, pResult, this._recentDeadCharacters, 0);
				break;
			case 5:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Fixed_Value<IntPair, VoidValue>(operation, pResult, this._waitingReincarnationChars, 0);
				break;
			case 6:
				ResponseProcessor.ProcessDynamicObjectCollection<int, Grave>(operation, pResult, this._graves);
				break;
			case 7:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Dynamic_Ref<int, PregnantState>(operation, pResult, this._pregnantStates);
				break;
			case 8:
				ResponseProcessor.ProcessSingleValueCollection_BasicType_Fixed_Value<int, int>(operation, pResult, this._pregnancyLockEndDates);
				break;
			case 9:
				ResponseProcessor.ProcessSingleValue_CustomType_Dynamic_Value_Single<CharacterSet>(operation, pResult, ref this._unguardedChars);
				break;
			case 10:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Dynamic_Ref<int, KidnappedCharacterList>(operation, pResult, this._kidnappedChars);
				break;
			case 11:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Fixed_Value<RelationKey, RelatedCharacter>(operation, pResult, this._relations, 8);
				break;
			case 12:
				ResponseProcessor.ProcessSingleValueCollection_BasicType_Fixed_Value<ParentAndChild, int>(operation, pResult, this._actualBloodParents);
				break;
			case 13:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Dynamic_Value<int, CharacterSet>(operation, pResult, this._characterGroups);
				break;
			case 14:
				ResponseProcessor.ProcessSingleValueCollection_BasicType_Fixed_Value<int, int>(operation, pResult, this._joinGroupDates);
				break;
			case 15:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Dynamic_Ref<int, Debts>(operation, pResult, this._debtsToTaiwu);
				break;
			case 16:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Dynamic_Value<int, GameData.Utilities.ShortList>(operation, pResult, this._soldLibrarySkillBooks);
				break;
			case 17:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Fixed_Ref<int, CombatResourcesObsolete>(operation, pResult, this._usedCombatResourceObsoletes, 2);
				break;
			case 18:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Fixed_Value<int, AvatarElementsGrownDates>(operation, pResult, this._avatarElementGrowthProgress, 28);
				break;
			case 19:
				ResponseProcessor.ProcessSingleValue_BasicType_String_Single(operation, pResult, ref this._targetedForAssassination);
				break;
			case 20:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Dynamic_Ref<int, PrioritizedActionWrapper>(operation, pResult, this._prioritizedActions);
				break;
			case 21:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Dynamic_Ref<int, CrossAreaMoveInfo>(operation, pResult, this._crossAreaMoveInfos);
				break;
			case 22:
				ResponseProcessor.ProcessSingleValueCollection_CustomType_Dynamic_Value<int, CharacterSet>(operation, pResult, this._ongoingVengeances);
				break;
			case 23:
				ResponseProcessor.ProcessSingleValue_CustomType_Dynamic_Value_Single<CharacterSet>(operation, pResult, ref this._mournedOthersChars);
				break;
			case 24:
				ResponseProcessor.ProcessSingleValue_BasicType_Fixed_Value_Array<int>(operation, pResult, this._pregeneratedCityTownGuards, 288);
				break;
			case 25:
				ResponseProcessor.ProcessSingleValue_BasicType_Fixed_Value_List<int>(operation, pResult, this._pregeneratedRandomEnemies);
				break;
			case 26:
				goto IL_348;
			case 27:
				goto IL_348;
			case 28:
				ResponseProcessor.ProcessSingleValue_BasicType_Fixed_Value_Single<int>(operation, pResult, ref this._avoidDeathCharId);
				break;
			case 29:
				goto IL_348;
			default:
				defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(19, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Unsupported dataId ");
				defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.DataId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			bool flag = this._pendingLoadingOperationIds != null;
			if (flag)
			{
				uint currPendingOperationId = this._pendingLoadingOperationIds.Peek();
				bool flag2 = currPendingOperationId == operation.Id;
				if (flag2)
				{
					this._pendingLoadingOperationIds.Dequeue();
					bool flag3 = this._pendingLoadingOperationIds.Count <= 0;
					if (flag3)
					{
						this._pendingLoadingOperationIds = null;
						this.InitializeInternalDataOfCollections();
						this.OnLoadedArchiveData();
						DomainManager.Global.CompleteLoading(4);
					}
				}
			}
			return;
			IL_348:
			defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(52, 1);
			defaultInterpolatedStringHandler.AppendLiteral("Cannot process archive response of non-archive data ");
			defaultInterpolatedStringHandler.AppendFormatted<ushort>(operation.DataId);
			throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x0600740E RID: 29710 RVA: 0x0043FC68 File Offset: 0x0043DE68
		private void InitializeInternalDataOfCollections()
		{
			foreach (KeyValuePair<int, Character> entry in this._objects)
			{
				Character instance = entry.Value;
				instance.CollectionHelperData = this.HelperDataObjects;
				instance.DataStatesOffset = this._dataStatesObjects.Create();
			}
			foreach (KeyValuePair<int, Grave> entry2 in this._graves)
			{
				Grave instance2 = entry2.Value;
				instance2.CollectionHelperData = this.HelperDataGraves;
				instance2.DataStatesOffset = this._dataStatesGraves.Create();
			}
		}

		// Token: 0x0600740F RID: 29711 RVA: 0x0043FD48 File Offset: 0x0043DF48
		[DomainMethod]
		public int CreateProtagonist(DataContext context, ProtagonistCreationInfo info)
		{
			sbyte sectOrgTemplateId = MapDomain.GetSectOrgTemplateIdByStateTemplateId(info.TaiwuVillageStateTemplateId);
			short orgMemberId = OrganizationDomain.GetMemberId(sectOrgTemplateId, 5);
			InscribedCharacter inscribedChar = info.InscribedChar;
			sbyte gender = (inscribedChar != null) ? inscribedChar.Gender : info.Gender;
			short charTemplateId = MapDomain.GetCharacterTemplateId(info.TaiwuVillageStateTemplateId, gender);
			Character character = new Character(charTemplateId);
			Character.ProtagonistFeatureRelatedStatus status = character.OfflineCreateProtagonist(charTemplateId, orgMemberId, info, context);
			int charId = this.GenerateNextObjectId(context);
			character.OfflineSetId(charId);
			this.AddElement_Objects(charId, character);
			this.StartCreatingCharacter(charId);
			DomainManager.Extra.TryAddCharacterAvatarExtraData(context, character.GetId(), info.AvatarExtraData);
			DomainManager.CombatSkill.RegisterCombatSkills(charId, status.CombatSkills);
			this.AutoActivateReadCombatSkillNormalPages(context, status.CombatSkills, charId);
			DomainManager.Taiwu.SetTaiwu(context, character);
			DomainManager.Taiwu.RegisterProtagonistLifeSkillsAndCombatSkills(context, character.GetLearnedLifeSkills(), status.CombatSkills, status.ReadLifeSkillTemplateId, status.ReadCombatSkillTemplateId, status.CombatSkillBookPageTypes);
			short blockId = DomainManager.Map.GetMainSettlementMainBlockId(135);
			Location location = new Location(135, blockId);
			character.SetLocation(location, context);
			DomainManager.Taiwu.JoinGroup(context, charId, false);
			this.CreateAdoptiveFather(context, character);
			bool createCloseFriend = status.CreateCloseFriend;
			if (createCloseFriend)
			{
				sbyte friendGender = Gender.Flip(gender);
				short friendTemplateId = MapDomain.GetCharacterTemplateId(info.TaiwuVillageStateTemplateId, friendGender);
				this.CreateCloseFriend(context, friendTemplateId, info.Morality, character);
			}
			this.CreateXiangshuAvatars(context, character);
			character.UpdateHobbyExpirationDate(context);
			short selfLocationInformationId = MapBlock.Instance[MapArea.Instance[(short)MapState.Instance[info.TaiwuVillageStateTemplateId].MainAreaID].SettlementBlockCore[0]].InformationTemplateId;
			DomainManager.Information.AddNormalInformationToCharacter(context, charId, new NormalInformation((from i in Information.Instance
			where i.IsGeneral && i.Type == 0 && i.TemplateId != selfLocationInformationId
			select i).ToArray<InformationItem>().GetRandom(context.Random).TemplateId, 4));
			Events.RaiseCharacterCreated(context, character);
			this.CompleteCreatingCharacter(charId);
			DomainManager.Taiwu.RecordAllOwnedClothing(context);
			DomainManager.Global.OnCurrWorldArchiveDataReady(context, true);
			return charId;
		}

		// Token: 0x06007410 RID: 29712 RVA: 0x0043FF8C File Offset: 0x0043E18C
		public void ConvertFixedCharacter(DataContext context, Character fixedChar, Location location, bool recreateAttributesAndQualifications)
		{
			Tester.Assert(fixedChar.GetCreatingType() == 0, "");
			int charId = fixedChar.GetId();
			short templateId = fixedChar.GetTemplateId();
			this._fixedCharactersCache.Remove(templateId);
			this._convertedFixedCharactersCache[templateId] = charId;
			fixedChar.OfflineSetCreatingType(1);
			fixedChar.OfflineSetBirthLocation(location);
			FullName fullname = this.ConvertFixedCharacterName(context, fixedChar.GetTemplateId(), fixedChar.GetGender());
			fixedChar.SetFullName(fullname, context);
			if (recreateAttributesAndQualifications)
			{
				sbyte growingSectId = fixedChar.GetIdealSect();
				bool flag = growingSectId < 0;
				if (flag)
				{
					growingSectId = fixedChar.GetOrganizationInfo().OrgTemplateId;
				}
				fixedChar.OfflineRecreateByGrowingSect(context.Random, growingSectId, 4);
			}
			this.RemoveElement_Objects(charId);
			this.AddElement_Objects(charId, fixedChar);
			OrganizationInfo orgInfo = fixedChar.GetOrganizationInfo();
			bool flag2 = OrganizationDomain.IsSect(orgInfo.OrgTemplateId);
			if (flag2)
			{
				orgInfo.SettlementId = DomainManager.Organization.GetSettlementIdByOrgTemplateId(orgInfo.OrgTemplateId);
				fixedChar.SetOrganizationInfo(orgInfo, context);
				DomainManager.Organization.JoinOrganization(context, fixedChar, orgInfo);
			}
			else
			{
				bool flag3 = orgInfo.OrgTemplateId == 20 || orgInfo.OrgTemplateId == 19;
				if (flag3)
				{
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(47, 1);
					defaultInterpolatedStringHandler.AppendFormatted<int>(fixedChar.GetId());
					defaultInterpolatedStringHandler.AppendLiteral(" is either XiangshuInfected or XiangshuMinion, ");
					throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear() + "thus cannot be converted from fixed character to intelligent character");
				}
				bool flag4 = orgInfo.OrgTemplateId != 0;
				if (flag4)
				{
					fixedChar.SetOrganizationInfo(OrganizationInfo.None, context);
				}
			}
			fixedChar.SetCurrMainAttributes(fixedChar.GetMaxMainAttributes(), context);
			DomainManager.Information.RegisterInformation(charId, context);
			Location srcLocation = fixedChar.GetLocation();
			Events.RaiseFixedCharacterLocationChanged(context, charId, srcLocation, Location.Invalid);
			fixedChar.SetLocation(location, context);
			Events.RaiseCharacterLocationChanged(context, charId, Location.Invalid, location);
		}

		// Token: 0x06007411 RID: 29713 RVA: 0x00440158 File Offset: 0x0043E358
		private FullName ConvertFixedCharacterName(DataContext context, short templateId, sbyte gender)
		{
			CharacterItem config = Character.Instance[templateId];
			int customSurnameId = string.IsNullOrEmpty(config.Surname) ? -1 : DomainManager.World.RegisterCustomText(context, config.Surname);
			int customGivenNameId = string.IsNullOrEmpty(config.GivenName) ? -1 : DomainManager.World.RegisterCustomText(context, config.GivenName);
			FullName fullName = (config.Race == 0) ? CharacterDomain.GenerateRandomHanName(context.Random, customSurnameId, -1, gender, 0) : CharacterDomain.GenerateRandomZangName(context.Random, gender);
			bool flag = customGivenNameId >= 0;
			if (flag)
			{
				fullName.SetCustomGivenName(customGivenNameId);
			}
			return fullName;
		}

		// Token: 0x06007412 RID: 29714 RVA: 0x004401FC File Offset: 0x0043E3FC
		public Character CreateFixedCharacter(DataContext context, short templateId)
		{
			Tester.Assert(Character.Instance[templateId].CreatingType == 0, "");
			bool flag = this._fixedCharactersCache.ContainsKey(templateId);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(41, 1);
				defaultInterpolatedStringHandler.AppendLiteral("FixedCharacter ");
				defaultInterpolatedStringHandler.AppendFormatted<short>(templateId);
				defaultInterpolatedStringHandler.AppendLiteral(" has already been created.");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			Character fixedCharacter = this.CreatePresetCharacter(context, templateId);
			this._fixedCharactersCache.Add(templateId, fixedCharacter.GetId());
			DomainManager.LegendaryBook.UpdateBossCharacterLegendaryBookFeatures(context, fixedCharacter);
			return fixedCharacter;
		}

		// Token: 0x06007413 RID: 29715 RVA: 0x004402A0 File Offset: 0x0043E4A0
		public Character CreateFixedEnemy(DataContext context, short templateId)
		{
			Tester.Assert(Character.Instance[templateId].CreatingType == 3, "");
			return this.CreatePresetCharacter(context, templateId);
		}

		// Token: 0x06007414 RID: 29716 RVA: 0x004402D8 File Offset: 0x0043E4D8
		public Character CreateFixedEnemyWithCreationInfo(DataContext context, short templateId, ref FixedEnemyCreationInfo creationInfo)
		{
			Character character = new Character(templateId);
			bool flag = creationInfo.Gender != -1;
			if (flag)
			{
				character.OfflineSetGenderInfo(creationInfo.Gender, character.GetTransgender());
			}
			List<GameData.Domains.CombatSkill.CombatSkill> combatSkills = character.OfflineCreatePresetCharacter(templateId, context);
			this.ComplementCreatePresetCharacter(context, character, combatSkills);
			return character;
		}

		// Token: 0x06007415 RID: 29717 RVA: 0x00440328 File Offset: 0x0043E528
		private Character CreatePresetCharacter(DataContext context, short templateId)
		{
			Character character = new Character(templateId);
			List<GameData.Domains.CombatSkill.CombatSkill> combatSkills = character.OfflineCreatePresetCharacter(templateId, context);
			this.ComplementCreatePresetCharacter(context, character, combatSkills);
			return character;
		}

		// Token: 0x06007416 RID: 29718 RVA: 0x00440358 File Offset: 0x0043E558
		private void ComplementCreatePresetCharacter(DataContext context, Character character, List<GameData.Domains.CombatSkill.CombatSkill> combatSkills)
		{
			int charId = this.GenerateNextObjectId(context);
			character.OfflineSetId(charId);
			this.AddElement_Objects(charId, character);
			this.StartCreatingCharacter(charId);
			DomainManager.CombatSkill.RegisterCombatSkills(charId, combatSkills);
			DomainManager.Extra.InitCombatSkillProficiency(context, character);
			this.AutoActivateReadCombatSkillNormalPages(context, combatSkills, charId);
			Events.RaiseCharacterCreated(context, character);
		}

		// Token: 0x06007417 RID: 29719 RVA: 0x004403B3 File Offset: 0x0043E5B3
		public void OnCharacterCreated(DataContext context, Character character)
		{
			this.InitializeCharacterItemOwnersOnCreation(context, character);
			this.InitializeEatingItems(context, character);
		}

		// Token: 0x06007418 RID: 29720 RVA: 0x004403C8 File Offset: 0x0043E5C8
		public Character CreateIntelligentCharacter(DataContext context, ref IntelligentCharacterCreationInfo info)
		{
			sbyte stateId = DomainManager.Map.GetStateIdByAreaId(info.Location.AreaId);
			info.GrowingSectGrade = DomainManager.Taiwu.PopStateNewCharacterLegacyGrowingGrade(context, stateId, info.GrowingSectGrade);
			CreateIntelligentCharacterModification mod = CharacterDomain.ParallelCreateIntelligentCharacter(context, ref info, false);
			return this.ComplementCreateIntelligentCharacter(context, mod, false);
		}

		// Token: 0x06007419 RID: 29721 RVA: 0x0044041C File Offset: 0x0043E61C
		public Character CreateIntelligentCharacterFromInscription(DataContext context, InscribedCharacter inscribedChar, OrganizationInfo targetOrgInfo)
		{
			Settlement settlement = DomainManager.Organization.GetSettlement(targetOrgInfo.SettlementId);
			sbyte stateTemplateId = DomainManager.Map.GetStateTemplateIdByAreaId(settlement.GetLocation().AreaId);
			short charTemplateId = OrganizationDomain.GetCharacterTemplateId(targetOrgInfo.OrgTemplateId, stateTemplateId, inscribedChar.Gender);
			Character character = new Character(charTemplateId);
			CreateIntelligentCharacterModification mod = new CreateIntelligentCharacterModification
			{
				Self = character,
				FatherCharId = -1,
				MotherCharId = -1,
				CreateFatherRelation = false,
				CreateMotherRelation = false,
				ReincarnationCharId = -1
			};
			character.OfflineCreateCharacterFromInscription(context, mod, inscribedChar, targetOrgInfo);
			this.ComplementCreateIntelligentCharacter(context, mod, false);
			return character;
		}

		// Token: 0x0600741A RID: 29722 RVA: 0x004404BC File Offset: 0x0043E6BC
		public static CreateIntelligentCharacterModification ParallelCreateIntelligentCharacter(DataContext context, ref IntelligentCharacterCreationInfo info, bool recordModification = true)
		{
			CreateIntelligentCharacterModification createIntelligentCharacterModification = new CreateIntelligentCharacterModification();
			createIntelligentCharacterModification.FatherCharId = info.FatherCharId;
			createIntelligentCharacterModification.MotherCharId = info.MotherCharId;
			createIntelligentCharacterModification.CreateFatherRelation = (info.PregnantState != null && (info.PregnantState.CreateFatherRelation || info.FatherCharId != info.PregnantState.FatherId));
			PregnantState pregnantState = info.PregnantState;
			createIntelligentCharacterModification.CreateMotherRelation = (pregnantState != null && pregnantState.CreateMotherRelation);
			createIntelligentCharacterModification.ReincarnationCharId = info.ReincarnationCharId;
			createIntelligentCharacterModification.DisableBeReincarnatedBySavedSoul = info.DisableBeReincarnatedBySavedSoul;
			CreateIntelligentCharacterModification mod = createIntelligentCharacterModification;
			Character character = new Character(info.CharTemplateId);
			mod.Self = character;
			character.OfflineCreateIntelligentCharacter(context, mod, ref info);
			if (recordModification)
			{
				ParallelModificationsRecorder recorder = context.ParallelModificationsRecorder;
				recorder.RecordType(ParallelModificationType.CreateIntelligentCharacter);
				recorder.RecordParameterClass<CreateIntelligentCharacterModification>(mod);
				recorder.RecordParameterUnmanaged<bool>(true);
			}
			return mod;
		}

		// Token: 0x0600741B RID: 29723 RVA: 0x0044059C File Offset: 0x0043E79C
		public Character ComplementCreateIntelligentCharacter(DataContext context, CreateIntelligentCharacterModification mod, bool autoComplement)
		{
			Character father = mod.Father;
			if (father != null)
			{
				father.SetLegitimateBoysCount(mod.FathersLegitimateBoysCount, context);
			}
			int charId = this.GenerateNextObjectId(context);
			Character character = mod.Self;
			character.OfflineSetId(charId);
			mod.ReincarnationCharId = this.PickReincarnationChar(context, character.GetBirthDate(), mod.ReincarnationCharId, mod.DisableBeReincarnatedBySavedSoul);
			bool flag = mod.ReincarnationCharId >= 0;
			if (flag)
			{
				character.OfflineSetPreexistenceCharId(context, mod.ReincarnationCharId);
			}
			this.ModifySavedSoulCharacter(context, mod, character);
			this.AddElement_Objects(charId, character);
			this.StartCreatingCharacter(charId);
			DomainManager.CombatSkill.RegisterCombatSkills(charId, mod.CombatSkills);
			DomainManager.Extra.InitCombatSkillProficiency(context, character);
			this.AutoActivateReadCombatSkillNormalPages(context, mod.CombatSkills, charId);
			character.AddEquipmentAndInventoryItems(context, mod.Equipment, mod.Inventory);
			bool flag2 = mod.SkillWeaponIds != null && mod.SkillWeaponIds != null;
			if (flag2)
			{
				character.AddSkillBooksAndWeapons(context, mod.InventorySkillBooks, mod.SkillWeaponIds);
			}
			Events.RaiseCharacterLocationChanged(context, charId, Location.Invalid, character.GetLocation());
			this.SetBloodRelatedRelations(context, charId, mod.MotherCharId, mod.FatherCharId, -1, mod.CreateMotherRelation, mod.CreateFatherRelation);
			DomainManager.Organization.JoinOrganization(context, character, character.GetOrganizationInfo());
			bool flag3 = character.GetCurrInventoryLoad() > character.GetMaxInventoryLoad();
			if (flag3)
			{
				this.CreateAccessoryForMaxLoad(context, character);
			}
			character.UpdateHobbyExpirationDate(context);
			bool flag4 = mod.ReincarnationCharId >= 0;
			if (flag4)
			{
				Events.RaiseCharacterReincarnated(context, character, mod.ReincarnationCharId);
			}
			Events.RaiseCharacterCreated(context, character);
			DomainManager.Information.RegisterInformation(charId, context);
			sbyte ageGroup = character.GetAgeGroup();
			bool flag5 = ageGroup == 0;
			if (flag5)
			{
				this.AddInfant(charId);
			}
			else
			{
				bool flag6 = ageGroup == 2;
				if (flag6)
				{
					this.GenerateCharacterProfession(context, character);
				}
			}
			if (autoComplement)
			{
				this.CompleteCreatingCharacter(charId);
			}
			return character;
		}

		// Token: 0x0600741C RID: 29724 RVA: 0x00440788 File Offset: 0x0043E988
		public void AutoActivateReadCombatSkillNormalPages(DataContext context, IEnumerable<GameData.Domains.CombatSkill.CombatSkill> combatSkills, int charId)
		{
			foreach (GameData.Domains.CombatSkill.CombatSkill combatSkill in combatSkills)
			{
				ushort activatedState = combatSkill.GetActivationState();
				bool flag = CombatSkillStateHelper.IsBrokenOut(activatedState);
				if (!flag)
				{
					ushort readingState = combatSkill.GetReadingState();
					byte pageId = 1;
					while (pageId < 6)
					{
						byte directInternalIndex = CombatSkillStateHelper.GetNormalPageInternalIndex(0, pageId);
						bool directRead = CombatSkillStateHelper.IsPageRead(readingState, directInternalIndex);
						byte reverseInternalIndex = CombatSkillStateHelper.GetNormalPageInternalIndex(1, pageId);
						bool reverseRead = CombatSkillStateHelper.IsPageRead(readingState, reverseInternalIndex);
						bool flag2 = directRead && reverseRead;
						byte targetInternalIndex;
						if (flag2)
						{
							targetInternalIndex = (context.Random.NextBool() ? directInternalIndex : reverseInternalIndex);
							goto IL_A6;
						}
						bool flag3 = directRead;
						if (flag3)
						{
							targetInternalIndex = directInternalIndex;
							goto IL_A6;
						}
						bool flag4 = reverseRead;
						if (flag4)
						{
							targetInternalIndex = reverseInternalIndex;
							goto IL_A6;
						}
						IL_C1:
						pageId += 1;
						continue;
						IL_A6:
						DomainManager.CombatSkill.TryActivateCombatSkillBookPageWhenSetReadingState(context, charId, combatSkill.GetId().SkillTemplateId, targetInternalIndex);
						goto IL_C1;
					}
				}
			}
		}

		// Token: 0x0600741D RID: 29725 RVA: 0x00440894 File Offset: 0x0043EA94
		public void ModifySavedSoulCharacter(DataContext context, CreateIntelligentCharacterModification mod, Character character)
		{
			bool flag = !DomainManager.Extra.IsSavedSoul(mod.ReincarnationCharId);
			if (!flag)
			{
				DeadCharacter deadCharacter;
				bool flag2 = this._deadCharacters.TryGetValue(mod.ReincarnationCharId, out deadCharacter);
				if (flag2)
				{
					character.OfflineRecreateByGrowingSect(context.Random, character.GetOrganizationInfo().OrgTemplateId, (sbyte)Math.Min((int)(deadCharacter.OrganizationInfo.Grade + 1), 8));
					sbyte oldGender = deadCharacter.Gender;
					AvatarData oldAvatar = deadCharacter.Avatar;
					bool newTransGender = oldGender != oldAvatar.GetGender();
					character.OfflineSetGenderInfo(oldGender, newTransGender);
					character.OfflineSetAvatar(oldAvatar);
				}
			}
		}

		// Token: 0x0600741E RID: 29726 RVA: 0x00440934 File Offset: 0x0043EB34
		private void CreateAccessoryForMaxLoad(DataContext context, Character character)
		{
			short templateId = 90;
			sbyte grade = ItemDomain.GenerateRandomItemGrade(context.Random, character.GetOrganizationInfo().Grade);
			ItemKey accessory = DomainManager.Item.CreateAccessory(context, templateId + (short)grade, grade);
			character.AddInventoryItem(context, accessory, 1, false);
		}

		// Token: 0x0600741F RID: 29727 RVA: 0x00440978 File Offset: 0x0043EB78
		public Character CreateSkeletonCharacter(DataContext context, Grave grave)
		{
			int deadCharId = grave.GetId();
			DeadCharacter deadChar = this.TryGetDeadCharacter(deadCharId);
			bool flag = AgeGroup.GetAgeGroup(deadChar.CurrAge) != 2;
			Character result;
			if (flag)
			{
				result = null;
			}
			else
			{
				int templateId = 298 + (int)deadChar.OrganizationInfo.Grade;
				Character randomEnemy = this.CreateRandomEnemy(context, (short)templateId, deadChar);
				int skeletonCharId = randomEnemy.GetId();
				grave.SetSkeletonCharId(skeletonCharId, context);
				this._skeletonCharacterCache.Add(skeletonCharId, deadCharId);
				this.CompleteCreatingCharacter(skeletonCharId);
				randomEnemy.SetFullName(deadChar.FullName, context);
				randomEnemy.SetMonkType(deadChar.MonkType, context);
				randomEnemy.SetActualAge(deadChar.GetActualAge(), context);
				randomEnemy.SetCurrAge(deadChar.CurrAge, context);
				randomEnemy.SetMonasticTitle(deadChar.MonasticTitle, context);
				randomEnemy.SetLocation(grave.GetLocation(), context);
				Events.RaiseEnemyCharacterLocationChanged(context, skeletonCharId, Location.Invalid, randomEnemy.GetLocation());
				AvatarData avatarData = new AvatarData(deadChar.Avatar);
				avatarData.ConvertAvatarToSkeleton();
				randomEnemy.SetAvatar(avatarData, context);
				ItemKey oldClothingKey = randomEnemy.GetEquipment()[4];
				sbyte grade = deadChar.OrganizationInfo.Grade;
				if (!true)
				{
				}
				short num;
				if (grade <= 5)
				{
					if (grade >= 0)
					{
						if (grade > 2)
						{
							num = 70;
							goto IL_193;
						}
						num = 69;
						goto IL_193;
					}
				}
				else if (grade <= 8)
				{
					num = 71;
					goto IL_193;
				}
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(37, 2);
				defaultInterpolatedStringHandler.AppendLiteral("dead character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(deadCharId);
				defaultInterpolatedStringHandler.AppendLiteral(" has an invalid grade ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(deadChar.OrganizationInfo.Grade);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
				IL_193:
				if (!true)
				{
				}
				short clothingId = num;
				ItemKey newClothingKey = DomainManager.Item.CreateItem(context, 3, clothingId);
				randomEnemy.AddInventoryItem(context, newClothingKey, 1, false);
				randomEnemy.ChangeEquipment(context, -1, 4, newClothingKey);
				bool flag2 = oldClothingKey.IsValid();
				if (flag2)
				{
					randomEnemy.RemoveInventoryItem(context, oldClothingKey, 1, true, false);
				}
				result = randomEnemy;
			}
			return result;
		}

		// Token: 0x06007420 RID: 29728 RVA: 0x00440B6C File Offset: 0x0043ED6C
		public Character CreateRandomEnemy(DataContext context, short templateId, DeadCharacter deadCharacter = null)
		{
			Character character = new Character(templateId);
			bool flag = deadCharacter != null;
			if (flag)
			{
				character.OfflineSetGenderInfo(deadCharacter.Gender, deadCharacter.Avatar.Gender == deadCharacter.Gender);
			}
			List<GameData.Domains.CombatSkill.CombatSkill> combatSkills = character.OfflineCreateRandomEnemy(templateId, context);
			int charId = this.GenerateNextObjectId(context);
			character.OfflineSetId(charId);
			this.AddElement_Objects(charId, character);
			this.StartCreatingCharacter(charId);
			DomainManager.CombatSkill.RegisterCombatSkills(charId, combatSkills);
			DomainManager.Extra.InitCombatSkillProficiency(context, character);
			this.AutoActivateReadCombatSkillNormalPages(context, combatSkills, charId);
			Events.RaiseCharacterCreated(context, character);
			character.RemoveUnequippedCombatSkills(context, 25);
			return character;
		}

		// Token: 0x06007421 RID: 29729 RVA: 0x00440C14 File Offset: 0x0043EE14
		public void ConvertRandomEnemy(DataContext context, Character character, Location location)
		{
			Tester.Assert(character.GetCreatingType() == 2, "");
			OrganizationInfo srcOrgInfo = character.GetOrganizationInfo();
			sbyte orgTemplateId = srcOrgInfo.OrgTemplateId;
			bool flag = orgTemplateId - 19 <= 1;
			bool flag2 = flag;
			if (flag2)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(47, 1);
				defaultInterpolatedStringHandler.AppendFormatted<int>(character.GetId());
				defaultInterpolatedStringHandler.AppendLiteral(" is either XiangshuInfected or XiangshuMinion, ");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear() + "thus cannot be converted from random enemy to intelligent character");
			}
			bool flag3 = !location.IsValid() || location.AreaId >= 135;
			if (flag3)
			{
				location = DomainManager.Taiwu.GetTaiwuVillageLocation();
			}
			int charId = character.GetId();
			short templateId = character.GetTemplateId();
			CharacterItem template = Character.Instance[templateId];
			sbyte gender = character.GetGender();
			sbyte stateTemplateId = DomainManager.Map.GetStateTemplateIdByAreaId(location.AreaId);
			sbyte growingSectId = MapState.Instance[stateTemplateId].SectID;
			short charTemplateId = OrganizationDomain.GetCharacterTemplateId(growingSectId, stateTemplateId, gender);
			character.OfflineSetTemplateId(charTemplateId);
			character.OfflineSetCreatingType(1);
			character.OfflineCreateRandomName(context.Random, -1, -1);
			character.OfflineSetBirthLocation(location);
			character.SetFullName(character.GetFullName(), context);
			List<short> featureIds = character.GetFeatureIds();
			featureIds.Remove(340);
			this.RemoveElement_Objects(charId);
			this.AddElement_Objects(charId, character);
			OrganizationInfo targetOrgInfo = OrganizationInfo.None;
			character.SetOrganizationInfo(targetOrgInfo, context);
			Events.RaiseCharacterOrganizationChanged(context, character, srcOrgInfo, targetOrgInfo);
			DomainManager.Adventure.RemoveTemporaryEnemyId(charId);
			DomainManager.Information.RegisterInformation(charId, context);
			Location srcLocation = character.GetLocation();
			character.SetLocation(location, context);
			bool flag4 = character.IsCompletelyInfected();
			if (flag4)
			{
				Events.RaiseInfectedCharacterLocationChanged(context, charId, srcLocation, location);
			}
			else
			{
				Events.RaiseCharacterLocationChanged(context, charId, srcLocation, location);
			}
		}

		// Token: 0x06007422 RID: 29730 RVA: 0x00440DE4 File Offset: 0x0043EFE4
		public Character CreateTemporaryIntelligentCharacter(DataContext context, short characterFilterRulesId, Location location)
		{
			TemporaryIntelligentCharacterCreationInfo tmpInfo = new TemporaryIntelligentCharacterCreationInfo
			{
				Location = location
			};
			GameData.Domains.Character.Filters.CharacterFilterRules.GetRandomCharacterPropertiesWithRulesId(context.Random, characterFilterRulesId, ref tmpInfo);
			return this.CreateTemporaryIntelligentCharacter(context, ref tmpInfo);
		}

		// Token: 0x06007423 RID: 29731 RVA: 0x00440E20 File Offset: 0x0043F020
		public Character CreateTemporaryIntelligentCharacter(DataContext context, ref TemporaryIntelligentCharacterCreationInfo tmpInfo)
		{
			IntelligentCharacterCreationInfo info = new IntelligentCharacterCreationInfo(tmpInfo.Location, tmpInfo.OrgInfo, tmpInfo.CharTemplateId);
			bool flag = tmpInfo.ActualAge != null;
			if (flag)
			{
				info.Age = tmpInfo.ActualAge.Value;
			}
			bool flag2 = tmpInfo.BaseAttraction != null;
			if (flag2)
			{
				info.BaseAttraction = tmpInfo.BaseAttraction.Value;
			}
			Character character = new Character(info.CharTemplateId);
			CreateIntelligentCharacterModification mod = new CreateIntelligentCharacterModification
			{
				Self = character
			};
			character.OfflineCreateTemporaryIntelligentCharacter(context, mod, ref info, ref tmpInfo);
			int charId = this.GenerateNextObjectId(context);
			character.OfflineSetId(charId);
			this.AddElement_Objects(charId, character);
			this.StartCreatingCharacter(charId);
			bool flag3 = tmpInfo.MonkType != null;
			if (flag3)
			{
				CharacterDomain.SetMonkOfTemporaryIntelligentCharacter(context, character, tmpInfo.MonkType.Value);
			}
			DomainManager.CombatSkill.RegisterCombatSkills(charId, mod.CombatSkills);
			DomainManager.Extra.InitCombatSkillProficiency(context, character);
			this.AutoActivateReadCombatSkillNormalPages(context, mod.CombatSkills, charId);
			character.AddEquipmentAndInventoryItems(context, mod.Equipment, mod.Inventory);
			character.AddSkillBooksAndWeapons(context, mod.InventorySkillBooks, mod.SkillWeaponIds);
			character.ChangeResources(context, ref tmpInfo.Resources);
			OrganizationInfo orgInfo = character.GetOrganizationInfo();
			bool flag4 = OrganizationDomain.IsSect(orgInfo.OrgTemplateId) && orgInfo.Grade == 8 && orgInfo.Principal;
			if (flag4)
			{
				character.AddFeature(context, 405, false);
			}
			DomainManager.Organization.TryAddSectMemberFeature(context, character, orgInfo);
			Events.RaiseCharacterCreated(context, character);
			this.CompleteCreatingCharacter(charId);
			this.RegisterTemporaryIntelligentCharacter(charId);
			return character;
		}

		// Token: 0x06007424 RID: 29732 RVA: 0x00440FC8 File Offset: 0x0043F1C8
		public void ConvertTemporaryIntelligentCharacter(DataContext context, Character character)
		{
			int charId = character.GetId();
			bool flag = character.IsCompletelyInfected();
			if (flag)
			{
				Events.RaiseInfectedCharacterLocationChanged(context, charId, Location.Invalid, character.GetLocation());
			}
			else
			{
				Events.RaiseCharacterLocationChanged(context, charId, Location.Invalid, character.GetLocation());
			}
			DomainManager.Organization.JoinOrganization(context, character, character.GetOrganizationInfo());
			DomainManager.Adventure.KeepTemporaryCharacterAfterAdventure(charId);
			character.UpdateHobbyExpirationDate(context);
			this.UnregisterTemporaryIntelligentCharacter(charId);
		}

		// Token: 0x06007425 RID: 29733 RVA: 0x00441040 File Offset: 0x0043F240
		public Character CreateTemporaryCopyOfCharacter(DataContext context, Character srcCharacter)
		{
			int srcCharId = srcCharacter.GetId();
			Character character = Serializer.CreateCopy<Character>(srcCharacter);
			int charId = this.GenerateNextObjectId(context);
			character.OfflineSetId(charId);
			character.OfflineSetCopySource(srcCharId);
			this.AddElement_Objects(charId, character);
			this.StartCreatingCharacter(charId);
			List<GameData.Domains.CombatSkill.CombatSkill> combatSkills = ObjectPool<List<GameData.Domains.CombatSkill.CombatSkill>>.Instance.Get();
			combatSkills.Clear();
			foreach (short combatSkillId in srcCharacter.GetLearnedCombatSkills())
			{
				GameData.Domains.CombatSkill.CombatSkill srcSkill = DomainManager.CombatSkill.GetElement_CombatSkills(new CombatSkillKey(srcCharId, combatSkillId));
				GameData.Domains.CombatSkill.CombatSkill newSkill = Serializer.CreateCopy<GameData.Domains.CombatSkill.CombatSkill>(srcSkill);
				newSkill.OfflineSetCharId(charId);
				newSkill.OfflineSetSpecialEffectId(-1L);
				combatSkills.Add(newSkill);
			}
			DomainManager.CombatSkill.RegisterCombatSkills(charId, combatSkills);
			this.AutoActivateReadCombatSkillNormalPages(context, combatSkills, charId);
			DomainManager.Extra.CopyCombatSkillProficiency(context, srcCharId, charId);
			ObjectPool<List<GameData.Domains.CombatSkill.CombatSkill>>.Instance.Return(combatSkills);
			foreach (ItemKey srcItemKey in srcCharacter.GetEquipment())
			{
				bool flag = !srcItemKey.IsValid();
				if (!flag)
				{
					ItemKey itemKey = DomainManager.Item.CreateCopyOfItem(context, srcItemKey);
					character.AddInventoryItem(context, itemKey, 1, false);
				}
			}
			Dictionary<ItemKey, int> srcCharInventoryItems = srcCharacter.GetInventory().Items;
			foreach (KeyValuePair<ItemKey, int> keyValuePair in srcCharInventoryItems)
			{
				ItemKey itemKey3;
				int num;
				keyValuePair.Deconstruct(out itemKey3, out num);
				ItemKey srcItemKey2 = itemKey3;
				int amount = num;
				bool flag2 = ItemTemplateHelper.GetItemSubType(srcItemKey2.ItemType, srcItemKey2.TemplateId) == 1202;
				if (!flag2)
				{
					ItemKey itemKey2 = DomainManager.Item.CreateCopyOfItem(context, srcItemKey2);
					character.AddInventoryItem(context, itemKey2, amount, false);
				}
			}
			character.SetLocation(srcCharacter.GetValidLocation(), context);
			DomainManager.Information.RegisterInformation(charId, context);
			Events.RaiseCharacterCreated(context, character);
			this.CompleteCreatingCharacter(charId);
			this.RegisterTemporaryIntelligentCharacter(charId);
			return character;
		}

		// Token: 0x06007426 RID: 29734 RVA: 0x00441278 File Offset: 0x0043F478
		public void Possession(DataContext context, int charId, DeadCharacter deadChar, Character bodyChar, AvatarData customAvatarData)
		{
			this.RemoveElement_Objects(charId);
			bodyChar.OfflinePossession(deadChar);
			this.AddElement_Objects(charId, bodyChar);
			bool flag = customAvatarData != null;
			if (flag)
			{
				bodyChar.SetAvatar(context, customAvatarData);
			}
		}

		// Token: 0x06007427 RID: 29735 RVA: 0x004412B8 File Offset: 0x0043F4B8
		public void PossessionRemoveWaitingReincarnationChar(DataContext context, int charId)
		{
			IntPair target = default(IntPair);
			bool found = false;
			foreach (IntPair pair in this._waitingReincarnationChars.Collection)
			{
				bool flag = pair.Second == charId;
				if (flag)
				{
					found = true;
					target = pair;
					break;
				}
			}
			bool flag2 = found;
			if (flag2)
			{
				this.RemoveElement_WaitingReincarnationChars(target, context);
			}
		}

		// Token: 0x06007428 RID: 29736 RVA: 0x00441340 File Offset: 0x0043F540
		private int GenerateNextObjectId(DataContext context)
		{
			int objectId = this._nextObjectId;
			this._nextObjectId++;
			bool flag = this._nextObjectId > int.MaxValue;
			if (flag)
			{
				this._nextObjectId = 0;
			}
			this.SetNextObjectId(this._nextObjectId, context);
			return objectId;
		}

		// Token: 0x06007429 RID: 29737 RVA: 0x00441390 File Offset: 0x0043F590
		private void InitializeCharacterItemOwnersOnCreation(DataContext context, Character character)
		{
			int charId = character.GetId();
			Inventory inventory = character.GetInventory();
			foreach (KeyValuePair<ItemKey, int> keyValuePair in inventory.Items)
			{
				ItemKey itemKey3;
				int num;
				keyValuePair.Deconstruct(out itemKey3, out num);
				ItemKey itemKey = itemKey3;
				DomainManager.Item.SetOwner(itemKey, ItemOwnerType.CharacterInventory, charId);
			}
			ItemKey[] equipments = character.GetEquipment();
			foreach (ItemKey itemKey2 in equipments)
			{
				bool flag = !itemKey2.IsValid();
				if (!flag)
				{
					EquipmentBase baseEquipment = DomainManager.Item.GetBaseEquipment(itemKey2);
					baseEquipment.SetEquippedCharId(charId, context);
					baseEquipment.SetOwner(ItemOwnerType.CharacterEquipment, charId);
				}
			}
		}

		// Token: 0x0600742A RID: 29738 RVA: 0x0044146C File Offset: 0x0043F66C
		private void InitializeEatingItems(DataContext context, Character character)
		{
			CharacterItem template = character.Template;
			bool flag = template.PresetEatingItems == null;
			if (!flag)
			{
				foreach (PresetItemTemplateId templateKey in template.PresetEatingItems)
				{
					bool flag2 = ItemTemplateHelper.IsWug(templateKey.ItemType, templateKey.TemplateId, false);
					if (flag2)
					{
						character.AddWug(context, templateKey.TemplateId);
					}
					else
					{
						ItemKey itemKey = DomainManager.Item.CreateItem(context, templateKey.ItemType, templateKey.TemplateId);
						character.AddEatingItem(context, itemKey, null);
					}
				}
			}
		}

		// Token: 0x0600742B RID: 29739 RVA: 0x00441524 File Offset: 0x0043F724
		internal int GetRandomValidAdopterInSettlement(IRandomSource random, Settlement settlement)
		{
			List<int> allMemberIds = ObjectPool<List<int>>.Instance.Get();
			settlement.GetMembers().GetAllMembers(allMemberIds);
			CharacterMatcherItem matcher = CharacterMatcher.DefValue.CanAdoptChild;
			for (int i = allMemberIds.Count - 1; i >= 0; i--)
			{
				int charId = allMemberIds[i];
				Character character = this.GetElement_Objects(charId);
				bool flag = !matcher.Match(character);
				if (flag)
				{
					CollectionUtils.SwapAndRemove<int>(allMemberIds, i);
				}
			}
			int adopterId = allMemberIds.GetRandom(random);
			ObjectPool<List<int>>.Instance.Return(allMemberIds);
			return adopterId;
		}

		// Token: 0x0600742C RID: 29740 RVA: 0x004415B8 File Offset: 0x0043F7B8
		private void CreateAdoptiveFather(DataContext context, Character protagonistChar)
		{
			Character character = this.CreateFixedCharacter(context, 453);
			int charId = character.GetId();
			int protagonistCharId = protagonistChar.GetId();
			bool flag = !RelationTypeHelper.AllowAddingAdoptiveParentRelation(protagonistCharId, charId);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(43, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to add adoptive parent relation: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(protagonistCharId);
				defaultInterpolatedStringHandler.AppendLiteral(" - ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			this.AddRelation(context, protagonistCharId, charId, 64, int.MinValue);
			this.DirectlySetFavorabilities(context, protagonistCharId, charId, 30000, 30000);
			this.CompleteCreatingCharacter(charId);
		}

		// Token: 0x0600742D RID: 29741 RVA: 0x00441660 File Offset: 0x0043F860
		public Character CreateCloseFriend(DataContext context, short charTemplateId, short morality, Character protagonistChar)
		{
			short settlementId = DomainManager.Organization.GetSettlementIdByOrgTemplateId(0);
			OrganizationInfo orgInfo = new OrganizationInfo(0, 8, true, settlementId);
			IntelligentCharacterCreationInfo info = new IntelligentCharacterCreationInfo(protagonistChar.GetLocation(), orgInfo, charTemplateId)
			{
				GrowingSectGrade = 8,
				Age = 13,
				BaseAttraction = 900
			};
			CreateIntelligentCharacterModification mod = CharacterDomain.ParallelCreateIntelligentCharacter(context, ref info, false);
			Character character = mod.Self;
			character.OfflineSetCloseFriendFields(context, morality);
			FeatureCreationContext creationContext = new FeatureCreationContext(character, ref info)
			{
				IsProtagonist = true,
				AllGoodBasicFeature = true
			};
			CharacterCreation.CreateFeatures(context.Random, ref creationContext);
			this.ComplementCreateIntelligentCharacter(context, mod, false);
			int charId = character.GetId();
			DomainManager.Taiwu.JoinGroup(context, charId, false);
			int protagonistCharId = protagonistChar.GetId();
			bool flag = !RelationTypeHelper.AllowAddingFriendRelation(protagonistCharId, charId);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(34, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Failed to add friend relation: ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(protagonistCharId);
				defaultInterpolatedStringHandler.AppendLiteral(" - ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			this.AddRelation(context, protagonistCharId, charId, 8192, int.MinValue);
			this.DirectlySetFavorabilities(context, protagonistCharId, charId, 30000, 30000);
			this.CompleteCreatingCharacter(charId);
			return character;
		}

		// Token: 0x0600742E RID: 29742 RVA: 0x004417C0 File Offset: 0x0043F9C0
		private void CreateXiangshuAvatars(DataContext context, Character protagonistChar)
		{
			int taiwuCharId = protagonistChar.GetId();
			for (int avatarId = 0; avatarId < 9; avatarId++)
			{
				short charTemplateId = XiangshuAvatarIds.JuniorXiangshuTemplateIds[avatarId];
				Character xiangshuAvatar = this.CreateFixedCharacter(context, charTemplateId);
				int avatarCharId = xiangshuAvatar.GetId();
				this.CompleteCreatingCharacter(avatarCharId);
				this.AddRelation(context, taiwuCharId, avatarCharId, 0, int.MinValue);
				this.DirectlySetFavorabilities(context, taiwuCharId, avatarCharId, 0, 0);
				XiangshuAvatarTaskStatus xiangshuAvatarTaskStatus = DomainManager.World.GetElement_XiangshuAvatarTaskStatuses(avatarId);
				xiangshuAvatarTaskStatus.JuniorXiangshuCharId = avatarCharId;
				DomainManager.World.SetElement_XiangshuAvatarTaskStatuses(avatarId, xiangshuAvatarTaskStatus, context);
			}
		}

		// Token: 0x0600742F RID: 29743 RVA: 0x00441850 File Offset: 0x0043FA50
		public int CreateJuniorXiangshuCombatImage(DataContext context, sbyte xiangshuAvatarId)
		{
			sbyte xiangshuLevel = DomainManager.World.GetXiangshuLevel();
			return this.CreateXiangshuCombatImage(context, xiangshuAvatarId, 3, xiangshuLevel);
		}

		// Token: 0x06007430 RID: 29744 RVA: 0x00441878 File Offset: 0x0043FA78
		public int CreateXiangshuCombatImage(DataContext context, sbyte xiangshuAvatarId, sbyte xiangshuType, sbyte xiangshuLevel)
		{
			Tester.Assert(xiangshuType == 3 || xiangshuType == 4, "");
			XiangshuAvatarTaskStatus xiangshuAvatarTaskStatus = DomainManager.World.GetElement_XiangshuAvatarTaskStatuses((int)xiangshuAvatarId);
			short combatImageTemplateId = XiangshuAvatarIds.GetCurrentLevelXiangshuTemplateId(xiangshuAvatarId, xiangshuLevel, false);
			Character avatarChar = this._objects[xiangshuAvatarTaskStatus.JuniorXiangshuCharId];
			Character combatImageChar = this.CreatePresetCharacter(context, combatImageTemplateId);
			int combatImageCharId = combatImageChar.GetId();
			combatImageChar.OfflineSetXiangshuType(xiangshuType);
			this.CompleteCreatingCharacter(combatImageCharId);
			combatImageChar.SetActualAge(avatarChar.GetActualAge(), context);
			combatImageChar.SetCurrAge(avatarChar.GetCurrAge(), context);
			combatImageChar.SetHappiness(avatarChar.GetHappiness(), context);
			combatImageChar.SetHealth(combatImageChar.GetLeftMaxHealth(false), context);
			int taiwuCharId = DomainManager.Taiwu.GetTaiwuCharId();
			RelatedCharacter xiangshuToTaiwu = this.GetRelation(xiangshuAvatarTaskStatus.JuniorXiangshuCharId, taiwuCharId);
			this.AddRelation(context, taiwuCharId, combatImageCharId, 0, int.MinValue);
			this.DirectlySetFavorabilities(context, taiwuCharId, combatImageCharId, 0, xiangshuToTaiwu.Favorability);
			DomainManager.Adventure.AddTemporaryEnemyId(combatImageCharId);
			return combatImageCharId;
		}

		// Token: 0x06007431 RID: 29745 RVA: 0x00441978 File Offset: 0x0043FB78
		[return: TupleElementNames(new string[]
		{
			"parentOrgInfo",
			"baseTemplateId",
			"isAbandoned"
		})]
		private static ValueTuple<OrganizationInfo, short, bool> GetMainParentInfo(Character mother, Character father, bool createMotherRelation, bool createFatherRelation, bool isMotherDead)
		{
			bool useFatherInfo = createFatherRelation && father != null;
			bool isMotherAvailable = createMotherRelation && !isMotherDead;
			bool isAbandoned = (!useFatherInfo || father.GetKidnapperId() >= 0) && !isMotherAvailable;
			return useFatherInfo ? new ValueTuple<OrganizationInfo, short, bool>(father.GetOrganizationInfo(), CharacterDomain.GetBaseTemplateId(father.GetTemplateId(), father.GetGender()), isAbandoned) : new ValueTuple<OrganizationInfo, short, bool>(mother.GetOrganizationInfo(), CharacterDomain.GetBaseTemplateId(mother.GetTemplateId(), mother.GetGender()), isAbandoned);
		}

		// Token: 0x06007432 RID: 29746 RVA: 0x004419F4 File Offset: 0x0043FBF4
		[return: TupleElementNames(new string[]
		{
			"baseAttraction",
			"avatar"
		})]
		private static ValueTuple<short, AvatarData> GenerateMainChildAvatar(IRandomSource random, Character mother, Character father, DeadCharacter deadFather, sbyte mainChildGender)
		{
			short baseAttraction = -1;
			AvatarData avatar = null;
			AvatarData motherAvatar = mother.GetAvatar();
			AvatarData fatherAvatar = ((father != null) ? father.GetAvatar() : null) ?? ((deadFather != null) ? deadFather.Avatar : null);
			bool flag = motherAvatar != null || fatherAvatar != null;
			if (flag)
			{
				avatar = AvatarManager.Instance.GetRandomAvatar(random, mainChildGender, false, -1, fatherAvatar, motherAvatar);
				baseAttraction = avatar.GetBaseCharm();
			}
			return new ValueTuple<short, AvatarData>(baseAttraction, avatar);
		}

		// Token: 0x06007433 RID: 29747 RVA: 0x00441A64 File Offset: 0x0043FC64
		private void SetBloodRelatedRelations(DataContext context, int charId, int motherId, int fatherId, int actualFatherId, bool createMotherRelation, bool createFatherRelation)
		{
			bool flag = motherId >= 0;
			if (flag)
			{
				if (createMotherRelation)
				{
					this.AddBloodParentRelations(context, charId, motherId, int.MinValue);
				}
				else
				{
					this.AddChildAbandonment(context, -2, charId, motherId);
				}
			}
			bool flag2 = fatherId >= 0;
			if (flag2)
			{
				if (createFatherRelation)
				{
					this.AddBloodParentRelations(context, charId, fatherId, int.MinValue);
					bool flag3 = actualFatherId >= 0;
					if (flag3)
					{
						this.AddFatherSubstitution(context, fatherId, charId, actualFatherId);
					}
				}
				else
				{
					this.AddChildAbandonment(context, -1, charId, fatherId);
				}
			}
		}

		// Token: 0x06007434 RID: 29748 RVA: 0x00441AF4 File Offset: 0x0043FCF4
		private static void SetMonkOfTemporaryIntelligentCharacter(DataContext context, Character character, byte monkType)
		{
			OrganizationInfo orgInfo = character.GetOrganizationInfo();
			bool flag = !CharacterDomain.CheckMonkTypeCompatibility(orgInfo, monkType);
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(62, 2);
				defaultInterpolatedStringHandler.AppendLiteral("Monk type of character is not compatible with organization: ");
				defaultInterpolatedStringHandler.AppendFormatted<byte>(monkType);
				defaultInterpolatedStringHandler.AppendLiteral(", ");
				defaultInterpolatedStringHandler.AppendFormatted<sbyte>(orgInfo.OrgTemplateId);
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
			bool flag2 = monkType == 0;
			if (!flag2)
			{
				bool flag3 = (monkType & 128) == 0;
				if (flag3)
				{
					character.SetMonkType(monkType, context);
				}
				else
				{
					DomainManager.Organization.BecomeSectMonk(context, character, -1);
				}
			}
		}

		// Token: 0x06007435 RID: 29749 RVA: 0x00441B94 File Offset: 0x0043FD94
		private static bool CheckMonkTypeCompatibility(OrganizationInfo orgInfo, byte selfMonkType)
		{
			OrganizationItem orgConfig = Organization.Instance[orgInfo.OrgTemplateId];
			short orgMemberId = orgConfig.Members[(int)orgInfo.Grade];
			OrganizationMemberItem orgMemberCfg = OrganizationMember.Instance[orgMemberId];
			bool flag = orgMemberCfg.MonkType == 0;
			bool result;
			if (flag)
			{
				bool flag2 = selfMonkType == 0;
				result = (flag2 || (!orgConfig.IsSect && (selfMonkType & 128) == 0));
			}
			else
			{
				bool flag3 = selfMonkType == 0;
				if (flag3)
				{
					result = (orgMemberCfg.ProbOfBecomingMonk < 100);
				}
				else
				{
					result = (orgMemberCfg.MonkType == selfMonkType);
				}
			}
			return result;
		}

		// Token: 0x06007436 RID: 29750 RVA: 0x00441C2B File Offset: 0x0043FE2B
		private void StartCreatingCharacter(int charId)
		{
			this._creatingCharIds.Add(charId);
		}

		// Token: 0x06007437 RID: 29751 RVA: 0x00441C3C File Offset: 0x0043FE3C
		public void CompleteCreatingCharacter(int charId)
		{
			bool success = this._creatingCharIds.Remove(charId);
			bool flag = !success;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(35, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				defaultInterpolatedStringHandler.AppendLiteral(" is not in creating state");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
		}

		// Token: 0x06007438 RID: 29752 RVA: 0x00441C9C File Offset: 0x0043FE9C
		private bool IsCharacterCreating(int charId)
		{
			return this._creatingCharIds.Contains(charId);
		}

		// Token: 0x06007439 RID: 29753 RVA: 0x00441CBC File Offset: 0x0043FEBC
		private bool IsAnyCharacterCreating()
		{
			return this._creatingCharIds.Count > 0;
		}

		// Token: 0x0600743A RID: 29754 RVA: 0x00441CDC File Offset: 0x0043FEDC
		private void RegisterPrevBookOwnerCopiesAsTemporaryCharacters(DataContext context, DataUid uid)
		{
			bool flag = !DomainManager.Global.GetLoadedAllArchiveData();
			if (!flag)
			{
				DomainManager.Extra.GetAllPrevLegendaryBookOwnerCopies(context, this._temporaryIntelligentCharIds, true);
				GameDataBridge.RemovePostDataModificationHandler(uid, "RegisterPrevBookOwnerCopiesAsTemporaryCharacters");
			}
		}

		// Token: 0x0600743B RID: 29755 RVA: 0x00441D1C File Offset: 0x0043FF1C
		public void RegisterTemporaryIntelligentCharacter(int charId)
		{
			this._temporaryIntelligentCharIds.Add(charId);
		}

		// Token: 0x0600743C RID: 29756 RVA: 0x00441D2C File Offset: 0x0043FF2C
		public void UnregisterTemporaryIntelligentCharacter(int charId)
		{
			bool success = this._temporaryIntelligentCharIds.Remove(charId);
			bool flag = !success;
			if (flag)
			{
				DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(49, 1);
				defaultInterpolatedStringHandler.AppendLiteral("Character ");
				defaultInterpolatedStringHandler.AppendFormatted<int>(charId);
				defaultInterpolatedStringHandler.AppendLiteral(" is not temporary-intelligent-character");
				throw new Exception(defaultInterpolatedStringHandler.ToStringAndClear());
			}
		}

		// Token: 0x0600743D RID: 29757 RVA: 0x00441D8C File Offset: 0x0043FF8C
		[DomainMethod]
		public bool IsTemporaryIntelligentCharacter(int charId)
		{
			return this._temporaryIntelligentCharIds.Contains(charId);
		}

		// Token: 0x0600743E RID: 29758 RVA: 0x00441DAC File Offset: 0x0043FFAC
		public void CheckCharacterCreationState()
		{
			bool flag = this._creatingCharIds.Count <= 0;
			if (flag)
			{
				return;
			}
			StringBuilder message = new StringBuilder("Some characters are still in creating state:\n");
			foreach (int charId in this._creatingCharIds)
			{
				Character character;
				bool flag2 = this.TryGetElement_Objects(charId, out character);
				if (flag2)
				{
					StringBuilder stringBuilder = message;
					StringBuilder stringBuilder2 = stringBuilder;
					StringBuilder.AppendInterpolatedStringHandler appendInterpolatedStringHandler = new StringBuilder.AppendInterpolatedStringHandler(38, 4, stringBuilder);
					appendInterpolatedStringHandler.AppendLiteral("  TemplateId: ");
					appendInterpolatedStringHandler.AppendFormatted<short>(character.GetTemplateId());
					appendInterpolatedStringHandler.AppendLiteral(", CreatingType: ");
					appendInterpolatedStringHandler.AppendFormatted<byte>(character.GetCreatingType());
					appendInterpolatedStringHandler.AppendLiteral(", Name: ");
					appendInterpolatedStringHandler.AppendFormatted(character.GetSurname());
					appendInterpolatedStringHandler.AppendFormatted(character.GetGivenName());
					stringBuilder2.AppendLine(ref appendInterpolatedStringHandler);
				}
				else
				{
					StringBuilder stringBuilder = message;
					StringBuilder stringBuilder3 = stringBuilder;
					StringBuilder.AppendInterpolatedStringHandler appendInterpolatedStringHandler = new StringBuilder.AppendInterpolatedStringHandler(37, 1, stringBuilder);
					appendInterpolatedStringHandler.AppendLiteral("  CharacterId: ");
					appendInterpolatedStringHandler.AppendFormatted<int>(charId);
					appendInterpolatedStringHandler.AppendLiteral(" (Character not found)");
					stringBuilder3.AppendLine(ref appendInterpolatedStringHandler);
				}
			}
			throw new Exception(message.ToString());
		}

		// Token: 0x0600743F RID: 29759 RVA: 0x00441EFC File Offset: 0x004400FC
		public void CheckTemporaryIntelligentCharacters()
		{
			bool flag = this._temporaryIntelligentCharIds.Count <= 0;
			if (!flag)
			{
				int count = 0;
				StringBuilder message = new StringBuilder("There are still some temporary-intelligent-characters:\n");
				foreach (int charId in this._temporaryIntelligentCharIds)
				{
					bool flag2 = DomainManager.Extra.IsPrevLegendaryBookOwnerCopy(charId);
					if (!flag2)
					{
						Character character;
						bool flag3 = this.TryGetElement_Objects(charId, out character);
						if (flag3)
						{
							StringBuilder stringBuilder = message;
							StringBuilder stringBuilder2 = stringBuilder;
							StringBuilder.AppendInterpolatedStringHandler appendInterpolatedStringHandler = new StringBuilder.AppendInterpolatedStringHandler(31, 3, stringBuilder);
							appendInterpolatedStringHandler.AppendFormatted<Character>(character);
							appendInterpolatedStringHandler.AppendLiteral(" - ");
							appendInterpolatedStringHandler.AppendLiteral("TemplateId: ");
							appendInterpolatedStringHandler.AppendFormatted<short>(character.GetTemplateId());
							appendInterpolatedStringHandler.AppendLiteral(", CreatingType: ");
							appendInterpolatedStringHandler.AppendFormatted<byte>(character.GetCreatingType());
							stringBuilder2.AppendLine(ref appendInterpolatedStringHandler);
						}
						else
						{
							StringBuilder stringBuilder = message;
							StringBuilder stringBuilder3 = stringBuilder;
							StringBuilder.AppendInterpolatedStringHandler appendInterpolatedStringHandler = new StringBuilder.AppendInterpolatedStringHandler(37, 1, stringBuilder);
							appendInterpolatedStringHandler.AppendLiteral("  CharacterId: ");
							appendInterpolatedStringHandler.AppendFormatted<int>(charId);
							appendInterpolatedStringHandler.AppendLiteral(" (Character not found)");
							stringBuilder3.AppendLine(ref appendInterpolatedStringHandler);
						}
						count++;
					}
				}
				bool flag4 = count > 0;
				if (flag4)
				{
					throw new Exception(message.ToString());
				}
			}
		}

		// Token: 0x06007440 RID: 29760 RVA: 0x00442064 File Offset: 0x00440264
		public int GetWorldPopulation()
		{
			return this._objects.Count - this._pregeneratedRandomEnemies.Count - this._pregeneratedCityTownGuards.Length - this._temporaryIntelligentCharIds.Count - this._fixedCharactersCache.Count;
		}

		// Token: 0x06007441 RID: 29761 RVA: 0x004420B0 File Offset: 0x004402B0
		public void ShowCharactersStats()
		{
			int date = DomainManager.World.GetCurrDate();
			Logger logger = CharacterDomain.Logger;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(42, 3);
			defaultInterpolatedStringHandler.AppendLiteral("[[");
			defaultInterpolatedStringHandler.AppendFormatted<int>(date);
			defaultInterpolatedStringHandler.AppendLiteral("]] Alive characters: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(this._objects.Count);
			defaultInterpolatedStringHandler.AppendLiteral(", dead characters: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(this._deadCharacters.Count);
			logger.Info(defaultInterpolatedStringHandler.ToStringAndClear());
		}

		// Token: 0x06007442 RID: 29762 RVA: 0x0044213C File Offset: 0x0044033C
		public void ShowNonIntelligentCharactersStats()
		{
			List<Character> nonIntelligentCharacters = new List<Character>();
			HashSet<int> registeredNonIntelligentChars = new HashSet<int>();
			registeredNonIntelligentChars.UnionWith(this._pregeneratedRandomEnemies);
			registeredNonIntelligentChars.UnionWith(this._pregeneratedCityTownGuards);
			registeredNonIntelligentChars.UnionWith(this._fixedCharactersCache.Values);
			registeredNonIntelligentChars.UnionWith(this._skeletonCharacterCache.Keys);
			ICollection<int> collection = DomainManager.Extra.GetPregeneratedFixedEnemies();
			registeredNonIntelligentChars.UnionWith(collection);
			foreach (KeyValuePair<int, Character> keyValuePair in this._objects)
			{
				int num;
				Character character2;
				keyValuePair.Deconstruct(out num, out character2);
				int charId = num;
				Character character = character2;
				short templateId = character.GetTemplateId();
				bool flag = character.GetCreatingType() == 1;
				if (!flag)
				{
					bool flag2 = registeredNonIntelligentChars.Contains(charId);
					if (!flag2)
					{
						nonIntelligentCharacters.Add(character);
					}
				}
			}
			int count = nonIntelligentCharacters.Count;
			DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(29, 1);
			defaultInterpolatedStringHandler.AppendLiteral("Non-intelligent characters: ");
			defaultInterpolatedStringHandler.AppendFormatted<int>(count);
			defaultInterpolatedStringHandler.AppendLiteral("\n");
			StringBuilder message = new StringBuilder(defaultInterpolatedStringHandler.ToStringAndClear());
			int logCount = Math.Min(count, 40);
			for (int i = 0; i < logCount; i++)
			{
				Character nonIntelligentChar = nonIntelligentCharacters[i];
				short templateId2 = nonIntelligentChar.GetTemplateId();
				CharacterItem config = Character.Instance[templateId2];
				StringBuilder stringBuilder = message;
				StringBuilder stringBuilder2 = stringBuilder;
				StringBuilder.AppendInterpolatedStringHandler appendInterpolatedStringHandler = new StringBuilder.AppendInterpolatedStringHandler(5, 4, stringBuilder);
				appendInterpolatedStringHandler.AppendLiteral("  ");
				appendInterpolatedStringHandler.AppendFormatted<int>(nonIntelligentChar.GetId());
				appendInterpolatedStringHandler.AppendLiteral(": ");
				appendInterpolatedStringHandler.AppendFormatted<short>(templateId2);
				appendInterpolatedStringHandler.AppendLiteral("-");
				appendInterpolatedStringHandler.AppendFormatted(config.Surname);
				appendInterpolatedStringHandler.AppendFormatted(config.GivenName);
				stringBuilder2.AppendLine(ref appendInterpolatedStringHandler);
			}
			CharacterDomain.Logger.Info<StringBuilder>(message);
		}

		// Token: 0x06007444 RID: 29764 RVA: 0x004424D8 File Offset: 0x004406D8
		[CompilerGenerated]
		internal unsafe static bool <FixQualifications>g__FixSegment|44_0(short* arr, int len, ref CharacterDomain.<>c__DisplayClass44_0 A_2)
		{
			bool rewrite = false;
			for (int i = 0; i < len; i++)
			{
				bool flag = arr[i] < 0;
				if (flag)
				{
					rewrite = true;
					string tag = "FixQualifications";
					DefaultInterpolatedStringHandler defaultInterpolatedStringHandler = new DefaultInterpolatedStringHandler(32, 2);
					defaultInterpolatedStringHandler.AppendLiteral("fixed invalid qualification ");
					defaultInterpolatedStringHandler.AppendFormatted<short>(arr[i]);
					defaultInterpolatedStringHandler.AppendLiteral(" on ");
					defaultInterpolatedStringHandler.AppendFormatted<Character>(A_2.character);
					AdaptableLog.TagWarning(tag, defaultInterpolatedStringHandler.ToStringAndClear(), false);
					arr[i] = 0;
				}
			}
			return rewrite;
		}

		// Token: 0x06007446 RID: 29766 RVA: 0x004425AC File Offset: 0x004407AC
		[CompilerGenerated]
		private void <PackCrossArchiveGameData>g__PackSpousesAndChildren|245_0(SpousesAndChildren spousesAndChildren, ref CharacterDomain.<>c__DisplayClass245_0 A_2)
		{
			this.PackAbridgedCharacter(A_2.crossArchiveGameData, spousesAndChildren.CoreCharId);
			bool flag = spousesAndChildren.Spouses != null;
			if (flag)
			{
				foreach (SpouseAndChildren spouse in spousesAndChildren.Spouses)
				{
					this.<PackCrossArchiveGameData>g__PackSpouseAndChildren|245_1(spouse, ref A_2);
				}
			}
		}

		// Token: 0x06007447 RID: 29767 RVA: 0x00442624 File Offset: 0x00440824
		[CompilerGenerated]
		private void <PackCrossArchiveGameData>g__PackSpouseAndChildren|245_1(SpouseAndChildren spouseAndChildren, ref CharacterDomain.<>c__DisplayClass245_0 A_2)
		{
			this.PackAbridgedCharacter(A_2.crossArchiveGameData, spouseAndChildren.SpouseCharId);
			bool flag = spouseAndChildren.Children != null;
			if (flag)
			{
				foreach (CharIdAndRelation child in spouseAndChildren.Children)
				{
					this.PackAbridgedCharacter(A_2.crossArchiveGameData, child.CharId);
				}
			}
			bool flag2 = spouseAndChildren.BloodChildrenSpouses != null;
			if (flag2)
			{
				foreach (SpousesAndChildren bloodChildSpouse in spouseAndChildren.BloodChildrenSpouses)
				{
					this.<PackCrossArchiveGameData>g__PackSpousesAndChildren|245_0(bloodChildSpouse, ref A_2);
				}
			}
		}

		// Token: 0x06007448 RID: 29768 RVA: 0x004426FC File Offset: 0x004408FC
		[CompilerGenerated]
		internal static void <GetCharacterLocationDisplayData>g__GetBlockData|306_0(ref CharacterDomain.<>c__DisplayClass306_0 A_0)
		{
			bool flag = A_0.result.Location.IsValid();
			if (flag)
			{
				MapBlockData blockData = DomainManager.Map.GetBlockData(A_0.result.Location.AreaId, A_0.result.Location.BlockId);
				A_0.result.BlockData = blockData;
				bool flag2 = blockData.RootBlockId >= 0;
				if (flag2)
				{
					A_0.result.RootBlockData = DomainManager.Map.GetBlockData(A_0.result.Location.AreaId, blockData.RootBlockId);
				}
			}
		}

		// Token: 0x0600744A RID: 29770 RVA: 0x004427B8 File Offset: 0x004409B8
		[CompilerGenerated]
		internal static bool <GmCmd_CreateRandomIntelligentCharacters>g__CheckPrincipalFull|383_0(sbyte gradeId, ref CharacterDomain.<>c__DisplayClass383_0 A_1)
		{
			bool flag = A_1.gradePrincipalFullList[(int)gradeId];
			bool result;
			if (flag)
			{
				result = true;
			}
			else
			{
				short memberId = A_1.orgConfig.Members[(int)gradeId];
				OrganizationMemberItem memberInfo = OrganizationMember.Instance[memberId];
				bool flag2 = A_1.settlement != null && memberInfo.RestrictPrincipalAmount;
				if (flag2)
				{
					int principalAmount = 0;
					HashSet<int> gradeMembers = A_1.settlement.GetMembers().GetMembers(gradeId);
					foreach (int charId in gradeMembers)
					{
						Character chara;
						bool flag3 = DomainManager.Character.TryGetElement_Objects(charId, out chara) && chara.GetOrganizationInfo().Principal;
						if (flag3)
						{
							principalAmount++;
						}
					}
					result = (A_1.gradePrincipalFullList[(int)gradeId] = (principalAmount >= (int)memberInfo.Amount));
				}
				else
				{
					result = false;
				}
			}
			return result;
		}

		// Token: 0x0600744B RID: 29771 RVA: 0x004428BC File Offset: 0x00440ABC
		[CompilerGenerated]
		internal static bool <CalcXiangshuMovementNextBlock>g__BlockHasSwordTombKeeper|620_1(MapBlockData blockData)
		{
			bool flag = blockData.CharacterSet == null;
			bool result;
			if (flag)
			{
				result = false;
			}
			else
			{
				foreach (int charId in blockData.CharacterSet)
				{
					VillagerRoleBase role = DomainManager.Extra.GetVillagerRole(charId);
					Character ch;
					bool flag2 = DomainManager.Character.TryGetElement_Objects(charId, out ch) && ch.ReachFallenInCombat(CombatType.Die);
					if (!flag2)
					{
						bool flag3 = role != null && role.ArrangementTemplateId == 3;
						if (flag3)
						{
							return true;
						}
					}
				}
				result = false;
			}
			return result;
		}

		// Token: 0x0600744C RID: 29772 RVA: 0x00442970 File Offset: 0x00440B70
		[CompilerGenerated]
		internal unsafe static sbyte <TripodVesselOfMedicineMovement>g__SelectTripodVesselActionType|658_0(IRandomSource random, int charId)
		{
			Span<sbyte> span = new Span<sbyte>(stackalloc byte[(UIntPtr)4], 4);
			SpanList<sbyte> availableActionTypes = span;
			sbyte i = 0;
			while ((int)i < availableActionTypes.Capacity)
			{
				bool flag = !DomainManager.Extra.IsAiActionInCooldown(charId, 2, i);
				if (flag)
				{
					availableActionTypes.Add(i);
				}
				i += 1;
			}
			bool flag2 = availableActionTypes.Count > 0;
			sbyte result;
			if (flag2)
			{
				result = availableActionTypes.GetRandom(random);
			}
			else
			{
				result = -1;
			}
			return result;
		}

		// Token: 0x0600744D RID: 29773 RVA: 0x004429EC File Offset: 0x00440BEC
		[CompilerGenerated]
		private unsafe void <TripodVesselOfMedicineMovement>g__ExecuteTripodVesselAction|658_1(int targetCharId, ref CharacterDomain.<>c__DisplayClass658_0 A_2)
		{
			Character targetChar = this._objects[targetCharId];
			switch (A_2.actionType)
			{
			case 0:
			{
				Injuries injuries = targetChar.GetInjuries();
				bool flag = injuries.HasAnyInjury();
				if (flag)
				{
					injuries.Initialize();
					targetChar.SetInjuries(injuries, A_2.context);
				}
				break;
			}
			case 1:
			{
				PoisonInts poisoned = *targetChar.GetPoisoned();
				bool flag2 = poisoned.IsNonZero();
				if (flag2)
				{
					poisoned.Initialize();
					targetChar.SetPoisoned(ref poisoned, A_2.context);
				}
				break;
			}
			case 2:
			{
				short health = targetChar.GetHealth();
				short leftMaxHealth = targetChar.GetLeftMaxHealth(false);
				bool flag3 = health < leftMaxHealth;
				if (flag3)
				{
					targetChar.SetHealth(leftMaxHealth, A_2.context);
				}
				break;
			}
			case 3:
				targetChar.SetDisorderOfQi(0, A_2.context);
				break;
			}
		}

		// Token: 0x0600744F RID: 29775 RVA: 0x00442AE0 File Offset: 0x00440CE0
		[CompilerGenerated]
		internal static int <CalcInitialFavorabilitiesOfAliveChars>g__TaiwuRelatedFavorAdd|841_0(int initFavor, Character otherCharacter)
		{
			bool notIntelligentCharacter = otherCharacter.IsFavorabilityGainFixed;
			short percent = CharacterDomain.GetWorldFavorabilityPercent(notIntelligentCharacter);
			OrganizationInfo charOrgInfo = otherCharacter.GetOrganizationInfo();
			OrganizationItem orgCfg = Organization.Instance[charOrgInfo.OrgTemplateId];
			bool flag = otherCharacter.GetOrganizationInfo().OrgTemplateId == 16;
			if (flag)
			{
				initFavor += (int)(9000 * percent / 100);
			}
			short settlementId = DomainManager.Taiwu.GetTaiwuVillageSettlementId();
			int buildingEffect = DomainManager.Building.GetBuildingBlockEffect(settlementId, EBuildingScaleEffect.InitialFavorability, -1);
			initFavor += buildingEffect * (int)percent / 100;
			bool flag2 = DomainManager.Extra.MartialArtistSkill0Useful(orgCfg) || DomainManager.Extra.CivilianSkill0Useful(orgCfg);
			if (flag2)
			{
				initFavor += initFavor * (int)GlobalConfig.Instance.ProfessionInitialFavorabilitiesImprovePercent / 100;
			}
			return initFavor;
		}

		// Token: 0x06007450 RID: 29776 RVA: 0x00442B9C File Offset: 0x00440D9C
		[CompilerGenerated]
		internal static void <Test_LogMaxConsummateLevel>g__AppendGradesOnPanel|942_0(short[] combatSkillAttainmentPanels, sbyte skillType, ref CharacterDomain.<>c__DisplayClass942_0 A_2)
		{
			for (sbyte grade = 0; grade < 9; grade += 1)
			{
				int offset = (int)(9 * skillType + grade);
				short skillTemplateId = combatSkillAttainmentPanels[offset];
				bool flag = skillTemplateId < 0;
				if (!flag)
				{
					A_2.builder.Append(grade);
					A_2.builder.Append('，');
				}
			}
		}

		// Token: 0x04001E53 RID: 7763
		private static readonly Logger Logger = LogManager.GetCurrentClassLogger();

		// Token: 0x04001E54 RID: 7764
		[DomainData(DomainDataType.ObjectCollection, true, false, true, true, CollectionCapacity = 8192)]
		private readonly Dictionary<int, Character> _objects;

		// Token: 0x04001E55 RID: 7765
		[DomainData(DomainDataType.SingleValue, true, false, false, false)]
		private int _nextObjectId;

		// Token: 0x04001E56 RID: 7766
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false, CollectionCapacity = 65536)]
		private readonly Dictionary<int, DeadCharacter> _deadCharacters;

		// Token: 0x04001E57 RID: 7767
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly Dictionary<int, DeadCharDeletionState> _deadCharDeletionStates;

		// Token: 0x04001E58 RID: 7768
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly SortedSetAsDictionary<IntPair> _recentDeadCharacters;

		// Token: 0x04001E59 RID: 7769
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly SortedSetAsDictionary<IntPair> _waitingReincarnationChars;

		// Token: 0x04001E5A RID: 7770
		[DomainData(DomainDataType.ObjectCollection, true, false, true, true, CollectionCapacity = 16384)]
		private readonly Dictionary<int, Grave> _graves;

		// Token: 0x04001E5B RID: 7771
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly Dictionary<int, PregnantState> _pregnantStates;

		// Token: 0x04001E5C RID: 7772
		[DomainData(DomainDataType.SingleValueCollection, true, false, true, false)]
		private readonly Dictionary<int, int> _pregnancyLockEndDates;

		// Token: 0x04001E5D RID: 7773
		[DomainData(DomainDataType.SingleValue, true, false, true, true)]
		private CharacterSet _unguardedChars;

		// Token: 0x04001E5E RID: 7774
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly Dictionary<int, KidnappedCharacterList> _kidnappedChars;

		// Token: 0x04001E5F RID: 7775
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly Dictionary<RelationKey, RelatedCharacter> _relations;

		// Token: 0x04001E60 RID: 7776
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly Dictionary<ParentAndChild, int> _actualBloodParents;

		// Token: 0x04001E61 RID: 7777
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly Dictionary<int, CharacterSet> _characterGroups;

		// Token: 0x04001E62 RID: 7778
		[DomainData(DomainDataType.SingleValueCollection, true, false, true, false)]
		private readonly Dictionary<int, int> _joinGroupDates;

		// Token: 0x04001E63 RID: 7779
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly Dictionary<int, Debts> _debtsToTaiwu;

		// Token: 0x04001E64 RID: 7780
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly Dictionary<int, GameData.Utilities.ShortList> _soldLibrarySkillBooks;

		// Token: 0x04001E65 RID: 7781
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		[Obsolete("This field is only for archive module. Cannot use to do anything.")]
		private readonly Dictionary<int, CombatResourcesObsolete> _usedCombatResourceObsoletes;

		// Token: 0x04001E66 RID: 7782
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly Dictionary<int, AvatarElementsGrownDates> _avatarElementGrowthProgress;

		// Token: 0x04001E67 RID: 7783
		[DomainData(DomainDataType.SingleValue, true, false, true, true)]
		private string _targetedForAssassination;

		// Token: 0x04001E68 RID: 7784
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly Dictionary<int, PrioritizedActionWrapper> _prioritizedActions;

		// Token: 0x04001E69 RID: 7785
		[DomainData(DomainDataType.SingleValueCollection, true, false, true, true)]
		private readonly Dictionary<int, CrossAreaMoveInfo> _crossAreaMoveInfos;

		// Token: 0x04001E6A RID: 7786
		[DomainData(DomainDataType.SingleValueCollection, true, false, false, false)]
		private readonly Dictionary<int, CharacterSet> _ongoingVengeances;

		// Token: 0x04001E6B RID: 7787
		[Obsolete]
		[DomainData(DomainDataType.SingleValue, true, false, true, true)]
		private CharacterSet _mournedOthersChars;

		// Token: 0x04001E6C RID: 7788
		[DomainData(DomainDataType.SingleValueCollection, false, false, true, true)]
		private Dictionary<int, CharacterList> _subscriberOrders;

		// Token: 0x04001E6D RID: 7789
		private readonly SortedList<long, int> _topThousandCharDescendingRanking = new SortedList<long, int>(Comparer<long>.Create((long x, long y) => y.CompareTo(x)));

		// Token: 0x04001E6E RID: 7790
		private readonly List<Character> _attackerTeamsCache = new List<Character>();

		// Token: 0x04001E6F RID: 7791
		private readonly List<Character> _defenderTeamsCache = new List<Character>();

		// Token: 0x04001E70 RID: 7792
		private readonly Dictionary<int, CombatResources> _usedCombatResources = new Dictionary<int, CombatResources>();

		// Token: 0x04001E71 RID: 7793
		private const int RecentDeadDuration = 12;

		// Token: 0x04001E72 RID: 7794
		private const int DeadDuration = 120;

		// Token: 0x04001E73 RID: 7795
		private const int ReincarnationMinInterval = 7;

		// Token: 0x04001E74 RID: 7796
		private static readonly short[] FavorDecrementPercentsOfDebt = new short[]
		{
			140,
			130,
			150,
			160,
			170
		};

		// Token: 0x04001E75 RID: 7797
		private static readonly short[] FavorIncrementPercentsOfDebt = new short[]
		{
			110,
			120,
			100,
			90,
			80
		};

		// Token: 0x04001E76 RID: 7798
		private static Debts _tmpDebts = new Debts();

		// Token: 0x04001E77 RID: 7799
		private static List<short> _normalPositiveBasicFeaturesPool;

		// Token: 0x04001E78 RID: 7800
		private static List<short> _normalNegativeBasicFeaturesPool;

		// Token: 0x04001E79 RID: 7801
		private static List<short> _protagonistPositiveBasicFeaturesPool;

		// Token: 0x04001E7A RID: 7802
		private static List<short> _protagonistNegativeBasicFeaturesPool;

		// Token: 0x04001E7B RID: 7803
		private CharacterSortFilter _characterSortFilter;

		// Token: 0x04001E7C RID: 7804
		private Dictionary<short, int> _fixedCharactersCache;

		// Token: 0x04001E7D RID: 7805
		private Dictionary<int, short> _fixedEnemyCache;

		// Token: 0x04001E7E RID: 7806
		private Dictionary<short, int> _convertedFixedCharactersCache;

		// Token: 0x04001E7F RID: 7807
		private const int GraveNeighborBlockMaxCount = 9;

		// Token: 0x04001E80 RID: 7808
		private const int GraveSkeletonSpawnChance = 50;

		// Token: 0x04001E81 RID: 7809
		private List<MapBlockData> _graveNeighborBlocks;

		// Token: 0x04001E82 RID: 7810
		[TupleElementNames(new string[]
		{
			"itemKey",
			"amount"
		})]
		private List<ValueTuple<ItemKey, int>>[] _graveNeighborItems;

		// Token: 0x04001E83 RID: 7811
		private Dictionary<int, int> _skeletonCharacterCache;

		// Token: 0x04001E84 RID: 7812
		private static short[] PregenerateHereticTemplateIds = new short[]
		{
			232,
			242,
			262,
			267,
			272,
			277,
			282,
			287,
			292
		};

		// Token: 0x04001E85 RID: 7813
		private static short[] PregenerateRighteousTemplateIds = new short[]
		{
			307,
			308,
			309,
			310,
			311,
			312,
			313,
			314,
			315
		};

		// Token: 0x04001E86 RID: 7814
		private const int TotalPregeneratedCityTownGuardCount = 288;

		// Token: 0x04001E87 RID: 7815
		private static Dictionary<sbyte, List<short>[]> _randomEnemyCharTemplateCache;

		// Token: 0x04001E88 RID: 7816
		[DomainData(DomainDataType.SingleValue, true, false, false, false, ArrayElementsCount = 288)]
		private int[] _pregeneratedCityTownGuards;

		// Token: 0x04001E89 RID: 7817
		[DomainData(DomainDataType.SingleValue, true, false, false, false)]
		private List<int> _pregeneratedRandomEnemies;

		// Token: 0x04001E8A RID: 7818
		private Dictionary<int, int> _infantMap;

		// Token: 0x04001E8B RID: 7819
		private HashSet<int> _infectedCharSet;

		// Token: 0x04001E8C RID: 7820
		private const int LuckEventSelectCharCount = 100;

		// Token: 0x04001E8D RID: 7821
		[TupleElementNames(new string[]
		{
			"charId",
			"isPositive",
			"isAvoided"
		})]
		private ValueTuple<int, bool, bool> _predictedLuckEvent;

		// Token: 0x04001E8E RID: 7822
		[DomainData(DomainDataType.SingleValue, false, false, true, false)]
		private Location _forceRebelLocation;

		// Token: 0x04001E8F RID: 7823
		[DomainData(DomainDataType.SingleValue, false, false, true, false)]
		private Location _forceKindLocation;

		// Token: 0x04001E90 RID: 7824
		[DomainData(DomainDataType.SingleValue, true, false, true, false)]
		private int _avoidDeathCharId;

		// Token: 0x04001E91 RID: 7825
		private Location _tripleAdoreLocation;

		// Token: 0x04001E92 RID: 7826
		private Location _tripleHateLocation;

		// Token: 0x04001E93 RID: 7827
		private Location _doubleAgeIncreaseLocation;

		// Token: 0x04001E94 RID: 7828
		private Location _noAgeIncreaseLocation;

		// Token: 0x04001E95 RID: 7829
		private static readonly HashSet<int> LockMovementCharSet = new HashSet<int>();

		// Token: 0x04001E96 RID: 7830
		private static AStarMap _xiangshuMovementMap = new AStarMap();

		// Token: 0x04001E97 RID: 7831
		private static AStarMap _fuyuHiltMovementMap = new AStarMap();

		// Token: 0x04001E98 RID: 7832
		private static short[] _randomHanNameSurnameIds;

		// Token: 0x04001E99 RID: 7833
		private static int[] _randomHanNameSurnameAccumulativeWeights;

		// Token: 0x04001E9A RID: 7834
		private static int[] _randomHanNameUnattachedTotalCounts;

		// Token: 0x04001E9B RID: 7835
		private static int[] _randomHanNameAttachedTotalCounts;

		// Token: 0x04001E9C RID: 7836
		private HashSet<int> _legendaryBookChallengers = new HashSet<int>();

		// Token: 0x04001E9D RID: 7837
		private List<Location> _yuanShanEnemyLocations = new List<Location>();

		// Token: 0x04001E9E RID: 7838
		private short _shiXiangEnemyAreaId;

		// Token: 0x04001E9F RID: 7839
		private List<short> _shiXiangEnemyBlockIds = new List<short>();

		// Token: 0x04001EA0 RID: 7840
		private Dictionary<int, ValueTuple<int, int>> _charactersWithInfantNearBy = new Dictionary<int, ValueTuple<int, int>>();

		// Token: 0x04001EA1 RID: 7841
		private Dictionary<int, int> _characterWithInfantWithBloodRelation = new Dictionary<int, int>();

		// Token: 0x04001EA2 RID: 7842
		private HashSet<int> _eMeiPsychotics = new HashSet<int>();

		// Token: 0x04001EA3 RID: 7843
		public ConcurrentBag<int> BaihuaManicCharIds = new ConcurrentBag<int>();

		// Token: 0x04001EA4 RID: 7844
		private const int InitialFabricatedFavorSettingsLenght = 7;

		// Token: 0x04001EA5 RID: 7845
		private static readonly HashSet<int> EmptyCharacterSet = new HashSet<int>();

		// Token: 0x04001EA6 RID: 7846
		private static readonly short[] InitialFabricatedFavorOfRelationTypes = new short[]
		{
			0,
			0,
			0,
			0,
			0,
			0,
			0,
			26000,
			26000,
			22000,
			18000,
			18000,
			-30000,
			30000,
			26000,
			26000,
			22000,
			18000,
			18000,
			-30000,
			30000,
			22000,
			22000,
			18000,
			14000,
			14000,
			-30000,
			25999,
			22000,
			22000,
			18000,
			14000,
			14000,
			-21999,
			25999,
			22000,
			22000,
			18000,
			14000,
			14000,
			-21999,
			25999,
			14000,
			14000,
			10000,
			6000,
			6000,
			-21999,
			17999,
			22000,
			22000,
			18000,
			14000,
			14000,
			-5999,
			25999,
			22000,
			22000,
			18000,
			14000,
			14000,
			-5999,
			25999,
			14000,
			14000,
			10000,
			6000,
			6000,
			-5999,
			17999,
			14000,
			22000,
			18000,
			22000,
			14000,
			6000,
			25999,
			18000,
			26000,
			22000,
			26000,
			18000,
			-30000,
			30000,
			14000,
			22000,
			18000,
			22000,
			14000,
			-21999,
			25999,
			14000,
			22000,
			18000,
			22000,
			14000,
			-21999,
			25999,
			10000,
			18000,
			14000,
			18000,
			10000,
			6000,
			21999,
			10000,
			18000,
			14000,
			18000,
			10000,
			-21999,
			21999,
			-22000,
			-10000,
			-18000,
			-10000,
			-22000,
			-30000,
			-6000
		};

		// Token: 0x04001EA7 RID: 7847
		private static readonly short[] InitialMentorFabricatedFavorOfSects = new short[]
		{
			18000,
			18000,
			14000,
			10000,
			10000,
			10000,
			21999,
			22000,
			22000,
			18000,
			14000,
			14000,
			6000,
			25999,
			26000,
			26000,
			22000,
			18000,
			18000,
			14000,
			30000,
			26000,
			26000,
			22000,
			18000,
			18000,
			10000,
			30000,
			14000,
			14000,
			10000,
			6000,
			6000,
			6000,
			17999,
			26000,
			26000,
			22000,
			18000,
			18000,
			-21999,
			30000,
			18000,
			18000,
			14000,
			10000,
			10000,
			-5999,
			21999,
			6000,
			6000,
			2000,
			-2000,
			-2000,
			6000,
			9999,
			22000,
			22000,
			18000,
			14000,
			14000,
			-9999,
			25999,
			14000,
			14000,
			10000,
			6000,
			6000,
			-21999,
			17999,
			14000,
			14000,
			10000,
			6000,
			6000,
			-17999,
			17999,
			26000,
			26000,
			22000,
			18000,
			18000,
			6000,
			30000,
			14000,
			14000,
			10000,
			6000,
			6000,
			-21999,
			17999,
			22000,
			22000,
			18000,
			14000,
			14000,
			10000,
			25999,
			6000,
			6000,
			2000,
			-2000,
			-2000,
			-30000,
			9999
		};

		// Token: 0x04001EA8 RID: 7848
		private static readonly short[] FavorabilityFactorOfGradeDifferences = new short[]
		{
			140,
			135,
			130,
			125,
			120,
			115,
			110,
			105,
			100,
			95,
			90,
			85,
			80,
			75,
			70,
			65,
			60
		};

		// Token: 0x04001EA9 RID: 7849
		[TupleElementNames(new string[]
		{
			"positive",
			"negative"
		})]
		private static readonly ValueTuple<short, short>[] BaseChangedFavorabilitiesOfChangingHobby = new ValueTuple<short, short>[]
		{
			new ValueTuple<short, short>(0, 0),
			new ValueTuple<short, short>(1000, 1000),
			new ValueTuple<short, short>(-1000, 1000),
			new ValueTuple<short, short>(1000, -1000),
			new ValueTuple<short, short>(-1000, -1000)
		};

		// Token: 0x04001EAA RID: 7850
		private static readonly sbyte[] FavorabilityChangingFactorsOfChangingHobby = new sbyte[]
		{
			0,
			0,
			25,
			50,
			75,
			100,
			100,
			100,
			75,
			50,
			25,
			0,
			0
		};

		// Token: 0x04001EAB RID: 7851
		private Dictionary<int, RelatedCharacters> _relatedCharIds;

		// Token: 0x04001EAC RID: 7852
		public const int BloodFatherIdNone = -1;

		// Token: 0x04001EAD RID: 7853
		public const int BloodMotherIdNone = -2;

		// Token: 0x04001EAE RID: 7854
		private Dictionary<int, List<ParentAndChild>> _nominalBloodParentRelations;

		// Token: 0x04001EAF RID: 7855
		private readonly Dictionary<int, CharacterModificationRecords> _characterTemporaryModifications = new Dictionary<int, CharacterModificationRecords>();

		// Token: 0x04001EB0 RID: 7856
		private Character _currTemporaryModifyingCharacter;

		// Token: 0x04001EB1 RID: 7857
		[TupleElementNames(new string[]
		{
			"type",
			"value"
		})]
		private readonly List<ValueTuple<RevertibleCharacterPropertyType, RevertibleCharacterPropertyValue>> _currTemporaryModifyingValues = new List<ValueTuple<RevertibleCharacterPropertyType, RevertibleCharacterPropertyValue>>();

		// Token: 0x04001EB2 RID: 7858
		private static readonly DataInfluence[][] CacheInfluences = new DataInfluence[30][];

		// Token: 0x04001EB3 RID: 7859
		private static readonly DataInfluence[][] CacheInfluencesObjects = new DataInfluence[119][];

		// Token: 0x04001EB4 RID: 7860
		private readonly ObjectCollectionDataStates _dataStatesObjects = new ObjectCollectionDataStates(119, 8192);

		// Token: 0x04001EB5 RID: 7861
		public readonly ObjectCollectionHelperData HelperDataObjects;

		// Token: 0x04001EB6 RID: 7862
		private static readonly DataInfluence[][] CacheInfluencesGraves = new DataInfluence[7][];

		// Token: 0x04001EB7 RID: 7863
		private readonly ObjectCollectionDataStates _dataStatesGraves = new ObjectCollectionDataStates(7, 16384);

		// Token: 0x04001EB8 RID: 7864
		public readonly ObjectCollectionHelperData HelperDataGraves;

		// Token: 0x04001EB9 RID: 7865
		private SingleValueCollectionModificationCollection<int> _modificationsPregnancyLockEndDates = SingleValueCollectionModificationCollection<int>.Create();

		// Token: 0x04001EBA RID: 7866
		private SingleValueCollectionModificationCollection<int> _modificationsJoinGroupDates = SingleValueCollectionModificationCollection<int>.Create();

		// Token: 0x04001EBB RID: 7867
		private SingleValueCollectionModificationCollection<int> _modificationsCrossAreaMoveInfos = SingleValueCollectionModificationCollection<int>.Create();

		// Token: 0x04001EBC RID: 7868
		private SingleValueCollectionModificationCollection<int> _modificationsSubscriberOrders = SingleValueCollectionModificationCollection<int>.Create();

		// Token: 0x04001EBD RID: 7869
		private Queue<uint> _pendingLoadingOperationIds;

		// Token: 0x04001EBE RID: 7870
		private readonly List<int> _creatingCharIds = new List<int>();

		// Token: 0x04001EBF RID: 7871
		private readonly HashSet<int> _temporaryIntelligentCharIds = new HashSet<int>();

		// Token: 0x02000BE5 RID: 3045
		private struct SimulateCombatContext
		{
			// Token: 0x1700064B RID: 1611
			// (get) Token: 0x06008D71 RID: 36209 RVA: 0x004F9B20 File Offset: 0x004F7D20
			public Character WinnerChar
			{
				get
				{
					return this.IsVictory() ? this.CharA : this.CharB;
				}
			}

			// Token: 0x1700064C RID: 1612
			// (get) Token: 0x06008D72 RID: 36210 RVA: 0x004F9B38 File Offset: 0x004F7D38
			public Character LoserChar
			{
				get
				{
					return this.IsVictory() ? this.CharB : this.CharA;
				}
			}

			// Token: 0x1700064D RID: 1613
			// (get) Token: 0x06008D73 RID: 36211 RVA: 0x004F9B50 File Offset: 0x004F7D50
			public List<Character> WinnerTeam
			{
				get
				{
					return this.IsVictory() ? this.TeamA : this.TeamB;
				}
			}

			// Token: 0x1700064E RID: 1614
			// (get) Token: 0x06008D74 RID: 36212 RVA: 0x004F9B68 File Offset: 0x004F7D68
			public List<Character> LoserTeam
			{
				get
				{
					return this.IsVictory() ? this.TeamB : this.TeamA;
				}
			}

			// Token: 0x06008D75 RID: 36213 RVA: 0x004F9B80 File Offset: 0x004F7D80
			public bool IsVictory()
			{
				return this.CombatResultType == AiHelper.NpcCombatResultType.MajorVictory || this.CombatResultType == AiHelper.NpcCombatResultType.MinorVictory;
			}

			// Token: 0x06008D76 RID: 36214 RVA: 0x004F9B96 File Offset: 0x004F7D96
			public bool IsMajor()
			{
				return this.CombatResultType == AiHelper.NpcCombatResultType.MajorVictory || this.CombatResultType == AiHelper.NpcCombatResultType.MajorDefeat;
			}

			// Token: 0x0400337F RID: 13183
			public Character CharA;

			// Token: 0x04003380 RID: 13184
			public List<Character> TeamA;

			// Token: 0x04003381 RID: 13185
			public Character CharB;

			// Token: 0x04003382 RID: 13186
			public List<Character> TeamB;

			// Token: 0x04003383 RID: 13187
			public CombatType CombatType;

			// Token: 0x04003384 RID: 13188
			public AiHelper.NpcCombatResultType CombatResultType;

			// Token: 0x04003385 RID: 13189
			public bool ForceResult;

			// Token: 0x04003386 RID: 13190
			public int ExpMultiplier;
		}
	}
}
